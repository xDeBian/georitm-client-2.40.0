var PRODUCTION=!0;define("stat/StatObjectsGroup",["jquery","underscore","abstracts/Group"],function(e,t,n){var a=n.extend({constructor:function(){n.apply(this,arguments)}});return a}),define("abstracts/GroupsCollection",["underscore","abstracts/Collection"],function(e,t){var n=t.extend({constructor:function(){this.module=null,t.apply(this,arguments)},parse:function(e){return e.groups||e.group&&e.group.groups||e}});return n}),define("stat/StatObjectsGroupsCollection",["abstracts/GroupsCollection","stat/StatObjectsGroup"],function(e,t){var n=e.extend({constructor:function(){e.apply(this,arguments)},model:t});return n}),define("text!stat/tmpl/statModule.html",[],function(){return'<div id="stat" class="tab-hor-content loading">\n    <div class="box-header module-header append">\n\n        <form class="form-search"<% if(hasSettings || allowCreate){ %> style="right:<%= hasSettings && allowCreate ? \'80\' : \'40\' %>px"<% } %>>\n            <div class="input-append input-prepend">\n                <span class="add-on">\n                    <input name="q" type="text" placeholder="<%= i18n.searchObjects %>" value="" autocomplete="off" />\n                    <i class="icon-clear svg-icon svg-icon-circle-remove"></i>\n                </span>\n                <button class="btn add-on btn-search"><i class="svg-icon svg-icon-search"></i></button>\n            </div>\n        </form>\n\n        <% if(hasSettings){ %>\n        <div class="dropdown module-settings add-on">\n            <a class="dropdown-toggle" data-toggle="dropdown" href="#">\n                <i class="svg-icon svg-icon-cog"></i>\n            </a>\n            <ul class="dropdown-menu nav nav-list" role="menu">\n\n            </ul>\n        </div>\n        <% } %>\n\n        <% if(allowCreate) { %>\n        <div class="dropdown module-adding add-on">\n            <a class="dropdown-toggle" data-toggle="dropdown" href="#">\n                <i class="svg-icon svg-icon-plus"></i>\n            </a>\n            <ul class="dropdown-menu nav nav-list" role="menu">\n                <% if(App.allowed(\'objects.create\')) {%>\n                <li><a class="add-item" href="javascript:;"><%= i18n.addObject %></a></li>\n                <% } %><% if(App.allowed(\'objectgroups.create\')) { %>\n                <li><a class="add-group" href="javascript:;"><%= i18n.addGroup %></a></li>\n                <% } %>\n            </ul>\n        </div>\n        <% } %>\n\n    </div>\n\n    <div class="module-content">\n        <div id="stat-tree" class="tree tree-grid slick-tree"></div>\n    </div>\n\n</div>\n\n\n'}),define("stat/views/StatModuleView",["jquery","underscore","abstracts/ModuleView","text!stat/tmpl/statModule.html","css!stat/css/stat"],function(e,t,n,a){var s=n.extend({constructor:function(){this._tmpl=t.template(a),n.apply(this,arguments)},_bindEvents:function(){this.model,n.prototype._bindEvents.call(this)}});return s}),define("stat/nls/stat",{root:{appartment:"Flat / office",buildingShort:"bld.",gateCode:"Gate code",intercomCode:"House intercom code",noObjAreas:"There are no areas",addObjArea:"Add area description",objAreasState:"State of areas",noObjZones:"There are no zones",addObjZone:"Add zone description",canNotAddObjZone:"To add an zone at least one area must be created",objZoneNum:"Zone No",objZoneName:"Zone name",objZoneComment:"Note",objZonesNumber:"Number of zones",setObjPosition:"Set object coordinates",changeObjPosition:"Edit object coordinates",clickOnMapToSetPos:"To set valid coordinates specify location on the map.",moveObjectToSetPos:"To set valid coordinates move the object on the map.",errIncorrectLat:"Enter valid latitude.",errIncorrectLon:"Enter valid longitude.",cancelEditObjHdr:"Cancel changes?",cancelEditObjMsg:"Object coordinate changes will be cancelled.",errIncorrectAddress:"Fill in required fields please.",armSchedule:"Arming schedule",armSchedulesShort:"Schedules",armSchedulesEmpty:"No schedules have been created yet",armSchedulesParseError:"Arming schedule settings contain an invalid value",armScheduleNew:"New schedule",armScheduleName:"Schedule name",armScheduleComment:"Notes",armScheduleCreate:"Add schedule",armSchedulesCopy:"Copy schedule templates",armScheduleNotSelected:"Is not selected",armScheduleLegend:"Weekly schedule. The minimum interval is 30 minutes",armScheduleMustBeArmed:"Must be armed",armScheduleMayBeDisarmed:"Can be disarmed",armScheduleAllowDisarmLabel:"Disarming within the allowed interval for a limited time (hh:mm)",armScheduleSendNotArmedAlert:'Set the event "Not armed"',armScheduleSendEarlyDisarmedAlertAlert:'Set the event "Early disarming"',armSchedulesCopyFormLabel:"Select an object or group of objects where you want to copy this schedule list",armSchedulesCopyConfirm:"<p>Copy the&nbsp;list of&nbsp;schedules for&nbsp;this&nbsp;object to&nbsp;the selected&nbsp;objects?</p>",armScheduleDeleteConfirm:"<p>Do you really want to delete the schedule?</p><p><strong>Attention!</strong> This schedule is&nbsp;used for one or&nbsp;more areas of&nbsp;the&nbsp;object.</p><p>Once removed, it will no&nbsp;longer be used to&nbsp;handle the&nbsp;events in&nbsp;these areas.</p>"},"ru-ru":!0,"it-it":!0}),define("stat/nls/ru-ru/stat",{appartment:"Кв. / офис",buildingShort:"к.",gateCode:"Код ворот",intercomCode:"Код домофона",noObjAreas:"Нет ни одного раздела",addObjArea:"Добавить описание раздела",objAreasState:"Состояние разделов",noObjZones:"Нет ни одной зоны",addObjZone:"Добавить описание зоны",canNotAddObjZone:"Чтобы добавить зону необходимо создать хотя бы один раздел",objZoneNum:"№ зоны",objZoneName:"Наименование зоны",objZoneComment:"Примечание",objZonesNumber:"Количество зон",setObjPosition:"Установить координаты объекта",changeObjPosition:"Изменить координаты объекта",clickOnMapToSetPos:"Укажите место на карте, чтобы установить правильные координаты.",moveObjectToSetPos:"Переместите объект на карте, чтобы установить правильные координаты.",errIncorrectLat:"Введите правильную широту.",errIncorrectLon:"Введите правильную долготу.",cancelEditObjHdr:"Отменить изменения?",cancelEditObjMsg:"Изменения координат объекта будут отменены.",errIncorrectAddress:"Пожалуйста заполните необходимые поля.",armSchedule:"Расписание охраны",armSchedulesShort:"Расписания",armSchedulesEmpty:"Пока не создано ни одного расписания",armSchedulesParseError:"Настройки  содержат недопустимое значение",armScheduleNew:"Новое расписание",armScheduleName:"Наименование расписания",armScheduleComment:"Примечание",armScheduleCreate:"Добавить расписание",armSchedulesCopy:"Копировать шаблоны расписаний",armScheduleNotSelected:"Не выбрано",armScheduleLegend:"Еженедельное расписание, минимальный интервал 30 мин",armScheduleMustBeArmed:"Должен быть под охраной",armScheduleMayBeDisarmed:"Может быть снят с охраны",armScheduleAllowDisarmLabel:"Снятие в рамках разрешенного интервала на ограниченное время, чч:мм",armScheduleSendNotArmedAlert:'Формировать событие "Нет взятия под охрану"',armScheduleSendEarlyDisarmedAlertAlert:'Формировать событие "Раннее снятие с охраны"',armSchedulesCopyFormLabel:"Выберите объект или группу объектов, куда нужно скопировать этот список расписаний",armSchedulesCopyConfirm:"<p>Копировать список расписаний этого объекта в&nbsp;выбранные&nbsp;объекты?</p>",armScheduleDeleteConfirm:"<p>Вы точно хотите удалить расписание?</p><p><strong>Внимание!</strong> Данное расписание используется для одного или нескольких разделов объекта.</p><p>После удаления расписание не будет задействоваться для обработки событий.</p>"}),define("stat/StatModule",["jquery","underscore","abstracts/ObjectsTypeModule","_common/stat/StatObject","_common/stat/StatObjectsCollection","stat/StatObjectsGroup","stat/StatObjectsGroupsCollection","stat/views/StatModuleView","i18n!_common/nls/common","i18n!stat/nls/stat"],function(e,t,n,a,s,i,r,o,l,d){var c={update:"stat/update/StatUpdateModule",tree:"stat/tree/StatTreeModule",watched:"stat/watched/StatWatchedModule",itemcard:"stat/itemcard/StatItemCardModule",editor:"stat/editor/StatEditorModule"},u=n.prototype,m=n.extend({constructor:function(){this.GroupsClass=i,n.apply(this,arguments)},defaults:t.extend({},u.defaults,{objType:"stat"}),_setI18n:function(){this._i18n=e.extend({},l,d)},_makeView:function(){this._view=new o({container:this.get("container"),placeholder:this.get("placeholder"),model:this,allowCreate:App.allowed("objects.create")||App.allowed("objectgroups.create")})},_getPathes:function(){return c},_bindEvents:function(){var e=this;n.prototype._bindEvents.apply(this,arguments),this.modules.editor&&this.on("itemedit",function(t){t&&t instanceof a&&(e.modules.editor.set("model",t),e.modules.watched.trigger("itemzoom",t.id))})}});return m}),define("stat/update/StatUpdateModule",["underscore","abstracts/update/UpdateModule"],function(e,t){var n=t.extend({constructor:function(){t.apply(this,arguments)}});return n}),define("text!abstracts/tree/tmpl/objectTitle.html",[],function(){return'<div class="cell-row" style="left: <%= (20 * indent) %>px;" data-action="check">\n    <% if(isgroup) { %>\n        <% if(id == 0) { %><% } else if(items.length || groups.length) { %>\n            <i class="icon icon-exp toggle <%= closed ? \'collapse\': \'expand\' %>"></i>\n        <% } else { %>\n            <i class="icon icon-exp toggle"></i>\n        <% } %>\n    <% } %>\n\n    <% if(isgroup && nbItems == 0) { %>\n        <i class="item-check-false"></i>\n    <% } else { %>\n        <i data-action="check" class="icon icon-check item-check<%= checked === 1 ? \' checked\': (checked === 2 ? \' indeterminate\': \'\') %>" ></i>\n    <% } %>\n\n    <% if(isgroup) { %>\n        <strong class="row-title" data-action="check"><%- name %></strong>\n    <% } else { %>\n        <span class="row-title item-title" data-grid-itemid="<%= id %>"><%- title %></span>\n    <% } %>\n</div>'}),define("text!stat/tree/tmpl/status.html",[],function(){return'<% if(isgroup) { %>\n\n    <span class="nb-items" data-action="check">(<%= nbItems %>)</span>\n    <% if(id != \'0\') { %>\n    <i class="icon icon-edit svg-icon svg-icon-caret-down"></i>\n    <% } %>\n\n<% } else { %>\n\n    <i class="status-icon" data-action="check"></i>\n    <i class="icon icon-edit svg-icon svg-icon-caret-down"></i>\n\n<% } %>'}),define("text!stat/tree/tmpl/context.html",[],function(){return'<% if(isgroup) {%>\n    <% if(nbItems && App.reportsAllowed(\'stat\')) { %>\n        <li><a href="#" data-action="group_report"><%= i18n.buildReportByGroup %></a></li>\n    <% } %>\n    <% if(App.allowed(\'objectgroups.edit\')) { %>\n        <li><a href="#" data-action="group_edit"><%= i18n.renameGroup %></a></li>\n    <% } %>\n    <% if(App.allowed(\'objects.create\')) { %>\n        <li><a href="#" data-action="group_add_object"><%= i18n.addObject %></a></li>\n    <% } %>\n    <% if(App.allowed(\'objectgroups.create\')) { %>\n        <li><a href="#" data-action="group_add_group"><%= i18n.addChildGroup %></a></li>\n    <% } %>\n<% } else {%>\n    <% if(App.reportsAllowed(\'stat\')) { %>\n        <li><a href="#" data-action="obj_report"><%= i18n.buildReport %></a></li>\n    <% } %>\n\n    <li><a href="#" data-action="obj_card"><%= i18n.openObjectCard %></a></li>\n\n    <% if( App.allowed(\'objects.edit\') || App.allowed(\'objects.create\') ) { %>\n        <li><a href="#" data-action="obj_editpos"><%= i18n[lat && lon ? \'changeObjPosition\' : \'setObjPosition\'] %></a></li>\n    <% } %>\n\n    <li><a href="#" data-action="obj_history"><%= i18n.objectAlertsAndLog %></a></li>\n<% } %>'}),define("stat/tree/views/StatTreeView",["jquery","underscore","abstracts/tree/views/TreeView","text!abstracts/tree/tmpl/objectTitle.html","text!stat/tree/tmpl/status.html","text!stat/tree/tmpl/context.html"],function(e,t,n,a,s,i){a=t.template(a),s=t.template(s),i=t.template(i);var r=n.extend({constructor:function(){n.apply(this,arguments)},titleFormatter:function(e,n,s,i,r){return a(t.extend(r,{title:this.model.buildItemTitle(r)}))},statusFormatter:function(e,t,n,a,i){return s(i)},_bindEvents:function(){var e=this;this.listenTo(App,"objectsTitleChange",function(){e.refreshGrid()}),n.prototype._bindEvents.apply(this,arguments)},_getItemCSSClasses:function(e){var t=n.prototype._getItemCSSClasses.call(this,e);return e.lat&&e.lon||t.push("no-coords"),t},_getTitleTypes:function(){var e=this.model.getTexts();return{name:e.objName,name_id:e.objName+" + ("+e.objIdNumberShort+")",address_id:e.address.ucFirst()+" + ("+e.objIdNumberShort+")",name_address_id:e.objName+" + "+e.address.ucFirst()+" + ("+e.objIdNumberShort+")"}},_contextAllowed:function(e){return 0==e.id?!1:e.isgroup?e.nbItems&&App.reportsAllowed("stat")||App.allowed("objectgroups.edit")||App.allowed("objectgroups.create")||App.allowed("objects.create"):!0},_buildContextMenuItems:function(e){return i(t.extend({},e,{i18n:this.model.getTexts()}))}});return r}),define("stat/tree/StatTreeModule",["jquery","underscore","abstracts/tree/TreeModule","_common/stat/StatObject","_common/stat/StatObjectsCollection","stat/StatObjectsGroupsCollection","stat/tree/views/StatTreeView"],function(e,t,n,a,s,i,r){var o=n.extend({constructor:function(){this.groups=new i,this.items=new s,this.searchCollection=new s,this.searchCollection.url=App.getBaseUrl()+"objects/obj-search/",n.apply(this,arguments)},defaults:t.extend({},n.prototype.defaults,{type:"all",objType:"stat",propertyId:"statuid"}),url:App.getBaseUrl()+"objects/objects-tree-set/",initialize:function(){this._openedGroups=this.getUserData("openedGroups")||[];var e=this.getUserData("sortType")||this.get("sortType"),t=this.getUserData("titleType");null!==t&&this.set("titleType",t),"title"==t?e="name":"extId"==t&&(e="extId"),this.set("sortType",e),this._view=new r({el:this.get("container"),model:this}),n.prototype.initialize.apply(this,arguments)},_bindEvents:function(){n.prototype._bindEvents.call(this);var e=this;this.listenTo(this.get("parent"),"itemadded",function(n){if(n.objType==App.TYPE_STAT){if("objsGroupsIds"in n){for(var a=0,s=n.objsGroupsIds.length,i=0;s--;)i=n.objsGroupsIds[s],-1==t.indexOf(e._openedGroups,i)&&(e._openedGroups.push(i),a++);a&&e.setUserData("openedGroups",e._openedGroups)}e.loadTree()}})},_clearTree:function(){this.treeData=[],this.groups=new i,this.items=new s},_sortCondition:function(){var e=this.get("sortType");if("name"==e){var t=App.getUserData("objectsTitle")||{};if(!("name"in t))return!0}return!1},_getTitleType:function(){return 1},_copyParams:function(e,n){t.each(["name","objType","city","addressShort","lat","lon","objStatus"],function(t){"undefined"!=typeof e[t]&&(n[t]=e[t])});var s=null;"objectState"in e?s=e.objectState:"isOnline"in e&&"hasFault"in e&&(s=e),s&&(n.hwStatus=a.detectHardwareStatus(s),n.status=a.detectGuardStatus(s))},_onItemChange:function(e){var n=this,a=this._getObjectItemsByIDs(t.pluck(e,"id")),s=null;t.each(a,function(a){s=t.findWhere(e,{id:a.id}),n._copyParams(s,a);var i={name:s.name,imgPath:s.imgPath};"undefined"!=typeof s.lat&&"undefined"!=typeof s.lon&&(i.lat=s.lat,i.lon=s.lon),n.items.get(a.id).set(i)}),this._view.refreshGrid()},_updateObjectModel:function(e){var t=this.items.get(e.id);return t&&t.set({name:e.name,status:e.status,hwStatus:e.hwStatus}),t}});return o}),define("_common/stat/StatDetails",["jquery","underscore","abstracts/GrObject","./StatObject","./Control"],function(e,t,n,a,s){var i=a.prototype,r=-128,o="-1",l=a.extend({constructor:function(){this.$controlsXhr=null,a.apply(this,arguments)},url:App.getBaseUrl()+"objects/obj-details/",defaults:t.extend({},i.defaults,{rev:"",imei:"",canArm:!1,areas:[],controls:[],controlsError:!1,ivideon:null,webRtcCameras:null,lastGSMConnectionTime:0,deviceTypeName:"",deviceTypeId:0,deviceTypeCode:"",description:"",temperature:null,temparatureActiveIndex:0,temperatures:null,temperaturesLoading:!0}),hasToLoadState:function(){var e=this.get("areas"),t=this.get("controls");return e&&e.length>0||t&&t.length>0},loadState:function(){var n=this.get("areas"),a=this.get("controls"),s=[];return n&&n.length>0&&s.push(this.loadAreas()),a&&a.length>0&&s.push(this.loadControls(t.pluck(a,"num"))),e.when.apply(null,s)},loadAreas:function(){var t=this;return this.$stateXhr=e.ajax({url:App.getBaseUrl()+"objects/obj-areas/",data:{objectId:this.id},statusCode:{401:function(){}},success:function(e){var n=t.mergeAndParseAreasData(e,t.get("objStatus"));t.isStateChanged(t.get("areas"),n)&&t.set("areas",n)}}),this.$stateXhr},loadTemperature:function(){var t=this,n=new e.Deferred;return t.set("temperaturesLoading",!0),e.ajax({url:App.getBaseUrl()+"objects/temperature/",data:{objectId:this.id}}).done(function(e){var a=t.adapterDetectors(t.get("tempDetectors")),s=t.adapterTemperaturesData(e),i=t.mergeTemperaturesData(s,a);t.set("temperatures",i),t.set("temperaturesLoading",!1),n.resolve()}).fail(function(){t.set("temperaturesLoading",!1),n.reject.apply(n,arguments)}),n},updateTemperature:function(){if(this.get("tempDetectors")&&this.isOnline())return this.loadTemperature();this.set("temperaturesLoading",!1);var e=this.adapterDetectors(this.get("tempDetectors")),t=this.adapterTemperaturesData(),n=this.mergeTemperaturesData(t,e);this.set("temperatures",n)},loadControls:function(t){var n=this;return this.$controlsXhr=e.ajax({url:App.getBaseUrl()+"objects/outs/",data:{objectId:this.id,outs:t},statusCode:{401:function(){}},success:function(e){n.setControlsState(e)},error:function(){n.set("controlsError",!0),n.set("controls",[])}}),this.$controlsXhr},setControlsState:function(e){var t=(this.get("controls")||[]).slice(0),n=!1;t.length&&(t.forEach(function(t){var a=t.num;a in e?(null===t.state||t.state!==e[a])&&(t.state=e[a],n=!0):(t.state=null,t.canControl=!1,n=!0)}),n&&(this.set("controls",t,{silent:!0}),this.trigger("change:controls",this,t)))},mergeControlsData:function(e){var t,n=this.get("controls")||[],a=[];return"string"==typeof e&&(e=JSON.parse(e)),e=e||[],n.forEach(function(n){t=null;var s=e.find(function(e){return e.num===n.num});s&&(t=Object.assign({},n,s)),t&&a.push(t)}),e.forEach(function(e){var t=n.find(function(t){return e.num===t.num});t||a.push(e)}),s.sortControls(a)},abortLoadState:function(){i.abortLoadState.call(this),this.$controlsXhr&&this.$controlsXhr.abort(),this.$controlsXhr=null},parse:function(e){var t=a.prototype.parse.call(this,e);if("lastGSMConnectionTime"in t&&(t.lastGSMConnectionTime*=App.MS),"areas"in t){var n=this.mergeAndParseAreasData(t.areas,t.objStatus);this.isStateChanged(this.get("areas"),n)?t.areas=n:delete t.areas}return"deviceControlOuts"in t&&!this.get("controlsError")&&(t.controls=this.mergeControlsData(t.deviceControlOuts),delete t.deviceControlOuts),t},mergeAndParseAreasData:function(e,a){var s,i,r=this,o=this.get("areas"),l=t.indexBy(o||[],"num"),d=t.indexBy(e,"num"),c=[],u=n.alarmsAllowed(a);t.each(l,function(e,n){n in d&&(s=d[n],i=t.extend({},e,s),i.zones="zones"in s?r.mergeZonesData(e.zones||[],s.zones):[],c.push(i))}),t.each(d,function(e,t){t in l||c.push(d[t])});for(var m,h=c.length;h--;)m=c[h],m.operatable=this.isAreaOperatable(m),u||(m.hasAlarm=0),m.zones=t.sortBy(m.zones,"num");return c},mergeTemperaturesData:function(e,n){if(!e||!n)return null;var a=[];return t.each(n,function(t){var n=e[t.code];t.value=n?n.value:null,a.push(t)}),a},adapterTemperaturesData:function(e){if(!e)return null;var n=this.get("temperature"),a={"-1":{code:"-1",detector:"-1",sensor:"-1",temperature:n,value:n===r?o:n}};return t.each(e,function(e,n){t.each(e,function(e,t){var s="-1"===n?"-1":n+"-"+t;a[s]={code:s,detector:n,sensor:t,temperature:e,value:e===r?o:e}})}),a},adapterDetectors:function(e){if(!e)return[];try{var t=JSON.parse(e),n=[];return t.forEach(function(e){e.sensors.forEach(function(t){var a="-1"===e.num?"-1":e.num+"-"+t.num;n.push({position:t.position,name:t.name,code:a,note:t.note})})}),n.sort(function(e,t){return e.position-t.position})}catch(a){return console.log("StatItemCardTemperatureView error",a),[]}},mergeZonesData:function(e,n){var a=t.indexBy(e||[],"num"),s=t.indexBy(n,"num"),i=[];return t.each(a,function(e,n){n in s&&i.push(t.extend({},e,s[n]))}),t.each(s,function(e,t){t in a||i.push(s[t])}),i},isStateChanged:function(e,t){return JSON.stringify(e)!=JSON.stringify(t)},getArea:function(e){var n,a=this.get("areas")||[];return(n=t.findWhere(a,{num:parseInt(e)}))?n:null},setAreaState:function(e,n){var a;(a=this.getArea(e))&&(t.extend(a,n),this.trigger("change:areas",this,this.get("areas")))},isOperatable:function(){return App.allowed("objects.arm")||App.allowed("objects.disarm")?this.get("imei")&&this.get("canArm"):!1},isAreaCanBeArmedOrDisarmed:function(e){return this.isOperatable()&&e.num>0&&(!e.isGuarded&&App.allowed("objects.arm")||e.isGuarded&&App.allowed("objects.disarm"))},isAreaOperatable:function(e){var t=this.isAreaCanBeArmedOrDisarmed(e),n=e.hasFault&&App.allowed("objects.clearfaults");return n||t}});return l}),define("text!_common/stat/watched/tmpl/objInfoRestyle.html",[],function(){return'<div data-key="summary" class="content active">\n    <div class="features">\n        <ul>\n            <li data-prop="deviceTypeName"\n                class="<% if(prerender) {%>loading<% } %><% if(\'deviceTypeName\' in hiddenProps) {%> hidden<% } %>">\n                <%= i18n.objHardwareType %>:\n                <strong class="deviceTypeName">\n                    <% if(prerender) {%><i class="svg-icon svg-icon-spinner icon-spin"></i><% } %>\n                    <%= deviceTypeName || \'--\' %>\n                    <% if(rev) {%>(<%= rev %>)<% } %>\n                </strong>\n            </li>\n            <li data-prop="address"<% if(\'address\' in hiddenProps) {%> class="hidden"<% } %>>\n                <%= i18n.address.ucFirst() %>:\n                <strong class="address"><%- addressStr %></strong>\n            </li>\n        </ul>\n    </div><!--/features-->\n\n    <div class="features-col-group clearfix">\n        <div class="features-col">\n            <div class="widgets-group object-state-wrapper">\n                <div class="widget widget-guard <%= activeWidget == \'guard\' ? \'active\' : \'\' %>" data-value="guard"></div>\n\n                <% if(showTemperature) {%>\n                <div class="widget-temperature widget <%= activeWidget == \'temperature\' ? \'active\' : \'\' %>"\n                     data-state="<%= temperature > 0 ? 1 : 0%>" \n                     data-value="temperature"\n                >\n                    <div class="temperature-panel loading" />\n                </div>\n\n                <ul class="widgets-nav">\n                    <li class="widgets-nav-item widgets-nav-item-guard <%= activeWidget == \'guard\' ? \'active\' : \'\' %>"\n                        data-value="guard" data-state="" data-guarded="">\n                    </li>\n                    <li class="widgets-nav-item widgets-nav-item-temperature <%= activeWidget == \'temperature\' ? \'active\' : \'\' %>"\n                        data-value="temperature"\n                        >\n                        <svg class="svg-icon">\n                            <use xlink:href="#smb-temperature"></use>\n                        </svg>\n                    </li>\n                </ul>\n                <% } %>\n            </div>\n        </div><!--/.features-col-->\n\n        <div class="features-col">\n            <ul class="list-group indicators connections"></ul>\n            <ul class="list-group indicators areas-state-wrapper state-loading"></ul>\n            <% if(prerender) {%>\n            <div class="indicators">\n                <i class="svg-icon svg-icon-spinner icon-spin"></i>\n            </div>\n            <% } else if(hasControls) { %>\n            <ul class="list-group indicators controls state-loading"></ul>\n            <% } %>\n        </div><!--/.features-col-->\n    </div><!--/.features-col-group-->\n\n\n    <div class="row-fluid object-state-summary hidden">\n        <div class="state-wrapper areas-state-wrapper loading"></div>\n    </div>\n\n</div><!--/content summary-->\n\n<div data-key="connections" class="content"></div>\n<div data-key="guard" class="content"></div>\n<div data-key="control" class="content"></div>\n<div data-key="faults" class="content"></div>\n\n'}),define("text!_common/stat/watched/tmpl/temperaturesRestyle.html",[],function(){return'<div class="temperature-panel loading">\n    <div class="temperature-ctrl-top <%= hiddenCtrl ? \'temperature-ctrl-top_hidden\' : \'\' %>"></div>\n\n    <div class="temperature"\n        data-value="temperature"\n    >    \n        <div class="temperature-ctrl-arrow more-action more-action-left <%= hiddenCtrl ? \'temperature-ctrl-arrow_hidden\' : \'\' %>" \n            data-arrow="left"\n        >\n            <svg class="svg-icon  more-action">\n                <use xlink:href="#smb-chevron-right"></use>\n            </svg>\n        </div>\n\n        <div class="temperature-panel-value"></div>\n\n        <div class="temperature-ctrl-arrow more-action more-action-right <%= hiddenCtrl ? \'temperature-ctrl-arrow_hidden\' : \'\' %>" \n            data-arrow="right"\n        >\n            <svg class="svg-icon more-action">\n                <use xlink:href="#smb-chevron-right"></use>\n            </svg>\n        </div>\n    </div>\n\n    <div class="temperature-bottom"\n        data-value="temperature"\n    >\n        <p class="temperature-panel-units">&deg;C</p>\n        <p class="temperature-panel-name"><%= i18n.temperature %></p>\n    </div>\n</div>'}),define("text!_common/stat/watched/tmpl/baloonFooter.html",[],function(){return'<a class="unwatch" href="javascript:;"><%= i18n.removeFromMap %></a>\n<% if(routingModule) {%>\n<a href="#" class="route-to pull-right"><%= i18n.routeHere %></a>\n<% } %>'}),define("text!_common/stat/watched/tmpl/objStateRestyle.html",[],function(){return'<div class="widget-value"><%= svgIcon %></div>\n<strong class="widget-label"><%= objTitle %></strong>\n'}),define("text!_common/stat/watched/tmpl/connections.html",[],function(){return'<li class="list-group-item indicator isOnline" \n    data-state="<%= isOnline ? 1 : 0 %>"\n    <% if(isShellAllowed) {%> data-page="connections"<% } %>\n    >\n    <svg class="svg-icon list-group-item-icon">\n        <use xlink:href="#smb-connection"></use>\n    </svg>\n    <div class="info">\n        <h4><%= i18n.GSMConnection %></h4>\n        <div class="extra-online">\n            <span class="extra lastGSMConnectionTime nobr extra-online-label"><%= lastGSMConnectionTimeS %></span>\n            <% if(hasLbsData) {%>\n                <div class="lbs-control lbs-control-stat <%= lbsLoading ? \'loading\' : \'\' %> ">\n                    <i class="svg-icon svg-icon-spinner icon-spin"></i> \n                    <span class="lbs-control-label">\n                        <% if(lbsShown) {\n                            print(i18n.hideLbs)\n                        } else { \n                            print(i18n.showLbs)\n                        } %>\n                    </span>\n                </div>\n            <% } %>\n        </div>\n    </div>\n\n    <% if(isShellAllowed) {%>\n        <svg class="svg-icon more-action">\n            <use xlink:href="#smb-chevron-right"></use>\n        </svg>\n    <% } %>\n</li>\n'}),define("text!_common/stat/watched/tmpl/areasStat.html",[],function(){return'<table data-rows="<% if(areasStat) { print(_.keys(areasStat).length) } else { print(totalAreas) }%>">\n\n<% if(areasStat) { var index = 0; _.each( [\'hasAlarm\', \'hasFault\', \'isGuarded\', \'notGuarded\'], function(key) {%>\n\n    <% if(\'undefined\' != typeof areasStat[key]) {%>\n    <tr data-state="<%= key %>" class="areas-state multi row-<%= ++index %>">\n        <td class="extra">\n            <svg class="svg-icon">\n                <use xlink:href="#smb-<%= areasStat[key].icon %>"></use>\n            </svg>\n        </td><td class="info">\n            <h6><%= areasStat[key].title %></h6>\n            <p><%= areasStat[key].text %></p>\n        </td><td class="extra1">\n            <i class="svg-icon svg-icon-chevron-right"></i>\n        </td>\n    </tr>\n    <% } %>\n\n<% })} else { print( areasHtml ) } %>\n\n</table>'}),define("text!_common/stat/watched/tmpl/areasList.html",[],function(){return'<div class="subheader">\n    <a data-target="summary" class="back" href="#">\n        <i class="svg-icon svg-icon-chevron-circle-left"></i>\n    </a>\n    <h5><%= title %></h5>\n</div>\n\n<div class="areas-state-cont">\n    <table>\n        <%= areasHtml %>\n    </table>\n</div>\n<% if(0) {%>\n\n<div class="areas-list">\n    <table>\n        <colgroup>\n            <!--<col style="width:5%">\n            <col style="width:27%">\n            <col style="width:25%">\n            <col style="width:16%">\n            <col style="width:27%">-->\n\n            <col style="width:20px">\n            <col style="width:18px">\n            <col style="width:18px">\n            <col style="width:18px">\n        </colgroup>\n        <% _.each(areas, function(area){%>\n        <tr class="area" data-id="<%= area.id %>"\n            data-index="<%= area.num %>"\n        <% if(area.num > 0 && operatable) {%> data-page="operate"<% } %>>\n\n        <td class="text-center" title="<%= i18n.objAreaNum %>"><%- area.num %></td>\n        <td class="state-guard<% if(area.isGuarded) {%> on<% } %>"<% if(area.num > 0) {%> title="<%= area.isGuarded ? i18n.guarded : i18n.notGuarded %>"<% } %>>\n        <% if(area.num > 0) {%>\n        <i class="icon-state icon-state-guard"></i>\n        <!--<%= area.isGuarded ? i18n.guarded : i18n.notGuarded %>-->\n        <% } %>\n        </td>\n        <td class="state-alarm<% if(area.hasAlarm) {%> on<% } %>" title="<%= area.hasAlarm ? i18n.withAlarms : i18n.noAlarms %>">\n            <i class="icon-state icon-state-alarm"></i>\n            <!--<% if(area.hasAlarm) { print(i18n.alarm.ucFirst()) } %>-->\n        </td>\n\n        <td class="state-fault<% if(area.hasFault) {%> on<% } %>" title="<%= area.hasFault ? i18n.hasFault : i18n.noFault %>">\n            <i class="icon-state icon-state-fault"></i>\n            <!--<% if(area.hasFault) { print(i18n.hasFault) } %>-->\n        </td>\n        <td class="area-name text-left">\n            <%- area.num == 0 ? i18n.zeroAreaName : ( area.name || i18n.objArea + \' \' + area.num ) %>\n            <% if(area.num > 0 && operatable) {%>\n            <i class="svg-icon svg-icon-chevron-right"></i>\n            <% } %>\n        </td>\n        </tr>\n        <% }) %>\n    </table>\n</div>\n\n<% } %>'}),define("text!_common/stat/watched/tmpl/areasRestyle.html",[],function(){return'<% _.each( areas, function(area) { if(area.num == 0 && !area.hasAlarm && !area.hasFault) return;%>\n\n    <li class="list-group-item indicator areas-state <%= area.num == 0 ? \' area-system\' : \'\'  %>"\n        data-state="<%= area.mainState %>" <% if( area.operatable ) {%>data-page="guard" data-index="<%= area.num %>"<% } %>>\n\n        <svg class="svg-icon list-group-item-icon">\n            <use xlink:href="#smb-<%= area.icon %>"></use>\n        </svg>\n        <i class="svg-icon list-group-item-icon svg-icon-spinner icon-spin"></i>\n\n        <div class="info">\n            <h4><%= area.name %></h4>\n            <p class="extra"><%= area.stateLabel %></p>\n            <p class="extra state-loading-extra"><%= stateLoadingTxt %>...</p>\n        </div>\n\n        <% if(area.operatable) {%>\n        <svg class="svg-icon more-action">\n            <use xlink:href="#smb-chevron-right"></use>\n        </svg>\n        <% } %>\n    </li>\n\n<% }) %>'}),define("text!_common/stat/watched/tmpl/controls.html",[],function(){return'<% _.each(controls, function(c){ %>\n<li class="list-group-item indicator control-state"\n    data-state="<%= c.state == 1 ? 1 : 0 %>"\n    <% if(controlAllowed && c.canControl) {%> data-page="control" data-index="<%= c.num %>"<% } %>>\n    <svg class="svg-icon list-group-item-icon">\n        <use xlink:href="#smb-sun"></use>\n    </svg>\n    <i class="svg-icon list-group-item-icon svg-icon-spinner icon-spin"></i>\n    <% if(controlAllowed && c.canControl) {%>\n    <svg class="svg-icon more-action">\n        <use xlink:href="#smb-chevron-right"></use>\n    </svg>\n    <% } %>\n    <div class="info">\n        <h4><%- c.name %></h4>\n        <p class="extra"><%= i18n[c.state === null ? \'noData\' : ( c.state == 1 ? \'switchedOnShort\' : \'switchedOffShort\' )].ucFirst() %></p>\n        <p class="extra state-loading-extra"><%= i18n.objectStateScan %>...</p>\n    </div>\n</li>\n<% }) %>\n'
}),define("text!_common/stat/watched/tmpl/operateArea.html",[],function(){return'<div class="subheader">\n    <a data-target="<%= prevPage %>" class="back" href="#">\n        <i class="svg-icon svg-icon-chevron-circle-left"></i>\n    </a>\n    <h5><%- area.name || i18n.objArea + \' \' + area.num %></h5>\n</div>\n<div class="operate-content guard-operate-content">\n    <div class="operate-state <%= area.hasAlarm ? \'alarm\' : ( area.hasFault ? \'fault\' : ( \'guard \' + ( area.isGuarded ? \'on\' : \'off\' ) ) ) %>">\n        <div class="state-wrap">\n            <svg class="svg-icon">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#smb-<%= icon %>"></use>\n            </svg>\n        </div>\n    </div>\n    <div class="operate-actions guard-actions">\n        <% if(area.num > 0 && canArm) {%>\n        <button class="btn btn-block <%= area.isGuarded ? \' btn-success\' : \' btn-primary\' %>"\n                data-area="<%= area.num %>"\n                data-guard="<%= area.isGuarded ? \'0\' : \'1\' %>">\n            <%= i18n[area.isGuarded ? \'makeNotGuarded\' : \'makeGuarded\'] %>\n        </button>\n        <% } %>\n        <% if(faults) {%>\n        <button class="btn btn-block btn-warning"\n                data-area="<%= area.num %>"\n                data-page="faults">\n                <%= i18n.viewFaults %>\n        </button>\n        <% } %>\n    </div>\n    <div class="command-result"></div>\n</div>\n'}),define("text!_common/stat/watched/tmpl/operateControl.html",[],function(){return'<div class="subheader">\n    <a data-target="summary" class="back" href="#">\n        <i class="svg-icon svg-icon-chevron-circle-left"></i>\n    </a>\n    <h5><%- control.name %></h5>\n</div>\n<div class="operate-content">\n    <div class="operate-state <%= control.state == 1 ? \'on\' : \'off\' %>" data-state="<%= control.state == 1 ? 1 : 0 %>">\n        <div class="state-wrap">\n            <svg class="svg-icon">\n                <use xlink:href="#smb-power"></use>\n            </svg>\n        </div>\n    </div>\n    <div class="operate-actions control-actions">\n        <button class="btn btn-block <%= control.state == 1 ? \'\' : \' btn-success\' %>"\n                data-num="<%= control.num %>"\n                data-command="<%= control.state == 1 ? 0 : 1 %>">\n            <%= i18n[control.state == 1 ? \'turnOff\' : \'turnOn\'] %>\n        </button>\n    </div>\n</div>\n'}),define("text!_common/stat/watched/tmpl/faults.html",[],function(){return'<div class="subheader">\n    <a data-target="<%= prevPage %>" class="back" href="#">\n        <i class="svg-icon svg-icon-chevron-circle-left"></i>\n    </a>\n    <h5><%- area.name || i18n.objArea + \' \' + area.num %>. <%= i18n.faultsList %></h5>\n</div>\n<div class="faults-content">\n    <table class="faults-table selectable">\n        <% _.each( faults, function(fault){%>\n        <tr class="fault">\n            <td class="fault-text">\n                <% if(area.num > 0) {%>\n                    <%- fault.areaZoneName  || (i18n.objZone + \' \' + fault.areaZoneNum) %>\n                    (#<%= fault.areaZoneNum %>)<br />\n                <% } %>\n                <%- fault.messageText %>\n            </td>\n            <td class="fault-action">\n                <a href="#" data-code="<%= fault.faultCode %>"\n                    data-zone="<%= fault.areaZoneId %>"\n                    class="resolve-fault" title=""><%= i18n.resolveFault %></a>\n            </td>\n        </tr>\n        <% }) %>\n    </table>\n</div>\n'}),define("text!_common/stat/watched/tmpl/home.svg",[],function(){return'<svg class="svg" version="1.1" xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36">\n<path class="svg-path svg-path-half" fill="#F36E21" d="M30.883,20.02L18,9.29L5.119,20.02v15.024h25.764V20.02L30.883,20.02z M17.993,14.8v16.011h-8.64v-8.81\n	l8.633-7.202L17.993,14.8L17.993,14.8z"/>\n<path class="svg-path svg-path-armed" fill="#009F62" d="M5.118,20.018v15.026h25.765V20.018L18,9.289L5.118,20.018L5.118,20.018z"/>\n<path class="svg-path" d="M5.119,20.02v15.024h25.764V20.02L18,9.29L5.119,20.02L5.119,20.02z M18,14.8l8.648,7.202v8.811H9.353v-8.811L18,14.8\n	L18,14.8z"/>\n<path class="svg-path" d="M0,15.946l2.607,3.131c0,0,13.177-10.974,15.393-12.819c2.217,1.845,15.393,12.819,15.393,12.819L36,15.946L18,0.957\n	L0,15.946z"/>\n</svg>'}),define("text!_common/stat/watched/tmpl/pageConnections.html",[],function(){return'<div class="subheader">\n    <a data-target="summary" class="back" href="#">\n        <i class="svg-icon svg-icon-chevron-circle-left"></i>\n    </a>\n    <h5><%- i18n.connection.ucFirst() %></h5>\n</div>\n<div class="connections-content">\n    <% \n        if (channels && channels.length && tmplRow) {\n            _.each(channels, function(channel, index){\n                print(tmplRow(_.extend({\n                    channel: channel, \n                    index: index, \n                    i18n: i18n\n                })));\n            })\n        }\n    %>\n</div>\n'}),define("text!_common/stat/watched/tmpl/pageConnectionsRow.html",[],function(){return'<div class="connections-row <%= channel.isActive ? \' connections-row-active\' : \'\' %>">\n    <div class="connections-row-icon">\n        <svg class="svg-smb">\n            <use xlink:href="#smb-<%= channel.icon %>"></use>\n        </svg>\n    </div>\n\n    <p class="connections-row-item connections-row-item_name">\n        <%- channel.name %>\n    </p>\n\n    <p class="connections-row-item">\n        <%- channel.text %>\n    </p>\n</div>\n'}),define("_common/stat/watched/views/StatInfoView",["jquery","underscore","_common/stat/StatObject","_common/stat/StatDetails","_common/stat/Control","abstracts/watched/views/DeviceInfoView","i18n!_common/nls/common","i18n!stat/nls/stat","text!../tmpl/objInfoRestyle.html","text!../tmpl/temperaturesRestyle.html","text!../tmpl/baloonFooter.html","text!../tmpl/objStateRestyle.html","text!../tmpl/connections.html","text!../tmpl/areasStat.html","text!../tmpl/areasList.html","text!../tmpl/areasRestyle.html","text!../tmpl/controls.html","text!../tmpl/operateArea.html","text!../tmpl/operateControl.html","text!../tmpl/faults.html","text!../tmpl/home.svg","text!abstracts/watched/tmpl/operateSuccess.svg","text!../tmpl/pageConnections.html","text!../tmpl/pageConnectionsRow.html"],function(e,t,n,a,s,i,r,o,l,d,c,u,m,h,p,g,f,v,b,y,w,x,_,S){_=t.template(_),S=t.template(S),l=t.template(l),d=t.template(d),c=t.template(c),u=t.template(u),h=t.template(h),m=t.template(m),p=t.template(p),g=t.template(g),f=t.template(f),v=t.template(v),b=t.template(b),y=t.template(y);var A=0,C=25,j=e.extend({},r,o),T=i.prototype,I=2,k=i.extend({constructor:function(){this._areasConditions=null,this._areaNumber=null,i.apply(this,arguments)},initialize:function(){this.$el.addClass("obj-info-restyle obj-info-stat"),i.prototype.initialize.apply(this,arguments),this._renderTemperature()},remove:function(){T.remove.apply(this,arguments),this._lbsShown&&(this._lbsUpdated=!1,this._hideLbs())},getDetailedModelClass:function(){return a},getAddress:function(){var e=this.model.get("addressShort");return e||(e=Math._round(this.model.get("lat"),4)+", "+Math._round(this.model.get("lon"),4)),e},_bindEvents:function(){var e=this,t="click"+this._getEventsNS();i.prototype._bindEvents.apply(this,arguments),this._initFaults();var n=this.controller.get("parent").getMapsModule();n&&this.$el.on(t,".route-to",function(){e.trigger("close");var t=e.model.get("name");return n.openRouting([{type:"mobile"},{type:"stat",text:t,model:e.model,lat:e.model.get("lat"),lon:e.model.get("lon")}],e.$el),!1}),App.reportsAllowed("stat")&&this.$el.on(t,".cmd-report",function(){return App.trigger("needreport","stat",[e.model]),e.trigger("close"),!1})},_bindModelEvents:function(){var e=this;i.prototype._bindModelEvents.apply(this,arguments),t.each(["name","deviceTypeName","city"],function(n){e.listenTo(e.model,"change:"+n,function(a,s){e.$el.find("."+n).text(t.isNull(s)?"":s)})}),this.listenTo(this.model,"change:addressShort",function(){e.$el.find(".address").text(e.getAddress())}).listenTo(this.model,"change:coords",function(){e.model.get("addressShort")||e.$el.find(".address").text(e.getAddress())}).listenTo(this.model,"change:isOnline change:lastGSMConnectionTime",function(){e._renderConnections(),e._initLbs()}).listenTo(this.model,"change:isGsmOnline",function(t,n){e.$el.toggleClass("obj-info-online",n),e._lbsShown&&e._drawLbs()}).listenTo(this.model,"change:isGuarded change:hasFault",function(){E.renderSummary.call(e)}).listenTo(this.model,"change:temperature",function(){e._renderTemperature()}).listenTo(this.model,"change:activeWidget",function(){"temperature"===this.model.get("activeWidget")&&this.model.updateTemperature()}).listenTo(this.model,"change:temperatures",function(){this._renderTemperature()}).listenTo(this.model,"change:temperaturesLoading",function(){this.checkLoadingTemperature()})},checkLoadingTemperature:function(){var e=this.model.get("temperaturesLoading");e?this.$el.find(".temperature-panel").addClass("loading"):this.$el.find(".temperature-panel").removeClass("loading")},_onStateLoadedFirstTime:function(){var e=this.model;this._renderAreasSummary(),this._areaNumber&&this._renderOperateArea(),this.listenTo(e,"change:areas change:imei change:canArm",function(){this._renderAreasSummary(),this._areaNumber&&this._renderOperateArea()}),e.get("controlsError")?this._renderControlsError():(this._renderControls(),this.listenTo(e,"change:controls",function(){e.get("controlsError")?(this._controlIndex&&this._closeOperateControl(),this._renderControlsError()):(this._renderControls(),this._controlIndex&&this._renderOperateControl())}))},_toggleStateLoading:function(e){this.$el.find(".areas-state-wrapper").toggleClass("state-loading",e).end().find(".controls").toggleClass("state-loading",e)},_getHeaderOptions:function(){var e=i.prototype._getHeaderOptions.call(this);return t.extend(e,{tracks:!1})},_renderContent:function(e){if(this.$content){e=e===!0;var n=this.model,a=n.get("showTemperature"),s=this._getTexts(),i=a?this.controller.getUserData("activeWidget")||"guard":"guard",r=n.get("controls")||[],o=t.extend({},n.attributes,{i18n:s,prerender:e,addressStr:this.getAddress(),hiddenProps:this.controller.getHiddenProperties(),activeWidget:i,hasControls:r.length>0});this.$el.addClass("obj-info-compact"),e||(this.$content.html(l(o)),this._renderConnections(),this._initLbs()),"temperature"===i&&(this.model.updateTemperature(),this._renderTemperature()),E.renderSummary.call(this),this._toggleStateLoading(this.controller.get("stateLoading")),this._renderAreasSummary(),this._renderControls(),this._initWidgets()}},_renderConnections:function(){var e=this.model,t=e.get("isOnline"),n=this._lbsShown,a=this._lbsLoading,s=App.allowed("objects.shell"),i=t&&s;this.$el.find(".connections").html(m({isOnline:t,lbsShown:n,lbsLoading:a,isShellAllowed:s,hasLbsData:i,lastGSMConnectionTimeS:this._formatConnectionTime(),i18n:this._getTexts()}))},_renderFooter:function(){var e=this.controller.get("parent").getMapsModule();this.$el.find(".extra-actions").html(c({i18n:j,routingModule:e&&e.modules.routing||null}))},_renderAreasSummary:function(){var e=this.model.get("areas"),t="",n=this.$el.find(".areas-state-wrapper").removeClass("loading");return e.length?(t=this._renderAreas(),n.html(t),void 0):(t='<p class="no-areas">'+j.noObjAreas+"</p>",void 0)},_renderTemperature:function(){var t=this,n=this.model.get("temperatures"),a=n?n.length<I:!0,s="",i=this.$el.find(".widget-temperature");s=d({hiddenCtrl:a,i18n:j}),i.html(s),i.off("click",".temperature-ctrl-top").off("click",".temperature-ctrl-arrow"),i.on("click",".temperature-ctrl-top",function(e){e.stopPropagation();var n=e.target.dataset&&e.target.dataset.index;n&&(t.model.set("temparatureActiveIndex",+n),t.rerenderT())}).on("click",".temperature-ctrl-arrow",function(n){n.stopPropagation();var a=e(n.target).closest(".temperature-ctrl-arrow"),s=a.data("arrow");if(s){var i=t.model.get("temperatures"),r=t.model.get("temparatureActiveIndex"),o="left"===s?r-1:r+1;0>o&&(o=i.length-1),o>i.length-1&&(o=0),t.model.set("temparatureActiveIndex",+o),t.rerenderT()}}),this.checkLoadingTemperature(),this.rerenderT()},rerenderT:function(){var e=j,t=this.model.get("temperatures"),n=this.model.get("temperature"),a=this.model.get("temparatureActiveIndex"),s=t?t.length>0:!1,i=this.$el.find(".temperature-panel-value"),r=s?null===t[a].value?e.noData:t[a].value:null===n?e.noData:n;i.html(r);var o=this.$el.find(".temperature-panel-name"),l=s?t[a].name:e.temperature;o.html(l);var d=this.$el.find(".temperature-ctrl-top");d.html(this.getHtmlTemperatureCtrlTop());var c="";r>=C?c="temperature-panel-red":r>A&&(c="temperature-panel-green"),r===e.noData&&(c+=" temperature-panel-value_no-data");var u=this.$el.find(".temperature-panel");u.removeClass("temperature-panel-red"),u.removeClass("temperature-panel-green"),u.removeClass("temperature-panel-value_no-data"),u.addClass(c);var m=this.$el.find(".widgets-nav-item-temperature");m.removeClass("nav-temperature-panel-red"),m.removeClass("nav-temperature-panel-green"),m.addClass("nav-"+c)},getHtmlTemperatureCtrlTop:function(){var e=this.model.get("temperatures"),n=this.model.get("temparatureActiveIndex");return t.map(e,function(e,t){var a=t===n?"ctrl-circle_active":"";return'<div class="ctrl-circle '+a+'"'+' data-index="'+t+'"'+" ></div>"})},_renderAreas:function(e){e=e||this.model.get("areas").slice(0);var t=this.model.isOperatable();return e=this._setAreasTmplData(e),g({operatable:t,areas:e,stateLoadingTxt:this.controller.getTexts().objectStateScan})},_renderControls:function(){var e=this.model.get("controls"),t=this._controlIndex,n=this.$el.find(".controls"),a=e.length,s={i18n:j,controlAllowed:App.allowed("control")};a&&n.length?(s.controls=e,n.html(f(s))):a||n.remove(),t&&this._renderOperateControl()},_renderControlsError:function(){var e=this.$el.find(".controls");e.html('<p class="error">'+this._getTexts().errorDeviceOutsState+"</p>")},_initOperate:function(){var t=this,n="click"+this._getEventsNS();this.$el.on(n,"[data-page=guard]",function(n){return n.stopPropagation(),t._stateLoaded&&(t._areaNumber=e(this).data("index"),t._renderOperateArea()),!1}).on(n,"[data-page=control]",function(n){return n.stopPropagation(),t._stateLoaded&&(t._controlIndex=e(this).data("index"),t._renderOperateControl()),!1}).on(n,"[data-page=connections]",function(e){return e.stopPropagation(),t._initPageConnections.call(t),!1}).on(n,"[data-key=guard] .back",function(){return t._areaNumber=null,!1}).on(n,".guard-actions [data-guard]",function(){return t._toggleGuard(e(this).data("area"),e(this).data("guard")),!1}).on(n,".control-actions [data-command]",function(){return t._sendOperate(e(this).data("num"),e(this).data("command")),!1})},_renderOperateArea:function(){var e,t=this.$el.find(".content[data-key=guard]");if(e=this.model.getArea(this._areaNumber)){var n="",a=e.hasFault&&App.allowed("objects.clearfaults"),s=!1;e.num>0?(n=e.isGuarded?"lock":"unlock",s=this.model.isOperatable()):n="wrench",t.html(v({i18n:j,area:e,icon:n,prevPage:"summary",faults:a,canArm:s}))}else this._closeOperateArea()},_initPageConnections:function(){var e=this;this._channels=null,this.$el.addClass("loading"),e._renderPageConnections(),this.model.loadChannels().done(function(){e._renderPageConnections.call(e)}).fail(function(t){var n=e._getTexts();e.showErrors(t,n.errorCommandSending)}).always(function(){e.$el.removeClass("loading")})},getChannelIcon:function(e){return e?"LAN"===e.type?e.connected?"etehrnetok":"etehrnetbad":"WIFI"===e.type?"wifi"+e.level||0:0===e.inserted?"nosim":"gsm"+e.level||0:""},getChannelText:function(e,t){return e&&t?"LAN"===e.type?e.connected?t.notificationSwitchedOn.toLowerCase():t.notificationSwitchedOff.toLowerCase():e.percent?e.percent+"%":t.noNetwork.toLowerCase():""},_renderPageConnections:function(){var e=this,n=this.$el.find(".content[data-key=connections]"),a=e._getTexts(),s=[],i=e.model.get("channels"),r={SIM_1:"SIM 1",SIM_2:"SIM 2",LAN:"Ethernet",WIFI:"WI-FI"};Array.isArray(i&&i.channels)&&t.each(i.channels,function(t){var n=i[t];n&&(Object.assign(n,{name:r[t]||t,type:t,isActive:i.activeChannel===t}),s.push(Object.assign({},n,{icon:e.getChannelIcon(n),text:e.getChannelText(n,a)})))}),n.html(_({i18n:j,channels:s,tmplRow:S}))},_getLbsData:function(){var t=new e.Deferred;return e.ajax({url:App.getBaseUrl()+"lbs/stat/",data:{objectId:this.model.id}}).done(function(e){var n=e.error,a=e.position,s=null;(n||!a)&&(n||(n="Unknown restapi/lbs/stat/ response format. Attribute is absent"),t.reject(n)),a&&(s={center:[a.latitude,a.longitude],radius:a.precision},t.resolve(s))}.bind(this)).fail(function(e){t.reject(e)}),t},_renderOperateControl:function(){if(this._controlIndex){var e=this.model.get("controls"),t=this.$el.find(".content[data-key=control]"),n=e.find(function(e){return e.num===this._controlIndex}.bind(this));n?t.html(b({i18n:j,control:n})):this._closeOperateControl()}},_closeOperateControl:function(){return T._closeOperate.call(this)},_closeOperateArea:function(){this._areaNumber=null,this.setActivePage("summary")},_toggleGuard:function(e,t){var n=this;this.$el.addClass("loading"),"boolean"!=typeof t&&(t=t>0),this.model.toggleGuard(e,t).done(function(){n._onToggleGuardSuccess()}).fail(function(e){var t=n._getTexts();e===n.model.ERR_NO_AREA?e=t.areaDoesNotExist:e===n.model.ERR_AREA_UNAUTHORIZED&&(e=t.haveNoPermissionToControlArea),n.showErrors(e,j.errorCommandSending)}).always(function(){n.$el.removeClass("loading")})},_onToggleGuardSuccess:function(e){var t=this,n=this._getTexts(),a=this.$el.find(".guard-operate-content");e=e!==!1,a.addClass("command-complete success").find(".operate-state .state-wrap").html(x).end().find(".operate-actions").html('<p class="command-msg">'+n.commandSent+"</p>"),setTimeout(function(){t.model.isOnline()&&e&&t._restartStateUpdate({showStateLoading:!0}),t._closeOperateArea()},1e3)},_initFaults:function(){var n=this,a="click"+this._getEventsNS();this.$el.on(a,"[data-page=faults]",function(a){var s=e(this);a.stopPropagation(),n.$el.addClass("loading");var i=s.data("area"),r=n.model.getArea(i);return n._areaNum=i,n.model.set("faults",null),n.model.loadFaults().done(function(e){var a=t.filter(e,function(e){return e.areaNum==n._areaNum}),s=n.controller.getTexts();if(a.length){var i=n.$el.find(".content[data-key=faults]");n.model.set("faults",a),i.html(y({area:r,faults:a,i18n:s,prevPage:"guard"}))}else n.model.set("faults",null),n._areaNum=null,n.setActivePage("guard")}).always(function(){n.$el.removeClass("loading")}),!1}).on(a,"[data-key=faults] .back",function(){return n.model.set("faults",null),n._areaNum=null,!1}).on(a,".resolve-fault",function(){return n._resolveFaults.call(n,{code:e(this).data("code"),zone:e(this).data("zone")}),!1})},_resolveFaults:function(e){var t=this;this.$el.addClass("loading"),this.model.resolveFaults(e).done(function(){t.$el.find("[data-code]").filter("[data-code="+e.code+"]").filter("[data-zone="+e.zone+"]").closest(".fault").remove(),t.model.get("faults")||(t.model.setAreaState(t._areaNum,{hasFault:!1}),t.setActivePage(t.model.isAreaOperatable(t.model.getArea(t._areaNum))?"guard":"summary"),t._areaNum=null)}).fail(function(e){t.showErrors(e)}).always(function(){t.$el.removeClass("loading")})},_setAreasTmplData:function(e){var n=this,a="",s="",i=[],r="";return t.each(e,function(e){s="unlock",a="notGuarded",i=[],0==e.num?e.hasAlarm?s="warning":e.hasFault&&(s="wrench"):e.isGuarded&&(s="lock"),e.hasAlarm?a="hasAlarm":e.hasFault?a="hasFault":e.isGuarded&&(a="isGuarded"),e.hasAlarm||e.hasFault?(e.hasAlarm&&i.push(j.alarm),e.hasFault&&i.push(j.hasFault.toLowerCase())):i.push(j.objAreaStateNorm),r=0==e.num?j.zeroAreaName:"undefined"!=typeof e.name&&e.name?t.escape(e.name):j.objArea+" "+e.num,e.icon=s,e.name=r,e.mainState=a,e.stateLabel=i.join(", ").ucFirst(),e.operatable=n.model.isAreaOperatable(e)}),e},_getTexts:function(){return j}}),E={initAreas:function(){var t=this;this.$el.on("click",".multi[data-state]",function(){var n={},a=e(this).data("state");"notGuarded"==a?n.isGuarded=!1:n[a]=!0,t._areasConditions=n,E.showAreas.call(t)}).on("click",".show-areas",function(){t._areasConditions={},E.showAreas.call(t)})},renderSummary:function(){var e=this,t=e.$el.find(".widget-guard"),n=e.$el.find(".widgets-nav-item[data-value=guard]"),a=this.model,s="",i="",r=this.model.get("isGuarded"),o=App.getLocale().indexOf("ru")>=0;a.get("hasAlarm")?(s=j.alarm.ucFirst()+"!",i="hasAlarm"):a.get("hasFault")?(s=j.attention+" "+j.hasFault.toLowerCase()+"!",i="hasFault"):1===r?(s=j.object.ucFirst()+' <span class="'+(o?"nobr":"")+'">'+j.guarded.toLowerCase()+"</span>",i="isGuarded"):2===r?(s=j.object.ucFirst()+"&nbsp;"+j.guardedPartly.toLowerCase(),i="isGuarded"):(s=j.object.ucFirst()+' <span class="'+(o?"nobr":"")+'">'+j.notGuarded.toLowerCase()+"</span>",i="notGuarded"),n.html(w).attr("data-guarded",r).attr("data-state",i),t.html(u({objTitle:s,svgIcon:w})).attr("data-guarded",r).attr("data-state",i)},renderAreasList:function(){var e=this._areasConditions,n="hasFault"in e||"hasAlarm"in e||!t.keys(e).length?this.model.getAreasWhere(e):this.model.getNotZeroAreas(e);if(!n.length||!e)return this._areasConditions=null,this.setActivePage("summary"),void 0;var a="";t.keys(e).length?"undefined"!=typeof e.hasAlarm?a=e.hasAlarm?j.alarmAreas:j.notAlarmAreas:"undefined"!=typeof e.hasFault?a=e.hasFault?j.faultAreas:j.noFaultAreas:"undefined"!=typeof e.isGuarded&&(a=e.isGuarded?j.guardedAreas:j.notGuardedAreas):a=j.objAreas,this.$el.find("[data-key=areas]").html(p({i18n:j,title:a+" ("+n.length+")",areasHtml:this._renderAreas(n),operatable:this.model.isOperatable()}))}};return k}),define("text!stat/watched/tmpl/chooseViewType.html",[],function(){return'<a class="i-left" href="javascript:;" title="<%= i18n.clickToChange %>">\n    <i class="objViewType stat"></i> <%= i18n.stationary %>\n</a>\n<div class="context-menu view-type-menu" id="statViewTypeMenu">\n    <i class="stat-icons"></i>\n    <i class="stat-simple"></i>\n</div>'}),define("text!stat/watched/tmpl/baloonProps.html",[],function(){return'<h5><%= i18n.infoInBaloon %></h5>\n<ul>\n    <li>\n        <label class="checkbox">\n            <input type="checkbox" data-prop="extId" checked /> <%= i18n.objIdNumber %>\n        </label>\n    </li>\n    <li>\n        <label class="checkbox">\n            <input type="checkbox" data-prop="deviceTypeName" checked /> <%= i18n.objHardwareType %>\n        </label>\n    </li>\n    <li>\n        <label class="checkbox">\n            <input type="checkbox" data-prop="address" checked /> <%= i18n.address.ucFirst() %>\n        </label>\n    </li>\n</ul>'}),define("stat/watched/views/StatObjectsMapView",["jquery","jqueryui","underscore","_common/stat/StatDetails","abstracts/watched/views/ObjectsWatchedView","_common/stat/watched/views/StatInfoView","text!../tmpl/chooseViewType.html","text!../tmpl/baloonProps.html","text!_common/stat/watched/tmpl/home.svg"],function(e,t,n,a,s,i,r,o,l){r=n.template(r),o=n.template(o);var d=s.extend({constructor:function(){s.apply(this,arguments)},initialize:function(){var t=this;s.prototype.initialize.apply(this,arguments),this.listenTo(App,"objectsTitleChange",function(){n.each(t._viewsMap,function(e,n){e&&e.trigger("settitle",{title:t.model.buildItemTitle(t.model.items.get(n))})})}),e("#settings").length?c.initSettings.call(this):this.listenTo(App,"settingsready",function(){c.initSettings.call(t)})},_onModuleReady:function(){var e=this.model.get("startObjId");s.prototype._onModuleReady.call(this),e&&this._viewsMap[e]&&this._viewsMap[e].openPopup()},_buildMarkerHtml:function(e){var t="",n="";return this.isIconsView()?t=' style="background-image:url('+e.getImgPath(!0)+');"':n=l,'<i class="i"'+t+">"+n+'</i><span class="name">'+this.model.buildItemTitle(e)+"</span>"},_buildInfoView:function(e,t){this._infoView=new i({el:t,parent:this,controller:this.model,objectId:e.id})},_bindModelEvents:function(e){var t=this,n=e.id;s.prototype._bindModelEvents.call(this,e),this.listenTo(e,"change:coords",function(a,s){if(!(s&&s[0]&&s[1]||!t._viewsMap[n])){var i=t._viewsMap[n];e.get("hasAlarm")?t._singlesLayer.removeLayer(i):t._clustersLayer.removeLayer(i),t._viewsMap[n]=null}})},_removeViewById:function(e){var t=this._viewsMap[e];if(t){var n=t.options.model.get("hasAlarm");n?this._singlesLayer.removeLayer(t):this._clustersLayer.removeLayer(t),this._viewsMap[e]=null}}}),c={initSettings:function(){var t=this,n=this.model.get("parent").getTexts(),a=e("#settings").find(".objects-watched");a.find(".stat-view-type").removeClass("hidden").html(r({i18n:n})),a.find(".swhoip").removeClass("hidden").html(o({i18n:n})),a.find(".objViewType.stat").css("background-image","url(stat/images/"+this.model.get("objViewType")+".png)"),e.fn.contextmenu&&(a.find("a").contextmenu({menu:e("#statViewTypeMenu"),position:{my:"left top"}}).on("click",function(t){e(this).contextmenu("open",t)}),e("#statViewTypeMenu").on("click","i",function(){var e=/icons|simple/.exec(this.className)[0]||"simple";a.find(".objViewType.stat").css("background-image","url(stat/images/"+e+".png)"),t.model.set("objViewType",e)}))}};return d}),define("stat/watched/StatWatchedModule",["underscore","abstracts/watched/ObjectsWatchedModule","_common/stat/StatObject","_common/stat/StatObjectsCollection","./views/StatObjectsMapView"],function(e,t,n,a,s){var i="simple",r=t.prototype,o=t.extend({constructor:function(){this.items=new a,this.items.url=App.getBaseUrl()+"objects/obj/",this._edited=null,t.apply(this,arguments)},_viewClass:s,defaults:e.extend({},r.defaults,{objType:"stat",objViewType:i}),initialize:function(){this.set("objViewType",this.getUserData("objViewType")||i),this._setItemsFromGET.call(this),r.initialize.call(this)},_bindEvents:function(){var t=this;r._bindEvents.call(this),this.listenTo(App,"showobjects",function(n){if(n&&e.isArray(n)){var a=e.filter(n,function(e){return e.objType==App.TYPE_STAT});t.setItems(a)}})}});return o}),define("text!stat/itemcard/tmpl/wrapper.html",[],function(){return'<ul class="nav nav-tabs">\n    <li class="tab-obj active">\n        <a href="#tabs-1" data-key="main" data-toggle="tab">\n            <i class="svg-icon svg-icon-circle-info"></i>\n            <%= i18n.object.ucFirst() %>\n        </a>\n    </li>\n    <% if(htmlHardware) { %>\n    <li class="tab-hardware">\n        <a href="#tabs-2" data-key="hardware" data-toggle="tab">\n            <i class="svg-icon svg-icon-hardware"></i>\n            <%= i18n.hardware %>\n        </a>\n    </li>\n    <% } %>\n    <li class="tab-areas">\n        <a href="#tabs-3" data-key="areas" data-toggle="tab">\n            <i class="svg-icon svg-icon-areas"></i>\n            <%= i18n.objAreas %>\n        </a>\n    </li>\n    <li class="tab-zones">\n        <a href="#tabs-4" data-key="zones" data-toggle="tab">\n            <i class="svg-icon svg-icon-zones"></i>\n            <%= i18n.objZones %>\n        </a>\n    </li>\n    <% if(editable) {%>\n    <li class="tab-controls">\n        <a href="#tabs-13" data-key="controls" data-toggle="tab">\n            <svg class="svg-icon">\n                <use xlink:href="#smb-bulb-off"></use>\n            </svg>\n            <%= i18n.deviceOuts %>\n        </a>\n    </li>\n    <li class="tab-schedules">\n        <a href="#tabs-11" data-key="schedules" data-toggle="tab">\n            <i class="svg-icon svg-icon-time"></i>\n            <%= i18n.armSchedulesShort %>\n        </a>\n    </li>\n    <li class="tab-alerts-control">\n        <a href="#tabs-12" data-key="alerts-control" data-toggle="tab">\n            <i class="svg-icon svg-icon-checkmark"></i>\n            <%= i18n.alertsControl %>\n        </a>\n    </li>\n    <% } %>\n    <li class="tab-pictures">\n        <a href="#tabs-5" data-key="pictures" data-toggle="tab">\n            <i class="svg-icon svg-icon-photo"></i>\n            <%= i18n.objPhoto %>\n        </a>\n    </li>\n    <li class="tab-responsible">\n        <a href="#tabs-6" data-key="people" data-toggle="tab">\n            <i class="svg-icon svg-icon-users"></i>\n            <%= i18n.responsible.header %>\n        </a>\n    </li>\n\n    <% if(editable) {%>\n    <li class="tab-notifications">\n        <a href="#tabs-7" data-key="notifications" data-toggle="tab">\n            <i class="svg-icon svg-icon-send"></i>\n            <%= i18n.notifications %>\n        </a>\n    </li>\n    <li class="tab-history">\n        <a href="#tabs-9" data-key="history" data-toggle="tab">\n            <svg class="svg-icon">\n                <use xlink:href="#smb-edit"></use>\n            </svg>\n            <%= i18n.editHistory %>\n        </a>\n    </li>\n    <% } %>\n\n    <% if(editable && (App.allowed(\'video.edit\') || App.get(\'grGuardsAvailable\'))) {%>\n    <li class="dropdown dropdown-more pull-right">\n        <svg class="svg-icon dropdown-toggle" data-toggle="dropdown">\n            <use xlink:href="#smb-more-vert"></use>\n        </svg>\n        <ul class="dropdown-menu nav">\n            <% if(App.allowed(\'video.edit\')) { %>\n            <li>\n                <a href="#tabs-8" data-key="cameras" data-toggle="tab">\n                    <i class="svg-icon svg-icon-camera"></i>\n                    <%= i18n.video %>\n                </a>\n            </li>\n            <% } %>\n            <% if(App.get(\'grGuardsAvailable\')) {%>\n            <li>\n                <a href="#tabs-10" data-key="guards" data-toggle="tab">\n                    <svg class="svg-icon">\n                        <use xlink:href="#smb-shield"></use>\n                    </svg>\n                    <%= i18n.rrTeamShort %>\n                </a>\n            </li>\n            <% } %>\n            <li>\n                <a href="#tabs-14" data-key="temperature" data-toggle="tab">\n                    <svg class="svg-icon">\n                        <use xlink:href="#smb-temperature"></use>\n                    </svg>\n                    <%= i18n.temperature %>\n                </a>\n            </li>\n        </ul>\n    </li>\n    <% } %>\n</ul>\n<div class="tab-content">\n    <div class="tab-pane card-section active" id="tabs-1">\n        <%= htmlInfo %>\n    </div>\n\n    <% if(htmlHardware) { %>\n    <div class="tab-pane card-section" id="tabs-2">\n        <%= htmlHardware %>\n    </div>\n    <% } %>\n\n    <div class="tab-pane card-section areas-section" id="tabs-3">\n        <%= htmlAreas %>\n    </div>\n\n    <div class="tab-pane card-section zones-section" id="tabs-4">\n        <%= htmlZones %>\n    </div>\n\n    <% if(editable) {%>\n    <div class="tab-pane card-section schedules-section" id="tabs-11"></div>\n    <div class="tab-pane card-section alert-control-section" id="tabs-12"></div>\n    <% } %>\n\n    <div class="tab-pane card-section pictures-section" id="tabs-5">\n        <%= htmlPictures %>\n    </div>\n\n    <div class="tab-pane card-section responsible-section" id="tabs-6">\n        <%= htmlResponsible %>\n    </div>\n\n    <% if(editable) {%>\n        <% if(App.get(\'grGuardsAvailable\')) {%>\n            <div class="tab-pane card-section guards-section" id="tabs-10"></div>\n        <% } %>\n        <div class="tab-pane card-section notifications-section" id="tabs-7"></div>\n        <% if(App.allowed(\'video.edit\')) { %>\n            <!--/tab-8 cameras ivideon, webrtc-->\n            <div class="tab-pane card-section cameras-section" id="tabs-8"></div>\n        <% } %>\n        <div class="tab-pane card-section history-section" id="tabs-9"></div>\n        <div class="tab-pane card-section controls-section" id="tabs-13"></div>\n    <% } %>\n\n    <div class="tab-pane card-section temperature-section" id="tabs-14"></div>\n\n</div><!--/tab-content-->'}),define("text!stat/itemcard/tmpl/info.html",[],function(){return'<table class="l">\n    <tr>\n        <td class="col">\n            <table class="l features">\n                <tr>\n                    <td class="label"><%= i18n.objName %></td>\n                    <td class="value"><%- item.name || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.description %></td>\n                    <td class="value">\n                        <p class="no-margin text-large"><strong><%= shortDescription || emptyString %></strong></p>\n                    </td>\n                </tr><tr>\n                    <td class="label"><%= i18n.country %></td>\n                    <td class="value"><%- settings.Country || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.region %></td>\n                    <td class="value"><%- settings.Region || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.city %></td>\n                    <td class="value"><%- settings.City || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.street %></td>\n                    <td class="value"><%- settings.Street || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.house %> / <%= i18n.building %></td>\n                    <td class="value"><%- settings.House || emptyString %> / <%- settings.Building || emptyString %>\n                </tr><tr>\n                    <td class="label"><%= i18n.gateCode %></td>\n                    <td class="value"><%- settings.GateCode || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.intercomCode %></td>\n                    <td class="value"><%- settings.IntercomCode || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.appartment %></td>\n                    <td class="value"><%- settings.AppNumber || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.objEquipmentIds %></td>\n                    <td class="value"><%- settings.equipmentIds ? JSON.parse(settings.equipmentIds).join(\', \') : emptyString %></td>\n                </tr>\n            </table>\n        </td>\n        <td class="col">\n            <table class="l features">\n                <%= col2Html %>\n            </table>\n        </td>\n        <td class="col" style="width:90px">\n            <div class="img-block">\n                <img<% if(!imgPath) {%> style="display:none"<% } %> src="<% if(imgPath) {%><%= imgPath %><% } %>" alt="" />\n            </tr>\n        </td>\n    </tr>\n</table>\n<p class="no-margin"><%= i18n.comments.ucFirst() %>:</p>\n<p class="no-margin text-large"><strong><%= description || emptyString %></strong></p>\n'
}),define("text!abstracts/itemcard/tmpl/infoCol2.html",[],function(){return'<tr>\n    <td class="label"><%= i18n.objOwner %></td>\n    <td class="value"><%- settings.VRC_OWNER || emptyString %></td>\n</tr><tr>\n    <td class="label"><%= i18n.phone.ucFirst() %> 1</td>\n    <td class="value"><%- settings.PHONE1 || emptyString %></td>\n</tr><tr>\n    <td class="label"><%= i18n.phone.ucFirst() %> 2</td>\n    <td class="value"><%- settings.PHONE2 || emptyString %></td>\n</tr><tr>\n    <td class="label"><%= i18n.objOwnerPass %></td>\n    <td class="value"><%- settings.OwnerPassword || emptyString %></td>\n</tr><tr>\n    <td class="label"><%= i18n.objContract %></td>\n    <td class="value"><%- settings.ContractNumber || emptyString %></td>\n</tr><tr>\n    <td class="label"><%= i18n.objContractDate %></td>\n    <td class="value"><%- settings.СontractDate || emptyString %></td>\n</tr><tr>\n    <td class="label"><%= i18n.groups.ucFirst() %></td>\n    <td class="value">\n        <% if(objsGroups && objsGroups.length) {\n        var i = 0;\n        _.each(objsGroups, function(group){\n        print((i++ > 0 ? \', \' : \'\') + group.name);\n        })%>\n        <% } %>\n    </td>\n</tr><tr>\n    <td class="label"><%= i18n.objStatus %></td>\n    <td class="value"><%= status %></td>\n</tr>'}),define("text!abstracts/itemcard/tmpl/hardware.html",[],function(){return'<table class="l">\n    <tr>\n        <td class="col">\n            <table class="features">\n                <% if(imei) {%>\n                <tr>\n                    <td class="label">IMEI</td>\n                    <td class="value"><%- imei %></td>\n                </tr>\n                <% } %>\n                <tr>\n                    <td class="label"><%= i18n.objHardwareType %></td>\n                    <td class="value"><%= deviceTypeName %></td>\n                </tr>\n                <tr>\n                    <td class="label"><%= i18n.simCard %> 1</td>\n                    <td class="value"><%- settings.SIM || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.simCard %> 2</td>\n                    <td class="value"><%- settings.SIM2 || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.password.ucFirst() %></td>\n                    <td class="value"><%- settings.PASS || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.placeInstall %></td>\n                    <td class="value"><%- settings.InstallPlace || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.dateInstall %></td>\n                    <td class="value"><%- settings.InstallDate || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.installer %></td>\n                    <td class="value"><%- settings.Installer || emptyString %></td>\n                </tr>\n            </table>\n        </td>\n        <td class="col">\n            <div class="device-img">\n                <img src="<%= deviceImg %>" alt="">\n                <p class="no-margin"><%= deviceTypeName %></p>\n            </div>\n        </td>\n    </tr>\n</table>\n<p class="no-margin"><%= i18n.objExtraHardware %>:</p>\n<p class="no-margin"><strong><%- settings.ExtraHardware || emptyString %></strong></p>'}),define("text!stat/itemcard/tmpl/areasAndZones.html",[],function(){return"<% if (rows.length) {%>\n<table class=\"table table-striped table-condensed no-margin\">\n    <colgroup>\n        <col style=\"width:75\">\n    </colgroup>\n    <thead>\n        <tr>\n            <th><%= headers.num %></th>\n            <% if ('undefined' != typeof headers.area) {%>\n            <th><%= headers.area %></th>\n            <% } %>\n            <th><%= headers.name %></th>\n            <th><%= headers.comment %></th>\n        </tr>\n    </thead>\n    <tbody>\n        <% _.each(rows, function(row){ %>\n        <tr>\n            <td><%- row.num || emptyString %></td>\n            <% if ('undefined' != typeof row.area) {%>\n            <td><%= row.area %></td>\n            <% } %>\n            <td><%- row.name || emptyString %></td>\n            <td><%- row.comment || emptyString %></td>\n        </tr>\n        <% }) %>\n    </tbody>\n</table>\n<% } else { %>\n<p><%= noData %></p>\n<% } %>"}),define("text!_common/abstracts/itemcard/tmpl/pictures.html",[],function(){return"\n"}),define("text!abstracts/itemcard/tmpl/responsible.html",[],function(){return'<p><%= i18n.responsible.pass1 %>: <strong><%= responsible.pass1 || i18n.notEntered %></strong>\n<p><%= i18n.responsible.pass2 %>: <strong><%= responsible.pass2 || i18n.notEntered %></strong>\n\n<% if (responsible.persons && responsible.persons.length) {%>\n<table class="table table-striped table-condensed no-margin">\n    <thead>\n    <tr>\n        <th><%= i18n.responsible.persons.key %></th>\n        <th><%= i18n.responsible.persons.name %></th>\n        <th><%= i18n.responsible.persons.phone1 %></th>\n        <th><%= i18n.responsible.persons.phone2 %></th>\n        <th><%= i18n.responsible.persons.comment %></th>\n    </tr>\n    </thead>\n    <tbody>\n    <% _.each(responsible.persons, function(person){ %>\n    <tr>\n        <td class="col-num"><%- person.key || emptyString %></td>\n        <td><%- person.name || emptyString %></td>\n        <td><%- person.phone1 || emptyString %></td>\n        <td><%- person.phone2 || emptyString %></td>\n        <td><%- person.comment || emptyString %></td>\n    </tr>\n    <% }) %>\n    </tbody>\n</table>\n<% } else { %>\n<p><%= i18n.responsible.persons.noData %></p>\n<% } %>'}),define("stat/itemcard/views/StatItemCardView",["jquery","underscore","jqueryui","jface","abstracts/itemcard/views/ItemCardView","text!stat/itemcard/tmpl/wrapper.html","text!stat/itemcard/tmpl/info.html","text!abstracts/itemcard/tmpl/infoCol2.html","text!abstracts/itemcard/tmpl/hardware.html","text!stat/itemcard/tmpl/areasAndZones.html","text!_common/abstracts/itemcard/tmpl/pictures.html","text!abstracts/itemcard/tmpl/responsible.html"],function(e,t,n,a,s,i,r,o,l,d,c,u){var i=t.template(i),r=t.template(r),o=t.template(o),l=t.template(l),d=t.template(d),c=t.template(c),u=t.template(u),m="-",h=s.extend({constructor:function(){s.apply(this,arguments)},initialize:function(){s.prototype.initialize.apply(this,arguments)},render:function(){var n=this,s=this.model.get("settings"),l=this.module.getTexts(),h=null,p="",g="",f="",v="",b="",y="",w=this.model.get("item"),x=0,_=t.extend({},this.model.attributes,{i18n:l,emptyString:m,imei:this._getDeviceImei(),deviceImg:this._getDeviceImage(),deviceTypeName:this._getDeviceTypeName(),deviceFirmware:this._getDeviceFirmware(),status:l.objStatuses[this.model.get("objStatus")]});p=r(t.extend({},_,{col2Html:o(_),imgPath:this.model.getImagePath(),shortDescription:this._prepareEditableText(_.settings.shortDescription),description:this._prepareEditableText(_.settings.DESCRIPTION)}));var S=this.model.get("areas");f=d({headers:{num:l.objAreaNum,name:l.objAreaName,comment:l.objAreaComment},rows:S,noData:l.noObjAreas,emptyString:m});var A,C=t.clone(this.model.get("zones")),j=t.indexBy(S,"id"),T="";for(x=C.length;x--;)A=j[C[x].areaId],T=A.name||l.objArea+" "+A.num,C[x].area="["+A.num+"] "+T;v=d({headers:{area:l.objArea,num:l.objZoneNum,name:l.objZoneName,comment:l.objZoneComment},rows:C,noData:l.noObjZones,emptyString:m}),b=c(_);try{h=e.parseJSON(s.RESPONSIVE_PERSONS)}catch(I){}y=u({i18n:l,emptyString:m,responsible:h||{persons:[],pass1:"",pass2:""}});var k=i({editable:!1,i18n:l,htmlInfo:p,htmlHardware:g,htmlAreas:f,htmlZones:v,htmlPictures:b,htmlResponsible:y});a.showOverlay(),a.window.open(t.extend(this._getWindowParams(w,k),{openCallback:function(){var e=this;n.setElement(this),n._activateSetup(),n._activatePictures(),e.find(".nav-tabs a").on("shown.bs.tab",function(){e.trigger("jw.contentchange")})},activateCallback:function(){n._onActivate()},closeCallback:function(){n._onClose()},dieCallback:function(){n.remove()}}))}});return h}),define("text!_common/stat/faults/tmpl/faults.html",[],function(){return"<ul class=\"faults-list selectable\">\n    <% _.each( faults, function(fault){%>\n    <li class=\"fault\">\n        <p>\n            <%= i18n.objArea %> <%= fault.areaNum %>\n            <%- fault.areaName && fault.areaName != i18n.objArea + ' ' + fault.areaNum ? ': ' + fault.areaName : '' %>\n        </p>\n        <p>\n            <%= i18n.objZone %> <%= fault.areaZoneNum %>\n            <%- fault.areaZoneName && fault.areaZoneName != i18n.objZone + ' ' + fault.areaZoneNum ? ': ' + fault.areaZoneName : '' %>\n        </p>\n        <p><%- fault.messageText %></p>\n        <a data-code=\"<%= fault.faultCode %>\" data-zone=\"<%= fault.areaZoneId %>\"\n           class=\"resolve-fault svg-icon svg-icon-remove\" title=\"<%= i18n.resolveFault %>\"></a>\n    </li>\n    <% }) %>\n</ul>"}),define("_common/stat/faults/views/FaultsView",["jquery","underscore","jface","abstracts/View","text!../tmpl/faults.html"],function(e,t,n,a,s){s=t.template(s);var i=a.extend({constructor:function(){this.controller=null,a.apply(this,arguments)},initialize:function(e){var t=this;this.controller=e.controller,showCursor(),this.model.loadFaults().done(function(e){e.length?t.parse(e):(t.trigger("remove"),alert(t.controller.getTexts().noFaultsOnObject))}).always(hideCursor)},parse:function(t){var a=this.controller.getTexts(),i=this,o=s({faults:t,i18n:a});n.window.open({addClass:"pop-faults",contentHtml:o,headerHtml:a.faultsList,footerHtml:'<button type="submit" class="btn btn-primary resolve-all">'+a.resolveAllFaults+"</button>"+'<a href="javascript:;" class="btn jw-close">'+a.cancel.ucFirst()+"</a>",width:330,maxHeight:600,centered:!0,dieAfter:0,openCallback:function(){i.setElement(this),i.$el.on("click",".resolve-fault",function(){r.resolveFaults.call(i,{code:e(this).data("code"),zone:e(this).data("zone")})}).on("click",".resolve-all",function(){r.resolveFaults.call(i)})},closeCallback:function(){i.trigger("remove")}})},remove:function(){return this.$el.trigger("jw.close"),this.stopListening(),this}}),r={resolveFaults:function(e,t){var a=this;if(!t){var s=this.controller.getTexts();return n.confirm(e?s.resolveFaultConfirm:s.resolveAllFaultsConfirm,s.resolveFault+"?",{okCallback:function(){r.resolveFaults.call(a,e||null,!0)}})}this.$el.addClass("loading"),this.model.resolveFaults(e||null).done(function(){e&&a.model.get("faults")?a.$el.find("[data-code]").filter("[data-code="+e.code+"]").filter("[data-zone="+e.zone+"]").closest("li").remove():a.trigger("remove").remove()}).fail(function(){}).always(function(){a.$el.removeClass("loading")})}};return i}),define("text!stat/itemcard/tmpl/guards.html",[],function(){return'<table class="table table-condensed guards<% if(!showTable) {%> hidden<% } %>">\n    <thead>\n        <th><%= i18n.rrTeamShort %></th>\n        <th><%= i18n.rrtPerson %></th>\n        <th><%= i18n.phone.ucFirst() %></th>\n        <th>&nbsp;</th>\n    </thead>\n    <tbody>\n\n    </tbody>\n</table>\n<p class="no-data<% if(showTable) {%> hidden<% } %>"><%= i18n.noRRTboundToObject %></p>'}),define("text!stat/itemcard/tmpl/guardRow.html",[],function(){return'<tr data-id="<%= id %>">\n    <td><%- name %></td>\n    <td><%- person || \'--\' %></td>\n    <td class="col-phone"><%- phone || \'--\' %></td>\n    <td class="col-icon">\n        <i class="svg-icon svg-icon-remove icon-remove"></i>\n    </td>\n</tr>'}),define("text!stat/itemcard/tmpl/guardAddRow.html",[],function(){return'<tr>\n    <td>\n        <input type="text" name="q" autocomplete="off">\n    </td>\n    <td colspan="3"></td>\n</tr>'}),define("stat/itemcard/views/ItemCardGuardsView",["jquery","underscore","abstracts/View","text!../tmpl/guards.html","text!../tmpl/guardRow.html","text!../tmpl/guardAddRow.html"],function(e,t,n,a,s,i){a=t.template(a),s=t.template(s),i=t.template(i),n.prototype;var r=n.extend({constructor:function(){this.controller=null,this.parent=null,this.$table=null,this.$tbody=null,this.$addRow=null,this._guards=[],this._addedGuards=[],this._byId={},this._searchXHR=null,this._searchCache=[],n.apply(this,arguments)},initialize:function(e){var n=this;this.controller=e.controller,this.parent=e.parent,o.load.call(n).done(function(e){n._guards=e,n._byId=t.indexBy(e,"id"),n.render(),o.bindEvents.call(n)}).fail(function(){})},render:function(){this.$el.html(a({i18n:this.controller.getTexts(),showTable:this._guards.length>0})),this.$table=this.$el.find("table"),this.$tbody=this.$table.find("tbody"),this._guards.length>0&&o.renderRows.call(this)},save:function(){var n=new e.Deferred,a=this._guards,s=t.pluck(a,"id"),i=[],r=this.$tbody.find("tr"),o=[],l=t.pluck(this._addedGuards,"id"),d=[];return r.each(function(){i.push(e(this).data("id"))}),o=t.difference(s,i),o.length&&d.push(e.ajax({url:App.getBaseUrl()+"objects/obj-remove-guards/",data:{objectId:this.model.id,guardIds:o}}).done(function(){this._guards=a.filter(function(e){return o.indexOf(e.id)<0})}.bind(this))),l.length&&d.push(e.ajax({url:App.getBaseUrl()+"objects/obj-add-guards/",data:{objectId:this.model.id,guardIds:l}}).done(function(){this._guards=a.concat(this._addedGuards),this._addedGuards=[]}.bind(this))),d.length?n=e.when.apply(window,d):n.resolve(),n}}),o={load:function(){var t=this;return this.$el.addClass("loading"),e.ajax({url:App.getBaseUrl()+"objects/obj-guards/",data:{objectId:this.model.id}}).always(function(){t.$el.removeClass("loading")})},bindEvents:function(){var t=this;this.parent.on("addrow",function(e){"guard"==e&&o.addRow.call(t)}),this.$el.on("click",".icon-remove",function(){var n=e(this.closest("tr")),a=n.data("id");t._addedGuards=t._addedGuards.filter(function(e){return e.id!==a}),n.remove(),!t.$tbody.find("tr").length})},renderRows:function(){var e="";t.each(this._guards,function(t){e+=s(t)}),this.$tbody.html(e)},addRow:function(){var t=this,n=this._guards.length,a=this.controller.getTexts();if(this.$addRow)return this.$addRow.find("input").focus(),void 0;n||(this.$table.removeClass("hidden"),this.$table.siblings(".no-data").addClass("hidden")),this.$addRow=e(i({i18n:a})).appendTo(this.$tbody);var s=this.$addRow.find("input");s.autocomplete({minLength:2,appendTo:this.$el,source:function(n,a){var i=n.term;return i in t._searchCache?(a(t._searchCache[i]),void 0):(t._searchXHR=e.ajax({url:App.getBaseUrl()+"guards/guard-search/",data:{q:i},success:function(e,n,s){if(e.length){for(var r=[],o=0,l=e.length;l>o;o++)r[o]={id:e[o].id,label:e[o].name,value:e[o].name,guard:e[o]};t._searchCache[i]=r,s===t._searchXHR&&a(r)}},complete:function(){s.removeClass("ui-autocomplete-loading")}}),void 0)},select:function(e,n){o.onGuardSelected.call(t,n.item.guard)}}).focus()},onGuardSelected:function(t){this.$addRow.remove(),this.$addRow=null,this.$tbody.find("tr[data-id="+t.id+"]").length||(this._addedGuards.push(t),e(s(t)).appendTo(this.$tbody))}};return r}),define("text!stat/itemcard/tmpl/schedules.html",[],function(){return'<table class="table table-condensed arm-schedules<% if(!showTable) {%> hidden<% } %>">\n    <thead>\n        <th><%= i18n.armScheduleName %></th>\n        <th><%= i18n.armScheduleComment %></th>\n        <th>&nbsp;</th>\n        <th>&nbsp;</th>\n    </thead>\n    <tbody></tbody>\n</table>\n<p class="no-data<% if(showTable) {%> hidden<% } %>"><%= i18n.armSchedulesEmpty %></p>'}),define("text!stat/itemcard/tmpl/scheduleRow.html",[],function(){return'<tr data-uuid="<%= uuid %>">\n    <td class="col-name"><%- name %></td>\n    <td class="col-comment"><%- comment %></td>\n    <td class="col-icon">\n        <i class="svg-icon svg-icon-cog icon-edit" data-uuid="<%- uuid %>"></i>\n    </td><td class="col-icon">\n        <i class="svg-icon svg-icon-remove icon-remove" data-uuid="<%- uuid %>"></i>\n    </td>\n</tr>'}),define("text!stat/itemcard/tmpl/scheduleForm.html",[],function(){return'<div class="row-fluid">\n    <div class="control-group span6">\n        <label class="control-label"><%= i18n.armScheduleName %></label>\n        <div class="controls">\n            <input type="text" required class="input-block-level" name="name" value="<%- schedule.name %>" maxlength="50">\n        </div>\n    </div>\n    <div class="control-group span6">\n        <label class="control-label"><%= i18n.armScheduleComment %></label>\n        <div class="controls">\n            <input type="text" class="input-block-level" name="comment" value="<%- schedule.comment %>" maxlength="100">\n        </div>\n    </div>\n</div>\n\n<div class="arm-schedule">\n    <div class="arm-schedule-legend">\n        <span class="arm-schedule-legend-text"><%= i18n.armScheduleLegend %></span>\n    </div>\n    <ul class="arm-schedule-week">\n        <% _.each(days, function(dayName, dayIndex) {%>\n        <li class="arm-schedule-day">\n            <label class="arm-schedule-day-label<% if(dayIndex > 4) {%> weekend<% } %>">\n                <%= dayName %>\n            </label>\n            <ul class="arm-schedule-timeline">\n                <% _.each(hours, function(hour) {%>\n                <li class="arm-schedule-hour">\n                    <% if(dayIndex == 0) {%><label class="arm-schedule-hour-label"><%= hour.padLeft(2) %></label><% } %>\n                    <span class="arm-schedule-hour-half"\n                          data-arm="<%= ( dayIndex * 48 + hour * 2 ) in armPeriods ? 1 : 0 %>"\n                          data-value="<%= hour * 2 %>"></span>\n                    <span class="arm-schedule-hour-half"\n                          data-arm="<%= ( dayIndex * 48 + hour * 2 + 1 ) in armPeriods ? 1 : 0 %>"\n                          data-value="<%= hour * 2 + 1 %>"></span>\n                </li>\n                <% }) %>\n            </ul>\n        </li>\n        <% }) %>\n    </ul><!-- /arm-schedule-week -->\n    <div class="arm-schedule-tips">\n        <div class="arm-schedule-tip">\n            <span class="arm-schedule-hour-half" data-arm="1"></span>\n            <label class="arm-schedule-tip-label"><%= i18n.armScheduleMustBeArmed %></label>\n        </div>\n        <div class="arm-schedule-tip">\n            <span class="arm-schedule-hour-half" data-arm="0"></span>\n            <label class="arm-schedule-tip-label"><%= i18n.armScheduleMayBeDisarmed %></label>\n        </div>\n    </div>\n</div>\n\n<div class="control-group form-inline">\n    <label class="checkbox">\n        <input type="checkbox" name="allowDisarm"<% if(schedule.allowDisarm) {%> checked<% } %>>\n        <%= i18n.armScheduleAllowDisarmLabel %>\n    </label>\n    <span class="allow-disarm-time">\n        <input type="text" maxlength="5" placeholder="00:00"\n               class="input-time" name="allowDisarmPeriod" value="<%= allowDisarmHours %>:<%= allowDisarmMinutes %>"\n               <% if(!schedule.allowDisarm) {%> disabled<% } %>>\n    </span>\n</div>\n<div class="control-group form-inline">\n    <label class="checkbox">\n        <input type="checkbox" name="notArmedAlert"<% if(schedule.notArmedAlert) {%> checked<% } %>>\n        <%= i18n.armScheduleSendNotArmedAlert %>\n    </label>\n</div>\n<div class="control-group form-inline">\n    <label class="checkbox">\n        <input type="checkbox" name="earlyDisarmedAlert"<% if(schedule.earlyDisarmedAlert) {%> checked<% } %>>\n        <%= i18n.armScheduleSendEarlyDisarmedAlertAlert %>\n    </label>\n</div>'}),define("stat/itemcard/views/ItemCardSchedulesView",["jquery","underscore","jface","util","abstracts/View","text!../tmpl/schedules.html","text!../tmpl/scheduleRow.html","text!../tmpl/scheduleForm.html"],function(e,t,n,a,s,i,r,o){i=t.template(i),r=t.template(r),o=t.template(o);var l=s.prototype,d=s.extend({constructor:function(){this.controller=null,this.parent=null,this.$table=null,this.$tbody=null,this._ns=".armschedules",this._popup=null,this._curSchedule=null,this._dragging=null,s.apply(this,arguments)},initialize:function(e){var t=this;this.controller=e.controller,this.parent=e.parent,c.load.call(t).done(function(){t.render(),c.bindEvents.call(t)}).fail(function(){})},render:function(){var e=this.model.get("armSchedules");this.$el.html(i({i18n:this.controller.getTexts(),showTable:e.length>0})),this.$table=this.$el.find("table"),this.$tbody=this.$table.find("tbody"),e.length>0&&c.renderRows.call(this,e)},remove:function(){this._popup&&this._popup.trigger("jw.close"),e("body").off("mouseup"+this._ns),l.remove.apply(this,arguments)},getWeekKeys:function(){return["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY","SUNDAY"]},getCopySettingsFormLabel:function(){return this.controller.getTexts().armSchedulesCopyFormLabel},getCopySettingsObjectsType:function(){return App.TYPE_STAT},getSettingsToCopy:function(){return[this.model.ARM_SCHEDULE_TEMPLATES_KEY]},mergeSettingsBeingCopied:function(){return!0},getSettingsToCopyBak:function(){var e={};return e[this.model.ARM_SCHEDULE_TEMPLATES_KEY]=this.serializeArmSchedules(this.model.get("armSchedules")),e},onCopySettingsFormSubmit:function(e,t){var a=this.controller.getTexts();n.confirm(a.armSchedulesCopyConfirm,a.copy+"?",{okCallback:t})},onCopySettingsCancelled:function(){this.parent._removeCopySettingsView()},onCopySettingsDone:function(){this.parent._removeCopySettingsView()},onCopySettingsFail:function(e){this.showErrors(e)},serializeArmSchedules:function(e){return JSON.stringify(e)},deleteScheduleByUuid:function(e){var t=this.model.getAreasByScheduleUuid(e);if(t.length){var a=this,s=this.controller.getTexts();n.confirm(s.armScheduleDeleteConfirm,s.delete.ucFirst()+"?",{okCallback:function(){c.deleteSchedule.call(a,e)}})}else c.deleteSchedule.call(this,e)}}),c={load:function(){var t=new e.Deferred;return t.resolve(this.model.get("armSchedules"))},bindEvents:function(){var t=this;this.parent.on("addrow",function(e){"schedule"==e&&c.edit.call(t,{uuid:"",name:"",comment:"",allowDisarm:"",notArmedAlert:!0,earlyDisarmedAlert:!0,daysOfWeek:{}})}),this.$el.on("click",".icon-remove",function(){t.deleteScheduleByUuid(e(this).data("uuid"))}).on("click",".icon-edit",function(){var n=t.model.indexArmSchedulesByUuid(),a=e(this).data("uuid");c.edit.call(t,n[a])})},renderRows:function(e){var n="";t.each(e,function(e){n+=r(e)}),this.$tbody.html(n)},edit:function(e){var t=this,a=this.controller.getTexts();if(this._popup){if(this._curSchedule.uuid==e.uuid)return this._popup.trigger("jw.activate"),void 0;this._popup.trigger("jw.close")}n.showOverlay(),n.window.open({addClass:"arm-schedule-popup",headerHtml:e.uuid?e.name:a.armScheduleNew,contentHtml:c.getFormHtml.call(this,e),addForm:'<form method="post" action=""></form>',footerHtml:'<button type="submit" class="btn btn-primary">'+a.save+"</button>"+'<a href="javascript:;" class="btn jw-close">'+a.cancel.ucFirst()+"</a>",width:1030,centered:!0,dieAfter:0,openCallback:function(){t._popup=this,t._curSchedule=e,c.initForm.call(t,this.find("form"),e)},closeCallback:function(){t._curSchedule=null,n.hideOverlay()},dieCallback:function(){t._popup=null}})},getFormHtml:function(e){var n,a=this.controller.getTexts(),s=a.DateTime.dayNamesMin,i=s[0],r=e.daysOfWeek,l={},d=0,c=0,u=this.getWeekKeys(),m=0,h=0;if(s=s.slice(1).concat([i]),e.allowDisarm){var p=e.allowDisarm.split(":");d=parseInt(p[0]),c=parseInt(p[1]),(t.isNaN(d)||t.isNaN(c))&&(d=0,c=0,e.allowDisarm="")}return t.each(u,function(e){e in r&&(n=r[e],t.each(n,function(e){for(h=e[0];h<e[1];)l[48*m+h]=!0,h++})),m++}),o({i18n:a,days:s,hours:t.range(0,24),schedule:e,armPeriods:l,allowDisarmHours:d.padLeft(2),allowDisarmMinutes:c.padLeft(2)})},initForm:function(t){var n=this,a=t.find(".arm-schedule-week");a.on("mousedown",function(t){if(-1!=t.target.className.indexOf("hour-half")){var s=e(t.target),i=a.find(".arm-schedule-hour-half").not(t.target),r=parseInt(s.attr("data-arm"));n._dragging=1===r?0:1,s.attr("data-arm",n._dragging),i.on("mouseenter",function(){var t=e(this),a=parseInt(t.attr("data-arm"));a!=n._dragging&&t.attr("data-arm",n._dragging)}),e("body").one("mouseup"+n._ns,function(){n._dragging=null,i.off("mouseenter")})}}),e.mask.definitions.H="[0-2]",e.mask.definitions.h="[0-9]",e.mask.definitions.M="[0-5]",e.mask.definitions.m="[0-9]",t.find('[name="allowDisarmPeriod"]').mask("Hh:Mm"),t.find('input[name="allowDisarm"]').on("click",function(){t.find(".input-time").prop("disabled",!this.checked)}),t.on("submit",function(){return c.onSubmit.call(n,t),!1})},onSubmit:function(n){var s=this,i=!this._curSchedule.uuid,r=c.serializeForm.call(this,n);r.uuid=i?a.generateUUID():this._curSchedule.uuid,this._popup.addClass("loading");var o=this.model.get("armSchedules"),l=this.model.get("armSchedules").slice(0);if(i)l.push(r);else{var d=t.findWhere(l,{uuid:r.uuid});e.extend(d,r)}c.save.call(this,l).done(function(){i?(o.length||s.$table.removeClass("hidden").siblings(".no-data").addClass("hidden"),c.addRow.call(s,r)):c.updateRow.call(s,d),c.updateModelSchedules.call(s,l),s._popup.trigger("jw.close")}).fail(function(e){s.showErrors(e)}).always(function(){s._popup.removeClass("loading")})},serializeForm:function(n){var a,s,i,r={},o=n.serializeObject(),l=n.find(".arm-schedule-day"),d=this.getWeekKeys(),c={};if(r.name=e.trim(o.name),r.comment=e.trim(o.comment),r.notArmedAlert="notArmedAlert"in o,r.earlyDisarmedAlert="earlyDisarmedAlert"in o,r.allowDisarm="","allowDisarm"in o){var u=o.allowDisarmPeriod,m=u.split(":"),h=parseInt(m[0]),p=parseInt(m[1]);t.isNaN(h)&&(h=0),t.isNaN(p)&&(p=0),h=Math.min(h,23),p=Math.min(p,59),(h>0||p>0)&&(r.allowDisarm=h.padLeft(2)+":"+p.padLeft(2))}return l.each(function(t){s=[],i=null,a=e(this).find(".arm-schedule-hour-half"),a.each(function(t){1===parseInt(e(this).attr("data-arm"))?i||(i=[t,null]):i&&(i[1]=t,s.push(i),i=null)}),i&&(null===i[1]&&(i[1]=48),s.push(i)),s.length&&(c[d[t]]=s)}),r.daysOfWeek=c,r},save:function(e){var t={};return t[this.model.ARM_SCHEDULE_TEMPLATES_KEY]=this.serializeArmSchedules(e),c.makeSaveRequest.call(this,t)},makeSaveRequest:function(t){return e.ajax({url:App.getBaseUrl()+"objects/obj-settings-save/",data:{objectId:this.model.id,settings:t}})},addRow:function(e){this.$tbody.append(r(e))},updateRow:function(e){var t=this.$tbody.find('tr[data-uuid="'+e.uuid+'"]');t.find(".col-name").text(e.name),t.find(".col-comment").text(e.comment)},deleteSchedule:function(e){var n=this.model.indexArmSchedulesByUuid()[e];if(n){var a,s=this,i=this.model,r=t.without(i.get("armSchedules"),n),o=i.get("areas"),l=o.length,d={},u=[];if(d[i.ARM_SCHEDULE_TEMPLATES_KEY]=this.serializeArmSchedules(r),l){for(var m={};l--;)a=o[l],a.scheduleUuid!=e?m[a.id]=a.scheduleUuid:u.push(a);u.length&&(d[i.ARM_SCHEDULES_KEY]=JSON.stringify(m))}this.$el.addClass("loading"),c.makeSaveRequest.call(this,d).done(function(){c.onScheduleDeleted.call(s,e,r,u)}).fail(function(e){s.showErrors(e)}).always(function(){s.$el.removeClass("loading")})}},onScheduleDeleted:function(e,t,n){for(var a=n.length;a--;)n[a].scheduleUuid="";c.updateModelSchedules.call(this,t),c.deleteRow.call(this,e)},deleteRow:function(e){this.$tbody.find('tr[data-uuid="'+e+'"]').remove(),this.$tbody.find("tr").length||this.$table.addClass("hidden").siblings(".no-data").removeClass("hidden")},updateModelSchedules:function(e){this.model.set("armSchedules",e,{silent:!0}),this.model.trigger("change:armSchedules",this.model,e)}};return d}),define("text!stat/itemcard/tmpl/temperature.html",[],function(){return'<p class="no-data"><%= i18n.noSensorsAdded %></p>\n<table class="table table-condensed hidden">\n    <thead>\n        <th class="col-sensor-name"><%= i18n.temperatureSensor %></th>\n        <th class="col-sensor-zone"><%= i18n.numberZoneSensor %>  </th>\n        <th class="col-sensor-last-name"><%= i18n.nameSensor %></th>\n        <th class="col-sensor-note"><%= i18n.note %></th>\n        <th class="col-icon">&nbsp;</th>\n        <th class="col-icon">&nbsp;</th>\n        <th class="col-icon">&nbsp;</th>\n    </thead>\n    <tbody></tbody>\n</table>'}),define("text!stat/itemcard/tmpl/temperatureRow.html",[],function(){return'<tr data-index="<%= index %>">\n    <td class="col-sensor-name">\n        <select class="select-sensor-detector" name="cameraSource" >\n            <% _.each(optionsDetectors, function(option, i) {%>\n                <option value="<%= option.code %>"\n                    <% if(option.code === sensor.code) {%> selected<% } %>\n                    <% if(option.disabled) {%> disabled<% } %>\n                    >\n                    <%= option.detector %>\n                </option>\n            <% }) %>\n        </select>\n    </td>\n    <td class="col-sensor-zone">\n        <div class="itext">\n            <input type="text" name="sensorZone" value="<%= sensor.zone %>"  disabled maxlength="255"/>\n        </div>\n    </td>\n    <td class="col-sensor-last-name">\n        <div class="itext">\n            <input type="text" name="sensorName" value="<%= sensor.name %>"  autocomplete="off" maxlength="255"/>\n        </div>\n    </td>\n\n    <td class="col-sensor-note">\n        <div class="itext">\n            <input type="text" name="sensorNote" value="<%- sensor.note %>"  autocomplete="off" maxlength="255" />\n        </div>\n    </td>\n\n    <td class="col-icon">\n        <svg  class="svg-icon more-action-up">\n            <use xlink:href="#smb-chevron-right"></use>\n        </svg>\n    </td>\n    <td class="col-icon">\n        <svg  class="svg-icon more-action-down">\n            <use xlink:href="#smb-chevron-right"></use>\n        </svg>\n    </td>\n    <td class="col-icon">\n        <i  class="svg-icon svg-icon-remove icon-remove"></i>\n    </td>\n</tr>'}),define("stat/itemcard/views/StatItemCardTemperatureView",["jquery","jqueryui","jface","underscore","abstracts/View","text!../tmpl/temperature.html","text!../tmpl/temperatureRow.html","i18n!_common/nls/common"],function(e,t,n,a,s,i,r,o){i=a.template(i),r=a.template(r);var l="temperature",d=-128,c=s.prototype,u={"-1":o.temperatureSensorChangeHistory,"2-1":o.temperatureSensor1Wire+" 1","3-1":o.temperatureRadioSensorBuiltIn.replace("#n#","1"),"3-2":o.temperatureRadioSensorExternal.replace("#n#","1"),"4-1":o.temperatureRadioSensorBuiltIn.replace("#n#","2"),"4-2":o.temperatureRadioSensorExternal.replace("#n#","2"),"5-1":o.temperatureRadioSensorBuiltIn.replace("#n#","3"),"5-2":o.temperatureRadioSensorExternal.replace("#n#","3"),"6-1":o.temperatureRadioSensorBuiltIn.replace("#n#","4"),"6-2":o.temperatureRadioSensorExternal.replace("#n#","4"),"7-1":o.temperatureSensor1Wire+" 2","8-1":o.temperatureSensor1Wire+" 3","9-1":o.temperatureSensor1Wire+" 4","10-1":o.temperatureSensor1Wire+" 5","11-1":o.temperatureSensor1Wire+" 6","12-1":o.temperatureSensor1Wire+" 7","13-1":o.temperatureSensor1Wire+" 8","14-1":o.temperatureSensor1Wire+" 9","15-1":o.temperatureSensor1Wire+" 10"},m={"2-1":1,"3-1":31,"3-2":32,"4-1":33,"4-2":34,"5-1":35,"5-2":36,"6-1":37,"6-2":38,"7-1":2,"8-1":3,"9-1":4,"10-1":5,"11-1":6,"12-1":7,"13-1":8,"14-1":9,"15-1":10},h=s.extend({constructor:function(){this.controller=null,this.parent=null,this._tempDetectors=null,this.detectorsList=null,s.apply(this,arguments)},initialize:function(e){var t=this;this.controller=e.controller,this.parent=e.parent;var n=t.model.get("settings");t._tempDetectors=t.adapterDetectors(n.tempDetectors),p.load.call(t).done(function(){t.render(),t._bindEvents()}).fail(function(){}).always(function(){t.$el.removeClass("loading")})},adapterDetectors:function(e){if(!e)return[];try{var t=JSON.parse(e),n=[];return t.forEach(function(e){e.sensors.forEach(function(t){var a="-1"===e.num?e.num:e.num+"-"+t.num;n.push({position:t.position,detector:u[a]||a,zone:m[a],name:t.name,note:t.note||"",code:a})})}),n.sort(function(e,t){return e.position-t.position})}catch(a){return console.log("StatItemCardTemperatureView error",a),[]}},addSerializedData:function(e){if(this.validateRows(),this.$tbody.find(".error").length)return delete e.deviceControlOuts,e.errors=[{msg:this.controller.getTexts().errorInvalidParams}],void 0;var t={};return this._tempDetectors.forEach(function(e,n){var a=e.code&&"-1"!==e.code?e.code.split("-"):[],s=a[0]||"-1",i=a[1]||"-1";
t[s]=t[s]?t[s]:{num:s,sensors:[]},t[s].sensors.push({num:i,name:e.name,position:n,note:e.note})}),a.each(["sensorDetector","sensorZone","sensorName","sensorNote"],function(t){e[t]&&delete e[t]}),JSON.stringify(Object.values(t))},remove:function(){c.remove.apply(this,arguments)},render:function(){var e=this.controller.getTexts();this.$el.html(i({i18n:e})),this.$noData=this.$el.find(".no-data"),this.$table=this.$el.find("table"),this.$tbody=this.$el.find("tbody"),this.renderTable()},renderTable:function(){this.checkActiveDetectors(),this._renderRows(this._tempDetectors),this.validateRows()},addRow:function(){if(this._tempDetectors.length<this.detectorsList.length){var e=this._findVacantDetector();this._tempDetectors.push(e),this.renderTable()}},_bindEvents:function(){var t=this;this.$el.on("remove",function(){t.$el.off("remove"),t.$el.off("addrow"),t.remove()}).on("click",".icon-remove",function(){var n=e(this),a=n.closest("tr"),s=a.data("index");t._tempDetectors.splice(s,1),t.renderTable()}).on("click",".more-action-up",function(){var n=e(this),a=n.closest("tr"),s=a.data("index");t.__handleChangeDetectorNumber(s,-1)}).on("click",".more-action-down",function(){var n=e(this),a=n.closest("tr"),s=a.data("index");t.__handleChangeDetectorNumber(s,1)}).on("change","input",this._handleChangeDetectorInput.bind(this)).on("change","select",this._handleChangeDetectorSelect.bind(this)),t.parent.on("remove",function(){t.parent.off("remove"),t.parent.off("addrow")}).on("addrow",function(e){e===l&&t.addRow()})},_toggleTable:function(){var e=this._tempDetectors.length>0;this.$noData.toggleClass("hidden",e),this.$table.toggleClass("hidden",!e)},_renderRows:function(e){var t=e.length,n="";this._toggleTable();for(var a=0;t>a;++a)n+=this._renderRow(a,e[a]);this.$tbody.html(n)},_renderRow:function(e,t){var n=this.controller.getTexts();return r({index:e,sensor:t,optionsDetectors:this.detectorsList,i18n:n})},__handleChangeDetectorNumber:function(e,t){var n=e+t;if(!(0>n||n>this._tempDetectors.length-1)){var a=this._tempDetectors[e];this._tempDetectors.splice(e,1),this._tempDetectors.splice(n,0,a),this.renderTable()}},_handleChangeDetectorInput:function(t){t.stopPropagation();var n=e(t.target),a=n.closest("tr"),s=a.data("index"),i=n.attr("name"),r=n.val(),o=i.replace("sensor","").toLowerCase(),l=this._tempDetectors[s];l[o]=r,this.validateRows()},_handleChangeDetectorSelect:function(t){t.stopPropagation();var n=e(t.target),a=n.closest("tr"),s=a.data("index"),i=n.val(),r=this._tempDetectors[s];r.code=i,r.detector=u[i]||i,r.zone=m[i],this.renderTable()},_findVacantDetector:function(){var e,t=this._tempDetectors;return this.detectorsList.forEach(function(n){var a=t.findIndex(function(e){return e.code===n.code});e||-1!==a||(e=n.code)}),{position:t.length,detector:u[e]||e,zone:m[e],name:u[e]||e,note:"",code:e}},validateRows:function(){var t=this.$tbody.find("tr");this.$tbody.find(".error").removeClass("error"),t.each(function(){var t=e(this),n=t.find('input[name="sensorName"]'),a=String(n.val()).trim();a.length||n.parent().addClass("error")})},checkActiveDetectors:function(){var e=this._tempDetectors;this.detectorsList=this.detectorsList.map(function(t){return t.disabled=e.findIndex(function(e){return e.code===t.code})>-1,t})}}),p={load:function(){var t=this,n=new e.Deferred,a=t.model.get("id");return"undefined"==typeof a?(n.resolve(),n):(t.$el.addClass("loading"),e.when(e.ajax({url:App.getBaseUrl()+"objects/temperature/",data:{objectId:a}})).done(function(e){t.detectorsList=p.adapterTemperature(e),n.resolve()}).fail(function(){n.reject.apply(n,arguments)}).always(function(){t.$el.removeClass("loading")}),n)},adapterTemperature:function(e){var t=[{code:"-1",detector:u["-1"]}];return a.each(e,function(e,n){"1"!==n&&a.each(e,function(e,a){var s=n+"-"+a;e!==d&&t.push({code:s,detector:u[s]||s})})}),t}};return h}),define("text!stat/itemcard/tmpl/infoEditable.html",[],function(){return'<input type="hidden" value="<%= App.TYPE_STAT %>" name="objType">\n<table class="l">\n    <tr>\n        <td class="col">\n            <div class="field">\n                <label><%= i18n.objName %></label>\n                <div class="itext"><input type="text" name="name" value="<%- item.name %>" maxlength="255" /></div>\n            </div>\n            <div class="field" style="height: 4.2em">\n                <label><%= i18n.description %></label>\n                <div class="itext">\n                    <textarea name="shortDescription" maxlength="140" style="height: 3.8em"><%- settings.shortDescription %></textarea>\n                </div>\n            </div>\n            <div class="field">\n                <label><%= i18n.country %></label>\n                <div class="itext"><input type="text" name="Country" value="<%- settings.Country %>" maxlength="100" class="autocomplete" /></div>\n            </div><div class="field">\n                <label><%= i18n.region %></label>\n                <div class="itext"><input type="text" name="Region" value="<%- settings.Region %>" maxlength="100" class="autocomplete" /></div>\n            </div><div class="field">\n                <label><%= i18n.city %></label>\n                <div class="itext"><input type="text" name="City" value="<%- settings.City %>" maxlength="100" class="autocomplete" /></div>\n            </div><div class="field">\n                <label><%= i18n.street %></label>\n                <div class="itext"><input type="text" name="Street" value="<%- settings.Street %>" maxlength="100" class="autocomplete" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.house %> / <%= i18n.building %></label>\n                <div class="form-horizontal itext">\n                    <input type="text" name="House" class="input-medium" value="<%- settings.House %>" maxlength="100" autocomplete="off" /><span class="sep">/</span><input type="text" name="Building" class="input-medium" value="<%- settings.Building %>" maxlength="100" autocomplete="off" />\n                </div>\n            </div><div class="field">\n                <label><%= i18n.gateCode %></label>\n                <div class="itext"><input type="text" name="GateCode" value="<%- settings.GateCode %>" maxlength="100" autocomplete="off" /></div>\n            </div><div class="field">\n                <label><%= i18n.intercomCode %></label>\n                <div class="itext"><input type="text" name="IntercomCode" value="<%- settings.IntercomCode %>" maxlength="100" autocomplete="off" /></div>\n            </div><div class="field">\n                <label><%= i18n.appartment %></label>\n                <div class="itext"><input type="text" name="AppNumber" value="<%- settings.AppNumber %>" maxlength="100" autocomplete="off" /></div>\n            </div><div class="field">\n                <label><%= i18n.objEquipmentIds %></label>\n                <div class="itext">\n                    <input type="text" name="equipmentIds"\n                           value="<%- settings.equipmentIds ? JSON.parse(settings.equipmentIds).join(\', \') : \'\' %>"\n                           maxlength="1024" autocomplete="off" />\n                </div>\n            </div>\n        </td>\n\n        <td class="col">\n            <%= col2Html %>\n        </td>\n\n        <td rowspan="2" class="col" style="width:150px">\n            <div class="img-block">\n                <img<% if(!imgPath) {%> style="display:none"<% } %> src="<% if(imgPath) {%><%= imgPath %><% } %>" alt="" />\n                <a class="change-img" href="javascript:;"><% if(imgPath) { print(i18n.changeImage) } else { print(i18n.chooseImage) } %></a>\n            </div>\n\n            <%= htmlStatus %>\n        </td>\n    </tr>\n    <tr>\n        <td colspan="2">\n            <div class="field textarea text-large no-margin">\n                <label><%= i18n.comments.ucFirst() %></label>\n                <textarea class="hidden" maxlength="2048" rows="" cols="" name="DESCRIPTION"><%- settings.DESCRIPTION %></textarea>\n                <div class="editable">\n                    <div class="value"><%= description %></div>\n                    <div class="edit">\n                        <i class="svg-icon svg-icon-pencil"></i>\n                    </div>\n                </div>\n            </div>\n        </td>\n    </tr>\n</table>'}),define("text!abstracts/itemcard/tmpl/infoEditableCol2.html",[],function(){return'<div class="field">\n    <label><%= i18n.objOwner %></label>\n    <div class="itext"><input type="text" name="VRC_OWNER" value="<%- settings.VRC_OWNER %>" maxlength="255" /></div>\n</div>\n<div class="field">\n    <label><%= i18n.phone.ucFirst() %> 1</label>\n    <div class="itext"><input type="text" name="PHONE1" value="<%- settings.PHONE1 %>" maxlength="20" /></div>\n</div>\n<div class="field">\n    <label><%= i18n.phone.ucFirst() %> 2</label>\n    <div class="itext"><input type="text" name="PHONE2" value="<%- settings.PHONE2 %>" maxlength="20" /></div>\n</div>\n<div class="field">\n    <label><%= i18n.objOwnerPass %></label>\n    <div class="itext"><input type="text" name="OwnerPassword" value="<%- settings.OwnerPassword %>" maxlength="50" /></div>\n</div>\n<div class="field">\n    <label><%= i18n.objContract %></label>\n    <div class="itext"><input type="text" name="ContractNumber" value="<%- settings.ContractNumber %>" maxlength="20" /></div>\n</div>\n<div class="field">\n    <label><%= i18n.objContractDate %></label>\n    <div class="itext">\n        <input type="text" name="ContractDate" value="<%- settings.ContractDate %>" maxlength="20" class="datepicker" />\n    </div>\n</div>\n<div class="item-groups objs-groups clearfix">\n    <h5><%= i18n.groups.ucFirst() %></h5>\n    <div class="list">\n        <% if(objsGroups && objsGroups.length && tmplGroup) {\n        var sep = \'\';\n        _.each(objsGroups, function(group){\n        if(App.allowed(\'objectgroups.edit\')) {\n        print(tmplGroup(group));\n        } else {\n        print(sep + group.name);\n        sep = \', \';\n        }\n        })%>\n        <% } %>\n        <div class="clear"></div>\n    </div>\n    <% if(App.allowed(\'objectgroups.edit\')) { %>\n    <input type="text" style="display:none" disabled="disabled" class="itext autocomplete" value="" name="add_objs_group_name" maxlength="50" />\n    <div class="btn btn-add btn-small" title="<%= i18n.addGroup %>"><i class="add-obj-group-link icon-plus"></i></div>\n    <% } %>\n</div><!--/objs-groups-->'}),define("text!abstracts/itemcard/tmpl/hardwareEditable.html",[],function(){return'<table class="l">\n    <tr>\n        <td class="col">\n\n            <div class="field">\n                <label>IMEI</label>\n                <div class="itext">\n                    <input type="text" name="imei" value="<%- imei %>" maxlength="16" class="integer" autocomplete="off" />\n                </div>\n            </div>\n\n            <% if(\'undefined\' != typeof hardwareTypes) {%>\n            <div class="field">\n                <label><%= i18n.objHardwareType %></label>\n                <div class="select">\n                    <% if(hardwareTypes) {%><select name="objectTypeId">\n                        <option value="0"><%= i18n.objHardwareUnknown %></option>\n                    <% _.each(hardwareTypes, function(type) {%>\n                        <option value="<%= type.id %>"<% if(\'undefined\' != typeof item.deviceTypeId && item.deviceTypeId == type.id) {%> selected<% } %>>\n                            <%= type.name %>\n                        </option>\n                    <% }) %>\n                    </select><% } else { %>\n                        <%= deviceTypeName %>\n                    <% } %>\n                </div>\n            </div>\n            <% } %>\n\n            <!--<div class="field">\n                <label><%= i18n.simCard %> 1</label>\n                <div class="itext"><input type="text" name="SIM" value="<%- settings.SIM %>" maxlength="20" autocomplete="off" /></div>\n            </div><div class="field">\n                <label><%= i18n.simCard %> 2</label>\n                <div class="itext"><input type="text" name="SIM2" value="<%- settings.SIM2 %>" maxlength="20" autocomplete="off" /></div>\n            </div>-->\n\n            <div class="field">\n                <label><%= i18n.simCard %> 1</label>\n                <div class="form-horizontal itext row-fluid">\n                    <div class="span4">\n                        <input type="text" name="SIM" value="<%- settings.SIM %>" maxlength="20" autocomplete="off">\n                    </div>\n                    <div class="span3 text-right"><%= i18n.gsmProvider %></div>\n                    <div class="span5">\n                        <input class="autocomplete" type="text" name="sim1Provider" value="<%- settings.sim1Provider %>" maxlength="50" autocomplete="off">\n                    </div>\n                </div>\n            </div><div class="field">\n                <label><%= i18n.simCard %> 2</label>\n                <div class="form-horizontal itext row-fluid">\n                    <div class="span4">\n                        <input type="text" name="SIM2" value="<%- settings.SIM2 %>" maxlength="20" autocomplete="off">\n                    </div>\n                    <div class="span3 text-right"><%= i18n.gsmProvider %></div>\n                    <div class="span5">\n                        <input class="autocomplete" type="text" name="sim2Provider" value="<%- settings.sim2Provider %>" maxlength="50" autocomplete="off">\n                    </div>\n                </div>\n            </div>\n\n\n            <div class="field">\n                <label><%= i18n.password.ucFirst() %></label>\n                <div class="itext"><input type="text" name="PASS" value="<%- settings.PASS %>" maxlength="255" /></div>\n            </div><div class="field">\n                <label><%= i18n.placeInstall %></label>\n                <div class="itext"><input type="text" name="InstallPlace" value="<%- settings.InstallPlace %>" maxlength="255" /></div>\n            </div><div class="field">\n                <label><%= i18n.dateInstall %></label>\n                <div class="itext"><input type="text" name="InstallDate" value="<%- settings.InstallDate %>" maxlength="50" class="datepicker" /></div>\n            </div><div class="field">\n                <label><%= i18n.installer %></label>\n                <div class="itext"><input type="text" name="Installer" value="<%- settings.Installer %>" maxlength="100" /></div>\n            </div>\n        </td>\n\n        <td class="col">\n            <div class="device-img">\n                <img src="<%= deviceImg %>" alt="">\n                <p class="no-margin">\n                    <span class="device-name"><%= deviceTypeName %></span>\n                    <% if(deviceFirmware) {%>\n                        <span style="margin:0 5px"><%= deviceFirmware %></span>\n                    <% } %>\n                    <% if(firmwareUpdateAvailable) {%>\n                        <a class="device-command update-command"\n                           data-status="<%= updateStatus.status %>"\n                           data-command="<%= updateStatus.cmd %>" href="javascript:;" >\n                            <%= updateStatus.txt %>\n                        </a>\n                    <% } %>\n                </p>\n\n                <% if(shellSetupAvailable) {%>\n                <p class="no-margin">\n                    <a class="device-command setup" href="javascript:;" ><%= i18n.setupDevice %></a>\n                </p>\n                <% } %>\n            </div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan="2">\n            <div class="field textarea large text-large no-margin">\n                <label><%= i18n.objExtraHardware %></label>\n                <textarea class="hidden" maxlength="2048" rows="" cols="" name="ExtraHardware"><%- settings.ExtraHardware %></textarea>\n                <div class="editable">\n                    <div class="value"><%= extraHardware %></div>\n                    <div class="edit">\n                        <i class="svg-icon svg-icon-pencil"></i>\n                    </div>\n                </div>\n            </div>\n        </td>\n    </tr>\n</table>'}),define("text!stat/itemcard/tmpl/areasEditable.html",[],function(){return'<table class="table table-condensed areas <% if (!areas.length) { %> hidden<% } %>">\n    <thead>\n    <tr>\n        <th><%= i18n.objAreaNum %></th>\n        <th><%= i18n.objAreaName %></th>\n        <th class="col-arm-schedule"><%= i18n.armSchedule %></th>\n        <% if(allowRoles){ %>\n        <th class="col-roles"><%= i18n.rolesForAreas %></th>\n        <% } %>\n        <th><%= i18n.objAreaComment %></th>\n        <th></th>\n    </tr>\n    </thead>\n    <tbody>\n    <% _.each(areas, function(area, index){ %>\n    <tr>\n        <td class="col-num">\n            <input name="aId[]" type="hidden" value="<%- area.id %>">\n            <div class="itext">\n                <input name="aNum[]" type="text" value="<%- area.num %>" maxlength="2" autocomplete="off">\n            </div>\n        </td>\n        <td>\n            <div class="itext"><input name="aName[]" type="text" value="<%- area.name %>" maxlength="100"></div>\n        </td>\n        <td class="col-arm-schedule">\n            <select name="aScheduleUuid[]"></select>\n        </td>\n        <% if(allowRoles){ %>\n        <td class="col-roles">\n            <select name="aRoles"\n                    class="input-block-level"\n                    data-id="<%= area.id %>"\n                    data-placeholder="<%= i18n.rolesForAreasAll %>"\n                    multiple>\n            </select>\n        </td>\n        <% } %>\n        <td>\n            <div class="itext"><input name="aComment[]" type="text" value="<%- area.comment %>" maxlength="100"></div>\n        </td>\n        <td class="col-icon">\n            <i class="svg-icon svg-icon-remove row-remove"></i>\n        </td>\n    </tr>\n    <% }) %>\n    </tbody>\n</table>\n\n<p class="no-data<% if (areas.length) { %> hidden<% } %>">\n    <%= i18n.noObjAreas %>\n</p>'}),define("text!stat/itemcard/tmpl/rowArea.html",[],function(){return'<tr>\n    <td class="col-num">\n        <input name="aId[]" type="hidden" value="0">\n        <div class="itext"><input name="aNum[]" type="text" value="" maxlength="2" autocomplete="off"></div>\n    </td>\n    <td>\n        <div class="itext"><input name="aName[]" type="text" value="" maxlength="100"></div>\n    </td>\n    <td class="col-arm-schedule">\n        <select name="aScheduleUuid[]"></select>\n    </td>\n    <% if(allowRoles){ %>\n    <td class="col-roles">\n        <select name="aRoles"\n                class="input-block-level"\n                data-id="0"\n                data-placeholder="<%= i18n.rolesForAreasAll %>"\n                multiple>\n        </select>\n    </td>\n    <% } %>\n    <td>\n        <div class="itext"><input name="aComment[]" type="text" value="" maxlength="100"></div>\n    </td>\n    <td class="col-icon">\n        <i class="svg-icon svg-icon-remove row-remove"></i>\n    </td>\n</tr>'}),define("text!stat/itemcard/tmpl/zonesEditable.html",[],function(){return'<table class="table table-condensed zones <% if (!zones.length) { %> hidden<% } %>">\n    <thead>\n    <tr>\n        <th><%= i18n.objZoneNum %></th>\n        <th><%= i18n.objArea %></th>\n        <th><%= i18n.objZoneName %></th>\n        <th><%= i18n.objZoneComment %></th>\n        <th></th>\n    </tr>\n    </thead>\n    <tbody>\n    <% _.each(zones, function(zone, index){ %>\n    <tr>\n        <td class="col-num">\n            <div class="itext">\n                <input name="zNum[]" type="text" value="<%- zone.num %>" maxlength="3" autocomplete="off">\n            </div>\n        </td>\n        <td>\n            <input type="hidden" name="zId[]" value="<%= zone.id %>">\n            <select name="zAreaId[]">\n                <% _.each(areas, function(area){ %>\n                <option value="<%- area.id %>"<% if(area.id == zone.areaId) {%> selected<% } %>>\n                    <%- area.name ? area.name : i18n.objArea + \' \' + area.num %>\n                </option>\n                <% }) %>\n            </select>\n        </td>\n        <td>\n            <div class="itext"><input name="zName[]" type="text" value="<%- zone.name %>" maxlength="100"></div>\n        </td>\n        <td>\n            <div class="itext"><input name="zComment[]" type="text" value="<%- zone.comment %>" maxlength="100"></div>\n        </td>\n        <td class="col-icon">\n            <i class="svg-icon svg-icon-remove row-remove"></i>\n        </td>\n    </tr>\n    <% }) %>\n    </tbody>\n</table>\n\n<p class="no-data<% if (zones.length) { %> hidden<% } %>">\n    <%= i18n.noObjZones %>\n</p>'}),define("text!stat/itemcard/tmpl/rowZone.html",[],function(){return'<tr>\n    <td class="col-num">\n        <div class="itext"><input name="zNum[]" type="text" value="" maxlength="3" autocomplete="off"></div>\n    </td>\n    <td>\n        <input type="hidden" name="zId[]" value="0">\n        <select name="zAreaId[]">\n            <% _.each(areas, function(area){ %>\n            <option value="<%- area.id %>"><%- area.name %></option>\n            <% }) %>\n        </select>\n    </td>\n    <td>\n        <div class="itext"><input name="zName[]" type="text" value="" maxlength="100"></div>\n    </td>\n    <td>\n        <div class="itext"><input name="zComment[]" type="text" value="" maxlength="100"></div>\n    </td>\n    <td class="col-icon">\n        <i class="svg-icon svg-icon-remove row-remove"></i>\n    </td>\n</tr>'}),define("text!abstracts/itemcard/tmpl/responsibleEditable.html",[],function(){return'<table class="l" style="width:60%">\n    <tr>\n        <td class="col">\n            <div class="field">\n                <label><%= i18n.responsible.pass1 %></label>\n                <div class="itext"><input maxlength="20" class="password" name="pass1" type="text" value="<%= responsible.pass1 %>"></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.responsible.pass2 %></label>\n                <div class="itext"><input maxlength="20" class="password" name="pass2" type="text" value="<%= responsible.pass2 %>"></div>\n            </div>\n        </td>\n    </tr>\n</table>\n\n<table class="table table-condensed persons<% if (!responsible.persons || !responsible.persons.length) { %> hidden<% } %>">\n    <thead>\n        <tr>\n            <th><%= i18n.responsible.persons.key %></th>\n            <th><%= i18n.responsible.persons.name %></th>\n            <th><%= i18n.responsible.persons.phone1 %></th>\n            <th><%= i18n.responsible.persons.phone2 %></th>\n            <th><%= i18n.responsible.persons.comment %></th>\n            <th></th>\n            <th></th>\n            <th></th>\n        </tr>\n    </thead>\n    <tbody>\n        <% if (responsible.persons && responsible.persons.length) { %>\n        <% _.each(responsible.persons, function(person, index){ %>\n        <tr class="AddNewPersonRow" data-index="<%= index %>">\n            <td class="col-num">\n                <div class="itext"><input class="_key text-center" name="_key" type="text" value="<%- person.key %>" maxlength="20"></div>\n            </td>\n            <td><div class="itext"><input class="_name" name="_name" type="text" value="<%- person.name %>" maxlength="70"></div></td>\n            <td class="col-phone"><div class="itext"><input class="_phone1" name="_phone1" type="text" value="<%- person.phone1 %>" maxlength="17"></div></td>\n            <td class="col-phone"><div class="itext"><input class="_phone2" name="_phone2" type="text" value="<%- person.phone2 %>" maxlength="17"></div></td>\n            <td><div class="itext"><input class="_comment" name="_comment" type="text" value="<%- person.comment %>" maxlength="95"></div></td>\n            <td class="col-icon">\n                <i class="svg-icon svg-icon-chevron-up personUp"></i>\n            </td>\n            <td class="col-icon">\n                <i class="svg-icon svg-icon-chevron-down personDown"></i>\n            </td>\n            <td class="col-icon">\n                <i class="svg-icon svg-icon-remove personRemove"></i>\n            </td>\n        </tr>\n        <% }) %>\n        <% } %>\n    </tbody>\n</table>\n\n<p class="no-data<% if (responsible.persons && responsible.persons.length) { %> hidden<% } %>">\n    <%= i18n.responsible.persons.noData %>\n</p>'}),define("stat/itemcard/views/StatItemCardEditableView",["jquery","underscore","jqueryui","jface","./StatItemCardView","_common/stat/faults/views/FaultsView","abstracts/itemcard/views/CopySettingsView","./ItemCardGuardsView","./ItemCardSchedulesView","./StatItemCardTemperatureView","text!../tmpl/wrapper.html","text!_common/tmpl/modelTag.html","text!../tmpl/infoEditable.html","text!abstracts/itemcard/tmpl/infoEditableCol2.html","text!abstracts/itemcard/tmpl/hardwareEditable.html","text!../tmpl/areasEditable.html","text!../tmpl/rowArea.html","text!../tmpl/zonesEditable.html","text!../tmpl/rowZone.html","text!_common/abstracts/itemcard/tmpl/pictures.html","text!abstracts/itemcard/tmpl/responsibleEditable.html"],function(e,t,n,a,s,i,r,o,l,d,c,u,m,h,p,g,f,v,b,y,w){var c=t.template(c),u=t.template(u),m=t.template(m),h=t.template(h),p=t.template(p),g=t.template(g),f=t.template(f),v=t.template(v),b=t.template(b),y=t.template(y),w=t.template(w),x=50,_={"default":null,sberbank:null},S=99,A=999,C=s.extend({constructor:function(){this._faultsView=null,this._guardsView=null,this._schedulesView=null,this._alertControlView=null,s.apply(this,arguments)},initialize:function(e){if(this._getDeviceFirmware())s.prototype.initialize.apply(this,arguments);else{var t=this,n=e.module.getHardwareTypes();n?s.prototype.initialize.apply(this,arguments):(showCursor(),e.module.loadHardwareTypes().done(function(){t.initialize(e)}).fail(function(){n=null}).always(hideCursor))}},render:function(){var n=this,s=this.module.getHardwareTypes(),i=this.model.get("settings"),r=this.module.getTexts(),o="",l="",d="",g="",f=this.model.get("item"),v=this.model.get("device"),b=this._getUpdateStatus();this.listenTo(this.model,"imagechange",function(e){n.$el.find(".img-block img").attr("src",n._getImgDir()+e.img+n._getImgExt())}).listenTo(this.model,"change:areas",function(e,t){j.onAreasChanged.call(n,t)}).listenTo(this.model,"change:zones",function(e,t){j.renderZones.call(n,t)}).listenTo(this.model,"change:armSchedules",function(e,t){j.renderArmScheduleSelects.call(n,t)});var x=t.extend({},this.model.attributes,{i18n:r,imei:this._getDeviceImei(),deviceImg:this._getDeviceImage(),deviceTypeName:this._getDeviceTypeName(),deviceFirmware:this._getDeviceFirmware()});o=m(t.extend({},x,{col2Html:h(t.extend({},x,{tmplGroup:u})),imgPath:this.model.getImagePath(),htmlStatus:this._renderStatus(),description:this._prepareEditableText(x.settings.DESCRIPTION)})),l=p(t.extend({},x,{hardwareTypes:s,shellSetupAvailable:App.allowed("objects.shell")&&"canSetup"in x&&x.canSetup,firmwareUpdateAvailable:App.allowed("objects.shell")&&b,extraHardware:this._prepareEditableText(x.settings.ExtraHardware),updateStatus:b})),d=y(x);var _=null;try{_=e.parseJSON(i.RESPONSIVE_PERSONS)}catch(S){}g=w({i18n:r,responsible:_||{persons:[],pass1:"",pass2:""}});var A=c({editable:!0,i18n:r,htmlInfo:o,htmlHardware:l,htmlAreas:"",htmlZones:"",htmlPictures:d,htmlResponsible:g});a.showOverlay(),a.window.open(t.extend(this._getWindowParams(f,A),{addClass:"item-card obj-card editable",headerHtml:f.name+" (#"+f.extId+")",addForm:'<form method="post" action=""></form>',footerHtml:'<a href="javascript:;" class="btn btn-apply">'+r.apply+"</a>"+'<button type="submit" class="btn btn-primary">'+r.save+"</button>"+'<a href="javascript:;" class="btn jw-close">'+r.cancel.ucFirst()+"</a>",width:1150,minWidth:1150,maxHeight:600,openCallback:function(){var a=this;if(n.setElement(this),a.find(".nav-tabs a[data-key]").on("shown.bs.tab",function(){n.$el.find(".card-extra-action").remove()}),n._activateExport(),n._activateTextareas(),n._activateSetup(),n._activateUpdate(),n._activateCommonDates(),setTimeout(function(){n._activateAutocompletes()},100),n._activateGroups(),n._activateImageChange(),n._activatePictures(),n._activateResponsible(),n._activateArmSchedules(),n._activateAlertsControl(),n._activateAreasAndZones(),n._activateControls(),n._activateGuards(),n._activateNotifications(),n._activateCameras(),n._activateTemperature(),n._activateChangesHistory(),n._activateObjStatus(),n._limitInputs(),s){var i=a.find(".device-img img"),r=a.find(".device-name"),o=n.model.get("item"),l=o.deviceTypeId||null;l&&n._setImgSrcByDeviceTypeId(i[0],l,null),a.find("select[name=objectTypeId]").on("change",function(){var a=parseInt(e(this).val()),o=t.findWhere(s,{id:a});n._setImgSrcByDeviceTypeId(i[0],a,v.firmware),r.text(o&&o.name||"Unknown")})}n._activateSubmit()},activateCallback:function(){n._onActivate()},closeCallback:function(){n._onClose()},dieCallback:function(){n.remove()}}))},_activateTemperature:function(){var e=this,t=this.$el.find(".temperature-section"),n=function(e){var t=e.$el.find(".jw-footer-content"),n=e.module.getTexts();t.find(".card-extra-action").remove(),t.prepend('<a href="javascript:;" class="card-extra-action add-row" data-key="temperature">'+n.addTemperatureSensor+"</a>")};this.$el.find(".nav-tabs a[data-key=temperature]").one("shown.bs.tab",function(){e._temperatureView=new d({controller:e.module,parent:e,model:e.model,el:t})}).on("shown.bs.tab",function(){n(e)})},_setImgSrcByDeviceTypeId:function(e,n,a){var s=this.module.getHardwareTypes(),i=t.findWhere(s,{id:n});e.src=this._getDeviceImageByCodeAndRev(i&&i.code||"Unknown",a)},_getSpriteImages:function(){return _},_getImgHeight:function(){return x},_activateAreasAndZones:function(){var e=this,t=this.module.getTexts();j.renderAreas.call(this,this.model.get("areas")),j.renderZones.call(this,this.model.get("zones")),this.on("addrow",function(t){return("area"==t||"zone"==t)&&j.addAreaOrZone.call(e,t+"s"),!1}),this.$el.find(".col-num input").numeric({decimal:!1,negative:!1}),this.$el.find(".nav-tabs a[data-key=areas]").on("shown.bs.tab",function(){e.$el.find(".jw-footer-content").prepend('<a href="#" data-key="area" class="card-extra-action add-row">'+t.addObjArea+"</a>")}),this.$el.find(".nav-tabs a[data-key=zones]").on("shown.bs.tab",function(){e.$el.find(".jw-footer-content").prepend('<a href="#" data-key="zone" class="card-extra-action add-row">'+t.addObjZone+"</a>")}),this.$el.find(".nav-tabs a[data-key=controls]").on("shown.bs.tab",function(){e.$el.find(".jw-footer-content").prepend('<a href="#" data-key="control" class="card-extra-action add-row">'+t.addDeviceOut+"</a>")})},_activateArmSchedules:function(){var t=this,n=this.module.getTexts(),a=this.$el.find(".nav-tabs a[data-key=schedules]"),s=this.$el.find(".schedules-section");a.one("shown.bs.tab",function(){t._schedulesView=new l({controller:t.module,parent:t,model:t.model,el:s})}).on("shown.bs.tab",function(){s.trigger("shown"),t.$el.find(".jw-footer-content").prepend('<a href="#" data-key="schedule" class="card-extra-action add-row">'+n.armScheduleCreate+"</a>"+'<a href="#" class="card-extra-action copy-arm-schedules">'+n.armSchedulesCopy+"</a>")}).on("hidden.bs.tab",function(){s.trigger("hidden"),t._removeCopySettingsView()}),this.$el.on("click",".copy-arm-schedules",function(){!t._copySettingsView&&t._schedulesView&&(t._copySettingsView=new r({parent:t,controller:t.module,model:t.model,settingsProvider:t._schedulesView,el:e("<div/>").appendTo(t.$el)}))})},_activateGuards:function(){var e=this,t=this.module.getTexts(),n=this.$el.find(".nav-tabs a[data-key=guards]"),a=this.$el.find(".guards-section");n.one("shown.bs.tab",function(){e._guardsView=new o({controller:e.module,parent:e,model:e.model,el:a})}).on("shown.bs.tab",function(){a.trigger("shown"),e.$el.find(".jw-footer-content").prepend('<a href="#" data-key="guard" class="card-extra-action add-row">'+t.addRRT+"</a>")
}).on("hidden.bs.tab",function(){a.trigger("hidden")})},_processAndValidateData:function(t){var n=this,a=new e.Deferred;return j.processAreasAndZones.call(this,t),j.processEquipmentIds.call(this,t),t.scode=App.modules.maps.getMap().scode,s.prototype._processAndValidateData.call(n,t).fail(function(e){a.reject(e)}).done(function(){a.resolve()}),a},_executeRequests:function(){return e.when(s.prototype._executeRequests.apply(this,arguments),this._saveBoundGuards())},_saveBoundGuards:function(){var t=new e.Deferred;return this._guardsView?t=this._guardsView.save():t.resolve(),t},_onClose:function(){try{this._faultsView&&this._faultsView.remove()}catch(e){}this._faultsView=null,this._schedulesView&&this._schedulesView.remove(),this._alertControlView&&this._alertControlView.remove(),s.prototype._onClose.apply(this,arguments)}}),j={renderAreas:function(e){var t=this.$el.find(".nav-tabs a[data-key=areas]"),n=this.$el.find(".areas-section");this.module.loadRoles().done(function(a){if(n.html(g({i18n:this.module.getTexts(),areas:e,allowRoles:a.length>0})),j.renderArmScheduleSelects.call(this,this.model.get("armSchedules")),a.length>0){var s=this.$el.find("select[name^=aRoles]");j.renderAreaRolesSelects.call(this,a,s),t.on("shown.bs.tab",function(){s.trigger("chosen:updated")})}}.bind(this))},getAreaRolesOptions:function(e,n){var a="",s=!1;return t.each(n,function(n){s=e.findIndex(function(e){return e.id===n.id})>-1,a+='<option value="'+n.code+'"'+(s?" selected":"")+">"+t.escape(n.name)+" ("+t.escape(n.code)+")"+"</option>"}),t.each(e,function(e){var s=n.findIndex(function(t){return e.id===t.id})>-1;s||(a+='<option value="'+e.code+'" selected>'+t.escape(e.name)+" ("+t.escape(e.code)+")"+"</option>")}),a},renderAreaRolesSelects:function(t,n){var a=this,s=this.model.get("areas");n.each(function(){var n=e(this),i=n.data("id"),r=s.find(function(e){return e.id===i}),o=j.getAreaRolesOptions.call(a,r?r.roles||[]:[],t);n.html(o)}),n.chosen({disable_search:!0})},renderZones:function(e){var t=v({i18n:this.module.getTexts(),zones:e,areas:this.model.get("areas")});this.$el.find(".zones-section").html(t)},onAreasChanged:function(n){j.renderAreas.call(this,n);var a="";t.each(n,function(e){a+='<option value="'+e.id+'">'+t.escape(e.name)+"</option>"}),this.$el.find("select[name^=zAreaId]").each(function(){var t=e(this),n=t.val();t.html(a),n&&t.find("[value="+n+"]").prop("selected",!0)})},addAreaOrZone:function(n){var a=this.$el.find("table."+n),s=a.find("tbody tr").not(".subtable").length,i="areas"==n?S:A,r=this.module.getTexts();if(!("zones"!=n||this.model.get("areas")&&this.model.get("areas").length))return alert(r.canNotAddObjZone,r.attention);if(s||(a.removeClass("hidden"),a.siblings(".no-data").addClass("hidden")),i>s){var o,l=a.find("tbody tr").not(".subtable").last(),d=this.model.get("areas").slice(0),c=1;t.map(d,function(e){e.name||(e.name=r.objArea+" "+e.num)}),l.length&&(c=parseInt(l.find(".col-num input[type=text]").val())+1,t.isNaN(c)&&(c=1)),"areas"===n?this.module.loadRoles().done(function(t){o=e(f({i18n:r,allowRoles:t.length>0})).appendTo(a),j.onAreaOrZoneAdded.call(this,a,o,c),j.renderAreaRolesSelects.call(this,t,o.find("select[name^=aRoles]"));var n=j.getArmSchedulesOptions.call(this,this.model.get("armSchedules"));o.find("select[name^=aScheduleUuid]").html(n)}.bind(this)):(o=e(b({areas:this.model.get("areas")})).appendTo(a),j.onAreaOrZoneAdded.call(this,a,o,c))}},onAreaOrZoneAdded:function(t,n,a){var s=n.find(".col-num input[type=text]");s.val(a).numeric({decimal:!1,negative:!1}),e.fn.scroll&&t.closest(".tab-content").scrollTo("max")},processAreasAndZones:function(n){var a={areas:S,zones:A},s={},i=null,r=[],o="aRoles",l="aScheduleUuid[]",d=n[l],c=this.model.indexArmSchedulesByUuid(),u=this.$el.find("table.areas tbody tr");"string"==typeof d&&(d=[d]),t.each(a,function(a,m){var h=m.substr(0,1);if("undefined"!=typeof n[h+"Num[]"]&&"undefined"!=typeof n[h+"Name[]"]&&"undefined"!=typeof n[h+"Comment[]"]){var p=n[h+"Num[]"],g=0,f="",v=["Id","Num","Name","Comment"],b={};"zones"===m&&v.push("AreaId"),t.each(v,function(e){b[e]=t.isArray(n[h+e+"[]"])?n[h+e+"[]"]:[n[h+e+"[]"]]});for(var y=0,w=p.length;w>y;++y)if(g=parseInt(b.Num[y]),!(!g||1>g||g>a)){f=e.trim(b.Name[y]);var x={num:g,name:f,comment:e.trim(b.Comment[y])};if(n[h+"Id[]"][y]&&0!=n[h+"Id[]"][y]&&(x.id=parseInt(b.Id[y])),"areas"===m){var _=[],S=e(u[y]).find("select[name="+o+"]");S.length&&(_=S.val()),x.roleCodes=_}if("zones"===m){var A=b.AreaId[y];"undefined"!=typeof s[A]&&(s[A].zones=s[A].zones||[],s[A].zones.push(x))}else x.id?(s[x.id]=x,d&&d[y]&&d[y]in c&&(i=i||{},i[x.id]=d[y])):r.push(x)}delete n[h+"Id[]"],delete n[h+"Num[]"],delete n[h+"Name[]"],delete n[h+"Comment[]"],"zones"===m?delete n["zAreaId[]"]:(delete n[l],delete n[o])}}),n[this.model.ARM_SCHEDULES_KEY]=null!==i?JSON.stringify(i):"",n.areas=t.values(s||{}).concat(r)},processEquipmentIds:function(e){var n=[];if(e.equipmentIds){var a=e.equipmentIds;n=t.unique(a.split(/[\s\,]+/).map(function(e){return e.trim()}).filter(function(e){return e.length>0}))}e.equipmentIds=JSON.stringify(n)},getAddress:function(n){var a="";return t.each(["Street","House","City","Region","Country"],function(t){n[t]&&(a+=(a?", ":"")+e.trim(n[t]))}),a},renderArmScheduleSelects:function(t){var n=this.model.get("areas"),a=j.getArmSchedulesOptions.call(this,t),s=0;this.$el.find("select[name^=aScheduleUuid]").each(function(){var t=e(this),i=n[s].scheduleUuid;t.html(a),i&&t.find("[value="+i+"]").prop("selected",!0),s++})},getArmSchedulesOptions:function(e){var n=this.module.getTexts(),a='<option value="">'+n.armScheduleNotSelected+"</option>";return t.each(e,function(e){a+='<option value="'+e.uuid+'">'+t.escape(e.name)+"</option>"}),a}};return C}),define("stat/itemcard/StatItemCardModule",["jquery","underscore","abstracts/itemcard/CardModel","abstracts/itemcard/ItemCardModule","stat/itemcard/views/StatItemCardView","stat/itemcard/views/StatItemCardEditableView"],function(e,t,n,a,s,i){var r=null,o=null,l=a.extend({constructor:function(){a.apply(this,arguments)},open:function(e){this.cardModel=new d({id:e.id,module:this}),this._open(e,i,s)},getHardwareTypes:function(){return r},loadHardwareTypes:function(){return r?(new e.Deferred).resolve(r):e.ajax({url:App.getBaseUrl()+"obj-types/",success:function(e){r=e}})},loadRoles:function(){return null!==o?(new e.Deferred).resolve(o):e.ajax({url:App.getBaseUrl()+"users/roles/"}).done(function(e){o=e})}}),d=n.extend({url:App.getBaseUrl()+"objects/obj-card/",defaults:t.extend({},n.prototype.defaults,{objType:App.TYPE_STAT,areas:[],zones:[],faults:[],armSchedules:[]}),ARM_SCHEDULE_TEMPLATES_KEY:"armScheduleTemplate",ARM_SCHEDULES_KEY:"armSchedule",constructor:function(){n.apply(this,arguments)},parse:function(){var e=n.prototype.parse.apply(this,arguments),a=this._parseArmScheduleTemplates(e),s=this.indexArmSchedulesByUuid(a),i=this._parseAreasArmSchedules(e);if("areas"in e){for(var r,o=[],l=0,d=e.areas.length;d>l;++l)r=e.areas[l],"zones"in r&&(r.zones=t.sortBy(r.zones,"num"),o=o.concat(r.zones)),r.scheduleUuid="",r.id in i&&i[r.id]in s&&(r.scheduleUuid=i[r.id]);e.zones=o}return e.armSchedules=a,e},loadFaults:function(){return this._object.loadFaults()},resolveFaults:function(e){return this._object.resolveFaults(e)},update:function(e,n){var a={id:"id",name:"name",Country:"country",Region:"Region",City:"city",IMAGE_PATH:"imgPath",lat:"lat",lon:"lon"},s={};for(var i in a)t.isUndefined(e[i])||(s[a[i]]=e[i]);if(!t.isUndefined(e.areas)&&n){var r=this;showCursor(),this.fetch({data:{objectId:this._object.id}}).fail(function(){var e=r.getTexts();alert(e.objectCardLoadingFailed,e.error.ucFirst())}).always(hideCursor)}if(!t.isUndefined(s.lat)&&!t.isUndefined(s.lon)){s.coords=[s.lat,s.lon];var o="";t.each(["Street","House"],function(t){e[t]&&(o+=(o?", ":"")+e[t])}),e.House&&e.Building&&(o+="-"+e.Building),s.addressShort=o}this.get("module").get("parent").trigger("itemchanged",[s],this)},indexArmSchedulesByUuid:function(e){return e=e||this.get("armSchedules"),t.indexBy(e,"uuid")},getAreasByScheduleUuid:function(e){var n=this.get("areas");return t.filter(n,function(t){return t.scheduleUuid==e})},_parseArmScheduleTemplates:function(e){return this._parseJsonSetting(e.settings,this.ARM_SCHEDULE_TEMPLATES_KEY,[])},_parseAreasArmSchedules:function(e){return this._parseJsonSetting(e.settings,this.ARM_SCHEDULES_KEY,{})},_parseJsonSetting:function(t,n,a){var s=a;if(n in t&&t[n].length)try{s=e.parseJSON(t[n])}catch(i){}return s}});return l}),define("text!stat/editor/tmpl/formGroup.html",[],function(){return'<input type="hidden" name="groupType" value="<%= App.TYPE_STAT %>">\n<input type="hidden" name="parentId" value="<%= parentId || \'\' %>">\n<input class="input-block-level no-margin" name="name" type="text"\n       placeholder="<%= i18n.enterGroupName %>" value="<%- name %>" maxlength="255">'}),define("text!stat/editor/tmpl/formObject.html",[],function(){return'<p class="help"><%= lat && lon ? i18n.moveObjectToSetPos : i18n.clickOnMapToSetPos %></p>\n<div class="row-fluid">\n    <div class="span6">\n        <label><%= i18n.lat %></label>\n        <input class="span12 no-margin" type="text" name="Lat" value="<%= lat || \'\' %>">\n    </div>\n    <div class="span6">\n        <label><%= i18n.lon %></label>\n        <input class="span12 no-margin" type="text" name="Lon" value="<%= lon || \'\' %>">\n    </div>\n</div>'}),define("stat/editor/views/StatEditorView",["jquery","jqueryui","underscore","jface","_libs/jquery/jquery.form","abstracts/editor/views/EditorView","text!stat/editor/tmpl/formGroup.html","text!stat/editor/tmpl/formObject.html"],function(e,t,n,a,s,i,r,o){o=n.template(o);var l=i.extend({constructor:function(){this._originalLayer=null,this._tmplGroup=n.template(r),i.apply(this,arguments)},_renderItemForm:function(e){var t=this,e=e||this.model.get("model"),a=this.model.getTexts();this._body.html(o(n.extend({},e.attributes,{i18n:a})));var s=this._body.find("input").numeric(),i=s.filter("[name=Lat]"),r=s.filter("[name=Lon]");s.on("keyup.itemedit",n.throttle(function(){var e=parseFloat(i.val()),n=parseFloat(r.val());e&&n&&t._editLayer.setPosition([e,n])},100))},_updateAddress:function(e){d.updateFields.call(this,e),this.model.modelChanged=!0},_initEditableObjectBak:function(){i.prototype._initEditableObject.apply(this,arguments);var e=this;this._editLayer.on("drag",function(t){d.updateFields.call(e,t.position)})},_initEditableObject:function(){var t=this,n=this.model,a=n.get("mapsModule"),s=n.get("model");if(s.get("lat")&&s.get("lon")){var r=new e.Deferred;this._waitForMarker(a.getWidget(),s,r).done(function(e){t._originalLayer=e,e.trigger("toggleclass",{name:"edited"}),t._editLayer=t._cloneItemMarker(s,e),t._initEditLayer()})}else i.prototype._initEditableObject.apply(this,arguments),this._initEditLayer()},_waitForMarker:function(e,t,n){var a=e.findLayer(function(e){return e.options&&e.options.model?e.options.model.has("objType")&&e.options.model.id==t.id:!1});if(a)n.resolve(a);else{var s=this;setTimeout(function(){s._waitForMarker(e,t,n)},500)}return n},_cloneItemMarker:function(e,t){var n=this.model.get("mapsModule").getWidget(),a=n.buildComplexMarker({lat:e.get("lat"),lon:e.get("lon"),html:t._icon.innerHTML+'<div class="move-arrows v"></div><div class="move-arrows h"></div>',className:t._icon.className+" obj-ghost",dataId:e.id,animated:!1,draggable:!0,model:e});return n.addLayer(a),a},_initEditLayer:function(){var e=this;this._editLayer&&this._editLayer.on("drag",function(t){var n=null;t.position?n=t.position:t.target&&(n=t.target.getLatLon()),n&&d.updateFields.call(e,n)})},_destroyEditableObject:function(){this._originalLayer&&this._originalLayer.trigger("toggleclass",{name:"edited"}),this._originalLayer=null,i.prototype._destroyEditableObject.apply(this,arguments)}}),d={updateFields:function(e){this.$el.find("input[name=Lat]").val(Math._round(e[0],6)),this.$el.find("input[name=Lon]").val(Math._round(e[1],6))}};return l}),define("stat/editor/StatEditorModule",["abstracts/editor/DeviceEditorModule","_common/stat/StatObject","stat/StatObjectsGroup","stat/editor/views/StatEditorView"],function(e,t,n,a){var s=e.extend({constructor:function(){e.apply(this,arguments)},initialize:function(){this.ItemsClass=t,this.GroupsClass=n,e.prototype.initialize.call(this,a)},_validateItem:function(e){var t=[],n=this.getTexts();return(!e.Lat||e.Lat>90||e.Lat<-90)&&t.push({msg:n.errIncorrectLat,key:"Lat"}),(!e.Lon||e.Lon>180||e.Lon<-180)&&t.push({msg:n.errIncorrectLon,key:"Lon"}),t.length?t:null},_onItemSaved:function(e,t){t.id&&this.get("parent").trigger("itemchanged",[{id:t.id,lat:t.Lat,lon:t.Lon,coords:[t.Lat,t.Lon]}],this)}});return s});