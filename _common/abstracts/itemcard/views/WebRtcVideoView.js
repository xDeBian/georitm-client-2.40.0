define(["jquery","jqueryui","jface","underscore","abstracts/View","text!../tmpl/ritmCameras.html","text!../tmpl/ritmCameraRow.html"],function(t,e,a,n,i,r,s){r=n.template(r),s=n.template(s);var l=6,h=i.extend({constructor:function(){this.controller=null,this._cameras=null,this._hasErrors=!1,this._handleChangeCameraNumber=o.handleChangeCameraNumber.bind(this),i.apply(this,arguments)},initialize:function(t){this.controller=t.controller,this.render(),o.bindEvents.call(this)},render:function(){var e=this.model.get("settings");try{var a=t.parseJSON(e.webRtcCameras);this._cameras=a.slice(0)}catch(i){this._cameras=[]}this.$el.html(r(n.extend({},{i18n:this.controller.getTexts()}))),this.$noData=this.$el.find(".no-data"),this.$table=this.$el.find("table"),this.$tbody=this.$el.find("tbody"),o.renderRows.call(this,this._cameras)},addRow:function(){if(this._cameras.length<l){var e={num:o.findVacantNumber.call(this,this._cameras),name:"",note:""};this._cameras.push(e),o.toggleTable.call(this);var a=t(o.renderRow.call(this,this._cameras.length-1,e)).appendTo(this.$tbody);a.find("select").on("change",this._handleChangeCameraNumber),this.validate()}},validate:function(){}}),o={bindEvents:function(){var e=this;this.$el.on("click",".icon-remove",function(){var a=t(this),n=a.data("index");e._cameras.splice(n,1),a.closest("tr").remove(),o.toggleTable.call(e),e._cameras.length&&e.$tbody.find("tr").each(function(e){t(this).find("[data-index]").data("index",e).attr("data-index",e)}),e.validate()})},toggleTable:function(){var t=this._cameras.length>0;this.$noData.toggleClass("hidden",t),this.$table.toggleClass("hidden",!t)},renderRows:function(t){var e=t.length,a="";o.toggleTable.call(this);for(var n=0;e>n;++n)a+=o.renderRow.call(this,n,t[n]);this.$tbody.html(a)},renderRow:function(t,e){var a=this.controller.getTexts();return s({index:t,camera:e,options:n.map(n.range(0,l),function(t){return a.videoCamera+" "+(t+1)})})},toggleAddBlock:function(t){this.$addBlock[t?"removeClass":"addClass"]("hidden").find("input").prop("disabled",!t)},handleChangeCameraNumber:function(e){var a=t(e.target),n=a.data("index");this._cameras[n].num=Number(a.val()),this.validate()},findVacantNumber:function(t){for(var e=0;l>e;e++)if(!n.findWhere(t,{num:e}))return e;return 0}};return h});