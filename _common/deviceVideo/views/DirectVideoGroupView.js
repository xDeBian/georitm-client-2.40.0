define(["jquery","underscore","jface","abstracts/View","./DirectVideoView","text!../tmpl/directGroup.html","css!../css/camera.css"],function(e,t,i,o,n,l){l=t.template(l);var r=o.extend({constructor:function(){this.controller=null,this._children={},this._popupMode=!0,o.apply(this,arguments)},initialize:function(e){this.controller=e.controller,s.bindEvents.call(this),this.render()},render:function(){var e=this.controller;e.has("container")?(this._popupMode=!1,this.setElement(e.get("container")),s.onContainerReady.call(this)):s.openWindow.call(this)},fitSize:function(){console.log("fitSize called")},fitSizeInPopup:function(){console.log("fitSizeInPopup called")},remove:function(){this.stopListening(),s.removeChildren.call(this),this._popupMode||this.$el.remove()}}),s={getHtml:function(){var e=this.controller,t={i18n:this.controller.getTexts(),ports:e.get("ports")};return l(t)},openWindow:function(){var e=this,t=this.controller,o=t.getTexts(),n={winId:"win-device-video",addClass:"device-video device-video-direct",headerHtml:o.cameraOnObject.replace("#title#",App.buildObjTitle(this.model)),contentHtml:s.getHtml.call(this),width:550,dieAfter:0,openCallback:function(){e.setElement(this),s.onContainerReady.call(e)},closeCallback:function(){i.hideOverlay(),e.controller.destroy()}},l=t.getUserData("winLeft"),r=t.getUserData("winTop");null===l||null===r?n.centered=!0:(0>l&&(l=0),0>r&&(r=0),n.initX=l,n.initY=r),i.showOverlay(),i.window.open(n)},onContainerReady:function(){var e=this,t=this.controller,i=e.$el.find(".btn-mode");s.bindUIEvents.call(this),t.load().done(function(){s.initPlayers.call(e),i.on("click",function(){return t.set("modeMulti",!t.get("modeMulti")),i.toggleClass("active",t.get("modeMulti")),!1})}).fail(function(){e.showErrors(arguments[0]),e._popupMode?e.$el.trigger("jw.close"):e.controller.destroy()})},bindEvents:function(){var e=this.controller;this.listenTo(e,"destroy",function(){this.remove()}).listenTo(e,"change:loading",function(e,t){this.$el[t?"addClass":"removeClass"]("loading")}).listenTo(e,"change:modeMulti",function(){s.removeChildren.call(this),s.initPlayers.call(this)})},bindUIEvents:function(){},initPlayers:function(){var t=this,i=this._children,o=this.controller,l=o.get("modeMulti"),r=this.$el.find("a[data-port]"),s=this.$el.find(".players-group"),a=o.get("ports");if(r.off("click"),s.toggleClass("multi",l),r.removeClass("active"),l)a.forEach(function(t){i[t]=new n({controller:this.controller,port:t,el:e('<div class="player"><video class="player-video"></video></div>').appendTo(s)})}.bind(this)),r.on("click",function(){var i=e(this);return t.$el.find(".btn-mode").removeClass("active"),o.set("port",i.data("port")),setTimeout(function(){o.set("modeMulti",!1)},100),!1});else{var c=o.get("port")||a[0];i[c]=new n({controller:o,port:o.get("port"),el:e('<div class="player"><video class="player-video"></video></div>').appendTo(s)}),r.on("click",function(){return o.set("port",e(this).data("port")),r.removeClass("active").filter("[data-port="+e(this).data("port")+"]").addClass("active"),!1}),o.set("port",c),r.filter("[data-port="+c+"]").addClass("active")}this._popupMode&&this.$el.trigger("jw.fitsize")},removeChildren:function(){var e=this._children;t.each(e,function(t,i){t.remove(),delete e[i]})}};return r});