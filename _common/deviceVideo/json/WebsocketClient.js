define(["underscore"],function(n){function e(n,e){this._ws=null,this._url=n,this._onOpen=function(){"onOpen"in e&&e.onOpen()},this._onError=function(){"onError"in e&&e.onError()},this._onMessage=function(n){"onMessage"in e&&e.onMessage(n.data)},this._onClose=function(n){"onClose"in e&&e.onClose(n.code,n.reason)}}return n.extend(e.prototype,{connect:function(){this._error=null;var n=this._ws=new WebSocket(this._url);n.binaryType="arraybuffer",n.onopen=this._onOpen,n.onmessage=this._onMessage,n.onclose=this._onClose,n.onerror=this._onError},send:function(n){return this._ws.readyState===e.READY_STATE_OPEN?(this._ws.send(n),!0):!1},disconnect:function(n,o){n=n||e.CLOSE_SELF,(this._ws.readyState===e.READY_STATE_OPEN||this._ws.readyState===e.READY_STATE_CONNECTING)&&this._ws.close(n,o||"")},isConnected:function(){return this._ws?this._ws.readyState===e.READY_STATE_OPEN:!1}}),e.CLOSE_SELF=4e3,e.READY_STATE_CONNECTING=0,e.READY_STATE_OPEN=1,e});