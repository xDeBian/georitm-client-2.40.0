define(["underscore","jquery","abstracts/Model","./constants","./utils"],function(e,n,t,i,r){var o=t.extend({constructor:function(){this._cache={},this._subscriptions={},t.apply(this,arguments)},defaults:{timezoneId:"Europe/Moscow",objectId:0,grClient:null,videoProxyClient:null},getOption:function(e){return this.has(e)?this.get(e):null},getMinTime:function(){return r.getDayStart(Date.now()-31536e6)},getDays:function(e,n,t){return new Promise(function(i,o){this._fetchMonthIfNeeded(e,n,t).then(function(e){i(Array.isArray(e)?e:r.getSortedKeys(e))},o)}.bind(this))},getSource:function(){return Promise.reject("No method getSource")},getUsedRangeSeries:function(){return[{id:i.SERIE_ID_SERVER,priority:0,color:"#0077b3"}]},getRangeSeries:function(e,n){var t=this;return new Promise(function(i){function r(){o.every(function(e){return"ranges"in e})&&i(o)}var o=t.getUsedRangeSeries();o.forEach(function(i){t.getSerieRanges(e,i.id,n).then(function(e){i.ranges=e,r()})})})},getSerieRanges:function(e,n,t){var i=this.makeDebug("#0d004d","Timeline: MSSP: getSerieRanges:",!0);return new Promise(function(r){var o=t.map(function(t){return this._fetchSerieRangesIfNeeded(e,n,t)}.bind(this));Promise.all(o).then(function(e){i("All promises for serie "+n+" resolved for dates: "+t.map(String).join(", "),e),r(e)})}.bind(this))},notify:function(e,n){var t=this._subscriptions;if(e in t&&t[e].length)for(var i=0;i<t[e].length;++i)t[e][i](n)},subscribe:function(e,n){var t=this._subscriptions;return t[e]=t[e]||[],t[e].push(n),function(){this.unsubscribe(e,n)}.bind(this)},unsubscribe:function(n,t){var i=this._subscriptions;n in i&&(i[n]=e.without(i[n],t))},_fetchSerieRangesIfNeeded:function(){return Promise.resolve([])},_fetchMonthIfNeeded:function(){return Promise.reject("No method _fetchMonthIfNeeded")},_connect:function(){return Promise.resolve()},makeDebug:function(e,n,t){return e=e||"#00818C",t=t===!0,function(i,o){this.getOption("debug")&&!t&&console.log("%c"+r.pnow()+": MSSP: "+(n?n+": ":"")+String(i),"color: "+e,o)}.bind(this)}});return o});