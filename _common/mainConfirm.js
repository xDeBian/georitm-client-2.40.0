var PRODUCTION=!0;require(["common"],function(){requirejs(["confirm/ConfirmModule"],function(e){new e({id:"appConfirm"})})}),define("_common/mainConfirm",function(){}),define("text!confirm/tmpl/confirm.html",[],function(){return'<div id="connecting" class="msg">\n    <i class="svg-icon svg-icon-spinner icon-spin"></i>\n    <%= i18n.connecting %>\n</div>\n\n<div id="processing" class="msg hidden">\n    <i class="svg-icon svg-icon-spinner icon-spin"></i>\n    <%= i18n.confirming %>\n</div>\n\n<div id="preparing" class="msg hidden">\n    <i class="svg-icon svg-icon-spinner icon-spin"></i>\n    <%= i18n.preparing %>\n</div>\n\n<div id="error" class="hidden">\n    <h3></h3>\n    <p></p>\n</div>\n\n<div id="success" class="hidden"></div>\n\n'}),define("text!confirm/tmpl/success.html",[],function(){return'<h3><%= i18n.successHdr %></h3>\n\n<%= i18n.successText %>\n\n<label class="checkbox" style="margin: 20px 0">\n    <input type="checkbox" value="1" name="openWizard" checked> <%= i18n.openWithard %>\n</label>\n\n<a href="javascript:;" class="btn btn-primary login-link"><%= i18n.goToMonitoring %></a>\n\n<div class="app-stores-list">\n    <a href="https://play.google.com/store/apps/details?id=org.apache.cordova.GeoritmMobileFree" target="_blank" class="app-store-item android"></a>\n    <a href="https://itunes.apple.com/us/app/georitm/id1166967285?l=ru&amp;ls=1&amp;mt=8" target="_blank" class="app-store-item ios"></a>\n</div>'}),define("confirm/nls/confirm",{root:{pleaseSetHost:'Please fill in the "host" setting in',connecting:"Connecting to the server",confirming:"Registration confirmation in progress",preparing:"The data preparation in progress. Please wait.",callServerFailed:"Failed to obtain data from the server",error:"Error",wrongUrl:"Wrong registration conformation link format",successHdr:"Welcome!<br />You have been successfully registered<br />in the GeoRITM&nbsp;monitoring&nbsp;service!",successText:'<p>Registration allows you to&nbsp;use the&nbsp;monitoring&nbsp;service free&nbsp;of&nbsp;charge for&nbsp;monitoring 3&nbsp;objects fitted with&nbsp;Voyager or&nbsp;Contact monitoring&nbsp;systems.</p><p>To add a&nbsp;new&nbsp;object, please use the Setup&nbsp;Wizard.</p><p>If you have any&nbsp;questions regarding purchasing Voyager or&nbsp;Contact systems or increasing the&nbsp;number of&nbsp;monitored&nbsp;objects, please send&nbsp;us an&nbsp;e-mail at&nbsp;<a href="mailto:info@ritm.ru">info@ritm.ru</a></p>',openWithard:"Run Object Add Wizard automatically",goToMonitoring:"Open Monitoring Interface",errors:{callServerFailed:"Failed to obtain data from the server",serverConnection:"Failed to set a connection.<br />To try again press Ok.",serverConnectionTimeout:"Timeout of a server response.<br />To try again press Ok.",localStorageUnavailable:"Saving of the application data at a browser is not available. The operation can not be continued.",iosPrivateMode:'If You use Apple device, ensure that the "Private access" mode is enabled.',canNotSave:"Failed to save data"}},"ru-ru":!0,"it-it":!0}),define("confirm/nls/ru-ru/confirm",{pleaseSetHost:'Пожалуйста, заполните настройку "host" в',connecting:"Идет соединение с сервером",confirming:"Идет подтверждение регистрации",preparing:"Пожалуйста подождите, идет подготовка данных",callServerFailed:"Не удалось получить данные с сервера",error:"Ошибка",wrongUrl:"Неправильный формат ссылки подтверждения регистрации",successHdr:"Добро пожаловать!<br />Вы зарегистрированы в сервисе мониторинга GeoRITM!",successText:'<p>Регистрация позволяет Вам абсолютно бесплатно пользоваться сервисом мониторинга для контроля трех объектов, оборудованных системами мониторинга Voyager или Contact.</p><p>Для добавления объекта Вы можете воспользоваться мастером настройки.</p><p>По вопросам приобретения Voyager и Contact или увеличения количества объектов мониторинга обращайтесь по адресу <a href="mailto:info@ritm.ru">info@ritm.ru</a></p>',openWithard:"Автоматически запустить мастер добавления объектов",goToMonitoring:"Перейти в интерфейс мониторинга",errors:{callServerFailed:"Не удалось получить данные с сервера",serverConnection:"Не удалось установить соединение.<br />Нажмите Ok, чтобы повторить попытку.",serverConnectionTimeout:"Истекло время ожидани ответа сервера.<br />Нажмите Ok, чтобы повторить попытку.",localStorageUnavailable:"В браузере недоступно сохранение данных приложения. Дальнейшая работа невозможна.",iosPrivateMode:'Если Вы используете устройство Apple, проверьте, что режим "Частного доступа" выключен.',canNotSave:"Не удалось сохранить данные"}}),define("confirm/ConfirmModule",["jquery","underscore","abstracts/Module","storage","text!confirm/tmpl/confirm.html","text!confirm/tmpl/success.html","i18n!confirm/nls/confirm"],function(e,n,t,o,r,i,a){function s(){var e={},n=Backbone.history.location.search;if(!n)return e;n=n.replace(/^\?/,"");for(var t,o=n.split("&"),r=0,i=o.length;i>r;r++)t=o[r].split("="),2==t.length&&(e[decodeURIComponent(t[0])]=decodeURIComponent(t[1]));return e}e.ajaxSetup({crossDomain:!0,method:"POST",type:"POST",dataType:"json",processData:!1,contentType:"application/json",traditional:!0,beforeSend:function(e,n){n.data=JSON.stringify(n.data),"GET"==n.type&&(n.type="POST"),e.setRequestHeader("Accept-Language",LOCALE)}});var c=o,l="",d=null,p=null,u=null,f=5e3,m=null,g=t.extend({constructor:function(){window.App=this,t.apply(this,arguments)},initialize:function(){var t=this;this.on("authsuccess",function(e){t.getStorage().rootSet("user",e)}),this.on("localechange",function(e){setCookie("locale",e,180),window.location.reload()}),h.loadServerSettings().done(function(o){var r=o;t.setBaseUrl((o.protocol||"http")+"://"+o.host+(o.port?":"+o.port:"")+"/clientmanager-rest/"),t.render(),h.validateServer.call(t,o).done(function(){d=r,h.loadServerSkin().done(function(e){n.extend(d,e),h.onSkinResolve.call(t)}).fail(function(){h.onSkinResolve.call(t)})}).fail(function(n){e("#connecting").addClass("hidden"),alert(a.error+". "+n)})})},render:function(){e("#page").html(n.template(r,{i18n:a}))},getStorage:function(){return c},getLocale:function(){return LOCALE},getLocaleName:function(){var e={"ru-ru":"Русский","en-en":"English","it-it":"Italiano"};return e[LOCALE]},setBaseUrl:function(e){l=e},getBaseUrl:function(){return l},getServerSettings:function(){return d}}),h={loadServerSettings:function(){return e.ajax({url:"./config/server.json",method:"GET",type:"GET",cache:!1,crossDomain:!1,processData:!0})},validateServer:function(n){var t=new e.Deferred;return n.host?(e.ajax({method:"post",timeout:1e3,url:(n.protocol||"http")+"://"+n.host+(n.port?":"+n.port:"")+"/clientmanager-rest/ping/"}).done(function(e){t.resolve(e)}).fail(function(e,n){switch(n){case"timeout":t.reject(a.errors.serverConnectionTimeout);break;default:t.reject(a.errors.serverConnection)}}),t):(t.reject(a.pleaseSetHost+" config/"+CONFIG_FILENAME),t)},loadServerSkin:function(){return e.ajax({url:"./config/skin.json",method:"GET",type:"GET",cache:!1,crossDomain:!1,processData:!0})},onSkinResolve:function(){var n=this;e("#connecting").addClass("hidden"),e("#processing").removeClass("hidden"),d.skinUrl?requirejs(["css!"+d.skinUrl],function(){h.makeConfirmation.call(n)}):h.makeConfirmation.call(n)},makeConfirmation:function(){var t=this,o=s(),r=!1;return o.code?e.ajax({url:this.getBaseUrl()+"clients/confirm-reg/",data:{code:o.code},success:function(o){e("#success").html(n.template(i,n.extend(o,{i18n:a}))).removeClass("hidden").on("click",".login-link",function(){return r?!1:(r=!0,e("#connecting").removeClass("hidden"),h.authorize.call(t,o.login,o.password).done(function(n){e("#connecting").addClass("hidden"),e("#preparing").removeClass("hidden"),c.rootSet("user",n),e("input[name=openWizard]")[0].checked&&c.rootSet("openWizard",!0),e(".login-link").addClass("hidden"),e.ajaxSetup({beforeSend:function(e,t){"undefined"!=typeof t.data&&null!==t.data&&(t.data=JSON.stringify(t.data)),"GET"==t.type&&(t.type="POST"),e.setRequestHeader("Accept-Language",LOCALE),e.setRequestHeader("Authorization","Basic "+n.basic)}}),setTimeout(function(){window.location.href="index.html?confirmed=1"},1e3)}).fail(function(n,t,o){var r=n.status?n.status+": ":"",o=a.errors.callServerFailed;try{var i=e.parseJSON(n.responseText);o=i.msg,r+=i.hdr}catch(s){r+=a.error}alert(r+". "+o)}),!1)})},error:function(n){var t=e("#error").removeClass("hidden"),o=a.error,r=a.errors.callServerFailed;if(n.responseText){var i;(i=e.parseJSON(n.responseText))&&(o=i.hdr||o,r=i.msg)}else 404==n.ststus&&(o+=" (404)");t.find("h3").text(o),t.find("p").text(r)},complete:function(){e("#processing").addClass("hidden")}}):(e("#processing").addClass("hidden"),alert(a.wrongUrl),window.location.href="index.html",void 0)},getRestapiBase:function(){return(d.protocol||"http")+"://"+d.host+(d.port?":"+d.port:"")+(d.connector?"/"+d.connector:"")+"/"},authorize:function(n,t){return e.ajax({url:h.getRestapiBase()+"users/login/",timeout:3e3,data:{login:n,password:t}})},checkObject:function(n){p=e.ajax({url:h.getRestapiBase()+"objects/obj/",data:{objectId:[n]},success:function(e){e[0]?m.resolve(e[0]):u=setTimeout(function(){h.checkObject.call(self,n)},f)},fail:function(){u=setTimeout(function(){h.checkObject.call(self,n)},f)}})}};return g});