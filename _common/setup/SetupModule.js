var PRODUCTION=!0;define("text!_common/setup/tmpl/flash.html",[],function(){return'<object type="application/x-shockwave-flash" data="<%= url %>" width="100%" height="100%">\n    <param name="wmode" value="transparent" />\n    <param name="FlashVars" value="HOST=<%=host%>&PORT=<%=socketPort%>&TOKEN=<%=token%>&ADDRESS=<%=address%>&LANG=<%=lang%>&SRVUPD=http://<%=firmwareHost%>" />\n    <param name="movie" value="<%= url %>" />\n</object>'}),define("_common/setup/views/SetupView",["jquery","jface","abstracts/View","i18n!_common/nls/common","text!../tmpl/flash.html","css!_common/setup/css/setup.css"],function(e,t,n,i,a){var s=560,l=800;a=_.template(a);var o=n.extend({constructor:function(){this._globalAlertId=0,n.apply(this,arguments)},initialize:function(){this.listenTo(this.model,"change:active",function(e,t,n){t?r.start.call(this,n):this.$el.trigger("jw.close")}).listenTo(this.model,"change:fullScreen",r.handleChangeFullScreen)}}),r={start:function(t){var n=this;r.openWindow.call(this,t),this.model.load(t).done(r.render.bind(this)).fail(function(t){n.model.set("active",!1);var a=i.errSetupLoad,s=i.error;try{var l=e.parseJSON(t.responseText);a=l.msg+(l.data?" ("+l.data+")":""),s=l.hdr}catch(o){}alert(a,s)})},render:function(e){var t=this.$el.find(".jw-content");if("string"==typeof e)t.html(e);else{var n="swfLocation"in e?e.swfLocation:"",a="location"in e?e.location:n,s=a.indexOf(".swf")>=0,l=function(s){s&&(this._globalAlertId=App.pushGlobalAlert(i.swfShellUsageWarning));var l=r.renderSwfWrapper.call(this,Object.assign({},e,{location:s?n:a}));t.html(l)}.bind(this);if(s)l(!1);else{var o=App.isHttpsClient()&&"webSocketSecuredPort"in e,c=o?e.webSocketSecuredPort:e.webSocketPort,h=e.host,d="/idp-web"+e.webSocketPath,u=(o?"wss":"ws")+"://"+h+":"+c+d;showCursor(),r.testWsConnection.call(this,u).done(function(){var n='<iframe class="shell-iframe" width="100%" height="100%" src="//'+a+"?host="+e.host+"&port="+c+"&path="+d+"&token="+e.token+"&address="+e.address+"&fwhost="+e.firmwareHost+"&lang="+App.getLocale().substr(0,2)+"&trusted=true"+'"></iframe>';t.html(n)}.bind(this)).fail(function(){n?l(!0):(this.model.set("active",!1),alert(i.shellWsWarning,i.attention))}.bind(this)).always(hideCursor)}}},renderSwfWrapper:function(e){return a(Object.assign({},e,{lang:App.getLocale(),url:window.location.protocol+"//"+e.location}))},testWsConnection:function(t){var n=new e.Deferred,i=new WebSocket(t);return i.onerror=n.reject,i.onopen=function(){i.close(),n.resolve()},setTimeout(n.reject,500),n},openWindow:function(n){var i=this,a=this.model,o="extId"in n?n.name+" (#"+n.extId+")":"name"in n?n.name+" ("+n.imei+")":n.imei+(n.firmware?" ("+n.firmware+")":""),c={winId:"win-setup",headerHtml:o,contentHtml:"",addClass:"loading",dieAfter:0,minWidth:600,minHeight:s,maxHeight:l,resizable:!0,openCallback:function(){i.setElement(this);var t=e('<a href="#" class="jw-maximize svg-icon svg-icon-'+(a.get("fullScreen")?"contract":"expand")+'"></a>').prependTo(i.$el.find(".jw-controls"));t.on("click",function(){r.toggleFullScreen.call(i)});var n=Math.max(s,a.getUserData("winHeight"));n&&(i.el.style.height=n+"px",i.$el.find(".jw-resize")[0].style.height=n-50+"px"),i.$el.on("dragstop",function(e,t){t&&(a.setUserData("winLeft",t.position.left),a.setUserData("winTop",t.position.top))}).on("resizestop",function(e,t){t&&t.element&&t.element[0]==i.$el[0]&&(t.size.width!=t.originalSize.width&&(a.setUserData("winWidth",t.size.width),a.setUserData("winLeft",t.position.left)),t.size.height!=t.originalSize.height&&(a.setUserData("winHeight",t.size.height),a.setUserData("winLeft",t.position.left)))})},showCallback:function(){r.handleChangeFullScreen.call(i,a,a.get("fullScreen"))},activateCallback:function(){setTimeout(function(){i.$el.removeClass("loading")},2e3)},closeCallback:function(){t.hideOverlay(),a.set("active",!1,{silent:!0}),a.get("fullScreen")&&t.windowshome.removeClass("jf-windows-maximized"),App.removeGlobalAlert(i._globalAlertId)}},h=a.getUserData("winLeft"),d=a.getUserData("winTop");null===h||null===d?c.centered=!0:(0>h&&(h=0),0>d&&(d=0),c.initX=h,c.initY=d);var u=e(window).width(),f=Math.min(a.getUserData("winWidth"),u)||.8*u;c.width=f,t.showOverlay(),t.window.open(c)},toggleFullScreen:function(){this.model.set("fullScreen",!this.model.get("fullScreen"))},handleChangeFullScreen:function(e,n){t.windowshome.toggleClass("jf-windows-maximized",n),this.$el.resizable(n?"disable":"enable").draggable(n?"disable":"enable").find(".jw-maximize").toggleClass("svg-icon-contract",n).toggleClass("svg-icon-expand",!n)}};return o}),define("_common/setup/SetupModule",["jquery","abstracts/Module","_common/setup/views/SetupView"],function(e,t,n){var i=t.extend({constructor:function(){t.apply(this,arguments)},defaults:e.extend({},t.prototype.defaults,{fullScreen:!1}),initialize:function(){this.set("fullScreen",this.getUserData("fullScreen")===!0),this._view=new n({model:this}),this.listenTo(App,"devicesetup",function(e){this.get("active")||this.set("active",!0,e)}),this.on("change:fullScreen",function(e,t){e.setUserData("fullScreen",t)})},load:function(t){return t.imei?e.ajax({url:App.getBaseUrl()+"iserver-shell/json-shell-info/",data:{imei:Number(t.imei)}}):e.ajax({url:App.getBaseUrl()+"iserver-shell/shell-info/",data:{objectId:t.id,password:t.password},dataType:"html"})}});return i});