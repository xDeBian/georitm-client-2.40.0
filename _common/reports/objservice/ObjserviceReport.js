define(["underscore","jface","_common/reports/Report","./views/ObjserviceReportView"],function(t,e,i,s){var r=i.prototype,n=i.extend({constructor:function(){this._children={},i.apply(this,arguments)},url:App.getBaseUrl()+"reports/OBJSERVICE/",defaults:t.extend({},r.defaults,{properties:["extId","name"],statuses:["served","service","notServed"],roundToDays:!0,detailed:!1}),initialize:function(e){var r=this,n=e.statuses||[];i.prototype.initialize.call(this,s),"string"==typeof n?n=[n]:n.length||(n=this.defaults.statuses),this.set({statuses:n,roundToDays:"roundToDays"in e&&1==e.roundToDays,detailed:1==this.get("objectId").length}),this._prepareDeviceProperties(),t.each(["roundToDays","statuses"],function(t){r.setUserData(t,r.get(t))}),"source"in e&&e.source.registerChild(this)},getPostParams:function(){var t=r.getPostParams.call(this);return t.properties=this.get("properties"),t.statuses=this.get("statuses"),t.roundToDays=this.get("roundToDays"),t},buildChildReport:function(i,s){var r=i+"_"+s.objectId+"_"+s.startTime;if(r in this._children){if(null===this._children[r])return;return this._module.viewReport(this._children[r].id,this.id),void 0}this._children[r]=null;var n={objectId:[s.objectId],source:this,type:i,tzId:this.get("tzId"),startTime:s.startTime};i==this.get("type")?t.each(["properties","endTime","roundToDays","statuses"],function(t){n[t]=this.get(t)}.bind(this)):n.endTime=Math.min(+new Date,n.startTime+864e5),this.has("timeRanges")&&(n.timeRanges=this.get("timeRanges")),this.trigger("build:start"),App.trigger("needreport",this.get("objType"),n),e.growl.open(this.getTexts().reportBuildingHasStarted)},registerChild:function(t){var e=t.get("type")+"_"+t.get("objectId")+"_"+t.get("startTime");this.listenToOnce(t,"sync",function(){this._children[e]=t,this.trigger("build:finish")}.bind(this)).listenTo(t,"remove",function(){delete this._children[e]}.bind(this))}});return n});