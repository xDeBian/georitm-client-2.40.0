var PRODUCTION=!0;define("_common/reports/Report",["jquery","underscore","jface","abstracts/Module","fileDownload"],function(e,t,n,i){var r=["xls","pdf"],o=i.extend({constructor:function(e){this._module=e.module,this._jsonData=null,this._tracksModule=null,this._children={};var t=this;this.on("sync",function(e,n,i){i.xhr&&(t._jsonData=i.xhr.responseText)}),i.apply(this,arguments)},initialize:function(e){this._view=new e({id:"report-"+this.id,className:"tab-hor-content report",model:this,container:this.get("module").getReportsContainer(),parentView:this.get("module").getListView()});var t=this;this.on("sync",function(){t.set("nbObjects",t.get("objectId").length)}).on("change:tracksSettings",function(e,n){t._tracksModule&&t._tracksModule.set("showPoints",n.showPoints),t._tracksModule&&t._tracksModule.set("colorTracks",n.colorTracks),t._tracksModule&&t._tracksModule.set("speedColors",n.speedColors)})},prepareDate:function(e){if("number"==typeof e||e instanceof Date)return Date.sqlFormat(e);if("string"==typeof e)try{return Date.sqlFormat(Date.parse(e))}catch(t){}return e},_prepareDeviceProperties:function(){var e=this.get("properties");"fake"===e?this.set("properties",["extId"]):this.set("properties",t.without(e,"fake")),this.setUserData("properties",this.get("properties"))},getPostParams:function(){var e=this.get("objectId"),t={objectId:e,from:this.prepareDate(this.get("startTime")),to:this.prepareDate(this.get("endTime")),scode:this.get("addrSourceCode")};if(this.has("tzId")?t.tzId=this.get("tzId"):t.tz=App.getUserTimezone(),t.sort=this.get("sort")||"name",this.has("timeRanges")){var n=this.get("timeRanges"),i=[];e.forEach(function(e){i.push({id:e,ranges:n})}),delete t.objectId,delete t.from,delete t.to,t.objectIds=i}return t},buildView:function(){var e=this;return this.trigger("beforerender",this._view),this._view.render().done(function(){e.trigger("afterrender",e._view)}),this._view},getView:function(){return this._view},getTexts:function(){return this._module.getTexts()},getEventsPrefix:function(){return this._module.getEventsPrefix()+"."+this.id},setUserData:function(e,t){var n=this.getUserDataPrefix()+"."+e;return App.getStorage().set(n,t)},getUserData:function(e){var t=this.getUserDataPrefix()+"."+e;return App.getStorage().get(t)},getUserDataPrefix:function(){return this._module.id.replace(/\//g,".")+"."+this.get("key")},makeTracksModule:function(e){if(!this._tracksModule){var n=this.get("tracksSettings"),i=this._tracksModule=new e({id:this._module.id+"/"+this.id+"/tracks",container:!1,parent:this,options:t.extend({},n,{list:!1,mapsModule:this._module.getMapsModule()})});this._tracksModule.listenTo(this,"remove",function(){i.destroy()})}},getTracksModule:function(){return this._tracksModule},buildTrackSegment:function(e){var t=this._module.getTracksSegmentsMode();if("all"!=t&&this._tracksModule.items.remove(this._tracksModule.items.models),this.has("tzId")){var n=App.getTimezone({id:this.get("tzId")}),i=n.offset,r=60*App.getUserTimezone(),o=6e4*(i-r);e.tzId=this.get("tzId"),e.startTime+=o,e.endTime+=o}return this.trigger("buildtrack",null,e),!0},removeTrackSegment:function(e){this._tracksModule.items.remove(e)},searchAddresses:function(e){if(e.length){var t=this,n=this._module,i=this.get("addrSourceCode"),r=e.length;this.clearJsonData();for(var o=0;r>o;++o)n.searchAddress({data:e[o],addrSourceCode:i,success:function(){t._view.onAddressLoad.apply(t._view,arguments)}})}},exportTo:function(n){var i=new e.Deferred;if(-1==t.indexOf(r,n))return i.reject("Unavailable format"),i;var o={xls:"excel",pdf:"pdf"},a=t.isFunction(this.url)?this.url(n):this.url,s=this.getPostParams();return this.readyForExport()?s.jsonData=this._jsonData:s.authorization=App.getBasic(),s.locale=LOCALE,"objectIds"in s&&(s.objectIds=JSON.stringify(s.objectIds)),e.fileDownload(a.replace("reports/","reports/form/")+o[n],{httpMethod:"POST",data:e.param(s)}).done(function(){i.resolve()}).fail(function(){i.reject.apply(i,arguments)}),i},readyForExport:function(){return null!==this._jsonData&&this._jsonData.length&&(!("addressesLoaded"in this)||this.addressesLoaded)},clearJsonData:function(){this._jsonData=null},buildChildReport:function(i,r){var o=JSON.stringify(i);if(r=r||this.get("type"),o in this._children){if(null===this._children[o])return;return this._module.viewReport(this._children[o].id,this.id),void 0}this._children[o]=null;var a={objectId:i,source:this,type:r,_childKey:o};t.each(["tzId","properties","startTime","endTime"],function(e){a[e]=this.get(e)}.bind(this)),this.has("timeRanges")&&(a.timeRanges=this.get("timeRanges")),a=e.extend({},a,this._getChildReportParams()),this.trigger("build:start"),App.trigger("needreport","mobile",a),n.growl.open(this.getTexts().reportBuildingHasStarted)},_getChildReportParams:function(){return{}},registerChild:function(e){var t=JSON.stringify(e.get("objectId"));this.listenToOnce(e,"sync",function(){this._children[t]=e,this.trigger("build:finish")}.bind(this)).listenTo(e,"remove",function(){delete this._children[t]}.bind(this))}});return o}),define("_common/reports/ReportsCollection",["underscore","abstracts/Collection"],function(e,t){var n=t.extend({constructor:function(){t.apply(this,arguments)}});return n}),define("text!_common/reports/tmpl/reportListItem.html",[],function(){return'<div class="content">\n    <h4><a class="view-report" data-item="<%= id %>" href="javascript:;"><%= name%></a></h4>\n    <p class="no-data"><%= i18n.noDataForPeriod %></p>\n    <%= listHtml %>\n\n    <p class="dates">\n        <% if(\'undefined\' != typeof startTime && \'undefined\' != typeof endTime) {%>\n        <span class="nobr"><% print(Date.format(i18n.DateTime.longFormat, startTime))%></span>\n        - <span class="nobr"><% print(Date.format(i18n.DateTime.longFormat, endTime))%></span>\n        <% } else if(\'undefined\' != typeof time) {%>\n        <span class="nobr"><% print(Date.format(i18n.DateTime.longFormat, time))%></span>\n        <% } %>\n    </p>\n    <% if(tzName) {%>\n    <p class="dates"><%= tzName %></p>\n    <% } %>\n</div>\n<div class="controls">\n    <a class="export-link" title="<%= i18n.exportToExcel %>" href="javascript:;" data-id="<%= id %>" data-format="xls">\n        <i class="svg-icon svg-icon-file-excel"></i>\n    </a>\n    <a class="export-link" title="<%= i18n.exportToPdf %>" href="javascript:;" data-id="<%= id %>" data-format="pdf">\n        <i class="svg-icon svg-icon-file-pdf"></i>\n    </a>\n    <a class="remove-link" title="<%= i18n.removeReport %>" href="javascript:;" data-id="<%= id %>">\n        <i class="svg-icon svg-icon-remove"></i>\n    </a>\n</div>\n\n\n<div class="clear"></div>'}),define("text!_common/tmpl/itemsList.html",[],function(){return'<div class="items-list">\n<% var limit = Math.min(limit, items.length); for(var i = 0; i < limit; i++) {%>\n<span data-id="<%= items[i].id %>" class="item"><%= items[i].name %></span><% if(i < limit-1) {%>, <% } %>\n<% } %>\n<% if(i < items.length) {%>\n    <span class="other nobr">\n        <%= i18n.andMore.replace(\'#q#\', (items.length - i)).replace("#l#", i18n.objectsLabels[i18n.whichLabels(items.length - i)]) %>\n    </span>\n<% } %>\n</div>'}),define("_common/reports/views/ReportListView",["jquery","underscore","abstracts/View","text!_common/reports/tmpl/reportListItem.html","text!_common/tmpl/itemsList.html"],function(e,t,n,i,r){var i=t.template(i),r=t.template(r),o=n.extend({constructor:function(){n.apply(this,arguments)},initialize:function(){var e=this;this.$el.data("id",this.model.id),this.listenTo(this.model,"request",function(){e.$el.addClass("loading")}).listenTo(this.model,"sync",function(){e.$el.removeClass("loading")}).listenTo(this.model,"remove",function(){e.stopListening(e.model),e.remove()})},render:function(e){var n=this.model.get("items"),o=this.model.getTexts(),a=r({items:n,limit:2,i18n:o}),s="";if(this.model.has("tzId")){var l=App.getTimezone({id:this.model.get("tzId")});l.offset!=60*App.getUserTimezone()&&(s=App.getFullTimezoneName(l))}var d=i(t.extend({},this.model.attributes,{i18n:o,tzName:s,listHtml:a}));this.$el.attr("data-type",this.model.get("type")).append(d).appendTo(e),this.model.has("reportSubtype")&&this.$el.attr("data-subtype",this.model.get("reportSubtype")),"zonevizcount"==this.model.get("type")&&this.$el.find(".export-link[data-format=pdf]").remove()}});return o}),define("text!_common/reports/tmpl/report.html",[],function(){return'<div class="box-content">\n\n    <!--<div class="rep-header"></div>--><!--/rep-header-->\n\n    <div class="rep-content"></div><!--/rep-content-->\n\n</div><!--/box-content-->\n\n<div class="box-footer rep-footer">\n    <a href="javascript:;" class="export-link" data-id="<%= id %>" data-format="xls"><%= i18n.exportToExcel %></a><br />\n    <a href="javascript:;" class="export-link" data-id="<%= id %>" data-format="pdf"><%= i18n.exportToPdf %></a>\n</div><!--/rep-footer-->'}),define("text!_common/reports/tmpl/reportHeader.html",[],function(){return'<div class="box-header module-header rep-header append prepend">\n    <div class="add-on pull-left">\n        <a href="javascript:;" class="back">\n            <i class="svg-icon svg-icon-arrow-left"></i>\n        </a>\n    </div>\n    <h2><%= title %></h2>\n    <div class="add-on">\n        <a class="btn-delete" href="javascript:;" title="<%= i18n.removeReport %>" data-id="<%= id %>">\n            <i class="svg-icon svg-icon-remove"></i>\n        </a>\n    </div>\n    <div class="add-on">\n        <a class="btn-add" href="javascript:;" title="<%= i18n.build.ucFirst() %> <%= i18n.another %>">\n            <i class="svg-icon svg-icon-plus"></i>\n        </a>\n    </div>\n    <!--<div class="module-settings">\n\n    </div>-->\n</div>\n<div class="fixed-header"></div>'}),define("text!_common/reports/tmpl/reportMeta.html",[],function(){return'<div class="rep-meta selectable">\n    <% if(!_.isUndefined(objectsList)) {%>\n    <%= objectsList %>\n    <% } %>\n\n    <%if(\'undefined\' != typeof startTime && \'undefined\' != typeof endTime) {%>\n        <p class="dates"><%= i18n.reportPeriod %>:\n            <span class="nobr"><%= Date.format(i18n.DateTime.longFormat, startTime) %></span> -\n            <span class="nobr"><%= Date.format(i18n.DateTime.longFormat, endTime) %></span>\n        </p>\n    <% } else if(\'undefined\' != typeof time) {%>\n        <p class="dates">\n            <%= i18n.dataForDate.ucFirst() %>: <%= Date.format(i18n.DateTime.longFormat, time) %>\n        </p>\n    <% } %>\n\n    <% if(!_.isUndefined(zonesStr)) {%>\n    <p class="dates">\n        <%= zonesStr %>\n    </p>\n    <% } %>\n\n    <%if(tzName) {%><p class="dates"><%= tzName %></p><% } %>\n\n</div>'}),define("text!_common/reports/tmpl/table.html",[],function(){return'<table class="rep-table hidden" data-table="<%= index %>">\n    <thead></thead>\n</table>'}),define("text!_common/reports/tmpl/popup.html",[],function(){return'<% if(type== \'fuelChange\') {%>\n<div class="track-info fuel-change-info">\n    <h5><%= name %> [#<%= extId %>]</h5>\n    <ul class="features">\n        <li><%= (delta > 0 ? i18n.filling : i18n.discharge ).ucFirst() %>: <strong><%= delta.toFixed(1) + \' \' + i18n.l %></strong></li>\n        <li data-value="<%= begin %>"><%= beginS %></li>\n        <li><span data-geoid="<%= geoId || 0 %>" class="address"><i class="svg-icon svg-icon-spinner icon-spin"></i>\n            <%- addressStr %>\n        </span></li>\n    </ul>\n</div>\n<% } else if(type== \'accesscard\') { %>\n<div class="<%= className %>"">\n<h5><%= name %> [#<%= extId %>]</h5>\n<ul class="features">\n    <li><%= text.idCard %>: <%= card %></li>\n    <li data-value="date"><%= date %></li>\n    <li><span data-geoid="<%= geoId || 0 %>" class="address"><i class="svg-icon svg-icon-spinner icon-spin"></i>\n            <%= addressStr %>\n        </span></li>\n</ul>\n</div>\n<% } else if(type== \'criticalRpm\') { %>\n<div class="track-info rpm-info">\n    <ul class="features">\n        <li class="nobr">\n            <%= i18n.date.ucFirst() %>/<%= i18n.time.ucFirst() %>:\n            <strong><%= dateS %> <%= startS %></strong>\n        </li>\n        <li class="nobr"><%= i18n.duration %>: <strong><%= timeS %></strong></li>\n        <li><%= i18n.maximum %>: <strong><%= max %> <%= i18n.rpm %></strong></li>\n        <li><%= i18n.avgValue %>: <strong><%= avg %> <%= i18n.rpm %></strong></li>\n    </ul>\n</div>\n<% } else if(type== \'discreteSwitch\') { %>\n<div class="track-info discrete-info">\n    <h5><%= title %></h5>\n    <ul class="features">\n        <li><%= i18n.currentState %>: <strong><%= state %></strong></li>\n        <li class="nobr"><%= i18n.date.ucFirst() %>/<%= i18n.time.ucFirst() %>: <strong><%= start %></strong></li>\n        <li class="nobr"><%= i18n.duration %>: <strong><%= duration %></strong></li>\n    </ul>\n</div>\n<% } else if(type== \'nearestObject\') { %>\n<div class="track-info">\n    <h5><%= title %></h5>\n    <ul class="features">\n        <li class="nobr"><%= i18n.time.ucFirst() %>: <strong><%= timeS %></strong></li>\n        <li><%= i18n.distance %>: <strong><%= distanceS %> <%= i18n.km %></strong></li>\n        <li><%= i18n.speed.ucFirst() %>: <strong><%= speedS %> <%= i18n.kmh %></strong></li>\n    </ul>\n</div>\n<% } else if(type== \'passMatrix\') { %>\n<div class="track-info">\n    <h5><%= title %></h5>\n    <ul class="features">\n        <li class="nobr"><%= i18n.dateAndTime %>: <strong><%= dateS %></strong></li>\n        <li><%= i18n.pass.enteredTotalShort %>: <strong><%= totalIn %></strong></li>\n        <li><%= i18n.pass.exitedTotalShort %>: <strong><%= totalOut %></strong></li>\n    </ul>\n</div>\n<% } %>'}),define("text!_common/reports/tmpl/pins.svg",[],function(){return'<svg class="svg" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="36" viewBox="0 0 24 36">\n<path class="svg-path svg-pin" d="M12,0C5.366,0,0,5.634,0,12.6C0,22.05,12,36,12,36s12-13.95,12-23.4C24,5.634,18.634,0,12,0z"/>\n<path class="svg-bgr" fill="#FFFFFF" d="M12.001,21.316c-4.969,0-9.001-4.031-9.001-9s4.032-9,9.001-9c4.968,0,8.999,4.032,8.999,9\n	S16.969,21.316,12.001,21.316z"/>\n<% if(type == \'fuel\') {%>\n<path class="svg-path svg-path-fuel" d="M18.084,8.223l-1.499-0.836c-0.37-0.207-0.821-0.04-1.007,0.374c-0.185,0.414-0.035,0.916,0.336,1.122l0.344,0.192\n	c0.034,0.571,0.321,1.063,0.741,1.335v4.833c0,0.23-0.168,0.418-0.375,0.418s-0.375-0.188-0.375-0.418v-3.345\n	c0-1.384-1.009-2.51-2.25-2.51v-2.09c0-0.923-0.672-1.674-1.499-1.674H8.75c-0.827,0-1.5,0.75-1.5,1.674v9.271l-0.53,0.592\n	C6.579,17.318,6.5,17.53,6.5,17.752v0.418c0,0.461,0.336,0.836,0.75,0.836h6.749c0.414,0,0.751-0.375,0.751-0.836v-0.418\n	c0-0.222-0.079-0.435-0.221-0.591l-0.53-0.592v-5.507c0.414,0,0.751,0.374,0.751,0.836v3.345c0,1.153,0.842,2.091,1.874,2.091\n	c0.981,0,1.782-0.85,1.859-1.922c0.011-0.055,0.017-0.111,0.017-0.169V8.971C18.5,8.655,18.338,8.364,18.084,8.223z M12.5,10.644\n	H8.75V8.136h3.75V10.644z"/>\n<% } else if(type == \'engine\') { %>\n	<path class="svg-path svg-path-engine" d="M19.254,10.738h-0.328c-0.137,0-0.247,0.111-0.247,0.247v4.279c0,0.135,0.11,0.246,0.247,0.246h0.328\n	c0.136,0,0.246-0.11,0.246-0.246v-4.279C19.5,10.849,19.39,10.738,19.254,10.738z M4.747,10.53c-0.136,0-0.247,0.11-0.247,0.247\n	v4.697c0,0.136,0.111,0.247,0.247,0.247h0.669c0.136,0,0.247-0.111,0.247-0.247v-4.696c0-0.135-0.111-0.246-0.247-0.246H4.747V10.53\n	z M14.109,16.472c0.55-0.213,1.096-0.433,1.644-0.646c0.049-0.019,0.105-0.025,0.158-0.027c0.405-0.002,0.812-0.002,1.216-0.002\n	c0.42,0,0.689-0.27,0.689-0.695v-1.389c0-0.1,0.081-0.178,0.179-0.178l0.176-0.005c0.139,0,0.146-0.054,0.151-0.15l0.003-0.807\n	c0-0.081-0.064-0.145-0.146-0.145h-0.188c-0.1,0-0.18-0.081-0.18-0.181l0.006-1.685c0.005-0.25-0.097-0.421-0.288-0.559\n	c-0.328-0.237-1.296-0.924-1.454-1.025c-0.108-0.071-0.227-0.099-0.359-0.098L14.048,8.88c-0.143,0-0.258-0.115-0.258-0.257V8.571\n	c0-0.144,0.117-0.261,0.261-0.261h1.513c0.144,0,0.261-0.117,0.261-0.26V7.748c0-0.144-0.117-0.26-0.261-0.26h-5.022\n	c-0.144,0-0.261,0.117-0.261,0.26V8.05c0,0.144,0.117,0.26,0.261,0.26h1.637c0.144,0,0.261,0.117,0.261,0.261v0.06\n	c0,0.142-0.115,0.259-0.26,0.257l-1.653-0.006c-0.315-0.009-0.575,0.098-0.814,0.271C9.361,9.408,9.017,9.67,8.673,9.932\n	c-0.087,0.066-0.196,0.103-0.305,0.101c-0.331-0.003-0.663-0.003-0.995,0c-0.412,0.003-0.678,0.269-0.682,0.682l0.005,1.151\n	c0,0.098-0.079,0.178-0.178,0.178H6.363c-0.188,0-0.34,0.152-0.34,0.34v1.824c0,0.188,0.152,0.339,0.34,0.339h0.149\n	c0.098,0,0.178,0.079,0.178,0.178c0,0.262-0.001,0.75,0,1.033c0,0.262-0.004,0.754,0.476,0.754h6.733\n	C13.971,16.513,14.045,16.499,14.109,16.472z"/>\n    <% } else if(type == \'accesscard\') { %>\n    <rect x="5.5" y="7.5" width="13" height="10" rx="0.5" fill="#FFFFFF" stroke="#009000"/>\n    <rect x="7" y="9" width="4" height="1" fill="#009000"/>\n    <rect x="7" y="12" width="4" height="1" fill="#009000"/>\n    <rect x="7" y="15" width="4" height="1" fill="#009000"/>\n    <rect x="12" y="13" width="5" height="5" rx="1" fill="#009000"/>\n    <circle cx="14.5" cy="10.5" r="1.5" fill="#009000"/>\n<% } else if(type == \'switch\') { %>\n	<path class="svg-path svg-path-switch" d="M5.653,8.992l4.039-4.039l4.039,4.039h-2.885v4.615H8.538V8.992H5.653z M18.347,15.915l-4.039,4.039l-4.039-4.039h2.885\n	v-4.615h2.309v4.615H18.347z"/>\n<% } %>\n</svg>\n'}),define("_common/reports/views/ReportView",["jquery","underscore","jface","moment","util","abstracts/View","text!../tmpl/report.html","text!../tmpl/reportHeader.html","text!_common/tmpl/itemsList.html","text!../tmpl/reportMeta.html","text!../tmpl/table.html","text!../tmpl/popup.html","text!../tmpl/pins.svg"],function(e,t,n,i,r,o,a,s,l,d,c,m,u){a=t.template(a),s=t.template(s),l=t.template(l),d=t.template(d),c=t.template(c),m=t.template(m),u=t.template(u),i.locale(App.getLocale().substr(0,2));var p={FUEL_BAND:"rgba(90,200,30,0.20)",DISCHARGE_BAND:"rgba(210,20,0,0.20)",PARK_BAND:"rgba(140,160,200,0.25)",PARK_IGN_BAND:"rgba(210,210,0,0.25)"},h=o.extend({FIX_HEADER:!0,constructor:function(){this.container=null,this.header=null,this.content=null,this.footer=null,this.table=null,this.fixed=null,this.mobileProps={},this._parentView=null,this._markers=null,this._markerId=0,this._markerData={},this._jsOffset=0,this._tzName="",o.apply(this,arguments)},initialize:function(e){if(!e||!e.container)throw new Error("No container for report view");var t=this;this._i18n=this.model.getTexts(),this.container=e.container,this._parentView=e.parentView;var n=60*App.getUserTimezone();if(this._jsOffset=n,this.model.has("tzId")){var i=App.getTimezone({id:this.model.get("tzId")});this._jsOffset=i.offset,this._jsOffset!=n&&(this._tzName=App.getFullTimezoneName(i))}this.mobileProps={extId:this._i18n.objIdNumber,name:this._i18n.objName,groups:this._i18n.objGroup,carId:this._i18n.licenseNumber,model:this._i18n.objModel,type:this._i18n.vehicleType,vin:this._i18n.objVin,year:this._i18n.objYear,deviceTypeName:this._i18n.objHardwareType},this.listenTo(this.model,"remove",function(){t.stopListening(t.model),t.remove(),t._markers&&t._markers.trigger("destroy"),t._markers=null}).listenTo(this.model,"afterrender",function(e){e.onAfterRender()}),this.listenTo(App,"clearmap",function(e){t.model.get("module").getMapsModule()==e?(t.$el.find(".clear-map-link").addClass("hidden"),App.trigger("clearmap",t.model.getTracksModule())):t.model.getTracksModule()==e&&t._markers&&t._markers.trigger("destroy")&&(t._markers=null)}),this.$el.data("id",this.model.id)},bindScrollEvents:function(){this.$el.find(".box-content").on("scroll",t.bind(t.throttle(this.onReportScroll,60),this)),this.listenTo(this.model,"resizepane",t.bind(t.throttle(this.onResizePane,60),this))},unBindScrollEvents:function(){this.$el.find(".box-content").off("scroll"),this.stopListening(this.model,"resizepane")},render:function(){this.$el.append(s({id:this.model.id,title:this.model.get("name"),i18n:this._i18n})).append(a({id:this.model.id,i18n:this._i18n})).appendTo(this.container),this.header=this.$el.find(".rep-header"),this.content=this.$el.find(".rep-content"),this.footer=this.$el.find(".rep-footer"),"Blob"in window||this.footer.find(".export-link").remove()},onAfterRender:function(){this.FIX_HEADER&&(this._createHeaderClones(),this.bindScrollEvents()),n.growl.open(this.model.get("name")+" "+this._i18n.hasBeenBuilt)},putFuelMarker:function(e){if(e){var t=this.putMarkers([e],{icon:new L.PinIcon({html:u({type:"fuel"}),addClassName:"fuel-marker "+(e.delta<0?" negative":"")}),popup:{type:"fuelChange",className:"track-info fuel-change-info"+(e.delta<0?" negative":""),offset:[0,-25]},zoom:!0});return t}},putMarkers:function(e,t){if(e.length){var n,i,r,o,a=this.model.get("module").getMapsModule(),s=[],l=[[90,180],[-90,-180]];this._buildMarkersLayer(t);for(var d=0,c=e.length;c>d;++d)n=e[d],n.lat&&n.lon&&(o=n.lon,r=n.lat,t.zoom&&(r>l[1][0]&&(l[1][0]=r),r<l[0][0]&&(l[0][0]=r),o>l[1][1]&&(l[1][1]=o),o<l[0][1]&&(l[0][1]=o)),i=a.buildMarker({lat:r,lon:o,icon:t.icon||null,className:t.className||"",data:n}),this.bindPopup(i,{data:n,options:t}),s.push(i));return this._markers.addLayers(s),t.zoom&&a.fitBounds(l),s}},bindPopup:function(n,i){var r=this,o=i.data,a=i.options;n.bindPopup(function(){if(a.popup&&a.popup.wraperClassName){var n=this.getContainer();e(n).addClass(a.popup.wraperClassName)}return m(t.extend({},o,a.popup,{beginS:"begin"in o?r.formatDateTime(o.begin):"",addressStr:o.address?o.address:Math._round(o.lat,4)+", "+Math._round(o.lon,4),i18n:r._i18n}))},a.popup)},hide:function(){this.unBindScrollEvents(),this.$el.addClass("hidden"),this.model._tracksModule&&this.model._tracksModule.hideAll(),this._markers&&this._markers.trigger("hide")},show:function(){this.$el.removeClass("hidden"),this.model._tracksModule&&this.model._tracksModule.showAll(),this._markers&&this._markers.trigger("show"),this.bindScrollEvents(),this._copyWidth()},buildMetaInfo:function(){this.content&&(this.model.getTexts(),this.content.append(this._renderMetaInfo()))},getZoneStr:function(){var e=this.model.getTexts(),t=void 0,n=this.model.get("header");return n&&n.zones&&(t=e.geofenceViolations+": ",n.zones.forEach(function(e,i){e.name&&(t+=e.name),i<n.zones.length-1&&(t+=", ")})),t},_renderMetaInfo:function(){var e=this.model.getTexts(),t=this.getZoneStr();return d({objectsList:this._renderObjectsList(),startTime:this.model.get("startTime"),endTime:this.model.get("endTime"),tzName:this._tzName,zonesStr:t,i18n:e})},_renderObjectsList:function(){var e=this.model.getTexts();return l({items:this.model.get("items"),i18n:e,limit:3})},_buildMarkersLayer:function(e){var t=this.model.get("module").getMapsModule();this._markers||(e=e||{},this._markers=t.addLayersGroup({layers:[],clusters:!1,popup:e.popup||!1,events:e.events||!1}))},_initMarkersLinks:function(t){var n=this;this.content.on("click",".put-marker",function(){var i=e(this),r=i.data("id"),o=i.closest(".report");return r in n._markerData&&(o.find(".clear-map-link").removeClass("hidden"),t.call(n,n._markerData[r])),!1})},getDaysPeriods:function(e,t){var n="",r={},o=i(e*App.MS).utcOffset(this._jsOffset),a="YYYY-MM-DDT00:00:00";a+=Date.offsetToString(this._jsOffset);var s,l=i(o.format(a)),d=l.valueOf()/App.MS,c=null;for(this.model.has("filterDays")&&(c=this.model.get("filterDays"));t>d;)n=d.toExponential().toUpperCase().replace("+",""),null!==c?(s=new Date(1e3*d).getDay(),c.indexOf(0===s?7:s)>=0&&(r[n]=d)):r[n]=d,d+=86400;return r},formatDistance:function(e){return new Number(e).toFixed(2)},formatUTC:function(e,t){var n=i(t).utcOffset(this._jsOffset);return n.format(e,t)},formatDateTime:function(e){return this.formatUTC("DD.MM.YYYY HH:mm:ss",e instanceof Date?e:e*App.MS)},formatDate:function(e){return this.formatUTC("DD.MM.YYYY",e instanceof Date?e:e*App.MS)},formatTime:function(e){return this.formatUTC("HH:mm:ss",e instanceof Date?e:e*App.MS)},formatSeconds:function(e){return Date.formatSeconds(e)},getDayOfWeek:function(e){return this.formatUTC("dddd",e instanceof Date?e:e*App.MS)},isWeekend:function(e){return this.formatUTC("E",e instanceof Date?e:e*App.MS)>5},buildObjectTitleByProperties:function(e){var n="";if(e.name)n=e.name;else{var i=[];t.each(["type","model","licenseNumber"],function(t){e[t]&&i.push(e[t])}),n=i.join(", ")}return e.extId&&(n=n.length?n+" (#"+e.extId+")":"#"+e.extId),n||"noname"},_getOffsetTop:function(e){var t=0;if(e)for(;!(null==e||e.hasAttribute("class")&&e.getAttribute("class").match(/box-content/));)t+=e.offsetTop,e=e.offsetParent;return t},_copyWidth:function(){if(this.headers&&this.headers[0]){var n;t.each(this.headers,function(t){t.$origin.each(function(i){t.$clone&&(n=e(t.$clone.get(i)).find("th"),e(this).find("th").each(function(t){e(n.get(t)).width(e(this).width())}))})}),this.$el.find(".fixed-header").width(this.headers[0].$origin.closest("table").width())}},_createHeaderClones:function(){var n,i=this,r=this.$el.find(".fixed-header"),o=0,a=[];r.html(""),this.$el.find("tr[data-head]").each(function(){this.getAttribute("data-head")==o?a[a.length-1].$origin=a[a.length-1].$origin.add(this):(o++,a.push({$clone:null,$origin:e(this),index:o,first:null,last:null,top:0,bottom:0}))}),t.each(a,function(e){e.first=e.$origin.first().get(0),e.last=e.$origin.last().nextAll("[data-row=last]").first().get(0),e.last&&e.first&&(e.top=i._getOffsetTop(e.first),e.bottom=i._getOffsetTop(e.last)+e.last.offsetHeight,r.append(c({index:e.index})),n=r.find("[data-table="+e.index+"] thead"),n.append(e.$origin.clone()),e.$clone=n.find("tr"))}),this.headers=a,this._copyWidth()},defineVisibilities:function(){if(this.headers){var e=this,n=this.$el.find(".box-content"),i=n.get(0).scrollTop;t.each(this.headers,function(t){t.first&&t.last&&(t.top=e._getOffsetTop(t.first),t.bottom=e._getOffsetTop(t.last)+t.last.offsetHeight,i>t.top&&i<t.bottom?t.$clone.closest("table").removeClass("hidden"):t.$clone.closest("table").addClass("hidden"))})}},onReportScroll:function(){this.defineVisibilities()},onResizePane:function(){this.headers&&(this._copyWidth(),this.defineVisibilities())},onAddressLoad:function(e,t){if(!t.geoId)return!1;for(var n=this.$el.find(".loading-address[data-geoid="+t.geoId+"]"),i=e&&e.address||this._i18n.addressNotFound,r=n.length,o=i.indexOf(this._i18n.addressNotFound)>-1;r--;)if(o){var a=n[r].parentNode,s=parseFloat(a.dataset.lat).toFixed(6),l=parseFloat(a.dataset.lon).toFixed(6),d=this._i18n.addressNotFound+" ["+s+","+l+"]";a.innerHTML=d}else n[r].parentNode.innerHTML=i},_getChartColors:function(){return p},_prepareWideReportFixedHeader:function(){var e=this.content.find("tbody"),t=this.$el.find(".box-content"),n=this.$el.find(".fixed-header");e.width()<t.width()?this.$el.find(".rep-table").width("100%"):(n.prependTo(t),n[0].style.margin="0px",t.on("scroll",function(){n[0].style.top=t[0].scrollTop+"px"}))},_initAddressesRequests:function(){var t=this.model,n=t.getTexts();this.content.on("click",".load-address",function(i){var r=e(this),o=r.data("geoid");return i.stopPropagation(),o?(r.removeClass("load-address").addClass("loading-address").text(n.loadingAddress),t.searchAddresses([{geoId:o,lat:r.data("lat"),lon:r.data("lon")}])):r.replaceWith("<span>"+n.error+"</span>"),!1})}});return h}),define("text!_common/reports/tmpl/reports.html",[],function(){return'<li id="reports" class="<% if(loading) {%>loading<% } %><% if(active) {%> active<% } %>">\n    <div class="tab-toggle-container hint hint-right" data-hint="<%= name %>">\n        <a class="tab-toggle" href="#<%= key %>">\n            <svg class="svg-icon">\n                <use xlink:href="#smb-report"></use>\n            </svg>\n            <span><%- name %></span>\n        </a>\n    </div>\n    <div id="reports-content" class="tab-hor-content">\n        <div class="box-header module-header append">\n            <h2>\n                <%= i18n.reportsCountText.replace(\'#n#\', \'<span class="nb-items">0</span>\') %>\n            </h2>\n            <div class="dropdown module-settings add-on">\n                <a class="dropdown-toggle" data-toggle="dropdown" href="javascript:;">\n                    <i class="svg-icon svg-icon-cog"></i>\n                </a>\n                <ul class="dropdown-menu nav nav-list" role="menu">\n                    <li>\n                        <a class="remove-all" href="javascript:;"><%= i18n.clearReportsList %></a>\n                    </li>\n                </ul>\n            </div>\n            <% if(adding) {%>\n            <div class="add-on">\n                <a class="btn-add" href="javascript:;" title="<%= i18n.add.ucFirst() %>">\n                    <i class="svg-icon svg-icon-plus"></i>\n                </a>\n            </div>\n            <% } %>\n        </div>\n        <div class="module-content reports-list">\n            <ul class="items-briefs">\n\n            </ul>\n        </div>\n    </div>\n</li>\n\n'}),define("text!_common/reports/tmpl/settings.html",[],function(){return'<h3><%= i18n.reportsSettings %></h3>\n\n<!--<div class="params-group">\n    <h4><%= i18n.speedLimitsSettings %></h4>\n    <div class="control-group msl form-horizontal">\n        <ul>\n            <li class="field"><label><%= i18n.speedLimit %> 1</label>\n                <input type="text" class="input-mini positive" value="<%= speedLimits[0] %>" name="speedLimit1" data-index="0" /> <%= i18n.kmh %>\n            </li>\n            <li class="field"><label><%= i18n.speedLimit %> 2</label>\n                <input type="text" class="input-mini positive" value="<%= speedLimits[1] %>" name="speedLimit2" data-index="1" /> <%= i18n.kmh %>\n            </li>\n        </ul>\n    </div>-->\n<!--</div>/params-group-->\n\n<div class="params-group">\n    <h4><%= i18n.reportsObjectsSort %></h4>\n    <div class="control-group">\n        <ul>\n            <li>\n                <label class="radio"><input type="radio" name="objectsSortType" value="name"\n                    <% if(objectsSort == \'name\'){ %> checked<% } %>> <%= i18n.byName %></label>\n                <label class="radio"><input type="radio" name="objectsSortType" value="extId"\n                    <% if(objectsSort == \'extId\'){ %> checked<% } %>> <%= i18n.byId %></label>\n            </li>\n        </ul>\n    </div>\n</div><!--/params-group-->\n\n<div class="params-group">\n    <h4><%= i18n.showingOfTracksSegments %></h4>\n    <div class="control-group mrtsm">\n        <ul>\n            <li>\n                <label class="radio">\n                    <input type="radio" name="tracksSegmentsMode"\n                    value="all"<% if(tracksSegmentsMode == \'all\'){ %> checked<% } %>><%= i18n.showAllSelectedSegments %>\n                </label><label class="radio">\n                <input type="radio" name="tracksSegmentsMode"\n                       value="last"<% if(tracksSegmentsMode == \'last\'){ %> checked<% } %>><%= i18n.showLastSelectedSegment %>\n                </label>\n            </li>\n        </ul>\n    </div>\n</div><!--/params-group-->\n\n<div class="params-group">\n    <h4><%= i18n.reportsList %></h4>\n    <div class="mrhr" data-setting="mobile.reports.hiddenReports">\n        <ul class="report-groups">\n            <% _.each(reportsGroups, function(items, key){\n            if( !items.length ) return;\n            %>\n            <li>\n                <h5 class="report-group-name"><%= i18n.reportGroupNames[key] %></h5>\n                <ul class="report-group-items">\n                    <% _.each(items, function(reportType){\n                    if( ( !App.hasModule(\'mobile\') && reportType.objType == \'mobile\' )\n                    || ( !App.hasModule(\'stat\') && reportType.objType == \'stat\') ) return;\n                    %>\n                    <li data-objectstype="<%= reportType.objType %>"><label class="checkbox"><input type="checkbox" value="<%=reportType.key%>"\n                        <% if(_.indexOf(hiddenReports, reportType.key) == -1){ %> checked<% } %> /> <%= reportType.name %></label></li>\n                    <% }) %>\n                </ul>\n            </li>\n            <% }) %>\n        </ul>\n    </div>\n</div><!--/params-group-->\n\n'
}),define("_common/reports/views/ReportsListView",["jquery","underscore","jface","abstracts/View","_common/reports/views/ReportListView","_common/reports/views/ReportView","text!_common/reports/tmpl/reports.html","text!_common/reports/tmpl/settings.html"],function(e,t,n,i,r,o,a,s){a=t.template(a);var l=i.extend({constructor:function(){this._container=null,this._content=null,this._activeView=this,i.apply(this,arguments)},initialize:function(t){var n=this;this.listenTo(this.model,"activate",function(){n.$el.addClass("active")}).listenTo(this.model,"deactivate",function(){n.$el.removeClass("active"),n._activeView&&n._activeView.hide()}).listenTo(this.model.items,"add",function(e){var t=new r({tagName:"li",className:"item-brief report-brief",model:e});t.render(n.$el.find("ul.items-briefs"));var i=n.$el.find(".reports-list");i.scrollTop(i[0].scrollHeight),n.$el.find(".nb-items").text(n.model.items.length)}).listenTo(this.model.items,"remove",function(){n.$el.find(".nb-items").text(n.model.items.length)}),e("#settings").length?d.initSettings.call(this):this.listenTo(App,"settingsready",function(){d.initSettings.call(n)}),this.render(t)},render:function(n){var i=this.model.getTexts();null==this._container&&(this._container=n.container);var r=a({i18n:this.model.getTexts(),loading:!0,active:!1,key:this.model.id,name:i.reports.ucFirst(),adding:this.model.get("options").addFromList});this._container.find("[data-placeholder="+n.placeholder+"]").replaceWith(r),this.setElement(this._container.find("#reports")),this._content=this.$el.find("#reports-content");var o=this;this.$el.find('.tab-toggle[href="#reports"]').on("click",function(){return o.model.get("active")&&o.model.activeReport?(o.showList(),!1):void 0}),this.$el.on("click",".view-report",function(){if(e(this).closest(".item-brief").is(".loading"))return!1;var t=e(this).data("item");return o.model.viewReport(t),!1}).on("click",".back",function(){var n;if(n=o.model.items.get(e(this).closest(".report").data("id"))){var i=null,r=n.get("source");t.isNumber(r)?i=o.model.items.get(r):t.isObject(r)&&(i=o.model.items.get(r.id)),i?o.model.viewReport(i.id,i.get("source")):o.showList()}else o.showList()}).on("click",".btn-delete",function(){var t=o.model.items.get(e(this).data("id"));o.model.items.remove(t),o.showList()}).on("click",".btn-delete, .report-brief .remove-link",function(){var t=o.model.items.get(e(this).data("id"));o.model.items.remove(t)}).on("click",".remove-all",function(){o.model.items.remove(o.model.items.models),o.$el.find(".nb-items").text("0")}).on("click",".btn-add",function(){App.trigger("needreport")}).on("click","[data-toggle=dropdown]",function(){e(this).dropdown()}).on("click",".build-another",function(e){return e.stopPropagation(),d.buildAnother.call(o,this),!1}).on("click",".summary .build-track",function(){if(d.buildTrack.call(o,this)){var n=e(this);n.one("loadsuccess",function(e,i){if(i){var r=t.isArray(i)?i[0]:i;n.data("trackId",r.id);var a=n.closest(".sum-header");a.find(".clear-map-link").removeClass("hidden"),a[0].style.borderBottom="2px solid "+r.get("color"),o.listenToOnce(r,"remove",function(){a[0].style.borderBottom="1px #aaa dotted"})}})}return!1}).on("click",".build-track-segment",function(){var n=e(this),i=n.data("trackId"),r=o.model.items.get(n.closest(".report").data("id"));return i&&r?r.removeTrackSegment(i):d.buildTrack.call(o,this)&&n.one("loadsuccess",function(e,i){if(i){var r=t.isArray(i)?i[0]:i;n.closest(".report").find(".clear-map-link").removeClass("hidden"),n.data("trackId",r.id);var a=n.closest("td");a[0].style.borderBottom="2px solid "+r.get("color"),o.listenToOnce(r,"remove",function(){a[0].style.borderBottom="0",n.removeData("trackId")})}}),!1}).on("click",".put-fuel-marker",function(){var t,n=e(this),i=n.closest(".report");return(t=o.model.items.get(i.data("id")))&&(i.find(".clear-map-link").removeClass("hidden"),t.getView().putFuelMarker(n.data("fuelChange"))),!1}).on("click","a[data-geozoneid]",function(){return App.modules.geozones&&App.modules.geozones.zoomToZone(e(this).data("geozoneid")),!1}).on("click",".chart-switcher",function(){var t=e(this),n=t.closest(".rep-chart");return n.length&&(n.is(".closed")?n.removeClass("closed").trigger("chart.show"):n.addClass("closed").trigger("chart.hide")),!1}).on("click",".rep-settings input[type=text], .rep-settings select",function(e){e.stopPropagation()}).on("click",".clear-map-link",function(){var t,n=e(this).addClass("hidden"),i=n.closest(".report").data("id");(t=o.model.items.get(i))&&App.trigger("clearmap",t.getTracksModule())}),"Blob"in window&&this.$el.on("click",".export-link",function(){var t,n=e(this);return(t=o.model.items.get(n.closest(".report, .report-brief").data("id")))&&t.exportTo(n.data("format")).done(function(){}).fail(function(t){var n,r=i.error,o=i.canNotExportReport;t&&t.responseText&&(n=e.parseJSON(t.responseText))?(o=n.msg,n.hdr!=n.msg&&(r=n.hdr)):"string"==typeof t&&(o=t),alert(o,r)}),!1}),this.$el.removeClass("loading")},showList:function(){this._activeView&&this._activeView.hide(),this.model.activeReport=null,this._activeView=null,this.model.publish("viewlist"),this._content.removeClass("hidden")},viewReport:function(e){this._activeView&&this._activeView.hide(),this._container.find("#report-"+e.id).length?(this._activeView=e.getView(),this._activeView.show()):this._activeView=e.buildView(),this.hide()},hide:function(){this._content.addClass("hidden")}}),d={buildAnother:function(t){var n,i=e(t),r=i.closest(".report").data("id")||null;if(!(n=i.data("reportId"))||!this.model.viewReport(n,r)){var o=i.data("type"),a=i.data("id"),s=i.data("from"),l=i.data("to")||null,d=App.getAllowedReports();if(!(o&&a&&s&&o in d))return!1;var c=this.model.items.get(r),m=60*App.getUserTimezone(),u=m;if(c.has("tzId")){var p=App.getTimezone({id:c.get("tzId")});u=p.offset}var h=6e4*(u-m);s+=h,l+=h;var f={sourceElement:i,type:o,objectId:[a],startTime:s,endTime:l,source:r||null};c.has("tzId")&&(f.tzId=c.get("tzId")),c.has("timeRanges")&&(f.timeRanges=c.get("timeRanges")),"movepark"===o?(f.showMoves=!0,f.showParks=!0):o.indexOf("zone")>-1?f.zoneId=[i.data("geozoneid")]:"alerts"===o?f.alertGroupId=c.get("alertGroupId")||[]:/temperature|voltage|engspeed/i.test(o)?f.rangesOfInterest=i.data("ranges")||[]:/acceleration/i.test(o)?(f.showAccel=i.data("acc")||!1,f.showBraking=i.data("brk")||!1):/speeding1b/i.test(o)&&(f.minExceedValue=i.data("min"),f.maxExceedValue=i.data("max")||1e4,f.isPercents=i.data("percents")),App.trigger("needreport",this.model.get("objType"),f)}},buildTrack:function(t){var n=e(t),i=n.data("id"),r=n.data("from"),o=n.data("to");if(n.is(".loading"))return!1;if(!i||!r||!o)return!1;var a;return(a=this.model.items.get(n.closest(".report").data("id")))?(a.buildTrackSegment({trackId:n.data("trackId")||null,objectId:[i],startTime:r,endTime:o,sourceElement:n}),n.one("loadstart",function(){n.addClass("loading")}).one("loadcomplete",function(){n.removeClass("loading")}),!0):!1},initSettings:function(){var n=this,i=e("#settings").find("#reports-settings"),r=App.getAllowedReports();i.html(t.template(s,{i18n:this.model.getTexts(),speedLimits:this.model.getSpeedLimits(),accLimits:this.model.getAccLimits(),objectsSort:this.model.getObjectsSort(),tracksSegmentsMode:this.model.getTracksSegmentsMode(),allReports:App.getAllowedReports(),reportsGroups:t.groupBy(r,"group"),hiddenReports:this.model.getHiddenReports()})),e.fn.numeric&&(i.find(".decimal").numeric({decimal:".",negative:!0}),i.find(".positive").numeric({decimal:".",negative:!1})),i.find("input[name=objectsSortType]").on("click",function(){this.checked&&n.model.setObjectsSort(this.value)}),i.find("input[name=tracksSegmentsMode]").on("click",function(){this.checked&&n.model.setTracksSegmentsMode(this.value)}),i.find(".mrhr input").on("click",function(){n.model.setHiddenReport(this.value,!this.checked)})}};return l}),define("_common/reports/nls/reports",{root:{reportsSettings:"Report options",reportPeriod:"Report period",geofenceViolations:"Speeding in geofences",clearReportsList:"Clear the list",reportsCountText:"#n# generated",speedLimitsSettings:"Speeding detection",speedLimit:"Threshold",speedLimitThreshold:"Threshold for speeding detection",speedLimitExt:"Speed limit",exceedStart:"Start of the speeding",exceedValue:"Speeding magnitude",exceedValueInUnits:"Speeding magnitude in #units#",reportsObjectsSort:"Sorting objects in reports",showingOfTracksSegments:"Showing segments of tracks",showAllSelectedSegments:"Show all selected",showLastSelectedSegment:"Show last selected only",byName:"By object name",byId:"By object ID",dayAndObject:"Day/Object",exportToExcel:"Export to Excel",exportToPdf:"Export to pdf",aggressiveDrivingDetection:"Detection of aggressive driving style",accIntensityMoreThan:"Acceleration amount more than",brakingIntensityMoreThan:"Rate of braking more than",detailReport:"Report details",showSharpAcceleration:"Show hard acceleration",showSharpBraking:"Show hardbraking",showSharpCornering:"Show fast cornering",showTimeAndPlaceOfViolation:"Show time and location of every violation",reportsList:"Report list",createScheduleTask:"Add new report",showRunDistanceOnEveryDay:"Show millage for each day",showAllMoves:"Show circulation areas",showAllParks:"Show parkings",showAddress:"Show address/coordinates",moveStart:"Start of driving",moveEnd:"End of driving",moveTime:"Driving time",moveStartEndTime:"Start time and end time of driving",moveStartTime:"Start time of driving",moveEndTime:"End time of driving",moveStartEndPlace:"Start location and end location of driving",moveStartPlace:"Start location of driving",moveEndPlace:"End location of driving",parkTime:"Parking time",avgSpeed:"Average speed",calcConsumBy100kmNorm:"Consumption by standards for 100 km",calcConsumBy1hNorm:"Consumption by standards for 1 h",sumConsumBy100kmNorm:"Summary fuel consumption by standard for 100 km",sumConsumBy1hNorm:"Summary fuel consumption by standard for 1 h",runExtraParamsWarning:"Detection of start and end driving points will significantly delay report creation.",action:"Action",movement:"driving",movementParameters:"Driving parameters",park:"parking",actionStart:"Start",actionEnd:"End",actionTime:"Duration",parkAddress:"Parking location",totalTime:"Total time",totalParkTime:"Total parking time",totalMoveTime:"Total driving time",wayTime:"Driving time",totalDistance:"Total mileage",maxSpeed:"Max speed",placeOfMax:"Speeding location",loadingAddress:"Address loading...",loadAddress:"Load address",showFullTrack:"Show full track",removeReport:"Remove report",notAvailable:"unavailable",dateAndTime:"Date and time",duration:"Duration",totalDuration:"Total duration",avgValue:"Average value",below:"Below",above:"Above",lessThan:"Less than",moreThan:"More than",belowAllowedLevel:"Below allowed level",aboveAllowedLevel:"Above allowed level",minimum:"Min",maximum:"Max",distanceWhile:"Mileage with #t#",vehicleNumber:"Vehicle number",name:"Name",rev:"Device version",glonassLosesCount:"Number of GLONASS losses",glonassLostPoint:"GLONASS loss time",glonassRestorePoint:"GLOMNASS restore time",losesLesser10min:"Losses less than 10 min",losesLonger10min:"Losses longer than 10 min",losesLonger30min:"Losses longer than 30 min",onlineTime:"Online time",offlineTime:"Offline time",minExceedTime:"Minimum speeding time",noSpeedExceeds:"No speeding",totalSpeedLimitExceeds:"Total speedings",totalSpeedingsOfTheThreshold:"Total number of the threshold speedings",totalB1Exceeds:"Total number of the first threshold speedings",totalB2Exceeds:"Total number of the second threshold speedings",actionType:"Event type",placeOfAction:"Event location",acceleration:"Acceleration",deceleration:"Braking",objectReport:{connection:"Connection",connectionTime:"Connection time",coordinates:"Coordinates",coordinatesTime:"Fixture time",power:"Power supply",ignition:"Ignition",set:"Set",notSet:"Not set",missing:"Missing",detected:"Detected",coordsNotDetected:"Not defined",no:"None",turnedOn:"Turned on",turnedOff:"Turned off"},accesscardReport:{date:"Date",idCard:"ID-card",address:"Address / Coordinates",noData:"no data"},normalValue:"Standard",summary:"Summary",summaryData:"Summary",summaryByObject:"Summary by the object",summaryByDay:"Summary by the day",minTimeOfState:"Minimum operate time",minTimeOfStateHelp:"Minimum time required for sensor readings correction",onlySimultaneousTriggering:"Simultaneous actuating only",dataSource:"Data source",dataSourceCan:"Vehicle onboard computer",dataSourceFlowSensor:"Flow-through fuel consumption sensor",dataSourceCisternsFlowSensor:"Flow-through sensor for refuellers",useFlowCalculatedValues:"When connection to the vehicle onboard computer or fuel consumption sensors is not available use expected values based on the real mileage and fuel consumption rate in l/100km",analogSensorForReport:"Analog input for fuel calculation",removePointsOnParks:"Remove points at parkings",removePointsWithNoIgnition:"Remove points with ingnition off",colorChartDependingOnDiscret1:"Color the chart based on the state of the discrete input 1",deviceReport:{date:"Date",time:"Time",event:"Event",eventDuration:"Event duration",run:"Mileage",noData:"No data",deviceStatus:"State of sensors",beforePeriod:"at the beginning of the period",atthePeriod:"within the period",endPeriod:"at the end of the period",sensor:"Sensor",switchedon:"On",switchedoff:"Off",allSensors:"All sensors",allSwitchedOn:"All turned on",allSwitchedOff:"Partly turned on",runswitchedon:"Mileage turned on",runswitchedoff:"Mileage turned off",inclusions:"Number of starts",shutdowns:"Number of deactivations",emergencyPower:"Standby power supply",mainPower:"Main power supply",minDelay:"Selected minimum operate time"},externalSensorTemperature:"External sensor temperature",deviceTemperature:"Device temperature",coolerTemperature:"Cooling liquid temperature",allowedThresholds:"Valid operating range",allowedTemperature:"Valid temperature",minTemperature:"Minimum temperature",maxTemperature:"Maximum temperature",normTemperature:"Standard",violationCount:"Number of violations",factsWhenCount:"Number of segments with #cond#",violationDuration:"Duration of violations",outOfRangeDuration:"Duration out of #range#",violationDistance:"Mileage with violations",outOfRangeDistance:"Mileage out of #range#",minViolationTime:"Minimum time of violation",minOutOfRangeTime:"Out of valid range minimum time",summaryOutRangeWork:"Summary on operation out of valid range",showViolations:"Show violations",noViolations:"No violations",noFacts:"None",toggleDiagram:"#t# chart",toggleViolationChart:"#t# violation chart",toggleTemperatureTimeChart:"#t# temperature chart",vehicleVoltage:"Vehicle voltage",deviceVoltage:"Device battery voltage",allowedVoltageThresholds:"Valid voltage range",allowedVoltage:"Valid voltage",minVoltage:"Minimum voltage",maxVoltage:"Maximum voltage",toggleVoltageTimeChart:"#t# voltage time chart",engineOffState:"Engine off",engineIdleState:"Idle run",engineIdleStateShort:"Idle run",engineIdleStateUpto:"Idle upto",engineLoadState:"On-load operation",engineLoadStateShort:"On-load",engineCriticalRpm:"Extreme rates",engineCriticalRpmAbove:"Extreme rates above",engineCriticalRpmShort:"Extreme",noFactsOfCriticalRpm:"No extreme rates",toggleRpmTimeChart:"#t# chart of vehicle rates",violationOfCriticalRpm:"Extreme rates",splitData:"Split data",splitDataNone:"Do not split",splitDataDays:"By days",splitDataHours:"By houres",zoneReport:{numberZoneVisit:"Geofence visit #",numberCurrentObjVisit:"Object visit #",enterTime:"Time of entrance",exitTime:"Time of exit",timeInZone:"Time inside the geofence",timeOutZone:"Time outside the geofence",runBetweenZoneEnters:"Mileage between visits",visitsCount:"Number of visits",runInZone:"Mileage inside the geofence",runOutZone:"Mileage outside the geofence",firstEnter:"First entrance",lastExit:"Last exit"},geozonesVisitedOfTotal:"From #total# visited",dateTimeOfStart:"Starting date and time",dateTimeOfEnd:"End date and time",fuelsAndDischarges:"Refuelings and discharges",noFuelsOrDischarges:"No refuelings and discharges",beforeValue:"Was",afterValue:"Now",fuelVolumeInTank:"Fuel volume in the tank",startVolume:"Start volume",endVolume:"Final volume",minVolume:"Minimum volume",maxVolume:"Maximum volume",fillingsNumber:"Total refuelings",dayFillingsNumber:"Total refuelings during the day",fillingsVolume:"Refueling volume",dischargesNumber:"Total discharges",dayDischargesNumber:"Total discharges during the day",dischargesVolume:"Volume of discharges",totalFuelConsumption:"Total fuel consumption",fuelConsumption:"Fuel consumption",fuelConsumptionWhileMoving:"Fuel consumption while driving",avgConsumption:"Average consumption",totalRealConsumption:"Total consumption without discharges",consumption100km:"Total consumption",consumption1hIgn:"Total consumption per 1 operating hour",avgConsumption1hIgn:"Average consumption per 1 operating hour",consumWhileMoving:"Fuel consumption while driving",consumWhileMovingShort:"Consumption while driving",consumWhileMoving100km:"Consumption while driving for 100 km",consumption1h:"Consumption per 1 driving hour",engineParameters:"Engine operation parameters",engineWorkTime:"Engine operation time",engineWorkTimeWhileMoving:"Engine operation time while driving",engineWorkTimeOnParks:"Engine operating time on parkings",ignOnTime:"Total time of parkings with ignition on",ignOnParkTime:"Parkings with ignition on",ignOffParkTime:"Parkings with ignition off",ignOnMoveTime:"Driving with ignition on",firstIgnTime:"Engine operation starting time",lastIgnTime:"Engine operation end time",fuelTimeChartTitle:"Fuel versus time based on #source# data",fuelDistanceChartTitle:"Fuel versus mileage based on #source# data",fuelFlowChartTitle:"Fuel consumption in time",byNorm:"by standard",analogueSensor1:"sensor",analogueSensors1:"sensors",parksIgnOn:"Parkings with ignition on",averageCorner:"Medium cornering",agressiveCorner:"Hard cornering",timesAgressiveAcceleration:"Total number of the hard accelerations",timesAgressiveInhibition:"Total number of the hard brakings",timesAgressiveCorners:"Total number of the hard corners",timesAverageCorners:"Total number of the medium corners",scheduleTaskdeleteConfirmMsg:"Unable to restore the job",newReport:"New report",tasksCreationIsImpossible:"Creating of reports is not possible.",tasksEditIsImpossible:"Performing and editing of report is not possible.",propertiesReport:"Report properties",title:"name",reportObjType:"Object type",typeOfReport:"Report type",recipientEmails:"Recipient addresses",objectsWhichReport:"Objects for report creation",previousDay:"Previous day",previousWeek:"Previous week",previousMonth:"Previous month",currentMonth:"Current month",timezoneGenerateReport:"Time zone for report creation",scheduleReportGeneration:"Report creation schedule",startTime:"Start time",daily:"daily",selectedDaysOfWeek:"On selected week days",selectedDaysOfMonth:"On selected month days",reportParameters:"Report options",copyReportParameters:"The report parameter copying",noTasksToCopyReportParameters:"Reports not found for copying",copyReportParametersError:"Failed to copy the report parameters",runImmediately:"Start now",noInfo:"No additional options",allDone:"All right",taskRun:"Job Started",taskSaved:"Job saved",taskDeleted:"Job deleted",objectInZoneTrue:"The object inside the geofence",objectInZoneFalse:"The object outside the geofence",objectInZoneUndefined:"The object inside or outside the geofence",objectFault:"Object fault",noGsmSignalTime:"Offline more than",noGpsSignalTime:"No coordinates more than",timeOfLastAlert:"Last event time",noAlerts:"No events",noAlertsLastTime:"No events more than",noObjectsWithFaultsForReport:"No faulty objects to show in the report",sumOfObjectsWork:"Object operation summary",sumOfObjectsMovesParks:"Mileage and parking summary",showReportDataOnEveryDay:"Show data for each day",selectedAlertGroup:"Selected event group",selectedAlertGroups:"Selected event groups",noSelectedAlertGroups:"No event group selected",totalAlertsAndAlarms:"Total events and alarms",errCanNotBuildReport:"Failed to generate the report due to the server error. Please try again later.",errMaxObjectsForExport:"Maximum number of objects to export this report - #max# (#t# selected).",errSingleObjectOnly:"This report can be created only by one object.",errLongReportPeriod:function(e){var t=["day","days"];return this.whichLabels(e),"Building this report for a period exceeding "+e+"&nbsp;"+t[this.whichLabels(e)]+" is not possible."},errEnterReportName:"Enter report name",errReportNamePattern:'The name cannot contain the <span class="nobr">\\/?%*:|".<></span>characters',errEnterTaskEmails:"Enter at least one email",errEnterTaskEmailsPattern:"Invalid emails:",errEnterCorrectStartTime:"Select valid start time",errslectDaysOfWeek:"Select at least one day of week",errslectDaysOfMonth:"Select at least one day of month",errLimitRequired:"Enter threshold value",errEnterLimitNotLessThan:'Value of the "#name#" field cannot be less than #min#',errMintimeRequired:"Enter time value",errSelectAtLeastOneSensor:"Select at least one sensor.",errSelectAtLeastOneParameter:"Select at least one parameter.",volume:"volume",filling:"refueling",fillings:"refuellings",discharge:"discharge",discharges:"discharges",discretes:{metrics:"Output in a report",historyHeader:"Options status change history",countSwitch:"Number of switchings",countSwitchShort:"# of switchings",dataOn:"Data for on state",distanceOn:"Mileage with on state",distanceOnShort:"Mileage with On",dataOff:"Data for off state",distanceOff:"Mileage with off state",distanceOffShort:"Mileage with Off",periodOn:"Duration at on state",periodOnShort:"Duration at On",periodOff:"Duration at off state",periodOffShort:"Duration at Off"},errPointCoordsNotSpecified:"Points coordinates are not specified.",distanceReport:{timeRangeLabel:"Time range",selectedTimeLabel:"As at",noDataHeader:"There are no data on location of existing objects"},guardsCompleteCallsLabels:["finished visit","finished visits"],guardsComplteteCallsCountShort:"Number of finished visits",guardsNbComplteteCallsOnNbObjects:"Total #calls# to #objects#",drivesafety:{driveStyle:"Driving style",styleParameters:"Driving style indicators",acceleration:"Acceleration",braking:"Braking",speedKeeping:"Speed limits compliance",accelerationParameters:"Acceleration indicators",speedParameters:"Speed limits compliance indicators",accLimit:"Acceleration limit",brakingLimit:"Braking limit",accNumber:"Number of accelerations",brakingNumber:"Number of braking",weight:"Weight",value:"Value",penaltyPoint:"Penalty point",penaltyPoints:"Penalty points",mintime:"Minimum exceed time",mintimeSpeed:"Min speeding time",mintimeAcceleration:"Min acceleration/braking time",mileageWithExcess:"Mileage with speeding",numberOfSpeeding:"Number of speeding",useMileage:"Use the mileage with speeding",useQuantity:"Use the number of speeding",grade:"Grade",overallGrade:"Overall grade",drivingStyleGrade:"Driving style grade",speedingGrade:"Speed limits compliance grade",gradeExcellentDescription:"excellent",gradeGood:"Good",gradeGoodParamLabel:"Good, grade range, up to",gradeGoodLegend:"Good - up to",gradeGoodDescription:"acceptable",gradeMiddle:"Normal",gradeMiddleParamLabel:"Normal, grade range, up to",gradeMiddleLegend:"Normal - up to",gradeMiddleDescription:"requires corrections",gradeBad:"Bad",gradeBadLegend:"Bad - more than",gradeBadDescription:"dangerous",gradeUglyDescription:"inadmissible",objectStatistics:"Object statistics",objectsStatistics:"Objects statistics",showStatistics:"Show the Object statistics",showCalculation:"Counting scores tables",speedCalculation:"Speed limits compliance score counting",styleCalculation:"Driving style score counting",thresholdsSet:"Grades thresholds",speedings:"Speedings of",exceedingMoreThan:"Speeding more than",accelerations:"Accelerations more than",brakings:"Brakes more than",indicator:"Indicator",totalQuantity:"Total number",quantity100km:"Quantity per 100&nbsp;km",value100km:"Value per 100&nbsp;km",indicatorWeight:"Indicator weight",gradeByIndicator:"Score by indicator",penaltyPointsByIndicator:"Penalty points by indicator",summaryScore:"Final score",showSummary:"Summary chart",showTop:"Objects with the worst score",showList:"List of objects",withViolations:"with number of violations",withTotalScore:"with the final score",withViolationsAndTotalScore:"with number of violations and the final score",gradeByGroup:"Average score for the group",gradeDistributionbyObjects:"Distribution of objects' grades",objectsWithWorstScore:"Objects with the worst score",objectsList:"List of objects",objectsListWithTotalScore:"List of objects with a final score",objectsListWithViolationsNumber:"List of objects with the number of violations",speedScore:"Speed limits compliance score",accScore:"Driving style score"},drivesafety2020:{objectsWithWorstScore:"Objects with the worst score",gradeByGroup:"Average score for the group",speedCalculation:"Speed limits compliance penalty points and score counting",styleCalculation:"Driving style penalty points and score counting"},passQuantity:"Number of passengers",passQuantityExt:"Number of incomers and outcomers",sumPassQuantity:"Total number of passengers",sumPassQuantityExt:"Total number of incomers and outcomers",pass:{door:"Door",enteredShort:"Boarded",exitedShort:"Alighted",enteredTotalShort:"Entered. Overall",exitedTotalShort:"Alighted. Overall"},totalAlertsAndLogEntries:"Total records in the journal",totalActionsAndComments:"Actions and users' comments",totalUsers:"Total users",objservice:{serviceStatuses:"Maintenance",roundinglabel:'Need to rounded up to a full day while in the "Maintenance" status, if the object was in that status any time during the day'},engine:"Engine",driveline:"Driveline",drivelineFull:"Driveline",accelerometer:"Accelerometer",discreteInput:"Discrete input",discreteInputs:"Discrete inputs",timeseries:{geolocation:"Geolocation",satellites:"Satelittes",altitude:"Altitude",beingInGeozone:"Being in the geofence",crossingTheGeozone:"Crossing the geofence",navMileage:"Navigation mileage",carBody:"Body",carDoorFrontLeft:"Front left door",carDoorFrontRight:"Front right door",carDoorRearRight:"Rear right door",carDoorRearLeft:"Rear left door",carHood:"Hood",carCompartment:"Luggage compartment",carSecuritySystemIsOn:"Security system of the vehicle activated",carSecuritySystem:"Standard security system",carCentralLock:"Central lock",electricEquipment:"Electric equipment",carExternalVoltage:"External voltage",deviceInternalVoltage:"Internal voltage",carIgnitionKey:"Key in the ignition lock",carAccessories:"Accessories",carParkingLights:"Parking lights",carDippedBeam:"Dipped beam",carHighBeam:"High beam",carSafetyBelt:"Safety belt",carWiperFront:"Front windshield wiper",carDirIndicatorLeft:"Left direction indicator",carDirIndicatorRight:"Right direction indicator",drivelineInD:"Automatic gearbox in D, motion",drivelineInR:"Automatic gearbox in R, back run",drivelineInN:"Automatic gearbox in N, neutral",drivelineInP:"Automatic gearbox in P, parking",breakPedal:"Brake pedal",parkingBreak:"Parking brake",operationalMode:"Operational mode",machineHoursDevice:"Machine hours (device)",coolingFluidTemperature:"Cooling fluid",engineSpeed:"Engine speed",instantaneousFlowRate:"Instantaneous flow rate",machineHours:"Machine hours",totalMileage:"Total mileage",totalMileageToMaintenance:"Total mileage to maintenance",ignition:"Ignition",engineStarted:"Engine started",inclination:"Inclination",impact:"Impact",accident:"Accident",carTip:"Tip",carRollOver:"Roll over",carTest:"Test",lowInternalBattery:"Low internal battery",configurationCable:"Configuration cable",remoteSoftware:"Remote software",tamper:"Tamper",fix3d:"3D fixation",callEvent:"Call",externalBattery:"External battery",externalSupply:"External supply",chargeEvent:"Charge",reloadEvent:"Reload",navigation:"Navigation",communication:"Communication",makeAndBreakGerkon:"Make-and-break Gerkon",externalFieldGerkon:"External field Gerkon",externalGerkon:"External Gerkon",accessDenied:"Access denied",newWirelessNetworkEvent:"New wireless network",connectionRetention:"Connection retention",trackingEvent:"Tracking",readerEvent:"Reader",discreteInputDin:"Discrete input DIN",controlOut:"OUT",debugging:"Debugging",cpuTemperarure:"Temperature CPU",wire1Temperarure:"Temperature 1-Wire",temperatureInRefSection:"Refrigerator temperature in section",temperatureSpecifiedN:"Set temperature",ambientTemperature:"Ambient temperature",coolantTemperature:"Coolant temperature",temperatureAnalogueSensor:"Temperature of Analog Sensor",iqfreezeRpm:"Engine RPM",iqfreezeConf:"Compressor configuration",iqfreezeConf2:"2nd section compressor configuration",iqfreezeConf3:"3rd section compressor configuration",iqfreezeState:"State",iqfreezeState2:"2nd section state",iqfreezeState3:"3rd section state",iqfreezeBatv:"Battery voltage",iqfreezeBata:"Battery amperage",iqfreezeHm:"Engine hours",iqfreezeHme:"Line voltage operating hours",iqfreezeHmt:"General hours",iqfreezeAlcount:"Error count",iqfreezeAl1:"The most important error code",iqfreezeAl2:"Code of the 2nd most important error",iqfreezeAl3:"Code of the 2rd most important error",iqfreezeAl4:"Code of the 4th most important error",iqfreezeAl5:"Code of the 5th most important error",iqfreezeAl6:"Code of the 6th most important error",iqfreezeAdcErrN:"An error on the sensor #n#",iqfreezeRefType:"Type of refrigerator",iqfreezeDr:"Door status",iqfreezeDr2:"2nd section's door status",iqfreezeDr3:"3rd section's door status",iqfreezeNoConnect:"Lack of communication with the refrigerator",iqfreezeInN:"Discrete input #n#. Digital input iQfreeze",iqfreezeLic:"iQFreeze license type",iqfreezeDevType:"iQFreeze type",fuelSensorHzShort:"Hz",fuelSensorAdcShort:"ADC",accelerationXAxis:"X-axis acceleration (ACC_X)",accelerationYAxis:"X-axis acceleration (ACC_X)",accelerationZAxis:"Z-axis acceleration (ACC_Z)",tangage:"Tangage",vehicleRoll:"Roll",gsmSignalLevel:"GSM signal level",wifiSignalLevel:"WiFi signal level",lbsCell:"Cell",lbsZone:"Zone",lbsLevel:"Level",gsmSuppression:"GSM suppression",fmsParameters:"FMS-parameters",fmsParameterKey:function(e){return"Parameter "+e+" Key (CAN)"},fmsParameterValue:function(e){return"Parameter "+e+" Value (CAN)"},carAxisNumber:"Axis number",carAxelLoad:"Axle Load"}},"ru-ru":!0,"it-it":!0}),define("_common/reports/nls/ru-ru/reports",{reportsSettings:" ",reportPeriod:" ",geofenceViolations:"  ",clearReportsList:" ",reportsCountText:" #n#",speedLimitsSettings:"  ",speedLimit:"",speedLimitThreshold:"  ",speedLimitExt:" ",exceedStart:" ",exceedValue:" ",exceedValueInUnits:"   #units#",reportsObjectsSort:"   ",showingOfTracksSegments:"  ",showAllSelectedSegments:"  ",showLastSelectedSegment:"   ",byName:"  ",byId:" ID ",dayAndObject:"/",exportToExcel:"  Excel",exportToPdf:"  Pdf",aggressiveDrivingDetection:"   ",accIntensityMoreThan:"  ",brakingIntensityMoreThan:"  ",detailReport:" ",showSharpAcceleration:"  ",showSharpBraking:"  ",showSharpCornering:"   ",showTimeAndPlaceOfViolation:"     ",reportsList:" ",createScheduleTask:"  ",showRunDistanceOnEveryDay:"    ",showAllMoves:"  ",showAllParks:" ",showAddress:" /",moveStart:" ",moveEnd:" ",moveTime:" ",moveStartEndTime:"    ",moveStartTime:"  ",moveEndTime:"  ",moveStartEndPlace:"    ",moveStartPlace:"  ",moveEndPlace:"  ",parkTime:" ",avgSpeed:" ",calcConsumBy100kmNorm:"    100 ",calcConsumBy1hNorm:"    1 ",sumConsumBy100kmNorm:"     100 ",sumConsumBy1hNorm:"     1 ",runExtraParamsWarning:"         .",action:"",movement:"",movementParameters:" ",park:"",actionStart:"",actionEnd:"",actionTime:"",parkAddress:" ",totalTime:" ",totalParkTime:"   ",totalMoveTime:"   ",wayTime:"  ",totalDistance:" ",maxSpeed:". ",placeOfMax:" ",loadingAddress:" ...",loadAddress:" ",showFullTrack:"  ",removeReport:" ",notAvailable:" ",dateAndTime:"  ",duration:"",totalDuration:" ",avgValue:" ",below:"",above:"",lessThan:"",moreThan:"",belowAllowedLevel:"  ",aboveAllowedLevel:"  ",minimum:"",maximum:"",distanceWhile:"  #t#",vehicleNumber:" ",name:"",rev:" ",glonassLosesCount:"-  ",glonassLostPoint:"  ",glonassRestorePoint:"  ",losesLesser10min:",  10 .",losesLonger10min:",  10 .",losesLonger30min:",  30 .",onlineTime:" on-line",offlineTime:" off-line",minExceedTime:"  ",noSpeedExceeds:"  ",totalSpeedLimitExceeds:" ",totalSpeedingsOfTheThreshold:"  ",totalB1Exceeds:"   ",totalB2Exceeds:"   ",actionType:" ",placeOfAction:" ",acceleration:"",deceleration:"",objectReport:{connection:"",connectionTime:" ",coordinates:"",coordinatesTime:"  ",power:"",ignition:"",set:"",notSet:"",missing:"",detected:"",coordsNotDetected:" ",no:"",turnedOn:"",turnedOff:""},accesscardReport:{date:"",idCard:"ID-",address:" / ",noData:" "},normalValue:"",summary:"",summaryData:" ",summaryByObject:"  ",summaryByDay:"  ",minTimeOfState:"  ",minTimeOfStateHelp:" ,      ",onlySimultaneousTriggering:"  ",dataSource:" ",dataSourceCan:"  ",dataSourceFlowSensor:"   ",dataSourceCisternsFlowSensor:"   ",useFlowCalculatedValues:"                       /100",analogSensorForReport:"    ",removePointsOnParks:"   ",removePointsWithNoIgnition:"    ",colorChartDependingOnDiscret1:"        1",deviceReport:{date:"",time:"",event:"",eventDuration:" ",run:"",noData:" ",deviceStatus:" ",beforePeriod:"  ",atthePeriod:"  ",endPeriod:"  ",sensor:"",switchedon:".",switchedoff:".",allSensors:" ",allSwitchedOn:" ",allSwitchedOff:" ",runswitchedon:" .",runswitchedoff:" .",inclusions:"- ",shutdowns:"- ",emergencyPower:" ",mainPower:" ",minDelay:"   :"},externalSensorTemperature:"  ",deviceTemperature:" ",coolerTemperature:"  ",allowedThresholds:"  ",allowedTemperature:" ",minTemperature:" ",maxTemperature:" ",normTemperature:"",violationCount:" ",factsWhenCount:"   #cond#",violationDuration:" ",outOfRangeDuration:"  #range#",violationDistance:"  ",outOfRangeDistance:"  #range#",minViolationTime:"  ",minOutOfRangeTime:"     ",summaryOutRangeWork:"      ",showViolations:"  ",noViolations:" ",noFacts:" ",toggleDiagram:"#t# ",toggleViolationChart:"#t#  ",toggleTemperatureTimeChart:"#t#  ",vehicleVoltage:"  ",deviceVoltage:"  ",allowedVoltageThresholds:"  ",allowedVoltage:" ",minVoltage:" ",maxVoltage:" ",toggleVoltageTimeChart:"#t#  ",engineOffState:"",engineIdleState:" ",engineIdleStateShort:" ",engineIdleStateUpto:"  ",engineLoadState:"  ",engineLoadStateShort:" ",engineCriticalRpm:" ",engineCriticalRpmAbove:"  ",engineCriticalRpmShort:"",noFactsOfCriticalRpm:"   ",toggleRpmTimeChart:"#t#   ",violationOfCriticalRpm:"  ",splitData:" ",splitDataNone:" ",splitDataDays:" ",splitDataHours:" ",zoneReport:{numberZoneVisit:"  ",numberCurrentObjVisit:"  ",enterTime:" ",exitTime:" ",timeInZone:"  ",timeOutZone:"  ",runBetweenZoneEnters:"  ",visitsCount:" ",runInZone:"  ",runOutZone:"  ",firstEnter:" ",lastExit:" "},geozonesVisitedOfTotal:" #total# ",dateTimeOfStart:"   ",dateTimeOfEnd:"   ",fuelsAndDischarges:"  ",noFuelsOrDischarges:"    ",beforeValue:"",afterValue:"",fuelVolumeInTank:"   ",startVolume:" ",endVolume:" ",minVolume:" ",maxVolume:" ",fillingsNumber:" ",dayFillingsNumber:"    ",fillingsVolume:" ",dischargesNumber:" ",dayDischargesNumber:"    ",dischargesVolume:" ",totalFuelConsumption:"  ",fuelConsumption:" ",fuelConsumptionWhileMoving:"   ",avgConsumption:" ",totalRealConsumption:"    ",consumption100km:" ",consumption1hIgn:"   1  ",avgConsumption1hIgn:"   1  ",consumWhileMoving:"   ",consumWhileMovingShort:"  ",consumWhileMoving100km:"    100  ",consumption1h:"  1  ",engineParameters:"  ",engineWorkTime:"  ",engineWorkTimeWhileMoving:"    ",engineWorkTimeOnParks:"    ",ignOnTime:"    ",ignOnParkTime:"   ",ignOffParkTime:"   ",ignOnMoveTime:"   ",firstIgnTime:"   ",lastIgnTime:"   ",fuelTimeChartTitle:"     #source#",fuelDistanceChartTitle:"     #source#",fuelFlowChartTitle:"   ",byNorm:" ",analogueSensor1:"",analogueSensors1:"",parksIgnOn:"   ",averageCorner:" ",agressiveCorner:" ",timesAgressiveAcceleration:"   ",timesAgressiveInhibition:"   ",timesAgressiveCorners:"  ",timesAverageCorners:"  ",scheduleTaskdeleteConfirmMsg:"    ",newReport:" ",tasksCreationIsImpossible:"  .",tasksEditIsImpossible:"    .",propertiesReport:" ",title:"",reportObjType:" ",typeOfReport:" ",recipientEmails:" ",objectsWhichReport:",    ",previousDay:" ",previousWeek:" ",previousMonth:" ",currentMonth:" ",timezoneGenerateReport:"    ",scheduleReportGeneration:"  ",startTime:" ",daily:"",selectedDaysOfWeek:"   ",selectedDaysOfMonth:"   ",reportParameters:" ",copyReportParameters:"  ",noTasksToCopyReportParameters:"    ",copyReportParametersError:"    ",runImmediately:" ",noInfo:"  ",allDone:"  ",taskRun:" ",taskSaved:" ",taskDeleted:" ",objectInZoneTrue:"   ",objectInZoneFalse:"   ",objectInZoneUndefined:"     ",objectFault:" ",noGsmSignalTime:"   ",noGpsSignalTime:"  ",timeOfLastAlert:"  ",noAlerts:" ",noAlertsLastTime:"  ",noObjectsWithFaultsForReport:"      ",sumOfObjectsWork:"   ",sumOfObjectsMovesParks:"    ",showReportDataOnEveryDay:"    ",selectedAlertGroup:"  ",selectedAlertGroups:"  ",noSelectedAlertGroups:"     ",totalAlertsAndAlarms:"   ",errCanNotBuildReport:"        .   .",errMaxObjectsForExport:"       - #max# ( #t#).",errSingleObjectOnly:"        .",errLongReportPeriod:function(e){var t=["","",""];
return this.whichLabels(e),"     ,  "+e+" "+t[this.whichLabels(e)]+" "},errEnterReportName:"  ",errReportNamePattern:'     <span class="nobr">\\/?%*:|".<></span>',errEnterTaskEmails:"    e-mail ",errEnterTaskEmailsPattern:"   E-Mail:",errEnterCorrectStartTime:"   ",errslectDaysOfWeek:"     ",errslectDaysOfMonth:"     ",errLimitRequired:"  ",errEnterLimitNotLessThan:'  "#name#"     #min#',errMintimeRequired:"  ",errSelectAtLeastOneSensor:"    .",errSelectAtLeastOneParameter:"    .",volume:"",filling:"",fillings:"",discharge:"",discharges:"",discretes:{metrics:"  ",historyHeader:"   ",countSwitch:" ",countSwitchShort:"- ",dataOn:"   ",distanceOn:"   ",distanceOnShort:'  ""',dataOff:"   ",distanceOff:"   ",distanceOffShort:'  ""',periodOn:"   ",periodOnShort:'  ""',periodOff:"   ",periodOffShort:'  ""'},errPointCoordsNotSpecified:"   .",distanceReport:{timeRangeLabel:" ",selectedTimeLabel:"  ",noDataHeader:"     "},guardsCompleteCallsLabels:[" "," "," "],guardsComplteteCallsCountShort:"-  ",guardsNbComplteteCallsOnNbObjects:" #calls#  #objects#",drivesafety:{driveStyle:" ",styleParameters:"  ",acceleration:"",braking:"",speedKeeping:" ",accelerationParameters:" ",speedParameters:"  ",accLimit:" ",brakingLimit:" ",accNumber:" ",brakingNumber:" ",weight:"",value:"",penaltyPoint:" ",penaltyPoints:" ",mintime:" ",mintimeSpeed:"   ",mintimeAcceleration:"    /",mileageWithExcess:"  ",numberOfSpeeding:" ",useMileage:"   ",useQuantity:"  ",grade:"",overallGrade:" ",drivingStyleGrade:"  ",speedingGrade:"  ",gradeExcellentDescription:"",gradeGood:"",gradeGoodParamLabel:",   , ",gradeGoodLegend:" - ",gradeGoodDescription:"",gradeMiddle:"",gradeMiddleParamLabel:",   , ",gradeMiddleLegend:" - ",gradeMiddleDescription:" ",gradeBad:"",gradeBadLegend:" - ",gradeBadDescription:"",gradeUglyDescription:"",objectStatistics:"  ",objectsStatistics:"  ",showCalculation:"  ",speedCalculation:"   ",styleCalculation:"   ",thresholdsSet:" ",speedings:"",exceedingMoreThan:" ",accelerations:" &gt;",brakings:" &gt;",indicator:"",totalQuantity:" -",quantity100km:"-  100&nbsp;",value100km:"  100&nbsp;",indicatorWeight:" ",gradeByIndicator:"  ",penaltyPointsByIndicator:"   ",summaryScore:" ",showSummary:" ",showTop:"   ",showList:" ",withViolations:"  ",withTotalScore:"  ",withViolationsAndTotalScore:"     ",gradeByGroup:"   ",gradeDistributionbyObjects:"   ",objectsWithWorstScore:"   ",objectsList:" ",objectsListWithTotalScore:"    ",speedScore:"  ",accScore:"  "},drivesafety2020:{objectsWithWorstScore:"   ",gradeByGroup:"  ",speedCalculation:"      ",styleCalculation:"      "},passQuantity:" ",passQuantityExt:"-   ",sumPassQuantity:" - ",sumPassQuantityExt:" -   ",pass:{door:"",enteredShort:"",exitedShort:"",enteredTotalShort:" ",exitedTotalShort:" "},totalAlertsAndLogEntries:"   ",totalActionsAndComments:"   ",totalUsers:" ",objservice:{serviceStatuses:" ",roundinglabel:'        "",           '},engine:"",driveline:"",drivelineFull:" ",accelerometer:"",discreteInput:" ",discreteInputs:" ",timeseries:{geolocation:"",satellites:" ",altitude:"   ",beingInGeozone:"  ",crossingTheGeozone:"    ",navMileage:" ",carBody:"",carDoorFrontLeft:"  ",carDoorFrontRight:"  ",carDoorRearRight:"  ",carDoorRearLeft:"  ",carHood:"",carCompartment:"",carSecuritySystemIsOn:"  ",carSecuritySystem:"  ",carCentralLock:" ",electricEquipment:"",carExternalVoltage:" ",deviceInternalVoltage:"  ",carIgnitionKey:"   ",carAccessories:"",carParkingLights:" ",carDippedBeam:" ",carHighBeam:" ",carSafetyBelt:" ",carWiperFront:" ",carDirIndicatorLeft:"  ",carDirIndicatorRight:"  ",drivelineInD:"  D, ",drivelineInR:"  R,  ",drivelineInN:"  N, ",drivelineInP:"  P, ",breakPedal:" ",parkingBreak:" ",operationalMode:" ",machineHoursDevice:" ()",coolingFluidTemperature:"  ",engineSpeed:" ",instantaneousFlowRate:" ",machineHours:"",totalMileage:" ",totalMileageToMaintenance:"  ",ignition:"",engineStarted:" ",inclination:"",impact:"",accident:"",carTip:"",carRollOver:"",carTest:"",lowInternalBattery:"  ",configurationCable:" ",remoteSoftware:" ",tamper:"",fix3d:" 3D",callEvent:"",externalBattery:" ",externalSupply:" ",chargeEvent:"",reloadEvent:"",navigation:"",communication:"",makeAndBreakGerkon:"  ",externalFieldGerkon:" . ",externalGerkon:" ",accessDenied:" ",newWirelessNetworkEvent:" ",connectionRetention:" ",trackingEvent:"",readerEvent:"",discreteInputDin:"  ",controlOut:" ",debugging:"",cpuTemperarure:" CPU",wire1Temperarure:" 1-Wire",temperatureInRefSection:"   ",temperatureSpecifiedN:" ",ambientTemperature:"  ",coolantTemperature:"  ",temperatureAnalogueSensor:"  ",iqfreezeRpm:" ",iqfreezeConf:" ",iqfreezeConf2:"    2",iqfreezeConf3:"    3",iqfreezeState:" ",iqfreezeState2:"    2",iqfreezeState3:"    3",iqfreezeBatv:" ",iqfreezeBata:"  ",iqfreezeHm:"   ",iqfreezeHme:"   ",iqfreezeHmt:" ",iqfreezeAlcount:" ",iqfreezeAl1:"   ",iqfreezeAl2:" 2   ",iqfreezeAl3:" 3   ",iqfreezeAl4:" 4   ",iqfreezeAl5:" 5   ",iqfreezeAl6:" 6   ",iqfreezeAdcErrN:"    #n#",iqfreezeRefType:" ",iqfreezeDr:" ",iqfreezeDr2:"    2",iqfreezeDr3:"    3",iqfreezeNoConnect:"   ",iqfreezeInN:"  #n#.   iQfreeze",iqfreezeLic:"  iQFreeze",iqfreezeDevType:"  iQFreeze",fuelSensorHzShort:" ",fuelSensorAdcShort:" ",accelerationXAxis:" X",accelerationYAxis:" X",accelerationZAxis:" Z",tangage:"",vehicleRoll:"",gsmSignalLevel:" GSM",wifiSignalLevel:" WiFi",lbsCell:"",lbsZone:"",lbsLevel:"",gsmSuppression:" GSM",fmsParameters:"FMS-",fmsParameterKey:function(e){return"  "+e+" (CAN)"},fmsParameterValue:function(e){return"  "+e+" (CAN)"},carAxisNumber:" ",carAxelLoad:"  "}}),define("text!_common/reports/tmpl/deviceProps.html",[],function(){return'<fieldset class="obj-props<% if(\'undefined\' != typeof hidden && hidden){ %> hidden<% } %>">\n    <legend><%= i18n.objProps %></legend>\n    <input type="hidden" name="properties" value="fake"><% //else we will have defaults in Report %>\n    <div class="row-fluid">\n        <div class="span6">\n            <label class="checkbox">\n                <input type="checkbox" value="extId" name="properties"<% if(_.indexOf(properties, \'extId\') != -1) { %> checked<% } %>>\n                <%= i18n.objIdNumberShort %>\n            </label>\n            <label class="checkbox">\n                <input type="checkbox" value="name" name="properties"<% if(_.indexOf(properties, \'name\') != -1) { %> checked<% } %>>\n                <%= i18n.objName %>\n            </label>\n            <label class="checkbox">\n                <input type="checkbox" value="groups" name="properties"<% if(_.indexOf(properties, \'groups\') != -1) { %> checked<% } %>>\n                <%= i18n.objGroup %>\n            </label>\n            <label class="checkbox">\n                <input type="checkbox" value="carId" name="properties"<% if(_.indexOf(properties, \'carId\') != -1) { %> checked<% } %>>\n                <%= i18n.licenseNumber %>\n            </label>\n\n            <% if(\'undefined\' != typeof showHardwareType) {%>\n            <label class="checkbox">\n                <input type="checkbox" value="deviceTypeName" name="properties"<% if(_.indexOf(properties, \'deviceTypeName\') != -1) { %> checked<% } %>>\n                <%= i18n.objHardwareType %>\n            </label>\n            <% } %>\n\n        </div><div class="span6">\n            <label class="checkbox">\n                <input type="checkbox" value="model" name="properties"<% if(_.indexOf(properties, \'model\') != -1) { %> checked<% } %>>\n                <%= i18n.objModel %>\n            </label>\n            <label class="checkbox">\n                <input type="checkbox" value="type" name="properties"<% if(_.indexOf(properties, \'type\') != -1) { %> checked<% } %>>\n                <%= i18n.vehicleType %>\n            </label>\n            <label class="checkbox">\n                <input type="checkbox" value="vin" name="properties"<% if(_.indexOf(properties, \'vin\') != -1) { %> checked<% } %>>\n                <%= i18n.objVin %>\n            </label>\n            <label class="checkbox">\n                <input type="checkbox" value="year" name="properties"<% if(_.indexOf(properties, \'year\') != -1) { %> checked<% } %>>\n                <%= i18n.objYear %>\n            </label>\n        </div>\n    </div>\n</fieldset>'}),define("_common/reports/ReportsMixin",["jquery","underscore","text!_common/reports/tmpl/deviceProps.html"],function(e,t,n){function i(e,n,i){return function(r){e.find(".alert-groups-list");var o=e.find('select[name="alertGroupId"]'),a="";t.each(r,function(e){a+='<option value="'+e.id+'"'+(t.isArray(i)&&t.indexOf(i,e.id)>-1?" selected":"")+">"+e.name+"</option>"}),o.html(a),o.chosen({disable_search:!0,no_results_text:n.searchNoResults})}}function r(e,n,i){function r(e,n){if(!n.length)return this._alerts;var i=t.filter(e,function(e){return t.indexOf(n,e.groupId)>-1});return i}function o(e){var t=String(e);return 4===t.length?String(Number(t)/10):t}function a(e,n,i){if("undefined"==typeof i){var a=e.val()||[];i=t.map(a,Number)}var l="",d=n,c=s.filter(":checked");if(c.length>0&&c.length<s.length){var m=c.map(function(){return Number(this.value)});d=r(n,m)}t.each(d,function(e){l+='<option value="'+e.code+'"'+(t.isArray(i)&&t.indexOf(i,e.code)>-1?" selected":"")+">"+o(e.code)+" "+e.message+"</option>"}),e.html(l),e.data("chosen")&&e.trigger("chosen:updated")}var s=e.find('.alert-groups-list input[name="alertGroupId"]');return function(t){var r=e.find(".alerts-list"),o=e.find('select[name="alertMessageCode"]');a(o,t,i),s.on("click",function(){a(o,t)}),o.on("chosen:showing_dropdown",function(e,t){var n=t.chosen.container;n.find(".chosen-results li").each(function(){this.setAttribute("title",this.innerText)})}),o.on("chosen:ready change",function(){r.find(".search-choice > span").each(function(){this.setAttribute("title",this.innerText)})}),o.chosen({disable_search:!1,disable_search_threshold:10,no_results_text:n.searchNoResults})}}function o(e,n,i,r,o){return function(a){var s=e.find(".comments-group-params"),l=s.closest("fieldset"),d=e.find(".comments-list"),c=!!o,m=[];m=m.concat(t.map(a.comments,function(e){return e.msg}));var u=t.map(m,function(e){return i({name:"logComment",value:e,label:e,checked:!r||r.indexOf(e)>-1})}).join("");u+=i({name:"_customLogComment",value:1,label:n.otherComments,checked:c}),d.html(u);var p=s.find(".custom-comment-group"),h=p.find("input");if(c&&(p.removeClass("hidden"),h.prop("disabled",!1).val(o)),s.find('input[name="_customLogComment"]').on("click",function(){p.toggleClass("hidden",!this.checked),h.prop("disabled",!this.checked),this.checked&&h.focus()}),!r||r.length){var f=!r||r.length>=m.length,g=l.find("input.select-all");g.prop("checked",f).prop("indeterminate",!f)}(c||r&&r.length)&&l.addClass("opened"),l.selectAll({indeterminates:!0,selector:'input[name="logComment"]'})}}function a(e,n,i){return function(r){var o=r.channels,a=e.find(".channels-list"),s=a.closest("fieldset"),l=i&&i.length;if(o.length){s.removeClass("hidden"),l&&s.addClass("opened");var d=1===o.length,c=[],m=!d&&t.isArray(i),u=d||!m;i&&(c=i.filter(function(e){return o.indexOf(e)>-1}),u=u||c.length===o.length);var p=t.map(o,function(e){return n({name:"channelName",value:e,label:e,checked:u||i.indexOf(e)>-1,readonly:d})}).join("");if(u||c.length){var h=s.find("input.select-all");h.prop("checked",u).prop("indeterminate",!u)}d&&e.find('input[name="allChannelName"]').prop("disabled",!0),a.html(p),s.selectAll({indeterminates:!0,selector:'input[name="channelName"]'})}else s.remove()}}function s(n){var i=new e.Deferred,r=[e.ajax({url:n+"alert-actions/get/"}),e.ajax({url:n+"alert-comments/get/"})];return e.when.apply(null,r).done(function(e,n){i.resolve({actions:t.sortBy(e[0],"num"),comments:t.sortBy(n[0],"num")})}).fail(i.reject),i}n=t.template(n);var l={_buildParameterReportFields:function(t,i,r){var o=new e.Deferred,a=this,s="number"==typeof r?r:r.length;return requirejs(["text!mobile/reports/"+t+"/tmpl/params.html"],function(e){var r=l._renderParameterReportFields.call(a,t,i,s>1,e,n);o.resolve(r[0],r[1])},function(){o.reject()}),o},_renderParameterReportFields:function(e,n,i,r,o){var a=this,s=this.getStoredParam(e,"properties")||["extId","name"],l=this.getStoredParam(e,"dataSource")||n.dataSource,d=n.thresholds,c=this.getStoredParam(e,l+".thresholds")||d[l],m=this.getStoredParam(e,"mintime"),u=this.getTexts();t.isNull(m)&&(m=n.mintime);var p=Math.floor(m/60);return[t.template(r,{i18n:u,propertiesHtml:o({hidden:!i,properties:s,i18n:u}),dataSource:l,thresholds:c,minutes:p,seconds:m-60*p}),function(t){n.showProperies=i,a._initParameterReportFields(e,t,n)}]},_initParameterReportFields:function(n,i,r){var o=this,a=r.minThresholdsDiff,s=i.find("input[name=thresholds]").numeric({decimal:".",negative:r.allowNegative});s.on("change",function(){var n=e(this),o=n.data("index"),l=parseFloat(n.val()),d=n.data("min"),c=n.data("max"),m=s.filter("[data-index="+(0==o?1:0)+"]");if(t.isNaN(l)){var u=r.dataSource,p=i.find("input[name=dataSource]:checked");p.length&&(u=p.val()),l=r.thresholds[u][o],n.val(l)}else d>l?(l=d,n.val(l)):l>c&&(l=c,n.val(l));if(0==o)m.val()<=l&&m.val(l+a);else if(1==o){var h=Math.max(l-a,m.data("min"));h>=l&&n.val(h+a),m.val()>=l&&m.val(h)}}),i.find("input[name=dataSource]").on("click",function(){if(this.checked){var e=o.getStoredParam(n,this.value+".thresholds")||r.thresholds[this.value];s.first().val(e[0]),s.last().val(e[1])}});var l=i.find("input[name=minutes]")[0],d=i.find("input[name=seconds]")[0];e(l).on("change",function(){var e=parseInt(l.value);0>e&&(l.value="0",e=0),60==e?(d.disabled=!0,d.value="0"):(d.disabled=!1,d.max="59",0==e||(d.min="0"))}),e(d).on("change",function(){var e=parseInt(d.value);e<d.min&&(d.value=d.min,e=parseInt(d.min))})},buildTemperatureExtraFields:function(e){var n=t.find(["OUTTEMP","DEVTEMP","COOLTEMP"],function(e){return App.reportAllowedByType(e)});return this._buildParameterReportFields("temperature",{mintime:300,dataSource:n,thresholds:{DEVTEMP:[-40,85],OUTTEMP:[2,6],COOLTEMP:[70,105]},allowNegative:!0,minThresholdsDiff:1},e)},buildVoltageExtraFields:function(e){var n=t.find(["CARPOWER","ACC"],function(e){return App.reportAllowedByType(e)});return this._buildParameterReportFields("voltage",{mintime:300,dataSource:n,thresholds:{CARPOWER:[11,29],ACC:[3.7,4.2]},allowNegative:!1,minThresholdsDiff:.01},e)},buildEngspeedExtraFields:function(e){return this._buildParameterReportFields("engspeed",{dataSource:"default",mintime:0,thresholds:{"default":[0,600,3e3]},allowNegative:!1,minThresholdsDiff:1},e)},_renderDrivesafetyExtraFields:function(i,r,o){var a,s=this.getStoredParam(i,"properties")||["extId","name"],l=new e.Deferred,d=this.getTexts(),c=App.isMapMatchingAllowed()?"paramsMapMatching":"params";return requirejs(["text!mobile/reports/"+i+"/tmpl/"+c+".html"],function(e){var c={i18n:d,isSummary:o,propertiesHtml:n({properties:s,i18n:d})};t.each(r,function(e,t){a=this.getStoredParam(i,t),c[t]=null===a?e:a}.bind(this)),l.resolve(t.template(e,c))}.bind(this)),l},_toggleDrifesafetyCheckboxes:function(e,t){var n=e.find(".checkbox-single"),i=e.find(".checkbox-summary"),r=t?i:n,o=t?n:i;o.addClass("hidden").find("input").prop("disabled",!0),r.removeClass("hidden").find("input").prop("disabled",!1)},_initDrivesafetyExtraFields:function(n,i,r,o){var a=this,s=arguments,d=a.model&&a.model.get("parameters"),c=d?d.zoneId:this.getStoredParam(n,"zoneId")||[];if(l.buildSelectorZone.call(this,{htmlBlock:o,i18n:a._i18n,selected:c}),o.find(".set-defaults").on("click",function(){return t.each(i,function(e,t){a.clearStoredParam(n,t)}),a._renderDrivesafetyExtraFields(n,i,r).done(function(e){o.html(e),a._initDrivesafetyExtraFields.apply(a,s)}),!1}),o.find(".integer").numeric({decimal:!1,negative:!1}),o.find(".positive").numeric({decimal:".",negative:!1}),o.find(".negative").numeric({decimal:".",negative:!0}),App.isMapMatchingAllowed()){var m=o.find('input[name="speedExcessUnits"]'),u=o.find('input[name="speedExcessLimits"]'),p=o.find(".excess-unit");m.on("click",function(){var e=this.value,t=a.getStoredParam("drivesafety","speedExcessLimits")||i.speedExcessLimits;u.each(function(n){this.value=t[e][n]}),p.html("kmh"===e?a.getTexts().kmh:"%")})}else{var h,f=o.find("[data-limitsgroup]");f.each(function(){var t=e(this);h=t.find("input[data-index]"),function(n){var i=n.length;n.on("change",function(){for(var n,r=e(this),o=r.data("index"),a=o,s=r.val(),l=Number(s);a--;)n=t.find('input[data-index="'+a+'"]'),Number(n.val())>=l&&n.val(Math.max(0,l-(o-a)));for(a=o;++a<i;)n=t.find('input[data-index="'+a+'"]'),Number(n.val())<=l&&n.val(l+(a-o))})}(h)})}},buildDrivesafetyExtraFields:function(t){var n=this,i=t.length>1,r=new e.Deferred,o="drivesafety";return requirejs(["mobile/reports/"+o+"/DrivesafetyReport"],function(e){var t=i,a=e.prototype.defaults,s=App.getReportsAndTracksProcessor(),d=s?s.options.objectsDefined:!1;n._renderDrivesafetyExtraFields(o,a,i).done(function(e){r.resolve(e,function(e){if(n._initDrivesafetyExtraFields(o,a,i,e),l._toggleDrifesafetyCheckboxes(e,i),!d){var r=function(n){return n.length?(t=i,i=n.length>1,i!=t&&l._toggleDrifesafetyCheckboxes(e,i),void 0):(App.off("toggleobjects",r),void 0)};App.on("toggleobjects",r),App.once("processorsubmit",function(){App.off("toggleobjects",r)})}},function(){r.reject()})})}),r},_initObjectsPropertiesToggle:function(e,t){var n=e.find("fieldset.obj-props"),i=App.getReportsAndTracksProcessor(),r=i?i.options.objectsDefined:!1;if(t===!1&&n.addClass("hidden"),!r){var o=function(e){n[e.length>1?"removeClass":"addClass"]("hidden")};App.on("toggleobjects",o),App.once("processorsubmit",function(){App.off("toggleobjects",o)})}},buildGuardscallcountExtraFieldsBak:function(){var n=new e.Deferred,i=this;return n.reject(),requirejs(["text!_common/reports/guardscallcount/tmpl/params.html"],function(e){var r=i.get("parent");n.resolve(t.template(e,{i18n:i._i18n,minNumber:r.getUserData("guardscallcount.minNumber")||1}),function(e){e.find("input[name=minNumber]").numeric({decimal:!1,negative:!1})})},function(){n.reject()}),n},getDrivesafetyDefaultParameters:function(){return{accelerationMintime:3,speedingMintime:20,showStatistics:!1,showCalculation:!1,accelerationLimit:2,accelerationWeight:1,brakingLimit:-2,brakingWeight:1,speedLimits:[60,90,110,130],speedWeights:[0,1,3,5],gradeThresholds:[4,7],showSummary:!0,showTop:!0,showListWithViolations:!0,showListWithSumScore:!0,zoneId:[]}},getDrivesafetyMapMatchingDefaultParameters:function(){return Object.assign(t.omit(this.getDrivesafetyDefaultParameters(),"gradeThresholds","showListWithViolations","showListWithSumScore"),{speedingMintime:3,speedExcessLimits:{kmh:[0,20,40,60],percentage:[0,20,50,100]},speedExcessWeights:[0,10,50,100],speedExcessUnits:"kmh",useMileageOrQuantity:"mileage",showObjectsStatistics:!1})},buildObjserviceExtraFields:function(){var n=new e.Deferred,i=this,r="objservice";return requirejs(["text!_common/reports/"+r+"/tmpl/params.html"],function(e){var o=i.getStoredParam(r,"statuses")||["served","service","notServed"],a=i.getStoredParam(r,"roundToDays")!==!1,s=i.getTexts();n.resolve(t.template(e,{i18n:s,statuses:o,roundToDays:a,propertiesHtml:i._renderPropertiesCheckboxes(r)}))},function(){n.reject("templates require failed")}),n},_getObjectPropertiesForReport:function(e){return this.getStoredParam(e,"properties")||["extId","name"]},_renderPropertiesCheckboxes:function(e){var t=this._getObjectPropertiesForReport(e);return n({properties:t,showHardwareType:!0,i18n:this.getTexts()})},buildAlertjournalExtraFields:function(n){var l=new e.Deferred,d=this,c=Number(n[0].get("objType"))===App.TYPE_STAT;return requirejs(["text!_common/reports/alertjournal/tmpl/params.html","text!_common/reports/alertjournal/tmpl/paramCheckbox.html"],function(n,m){m=t.template(m),d.get("parent");var u="alertjournal",p=d._i18n,h=App.getBaseUrl(),f=d.getStoredParam(u,"alertGroupId"),g=d.getStoredParam(u,"alertMessageCode"),v=d.getStoredParam(u,"channelName"),b=d.getStoredParam(u,"logComment"),y=d.getStoredParam(u,"customLogComment"),S=d.getStoredParam(u,"params"),T=function(e){return!S||S.indexOf(e)>-1},x=[{key:"receivedAt",name:p.timeOfReceive,readonly:!0,checked:T("receivedAt")},{key:"alertTs",name:p.timeOfCreation,checked:T("alertTs")},{key:"code",name:p.alertCode,checked:T("code")},{key:"message",name:p.alertOrCommentMessage,checked:T("message"),readonly:!0},{key:"group",name:p.alertsGroup,checked:T("group")},{key:"extId",name:p.objIdNumber,checked:T("extId")},{key:"address",name:p.address.ucFirst(),checked:T("address"),isStationary:!0},{key:"objectName",name:p.objTitle,checked:T("objectName")},{key:"areaNum",name:p.objArea,checked:T("areaNum"),isStationary:!0},{key:"areaName",name:p.objAreaName,checked:T("areaName"),isStationary:!0},{key:"zoneNum",name:p.objZoneKey,checked:T("zoneNum"),isStationary:!0},{key:"zoneName",name:p.objZoneKeyName,checked:T("zoneName"),isStationary:!0},{key:"channelName",name:p.inputStream,checked:T("channelName")},{key:"userId",name:p.userid,checked:T("userId")},{key:"userName",name:p.username.ucFirst(),checked:T("userName")}];l.resolve(t.template(n,{i18n:p,isStationary:c,params:x}),function(t){var n=i(t,p,f),l=[e.ajax({url:h+"alert-template-group/list/"}).done(function(i){n(i),e.ajax({url:h+"alert-template/list/"}).done(r(t,p,g))}),s(h).done(o(t,p,m,b,y)),e.ajax({url:h+"alerts/channels/",data:{}}).done(a(t,m,v))];e.when(l).always(function(){var n=t.closest(".processor");t.on("click",".group-toggle",function(){var t=e(this).closest("fieldset");t.toggleClass("opened",!t.is(".opened")),n.trigger("contentchange")}),setTimeout(function(){n.trigger("contentchange")},500),setTimeout(function(){t.find(".loading").removeClass("loading"),n.trigger("contentchange")},1800)});var d=t.find("fieldset:last-child"),c=!S||S.length>=x.length;d.selectAll({indeterminates:!0,selector:'input[name="params"]'}),d.find("input.select-all").prop("checked",c).prop("indeterminate",!c)})},l.reject),l},buildSelectorZone:function(e){var n=e.htmlBlock,i=e.selected,r=e.i18n||{},o=t.isArray(i)?i:t.isNumber(i)?[i]:[],a="",s=n.find("select[name=zoneId]"),l=App.get("geozones");t.each(l,function(e){a+='<option value="'+e.id+'"'+(t.indexOf(o,e.id)>-1?" selected":"")+">"+e.name+"</option>"}),s.html(a),s.chosen({disable_search:!0,no_results_text:r.searchNoResults})}};return l}),define("_common/reports/ReportsModule",["jquery","underscore","abstracts/Module","util","_common/reports/Report","_common/reports/ReportsCollection","_common/reports/views/ReportsListView","i18n!_common/nls/common","i18n!_common/reports/nls/reports","css!_common/reports/css/reports","jquerytiny","./ReportsMixin"],function(e,t,n,i,r,o,a,s,l){var d={},c={},m={},u=n.extend({constructor:function(){this.items=new o,this.activeReport=null,this._mapsModule=null,this._newReportId=0,n.apply(this,arguments)},defaults:{objType:"mobile"},initialize:function(){var t=this;this._i18n=e.extend({},s,l),this._mapsModule=this.get("options").mapsModule,this._view=new a({container:this.get("container"),placeholder:this.get("placeholder"),model:this}),requirejs(["mobile/reports/MobileReportsModule","stat/reports/StatReportsModule"],function(e,n){t.modules={mobile:e?new e({id:t.id+"/mobile",parent:t,objType:"mobile",options:{mapsModule:t._mapsModule}}):null,stat:n?new n({id:t.id+"/stat",parent:t,objType:"stat",options:{mapsModule:t._mapsModule}}):null},p.extendChildren.call(t)}),p.bindEvents.call(this),p.addRoutes.call(this),this.publish("ready",this)},getTexts:function(){return this._i18n},viewReport:function(e,t){if(!this.activeReport||this.activeReport.id!=e){var n;return(n=this.items.get(e))?(this.activeReport=n,this.activeReport.has("source")?t||this.activeReport.set("source",null):this.activeReport.set("source",t||null),App.trigger("view:report",e),this._view.viewReport(this.activeReport),this.activeReport):null}},getUserReportsTypes:function(){var e=App.getAllowedReports(),n=this.getHiddenReports(),i={};return t.each(e,function(e,r){-1==t.indexOf(n,r)&&(i[r]=e)}),i},getReportsContainer:function(){return this._view.$el},getListView:function(){return this._view},getSpeedLimits:function(){return this.get("parent").getSpeedLimits()},getAccLimits:function(){return this.getUserData("accLimits")||[3,-3.5]},getObjectsSettings:function(t){return e.ajax({url:App.getBaseUrl()+"objects/obj-settings/",data:{objectId:t}})},getAlertsGroups:function(){return e.ajax({url:App.getBaseUrl()+"alert-template-group/list/"})},getObjectsSort:function(){return this.getUserData("objectsSort")||"name"},setObjectsSort:function(e){return-1!=t.indexOf(["name","extId"],e)?this.setUserData("objectsSort",e):void 0},getTracksSegmentsMode:function(){return this.getUserData("tracksSegmentsMode")||"all"},setTracksSegmentsMode:function(e){return-1!=t.indexOf(["all","last"],e)?this.setUserData("tracksSegmentsMode",e):void 0},getHiddenReports:function(){return this.getUserData("hiddenReports")||["speeding","fuel2","device2","runshort","zonevizcount","distance","guardscallcount","passmatrix"]},setHiddenReport:function(e,n){var i=this.getHiddenReports(),r=!1;n&&-1==t.indexOf(i,e)?(i.push(e),this.setUserData("hiddenReports",i),r=!0):n||-1==t.indexOf(i,e)||(i=t.without(i,e),this.setUserData("hiddenReports",i),r=!0),r&&this.publish("hiddenreportschange",i)},getReportExtraFields:function(t,n,i){var r=t.ucFirst(),o=new e.Deferred,a=this.modules[n]||null;return a?(a["build"+r+"ExtraFields"]?a["build"+r+"ExtraFields"](i).done(function(e,t){o.resolve(e,t||function(){})}).fail(function(){o.reject("can not build params")}):o.reject("no params"),o):o.reject("no child module")},datesRangeNeeded:function(e){return!/^objst|distance$/.test(e)},dateNeeded:function(e){return"distance"==e},getMapsModule:function(){return this._mapsModule},searchAddress:function(e){var t=e.data;if(t.geoId&&e.addrSourceCode){var n=t.geoId,i=e.addrSourceCode;if(c[i]=c[i]||{},"undefined"!=typeof c[i][n])return e.success&&e.success(c[i][n],t),c[i][n];if("undefined"!=typeof d[n]){for(var r=m[n],o=0,a=r.length;a>o;o++)if(r[o]==e.success)return!0;return r[n]=e.success,!0}d[n]=e.data,m[n]=e.success,this.publish("needgeoinfo",e.data,this)}},_buildAlertsExtraFields:function(){var n=new e.Deferred,i=this;return this.get("parent").getAlertsGroups().done(function(e){requirejs(["text!_common/reports/alerts/tmpl/params.html"],function(r){n.resolve(t.template(r,{i18n:i._i18n,groups:e,alertGroupId:i.get("parent").getUserData("alerts.alertGroupId")||[]}),function(e){e.selectAll({selector:"input[name=alertGroupId]"})})})}).fail(function(){n.reject("Can not get groups")}),n},_buildAlertssummaryExtraFields:function(){var n=new e.Deferred,i=this;return requirejs(["text!_common/reports/alertssummary/tmpl/params.html"],function(e){n.resolve(t.template(e,{i18n:i._i18n,showDetails:i.get("parent").getUserData("alertssummary.showDetails"),reportSubtype:i.get("parent").getUserData("alertssummary.reportSubtype")||"general"}))},function(){n.reject()}),n}}),p={bindEvents:function(){var t=this;this.listenTo(App,"leftpaneresize",function(e){t.trigger("resizepane",e)}),App.isDemo()||this.listenTo(App,"settingsready",function(){requirejs(["_common/reports/schedule/ScheduleModule"],function(n){t.modules.schedule=new n({id:"reports/schedule",parent:t,container:e("#reports-schedule")})},function(e){console.error(e)})});var n=this.get("parent");App.subscribe("needreport",function(e,i,r){if(r.type){var o=App.getAllowedReports()[r.type];if(null==i){if(!r.objectId)return;if(o.singleObject&&r.objectId.length>1)return alert(t._i18n.errSingleObjectOnly,t._i18n.attention);var a="stat"==e?"_common/stat/StatObjectsCollection":"_common/mobile/MobileObjectsCollection",s=requirejs(a),i=new s;
return i.fetch({data:{objectId:r.objectId},silent:!0}).done(function(){p.validateReportData.call(t,i,r)&&p.buildReport.call(t,i,r)}),void 0}if(o.singleObject&&i.length>1)return alert(t._i18n.errSingleObjectOnly,t._i18n.attention);if("maxDays"in o){var l=Math.ceil((r.endTime-r.startTime)/864e5);if(l>o.maxDays)return alert(t._i18n.errLongReportPeriod(o.maxDays),t._i18n.attention)}t.setUserData("choosedType",r.type),t.set("objType",e),p.validateReportData.call(t,i,r)&&(n.trigger("buildstartsuccess"),p.buildReport.call(t,i,r).done(function(){}))}}),this.listenTo(this.items,"add",function(e){t.listenToOnce(e,"sync",function(e){t.viewReport(e.id,e.get("source"))})}),this.on("change:options",function(e,n){t.items.each(function(e){e.set("tracksSettings",n.tracksSettings),e.trigger("change:tracksSettings",e,n.tracksSettings)})}).on("searchsuccess",function(e,t){if(e.geoId){var n=e.geoId;e.address&&c[t.scode]&&(c[t.scode][n]=e),"undefined"!=typeof m[n]&&(m[n](e,t),delete m[n]),delete d[n]}}).on("searcherror",function(e,t){if(t.geoId){var n=t.geoId;n in m&&(m[n](null,d[n]),delete m[n]),delete d[n]}})},getNewReprtId:function(){return++this._newReportId},addRoutes:function(){var e=this;this.routes={},this.routes[e.id]=function(){e._view.showList(),e.activeReport=null},App.getRouter().addRoutes(this.routes),this.interceptCurrentRoute()},extendChildren:function(){var e=this;t.each(["buildAlertsExtraFields","buildAlertssummaryExtraFields"],function(n){!function(n){t.each(e.modules,function(t){!function(t){t.constructor.prototype[n]=function(){return e["_"+n].apply(t)}}(t)})}(n)})},validateReportData:function(e,t){function n(e,t){for(var n in e)if(t(n))return!0;return!1}var i,r=null;if(t.type.indexOf("zone")>-1){var o=this.get("parent").getWatchedZonesIds();o.length||(r=this._i18n.errors.noSelectedZones)}else if("timeseries"===t.type)n(t,function(e){return 0===e.indexOf("keys")})||(r=this._i18n.errSelectAtLeastOneParameter);else if("can"===t.type||t.type.indexOf("device")>-1)n(t,function(e){return 0===e.indexOf("dev")})||(r=this._i18n.errSelectAtLeastOneSensor);else if("discretes"===t.type){if(!t.source){i=!1;for(var a in t)if(0===a.indexOf("parameterNums")){i=!0;break}i||(r=this._i18n.errSelectAtLeastOneSensor)}}else"distance"===t.type?t.lat&&t.lon||(r=this._i18n.errPointCoordsNotSpecified):"fuelsum"===t.type&&(t.params||(r=this._i18n.errSelectAtLeastOneParameter));return r?(alert(r,this._i18n.error),!1):!0},buildReport:function(n,i){var r=new e.Deferred;if(!this.modules[this.get("objType")])return r.reject(s.report+" "+l.notAvailable);if(n.models&&(n=n.models),i.items=[],t.each(n,function(e,t){i.items[t]={id:e.id,extId:e.get("extId"),name:e.get("name"),klass:"obj"}}),i.objectId=i.objectId||t.pluck(n,"id"),-1!=i.type.indexOf("zone")&&"undefined"==typeof i.zoneId){var o=this.get("parent").getWatchedZonesIds();if(!o.length)return alert(this._i18n.errors.noSelectedZones,this._i18n.error.ucFirst()),r.reject(),r;i.zoneId=o}var a=this;return this.modules[this.get("objType")].loadReportClass(i.type).done(function(t){i.id=p.getNewReprtId.call(a),i.name=t.reportName||App.getAllowedReports()[i.type].name,i.key=i.type,i.module=a,i.tracksSettings=a.get("options").tracksSettings||null,i.addrSourceCode=a.getMapsModule().getMap().scode,i.sort=a.getUserData("objectsSort")||"name";var n=new t(i);i.sourceElement&&i.sourceElement.data&&i.sourceElement.data("reportId",i.id),a.items.add(n),n.listenTo(a,"resizepane",function(e){n.trigger("resizepane",e)}),n.fetch({data:n.getPostParams()}).done(r.resolve).fail(function(t,i){var o=a._i18n.errCanNotBuildReport,s=a._i18n.error;try{var l=e.parseJSON(i.responseText);o=l.msg,s=l.hdr}catch(d){}alert(o,s),a.items.remove(n),r.reject()})}).fail(function(e){var t=App.getAllowedReports()[i.type].name;alert('"'+t+'" '+l.notAvailable),console.error(e.stack||e),r.reject(e)}),r}};return u}),define("text!_common/reports/tmpl/reportTable.html",[],function(){return"<table class=\"selectable rep-table<%if(!_.isUndefined(key)) {%> <%- key %>-rep-table<% } %>\">\n    <%if('undefined' != typeof theadHtml) {%>\n    <thead class=\"rep-table-head header-copy\">\n    <%= theadHtml %>\n    </thead>\n    <% } %>\n    <tbody><%if('undefined' != typeof tbodyHtml) { print(tbodyHtml) } %></tbody>\n</table><!-- /rep-table -->"}),define("text!_common/reports/alertssummary/tmpl/thead.html",[],function(){return'<tr data-head="<%= headPosition %>">\n    <th data-key="extId"><%= i18n.objIdNumberShort %></th>\n    <th data-key="name"><%= i18n.objName %></th>\n    <% if(reportSubtype === \'general\') { %>\n    <th data-key="alarms"><%= i18n.alarms.ucFirst() %></th>\n    <th data-key="alerts"><%= i18n.alerts.ucFirst() %></th>\n    <th data-key="total"><%= i18n.totalLabel %></th>\n    <% } else { %>\n    <th data-key="total"><%= i18n.quantityAsNumber %></th>\n    <% } %>\n</tr>'}),define("text!_common/reports/alertssummary/tmpl/groupsThead.html",[],function(){return'<tr data-head="<%= headPosition %>">\n    <th><%= i18n.alertsGroup %></th>\n    <th><%= i18n.quantityAsNumber %></th>\n</tr>'}),define("text!_common/reports/alertssummary/tmpl/alertsThead.html",[],function(){return'<tr data-head="<%= headPosition %>">\n    <th><%= i18n.alertCode %></th>\n    <th><%= i18n.alertMessage %></th>\n    <th><%= i18n.quantityAsNumber %></th>\n</tr>'}),define("text!_common/reports/alertssummary/tmpl/channelsThead.html",[],function(){return'<tr data-head="<%= headPosition %>">\n    <th><%= i18n.streamChannel %></th>\n    <th><%= i18n.quantityAsNumber %></th>\n</tr>'}),define("text!_common/reports/tmpl/day.html",[],function(){return'<tr<% if(typeof rowPosition != \'undefined\') { %> data-row="<%= rowPosition %>"<% } %>>\n    <td class="day<% if(isWeekend) {%> weekend<% } %>" colspan="<%=colspan || 20%>"><%=dateStr%></td>\n</tr>'}),define("text!_common/reports/alertssummary/tmpl/row.html",[],function(){return'<tr>\n    <td data-key="extId"><%= extId %></td>\n    <td data-key="name" class="text-left">\n    <% if(total && App.reportAllowedByType(\'ALERTS\')) {%>\n        <a href="javascript:;" class="build-another" data-type="alerts" title="<%= allAlertsOnObject %>"\n            data-id="<%= id %>" data-from="<%= periodStart %>" data-to="<%= periodEnd %>">\n            <%= name %>\n        </a>\n    <% } else { %>\n        <%= name %>\n    <% } %>\n    </td>\n    <% if(reportSubtype === \'general\') { %>\n    <td data-key="alarms"><%= alarms %></td>\n    <td data-key="alerts"><%= alerts %></td>\n    <td data-key="total"><%= total %></td>\n    <% } else { %>\n    <td data-key="total"><%= total %></td>\n    <% } %>\n</tr>'}),define("text!_common/reports/alertssummary/tmpl/groupRow.html",[],function(){return'<tr>\n    <td class="text-left">\n        <%= groupName %>\n    </td>\n    <td>\n        <%= count %>\n    </td>\n</tr>'}),define("text!_common/reports/alertssummary/tmpl/alertRow.html",[],function(){return'<tr>\n    <td class="text-left">\n        <%= String(alertCode).length === 4 ? alertCode / 10 : alertCode %>\n    </td>\n    <td class="text-left">\n        <%= alertName %>\n    </td>\n    <td>\n        <%= count %>\n    </td>\n</tr>'}),define("text!_common/reports/alertssummary/tmpl/channelRow.html",[],function(){return'<tr>\n    <td class="text-left">\n        <%= channelName %>\n    </td>\n    <td>\n        <%= count %>\n    </td>\n</tr>'}),define("text!_common/reports/alertssummary/tmpl/totalsRow.html",[],function(){return'<tr<% if(last) {%> data-row="last"<% } %> class="summary-row">\n    <th colspan="<%= colspan %>" class="text-left"><%= totalText %></th>\n    <% if(isGeneral) { %>\n    <th><%= data.total.alarms %></th>\n    <th><%= data.total.alerts %></th>\n    <th><%= data.total.alarms + data.total.alerts %></th>\n    <% } else { %>\n    <th><%= \'undefined\' === typeof data.totalCount ? data.total.alerts : data.totalCount %></th>\n    <% } %>\n</tr>'}),define("text!_common/reports/alertssummary/tmpl/summary.html",[],function(){return'<div class="summary">\n    <h3><%= i18n.summaryData %></h3>\n    <%= controls %>\n    <table class="rep-table">\n        <thead data-head="2">\n            <%= thead %>\n        </thead>\n        <tbody>\n            <%= tbody %>\n        </tbody>\n    </table>\n</div>'}),define("text!_common/reports/alertssummary/tmpl/controls.html",[],function(){return'<div class="rep-table-controls form-horizontal">\n    <div class="control-group">\n        <label class="control-label"><%= i18n.sort %></label>\n        <select class="form-control" name="sort">\n            <% _.each(sortFields, function(name, key) {%>\n            <option value="<%= key %>"<% if(key == curSortField) {%> selected<% } %>><%= name %></option>\n            <% }) %>\n        </select>\n        <select class="form-control" name="sortType">\n            <option value="asc"<% if(\'asc\' == curSortType) {%> selected<% } %>><%= i18n.sortTypeAsc %></option>\n            <option value="desc"<% if(\'desc\' == curSortType) {%> selected<% } %>><%= i18n.sortTypeDesc %></option>\n        </select>\n    </div>\n</div>'}),define("_common/reports/alertssummary/views/AlertssummaryReportView",["jquery","underscore","_common/reports/views/ReportView","text!_common/reports/tmpl/reportTable.html","text!../tmpl/thead.html","text!../tmpl/groupsThead.html","text!../tmpl/alertsThead.html","text!../tmpl/channelsThead.html","text!_common/reports/tmpl/day.html","text!../tmpl/row.html","text!../tmpl/groupRow.html","text!../tmpl/alertRow.html","text!../tmpl/channelRow.html","text!../tmpl/totalsRow.html","text!../tmpl/summary.html","text!../tmpl/controls.html"],function(e,t,n,i,r,o,a,s,l,d,c,m,u,p,h,f){function g(e){return'<tr><td class="text-left" colspan="'+e.colspan+'">'+e.text+"</td></tr>"}function v(e){switch(e){case"groups":return o;case"alerts":return a;case"channels":return s;default:return r}}function b(e){switch(e){case"groups":return c;case"alerts":return m;case"channels":return u;default:return d}}function y(e){return"general"===e}function S(e){return!/^groups|alerts|channels$/.test(e)}i=t.template(i),r=t.template(r),o=t.template(o),a=t.template(a),s=t.template(s),l=t.template(l),d=t.template(d),c=t.template(c),m=t.template(m),u=t.template(u),p=t.template(p),h=t.template(h),f=t.template(f);var T=n.extend({constructor:function(){this.sortFields={},this.curSortField="name",this.curSortType="asc",this.sumData=[],this.$sumTbody=null,n.apply(this,arguments)},render:function(){var t=new e.Deferred,r=this.model.getTexts(),o=this.model.get("reportSubtype"),a=S(o);n.prototype.render.apply(this,arguments),this.$el.addClass("alerts-report").attr("data-subtype",o),this._renderSubheader(),this.buildMetaInfo();var s="";if(this.model.get("showDetails")){this.content.append(i({key:this.model.get("key"),theadHtml:""})),s+=v(o)({i18n:r,headPosition:1,reportSubtype:o}),s+=a?this._renderRowsByObjects():this._renderRowsByGroupsAlertsOrChannels();var l=this.content.find("tbody");l.append(s)}var d={name:r.objName,extId:r.objIdNumber};return y(o)?(d.alarms=r.alarms.ucFirst(),d.alerts=r.alerts.ucFirst(),d.total=r.totalLabel):d.total=r.quantityAsNumber,this.sortFields=d,this.content.append(this._buildSummary()),this.$sumTbody=this.content.find(".summary tbody"),a&&this._initControls(),t.resolve(),t},_renderSubheader:function(){var e=this.model.getTexts().alertsSummaryReport,t=this.model.get("reportSubtype");this.content.append('<h3 class="rep-subheader">'+e[t]+"</h3>")},_renderRowsByGroupsAlertsOrChannels:function(){var e,n=this,i=this.model,r=i.getTexts(),o=i.getTexts().noAlerts,a=i.get("reportSubtype"),s=i.get("body").historyDays,d=s.length,c="alerts"===a?3:2,m=b(a),u="",h=0;return t.each(s,function(i){e=i.dayTs,u+=l({colspan:c,dateStr:n.formatDate(e)+" ("+n.getDayOfWeek(e)+")",isWeekend:n.isWeekend(e)}),i.data.length?(t.each(i.data,function(e){u+=m(e)}),u+=p({totalText:r.totalLabel,last:++h===d,colspan:c-1,isGeneral:!1,data:{totalCount:i.totalCount}})):u+=g({colspan:c,text:o})}),u},_renderRowsByObjects:function(){var e,n,i=this,r=this.model.get("header"),o=r.keyOrder,a=this.model.get("body"),s=this.model.get("reportSubtype"),c="general"===s,m={},u="",h=this.model.getTexts(),f=0,g=0,v=this.getDaysPeriods(r.sd,r.ed),b=t.keys(v).length,y=0;return t.each(v,function(t,v){u+=l({colspan:c?5:3,dateStr:i.formatDate(t)+" ("+i.getDayOfWeek(t)+")",isWeekend:i.isWeekend(t)}),f=0,g=0;for(var S=0,T=o.length;T>S;++S)e=o[S],n=a[e],v in n?(m=n[v],m.total=m.alerts+(c?m.alarms:0),m.total&&(m.periodStart=Math.max(t,r.sd)*App.MS,m.periodEnd=Math.min(m.periodStart+86400*App.MS,r.ed*App.MS)),c&&(f+=m.alarms),g+=m.alerts):m={alerts:0,alarms:0,total:0},m.id=n.id,m.name=n.name,m.extId=n.extId,m.allAlertsOnObject=h.allAlertsOnObject,m.reportSubtype=s,u+=d(m);u+=p({totalText:h.totalLabel,last:++y===b,colspan:2,isGeneral:c,data:{total:{alarms:f,alerts:g},totalCount:f+g}})}),u},_buildSummary:function(){var e=this.model.getTexts(),n=this.model.get("reportSubtype"),i=this.model.get("footer"),r=S(n),o=v(n)({headPosition:2,i18n:e,reportSubtype:n});if(r)this.sumData=t.values(t.omit(i,"total")).map(function(e){return Object.assign(e,{total:e.alerts+(y(n)?e.alarms:0)})});else if(this.sumData=i.data,!i.totalCount)return this.model.get("showDetails")?"":'<p class="no-data">'+e.noAlerts+"</p>";return h({i18n:e,controls:r?this._renderControls():"",thead:o,tbody:this._renderSummaryRows()})},_renderSummaryRows:function(){return S(this.model.get("reportSubtype"))?this._renderSummaryRowsByObjects():this._renderSummaryRowsByGroupsAlertsOrChannels()},_renderSummaryRowsByGroupsAlertsOrChannels:function(){this.model.getTexts();for(var e=this.model.get("footer").data,t=this.model.get("reportSubtype"),n=b(t),i="",r=0,o=e.length;o>r;++r)i+=n(e[r]);return i+=this._renderTotalsRow()},_renderSummaryRowsByObjects:function(){for(var e,n=this.model.getTexts(),i=this.model.get("header"),r=this.model.get("reportSubtype"),o="general"===r,a=this._sortData(),s="",l=0,c=a.length;c>l;++l)e=a[l],s+=d(t.extend(e,{allAlertsOnObject:n.allAlertsOnObject,total:e.alerts+(o?e.alarms:0),periodStart:i.sd*App.MS,periodEnd:i.ed*App.MS,reportSubtype:r}));return s+=this._renderTotalsRow()},_renderTotalsRow:function(){var e=this.model.get("reportSubtype");return p({totalText:this.model.getTexts().totalLabel,data:this.model.get("footer"),isGeneral:y(e),last:!0,colspan:S(e)||"alerts"===e?2:1})},_sortData:function(){var e=this.curSortField,n=t.sortBy(this.sumData,function(t){return this._getSortValue(t,e)}.bind(this));return"desc"===this.curSortType?n.reverse():n},_getSortValue:function(e,t){var n=t in e?e[t]:"";switch(t){case"extId":case"alarms":case"alerts":case"total":n=Number(n);break;default:n=n.toLowerCase()}return n},_renderControls:function(){var e=this.model.getTexts();return f({sortFields:this.sortFields,curSortField:this.curSortField,curSortType:this.curSortType,i18n:e})},_initControls:function(){var e=this,t=this.content.find("select[name=sort]"),n=this.content.find("select[name=sortType]");t.on("change",function(){e.curSortField=t.val(),e._rerender()}),n.on("change",function(){e.curSortType=n.val(),e._rerender()})},_rerender:function(){this.$sumTbody.html(this._renderSummaryRows()),this._createHeaderClones()}});return T}),define("_common/reports/alertssummary/AlertssummaryReport",["underscore","_common/reports/Report","_common/reports/alertssummary/views/AlertssummaryReportView"],function(e,t){var n=t.extend({url:App.getBaseUrl()+"reports/ALERTSUM/",constructor:function(){t.apply(this,arguments)},initialize:function(n){t.prototype.initialize.call(this,n);var i=this;this.get("module").getAlertsGroups().done(function(t){i.set("alertGroupId",e.pluck(t,"id"))}),this.setUserData("showDetails",this.get("showDetails")?1:0),this.setUserData("reportSubtype",this.get("reportSubtype"))},getPostParams:function(){var e=t.prototype.getPostParams.call(this);return this.get("showDetails")||(e.hideDetails=1),e.reportSubtype=this.get("reportSubtype"),e}});return n}),define("_common/reports/alerts/AlertsReport",["underscore","_common/reports/Report","i18n!_common/reports/nls/reports"],function(e,t){var n=t.extend({url:App.getBaseUrl()+"reports/ALERTS/",constructor:function(){t.apply(this,arguments)},initialize:function(n){var i=this.get("alertGroupId");i?e.isNumber(i)&&(i=[i]):i=[],this.set("alertGroupId",i),this.setUserData("alertGroupId",i),t.prototype.initialize.call(this,n)},getPostParams:function(){var e=t.prototype.getPostParams.call(this);return e.alertGroupId=this.get("alertGroupId"),e},readyForExport:function(){return!1}});return n.reportName=App.getTexts().reportsNames.alerts,n});