function RagChart(t,e,n,s){function o(t){var e=(""+t).replace(/[^0-9\.]/gi,""),i=parseFloat(e),n="number"==typeof i&&i!=+i;return n?0:i}var a=e,r=n,l=void 0==typeof s?{}:s,c=new Number,h=["green","yellow","red"],d="";this.init=function(){l&&l.rgaLength?(c=l.rgaLength,d=100/c,d=' style="height:'+d+'%;"'):c=3,l&&l.rga&&(h=l.rga),this.render()},this.render=function(){var e="";l&&"figsOnly"==l.type?(e+=this.renderFigs(),e+=this.renderLabels()):(e+=this.renderBars(),e+=this.renderFigs(),e+=this.renderLabels()),$(t).html(e)},this.renderBars=function(){for(var t='<div class="rag-bars"><ul>',e=0;c>e;e++)if(l&&l.customColor)t+='<li style="height: '+o(a[e])+'%"><div class="rag-bars-bar" style="background-color: '+l.customColor[e]+';"></div></li>';else{if(void 0==h[e])var i="mb-missing";else var i=h[e];t+='<li style="height: '+o(a[e])+'%"><div class="rag-bars-bar '+i+' mb"></div></li>'}return t+="</ul></div>"},this.renderFigs=function(){var t="";l&&l.postfix&&(t=l.postfix);var e="";l&&"figsOnly"==l.type&&(e="rag-figs-only");for(var i='<div class="rag-figs '+e+'"><ul>',n=0;c>n;n++)if(l&&l.customColor)i+="<li"+d+'><div class="rag-figs-fig"><p style="color: '+l.customColor[n]+';">'+a[n]+t+"</p></div></li>";else{if(void 0==h[n])var s="m-missing";else var s=h[n];i+="<li"+d+'><div class="rag-figs-fig '+s+'"><p>'+a[n]+t+"</p></div></li>"}return i+="</ul></div>"},this.renderLabels=function(){var t="";l&&"figsOnly"==l.type&&(t="rag-txts-only");var e='<div class="rag-txts '+t+'"><ul>';for(i=0;c>i;i++){if(void 0==h[i])var n="m-missing";else var n=h[i];e+="<li"+d+'><div class="rag-txts-txt '+n+'"><p>'+r[i]+"</p></div></li>"}return e+="</ul></div>"},this.init()}function FunnelChart(t,e,i,n){var s=e,o=i,a=void 0==typeof n?{}:n,r=s.length,l=s[0],c=[],h=.5/r,d="";this.init=function(){for(var t=0;r>t;t++)c[t]=100*(s[t]/l),c[t]=c[t]<1&&c[t]>0?1:Math.round(c[t]);if(a&&a.customColors)if(a.customColors.length!=r&&a.customColors.length>1)for(var t=0;r>t;t++)a.customColors[t]||(a.customColors[t]="#f6f6f6");else for(var t=0;r>t;t++)a.customColors[t]=a.customColors[0];for(var t=0;r>t;t++)void 0==o[t]&&(o[t]="-");d="height: "+100/r+"%;",this.render()},this.update=function(t){for(var e=[],i=0;i<t.length;i++)e[i]=null==t[i]?s[i]:t[i];s=e,l=s[0],this.init()},this.render=function(){var e="";a&&"right"==a.layout?(e+=this.renderFigs(),e+=this.renderFunnel()):(e+=this.renderFunnel(),e+=this.renderFigs()),$(t).html(e)},this.renderFunnel=function(){if(a&&"right"==a.layout)var t="d-funnels-right";else var t="d-funnels-left";for(var e='<div class="d-funnels '+t+'"><ul>',i=0;r>i;i++)os=a&&a.barOpacity&&0!=a.barOpacity?.6+i*h:1,e+=a&&a.customColors?'<li style="'+d+" width:"+c[i]+"%; opacity:"+os+"; background-color: "+a.customColors[i]+'"></li>':'<li class="green mb" style="'+d+" width:"+c[i]+"%; opacity:"+os+'"></li>';return e+="</ul></div>"},this.renderFigs=function(){for(var t='<div class="d-figstxts"><ul>',e=0;r>e;e++)os=a&&a.metricOpacity&&0!=a.metricOpacity?.6+e*h:1,t+=a&&a.customColors?'<li style="'+d+'"><div><p class="metric" style="opacity:'+os+"; color:"+a.customColors[e]+'">'+s[e]+"</p></div><div><p>"+o[e]+"</p></div></li>":'<li style="'+d+'"><div><p class="metric green mc" style="opacity:'+os+'">'+s[e]+"</p><p>"+o[e]+"</p></div></li>";return t+="</ul></div>"},this.init()}var PRODUCTION=!0;require(["common"],function(){requirejs.config({paths:{jqueryui:LIBS_PATH+"jquery/jquery.ui",jcolorbox:LIBS_PATH+"colorbox/jquery.colorbox",opentip:LIBS_PATH+"jquery/opentip-jquery.min",bootstrap:LIBS_PATH+"bootstrap/bootstrap",timepicker:LIBS_PATH+"bootstrap/timepicker/bootstrap-timepicker",carousel:LIBS_PATH+"bootstrap/carousel/bootstrap-carousel",charts:LIBS_PATH+"charts",EasyPieChart:LIBS_PATH+"charts/easyPieChart/easypiechart",datatables:LIBS_PATH+"grids/DataTables/js/jquery.dataTables","datatables-scroller":LIBS_PATH+"grids/DataTables/extensions/Scroller/js/dataTables.scroller.min",moment:LIBS_PATH+"moment/moment-with-locales-cropped",fileDownload:LIBS_PATH+"jquery/fileDownload/jquery.fileDownload",validation:LIBS_PATH+"jquery/validation/jquery.validate",colresize:LIBS_PATH+"jquery/colresize/jquery.colresize",util:COMMON_PATH+"util/util",geo:COMMON_PATH+"geo/geo",maps:COMMON_PATH+"maps",geozones:COMMON_PATH+"geozones"},shim:{jqueryui:["jquery"],jcolorbox:["jquery"],bootstrap:["jquery"],timepicker:["jquery"],carousel:["jquery"],fileDownload:["jquery"]}}),requirejs(["_common/AppModule"],function(t){"undefined"==typeof UNSUPPORTED_BROWSER&&("App"in window||new t("App",{id:"app"}))})}),define("_common/main",function(){}),define("bootstrap",["jquery"],function(t){!function(t){t(function(){t.support.transition=function(){var t=function(){var t,e=document.createElement("bootstrap"),i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(t in i)if(void 0!==e.style[t])return i[t]}();return t&&{end:t}}()})}(window.jQuery),+function(t){function e(e){var i=e.attr("data-target");i||(i=e.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var n=i&&t(i);return n&&n.length?n:e.parent()}function i(i){i&&3===i.which||(t(s).remove(),t(o).each(function(){var n=t(this),s=e(n),o={relatedTarget:this};s.hasClass("open")&&(i&&"click"==i.type&&/input|textarea/i.test(i.target.tagName)&&t.contains(s[0],i.target)||(s.trigger(i=t.Event("hide.bs.dropdown",o)),i.isDefaultPrevented()||(n.attr("aria-expanded","false"),s.removeClass("open").trigger(t.Event("hidden.bs.dropdown",o)))))}))}function n(e){return this.each(function(){var i=t(this),n=i.data("bs.dropdown");n||i.data("bs.dropdown",n=new a(this)),"string"==typeof e&&n[e].call(i)})}var s=".dropdown-backdrop",o='[data-toggle="dropdown"]',a=function(e){t(e).on("click.bs.dropdown",this.toggle)};a.VERSION="3.3.7",a.prototype.toggle=function(n){var s=t(this);if(!s.is(".disabled, :disabled")){var o=e(s),a=o.hasClass("open");if(i(),!a){"ontouchstart"in document.documentElement&&!o.closest(".navbar-nav").length&&t(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(t(this)).on("click",i);var r={relatedTarget:this};if(o.trigger(n=t.Event("show.bs.dropdown",r)),n.isDefaultPrevented())return;s.trigger("focus").attr("aria-expanded","true"),o.toggleClass("open").trigger(t.Event("shown.bs.dropdown",r))}return!1}},a.prototype.keydown=function(i){if(/(38|40|27|32)/.test(i.which)&&!/input|textarea/i.test(i.target.tagName)){var n=t(this);if(i.preventDefault(),i.stopPropagation(),!n.is(".disabled, :disabled")){var s=e(n),a=s.hasClass("open");if(!a&&27!=i.which||a&&27==i.which)return 27==i.which&&s.find(o).trigger("focus"),n.trigger("click");var r=" li:not(.disabled):visible a",l=s.find(".dropdown-menu"+r);if(l.length){var c=l.index(i.target);38==i.which&&c>0&&c--,40==i.which&&c<l.length-1&&c++,~c||(c=0),l.eq(c).trigger("focus")}}}};var r=t.fn.dropdown;t.fn.dropdown=n,t.fn.dropdown.Constructor=a,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=r,this},t(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",o,a.prototype.toggle).on("keydown.bs.dropdown.data-api",o,a.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",a.prototype.keydown)}(t),+function(t){function e(e){return this.each(function(){var n=t(this),s=n.data("bs.tab");s||n.data("bs.tab",s=new i(this)),"string"==typeof e&&s[e]()})}var i=function(e){this.element=t(e)};i.VERSION="3.3.7",i.TRANSITION_DURATION=150,i.prototype.show=function(){var e=this.element,i=e.closest("ul:not(.dropdown-menu)"),n=e.data("target");if(n||(n=e.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var s=i.find(".active:last a"),o=t.Event("hide.bs.tab",{relatedTarget:e[0]}),a=t.Event("show.bs.tab",{relatedTarget:s[0]});if(s.trigger(o),e.trigger(a),!a.isDefaultPrevented()&&!o.isDefaultPrevented()){var r=t(n);this.activate(e.closest("li"),i),this.activate(r,r.parent(),function(){s.trigger({type:"hidden.bs.tab",relatedTarget:e[0]}),e.trigger({type:"shown.bs.tab",relatedTarget:s[0]})})}}},i.prototype.activate=function(e,n,s){function o(){a.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),r?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu").length&&e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),s&&s()}var a=n.find("> .active"),r=s&&t.support.transition&&(a.length&&a.hasClass("fade")||!!n.find("> .fade").length);a.length&&r?a.one("bsTransitionEnd",o).emulateTransitionEnd(i.TRANSITION_DURATION):o(),a.removeClass("in")};var n=t.fn.tab;t.fn.tab=e,t.fn.tab.Constructor=i,t.fn.tab.noConflict=function(){return t.fn.tab=n,this};var s=function(i){i.preventDefault(),e.call(t(this),"show")};t(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',s).on("click.bs.tab.data-api",'[data-toggle="pill"]',s)}(t)}),define("_common/nls/common",{root:{save:"Save",apply:"Apply",saveAndClose:"Save and close",saveChanges:"Save changes","delete":"delete",edit:"edit",copy:"Copy",yes:"Yes",no:"No",description:"Description",quantity:"Quantity",totalQuantity:"Total quantity",quantityAsNumber:"Number",totalNumber:"Total number",restore:"Restore",build:"generate",rebuild:"regenerate",params:"Options",hasBeenBuilt:"is generated",hasBeenDownloaded:"is downloaded",connection:"connection",coords:"coordinates",coordinatesTime:"Fixture time",place:"Location",lat:"Latitude",lon:"Longitude",address:"address",addresses:"addresses",addressNotFound:"The address is not found",canNotFindCoordsByAddress:"Failed to define coordinates by the address.",specifyAddress:"Enter an address",distanceToAddress:"Distance to an address",objectAddress:"Object address",country:"Country",region:"Area",city:"Town",street:"Street",house:"House",building:"Building",phone:"phone",phones:"phones",comments:"comment",info:"information",service:"Service",note:"Note",row:"row",or:"or",and:"and",add:"add",change:"change",choose:"Select","new":"new",next:"next",prev:"previous",current:"current",nextShort:"next",prevShort:"prev",another:"another",nearest:"nearest",all:"all",online:"Online",filteredOnly:"Filter",print:"Print",pleaseWait:"Please wait",fromDate:"from",from:"from",rangeFrom:"from",to:"to",upto:"to",till:"to",attention:"Warning",attentionExclaim:"Warning!",defaultDialogHeader:"Attention",hide:"Hide",hideAll:"Hide all",show:"show",showAll:"Show all",switchState:"State",switchedOn:"Switched on",switchedOnShort:"On",switchedOff:"Switched off",switchedOffShort:"Off",switchOn:"Switch on",switchOff:"Switch off",selectAll:"Select all",notSelected:"Is not selected",notEntered:"Is not specified",confirmation:"Confirmation",cancel:"Cancel",submit:"Submit","continue":"Continue",done:"Done",toDate:"to",dataForDate:"Data for",name:"name",vehicleType:"Vehicle type",color:"color",changeColor:"Change color",power:"power",powerOn:"Main",powerOff:"Reserve",powerReserve:"Standby power supply",powerMain:"Main power supply",hardware:"Equipment",objImage:"Image",changeImage:"Change image",chooseImage:"Select image",chooseObjectImage:"Select an object image",objServing:"Maintenance",objServed:"Is maintained",objNotServed:"Is not maintained",user:"user",userid:"User ID",username:"username",login:"login",password:"password",demo:"Demo",accountRightsAreLimited:"The rights to your account are limited.",simCard:"SIM card",GSMConnection:"Connection",GlonassGPS:"GLONASS/GPS",settings:"settings",device:"Device",object:"object",objects:"objects",objectsLabels:["object","objects"],objectsLabels1:["object","objects"],byObject:"by object",bySelectedObjects:"by selected objects",byNSelectedObjects:"by #n# #type#",selectedObjects:"Objects selected",selectedObjectsOnly:"Selected objects only",nObjectsSelected:["#n# object is selected","#n# objects selected"],allObjects:"All objects",searchingObjectsAndGroups:"Search for objects and groups",noWatchedObjectsMsg:"There are no objects selected",noWatchedVehiclesMsg:"There are no vehicles selected.",noWatchedStationaryMsg:"There are no real estates selected.",openObjectCard:"Open an object card",objectCardLoadingFailed:"Failed to open an object card",showExtentedInfo:"Show extended information",showShortedInfo:"Show compact information",vehicles:"Vehicles",vehiclesLabels:["vehicle","vehicles"],byVehiclesLabels:["vehicle","vehicles"],forVehiclesOnly:"Only for vehicles",stationary:"Real Estate",stationaryLabels:["real estate","real estates"],byStationaryLabels:["real estate","real estates"],forStationaryOnly:"Only for real estate",objectTitleType:"Title",objProps:"Object properties",objState:"Object state",objStatus:"Status",objStatuses:{1:"Is maintained",0:"Is not maintained",2:"Service",4:"Control"},objName:"Object name",objTitle:"Object title",objIdNumber:"Object ID",objIdNumberShort:"ID",objModel:"Brand/model",licenseNumber:"Number plate",objYear:"YOM",objVin:"VIN",objGroup:"Object's group",emptyObjGroupAddWarning:"Group #name# can not be added because it does not contain objects",objServerPassword:"Connection password",objOwner:"Owner",objOwnerPass:"Owners's password",objContract:"Contract number",objContractDate:"Date of contract",objHardwareType:"Device type",objHardwareUnknown:"Unknown",objExtraHardware:"Additional equipment",objEquipmentIds:"Identifiers",objPhoto:"Object photo",objTrackReading:"Track reading",noPictures:"There are no images yet",addPicture:"Add an image",deletePicture:"Delete an image",enterComment:"Enter a comment",upload:"Load",uploadFailed:"Failed to upload the file.",confirmDeletePicture:"Please confirm deletion of the image",pictureHadBeenDeleted:"The image was deleted",noCaption:"No title",addObject:"Add an object",addChildGroup:"Add a subgroup",errAddGroupBefore:"To add an object, create at &nbsp;least one&nbsp;group.",setupDevice:"Setup a device",errSetupLoad:"Unable to open setup window due to a server error.",firmwareUpdate:"Update",firmwareHasUpdate:"Update available",firmwareHasNoUpdate:"Update not available",firmwareUpdateStart:"Update firmware",firmwareStopUpdate:"Cancel update",firmwareChangesHeader:"List of changes when updating",firmwareUpdateCommandSent:"The command is sent.",firmwareUpdateConfirm:{msg:"<p>By launching the update, you are guided by the terms of the <a target='_blank' href='http://www.ritm.ru/agreement/'>User&nbsp;Agreement</a>, confirm that you&nbsp;are&nbsp;familiar with&nbsp;the&nbsp;list of&nbsp;changes and&nbsp;features of&nbsp;the&nbsp;new&nbsp;version, and&nbsp;you&nbsp;are&nbsp;satisfied with&nbsp;these&nbsp;changes.</p><p>The updates are downloaded in&nbsp;the&nbsp;background and does&nbsp;not interfere with the&nbsp;device operation. The device will&nbsp;be unavailable for a&nbsp;few&nbsp;minutes with&nbsp;applying the&nbsp;new downloaded version.</p>",hdr:"Update Confirmation"},firmwareStopUpdateConfirm:{msg:"You can&nbsp;do the&nbsp;update later.",hdr:"Cancel the device update?"},shellWsWarning:'For the setup programs to work, you need to&nbsp;change the&nbsp;system and network settings of&nbsp;the&nbsp;GeoRitm service in&nbsp;accordance with&nbsp;<a href="http://www.ritm.ru/en/documentation/manuals/GEO.RITM/GEO.RITM_DeviceJS_Manual.php" target="_blank">the&nbsp;instructions</a>. To change the settings, contact the&nbsp;administrator of your GeoRitm service.',swfShellUsageWarning:'In connection with the termination of support for Adobe Flash technology in browsers, for&nbsp;the&nbsp;new versions of the&nbsp;setup programs to&nbsp;work, you need to&nbsp;change the&nbsp;system and network settings of&nbsp;the&nbsp;GeoRitm service in&nbsp;accordance with&nbsp;<a href="http://www.ritm.ru/en/documentation/manuals/GEO.RITM/GEO.RITM_DeviceJS_Manual.php" target="_blank">the&nbsp;instructions</a>. To change the settings, contact the&nbsp;administrator of your GeoRitm service.',find:"find",sortBy:"Sort by:",search:"Search",searchResultLable:"Found",searchNoResults:"No results",tableNoRecords:"There are no records",searchObjects:"Search for objects",searchZones:"Search for zones",nothingFoundByYourRequest:"Your search returned no results",findClosestObjects:"Search for the nearest objects",inRadius:"within a radius",anotherRadius:"Another radius",noObjectsFound:"There are no objects found",report:"report",reports:"reports",reportParams:"Report options",buildReport:"Generate a report",reportBuildingHasStarted:"Report generation has started",reportBuildingInProgress:"Report generation in progress.",errorReportBuilding:"Report generation has failed.",errorReportBuildingStillInProgress:"Please wait until the end of the report generation.",downloadReport:"Download report",reportDownloadingInProgress:"Report downloading in progress.",errorReportAlreadyDownloaded:"Report already downloaded.",errorReportDownload:"Could not download report.",buildReportByGroup:"Generate a report by group",geozone:"geofence",geozones:"geofences",pois:"Points",showPoiNamesOnMap:"Show point names on the map",traffic:"Traffic",error:"Error",commonSuccessHeader:"All right",group:"Group",groups:"Groups",addGroup:"Add group",renameGroup:"Rename group",enterGroupName:"Enter group name",distance:"Distance",maxDistance:"Maximum distance",runDistance:"Mileage",close:"close",clear:"clear",reload:"reload",clearMap:"Clear the map",printMap:"Print the map",autozoom:"Selfscaling",zoomIn:"Zoom in",zoomOut:"Zoom out",mapPanUp:"Up",mapPanDown:"Down",mapPanLeft:"Left",mapPanRight:"Right",mapRuler:"Ruler",mapName:"#name# map",map:"map",showOnMap:"Show on the map",showOnYandexMap:"Open on Yandex maps",showOnGoogleMap:"Open on Google maps",satMapName:"#name# satellite",hybridMapName:"#name# hybrid",landMapName:"#name# terrain",transMapName:"#name# vehicles",wikiMapName:"#name# wiki",specialMapName:"Additional map",removeFromMap:"Remove from the map",zoomToObject:"Zoom to the object",copyLinkToObject:"Copy link to the object",linkToObjectIsCopied:"The link to&nbsp;the&nbsp;object is&nbsp;copied to&nbsp;the&nbsp;clipboard",routeBuilding:"Route generating",routeHere:"Route to this point",buildRoute:"Generate the route",routeNoTrafficAlert:"Route is generated without traffic jams",errCanNotBuildRoute:"Unable to generate the route",errNoRoutingOnMap:"Unable to generate the route on the selected map.",andMore:"and more #q# #l#",logout:"logout",chart:"chart",showChart:"Show chart",hideChart:"Hide chart",buildChart:"Build chart",noChartData:"No data for chart",noDataForChartsByParameters:"No data for charts for selected parameters",deviceInput:"Input",deviceOut:"Output",deviceOuts:"Outputs",errorChangeOutput:"Output state changing failed.",noDeviceOuts:"No outputs added yet",addDeviceOut:"Add output",deviceOutNumShort:"Output #",deviceOutName:"Output name",deviceOutTypeOpenCollector:"Open collector",deviceOutTypeRelay:"Relay",deviceOutTypeRadioRelay:"Radio relay",deviceOutTypeAddressRelay:"Address relay",deviceOutType1Wire:"1-Wire output",deviceOutControlManual:"manual control",deviceOutControlAuto:"automatic control",deviceControlOutsAllAdded:"All available outputs are already added",deviceControlOutsNoAvailable:"No available outputs",errorInvalidDeviceOuts:"Wrong output options specified",errorDeviceOutsState:"Fail to receive output states. Check object settings and try again.",errorInvalidParams:"Wrong options specified",fuel:"fuel",fuelVolume:"Fuel level",voltage:"Voltage",temperature:"Temperature",showLbs:"Show LBS",updateLbs:"Update LBS",hideLbs:"Hide LBS",errorLbsSearch:"Fail to upload data on LBS location<br />(parameters: #p#)",setDefaults:"set defaults",switchOffAll:"disable all",recommended:"recommended",notRecommended:"is not recommended",editHistory:"Changes history",settingsField:"Setting",settingOldValue:"Old value",settingNewValue:"New value",optionalTimeSettings:"Optional time settings",hideOptionalTimeSettings:"Hide optional time settings",dataOnlyInsideRange:"Data only in specified time range",reportsNames:{run:"Mileage report",runShort:"Mileage report (short)",movepark:"Driving and parking report",speeding:"Speeding report",speeding2b:"Speeding report (2 thresholds)",acceleration:"Aggressive driving report",flow:"Fuel consumption report",fuelsum:"Fuel level summary report",fuel:"Fuel level report",fuel2:"Fuel level report (form 2)",device:"Machine report",device2:"Object operation report",can:"Object operation report (CAN)",zoneviz:"Geofence visit report",zoneex:"Geofence leaving report",zonevizcount:"Geofence visit count report",pass:"Passenger traffic report (global count)",passmatrix:"Passenger traffic report",lostfix:"Fixture loss report",objst:"Object state report",alertssummary:"Events and alarms summary report",alerts:"Events and alarms per object",alertjournal:"Selected events and comments report",temperature:"Temperature abuse report",objtemp:"Temperature report",voltage:"Voltage report",engspeed:"Engine RPM report",discretes:"Discrete parameters report",distance:"Report on distance to objects",guardscallcount:"Quantitative report of RRT object visits",drivesafety:"Driving safety report",drivesafetysum:"Driving safety summary report",objjournal:"Object's journal",objservice:"Object maintenance time report",timeseries:"Selected parameters chart",accesscard:"Access cards usage report"},useFormattedTimeseriesData:"Use сalibrated data",alertsSummaryReport:{general:"Total number of events and alarms",groups:"Number of events by groups",alerts:"Number of events by codes",channels:"Number of events by link channels",connect:"Number of connections",loss:'Number of the "connection lost" events',"220v":"Number of outages (220 V)",power:"Number of problems with batteries"},reportGroupNames:{tech:"Technical",history:"Events and alarms",location:"Location and mileage",safety:"Driving safety",fuel:"Fuel check",sensors:"Operation check",geozones:"Visits of geozones check",special:"Special"},track:"track",tracks:"tracks",clearTracksList:"Clear the list",showTrackPoints:"Show track points",colorTracks:"Color tracks based on speed",tracksCountText:"#n# generated",showTrack:"Show the track",hideTrack:"Hide the track",zoomToTrack:"Zoom to the track",removeTrack:"Remove the track",removeEmptyTracks:"Remove empty tracks",showHideTrack:"Show/Hide",buildTrack:"Generate the track",buildTrackByGroup:"Generate the track based on the group",pleaseBuildOneTrack:"Generate at least one track please",severalTracksShownLeaveOneForZone:"The map shows several tracks. Leave only one please to build the zone",tooManyObjectsForTracks:"Too many objects selected. It is possible to build tracks using no more than #max# objects",trackPlayer:"Track player",trackPlaySpeed:"Play speed",msgCanNotBuildTracks:"Track generating failed due to the server error. Please try again later.",speedLessThan:"The speed is less than",speedFrom:"The speed is from",speedGreaterThan:"The speed is more than",saveAsPlt:"Save to file (.plt)",saveToFile:"Save to file",saveObjectCardToFile:"Saving of object card to file",parks:"Stops",parkBegin:"start",parkEnd:"end",parkTime:"stop time",discret:"discrete",discretSensor:"Sensor",discretSensors:"Discrete sensors",discretParam:"Parameter",analogue:"analog",analogueSensor:"Sensor",sensorValue:"Sensor readings",tiltSensor:"Tilt sensor",dataSource:"Data source",calculatedValue:"Expected value",noDataForDay:"There is no data for this day",noDataForPeriod:"There is no data for this period",noDataForObject:"There is no data for this object",dateInstall:"Installation date",placeInstall:"Installation location",installer:"Installer",imeiChangeConfirm:{msg:"Removing or changing the IMEI-code in object's properties will disconnect the device from the system.",hdr:"Change IMEI?"},additionalInfo:"Additional information",currentState:"State",turnOff:"Turn off",turnOn:"Turn on",auto:"auto",autoMode:'"Auto" mode',history:"Chronology",alarm:"alarm",withAlarm:"with alarm",alarms:"alarms",alarmsLabels:["alarm","alarms"],objWithAlarms:"with alarms",totalAlarms:"Total alarms",totalAlarmsShort:"Alarms",alarmsShort:"Alarms",commentAlarmResolved:"Alarm is resolved",commentAllAlarmsOnObjResolved:"All alarms at the object are resolved",commentAllAlarmsResolved:"All alarms are resolved",alert:"event",alerts:"events",alertEvent:"Event",totalAlertsShort:"Events",objectAlertsAndLog:"Events and log",alertsLog:"Event list",turnOnAlertsLog:"Turn on the event list",alertsLogDepth:"Maximum number of entries",alertsLogFilters:"Filters",inputStream:"Incoming stream",allInputStreams:"All incoming streams",anyInputStream:"Any incoming stream",stopAlertsLog:"Stop",resumeAlertsLog:"Resume",objArea:"Area",objAreas:"Areas",objAreasLabels:["area","areas"],allObjAreas:"All areas",chooseObjAreas:"Select areas",objAreaNum:"Area №",objAreaName:"Area name",objAreaNoName:"No name",zeroAreaName:"System",objAreaComment:"Note",areaDoesNotExist:"Area does not exist",rolesForAreas:"User roles allowed to control the area",rolesForAreasAll:"All roles allowed to control the area",haveNoPermissionToControlArea:"Prohibited to control this area",alarmAreas:"Areas with alarm",notAlarmAreas:"Areas without alarms",faultAreas:"Fault areas",faultAreasShort:"Fault",notFaultAreas:"Fault-free areas",guardedAreas:"Armed areas",notGuardedAreas:"Disarmed areas",objAreaStateNorm:"Normal",objAreasStateLoading:"Areas state loading",objZone:"Zone",objZones:"Zones",objZoneKey:"Zone/Key",objZoneKeyName:"Zone/Key name",objInputZoneKey:"Input/Zone/Key",chooseObjZones:"Select zones",allZonesOfSelectedAreas:"All zones of selected areas",objZoneStateNorm:"Normal",objZoneStateViolated:"Violation",withAlarms:"With alarms",alarmWindowHeader:"There are unprocessed alarms on #n# #t#",alarmWindowHeaderNoAlarms:"There are no unprocessed alarms",turnOffSound:"Mute",turnOnSound:"Unmute",chooseAction:"Select an action",addComment:"Add comment",resolveAlarm:"Resolve alarm",noAlarms:"There are no alarms",guarded:"Armed",guardedPartly:"Armed partly",makeGuarded:"Arm",notGuarded:"Disarmed",notGuardedMulti:"Disarmed",makeNotGuarded:"Disarm",hasFault:"Fault",noFault:"Fault-free",viewAndResolveFaults:"View and resolve faults",viewFaults:"View faults",faultsList:"Fault list",resolveAllFaults:"Resolve all",resolveFault:"Resolve",resolveFaultConfirm:"Resolve the fault?",resolveAllFaultsConfirm:"Resolve all faults and close the list?",noFaultsOnObject:"No faults on the object.",systemFaultOrAlarm:"System",alertsParameters:"Events parameters",alertCode:"Event code",alertMessage:"Event name",alertOrCommentMessage:"Event (action, comment)",alertsGroup:"Event group",alertsGroups:"Event groups",allAlertsGroups:"All event groups",chooseAlertsGroups:"Select event groups",totalAlerts:"Total event",allAlerts:"All events",allAlertsOnObject:"All events on the object",allAlertsOffSelectedGroups:"All events of selected groups",chooseAlert:"Select event",chooseAlerts:"Select events",chooseZones:"Select a geofence to find a speeding",timeOfCreation:"Creation time",timeOfReceive:"Receipt time",key:"key",gsmProvider:"Operator",streamChannel:"Link channel",streamChannels:"Link channels",actionsAndComments:"Actions and comments",allActionsAndComments:"All actions and comments",otherComments:"Other",alertsControl:"Control",alertControlCopy:"Control parameters copying",alertControlCopyFormLabel:"Please, select the&nbsp;object or&nbsp;group of&nbsp;objects where it&nbsp;is&nbsp;needed for the&nbsp;control parameters copying",alertControlCopyConfirm:"<p>Do you want to&nbsp;copy options of&nbsp;events control of&nbsp;the&nbsp;object to&nbsp;the&nbsp;selected objects?</p>",alertControlExtraSettings:"More options",alertControlConnection:"Object communication control",alertControlConnectionTip:"Do the alarm generation when it has no connection, within the specified time, hh:mm",alertControlAutotest:"Autotest control",alertControlAutotestTip:"Do the alarm generation when it has no autotest, within the specified time, hh:mm",alertControlSaveAutotestsLabel:"Store and use autotest events after processing by the control algorithm",alertControlActivity:"Activity control",alertControlActivityTip:"Do the alarm generation when it have no events from device, within the specified time, hh:mm",alertControlVoltage:"The control of 220V restore",alertControlVoltageTip:"Do the alarm generation when it has no restore of 220V, within the specified time, hh:mm",alertControlEnterDelay:"Entry delay control",alertControlEnterDelayTip:"The alarm delay of zone entry, sec.",alertControlReceivedAlerts:"Received alarms of zone",alertControlExpectedAlerts:'Expected "Restore" events',alertControlEnterDelayZonesLabel:"Controlled zones",alertControlPanicButton:"Panic button restore control",alertControlPanicButtonTip:"Alarm delay, sec.",alertControlMovement:"Downtime check",alertControlMovementTip:"Generate an alarm in the absence of motion within an established period of time, hh:mm",alertControlMovementIgnore:"Ignore downtime in geofences",alertControlLostCoord:"Coordinates loss control",alertControlLostCoordTip:"Generate an alarm in the absence of coordinates within an established period of time, hh:mm",alertControlLostCoordIgnore:"Ignore loss of coordinates",streamChannelsControl:"Link channel control",alertControlChannelsTip:"Generate an alarm in the absence of a control signal for a specified time, hh:mm",alertControlControlledAlerts:"Events used for control",selectStreamChannels:"Select link channels",createAlert:"Generate an alert",alertsListControl:"Event list control",alertsListControlTip:"Generate an alarm in the absence of expected events within the specified time, hh:mm",alertsListReceivedAlert:"Initial event",alertsListExpectedAlerts:"List of expected events",alertsListCondition:"Event generation condition",alertsListConditionFalse:"Not all expected events was received",alertsListConditionTrue:"All expected events was received",objectStateScan:"Object state scan",stateScanProcessing:"State scanning",deviceAreaStates:{1:"alarm",2:"near fire alarm",4:"fire",8:"fault",16:"entrance delay",32:"exit delay"},deviceZoneStates:{1:"alarm zone",2:"near fire alarm",4:"fire",8:"fault",16:"entrance delay",64:"bypass",128:"battery discharge",256:"short circuit",512:"breakage",1024:"offline",2048:"tamper alarm",4096:"radio sensor's Primary Zone violation",8192:"radio sensor's Secondary  Zone violation"},objectStateScanResult:"Device status scan results",objectStateScanIdNotFound:"Scan ID not found",objectStateScanFailed:"Scan failed",objectStateInvalidImei:"A device with another IMEI (#imei#) responses to the specified SIM card number",noAreasData:"No data on Areas",rrTeam:"Rapid response team",rrTeamShort:"RRT",rrTeams:"Rapid response teams",loadingRRTGroupsList:"Loading list of RRT teams",allRRT:"All RRTs",addRRT:"Add RRT",addRRTGroup:"Add group of RRT objects",noRRT:"No RRT found",noRRTGroups:"No RRT object group found",selectedRRTGroups:"Selected object groups",deleteRRTGroupConfirmMsg:"Remove object group from RRT list?",searchRRT:"Search RRT",repeatSearch:"Search again",rrtCall:"Call",rrtNoCall:"No call",rrtCalled:"Call sent to RRT",rrtCallTime:"Called at",rrtArriveTime:"Arrived at",rrtCallAccepted:"Call accepted",rrtCallNotAccepted:"Call not accepted",rrtCancelCall:"Cancel RRT call",rrtCancelCallShort:"Cancel call",rrtCompleteCall:"Complete RRT call",rrtCompleteCallShort:"Complete call",rrtPerson:"Responsible person",rrtLocation:"Location",noRRTboundToObject:"No RRT assigned to the stationary object",rrtSelectManually:"Choose manually",responsible:{header:"Responsible",pass1:"Identification password",pass2:"Forced password",persons:{key:"Key №",name:"Name",phone1:"Phone 1",phone2:"Phone 2",comment:"Note",addNew:"Add a person",noData:"There are no responsible persons specified"},copyList:"Copy list of responsible",copyResponsibleFormLabel:"Select the object/group where you want to copy response list.",copyConfirm:"<p>Do you want to copy current saved list of responsible persons to the selected objects?</p><p><strong>Warning!</strong> The list of responsible persons in the selected objects will be replaced.</p>"},notification:"Notification",notifications:"Notifications",newNotification:"New notification",addNotification:"Add notification",notificationName:"Notification name",notificationSwitchedOn:"Switched on",notificationSwitchedOff:"Switched off",noNetwork:"No network",notificationLimitReached:"Notification number limit reached.",notificationAddressesHelp:"Addresses should be comma separated or each address should be on new line.",notificationPhonesHelp:"Phone numbers can contain only numbers. Phone number length is from 9 to 15 characters including country code.",errNotificationName:"Enter the notification name.",errNotificationAddresses:"Enter at least one address.",errNotificationAddressesIncorrect:"One or more addresses are invalid.",errNotificationMaxAddresses:"Maximum #max# addresses are allowed.",errNotificationAlerts:"Select at least one event group or one event ContactID.",errNotificationAreas:"Select at least one area.",notificationDeleteConfirm:{msg:"Are you sure you want to delete notification #name#?",hdr:"Delete the notification?"},video:"Video",videoOnline:"Online",videoArchive:"Archive",camera:"Camera",connect:"Connect",cameraOnObject:"Video from the object #title#",noCamerasAdded:"No camera was added",cameraNotSelected:"Is not selected",addCamera:"Add a camera",addTemperatureSensor:"Добавить датчик температуры",temperatureSensor:"Датчик температуры",numberZoneSensor:"№ зоны датчика",nameSensor:"Наименование датчика",noSensorsAdded:"Не добавлено ни одного датчика",videoCamera:"Camera",cameraNumber:"Camera number",cameraName:"Camera name",cameraNameIvideon:"Camera name at Ivideon",errCamerasListLoad:"Failed to load camera list. Check account login and password on&nbsp;Ivideon.",errCamerasListEmpty:"No camera assigned to you account on&nbsp;Ivideon.",errCameraNotAvailable:"Previously assigned camera unavailable.",errCameraNotOnlineOrNotPaid:"Connection to the camera could not be established",errCameraPreview:"Failed to load the image.",showCamera:"Show video",showCameras:"Show cameras",showVideo:"Show video",ivideonInfo:"<p>GeoRitm allows image streaming from&nbsp;cameras, connected to&nbsp;the cloud service iVideon.</p><p>Enter login&nbsp;and&nbsp;password for&nbsp;the connection to&nbsp;the service&nbsp;iVideon in&nbsp;the object&nbsp;card and&nbsp;select the camera, which image&nbsp;will be&nbsp;available in&nbsp;properties of this&nbsp;object</p>.",useDirectVideo:"Use direct connection",deviceIp:"Device IP",deviceCameraPort:"Camera ports (comma separated)",rtspStreamUrl:"RTSP-stream URL",videoLoadingArchive:"Archive loading...",errVideoArchiveLoading:"Failed to load archive entries data.",errVideoStreamNotFound:"Failed to establish a connection",errVideoUnknownError:"Unknown error",errVideoPlayerLibUnavailable:"Player is unavailable.",errVideoNoImei:"The object has&nbsp;no&nbsp;IMEI, connection is&nbsp;impossible.",errVideoNoCameras:"The object has&nbsp;no camera list, connection is&nbsp;impossible.",errVideoDeviceOffline:"The object can&nbsp;not broadcast video at&nbsp;the&nbsp;moment, connection is&nbsp;impossible.",errVideoConnection:"Failed to establish a connection.",errNoRtspVideoInIe:"Watching videos from RTSP cameras will not be available in Internet Explorer.",videoFilesWillBeTransmitted:"Video archive is loading, please wait.",videoFilesAreBeingTransmitted:"Video archive is loading, please wait.",videoFilesTransmissionHasFailed:"Failed to upload video archive.",errVideoCommandSendingFail:"Failed to send a command to the device.",errSignalServerUnavailable:"Error connecting to&nbsp;the&nbsp;signal&nbsp;server.",errNoIceServers:"There is no data of the ICE servers.",addTemperatureSensor:"Add temperature sensor",temperatureSensor:"Temperature sensor",numberZoneSensor:"# of the sensor zone",nameSensor:"Sensor name",noSensorsAdded:"No sensors added",lname:"Last name",mname:"Middle name",namesOrder:["fname","mname","lname"],technician:"Technician",technicians:"Technicians",technicianNoRecords:"There are no technicians yet",technicianAdd:"Add technician",technicianCreate:"New technician",errEnterTechnicianName:"Please enter first name",errEnterTechnicianLastName:"Please enter last name",errEnterTechnicianNotSelected:"Select technician to switch into service",technicianDeleteConfirm:{msg:"Are you sure you want to delete the technician?",hdr:"Delete technician?"},technicianNotSelected:"Technician is not selected",technicianNotSet:"Technician is not assigned.",setServiceStatusForPeriod:"Temporary switching to service",setServiceStatusPeriodLabel:"For #n# #l#",setServiceStatusNoLimit:"Permanently",setServiceStatusTillDate:"To specified date",serviceLeftTime:"#t# left",simCardNumbersDetection:"SIM card number identification",objectsToDetectSimCardNumbers:"Objects to identify SIM card numbers",allObjectsWithNoSimCardNumbers:"All objects with empty SIM card numbers",requestLiveTimeout:"Request lifetime",requestLiveTimeoutLabel:"Cancel request with no answer during:",detect:"Identify",simCardNumbersDetectionExplain:"To determine the SIM card numbers, the device will send the service SMS.<br/>\nThe received number will be saved to the object settings if it was not specified or incorrect.<br/>\nAll automatic changes will be reflected in the object log and events.",simCardNumbersDetectionConfirm:{msg:"<p>To identify number the SIM card in the device must have SMS messaging service enabled and enough funds.</p><p>SMS waiting time is <span class='nobr'>#ttl#.</span>Upon receiving SMS from the device the number identification procedure is complete with the appropriate entry in the log.</p>",hdr:"Identify SIM card numbers"},errors:{callServerFailed:"Failed to load data for a server",serverConnection:"Failed to set a connection.<br />To try again press Ok.",serverConnectionTimeout:"Timeout of a server response.<br />To try again press Ok.",localStorageUnavailable:"Saving of the application data at a browser is not available. The operation can not be continued.",iosPrivateMode:'If You use Apple device, ensure that the "Private access" mode is enabled.',canNotSave:"Failed to save data",noSelectedZones:"There are no zones selected. Please select at least one geofence in the tree",startOrEndTimeIsAbsent:"Start time and/or end time is not specified",startMoreTnanEndTime:"Start time value should be less than end time value",startMoreTnanNow:"Start time value should be less than current time value",invalidTimeEntered:"Invalid time is specified",invalidDateOrTimeEntered:"Invalid data and/or time is specified",addAtLeastOneGroup:"Add at least one group.",invalidIMEI:"Incorrect IMEI is specified.",invalidObjectName:"Enter object name",selectedDaysOutOfRange:"Selected weekdays are not part of the specified period",selectAtLeastOneObject:"Select at least one object or group",validateTimeToLive:"Lifetime must be higher or equal to {0} {1}",validateMaxValue:"Please enter a value less or equal to {0}",validateMinValue:"Please enter a value above or equal to {0}"},whichLabels:function(t){return 1==t?0:1
},time:"time",date:"date",period:"period",hours:"hours",minutes:"minutes",hoursLabels:["hour","hours"],hours24Labels:["day","days"],minutesLabels:["minute","minutes"],secondsLabels:["second","second"],week:"week",week1:"week",curWeek:"Current week",prevWeek:"Previous week",month:"month",timeAgo:"#t# ago",timeFormat:"Time format",DateTime:{longFormat:"d.m.Y H:i:s",shortFormat:"d.m H:i",timeFormat:"H:i:s",inputDateFormat:"dd.mm.yy",indexes:{y:0,o:1,w:2,d:3,h:4,m:5,s:6},labels:["year","month","week","day","hour","minute","second","day"],labels0:["year","month","week","day","hour","minute","second","day"],labels1:["years","months","weeks","days","hours","minutes","seconds","days"],labels2:["years","months","weeks","days","hours","minutes","seconds","days"],labelsCompact:["yr","mo","w","d","h","min","s","d"],labelsCompact1:["yr","mo","w","d","h","min","s","d"],today:"Today",yesturday:"Yesterday",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fro","Sat"],firstDay:0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],prepareDateField:function(t){var e=t.split(".");return e[2]+"-"+e[1]+"-"+e[0]}},allDaysOfTheWeek:"All days of the week",speed:"speed",sec:"sec",km:"km",m:"m",kmh:"km/h",square:"square",perimeter:"perimeter",radius:"radius",course:"heading",altitude:"Altitude",ha:"ha",na:"na",noData:"no data",hour:"h.",minute:"min.",volt:"V",l:"l",l100km:"l/100km",l1h:"l/1h",ms2:"m/sec<sup>2</sup>",rpm:"rpm",dbm:"dBm",areYouSure:"Are you sure?",cancelChanges:"Cancel the changes?",allChangesCancel:"If you cancel them, all completed changes will be lost.",msgConnectionLost:"Connection is lost",msgReconnecting:"Reconnection with the server",exitFromSystem:"Exit the system",msgServerConnectionLost:"Connection with the server is lost or session is timed out. You need to authorise again.",msgConfirmAction:"Please confirm the action",msgRedirectToLoginPage:"You will be automatically redirected to the authorisation page",commonSearchError:"Failed to complete a search. Please try again later.",totalLabel:"Total",chooseFile:"Select a file",showDashboard:"Show dashboard",showDashboardInfo:"Click the logo to show the dashboard",pleaseSelectFile:"Specify the file please",errorFileSize:"File size should not excess #s#",listType:"List type",name:"Name",sort:"Filtering",sortByName:"By name",sortByObjectExtId:"By ID",groupBy:"Grouping",sortTypeAsc:"Ascending",sortTypeDesc:"Descending",emptyTreeMsg:"You do not have objects yet",successCommandSent:"The command is submitted to the server. It may take a few minutes to complete.",errorCommandSending:"Failed to submit the command.",commandSent:"The command is submitted",source:"Source",eventsForDeviceVideoArchiveRequesting:"Events for device video archive requesting",currentDevice:"Current device",RTSPCamera:"RTSP-camera",temperatureSensorChangeHistory:"Temperature sensor and change history",temperatureSensor1Wire:"Temperature sensor 1-Wire",temperatureRadioSensorBuiltIn:"Temperature radio sensor #n#, built-in",temperatureRadioSensorExternal:"Temperature radio sensor #n#, external",builtIn:"built-in",external:"external",audioPlTitle:"Audio playback is required for this site to work correctly",audioPlTitle2:"Due to an update to Google policy, audio must be enabled,",readMore:"read more",audioPlChrome1:"Click on the lock. If you are using an unsecured connection, click on the inscription 'Not secured'.",audioPlChrome2:"Click on the drop-down list next to 'Sound'.",audioPlChrome3:"Select Allow.",audioPlChrome4:"If there is no 'Sound' item, click on an empty space in that window and return to step 1.",audioPlFirefox1:"Click the play sign in the address bar.",audioPlFirefox2:"Click the drop-down list next to 'Auto Play' and select 'Allow Audio and Video'."},"ru-ru":!0,"it-it":!0}),define("_common/nls/ru-ru/common",{save:"Сохранить",apply:"Применить",saveAndClose:"Сохранить и закрыть",saveChanges:"Сохранить изменения","delete":"удалить",edit:"изменить",copy:"Копировать",yes:"Да",no:"Нет",description:"Описание",quantity:"Количество",totalQuantity:"Общее количество",quantityAsNumber:"Количество",totalNumber:"Общее количество",restore:"Восстановить",build:"построить",rebuild:"перестроить",params:"Параметры",hasBeenBuilt:"построен",hasBeenDownloaded:"загружен",connection:"соединение",coords:"координаты",coordinatesTime:"Время фиксации",place:"Место",lat:"Широта",lon:"Долгота",address:"адрес",addresses:"адреса",addressNotFound:"Адрес не найден",canNotFindCoordsByAddress:"Не удалось определить координаты по адресу.",specifyAddress:"Введите адрес",distanceToAddress:"Расстояние до адреса",objectAddress:"Адрес объекта",country:"Страна",region:"Район",city:"Нас. пункт",street:"Улица",house:"Дом",building:"Корпус",phone:"телефон",phones:"телефоны",comments:"комментарий",info:"информация",service:"Сервис",note:"Примечание",row:"ряд",or:"или",and:"и",add:"добавить",change:"сменить",choose:"выбрать","new":"новый",next:"следующий",prev:"предыдущий",current:"текущий",nextShort:"след.",prevShort:"пред.",another:"другой",nearest:"ближайший",all:"все",online:"Онлайн",filteredOnly:"Фильтр",print:"Печать",pleaseWait:"Пожалуйста, подождите",fromDate:"с",from:"из",rangeFrom:"от",to:"до",upto:"до",till:"до",attention:"Внимание",attentionExclaim:"Внимание!",defaultDialogHeader:"Сообщение",hide:"Скрыть",hideAll:"Скрыть все",show:"показать",showAll:"Показать все",switchState:"Статус",switchedOn:"Включен",switchedOnShort:"Вкл.",switchedOff:"Отключен",switchedOffShort:"Откл.",switchOn:"Включить",switchOff:"Отключить",selectAll:"Выбрать все",notSelected:"Не выбран",notEntered:"Не указан",confirmation:"Подтверждение",cancel:"Отмена",submit:"Подтвердить","continue":"Продолжить",done:"Готово",toDate:"до",dataForDate:"Данные на",name:"имя",vehicleType:"Тип ТС",color:"цвет",changeColor:"Изменить цвет",power:"питание",powerOn:"Основное",powerOff:"Резервное",powerReserve:"Резервное питание",powerMain:"Основное питание",hardware:"Оборудование",objImage:"Картинка",changeImage:"Сменить картинку",chooseImage:"Выбрать картинку",chooseObjectImage:"Выберите картинку объекта",objServing:"Обслуживание",objServed:"Обслуживается",objNotServed:"Не обслуживается",user:"пользователь",userid:"ID пользователя",username:"имя пользователя",login:"логин",password:"пароль",demo:"Демо",accountRightsAreLimited:"Права вашей учетной записи ограничены.",simCard:"SIM-карта",GSMConnection:"Соединение",GlonassGPS:"ГЛОНАСС/GPS",settings:"настройки",device:"Прибор",object:"объект",objects:"объекты",objectsLabels:["объект","объекта","объектов"],objectsLabels1:["объекте","объектах","объектах"],byObject:"по объекту",bySelectedObjects:"по выбранным объектам",byNSelectedObjects:"по #n# #type#",selectedObjects:"Выбрано объектов",selectedObjectsOnly:"Выбранные объекты",nObjectsSelected:["Выбран #n# объект","Выбрано #n# объекта","Выбрано #n# объектов"],allObjects:"Все объекты",searchingObjectsAndGroups:"Поиск объектов и групп",noWatchedObjectsMsg:"Не выбрано ни одного объекта",noWatchedVehiclesMsg:"Не выбрано ни одного мобильного объекта.",noWatchedStationaryMsg:"Не выбрано ни одного стационарного объекта.",openObjectCard:"Открыть карточку объекта",objectCardLoadingFailed:"Не удалось открыть карточку объекта",showExtentedInfo:"Показать расширенную информацию",showShortedInfo:"Показать краткую информацию",vehicles:"Мобильные объекты",vehiclesLabels:["мобильный объект","мобильных объекта","мобильных объектов"],byVehiclesLabels:["мобильному объекту","мобильным объектам"],forVehicles:"для мобильных объектов",forVehiclesOnly:"Только для мобильных",stationary:"Стационарные объекты",stationaryLabels:["стационарный объект","стационарных объекта","стационарных объектов"],byStationaryLabels:["стационарному объекту","стационарным объектам"],forStationary:"для стационарных объектов",forStationaryOnly:"Только для стационарных",objectTitleType:"Обозначение",objProps:"Свойства объекта",objState:"Состояние объекта",objStatus:"Статус",objStatuses:{1:"Обслуживается",0:"Не обслуживается",2:"Сервис",4:"Контроль"},objName:"Имя объекта",objTitle:"Наименование объекта",objIdNumber:"ID-номер объекта",objIdNumberShort:"ID-номер",objModel:"Марка/модель",licenseNumber:"Гос. номер",objYear:"Год выпуска",objVin:"VIN-номер",objGroup:"Группа объекта",emptyObjGroupAddWarning:"Группа #name# не может быть добавлена, потому что не содержит объектов",objServerPassword:"Пароль на подключение к серверу",objOwner:"Владелец",objOwnerPass:"Ключ/Пароль",objContract:"Номер договора",objContractDate:"Дата договора",objHardwareType:"Тип прибора",objHardwareUnknown:"Не определен",objExtraHardware:"Дополнительное оборудование",objEquipmentIds:"Идентификаторы",objPhoto:"Фото объекта",objTrackReading:"Чтение трека",noPictures:"Пока нет ни одного изображения",addPicture:"Добавить изображение",deletePicture:"Удалить изображение",enterComment:"Введите комментарий",upload:"Загрузить",uploadFailed:"Не удалось загрузить файл.",confirmDeletePicture:"Уверены что хотите удалить изображение?",pictureHadBeenDeleted:"Изображение было удалено",noCaption:"Без заголовка",addObject:"Добавить объект",addChildGroup:"Добавить подгруппу",errAddGroupBefore:"Чтобы добавить объект, создайте хотя&nbsp;бы одну&nbsp;группу.",setupDevice:"Настроить прибор",errSetupLoad:"Не удается открыть окно настройки из-за ошибки сервера.",firmwareUpdate:"Обновление",firmwareHasUpdate:"Есть обновление",firmwareHasNoUpdate:"Нет обновления",firmwareUpdateStart:"Обновить версию",firmwareStopUpdate:"Отменить обновление",firmwareChangesHeader:"Перечень изменений при обновлении",firmwareUpdateCommandSent:"Команда отправлена.",firmwareUpdateConfirm:{msg:"<p>Запуская обновление Вы руководствуетесь условиями <a target='_blank' href='http://www.ritm.ru/agreement/'>Пользовательского&nbsp;соглашения</a>, подтверждаете, что&nbsp;ознакомлены с&nbsp;новым перечнем&nbsp;функций,и&nbsp;особенностями применения новой&nbsp;версии, и&nbsp;Вас&nbsp;устраивают данные изменения.</p><p>Загрузка&nbsp;обновления происходит в&nbsp;фоновом&nbsp;режиме и&nbsp;не&nbsp;препятствует работе&nbsp;прибора. При&nbsp;применении новой загруженной&nbsp;версии - прибор будет&nbsp;недоступен несколько&nbsp;минут.</p>",hdr:"Подтверждение обновления"},firmwareStopUpdateConfirm:{msg:"Выполнить&nbsp;обновление можно&nbsp;позже.",hdr:"Отменить обновление прибора?"},shellWsWarning:'Для работы программ настройки, необходимо изменить системные и сетевые настройки сервиса GeoRitm в&nbsp;соответствии с&nbsp;<a href="http://www.ritm.ru/documentation/manuals/GEO.RITM/GEO.RITM_DeviceJS_Manual.php" target="_blank">инструкцией</a>. Для изменения настроек обратитесь к&nbsp;администратору вашего сервиса GeoRitm.',swfShellUsageWarning:'В связи с прекращением поддержки технологии Adobe&nbsp;Flash в&nbsp;браузерах, для&nbsp;работы новых версий программ настройки, необходимо изменить системные и&nbsp;сетевые настройки сервиса GeoRitm в&nbsp;соответствии с&nbsp;<a href="http://www.ritm.ru/documentation/manuals/GEO.RITM/GEO.RITM_DeviceJS_Manual.php" target="_blank">инструкцией</a>. Для изменения настроек обратитесь к&nbsp;администратору вашего сервиса GeoRitm.',find:"найти",sortBy:"Сортировать по:",search:"Поиск",searchResultLable:"Найдено",searchNoResults:"Ничего не найдено",tableNoRecords:"Нет ни одной записи",searchObjects:"Поиск объектов",searchZones:"Поиск геозон",nothingFoundByYourRequest:"По Вашему запросу ничего не найдено",findClosestObjects:"Поиск ближайших объектов",inRadius:"в радиусе",anotherRadius:"Другой радиус",noObjectsFound:"Не найдено ни одного объекта",report:"Отчёт",reports:"Отчёты",reportParams:"Параметры отчёта",buildReport:"Построить отчёт",reportBuildingHasStarted:"Начато построение отчёта",reportBuildingInProgress:"Идёт построение отчёта.",errorReportBuilding:"Не удалось построить отчёт.",errorReportBuildingStillInProgress:"Пожалуйста, подождите окончания построения отчета.",downloadReport:"Скачать отчёт",reportDownloadingInProgress:"Идёт загрузка отчёта.",errorReportAlreadyDownloaded:"Отчёт уже был загружен.",errorReportDownload:"Не удалось загрузить отчёт.",buildReportByGroup:"Построить отчёт по группе",geozone:"геозона",geozones:"геозоны",pois:"Метки",showPoiNamesOnMap:"Показывать имена меток на карте",traffic:"Пробки",error:"Ошибка",commonSuccessHeader:"Все в порядке",group:"Группа",groups:"Группы",addGroup:"Добавить группу",renameGroup:"Переименовать группу",enterGroupName:"Введите имя группы",distance:"Расстояние",maxDistance:"Максимальное расстояние",runDistance:"Пробег",close:"закрыть",clear:"очистить",reload:"перезагрузить",clearMap:"Очистить карту",printMap:"Печать карты",autozoom:"Автомасштабирование",zoomIn:"Приблизить",zoomOut:"Отдалить",mapPanUp:"Вверх",mapPanDown:"Вниз",mapPanLeft:"Влево",mapPanRight:"Вправо",mapRuler:"Линейка",mapName:"Карта #name#",map:"карта",showOnMap:"Показать на карте",showOnYandexMap:"Открыть в Яндекс-картах",showOnGoogleMap:"Открыть в Google-картах",satMapName:"Спутник #name#",hybridMapName:"Гибрид #name#",landMapName:"Рельеф #name#",transMapName:"Транспорт #name#",wikiMapName:"Народная #name#",specialMapName:"Дополнительная карта",removeFromMap:"Убрать с карты",zoomToObject:"Приблизить к объекту",copyLinkToObject:"Копировать ссылку на объект",linkToObjectIsCopied:"Ссылка на&nbsp;объект скопирована в&nbsp;буфер",routeBuilding:"Построение маршрута",routeHere:"Маршрут сюда",buildRoute:"Проложить маршрут",routeNoTrafficAlert:"Маршрут построен без учета пробок",errCanNotBuildRoute:"Не удалось проложить маршрут.",errNoRoutingOnMap:"На выбранной карте прокладка маршрута невозможна.",andMore:"и еще #q# #l#",logout:"выйти",chart:"график",showChart:"Показать график",hideChart:"Скрыть график",buildChart:"Построить график",noChartData:"Нет данных для графика",noDataForChartsByParameters:"Нет данных для графиков по выбранным параметрам",deviceInput:"Вход",deviceOut:"Выход",deviceOuts:"Выходы",errorChangeOutput:"Не удалось изменить состояние выхода.",noDeviceOuts:"Пока не добавлено ни одного выхода",addDeviceOut:"Добавить выход",deviceOutNumShort:"№ Выхода",deviceOutName:"Наименование выхода",deviceOutTypeOpenCollector:"ОК",deviceOutTypeRelay:"Реле",deviceOutTypeRadioRelay:"Радиореле",deviceOutTypeAddressRelay:"Адресное реле",deviceOutType1Wire:"Выход 1-Wire",deviceOutControlManual:"ручное управление",deviceOutControlAuto:"автоматическое управление",deviceControlOutsAllAdded:"Все доступные выходы уже добавлены",deviceControlOutsNoAvailable:"Нет ни одного доступного выхода",errorInvalidDeviceOuts:"Указаны недопустимые параметры выходов",errorInvalidParams:"Указаны недопустимые параметры",fuel:"топливо",fuelVolume:"Уровень топлива",voltage:"Напряжение",temperature:"Температура",showLbs:"Показать LBS",updateLbs:"Обновить LBS",hideLbs:"Скрыть LBS",errorLbsSearch:"Не удалось загрузить данные о положении LBS<br />(параметры: #p#)",setDefaults:"установить по умолчанию",switchOffAll:"отключить все",recommended:"рекомендуется",notRecommended:"не рекомендуется",editHistory:"История изменений",settingsField:"Поле",settingOldValue:"Было",settingNewValue:"Стало",optionalTimeSettings:"Дополнительные настройки времени",hideOptionalTimeSettings:"Скрыть дополнительные настройки времени",dataOnlyInsideRange:"Данные только в интервале времени",reportsNames:{run:"Отчёт по пробегу",runShort:"Отчёт по пробегу (краткий)",movepark:"Отчёт по движению-стоянкам",speeding:"Отчёт по превышению скорости",speeding2b:"Отчёт по превышению скорости (2 порога)",acceleration:"Отчёт по агрессивности вождения",flow:"Отчёт по расходу топлива",fuelsum:"Сводный отчет по уровню топлива",fuel:"Отчёт по уровню топлива",fuel2:"Отчёт по уровню топлива (Форма 2)",device:"Отчёт по механизмам",device2:"Отчёт по работе объектов",can:"Отчёт по работе объектов (CAN)",zoneviz:"Отчёт по посещению геозон",zoneex:"Отчёт по выходам из геозон",zonevizcount:"Отчёт по количеству посещений геозон",pass:"Отчёт по пассажиропотоку (общий счетчик)",passmatrix:"Отчёт по пассажиропотоку",lostfix:"Отчёт по потере фиксации",objst:"Отчёт по состоянию объектов",alertssummary:"Сводный отчёт по событиям и тревогам",alerts:"События и тревоги по объекту",alertjournal:"Отчет по выбранным событиям и комментариям",temperature:"Отчёт по нарушению температурных режимов",objtemp:"Отчёт по температуре",voltage:"Отчёт по напряжению",engspeed:"Отчёт по оборотам двигателя",discretes:"Отчёт по дискретным параметрам",distance:"Отчёт по расстоянию до объектов",guardscallcount:"Отчёт по количеству выездов ГБР на объекты",drivesafety:"Отчёт по безопасности вождения",drivesafetysum:"Сводный отчёт по безопасности вождения",objjournal:"Журнал по объекту",objservice:"Отчёт по времени обслуживания объекта",timeseries:"График по выбранным параметрам",accesscard:"Отчет по использованию карт доступа"},useFormattedTimeseriesData:"Использовать обработанные данные",alertsSummaryReport:{general:"Общее количество событий и тревог",groups:"Количество событий по группам",alerts:"Количество событий по наименованиям",channels:"Количество событий по каналам связи",connect:"Количество подключений",loss:"Количество событий потери связи","220v":"Количество пропаданий 220В",power:"Количество проблем с батареями питания"},reportGroupNames:{tech:"Технические",history:"События и тревоги",location:"Местоположение и пробег",safety:"Безопасность движения",fuel:"Контроль топлива",sensors:"Контроль работы",geozones:"Контроль посещения геозон",special:"Специальные"},track:"трек",tracks:"треки",clearTracksList:"Очистить список",showTrackPoints:"Показывать точки треков",colorTracks:"Раскрашивать треки в зависимости от скорости",tracksCountText:"Построено #n#",showTrack:"Показать трек",hideTrack:"Скрыть трек",zoomToTrack:"Масштабировать по треку",removeTrack:"Удалить трек",removeEmptyTracks:"Удалить пустые треки",showHideTrack:"Показать/Скрыть",buildTrack:"Построить трек",buildTrackByGroup:"Построить трек по группе",pleaseBuildOneTrack:"Пожалуйста, постройте хотя бы один трек",severalTracksShownLeaveOneForZone:"На карте показано несколько треков. Пожалуйста, оставьте только один, чтобы построить геозону",tooManyObjectsForTracks:"Выбрано много объектов. Одновременное построение треков возможно не более чем по #max# объектам",trackPlayer:"Проигрыватель трека",trackPlaySpeed:"Скорость проигравания",msgCanNotBuildTracks:"Не удалось построить треки в связи с ошибкой сервера. Пожалуйста попробуйте позже.",speedLessThan:"Скорость менее",speedFrom:"Скорость от",speedGreaterThan:"Скорость более",saveAsPlt:"Сохранить в файл (.plt)",saveToFile:"Сохранить в файл",loadFromFile:"Загрузить из файла",saveObjectCardToFile:"Сохранение карточки объекта в файл",parks:"Остановки",parkBegin:"начало",parkEnd:"окончание",parkTime:"время остановки",discret:"дискретный",discretSensor:"Датчик",discretSensors:"Дискретные датчики",discretParam:"Параметр",analogue:"аналоговый",analogueSensor:"Датчик",sensorValue:"Показания датчика",tiltSensor:"Датчик наклона",dataSource:"Источник данных",calculatedValue:"Расчетное значение",noDataForDay:"Нет данных за этот день",noDataForPeriod:"Нет данных за этот период",noDataForObject:"По этому объекту нет данных",dateInstall:"Дата установки",placeInstall:"Место установки",installer:"Установщик",imeiChangeConfirm:{msg:"Удаление или изменение IMEI-кода в свойствах объекта приведет к отключению от системы действующего прибора.",hdr:"Изменить IMEI?"},additionalInfo:"Дополнительная информация",currentState:"Состояние",turnOff:"Отключить",turnOn:"Включить",auto:"авто",autoMode:'Режим "Авто"',history:"История",alarm:"тревога",withAlarm:"с тревогой",alarms:"тревоги",objWithAlarms:"с тревогами",totalAlarms:"Всего тревог",totalAlarmsShort:"Тревог",alarmsShort:"Трев.",commentAlarmResolved:"Тревога сброшена",commentAllAlarmsOnObjResolved:"Все тревоги на объекте сброшены",commentAllAlarmsResolved:"Все тревоги сброшены",alert:"событие",alerts:"события",alertEvent:"Событие",totalAlertsShort:"Событий",objectAlertsAndLog:"События и журнал",alertsLog:"Лента событий",turnOnAlertsLog:"Включить ленту событий",alertsLogDepth:"Максимальное количество записей",alertsLogFilters:"Фильтры",inputStream:"Входящий поток",allInputStreams:"Все входящие потоки",anyInputStream:"Любой входящий поток",stopAlertsLog:"Остановить",resumeAlertsLog:"Возобновить",objArea:"Раздел",objAreas:"Разделы",objAreasLabels:["раздел","раздела","разделов"],allObjAreas:"Все разделы",chooseObjAreas:"Выберите разделы",objAreaNum:"№ раздела",objAreaName:"Наименование раздела",objAreaNoName:"Без названия",zeroAreaName:"Система",objAreaComment:"Примечание",areaDoesNotExist:"Раздел не существует",rolesForAreas:"Роли пользователей с правом управления разделом",rolesForAreasAll:"Все роли с правом управления разделами",haveNoPermissionToControlArea:"У вас нет прав на управление этим разделом",alarmAreas:"Разделы в тревоге",notAlarmAreas:"Разделы без тревог",faultAreas:"Разделы с неисправностями",faultAreasShort:"С неисправностями",notFaultAreas:"Исправные разделы",guardedAreas:"Разделы под охраной",notGuardedAreas:"Разделы снятые с охраны",objAreaStateNorm:"Норма",objAreasStateLoading:"Идет загрузка состояния разделов",objZone:"Зона",objZones:"Зоны",objZoneKey:"Зона/Ключ",objZoneKeyName:"Наименование зоны/ключа",objInputZoneKey:"Вход/Зона/Ключ",chooseObjZones:"Выберите зоны",allZonesOfSelectedAreas:"Все зоны выбранных разделов",objZoneStateNorm:"Норма",objZoneStateViolated:"Нарушение",withAlarms:"В тревоге",alarmWindowHeader:"Есть необработанные тревоги на #n# #t#",alarmWindowHeaderNoAlarms:"Необработанных тревог нет",turnOffSound:"Выключить звук",turnOnSound:"Включить звук",chooseAction:"Выбрать действие",addComment:"Добавить комментарий",resolveAlarm:"Сбросить тревогу",noAlarms:"Нет тревог",guarded:"Под охраной",guardedPartly:"Частично под охраной",makeGuarded:"Взять под охрану",notGuarded:"Снят с охраны",notGuardedMulti:"Сняты с охраны",makeNotGuarded:"Снять с охраны",hasFault:"Неисправность",noFault:"Исправен",viewAndResolveFaults:"Просмотр и сброс неисправностей",viewFaults:"Просмотр неисправностей",faultsList:"Список неисправностей",resolveAllFaults:"Сбросить все",resolveFault:"Сбросить",resolveFaultConfirm:"Сбросить неисправность?",resolveAllFaultsConfirm:"Сбросить все неисправности и закрыть список?",noFaultsOnObject:"На объекте нет неисправностей.",systemFaultOrAlarm:"Системная",alertsParameters:"Параметры событий",alertCode:"Код события",alertMessage:"Наименование события",alertOrCommentMessage:"Cобытие (действие, комментарий)",alertsGroup:"Группа событий",alertsGroups:"Группы событий",allAlertsGroups:"Все группы событий",chooseAlertsGroups:"Выберите группы событий",totalAlerts:"Всего событий",allAlerts:"Все события",allAlertsOnObject:"Все события по объекту",allAlertsOffSelectedGroups:"Все события выбранных групп",chooseAlert:"Выберите событие",chooseAlerts:"Выберите события",chooseZones:"Выбор геозоны для поиска нарушений",timeOfCreation:"Время формирования",timeOfReceive:"Время получения",key:"ключ",gsmProvider:"Оператор",streamChannel:"Канал связи",streamChannels:"Каналы связи",actionsAndComments:"Действия и комментарии",allActionsAndComments:"Все действия и комментарии",otherComments:"Другое",alertsControl:"Контроль",alertControlCopy:"Копировать параметры контроля",alertControlCopyFormLabel:"Выберите объект или группу объектов, куда нужно скопировать параметры контроля",alertControlCopyConfirm:"<p>Копировать параметры контроля этого объекта в&nbsp;выбранные&nbsp;объекты?</p>",alertControlExtraSettings:"Дополнительные параметры",alertControlConnection:"Контроль связи с объектом",alertControlConnectionTip:"Формировать тревогу при отсутствии соединения в течение указанного времени, чч:мм",alertControlAutotest:"Контроль автотеста",alertControlAutotestTip:"Формировать тревогу при отсутствии автотеста в течение указанного времени, чч:мм",alertControlSaveAutotestsLabel:"Хранить и использовать события автотестов в системе после обработки алгоритмом контроля",alertControlActivity:"Контроль активности",alertControlActivityTip:"Формировать тревогу при отсутствии событий от прибора в течение указанного времени, чч:мм",alertControlVoltage:"Контроль восстановления 220В",alertControlVoltageTip:"Формировать тревогу при отсутствии восстановления 220В в течение указанного времени, чч:мм",alertControlEnterDelay:"Контроль входной задержки",alertControlEnterDelayTip:"Входная задержка формирования тревоги по зоне, сек.",alertControlReceivedAlerts:"Принятые тревоги по зоне",alertControlExpectedAlerts:"Ожидаемые события восстановления",alertControlEnterDelayZonesLabel:"Контролируемые зоны",alertControlPanicButton:"Контроль восстановления кнопки тревоги",alertControlPanicButtonTip:"Задержка формирования тревоги, сек.",alertControlMovement:"Контроль простоя",alertControlMovementTip:"Формировать тревогу при отсутствии движения в течении указанного времени, чч:мм",alertControlMovementIgnore:"Игнорировать простой в геозонах",alertControlLostCoord:"Контроль потери координат",alertControlLostCoordTip:"Формировать тревогу при отсутствии координат в течении указанного времени, чч:мм",alertControlLostCoordIgnore:"Игнорировать потерю координат",streamChannelsControl:"Контроль канала связи",alertControlChannelsTip:"Формировать тревогу при отсутствии сигнала контроля в течение указанного времени, чч:мм",alertControlControlledAlerts:"Контрольные события",selectStreamChannels:"Выберите каналы связи",createAlert:"Сформировать событие",alertsListControl:"Контроль списка событий",alertsListControlTip:"Формировать тревогу при отсутствии списка событий в течение указанного времени, чч:мм",alertsListReceivedAlert:"Принятое событие",alertsListExpectedAlerts:"Список ожидаемых событий",alertsListCondition:"Условия формирования события",alertsListConditionFalse:"Приняты не все ожидаемые события из списка",alertsListConditionTrue:"Приняты все ожидаемые события из списка",objectStateScan:"Опрос состояния",stateScanProcessing:"Идет опрос состояния",deviceAreaStates:{1:"охранная тревога",2:"возможность пожара",4:"пожар",8:"неисправность",16:"задержка на вход",32:"задержка на выход"},deviceZoneStates:{1:"нарушение охранной зоны",2:"возможность пожара",4:"пожар",8:"неисправность",16:"задержка на вход",64:"обход",128:"разряд батареи",256:"короткое замыкание",512:"обрыв",1024:"нет связи",2048:"тамперный контакт",4096:"нарушение основной зоны радиоизвещателя",8192:"нарушение дополнительной зоны радиоизвещателя"},objectStateScanResult:"Результат опроса состояния прибора",objectStateScanIdNotFound:"Не найден идентификатор вызова",objectStateScanFailed:"Опрос завершился ошибкой",objectStateInvalidImei:"По указанному номеру SIM-карты отвечает прибор с другим IMEI (#imei#)",noAreasData:"Нет данных по разделам",rrTeam:"Группа быстрого реагирования",rrTeamShort:"ГБР",rrTeams:"Группы быстрого реагирования",loadingRRTGroupsList:"Загрузка списка групп ГБР",allRRT:"Все ГБР",addRRT:"Добавить ГБР",addRRTGroup:"Добавить группу объектов ГБР",noRRT:"Нет ни одной ГБР",noRRTGroups:"Нет ни одной группы объектов ГБР",selectedRRTGroups:"Выбранные группы объектов",deleteRRTGroupConfirmMsg:"Удалить группу объектов из списка ГБР?",searchRRT:"Поиск ГБР",repeatSearch:"Повторить поиск",rrtCall:"Вызов",rrtNoCall:"Нет вызова",rrtCalled:"Отправлен вызов ГБР",rrtCallTime:"Время вызова",rrtArriveTime:"Время прибытия",rrtCallAccepted:"Вызов принят",rrtCallNotAccepted:"Вызов не принят",rrtCancelCall:"Отмена вызова ГБР",rrtCancelCallShort:"Отменить вызов",rrtCompleteCall:"Завершение вызова ГБР",rrtCompleteCallShort:"Завершить вызов",rrtPerson:"Ответственный",rrtLocation:"Расположение",noRRTboundToObject:"Нет закрепленных за объектом ГБР",rrtSelectManually:"Выбрать вручную",responsible:{header:"Ответственные",pass1:"Пароль для идентификации",pass2:"Пароль под принуждением",persons:{key:"№ ключа",name:"ФИО ответственного лица",phone1:"Телефон 1",phone2:"Телефон 2",comment:"Примечание",addNew:"Добавить ответственного",noData:"Ответственные не указаны"},copyList:"Копировать список ответственных",copyResponsibleFormLabel:"Выберите объект или группу объектов, куда нужно скопировать список ответственных",copyConfirm:"<p>Копировать текущий&nbsp;сохраненный список&nbsp;ответственных этого&nbsp;объекта в&nbsp;выбранные&nbsp;объекты?</p><p><strong>Внимание!</strong> Список ответственных в&nbsp;выбранных&nbsp;объектах будет&nbsp;замещен.</p>"},notification:"Оповещение",notifications:"Оповещения",newNotification:"Новое оповещение",addNotification:"Добавить оповещение",notificationName:"Имя оповещения",notificationSwitchedOn:"Включено",notificationSwitchedOff:"Отключено",noNetwork:"Нет сети",notificationLimitReached:"Достигнуто максимально допустимое количество оповещений.",notificationAddressesHelp:"Адреса следует вводить через запятую или каждый с новой строки.",notificationPhonesHelp:"Номера телефонов могут содержать только цифры, длина каждого номера от 9 до 15 символов, включая код страны.",errNotificationName:"Введите имя оповещения.",errNotificationAddresses:"Введите как минимум один адрес.",errNotificationAddressesIncorrect:"Один или несколько введенных адресов некорректны.",errNotificationMaxAddresses:"Разрешено добавить максимум #max# адресов.",errNotificationAlerts:"Выберите хотя бы одну группу событий или одно событие ContactID.",errNotificationAreas:"Выберите хотя бы один раздел.",notificationDeleteConfirm:{msg:"Вы точно хотите удалить оповещение #name#?",hdr:"Удалить оповещение?"},video:"Видео",videoOnline:"Онлайн",videoArchive:"Архив",camera:"Камера",connect:"Подключиться",cameraOnObject:"Видео с объекта #title#",noCamerasAdded:"Не добавлено ни одной камеры",cameraNotSelected:"Не выбрана",addCamera:"Добавить камеру",videoCamera:"Видеокамера",cameraNumber:"№ видеокамеры",cameraName:"Наименование видеокамеры",cameraNameIvideon:"Имя камеры на Ivideon",errCamerasListLoad:"Не удалось загрузить список камер, проверьте правильность логина и пароля от аккаунта на&nbsp;Ivideon.",errCamerasListEmpty:"К Вашему аккаунту на&nbsp;Ivideon не привязано ни одной камеры.",errCameraNotAvailable:"Ранее привязанная камера не доступна.",errCameraNotOnlineOrNotPaid:"Не удается установить подключение к видеокамере.",errCameraPreview:"Не удалось загрузить изображение.",showCamera:"Показать видео",showCameras:"Показать камеры",showVideo:"Показать видео",ivideonInfo:"<p>GeoRitm обеспечивает трансляцию изображения с&nbsp;видеокамер, подключенных к&nbsp;облачному сервису iVideon.</p><p>Укажите в&nbsp;карточке&nbsp;объекта логин&nbsp;и&nbsp;пароль для&nbsp;подключения к&nbsp;сервису&nbsp;iVideon и&nbsp;выберите видеокамеру, изображение&nbsp;которой будет&nbsp;доступно в&nbsp;свойствах этого&nbsp;объекта</p>.",useDirectVideo:"Использовать прямое подключение",deviceIp:"IP прибора",deviceCameraPort:"Порты камер (через запятую)",rtspStreamUrl:"URL RTSP-потока",videoLoadingArchive:"Загрузка архива...",errVideoArchiveLoading:"Не удалось загрузить данные об архивных записях.",errVideoStreamNotFound:"Не удалось установить соединение.",errVideoUnknownError:"Неизвестная ошибка",errVideoPlayerLibUnavailable:"Плеер недоступен",errVideoNoImei:"У объекта отсутствует&nbsp;IMEI, подключение&nbsp;невозможно.",errVideoNoCameras:"У объекта отсутствует список камер, подключение&nbsp;невозможно.",errVideoDeviceOffline:"Нет связи для&nbsp;получения&nbsp;видео, подключение&nbsp;невозможно.",errVideoConnection:"Не удалось установить соединение.",errNoRtspVideoInIe:"Просмотр видео с RTSP видеокамер будет недоступен в браузере Internet Explorer.",errVideoCameraIsStarting:"Включение онлайн видео, пожалуйста подождите.",videoFilesWillBeTransmitted:"Загрузка видеоархива, пожалуйста подождите.",videoFilesAreBeingTransmitted:"Загрузка видеоархива, пожалуйста подождите.",videoFilesTransmissionHasFailed:"Не удалось загрузить видеоархив.",errVideoCommandSendingFail:"Не удалось отправить команду прибору.",errVideoObjectIsOffline:"Объект не на связи. Воспроизведение онлайн-видео недоступно.",errVideoIdpConnectionFailed:"Не удалось установить соединение с сервером для передачи команды.",errSignalServerUnavailable:"Ошибка подключения к&nbsp;сигнальному&nbsp;серверу.",errNoIceServers:"Отсутствуют ICE сервера.",addTemperatureSensor:"Добавить датчик температуры",temperatureSensor:"Датчик температуры",numberZoneSensor:"№ зоны датчика",nameSensor:"Наименование датчика",noSensorsAdded:"Не добавлено ни одного датчика",lname:"Фамилия",mname:"Отчество",namesOrder:["lname","fname","mname"],technician:"Техник",technicians:"Техники",technicianNoRecords:"Пока нет ни одного техника",technicianAdd:"Добавить техника",technicianCreate:"Новый техник",errEnterTechnicianName:"Введите имя",errEnterTechnicianLastName:"Введите фамилию",errEnterTechnicianNotSelected:"Выберите техника для перевода в сервис",technicianDeleteConfirm:{msg:"Вы точно хотите удалить техника?",hdr:"Удалить техника?"},technicianNotSelected:"Техник не выбран",technicianNotSet:"Техник не назначен.",setServiceStatusForPeriod:"Перевод в сервис на время",setServiceStatusPeriodLabel:"На #n# #l#",setServiceStatusNoLimit:"Бессрочно",setServiceStatusTillDate:"До указанной даты",serviceLeftTime:"осталось #t#",simCardNumbersDetection:"Определение номеров SIM-карт",objectsToDetectSimCardNumbers:"Объекты, для которых нужно определить номера SIM-карт",allObjectsWithNoSimCardNumbers:"Все объекты, у которых не заполнен ни один номер SIM-карты",requestLiveTimeout:"Время жизни запроса",requestLiveTimeoutLabel:"Отменять запрос при отсутствии ответа в течение:",detect:"Определить",simCardNumbersDetectionExplain:"Для определения номеров SIM-карт прибор отправит системе служебную SMS.<br/>\nПолученный номер будет записан в карточку объекта, если он не был указан или неверен.<br/>\nВсе автоматические изменения будут отражены в журнале объекта и событиях.",simCardNumbersDetectionConfirm:{msg:"<p>Для определения номера нужно, чтобы SIM-карта в приборе имела подключенную услугу отправки SMS и положительный баланс.</p><p>Ожидание SMS составляет <span class='nobr'>#ttl#.</span> При неполучении SMS от прибора процедура определения номера будет завершена с соответствующей отметкой в журнале.</p>",hdr:"Определить номера SIM-карт"},errors:{callServerFailed:"Не удалось получить данные с сервера",serverConnection:"Не удалось установить соединение.<br />Нажмите Ok, чтобы повторить попытку.",serverConnectionTimeout:"Истекло время ожидани ответа сервера.<br />Нажмите Ok, чтобы повторить попытку.",localStorageUnavailable:"В браузере недоступно сохранение данных приложения. Дальнейшая работа невозможна.",iosPrivateMode:'Если Вы используете устройство Apple, проверьте, что режим "Частного доступа" выключен.',canNotSave:"Не удалось сохранить данные",noSelectedZones:"Не выбрано ни одной геозоны. Пожалуйста, выберите хотя бы одну в дереве",startOrEndTimeIsAbsent:"Не указано время начала и/или время окончания",startMoreTnanEndTime:"Время начала должно быть меньше, чем время окончания",startMoreTnanNow:"Время начала должно быть меньше текущего времени",invalidTimeEntered:"Введено некорректное время",invalidDateOrTimeEntered:"Введены некорректные даты и/или время",addAtLeastOneGroup:"Добавьте хотя бы одну группу.",invalidIMEI:"Введен некорректный IMEI.",invalidObjectName:"Введите имя объекта.",selectedDaysOutOfRange:"Выбранные дни недели не входят в заданный период",selectAtLeastOneObject:"Выберите хотя бы один объект или группу",validateTimeToLive:"Время жизни должно быть не менее, чем {0} {1}",validateMaxValue:"Введите число меньшее или равное {0}",validateMinValue:"Введите число большее или равное {0}"},whichLabels:function(t){var e=t%10,i=Math.floor(t%100/10);
return 1==t?0:e>=2&&4>=e&&1!=i?1:1==e&&1!=i?0:2},time:"время",date:"дата",period:"период",hours:"часы",minutes:"минуты",hours24Labels:["сутки","суток","суток"],hoursLabels:["час","часа","часов"],minutesLabels:["минута","минуты","минут"],secondsLabels:["секунда","секунды","секунд"],week:"неделя",week1:"неделю",curWeek:"Текущая неделя",prevWeek:"Предыдущая неделя",month:"месяц",timeFormat:"Формат времени",timeAgo:"#t# назад",DateTime:{longFormat:"d.m.Y H:i:s",shortFormat:"d.m H:i",timeFormat:"H:i:s",inputDateFormat:"dd.mm.yy",labels:["год","месяц","неделя","день","час","минута","секунда","сутки"],labels0:["год","месяц","неделя","день","час","минута","секунда","сутки"],labels1:["года","месяца","недели","дня","часа","минуты","секунды","суток"],labels2:["лет","месяцев","недель","дней","часов","минут","секунд","суток"],labelsCompact:["г.","мес.","нед.","сут","ч","мин","с","сут"],labelsCompact1:["г","мес","нед","сут","час","мин","сек","сут"],today:"Сегодня",yesturday:"Вчера",dayNames:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],dayNamesShort:["Вос","Пон","Втр","Срд","Чтв","Птн","Сбт"],firstDay:1,monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"]},allDaysOfTheWeek:"Все дни недели",speed:"скорость",sec:"сек",km:"км",m:"м",kmh:"км/ч",square:"площадь",perimeter:"периметр",radius:"радиус",course:"курс",altitude:"Высота",ha:"га",na:"нд",noData:"нет данных",hour:"ч.",minute:"мин",volt:"В",l:"л",l100km:"л/100км",l1h:"л/1ч",ms2:"м/с<sup>2</sup>",rpm:"об/мин",dbm:"дБм",areYouSure:"Вы уверены?",cancelChanges:"Отменить изменения?",allChangesCancel:"В случае отмены все выполненные изменения будут потеряны.",msgConnectionLost:"Соединение потеряно",msgReconnecting:"Восстановление соединения с сервером",exitFromSystem:"Выйти из системы",msgServerConnectionLost:"Потеряно соединение с сервером или истекло время сессии. Необходима повторная авторизация.",msgConfirmAction:"Пожалуйста, подтвердите действие",msgRedirectToLoginPage:"Вы будете автоматически направлены на страницу авторизации",commonSearchError:"Не удалось осуществить поиск. Пожалуйста попробуйте еще раз чуть позже.",totalLabel:"Всего",chooseFile:"Выберите файл",showDashboard:"Сводная информация",showDashboardInfo:"Для показа сводной информации нажмите на логотип",pleaseSelectFile:"Пожалуйста укажите файл",errorFileSize:"Размер файла не должен превышать #s#",listType:"Вид списка",name:"Наименование",sort:"Сортировка",sortByName:"По наименованию",sortByObjectExtId:"По ID-номеру",groupBy:"Группировка",sortTypeAsc:"По возрастанию",sortTypeDesc:"По убыванию",emptyTreeMsg:"У Вас пока нет объектов",successCommandSent:"Команда отправлена на сервер. Ее выполнение может занять несколько минут.",errorCommandSending:"Не удалось отправить команду.",commandSent:"Команда отправлена",source:"Источник",eventsForDeviceVideoArchiveRequesting:"События для запроса видеоархива из прибора",currentDevice:"Этот прибор",RTSPCamera:"RTSP-камера",temperatureSensorChangeHistory:"Датчик температуры с историей изменения",temperatureSensor1Wire:"Датчик температуры 1-Wire",temperatureRadioSensorBuiltIn:"Радиодатчик температуры #n# встроенный",temperatureRadioSensorExternal:"Радиодатчик температуры #n# внешний",builtIn:"встроенный",external:"внешний",audioPlTitle:"Для корректной работы требуется включить воспроизведение звука для этого сайта",audioPlTitle2:"В связи с обновлением политики Google, требуется включить звук,",readMore:"подробнее",audioPlChrome1:'Нажмите на замок. Если используется незащищенное соединение, то нажмите на надпись "Не защищено".',audioPlChrome2:'Нажмите на выпадающий список напротив надписи "Звук".',audioPlChrome3:'Выберите "Разрешить".',audioPlChrome4:'Если пункт "Звук" отсутствует, то нажмите на свободное место в этом окне и вернитесь к пункту 1.',audioPlFirefox1:"Нажмите на знак воспроизведения в адресной строке.",audioPlFirefox2:'Нажмите на выпадающий список напротив надписи "Автовоспроизведение" и выберите "Разрешить аудио и видео".'}),define("util",["underscore","i18n!_common/nls/common"],function(t,e){function i(e,i,n){var s=function(){};s.prototype=i.prototype,e.prototype=new s,e.prototype.constructor=e,e.superclass=i.prototype;for(var n=t.union(["getInstance","getAncestors"],n||[]),o=n.length;o--;)i[n[o]]&&(e[n[o]]=i[n[o]]);i.__ancestors=i.__ancestors||[],i.__ancestors.push(e)}function n(e,i){t.each(i,function(t,n){!function(t){e[t]=function(){return i[t].apply(this,arguments)}}(n)})}function s(){this.reset()}function o(){var t=(new Date).getTime();return"performance"in window&&"function"==typeof window.performance.now&&(t+=window.performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=0|(t+16*Math.random())%16;return("x"===e?i:8|3&i).toString(16)})}function a(t){var e;if("SELECT"===t.nodeName)t.focus(),e=t.value;else if("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName){var i=t.hasAttribute("readonly");i||t.setAttribute("readonly",""),t.select(),t.setSelectionRange(0,t.value.length),i||t.removeAttribute("readonly"),e=t.value}else{t.hasAttribute("contenteditable")&&t.focus();var n=window.getSelection(),s=document.createRange();s.selectNodeContents(t),n.removeAllRanges(),n.addRange(s),e=n.toString()}return e}function r(t){var e,i=a(t);try{e=document.execCommand("copy"),console.log("Copied text is "+i)}catch(n){e=!1}return window.getSelection().removeAllRanges(),e}String.prototype.ucFirst||(String.prototype.ucFirst=function(){return this.charAt(0).toUpperCase()+this.substr(1)}),!Number.prototype.padLeft&&(Number.prototype.padLeft=function(t,e){var i=String(this),n=t-i.length+1;return 0>n?i:Array(n).join(e||"0")+i}),t.extend(Math,{PI2:2*Math.PI,D2R:.017453292519943295,R2D:57.29577951308232,_round:function(t,e){e=parseInt(e),0>e&&(e=0);var i=Math.pow(10,e);return Math.round(t*i)/i},atanh:function(t){return.5*Math.log((1+t)/(1-t))},getSquareDistance:function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n},getSquareSegmentDistance:function(t,e,i){var n,s=e.x,o=e.y,a=i.x-s,r=i.y-o;return(0!==a||0!==r)&&(n=((t.x-s)*a+(t.y-o)*r)/(a*a+r*r),n>1?(s=i.x,o=i.y):n>0&&(s+=a*n,o+=r*n)),a=t.x-s,r=t.y-o,a*a+r*r},simplifyRadialDistance:function(t,e){var i,n,s=t.length,o=t[0],a=[o];for(i=1;s>i;i++)n=t[i],Math.getSquareDistance(n,o)>e&&(a.push(n),o=n);return o!==n&&a.push(n),a},simplifyDouglasPeucker:function(t,e){var i,n,s,o,a=t.length,r=typeof Uint8Array!=void 0+""?Uint8Array:Array,l=new r(a),c=0,h=a-1,d=[],u=[],p=[];for(l[c]=l[h]=1;h;){for(n=0,i=c+1;h>i;i++)s=Math.getSquareSegmentDistance(t[i],t[c],t[h]),s>n&&(o=i,n=s);n>e&&(l[o]=1,d.push(c),u.push(o),d.push(o),u.push(h)),c=d.pop(),h=u.pop()}for(i=0;a>i;i++)l[i]&&p.push(t[i]);return p},findNearestPoint:function(t,e,i){for(var n=e.length,i=i||1/0,s=0,o=1/0,a=null;n--;)s=Math.sqrt(Math.getSquareDistance(t,e[n])),i>s&&o>s&&(a=n,o=s);return null===a?null:e[a]}}),t.extend(Date,{offsetToString:function(t){return 0==t?"+00:00":(t>0?"+":"-")+Math.floor(Math.abs(t)/60).padLeft(2)+":"+(Math.abs(t)%60).padLeft(2)},format:function(t,i){var n,s,o=this,a=e.DateTime.dayNames,r=e.DateTime.monthNames,l=/\\?(.?)/gi,c=function(t,e){return s[t]?s[t]():e},h=function(t,e){for(t=String(t);t.length<e;)t="0"+t;return t};return s={d:function(){return h(s.j(),2)},D:function(){return s.l().slice(0,3)},j:function(){return n.getDate()},l:function(){return a[s.w()]},N:function(){return s.w()||7},S:function(){var t=s.j(),e=t%10;return 3>=e&&1==parseInt(t%100/10,10)&&(e=0),["st","nd","rd"][e-1]||"th"},w:function(){return n.getDay()},z:function(){var t=new Date(s.Y(),s.n()-1,s.j()),e=new Date(s.Y(),0,1);return Math.round((t-e)/864e5)},W:function(){var t=new Date(s.Y(),s.n()-1,s.j()-s.N()+3),e=new Date(t.getFullYear(),0,4);return h(1+Math.round((t-e)/864e5/7),2)},F:function(){return r[s.n()]},m:function(){return h(s.n(),2)},M:function(){return s.F().slice(0,3)},n:function(){return n.getMonth()+1},t:function(){return new Date(s.Y(),s.n(),0).getDate()},L:function(){var t=s.Y();return 0===t%4&0!==t%100|0===t%400},Y:function(){return n.getFullYear()},y:function(){return s.Y().toString().slice(-2)},a:function(){return n.getHours()>11?"pm":"am"},A:function(){return s.a().toUpperCase()},g:function(){return s.G()%12||12},G:function(){return n.getHours()},h:function(){return h(s.g(),2)},H:function(){return h(s.G(),2)},i:function(){return h(n.getMinutes(),2)},s:function(){return h(n.getSeconds(),2)},Z:function(){return 60*-n.getTimezoneOffset()},r:function(){return"D, d M Y H:i:s O".replace(l,c)}},this.date=function(t,e){return o=this,n=void 0===e?new Date:e instanceof Date?new Date(e):new Date(e),t.replace(l,c)},this.date(t,i)},sqlFormat:function(t){return this.format("Y-m-d H:i:s",t)},formatSeconds:function(t,i,n){i=i!==!1,n=n||"hms";var s=e.DateTime,o=[],a="";if("hms"===n||"dhm"===n||"24hm"===n){var r=parseInt(t/86400),l=parseInt(t/3600)%24,c=parseInt(t/60)%60,h=Math.round(t%60);r>0&&(a=r+"&nbsp;"+s[i?"labelsCompact":"labels"+e.whichLabels(r)]["24hm"===n?7:3],o.push(a)),l>0&&(a=l+"&nbsp;"+s[i?"labelsCompact":"labels"+e.whichLabels(l)][4],o.push(a)),c>0&&(a=c+"&nbsp;"+s[i?"labelsCompact":"labels"+e.whichLabels(c)][5],o.push(a)),"hms"===n&&(a=h?h+"&nbsp;"+s[i?"labelsCompact":"labels"+e.whichLabels(h)][6]:0==o.join("").length?"0 "+s[i?"labelsCompact":"labels"+e.whichLabels(h)][6]:"",o.push(a))}else if("m"===n){var c=Math.round(100*(t/60))/100;a=c?c+"&nbsp;"+s[i?"labelsCompact":"labels"+e.whichLabels(c)][5]:"",o.push(a)}return o.join(" ")}}),Array.prototype.findIndex||(Array.prototype.findIndex=function(t){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,i=Object(this),n=i.length>>>0,s=arguments[1],o=0;n>o;o++)if(e=i[o],t.call(s,e,o,i))return o;return-1}),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert first argument to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(void 0!==n&&null!==n){n=Object(n);for(var s=Object.keys(Object(n)),o=0,a=s.length;a>o;o++){var r=s[o],l=Object.getOwnPropertyDescriptor(n,r);void 0!==l&&l.enumerable&&(e[r]=n[r])}}}return e}});var l={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",encode:function(t){if("undefined"!=typeof btoa)return btoa(unescape(encodeURIComponent(t)));for(var e,i,n,s,o,a,r,l="",c=0;c<t.length;)e=t.charCodeAt(c++),i=t.charCodeAt(c++),n=t.charCodeAt(c++),s=e>>2,o=(3&e)<<4|i>>4,a=(15&i)<<2|n>>6,r=63&n,isNaN(i)?a=r=64:isNaN(n)&&(r=64),l=l+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(a)+this._keyStr.charAt(r);return l},decode:function(t){if("undefined"!=typeof atob)return decodeURIComponent(escape(atob(t)));var e,i,n,s,o,a,r,l="",c=0;for(t=t.replace(/[^A-Za-z0-9\-_\=]/g,"");c<t.length;)s=this._keyStr.indexOf(t.charAt(c++)),o=this._keyStr.indexOf(t.charAt(c++)),a=this._keyStr.indexOf(t.charAt(c++)),r=this._keyStr.indexOf(t.charAt(c++)),e=s<<2|o>>4,i=(15&o)<<4|a>>2,n=(3&a)<<6|r,l+=String.fromCharCode(e),64!=a&&(l+=String.fromCharCode(i)),64!=r&&(l+=String.fromCharCode(n));return l}};return s.prototype={translate:function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},scale:function(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.m[0]*e+this.m[2]*i,s=this.m[1]*e+this.m[3]*i,o=this.m[0]*-i+this.m[2]*e,a=this.m[1]*-i+this.m[3]*e;this.m[0]=n,this.m[1]=s,this.m[2]=o,this.m[3]=a},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(t,e){var i=this.m[0]+this.m[2]*e,n=this.m[1]+this.m[3]*e,s=this.m[2]+this.m[0]*t,o=this.m[3]+this.m[1]*t;this.m[0]=i,this.m[1]=n,this.m[2]=s,this.m[3]=o},multiply:function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],s=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],a=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=s,this.m[4]=o,this.m[5]=a},invert:function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,n=-this.m[2]*t,s=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),a=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=s,this.m[4]=o,this.m[5]=a},getMatrix:function(){return this.m},reset:function(){this.m=[1,0,0,1,0,0]}},{extend:i,include:n,Base64:l,Transform:s,testProp:function(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1},generateUUID:o,copyToClipboard:r}}),define("_libs/grids/SlickGrid-master/slick.core",["jquery"],function(){function t(){var t=!1,e=!1;this.stopPropagation=function(){t=!0},this.isPropagationStopped=function(){return t},this.stopImmediatePropagation=function(){e=!0},this.isImmediatePropagationStopped=function(){return e}}function e(){var e=[];this.subscribe=function(t){e.push(t)},this.unsubscribe=function(t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)},this.notify=function(i,n,s){n=n||new t,s=s||this;for(var o,a=0;a<e.length&&!n.isPropagationStopped()&&!n.isImmediatePropagationStopped();a++)o=e[a].call(s,n,i);return o}}function i(){var t=[];this.subscribe=function(e,i){return t.push({event:e,handler:i}),e.subscribe(i),this},this.unsubscribe=function(e,i){for(var n=t.length;n--;)if(t[n].event===e&&t[n].handler===i)return t.splice(n,1),e.unsubscribe(i),void 0;return this},this.unsubscribeAll=function(){for(var e=t.length;e--;)t[e].event.unsubscribe(t[e].handler);return t=[],this}}function n(t,e,i,n){void 0===i&&void 0===n&&(i=t,n=e),this.fromRow=Math.min(t,i),this.fromCell=Math.min(e,n),this.toRow=Math.max(t,i),this.toCell=Math.max(e,n),this.isSingleRow=function(){return this.fromRow==this.toRow},this.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell},this.contains=function(t,e){return t>=this.fromRow&&t<=this.toRow&&e>=this.fromCell&&e<=this.toCell},this.toString=function(){return this.isSingleCell()?"("+this.fromRow+":"+this.fromCell+")":"("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"}}function s(){this.__nonDataRow=!0}function o(){this.__group=!0,this.level=0,this.count=0,this.value=null,this.title=null,this.collapsed=!1,this.totals=null,this.rows=[],this.groups=null,this.groupingKey=null}function a(){this.__groupTotals=!0,this.group=null}function r(){var t=null;this.isActive=function(e){return e?t===e:null!==t},this.activate=function(e){if(e!==t){if(null!==t)throw"SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController";if(!e.commitCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()";if(!e.cancelCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()";t=e}},this.deactivate=function(e){if(t!==e)throw"SlickGrid.EditorLock.deactivate: specified editController is not the currently active one";t=null},this.commitCurrentEdit=function(){return t?t.commitCurrentEdit():!0},this.cancelCurrentEdit=function(){return t?t.cancelCurrentEdit():!0}}var l={Event:e,EventData:t,EventHandler:i,Range:n,NonDataRow:s,Group:o,GroupTotals:a,EditorLock:r,GlobalEditorLock:new r};return o.prototype=new s,o.prototype.equals=function(t){return this.value===t.value&&this.count===t.count&&this.collapsed===t.collapsed&&this.title===t.title},a.prototype=new s,l}),define("_libs/grids/SlickGrid-master/slick.grid",["jquery","_libs/grids/SlickGrid-master/slick.core"],function($,Slick,css){function SlickGrid(container,data,columns,options){function init(){if($container=$(container),$container.length<1)throw new Error("SlickGrid requires a valid container, "+container+" does not exist in the DOM.");maxSupportedCssHeight=maxSupportedCssHeight||getMaxSupportedCssHeight(),scrollbarDimensions=scrollbarDimensions||measureScrollbar(),options=$.extend({},defaults,options),validateAndEnforceOptions(),columnDefaults.width=options.defaultColumnWidth,columnsById={};for(var t=0;t<columns.length;t++){var e=columns[t]=$.extend({},columnDefaults,columns[t]);columnsById[e.id]=t,e.minWidth&&e.width<e.minWidth&&(e.width=e.minWidth),e.maxWidth&&e.width>e.maxWidth&&(e.width=e.maxWidth)}if(options.enableColumnReorder&&!$.fn.sortable)throw new Error("SlickGrid's 'enableColumnReorder = true' option requires jquery-ui.sortable module to be loaded");editController={commitCurrentEdit:commitCurrentEdit,cancelCurrentEdit:cancelCurrentEdit},$container.empty().css("overflow","hidden").css("outline",0).addClass(uid).addClass("ui-widget"),/relative|absolute|fixed/.test($container.css("position"))||$container.css("position","relative"),$focusSink=$("<div tabIndex='0' hideFocus style='position:fixed;width:0;height:0;top:0;left:0;outline:0;'></div>").appendTo($container),$headerScroller=$("<div class='slick-header ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$headers=$("<div class='slick-header-columns' style='left:-1000px' />").appendTo($headerScroller),$headers.width(getHeadersWidth()),$headerRowScroller=$("<div class='slick-headerrow ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$headerRow=$("<div class='slick-headerrow-columns' />").appendTo($headerRowScroller),$headerRowSpacer=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").css("width",getCanvasWidth()+scrollbarDimensions.width+"px").appendTo($headerRowScroller),$topPanelScroller=$("<div class='slick-top-panel-scroller ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$topPanel=$("<div class='slick-top-panel' style='width:10000px' />").appendTo($topPanelScroller),options.showTopPanel||$topPanelScroller.hide(),options.showHeaderRow||$headerRowScroller.hide(),$viewport=$("<div class='slick-viewport' style='width:100%;overflow:auto;outline:0;position:relative;;'>").appendTo($container),$viewport.css("overflow-y",options.autoHeight?"hidden":"auto"),$canvas=$("<div class='grid-canvas' />").appendTo($viewport),$focusSink2=$focusSink.clone().appendTo($container),options.explicitInitialization||finishInitialization()}function finishInitialization(){initialized||(initialized=!0,viewportW=parseFloat($.css($container[0],"width",!0)),measureCellPaddingAndBorder(),disableSelection($headers),options.enableTextSelectionOnCells||$viewport.bind("selectstart.ui",function(t){return $(t.target).is("input,textarea")}),updateColumnCaches(),createColumnHeaders(),setupColumnSort(),createCssRules(),resizeCanvas(),bindAncestorScrollEvents(),$container.bind("resize.slickgrid",resizeCanvas),$viewport.bind("click",handleClick).bind("scroll",handleScroll),$headerScroller.bind("contextmenu",handleHeaderContextMenu).bind("click",handleHeaderClick).delegate(".slick-header-column","mouseenter",handleHeaderMouseEnter).delegate(".slick-header-column","mouseleave",handleHeaderMouseLeave),$headerRowScroller.bind("scroll",handleHeaderRowScroll),$focusSink.add($focusSink2).bind("keydown",handleKeyDown),$canvas.bind("keydown",handleKeyDown).bind("click",handleClick).bind("dblclick",handleDblClick).bind("contextmenu",handleContextMenu).bind("draginit",handleDragInit).bind("dragstart",{distance:3},handleDragStart).bind("drag",handleDrag).bind("dragend",handleDragEnd).delegate(".slick-cell","mouseenter",handleMouseEnter).delegate(".slick-cell","mouseleave",handleMouseLeave))}function registerPlugin(t){plugins.unshift(t),t.init(self)}function unregisterPlugin(t){for(var e=plugins.length;e>=0;e--)if(plugins[e]===t){plugins[e].destroy&&plugins[e].destroy(),plugins.splice(e,1);break}}function setSelectionModel(t){selectionModel&&(selectionModel.onSelectedRangesChanged.unsubscribe(handleSelectedRangesChanged),selectionModel.destroy&&selectionModel.destroy()),selectionModel=t,selectionModel&&(selectionModel.init(self),selectionModel.onSelectedRangesChanged.subscribe(handleSelectedRangesChanged))}function getSelectionModel(){return selectionModel}function getCanvasNode(){return $canvas[0]}function measureScrollbar(){var t=$("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body"),e={width:t.width()-t[0].clientWidth,height:t.height()-t[0].clientHeight};return t.remove(),e}function getHeadersWidth(){for(var t=0,e=0,i=columns.length;i>e;e++){var n=columns[e].width;t+=n}return t+=scrollbarDimensions.width,Math.max(t,viewportW)+1e3}function getCanvasWidth(){for(var t=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW,e=0,i=columns.length;i--;)e+=columns[i].width;return options.fullWidthRows?Math.max(e,t):e}function updateCanvasWidth(t){var e=canvasWidth;canvasWidth=getCanvasWidth(),canvasWidth!=e&&($canvas.width(canvasWidth),$headerRow.width(canvasWidth),$headers.width(getHeadersWidth()),viewportHasHScroll=canvasWidth>viewportW-scrollbarDimensions.width),$headerRowSpacer.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0)),(canvasWidth!=e||t)&&applyColumnWidths()}function disableSelection(t){t&&t.jquery&&t.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return!1})}function getMaxSupportedCssHeight(){for(var t=1e6,e=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,i=$("<div style='display:none' />").appendTo(document.body);;){var n=2*t;if(i.css("height",n),n>e||i.height()!==n)break;t=n}return i.remove(),t}function bindAncestorScrollEvents(){for(var t=$canvas[0];(t=t.parentNode)!=document.body&&null!=t;)if(t==$viewport[0]||t.scrollWidth!=t.clientWidth||t.scrollHeight!=t.clientHeight){var e=$(t);$boundAncestors=$boundAncestors?$boundAncestors.add(e):e,e.bind("scroll."+uid,handleActiveCellPositionChange)}}function unbindAncestorScrollEvents(){$boundAncestors&&($boundAncestors.unbind("scroll."+uid),$boundAncestors=null)}function updateColumnHeader(t,e,i){if(initialized){var n=getColumnIndex(t);if(null!=n){var s=columns[n],o=$headers.children().eq(n);o&&(void 0!==e&&(columns[n].name=e),void 0!==i&&(columns[n].toolTip=i),trigger(self.onBeforeHeaderCellDestroy,{node:o[0],column:s}),o.attr("title",i||"").children().eq(0).html(e),trigger(self.onHeaderCellRendered,{node:o[0],column:s}))}}}function getHeaderRow(){return $headerRow[0]}function getHeaderRowColumn(t){var e=getColumnIndex(t),i=$headerRow.children().eq(e);return i&&i[0]}function createColumnHeaders(){function t(){$(this).addClass("ui-state-hover")}function e(){$(this).removeClass("ui-state-hover")}$headers.find(".slick-header-column").each(function(){var t=$(this).data("column");t&&trigger(self.onBeforeHeaderCellDestroy,{node:this,column:t})}),$headers.empty(),$headers.width(getHeadersWidth()),$headerRow.find(".slick-headerrow-column").each(function(){var t=$(this).data("column");t&&trigger(self.onBeforeHeaderRowCellDestroy,{node:this,column:t})}),$headerRow.empty();for(var i=0;i<columns.length;i++){var n=columns[i],s=$("<div class='ui-state-default slick-header-column' />").html("<span class='slick-column-name'>"+n.name+"</span>").width(n.width-headerColumnWidthDiff).attr("id",""+uid+n.id).attr("title",n.toolTip||"").data("column",n).addClass(n.headerCssClass||"").appendTo($headers);if((options.enableColumnReorder||n.sortable)&&s.on("mouseenter",t).on("mouseleave",e),n.sortable&&(s.addClass("slick-header-sortable"),s.append("<span class='slick-sort-indicator' />")),trigger(self.onHeaderCellRendered,{node:s[0],column:n}),options.showHeaderRow){var o=$("<div class='ui-state-default slick-headerrow-column l"+i+" r"+i+"'></div>").data("column",n).appendTo($headerRow);trigger(self.onHeaderRowCellRendered,{node:o[0],column:n})}}setSortColumns(sortColumns),setupColumnResize(),options.enableColumnReorder&&setupColumnReorder()}function setupColumnSort(){$headers.click(function(t){if(t.metaKey=t.metaKey||t.ctrlKey,!$(t.target).hasClass("slick-resizable-handle")){var e=$(t.target).closest(".slick-header-column");if(e.length){var i=e.data("column");if(i.sortable){if(!getEditorLock().commitCurrentEdit())return;for(var n=null,s=0;s<sortColumns.length;s++)if(sortColumns[s].columnId==i.id){n=sortColumns[s],n.sortAsc=!n.sortAsc;break}t.metaKey&&options.multiColumnSort?n&&sortColumns.splice(s,1):((t.shiftKey||t.metaKey)&&options.multiColumnSort||(sortColumns=[]),n?0==sortColumns.length&&sortColumns.push(n):(n={columnId:i.id,sortAsc:i.defaultSortAsc},sortColumns.push(n))),setSortColumns(sortColumns),options.multiColumnSort?trigger(self.onSort,{multiColumnSort:!0,sortCols:$.map(sortColumns,function(t){return{sortCol:columns[getColumnIndex(t.columnId)],sortAsc:t.sortAsc}})},t):trigger(self.onSort,{multiColumnSort:!1,sortCol:i,sortAsc:n.sortAsc},t)}}}})}function setupColumnReorder(){$headers.filter(":ui-sortable").sortable("destroy"),$headers.sortable({containment:"parent",distance:3,axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",forcePlaceholderSize:!0,start:function(t,e){$(e.helper).addClass("slick-header-column-active")},beforeStop:function(t,e){$(e.helper).removeClass("slick-header-column-active")},stop:function(t){if(!getEditorLock().commitCurrentEdit())return $(this).sortable("cancel"),void 0;for(var e=$headers.sortable("toArray"),i=[],n=0;n<e.length;n++)i.push(columns[getColumnIndex(e[n].replace(uid,""))]);setColumns(i),trigger(self.onColumnsReordered,{}),t.stopPropagation(),setupColumnResize()}})}function setupColumnResize(){var t,e,i,n,s,o,a,r,l;s=$headers.children(),s.find(".slick-resizable-handle").remove(),s.each(function(t){columns[t].resizable&&(void 0===r&&(r=t),l=t)}),void 0!==r&&s.each(function(c,h){r>c||options.forceFitColumns&&c>=l||(t=$(h),$("<div class='slick-resizable-handle' />").appendTo(h).bind("dragstart",function(t){if(!getEditorLock().commitCurrentEdit())return!1;n=t.pageX,$(this).parent().addClass("slick-header-column-active");var r=null,l=null;if(s.each(function(t,e){columns[t].previousWidth=$(e).outerWidth()}),options.forceFitColumns)for(r=0,l=0,e=c+1;e<s.length;e++)i=columns[e],i.resizable&&(null!==l&&(i.maxWidth?l+=i.maxWidth-i.previousWidth:l=null),r+=i.previousWidth-Math.max(i.minWidth||0,absoluteColumnMinWidth));var h=0,d=0;for(e=0;c>=e;e++)i=columns[e],i.resizable&&(null!==d&&(i.maxWidth?d+=i.maxWidth-i.previousWidth:d=null),h+=i.previousWidth-Math.max(i.minWidth||0,absoluteColumnMinWidth));null===r&&(r=1e5),null===h&&(h=1e5),null===l&&(l=1e5),null===d&&(d=1e5),a=n+Math.min(r,d),o=n-Math.min(h,l)}).bind("drag",function(t){var r,l,h=Math.min(a,Math.max(o,t.pageX))-n;if(0>h){for(l=h,e=c;e>=0;e--)i=columns[e],i.resizable&&(r=Math.max(i.minWidth||0,absoluteColumnMinWidth),l&&i.previousWidth+l<r?(l+=i.previousWidth-r,i.width=r):(i.width=i.previousWidth+l,l=0));if(options.forceFitColumns)for(l=-h,e=c+1;e<s.length;e++)i=columns[e],i.resizable&&(l&&i.maxWidth&&i.maxWidth-i.previousWidth<l?(l-=i.maxWidth-i.previousWidth,i.width=i.maxWidth):(i.width=i.previousWidth+l,l=0))}else{for(l=h,e=c;e>=0;e--)i=columns[e],i.resizable&&(l&&i.maxWidth&&i.maxWidth-i.previousWidth<l?(l-=i.maxWidth-i.previousWidth,i.width=i.maxWidth):(i.width=i.previousWidth+l,l=0));if(options.forceFitColumns)for(l=-h,e=c+1;e<s.length;e++)i=columns[e],i.resizable&&(r=Math.max(i.minWidth||0,absoluteColumnMinWidth),l&&i.previousWidth+l<r?(l+=i.previousWidth-r,i.width=r):(i.width=i.previousWidth+l,l=0))}applyColumnHeaderWidths(),options.syncColumnCellResize&&applyColumnWidths()}).bind("dragend",function(){var t;for($(this).parent().removeClass("slick-header-column-active"),e=0;e<s.length;e++)i=columns[e],t=$(s[e]).outerWidth(),i.previousWidth!==t&&i.rerenderOnResize&&invalidateAllRows();updateCanvasWidth(!0),render(),trigger(self.onColumnsResized,{})}))})}function getVBoxDelta(t){var e=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],i=0;return $.each(e,function(e,n){i+=parseFloat(t.css(n))||0}),i}function measureCellPaddingAndBorder(){var t,e=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],i=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];t=$("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo($headers),headerColumnWidthDiff=headerColumnHeightDiff=0,$.each(e,function(e,i){headerColumnWidthDiff+=parseFloat(t.css(i))||0}),$.each(i,function(e,i){headerColumnHeightDiff+=parseFloat(t.css(i))||0}),t.remove();var n=$("<div class='slick-row' />").appendTo($canvas);t=$("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(n),cellWidthDiff=cellHeightDiff=0,$.each(e,function(e,i){cellWidthDiff+=parseFloat(t.css(i))||0}),$.each(i,function(e,i){cellHeightDiff+=parseFloat(t.css(i))||0}),n.remove(),absoluteColumnMinWidth=Math.max(headerColumnWidthDiff,cellWidthDiff)}function createCssRules(){$style=$("<style type='text/css' rel='stylesheet' />").appendTo($("head"));for(var t=options.rowHeight-cellHeightDiff,e=["."+uid+" .slick-header-column { left: 1000px; }","."+uid+" .slick-top-panel { height:"+options.topPanelHeight+"px; }","."+uid+" .slick-headerrow-columns { height:"+options.headerRowHeight+"px; }","."+uid+" .slick-cell { height:"+t+"px; }","."+uid+" .slick-row { height:"+options.rowHeight+"px; }"],i=0;i<columns.length;i++)e.push("."+uid+" .l"+i+" { }"),e.push("."+uid+" .r"+i+" { }");$style[0].styleSheet?$style[0].styleSheet.cssText=e.join(" "):$style[0].appendChild(document.createTextNode(e.join(" ")))}function getColumnCssRules(t){if(!stylesheet){for(var e=document.styleSheets,i=0;i<e.length;i++)if((e[i].ownerNode||e[i].owningElement)==$style[0]){stylesheet=e[i];break}if(!stylesheet)throw new Error("Cannot find stylesheet.");columnCssRulesL=[],columnCssRulesR=[];for(var n,s,o=stylesheet.cssRules||stylesheet.rules,i=0;i<o.length;i++){var a=o[i].selectorText;(n=/\.l\d+/.exec(a))?(s=parseInt(n[0].substr(2,n[0].length-2),10),columnCssRulesL[s]=o[i]):(n=/\.r\d+/.exec(a))&&(s=parseInt(n[0].substr(2,n[0].length-2),10),columnCssRulesR[s]=o[i])}}return{left:columnCssRulesL[t],right:columnCssRulesR[t]}}function removeCssRules(){$style.remove(),stylesheet=null}function destroy(){getEditorLock().cancelCurrentEdit(),trigger(self.onBeforeDestroy,{});for(var t=plugins.length;t--;)unregisterPlugin(plugins[t]);options.enableColumnReorder&&$headers.filter(":ui-sortable").sortable("destroy"),unbindAncestorScrollEvents(),$container.unbind(".slickgrid"),removeCssRules(),$canvas.unbind("draginit dragstart dragend drag"),$container.empty().removeClass(uid)}function trigger(t,e,i){return i=i||new Slick.EventData,e=e||{},e.grid=self,t.notify(e,i,self)}function getEditorLock(){return options.editorLock}function getEditController(){return editController}function getColumnIndex(t){return columnsById[t]}function autosizeColumns(){var t,e,i,n=[],s=0,o=0,a=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;for(t=0;t<columns.length;t++)e=columns[t],n.push(e.width),o+=e.width,e.resizable&&(s+=e.width-Math.max(e.minWidth,absoluteColumnMinWidth));for(i=o;o>a&&s;){var r=(o-a)/s;for(t=0;t<columns.length&&o>a;t++){e=columns[t];var l=n[t];if(!(!e.resizable||l<=e.minWidth||absoluteColumnMinWidth>=l)){var c=Math.max(e.minWidth,absoluteColumnMinWidth),h=Math.floor(r*(l-c))||1;h=Math.min(h,l-c),o-=h,s-=h,n[t]-=h}}if(i==o)break;i=o}for(i=o;a>o;){var d=a/o;for(t=0;t<columns.length&&a>o;t++)if(e=columns[t],e.resizable&&!(e.maxWidth<=e.width)){var u=Math.min(Math.floor(d*e.width)-e.width,e.maxWidth-e.width||1e6)||1;o+=u,n[t]+=u}if(i==o)break;i=o}var p=!1;for(t=0;t<columns.length;t++)columns[t].rerenderOnResize&&columns[t].width!=n[t]&&(p=!0),columns[t].width=n[t];applyColumnHeaderWidths(),updateCanvasWidth(!0),p&&(invalidateAllRows(),render())}function applyColumnHeaderWidths(){if(initialized){for(var t,e=0,i=$headers.children(),n=i.length;n>e;e++)t=$(i[e]),t.width()!==columns[e].width-headerColumnWidthDiff&&t.width(columns[e].width-headerColumnWidthDiff);
updateColumnCaches()}}function applyColumnWidths(){return}function setSortColumn(t,e){setSortColumns([{columnId:t,sortAsc:e}])}function setSortColumns(t){sortColumns=t;var e=$headers.children();e.removeClass("slick-header-column-sorted").find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc"),$.each(sortColumns,function(t,i){null==i.sortAsc&&(i.sortAsc=!0);var n=getColumnIndex(i.columnId);null!=n&&e.eq(n).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(i.sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc")})}function getSortColumns(){return sortColumns}function handleSelectedRangesChanged(t,e){selectedRows=[];for(var i={},n=0;n<e.length;n++)for(var s=e[n].fromRow;s<=e[n].toRow;s++){i[s]||(selectedRows.push(s),i[s]={});for(var o=e[n].fromCell;o<=e[n].toCell;o++)canCellBeSelected(s,o)&&(i[s][columns[o].id]=options.selectedCellCssClass)}setCellCssStyles(options.selectedCellCssClass,i),trigger(self.onSelectedRowsChanged,{rows:getSelectedRows()},t)}function getColumns(){return columns}function updateColumnCaches(){columnPosLeft=[],columnPosRight=[];for(var t=0,e=0,i=columns.length;i>e;e++)columnPosLeft[e]=t,columnPosRight[e]=t+columns[e].width,t+=columns[e].width}function setColumns(t){columns=t,columnsById={};for(var e=0;e<columns.length;e++){var i=columns[e]=$.extend({},columnDefaults,columns[e]);columnsById[i.id]=e,i.minWidth&&i.width<i.minWidth&&(i.width=i.minWidth),i.maxWidth&&i.width>i.maxWidth&&(i.width=i.maxWidth)}updateColumnCaches(),initialized&&(invalidateAllRows(),createColumnHeaders(),removeCssRules(),createCssRules(),resizeCanvas(),applyColumnWidths(),handleScroll())}function getOptions(){return options}function setOptions(t){getEditorLock().commitCurrentEdit()&&(makeActiveCellNormal(),options.enableAddRow!==t.enableAddRow&&invalidateRow(getDataLength()),options=$.extend(options,t),validateAndEnforceOptions(),$viewport.css("overflow-y",options.autoHeight?"hidden":"auto"),render())}function validateAndEnforceOptions(){options.autoHeight&&(options.leaveSpaceForNewRows=!1)}function setData(t,e){data=t,invalidateAllRows(),updateRowCount(),e&&scrollTo(0)}function getData(){return data}function getDataLength(){return data.getLength?data.getLength():data.length}function getDataLengthIncludingAddNew(){return getDataLength()+(options.enableAddRow?1:0)}function getDataItem(t){return data.getItem?data.getItem(t):data[t]}function getTopPanel(){return $topPanel[0]}function setTopPanelVisibility(t){options.showTopPanel!=t&&(options.showTopPanel=t,t?$topPanelScroller.slideDown("fast",resizeCanvas):$topPanelScroller.slideUp("fast",resizeCanvas))}function setHeaderRowVisibility(t){options.showHeaderRow!=t&&(options.showHeaderRow=t,t?$headerRowScroller.slideDown("fast",resizeCanvas):$headerRowScroller.slideUp("fast",resizeCanvas))}function getContainerNode(){return $container.get(0)}function getRowTop(t){return options.rowHeight*t-offset}function getRowFromPosition(t){return Math.floor((t+offset)/options.rowHeight)}function scrollTo(t){t=Math.max(t,0),t=Math.min(t,th-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0));var e=offset;page=Math.min(n-1,Math.floor(t/ph)),offset=Math.round(page*cj);var i=t-offset;if(offset!=e){var s=getVisibleRange(i);cleanupRows(s),updateRowPositions()}prevScrollTop!=i&&(vScrollDir=i+offset>prevScrollTop+e?1:-1,$viewport[0].scrollTop=lastRenderedScrollTop=scrollTop=prevScrollTop=i,trigger(self.onViewportChanged,{}))}function defaultFormatter(t,e,i){return null==i?"":(i+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function getFormatter(t,e){var i=data.getItemMetadata&&data.getItemMetadata(t),n=i&&i.columns&&(i.columns[e.id]||i.columns[getColumnIndex(e.id)]);return n&&n.formatter||i&&i.formatter||e.formatter||options.formatterFactory&&options.formatterFactory.getFormatter(e)||options.defaultFormatter}function getEditor(t,e){var i=columns[e],n=data.getItemMetadata&&data.getItemMetadata(t),s=n&&n.columns;return s&&s[i.id]&&void 0!==s[i.id].editor?s[i.id].editor:s&&s[e]&&void 0!==s[e].editor?s[e].editor:i.editor||options.editorFactory&&options.editorFactory.getEditor(i)}function getDataItemValueForColumn(t,e){return options.dataItemColumnValueExtractor?options.dataItemColumnValueExtractor(t,e):t[e.field]}function appendRowHtml(t,e,i,n){var s=getDataItem(e),o=n>e&&!s,a="slick-row"+(o?" loading":"")+(e===activeRow?" active":"")+(1==e%2?" odd":" even")+(0===e?" first":""),r=data.getItemMetadata&&data.getItemMetadata(e);r&&r.cssClasses&&(a+=" "+r.cssClasses),t.push("<div class='ui-widget-content "+a+"' style='top:"+getRowTop(e)+"px'>");for(var l,c,h=0,d=columns.length;d>h;h++){if(c=columns[h],l=1,r&&r.columns){var u=r.columns[c.id]||r.columns[h];l=u&&u.colspan||1,"*"===l&&(l=d-h)}if(columnPosRight[Math.min(d-1,h+l-1)]>i.leftPx){if(columnPosLeft[h]>i.rightPx)break;appendCellHtml(t,e,h,l,s)}l>1&&(h+=l-1)}t.push("</div>")}function appendCellHtml(t,e,i,n,s){var o=columns[i],a="slick-cell l"+i+" r"+Math.min(columns.length-1,i+n-1)+(o.cssClass?" "+o.cssClass:"");e===activeRow&&i===activeCell&&(a+=" active");for(var r in cellCssClasses)cellCssClasses[r][e]&&cellCssClasses[r][e][o.id]&&(a+=" "+cellCssClasses[r][e][o.id]);if(t.push("<div class='"+a+"'>"),s){var l=getDataItemValueForColumn(s,o);t.push(getFormatter(e,o)(e,i,l,o,s))}t.push("</div>"),rowsCache[e].cellRenderQueue.push(i),rowsCache[e].cellColSpans[i]=n}function cleanupRows(t){for(var e in rowsCache)(e=parseInt(e,10))!==activeRow&&(e<t.top||e>t.bottom)&&removeRowFromCache(e)}function invalidate(){updateRowCount(),invalidateAllRows(),render()}function invalidateAllRows(){currentEditor&&makeActiveCellNormal();for(var t in rowsCache)removeRowFromCache(t)}function removeRowFromCache(t){var e=rowsCache[t];e&&($canvas[0].removeChild(e.rowNode),delete rowsCache[t],delete postProcessedRows[t],renderedRows--,counter_rows_removed++)}function invalidateRows(t){var e,i;if(t&&t.length)for(vScrollDir=0,e=0,i=t.length;i>e;e++)currentEditor&&activeRow===t[e]&&makeActiveCellNormal(),rowsCache[t[e]]&&removeRowFromCache(t[e])}function invalidateRow(t){invalidateRows([t])}function updateCell(t,e){var i=getCellNode(t,e);if(i){var n=columns[e],s=getDataItem(t);currentEditor&&activeRow===t&&activeCell===e?currentEditor.loadValue(s):(i.innerHTML=s?getFormatter(t,n)(t,e,getDataItemValueForColumn(s,n),n,s):"",invalidatePostProcessingResults(t))}}function updateRow(t){var e=rowsCache[t];if(e){ensureCellNodesInRowsCache(t);var i=getDataItem(t);for(var n in e.cellNodesByColumnIdx)if(e.cellNodesByColumnIdx.hasOwnProperty(n)){n=0|n;var s=columns[n],o=e.cellNodesByColumnIdx[n];t===activeRow&&n===activeCell&&currentEditor?currentEditor.loadValue(i):o.innerHTML=i?getFormatter(t,s)(t,n,getDataItemValueForColumn(i,s),s,i):""}invalidatePostProcessingResults(t)}}function getViewportHeight(){return parseFloat($.css($container[0],"height",!0))}function resizeCanvas(){initialized&&(viewportH=options.autoHeight?options.rowHeight*getDataLengthIncludingAddNew():getViewportHeight(),numVisibleRows=Math.ceil(viewportH/options.rowHeight),viewportW=parseFloat($.css($container[0],"width",!0)),options.autoHeight||$viewport.height(viewportH),options.forceFitColumns&&autosizeColumns(),updateRowCount(),handleScroll(),lastRenderedScrollLeft=-1,render())}function updateRowCount(){if(getDataLength(),initialized){numberOfRows=getDataLengthIncludingAddNew()+(options.leaveSpaceForNewRows?numVisibleRows-1:0);var t=viewportHasVScroll;viewportHasVScroll=!options.autoHeight&&numberOfRows*options.rowHeight>viewportH;var e=getDataLengthIncludingAddNew()-1;for(var i in rowsCache)i>=e&&removeRowFromCache(i);activeCellNode&&activeRow>e&&resetActiveCell();var s=h;th=Math.max(options.rowHeight*numberOfRows,viewportH-scrollbarDimensions.height),maxSupportedCssHeight>th?(h=ph=th,n=1,cj=0):(h=maxSupportedCssHeight,ph=h/100,n=Math.floor(th/ph),cj=(th-h)/(n-1)),h!==s&&($canvas.css("height",h),scrollTop=$viewport[0].scrollTop);var o=th-viewportH>=scrollTop+offset;0==th||0==scrollTop?page=offset=0:o?scrollTo(scrollTop+offset):scrollTo(th-viewportH),h!=s&&options.autoHeight&&resizeCanvas(),options.forceFitColumns&&t!=viewportHasVScroll&&autosizeColumns(),updateCanvasWidth(!1)}}function getVisibleRange(t,e){return null==t&&(t=scrollTop),null==e&&(e=scrollLeft),{top:getRowFromPosition(t),bottom:getRowFromPosition(t+viewportH)+1,leftPx:e,rightPx:e+viewportW}}function getRenderedRange(t,e){var i=getVisibleRange(t,e),n=Math.round(viewportH/options.rowHeight),s=3;return-1==vScrollDir?(i.top-=n,i.bottom+=s):1==vScrollDir?(i.top-=s,i.bottom+=n):(i.top-=s,i.bottom+=s),i.top=Math.max(0,i.top),i.bottom=Math.min(getDataLengthIncludingAddNew()-1,i.bottom),i.leftPx-=viewportW,i.rightPx+=viewportW,i.leftPx=Math.max(0,i.leftPx),i.rightPx=Math.min(canvasWidth,i.rightPx),i}function ensureCellNodesInRowsCache(t){var e=rowsCache[t];if(e&&e.cellRenderQueue.length)for(var i=e.rowNode.lastChild;e.cellRenderQueue.length;){var n=e.cellRenderQueue.pop();e.cellNodesByColumnIdx[n]=i,i=i.previousSibling}}function cleanUpCells(t,e){var i=0,n=rowsCache[e],s=[];for(var o in n.cellNodesByColumnIdx)if(n.cellNodesByColumnIdx.hasOwnProperty(o)){o=0|o;var a=n.cellColSpans[o];(columnPosLeft[o]>t.rightPx||columnPosRight[Math.min(columns.length-1,o+a-1)]<t.leftPx)&&(e!=activeRow||o!=activeCell)&&s.push(o)}for(var r;null!=(r=s.pop());)n.rowNode.removeChild(n.cellNodesByColumnIdx[r]),delete n.cellColSpans[r],delete n.cellNodesByColumnIdx[r],postProcessedRows[e]&&delete postProcessedRows[e][r],i++}function cleanUpAndRenderCells(t){for(var e,i,n,s=[],o=[],a=0,r=t.top,l=t.bottom;l>=r;r++)if(e=rowsCache[r]){ensureCellNodesInRowsCache(r),cleanUpCells(t,r),i=0;var c=data.getItemMetadata&&data.getItemMetadata(r);c=c&&c.columns;for(var h=getDataItem(r),d=0,u=columns.length;u>d&&!(columnPosLeft[d]>t.rightPx);d++)if(null==(n=e.cellColSpans[d])){if(n=1,c){var p=c[columns[d].id]||c[d];n=p&&p.colspan||1,"*"===n&&(n=u-d)}columnPosRight[Math.min(u-1,d+n-1)]>t.leftPx&&(appendCellHtml(s,r,d,n,h),i++),d+=n>1?n-1:0}else d+=n>1?n-1:0;i&&(a+=i,o.push(r))}if(s.length){var m=document.createElement("div");m.innerHTML=s.join("");for(var f,g;null!=(f=o.pop());){e=rowsCache[f];for(var v;null!=(v=e.cellRenderQueue.pop());)g=m.lastChild,e.rowNode.appendChild(g),e.cellNodesByColumnIdx[v]=g}}}function renderRows(t){for(var e=$canvas[0],i=[],n=[],s=!1,o=getDataLength(),a=t.top,r=t.bottom;r>=a;a++)rowsCache[a]||(renderedRows++,n.push(a),rowsCache[a]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]},appendRowHtml(i,a,t,o),activeCellNode&&activeRow===a&&(s=!0),counter_rows_rendered++);if(n.length){var l=document.createElement("div");l.innerHTML=i.join("");for(var a=0,r=n.length;r>a;a++)rowsCache[n[a]].rowNode=e.appendChild(l.firstChild);s&&(activeCellNode=getCellNode(activeRow,activeCell))}}function startPostProcessing(){options.enableAsyncPostRender&&(clearTimeout(h_postrender),h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay))}function invalidatePostProcessingResults(t){delete postProcessedRows[t],postProcessFromRow=Math.min(postProcessFromRow,t),postProcessToRow=Math.max(postProcessToRow,t),startPostProcessing()}function updateRowPositions(){for(var t in rowsCache)rowsCache[t].rowNode.style.top=getRowTop(t)+"px"}function render(){if(initialized){var t=getVisibleRange(),e=getRenderedRange();cleanupRows(e),lastRenderedScrollLeft!=scrollLeft&&cleanUpAndRenderCells(e),renderRows(e),postProcessFromRow=t.top,postProcessToRow=Math.min(getDataLengthIncludingAddNew()-1,t.bottom),startPostProcessing(),lastRenderedScrollTop=scrollTop,lastRenderedScrollLeft=scrollLeft,h_render=null}}function handleHeaderRowScroll(){var t=$headerRowScroller[0].scrollLeft;t!=$viewport[0].scrollLeft&&($viewport[0].scrollLeft=t)}function handleScroll(){scrollTop=$viewport[0].scrollTop,scrollLeft=$viewport[0].scrollLeft;var t=Math.abs(scrollTop-prevScrollTop),e=Math.abs(scrollLeft-prevScrollLeft);if(e&&(prevScrollLeft=scrollLeft,$headerScroller[0].scrollLeft=scrollLeft,$topPanelScroller[0].scrollLeft=scrollLeft,$headerRowScroller[0].scrollLeft=scrollLeft),t)if(vScrollDir=scrollTop>prevScrollTop?1:-1,prevScrollTop=scrollTop,viewportH>t)scrollTo(scrollTop+offset);else{var i=offset;page=h==viewportH?0:Math.min(n-1,Math.floor(scrollTop*((th-viewportH)/(h-viewportH))*(1/ph))),offset=Math.round(page*cj),i!=offset&&invalidateAllRows()}(e||t)&&(h_render&&clearTimeout(h_render),(Math.abs(lastRenderedScrollTop-scrollTop)>20||Math.abs(lastRenderedScrollLeft-scrollLeft)>20)&&(options.forceSyncScrolling||Math.abs(lastRenderedScrollTop-scrollTop)<viewportH&&Math.abs(lastRenderedScrollLeft-scrollLeft)<viewportW?render():h_render=setTimeout(render,50),trigger(self.onViewportChanged,{}))),trigger(self.onScroll,{scrollLeft:scrollLeft,scrollTop:scrollTop})}function asyncPostProcessRows(){for(;postProcessToRow>=postProcessFromRow;){var t=vScrollDir>=0?postProcessFromRow++:postProcessToRow--,e=rowsCache[t];if(e&&!(t>=getDataLength())){postProcessedRows[t]||(postProcessedRows[t]={}),ensureCellNodesInRowsCache(t);for(var i in e.cellNodesByColumnIdx)if(e.cellNodesByColumnIdx.hasOwnProperty(i)){i=0|i;var n=columns[i];if(n.asyncPostRender&&!postProcessedRows[t][i]){var s=e.cellNodesByColumnIdx[i];s&&n.asyncPostRender(s,t,getDataItem(t),n),postProcessedRows[t][i]=!0}}return h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay),void 0}}}function updateCellCssStylesOnRenderedRows(t,e){var i,n,s,o;for(var a in rowsCache){if(o=e&&e[a],s=t&&t[a],o)for(n in o)s&&o[n]==s[n]||(i=getCellNode(a,getColumnIndex(n)),i&&$(i).removeClass(o[n]));if(s)for(n in s)o&&o[n]==s[n]||(i=getCellNode(a,getColumnIndex(n)),i&&$(i).addClass(s[n]))}}function addCellCssStyles(t,e){if(cellCssClasses[t])throw"addCellCssStyles: cell CSS hash with key '"+t+"' already exists.";cellCssClasses[t]=e,updateCellCssStylesOnRenderedRows(e,null),trigger(self.onCellCssStylesChanged,{key:t,hash:e})}function removeCellCssStyles(t){cellCssClasses[t]&&(updateCellCssStylesOnRenderedRows(null,cellCssClasses[t]),delete cellCssClasses[t],trigger(self.onCellCssStylesChanged,{key:t,hash:null}))}function setCellCssStyles(t,e){var i=cellCssClasses[t];cellCssClasses[t]=e,updateCellCssStylesOnRenderedRows(e,i),trigger(self.onCellCssStylesChanged,{key:t,hash:e})}function getCellCssStyles(t){return cellCssClasses[t]}function flashCell(t,e,i){function n(t){t&&setTimeout(function(){s.queue(function(){s.toggleClass(options.cellFlashingCssClass).dequeue(),n(t-1)})},i)}if(i=i||100,rowsCache[t]){var s=$(getCellNode(t,e));n(4)}}function handleDragInit(t,e){var i=getCellFromEvent(t);if(!i||!cellExists(i.row,i.cell))return!1;var n=trigger(self.onDragInit,e,t);return t.isImmediatePropagationStopped()?n:!1}function handleDragStart(t,e){var i=getCellFromEvent(t);if(!i||!cellExists(i.row,i.cell))return!1;var n=trigger(self.onDragStart,e,t);return t.isImmediatePropagationStopped()?n:!1}function handleDrag(t,e){return trigger(self.onDrag,e,t)}function handleDragEnd(t,e){trigger(self.onDragEnd,e,t)}function handleKeyDown(t){trigger(self.onKeyDown,{row:activeRow,cell:activeCell},t);var e=t.isImmediatePropagationStopped();if(!e)if(t.shiftKey||t.altKey||t.ctrlKey)9!=t.which||!t.shiftKey||t.ctrlKey||t.altKey||(e=navigatePrev());else if(27==t.which){if(!getEditorLock().isActive())return;cancelEditAndSetFocus()}else 34==t.which?(navigatePageDown(),e=!0):33==t.which?(navigatePageUp(),e=!0):37==t.which?e=navigateLeft():39==t.which?e=navigateRight():38==t.which?e=navigateUp():40==t.which?e=navigateDown():9==t.which?e=navigateNext():13==t.which&&(options.editable&&(currentEditor?activeRow===getDataLength()?navigateDown():commitEditAndSetFocus():getEditorLock().commitCurrentEdit()&&makeActiveCellEditable()),e=!0);if(e){t.stopPropagation(),t.preventDefault();try{t.originalEvent.keyCode=0}catch(i){}}}function handleClick(t){currentEditor||(t.target!=document.activeElement||$(t.target).hasClass("slick-cell"))&&setFocus();var e=getCellFromEvent(t);!e||null!==currentEditor&&activeRow==e.row&&activeCell==e.cell||(trigger(self.onClick,{row:e.row,cell:e.cell},t),t.isImmediatePropagationStopped()||activeCell==e.cell&&activeRow==e.row||!canCellBeActive(e.row,e.cell)||(!getEditorLock().isActive()||getEditorLock().commitCurrentEdit())&&(scrollRowIntoView(e.row,!1),setActiveCellInternal(getCellNode(e.row,e.cell))))}function handleContextMenu(t){var e=$(t.target).closest(".slick-cell",$canvas);0!==e.length&&(activeCellNode!==e[0]||null===currentEditor)&&trigger(self.onContextMenu,{},t)}function handleDblClick(t){var e=getCellFromEvent(t);!e||null!==currentEditor&&activeRow==e.row&&activeCell==e.cell||(trigger(self.onDblClick,{row:e.row,cell:e.cell},t),t.isImmediatePropagationStopped()||options.editable&&gotoCell(e.row,e.cell,!0))}function handleHeaderMouseEnter(t){trigger(self.onHeaderMouseEnter,{column:$(this).data("column")},t)}function handleHeaderMouseLeave(t){trigger(self.onHeaderMouseLeave,{column:$(this).data("column")},t)}function handleHeaderContextMenu(t){var e=$(t.target).closest(".slick-header-column",".slick-header-columns"),i=e&&e.data("column");trigger(self.onHeaderContextMenu,{column:i},t)}function handleHeaderClick(t){var e=$(t.target).closest(".slick-header-column",".slick-header-columns"),i=e&&e.data("column");i&&trigger(self.onHeaderClick,{column:i},t)}function handleMouseEnter(t){trigger(self.onMouseEnter,{},t)}function handleMouseLeave(t){trigger(self.onMouseLeave,{},t)}function cellExists(t,e){return!(0>t||t>=getDataLength()||0>e||e>=columns.length)}function getCellFromPoint(t,e){for(var i=getRowFromPosition(e),n=0,s=0,o=0;o<columns.length&&t>s;o++)s+=columns[o].width,n++;return 0>n&&(n=0),{row:i,cell:n-1}}function getCellFromNode(t){var e=/l\d+/.exec(t.className);if(!e)throw"getCellFromNode: cannot get cell - "+t.className;return parseInt(e[0].substr(1,e[0].length-1),10)}function getRowFromNode(t){for(var e in rowsCache)if(rowsCache[e].rowNode===t)return 0|e;return null}function getCellFromEvent(t){var e=$(t.target).closest(".slick-cell",$canvas);if(!e.length)return null;var i=getRowFromNode(e[0].parentNode),n=getCellFromNode(e[0]);return null==i||null==n?null:{row:i,cell:n}}function getCellNodeBox(t,e){if(!cellExists(t,e))return null;for(var i=getRowTop(t),n=i+options.rowHeight-1,s=0,o=0;e>o;o++)s+=columns[o].width;var a=s+columns[e].width;return{top:i,left:s,bottom:n,right:a}}function resetActiveCell(){setActiveCellInternal(null,!1)}function setFocus(){-1==tabbingDirection?$focusSink[0].focus():$focusSink2[0].focus()}function scrollCellIntoView(t,e,i){scrollRowIntoView(t,i);var n=getColspan(t,e),s=columnPosLeft[e],o=columnPosRight[e+(n>1?n-1:0)],a=scrollLeft+viewportW;scrollLeft>s?($viewport.scrollLeft(s),handleScroll(),render()):o>a&&($viewport.scrollLeft(Math.min(s,o-$viewport[0].clientWidth)),handleScroll(),render())}function setActiveCellInternal(t,e){null!==activeCellNode&&(makeActiveCellNormal(),$(activeCellNode).removeClass("active"),rowsCache[activeRow]&&$(rowsCache[activeRow].rowNode).removeClass("active"));var i=activeCellNode!==t;activeCellNode=t,null!=activeCellNode?(activeRow=getRowFromNode(activeCellNode.parentNode),activeCell=activePosX=getCellFromNode(activeCellNode),null==e&&(e=activeRow==getDataLength()||options.autoEdit),$(activeCellNode).addClass("active"),$(rowsCache[activeRow].rowNode).addClass("active"),options.editable&&e&&isCellPotentiallyEditable(activeRow,activeCell)&&(clearTimeout(h_editorLoader),options.asyncEditorLoading?h_editorLoader=setTimeout(function(){makeActiveCellEditable()},options.asyncEditorLoadDelay):makeActiveCellEditable())):activeRow=activeCell=null,i&&trigger(self.onActiveCellChanged,getActiveCell())}function clearTextSelection(){if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(t){}else if(window.getSelection){var e=window.getSelection();e&&e.removeAllRanges&&e.removeAllRanges()}}function isCellPotentiallyEditable(t,e){return t<getDataLength()&&!getDataItem(t)?!1:columns[e].cannotTriggerInsert&&t>=getDataLength()?!1:getEditor(t,e)?!0:!1}function makeActiveCellNormal(){if(currentEditor){if(trigger(self.onBeforeCellEditorDestroy,{editor:currentEditor}),currentEditor.destroy(),currentEditor=null,activeCellNode){var t=getDataItem(activeRow);if($(activeCellNode).removeClass("editable invalid"),t){var e=columns[activeCell],i=getFormatter(activeRow,e);activeCellNode.innerHTML=i(activeRow,activeCell,getDataItemValueForColumn(t,e),e,t),invalidatePostProcessingResults(activeRow)}}navigator.userAgent.toLowerCase().match(/msie/)&&clearTextSelection(),getEditorLock().deactivate(editController)}}function makeActiveCellEditable(t){if(activeCellNode){if(!options.editable)throw"Grid : makeActiveCellEditable : should never get called when options.editable is false";if(clearTimeout(h_editorLoader),isCellPotentiallyEditable(activeRow,activeCell)){var e=columns[activeCell],i=getDataItem(activeRow);if(trigger(self.onBeforeEditCell,{row:activeRow,cell:activeCell,item:i,column:e})===!1)return setFocus(),void 0;getEditorLock().activate(editController),$(activeCellNode).addClass("editable"),t||(activeCellNode.innerHTML=""),currentEditor=new(t||getEditor(activeRow,activeCell))({grid:self,gridPosition:absBox($container[0]),position:absBox(activeCellNode),container:activeCellNode,column:e,item:i||{},commitChanges:commitEditAndSetFocus,cancelChanges:cancelEditAndSetFocus}),i&&currentEditor.loadValue(i),serializedEditorValue=currentEditor.serializeValue(),currentEditor.position&&handleActiveCellPositionChange()}}}function commitEditAndSetFocus(){getEditorLock().commitCurrentEdit()&&(setFocus(),options.autoEdit&&navigateDown())}function cancelEditAndSetFocus(){getEditorLock().cancelCurrentEdit()&&setFocus()}function absBox(t){var e={top:t.offsetTop,left:t.offsetLeft,bottom:0,right:0,width:$(t).outerWidth(),height:$(t).outerHeight(),visible:!0};e.bottom=e.top+e.height,e.right=e.left+e.width;for(var i=t.offsetParent;(t=t.parentNode)!=document.body;)e.visible&&t.scrollHeight!=t.offsetHeight&&"visible"!=$(t).css("overflowY")&&(e.visible=e.bottom>t.scrollTop&&e.top<t.scrollTop+t.clientHeight),e.visible&&t.scrollWidth!=t.offsetWidth&&"visible"!=$(t).css("overflowX")&&(e.visible=e.right>t.scrollLeft&&e.left<t.scrollLeft+t.clientWidth),e.left-=t.scrollLeft,e.top-=t.scrollTop,t===i&&(e.left+=t.offsetLeft,e.top+=t.offsetTop,i=t.offsetParent),e.bottom=e.top+e.height,e.right=e.left+e.width;return e}function getActiveCellPosition(){return absBox(activeCellNode)}function getGridPosition(){return absBox($container[0])}function handleActiveCellPositionChange(){if(activeCellNode&&(trigger(self.onActiveCellPositionChanged,{}),currentEditor)){var t=getActiveCellPosition();currentEditor.show&&currentEditor.hide&&(t.visible?currentEditor.show():currentEditor.hide()),currentEditor.position&&currentEditor.position(t)}}function getCellEditor(){return currentEditor}function getActiveCell(){return activeCellNode?{row:activeRow,cell:activeCell}:null}function getActiveCellNode(){return activeCellNode}function scrollRowIntoView(t,e){var i=t*options.rowHeight,n=(t+1)*options.rowHeight-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0);(t+1)*options.rowHeight>scrollTop+viewportH+offset?(scrollTo(e?i:n),render()):t*options.rowHeight<scrollTop+offset&&(scrollTo(e?n:i),render())}function scrollRowToTop(t){scrollTo(t*options.rowHeight),render()}function scrollPage(t){var e=t*numVisibleRows;if(scrollTo((getRowFromPosition(scrollTop)+e)*options.rowHeight),render(),options.enableCellNavigation&&null!=activeRow){var i=activeRow+e;i>=getDataLengthIncludingAddNew()&&(i=getDataLengthIncludingAddNew()-1),0>i&&(i=0);for(var n=0,s=null,o=activePosX;activePosX>=n;)canCellBeActive(i,n)&&(s=n),n+=getColspan(i,n);null!==s?(setActiveCellInternal(getCellNode(i,s)),activePosX=o):resetActiveCell()}}function navigatePageDown(){scrollPage(1)}function navigatePageUp(){scrollPage(-1)}function getColspan(t,e){var i=data.getItemMetadata&&data.getItemMetadata(t);if(!i||!i.columns)return 1;var n=i.columns[columns[e].id]||i.columns[e],s=n&&n.colspan;return s="*"===s?columns.length-e:s||1}function findFirstFocusableCell(t){for(var e=0;e<columns.length;){if(canCellBeActive(t,e))return e;e+=getColspan(t,e)}return null}function findLastFocusableCell(t){for(var e=0,i=null;e<columns.length;)canCellBeActive(t,e)&&(i=e),e+=getColspan(t,e);return i}function gotoRight(t,e){if(e>=columns.length)return null;do e+=getColspan(t,e);while(e<columns.length&&!canCellBeActive(t,e));return e<columns.length?{row:t,cell:e,posX:e}:null}function gotoLeft(t,e){if(0>=e)return null;var i=findFirstFocusableCell(t);if(null===i||i>=e)return null;for(var n,s={row:t,cell:i,posX:i};;){if(n=gotoRight(s.row,s.cell,s.posX),!n)return null;if(n.cell>=e)return s;s=n}}function gotoDown(t,e,i){for(var n;;){if(++t>=getDataLengthIncludingAddNew())return null;for(n=e=0;i>=e;)n=e,e+=getColspan(t,e);if(canCellBeActive(t,n))return{row:t,cell:n,posX:i}}}function gotoUp(t,e,i){for(var n;;){if(--t<0)return null;for(n=e=0;i>=e;)n=e,e+=getColspan(t,e);if(canCellBeActive(t,n))return{row:t,cell:n,posX:i}}}function gotoNext(t,e,i){if(null==t&&null==e&&(t=e=i=0,canCellBeActive(t,e)))return{row:t,cell:e,posX:e};var n=gotoRight(t,e,i);if(n)return n;for(var s=null;++t<getDataLengthIncludingAddNew();)if(s=findFirstFocusableCell(t),null!==s)return{row:t,cell:s,posX:s};return null}function gotoPrev(t,e,i){if(null==t&&null==e&&(t=getDataLengthIncludingAddNew()-1,e=i=columns.length-1,canCellBeActive(t,e)))return{row:t,cell:e,posX:e};for(var n,s;!n&&!(n=gotoLeft(t,e,i));){if(--t<0)return null;e=0,s=findLastFocusableCell(t),null!==s&&(n={row:t,cell:s,posX:s})}return n}function navigateRight(){return navigate("right")}function navigateLeft(){return navigate("left")}function navigateDown(){return navigate("down")}function navigateUp(){return navigate("up")}function navigateNext(){return navigate("next")}function navigatePrev(){return navigate("prev")}function navigate(t){if(!options.enableCellNavigation)return!1;if(!activeCellNode&&"prev"!=t&&"next"!=t)return!1;if(!getEditorLock().commitCurrentEdit())return!0;setFocus();var e={up:-1,down:1,left:-1,right:1,prev:-1,next:1};tabbingDirection=e[t];var i={up:gotoUp,down:gotoDown,left:gotoLeft,right:gotoRight,prev:gotoPrev,next:gotoNext},n=i[t],s=n(activeRow,activeCell,activePosX);if(s){var o=s.row==getDataLength();return scrollCellIntoView(s.row,s.cell,!o),setActiveCellInternal(getCellNode(s.row,s.cell)),activePosX=s.posX,!0}return setActiveCellInternal(getCellNode(activeRow,activeCell)),!1}function getCellNode(t,e){return rowsCache[t]?(ensureCellNodesInRowsCache(t),rowsCache[t].cellNodesByColumnIdx[e]):null}function setActiveCell(t,e){initialized&&(t>getDataLength()||0>t||e>=columns.length||0>e||options.enableCellNavigation&&(scrollCellIntoView(t,e,!1),setActiveCellInternal(getCellNode(t,e),!1)))}function canCellBeActive(t,e){if(!options.enableCellNavigation||t>=getDataLengthIncludingAddNew()||0>t||e>=columns.length||0>e)return!1;var i=data.getItemMetadata&&data.getItemMetadata(t);if(i&&"boolean"==typeof i.focusable)return i.focusable;var n=i&&i.columns;return n&&n[columns[e].id]&&"boolean"==typeof n[columns[e].id].focusable?n[columns[e].id].focusable:n&&n[e]&&"boolean"==typeof n[e].focusable?n[e].focusable:columns[e].focusable}function canCellBeSelected(t,e){if(t>=getDataLength()||0>t||e>=columns.length||0>e)return!1;var i=data.getItemMetadata&&data.getItemMetadata(t);if(i&&"boolean"==typeof i.selectable)return i.selectable;var n=i&&i.columns&&(i.columns[columns[e].id]||i.columns[e]);return n&&"boolean"==typeof n.selectable?n.selectable:columns[e].selectable}function gotoCell(t,e,i){if(initialized&&canCellBeActive(t,e)&&getEditorLock().commitCurrentEdit()){scrollCellIntoView(t,e,!1);var n=getCellNode(t,e);setActiveCellInternal(n,i||t===getDataLength()||options.autoEdit),currentEditor||setFocus()}}function commitCurrentEdit(){var t=getDataItem(activeRow),e=columns[activeCell];if(currentEditor){if(currentEditor.isValueChanged()){var i=currentEditor.validate();if(i.valid){if(activeRow<getDataLength()){var n={row:activeRow,cell:activeCell,editor:currentEditor,serializedValue:currentEditor.serializeValue(),prevSerializedValue:serializedEditorValue,execute:function(){this.editor.applyValue(t,this.serializedValue),updateRow(this.row)},undo:function(){this.editor.applyValue(t,this.prevSerializedValue),updateRow(this.row)}};options.editCommandHandler?(makeActiveCellNormal(),options.editCommandHandler(t,e,n)):(n.execute(),makeActiveCellNormal()),trigger(self.onCellChange,{row:activeRow,cell:activeCell,item:t})}else{var s={};currentEditor.applyValue(s,currentEditor.serializeValue()),makeActiveCellNormal(),trigger(self.onAddNewRow,{item:s,column:e})}return!getEditorLock().isActive()}return $(activeCellNode).removeClass("invalid"),$(activeCellNode).width(),$(activeCellNode).addClass("invalid"),trigger(self.onValidationError,{editor:currentEditor,cellNode:activeCellNode,validationResults:i,row:activeRow,cell:activeCell,column:e}),currentEditor.focus(),!1}makeActiveCellNormal()}return!0}function cancelCurrentEdit(){return makeActiveCellNormal(),!0}function rowsToRanges(t){for(var e=[],i=columns.length-1,n=0;n<t.length;n++)e.push(new Slick.Range(t[n],0,t[n],i));return e}function getSelectedRows(){if(!selectionModel)throw"Selection model is not set";return selectedRows}function setSelectedRows(t){if(!selectionModel)throw"Selection model is not set";selectionModel.setSelectedRanges(rowsToRanges(t))}var defaults={explicitInitialization:!1,rowHeight:25,defaultColumnWidth:80,enableAddRow:!1,leaveSpaceForNewRows:!1,editable:!1,autoEdit:!0,enableCellNavigation:!0,enableColumnReorder:!0,asyncEditorLoading:!1,asyncEditorLoadDelay:100,forceFitColumns:!1,enableAsyncPostRender:!1,asyncPostRenderDelay:50,autoHeight:!1,editorLock:Slick.GlobalEditorLock,showHeaderRow:!1,headerRowHeight:25,showTopPanel:!1,topPanelHeight:25,formatterFactory:null,editorFactory:null,cellFlashingCssClass:"flashing",selectedCellCssClass:"selected",multiSelect:!0,enableTextSelectionOnCells:!1,dataItemColumnValueExtractor:null,fullWidthRows:!1,multiColumnSort:!1,defaultFormatter:defaultFormatter,forceSyncScrolling:!1},columnDefaults={name:"",resizable:!0,sortable:!1,minWidth:30,rerenderOnResize:!1,headerCssClass:null,defaultSortAsc:!0,focusable:!0,selectable:!0},th,h,ph,n,cj,page=0,offset=0,vScrollDir=1,initialized=!1,$container,uid="slickgrid_"+Math.round(1e6*Math.random()),self=this,$focusSink,$focusSink2,$headerScroller,$headers,$headerRow,$headerRowScroller,$headerRowSpacer,$topPanelScroller,$topPanel,$viewport,$canvas,$style,$boundAncestors,stylesheet,columnCssRulesL,columnCssRulesR,viewportH,viewportW,canvasWidth,viewportHasHScroll,viewportHasVScroll,headerColumnWidthDiff=0,headerColumnHeightDiff=0,cellWidthDiff=0,cellHeightDiff=0,absoluteColumnMinWidth,numberOfRows=0,tabbingDirection=1,activePosX,activeRow,activeCell,activeCellNode=null,currentEditor=null,serializedEditorValue,editController,rowsCache={},renderedRows=0,numVisibleRows,prevScrollTop=0,scrollTop=0,lastRenderedScrollTop=0,lastRenderedScrollLeft=0,prevScrollLeft=0,scrollLeft=0,selectionModel,selectedRows=[],plugins=[],cellCssClasses={},columnsById={},sortColumns=[],columnPosLeft=[],columnPosRight=[],h_editorLoader=null,h_render=null,h_postrender=null,postProcessedRows={},postProcessToRow=null,postProcessFromRow=null,counter_rows_rendered=0,counter_rows_removed=0;this.debug=function(){var t="";t+="\ncounter_rows_rendered:  "+counter_rows_rendered,t+="\ncounter_rows_removed:  "+counter_rows_removed,t+="\nrenderedRows:  "+renderedRows,t+="\nnumVisibleRows:  "+numVisibleRows,t+="\nmaxSupportedCssHeight:  "+maxSupportedCssHeight,t+="\nn(umber of pages):  "+n,t+="\n(current) page:  "+page,t+="\npage height (ph):  "+ph,t+="\nvScrollDir:  "+vScrollDir,alert(t)},this.eval=function(expr){return eval(expr)},$.extend(this,{slickGridVersion:"2.1",onScroll:new Slick.Event,onSort:new Slick.Event,onHeaderMouseEnter:new Slick.Event,onHeaderMouseLeave:new Slick.Event,onHeaderContextMenu:new Slick.Event,onHeaderClick:new Slick.Event,onHeaderCellRendered:new Slick.Event,onBeforeHeaderCellDestroy:new Slick.Event,onHeaderRowCellRendered:new Slick.Event,onBeforeHeaderRowCellDestroy:new Slick.Event,onMouseEnter:new Slick.Event,onMouseLeave:new Slick.Event,onClick:new Slick.Event,onDblClick:new Slick.Event,onContextMenu:new Slick.Event,onKeyDown:new Slick.Event,onAddNewRow:new Slick.Event,onValidationError:new Slick.Event,onViewportChanged:new Slick.Event,onColumnsReordered:new Slick.Event,onColumnsResized:new Slick.Event,onCellChange:new Slick.Event,onBeforeEditCell:new Slick.Event,onBeforeCellEditorDestroy:new Slick.Event,onBeforeDestroy:new Slick.Event,onActiveCellChanged:new Slick.Event,onActiveCellPositionChanged:new Slick.Event,onDragInit:new Slick.Event,onDragStart:new Slick.Event,onDrag:new Slick.Event,onDragEnd:new Slick.Event,onSelectedRowsChanged:new Slick.Event,onCellCssStylesChanged:new Slick.Event,registerPlugin:registerPlugin,unregisterPlugin:unregisterPlugin,getColumns:getColumns,setColumns:setColumns,getColumnIndex:getColumnIndex,updateColumnHeader:updateColumnHeader,setSortColumn:setSortColumn,setSortColumns:setSortColumns,getSortColumns:getSortColumns,autosizeColumns:autosizeColumns,getOptions:getOptions,setOptions:setOptions,getData:getData,getDataLength:getDataLength,getDataItem:getDataItem,setData:setData,getSelectionModel:getSelectionModel,setSelectionModel:setSelectionModel,getSelectedRows:getSelectedRows,setSelectedRows:setSelectedRows,getContainerNode:getContainerNode,render:render,invalidate:invalidate,invalidateRow:invalidateRow,invalidateRows:invalidateRows,invalidateAllRows:invalidateAllRows,updateCell:updateCell,updateRow:updateRow,getViewport:getVisibleRange,getRenderedRange:getRenderedRange,resizeCanvas:resizeCanvas,updateRowCount:updateRowCount,scrollRowIntoView:scrollRowIntoView,scrollRowToTop:scrollRowToTop,scrollCellIntoView:scrollCellIntoView,getCanvasNode:getCanvasNode,focus:setFocus,getCellFromPoint:getCellFromPoint,getCellFromEvent:getCellFromEvent,getActiveCell:getActiveCell,setActiveCell:setActiveCell,getActiveCellNode:getActiveCellNode,getActiveCellPosition:getActiveCellPosition,resetActiveCell:resetActiveCell,editActiveCell:makeActiveCellEditable,getCellEditor:getCellEditor,getCellNode:getCellNode,getCellNodeBox:getCellNodeBox,canCellBeSelected:canCellBeSelected,canCellBeActive:canCellBeActive,navigatePrev:navigatePrev,navigateNext:navigateNext,navigateUp:navigateUp,navigateDown:navigateDown,navigateLeft:navigateLeft,navigateRight:navigateRight,navigatePageUp:navigatePageUp,navigatePageDown:navigatePageDown,gotoCell:gotoCell,getTopPanel:getTopPanel,setTopPanelVisibility:setTopPanelVisibility,setHeaderRowVisibility:setHeaderRowVisibility,getHeaderRow:getHeaderRow,getHeaderRowColumn:getHeaderRowColumn,getGridPosition:getGridPosition,flashCell:flashCell,addCellCssStyles:addCellCssStyles,setCellCssStyles:setCellCssStyles,removeCellCssStyles:removeCellCssStyles,getCellCssStyles:getCellCssStyles,init:finishInitialization,destroy:destroy,getEditorLock:getEditorLock,getEditController:getEditController}),init()
}$.extend(Slick,{Grid:SlickGrid});var scrollbarDimensions,maxSupportedCssHeight;return Slick}),define("_libs/grids/SlickGrid-master/slick.dataview",["jquery","_libs/grids/SlickGrid-master/slick.core"],function(t,e){function i(i){function n(){be=!0}function s(){be=!1,ie()}function o(t){we=t}function a(t){re=t}function r(t){t=t||0;for(var e,i=t,n=pe.length;n>i;i++){if(e=pe[i][ue],void 0===e)throw"Each data element must implement a unique 'id' property";fe[e]=i}}function l(){for(var t,e=0,i=pe.length;i>e;e++)if(t=pe[e][ue],void 0===t)throw"Each data element must implement a unique 'id' property"}function c(){return pe}function h(t,e){void 0!==e&&(ue=e),pe=Ce=t,fe={},r(),l(),ie()}function d(t){void 0!=t.pageSize&&(De=t.pageSize,Ie=De?Math.min(Ie,Math.max(0,Math.ceil(Pe/De)-1)):0),void 0!=t.pageNum&&(Ie=Math.min(t.pageNum,Math.max(0,Math.ceil(Pe/De)-1))),Oe.notify(u(),null,he),ie()}function u(){var t=De?Math.max(1,Math.ceil(Pe/De)):1;return{pageSize:De,pageNum:Ie,totalRows:Pe,totalPages:t}}function p(t,e){ye=e,ae=t,oe=null,e===!1&&pe.reverse(),pe.sort(t),e===!1&&pe.reverse(),fe={},r(),ie()}function m(t,e){ye=e,oe=t,ae=null;var i=Object.prototype.toString;Object.prototype.toString="function"==typeof t?t:function(){return this[t]},e===!1&&pe.reverse(),pe.sort(),Object.prototype.toString=i,e===!1&&pe.reverse(),fe={},r(),ie()}function f(){ae?p(ae,ye):oe&&m(oe,ye)}function g(t){ve=t,i.inlineFilters&&(le=Z(),ce=X()),ie()}function v(){return Ae}function _(n){i.groupItemMetadataProvider||(i.groupItemMetadataProvider=new e.Data.GroupItemMetadataProvider),Le=[],Me=[],n=n||[],Ae=n instanceof Array?n:[n];for(var s=0;s<Ae.length;s++){var o=Ae[s]=t.extend(!0,{},Te,Ae[s]);o.getterIsAFn="function"==typeof o.getter,o.compiledAccumulators=[];for(var a=o.aggregators.length;a--;)o.compiledAccumulators[a]=Y(o.aggregators[a]);Me[s]={}}ie()}function b(t,e,i){return null==t?(_([]),void 0):(_({getter:t,formatter:e,comparer:i}),void 0)}function y(t,e){if(!Ae.length)throw new Error("At least one grouping must be specified before calling setAggregators().");Ae[0].aggregators=t,Ae[0].aggregateCollapsed=e,_(Ae)}function w(t){return pe[t]}function x(t){return fe[t]}function C(){if(!ge){ge={};for(var t=0,e=me.length;e>t;t++)ge[me[t][ue]]=t}}function S(t){return C(),ge[t]}function T(t){return pe[fe[t]]}function A(t){var e=[];C();for(var i=0;i<t.length;i++){var n=ge[t[i]];null!=n&&(e[e.length]=n)}return e}function L(t){for(var e=[],i=0;i<t.length;i++)t[i]<me.length&&(e[e.length]=me[t[i]][ue]);return e}function M(t,e){if(void 0===fe[t]||t!==e[ue])throw"Invalid or non-matching id";pe[fe[t]]=e,_e||(_e={}),_e[t]=!0,ie()}function k(t,e){pe.splice(t,0,e),r(t),ie()}function D(t){pe.push(t),r(pe.length-1),ie()}function I(t){var e=fe[t];if(void 0===e)throw"Invalid id";delete fe[t],pe.splice(e,1),r(e),ie()}function P(){return me.length}function R(t){return me[t]}function E(t){var e=me[t];return void 0===e?null:e.__group?i.groupItemMetadataProvider.getGroupRowMetadata(e):e.__groupTotals?i.groupItemMetadataProvider.getTotalsRowMetadata(e):null}function O(t,e){if(null==t)for(var i=0;i<Ae.length;i++)Me[i]={},Ae[i].collapsed=e;else Me[t]={},Ae[t].collapsed=e;ie()}function j(t){O(t,!0)}function N(t){O(t,!1)}function F(t,e,i){Me[t][e]=Ae[t].collapsed^i,ie()}function B(){var t=Array.prototype.slice.call(arguments),e=t[0];1==t.length&&-1!=e.indexOf(ke)?F(e.split(ke).length-1,e,!0):F(t.length-1,t.join(ke),!0)}function U(){var t=Array.prototype.slice.call(arguments),e=t[0];1==t.length&&-1!=e.indexOf(ke)?F(e.split(ke).length-1,e,!1):F(t.length-1,t.join(ke),!1)}function z(){return Le}function V(t,i){for(var n,s,o,a=[],r=[],l=i?i.level+1:0,c=Ae[l],h=0,d=c.predefinedValues.length;d>h;h++)s=c.predefinedValues[h],n=r[s],n||(n=new e.Group,n.value=s,n.level=l,n.groupingKey=(i?i.groupingKey+ke:"")+s,a[a.length]=n,r[s]=n);for(var h=0,d=t.length;d>h;h++)o=t[h],s=c.getterIsAFn?c.getter(o):o[c.getter],n=r[s],n||(n=new e.Group,n.value=s,n.level=l,n.groupingKey=(i?i.groupingKey+ke:"")+s,a[a.length]=n,r[s]=n),n.rows[n.count++]=o;if(l<Ae.length-1)for(var h=0;h<a.length;h++)n=a[h],n.groups=V(n.rows,n);return a.sort(Ae[l].comparer),a}function H(t){for(var i,n=Ae[t.level],s=t.level==Ae.length,o=new e.GroupTotals,a=n.aggregators.length;a--;)i=n.aggregators[a],i.init(),n.compiledAccumulators[a].call(i,!s&&n.aggregateChildGroups?t.groups:t.rows),i.storeResult(o);o.group=t,t.totals=o}function $(t,e){e=e||0;for(var i,n=Ae[e],s=t.length;s--;)i=t[s],(!i.collapsed||n.aggregateCollapsed)&&(i.groups&&$(i.groups,e+1),n.aggregators.length&&(n.aggregateEmpty||i.rows.length||i.groups&&i.groups.length)&&H(i))}function W(t,e){e=e||0;for(var i,n=Ae[e],s=n.collapsed,o=Me[e],a=t.length;a--;)i=t[a],i.collapsed=s^o[i.groupingKey],i.title=n.formatter?n.formatter(i):i.value,i.groups&&(W(i.groups,e+1),i.rows=[])}function G(t,e){e=e||0;for(var i,n,s=Ae[e],o=[],a=0,r=0,l=t.length;l>r;r++){if(n=t[r],o[a++]=n,!n.collapsed){i=n.groups?G(n.groups,e+1):n.rows;for(var c=0,h=i.length;h>c;c++)o[a++]=i[c]}n.totals&&s.displayTotalsRow&&(!n.collapsed||s.aggregateCollapsed)&&(o[a++]=n.totals)}return o}function q(t){var e=/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/,i=t.toString().match(e);return{params:i[1].split(","),body:i[2]}}function Y(t){var e=q(t.accumulate),i=new Function("_items","for (var "+e.params[0]+", _i=0, _il=_items.length; _i<_il; _i++) {"+e.params[0]+" = _items[_i]; "+e.body+"}");return i.displayName=i.name="compiledAccumulatorLoop",i}function Z(){var t=q(ve),e=t.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _retval[_idx++] = $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ($1) { _retval[_idx++] = $item$; }; continue _coreloop; }$2"),i=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","$filter$; ","} ","return _retval; "].join("");i=i.replace(/\$filter\$/gi,e),i=i.replace(/\$item\$/gi,t.params[0]),i=i.replace(/\$args\$/gi,t.params[1]);var n=new Function("_items,_args",i);return n.displayName=n.name="compiledFilter",n}function X(){var t=q(ve),e=t.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _cache[_i] = true;_retval[_idx++] = $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ((_cache[_i] = $1)) { _retval[_idx++] = $item$; }; continue _coreloop; }$2"),i=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","if (_cache[_i]) { ","_retval[_idx++] = $item$; ","continue _coreloop; ","} ","$filter$; ","} ","return _retval; "].join("");i=i.replace(/\$filter\$/gi,e),i=i.replace(/\$item\$/gi,t.params[0]),i=i.replace(/\$args\$/gi,t.params[1]);var n=new Function("_items,_args,_cache",i);return n.displayName=n.name="compiledFilterWithCaching",n}function K(t,e){for(var i=[],n=0,s=0,o=t.length;o>s;s++)ve(t[s],e)&&(i[n++]=t[s]);return i}function J(t,e,i){for(var n,s=[],o=0,a=0,r=t.length;r>a;a++)n=t[a],i[a]?s[o++]=n:ve(n,e)&&(s[o++]=n,i[a]=!0);return s}function Q(t){if(ve){var e=i.inlineFilters?le:K,n=i.inlineFilters?ce:J;we.isFilterNarrowing?Ce=e(Ce,re):we.isFilterExpanding?Ce=n(t,re,Se):we.isFilterUnchanged||(Ce=e(t,re))}else Ce=De?t:t.concat();var s;return De?(Ce.length<Ie*De&&(Ie=Math.floor(Ce.length/De)),s=Ce.slice(De*Ie,De*Ie+De)):s=Ce,{totalRows:Ce.length,rows:s}}function te(t,e){var i,n,s,o=[],a=0,r=e.length;we&&we.ignoreDiffsBefore&&(a=Math.max(0,Math.min(e.length,we.ignoreDiffsBefore))),we&&we.ignoreDiffsAfter&&(r=Math.min(e.length,Math.max(0,we.ignoreDiffsAfter)));for(var l=a,c=t.length;r>l;l++)l>=c?o[o.length]=l:(i=e[l],n=t[l],(Ae.length&&(s=i.__nonDataRow||n.__nonDataRow)&&i.__group!==n.__group||i.__group&&!i.equals(n)||s&&(i.__groupTotals||n.__groupTotals)||i[ue]!=n[ue]||_e&&_e[i[ue]])&&(o[o.length]=l));return o}function ee(t){ge=null,(we.isFilterNarrowing!=xe.isFilterNarrowing||we.isFilterExpanding!=xe.isFilterExpanding)&&(Se=[]);var e=Q(t);Pe=e.totalRows;var i=e.rows;Le=[],Ae.length&&(Le=V(i),Le.length&&($(Le),W(Le),i=G(Le)));var n=te(me,i);return me=i,n}function ie(){if(!be){var t=me.length,e=Pe,i=ee(pe,ve);De&&Ie*De>Pe&&(Ie=Math.max(0,Math.ceil(Pe/De)-1),i=ee(pe,ve)),_e=null,xe=we,we={},e!=Pe&&Oe.notify(u(),null,he),t!=me.length&&Re.notify({previous:t,current:me.length},null,he),i.length>0&&Ee.notify({rows:i},null,he)}}function ne(t,e){function i(){if(o.length>0){n=!0;var i=s.mapIdsToRows(o);e||(o=s.mapRowsToIds(i)),t.setSelectedRows(i),n=!1}}var n,s=this,o=s.mapRowsToIds(t.getSelectedRows());t.onSelectedRowsChanged.subscribe(function(){n||(o=s.mapRowsToIds(t.getSelectedRows()))}),this.onRowsChanged.subscribe(i),this.onRowCountChanged.subscribe(i)}function se(t,e){function i(t){s={};for(var e in t){var i=me[e][ue];s[i]=t[e]}}function n(){if(s){o=!0,C();var i={};for(var n in s){var a=ge[n];void 0!=a&&(i[a]=s[n])}t.setCellCssStyles(e,i),o=!1}}var s,o;i(t.getCellCssStyles(e)),t.onCellCssStylesChanged.subscribe(function(t,n){o||e==n.key&&n.hash&&i(n.hash)}),this.onRowsChanged.subscribe(n),this.onRowCountChanged.subscribe(n)}var oe,ae,re,le,ce,he=this,de={groupItemMetadataProvider:null,inlineFilters:!1},ue="undefined"==typeof i.idProperty?"id":i.idProperty,pe=[],me=[],fe={},ge=null,ve=null,_e=null,be=!1,ye=!0,we={},xe={},Ce=[],Se=[],Te={getter:null,formatter:null,comparer:function(t,e){return t.value-e.value},predefinedValues:[],aggregators:[],aggregateEmpty:!1,aggregateCollapsed:!1,aggregateChildGroups:!1,collapsed:!1,displayTotalsRow:!0},Ae=[],Le=[],Me=[],ke=":|:",De=0,Ie=0,Pe=0,Re=new e.Event,Ee=new e.Event,Oe=new e.Event;i=t.extend(!0,{},de,i),t.extend(this,{beginUpdate:n,endUpdate:s,setPagingOptions:d,getPagingInfo:u,getItems:c,setItems:h,setFilter:g,sort:p,fastSort:m,reSort:f,setGrouping:_,getGrouping:v,groupBy:b,setAggregators:y,collapseAllGroups:j,expandAllGroups:N,collapseGroup:B,expandGroup:U,getGroups:z,getIdxById:x,getRowById:S,getItemById:T,getItemByIdx:w,mapRowsToIds:L,mapIdsToRows:A,setRefreshHints:o,setFilterArgs:a,refresh:ie,updateItem:M,insertItem:k,addItem:D,deleteItem:I,syncGridSelection:ne,syncGridCellCssStyles:se,getLength:P,getItem:R,getItemMetadata:E,onRowCountChanged:Re,onRowsChanged:Ee,onPagingInfoChanged:Oe})}function n(t){this.field_=t,this.init=function(){this.count_=0,this.nonNullCount_=0,this.sum_=0},this.accumulate=function(t){var e=t[this.field_];this.count_++,null!=e&&""!==e&&0/0!==e&&(this.nonNullCount_++,this.sum_+=parseFloat(e))},this.storeResult=function(t){t.avg||(t.avg={}),0!=this.nonNullCount_&&(t.avg[this.field_]=this.sum_/this.nonNullCount_)}}function s(t){this.field_=t,this.init=function(){this.min_=null},this.accumulate=function(t){var e=t[this.field_];null!=e&&""!==e&&0/0!==e&&(null==this.min_||e<this.min_)&&(this.min_=e)},this.storeResult=function(t){t.min||(t.min={}),t.min[this.field_]=this.min_}}function o(t){this.field_=t,this.init=function(){this.max_=null},this.accumulate=function(t){var e=t[this.field_];null!=e&&""!==e&&0/0!==e&&(null==this.max_||e>this.max_)&&(this.max_=e)},this.storeResult=function(t){t.max||(t.max={}),t.max[this.field_]=this.max_}}function a(t){this.field_=t,this.init=function(){this.sum_=null},this.accumulate=function(t){var e=t[this.field_];null!=e&&""!==e&&0/0!==e&&(this.sum_+=parseFloat(e))},this.storeResult=function(t){t.sum||(t.sum={}),t.sum[this.field_]=this.sum_}}return t.extend(e,{Data:{DataView:i,Aggregators:{Avg:n,Min:s,Max:o,Sum:a}}}),e}),define("_libs/charts/jqChart/src/js/jquery.jqChart.dev",["jquery"],function(t){!function(e){function i(t){this.callback=t,this.animations=[]}function n(t){function e(){n?(i(),Te(e),s=!0,n=!1):s=!1}var i=t,n=!1,s=!1;this.kick=function(){n=!0,s||e()},this.end=function(t){var e=i;t&&(s?(i=n?function(){e(),t()}:t,n=!0):t())}}function s(t,e,i,n,s){defaults={enabled:!0,delayTime:0,duration:2},t&&(this.enabled=!(t.enabled===!1),this.delayTime=t.delayTime||0,this.duration=t.duration||2,this.from=n,this.to=s,this.object=e,this.option=i)}function o(t,e,i,n,o){s.call(this,t,e,i,n,o)}function a(t){this.view=t}function r(t){a.call(this,t)}function l(t){t&&(this.shapes=[],this.mouseDownTools=[],this.mouseMoveTools=[],this.touchStartTools=[],this.touchMoveTools=[],this.defaultTool=new r(this),this.currentTool=this.defaultTool,this._createElements(t))}function c(t){this.defaults={location:"left",labels:{visible:!0,fillStyle:"black",lineWidth:1,font:"11px sans-serif",position:"outside",showLastLabel:!0,showFirstLabel:!0,hAlign:"center",vAlign:"center"},bands:null,title:{text:void 0,font:"14px sans-serif",margin:2},strokeStyle:"black",lineWidth:1,margin:5,visible:!0,reversed:!1,zoomEnabled:!1},this._initDefs(t),this.setOptions(t)}function h(){}function d(){}function u(){this.fillStyle="black",this.strokeStyle="black",this.lineWidth=1,this.lineCap="butt",this.lineJoin="miter",this.miterLimit=10,this.visible=!0,this.shadowColor="rgba(0, 0, 0, 0)",this.shadowBlur=0,this.shadowOffsetX=0,this.shadowOffsetY=0}function p(t,e,i,n){u.call(this),this.x1=t,this.y1=e,this.x2=i,this.y2=n,this.useHitTestArea=!0}function m(t,e,i,n){u.call(this),this.x=t,this.y=e,this.width=i,this.height=n,this.cornerRadius=0}function f(t,e,i,n){u.call(this),this.x=t,this.y=e,this.width=i,this.height=n}function g(t,e,i,n,s){u.call(this),this.x=t,this.y=e,this.radius=i,this.startAngle=n,this.endAngle=s,this.width=this.height=2*i}function v(t,e,i){u.call(this),this.x=t,this.y=e,this.radius=i,this.width=this.height=2*i}function _(t,e,i,n,s){u.call(this),this.x=t,this.y=e,this.radius=i,this.startAngle=n,this.endAngle=s,this.width=this.height=2*i;var o=(n+s)/2,a=t+i*Math.cos(o),r=e+i*Math.sin(o);this.center=this.tooltipOrigin={x:a,y:r}}function b(){u.call(this)}function y(t,e,i){b.call(this),this.pts=t,this.closed=i,e&&(this.isBoundsHitTest=e,this.calculateBounds(t))}function w(t,e){b.call(this),t&&(this.closed=e,this.pts=t,this.calculateBounds(t))}function x(t,i,n,s){if(b.call(this),this.pts=t,this.crossPos=i,this.vertical=n||!1,this.isCurve=s||!1,t&&t.length>=2){var o=[];e.merge(o,t),n?e.merge(o,[i,t[t.length-1],i,t[1]]):e.merge(o,[t[t.length-2],i,t[0],i]),this.calculateBounds(o)}}function C(t,i,n,s){b.call(this),t&&(this.pts1=t,this.pts2=i,this.pts=[],e.merge(this.pts,t),s||e.merge(this.pts,h.reversePoints(i)),this.calculateBounds(this.pts),this.center=null,this.isCurve=n||!1)}function S(t){b.call(this),this.pts=t,this.calculateBounds(t)}function T(t,e,i){this.text=t,this.x=e,this.y=i,this.width=0,this.height=0,this.strokeStyle=null,this.textBaseline="middle",this.font="10px sans-serif",this.textAlign="left"}function A(t,e,i){this.x=t,this.y=e,this.src=i}function L(t){u.call(this),this.shapes=t}function M(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}function k(){}function D(t){this.renderShadows=t}function I(t,e){null==this.canvas&&(this.canvas=t,this.ctx=this._getContext(this.canvas)),this.chart=e}function P(t){this.defaults={text:"",font:"14px sans-serif",fillStyle:"black",lineWidth:0,margin:6},this.x=0,this.y=0,this.setOptions(t)}function R(t){var i=e.extend(!1,{},this.defaults,{hAlign:"left",vAlign:"top"});this.defaults=i,this.chart=t}function E(t){this.defaults={visible:!0,strokeStyle:"black",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,cornerRadius:10,padding:4},this.x=0,this.y=0,this.setOptions(t)}function O(t){this.defaults={strokeStyle:"black",lineWidth:1,length:6,position:"outside",visible:!0,zIndex:2,offset:.4},this.setOptions(t)}function j(t){r.call(this,t)}function N(t){a.call(this,t)}function F(t){a.call(this,t)}function B(t){a.call(this,t)}function U(t){this.pluginClass="ui-jqchart",this.tooltipClass="ui-jqchart-tooltip",l.call(this,t),this.timer=new n(e.proxy(this.partialUpdate,this)),this.storyboard=new i(e.proxy(this._renderShapes,this)),this.defaultTool=new j(this),this.currentTool=this.defaultTool,this.mouseDownTools.push(new F(this)),this.mouseDownTools.push(new N(this)),this.touchMoveTools.push(new B(this))}function z(t,e,i,n,s,o){u.call(this),this.high=e,this.low=i,this.open=n,this.close=s,this.x=t-o/2,this.width=o,this.height=Math.abs(e-i),this.y=Math.min(e,i),this.isUp=n>s,this.tooltipOrigin={x:t,y:Math.min(e,i)},this.center={x:t,y:(n+s)/2},this.createElements&&this.createElements(t,e,i,n,s,o)}function V(t,e,i,n,s,o){z.call(this,t,e,i,n,s,o)}function H(t){this.colorsDefault=["#418CF0","#FCB441","#E0400A","#056492","#BFBFBF","#1A3B69","#FFE382","#129CDD","#CA6B4B","#005CDB","#F3D288","#506381","#F1B9A8","#E0830A","#7893BE"],this.colorsGrayScale=$(),this.defaults={type:"default"},this.setOptions(t)}function $(){for(var t=16,e=[],i=0;t>i;i++){var n=200-11*i;n=n.toString();var s="rgb("+n+","+n+","+n+")";e.push(s)}return e}function W(t){this.chart=t,this.defaults={visibility:"auto",resetZoomTooltipText:"Reset Zoom (100%)",zoomingTooltipText:"Zoom in to selection area",panningTooltipText:"Pan the chart",hAlign:"right",vAlign:"top"}}function G(t){this.defaults={lineCap:"butt",lineJoin:"miter",miterLimit:10,lineWidth:1,size:8,offset:0,linkLineWidth:1,type:"circle"},this.setOptions(t)}function q(t){this.defaults={strokeStyle:"gray",lineWidth:1,visible:!0},this.setOptions(t)}function Y(t){this.defaults={strokeStyle:"gray",lineWidth:1,title:{margin:2,hAlign:"left",vAlign:"top"}},this.setOptions(t)}function Z(t){this.defaults={lineWidth:0,fillStyle:"gray",title:{margin:2,hAlign:"left",vAlign:"top"}},this.setOptions(t)}function X(t){this.defaults={location:"right",title:{text:void 0,margin:0},border:{padding:2,strokeStyle:"gray",cornerRadius:6},margin:4,visible:!0,font:"12px sans-serif",textLineWidth:0},this._itemMargin=4,this.setOptions(t)}function K(t){this.defaults={font:"12px sans-serif",textFillStyle:"black",textLineWidth:0},this.lblMargin=4,this.setOptions(t)}function J(t){this.chart=t,this.border=new E,this.border.cornerRadius=0,this.border.lineWidth=0,this.isMouseOver=!1}function Q(t,e){this.chart=t,e&&this.setOptions(e)}function te(t){this.setOptions(t)}function ee(t){var i=e.extend(!0,{},this.defaults,{lineWidth:2,markers:{},xValuesField:void 0,yValuesField:void 0});this.defaults=i,te.call(this,t)}function ie(t){var i=e.extend(!0,{},this.defaults,{lineWidth:0,markers:null});this.defaults=i,te.call(this,t)}function ne(t){ie.call(this,t)}function se(t){this.isVertical=!0,te.call(this,t)}function oe(t){te.call(this,t)}function ae(t){var i=e.extend(!0,{},this.defaults,{explodedRadius:10});this.defaults=i,te.call(this,t)}function re(t){var i=e.extend(!0,{},this.defaults,{markers:{type:"diamond"}});this.defaults=i,te.call(this,t)}function le(t){ee.call(this,t)}function ce(t){ee.call(this,t)}function he(t){var i=e.extend(!0,{},this.defaults,{lineWidth:0,markers:null});this.defaults=i,te.call(this,t)}function de(t){var i=e.extend(!0,{},this.defaults,{stackedGroupName:""});this.defaults=i,oe.call(this,t)}function ue(t){var i=e.extend(!0,{},this.defaults,{stackedGroupName:""});this.defaults=i,se.call(this,t)}function pe(t){de.call(this,t)}function me(t){ue.call(this,t)}function fe(t){oe.call(this,t)}function ge(t){se.call(this,t)}function ve(t){var i=e.extend(!0,{},this.defaults,{lineWidth:0,markers:null});this.defaults=i,te.call(this,t)}function _e(t){var i=e.extend(!0,{},this.defaults,{lineWidth:0,markers:null,xValuesField:void 0,fromValuesField:void 0,toValuesField:void 0});this.defaults=i,te.call(this,t)}function be(t,e){this.chart=t,e&&this.setOptions(e)}function ye(t){c.call(this,t)}function we(t){ye.call(this,t),this.DataType="CategoryAxis"}function xe(t){ye.call(this,t),this.DataType="LinearAxis"}function Ce(t){xe.call(this,t),this.DataType="DateTimeAxis"}function Se(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.superclass=e.prototype}e.fn.jqChart=function(t,i,n){if("object"==typeof t)i=t;else if("string"==typeof t){if(t=t.toLowerCase(),e.fn.jqChart.methods[t])return e.fn.jqChart.methods[t].call(this,i,n);e.error("Method "+method+" does not exist on jQuery.jqChart")}var s=this.data("data");return s||(s=new U(this),this.data("data",s)),s._processOptions(i),this},e.fn.jqChart.methods={chart:function(){return this.data("data")},destroy:function(){var t=this.data("data");t&&(t.destroy(),this.removeData("data"))},options:function(){var t=this.data("data");if(t)return t.options},option:function(t,e){var i=this.data("data");if(i){if(!e)return i.options[t];i.options[t]=e,i._processOptions(i.options)}},update:function(t){var i=this.data("data");if(!i)return this;var n=e.extend(!1,{},i.options,t||{});i._processOptions(n)},todataurl:function(t){var e=this.data("data");return e?e.toDataURL(t):null},highlightdata:function(t){var e=this.data("data");e&&e.highlightData(t)},ismouseover:function(){var t=this.data("data");return t?t.isMouseOver:!1},exporttoimage:function(t){var e=this.data("data");e&&e.exportToImage(t)},exporttopdf:function(t){var e=this.data("data");e&&e.exportToPdf(t)}},e.fn.jqChart.defaults={title:{margin:8,font:"22px sans-serif"},tooltips:{disabled:!1,type:"normal",borderColor:"auto",snapArea:25,highlighting:!0,highlightingFillStyle:"rgba(204, 204, 204, 0.5)",highlightingStrokeStyle:"rgba(204, 204, 204, 0.5)"},crosshairs:{enabled:!1,snapToDataPoints:!0,hLine:{visible:!0,strokeStyle:"red"},vLine:{visible:!0,strokeStyle:"red"}},globalAlpha:1,mouseInteractionMode:"panning",selectionRect:{fillStyle:"rgba(125,125,125,0.2)",strokeStyle:"gray",lineWidth:0},shadows:{enabled:!1,shadowColor:"#cccccc",shadowBlur:8,shadowOffsetX:2,shadowOffsetY:2},watermark:{hAlign:"right",vAlign:"bottom"},noDataMessage:{text:"No data available",font:"20px sans-serif"},exportConfig:{server:"http://www.jqchart.com/export/default.aspx",method:"post"}},e.fn.jqChart.labelFormatter=function(t,i){return t?e.jqChartSprintf(t,i):String(i)},e.fn.jqMouseCapture=function(t){var i=e(document);return this.each(function(){var n=e(this),s={};n.mousedown(function(e){var o;t.move&&(o=function(e){t.move.call(n,e,s)},i.mousemove(o));var a,r=function(){t.move&&i.unbind("mousemove",o),i.unbind("mouseup",a)};return a=t.up?function(e){return r(),t.up.call(n,e,s)}:r,i.mouseup(a),e.preventDefault(),t.down.call(n,e,s)})}),this},e.jqChartSprintf=function(){function t(t,e,i,n){var s=t.length>=e?"":Array(1+e-t.length>>>0).join(i);return n?t+s:s+t}function i(e,i,n,s,o){var a=s-e.length;return a>0&&(e=n||!o?t(e,s," ",n):e.slice(0,i.length)+t("",a,"0",!0)+e.slice(i.length)),e}function n(e,n,s,o,a,r,l){var c=e>>>0;return s=s&&c&&{2:"0b",8:"0",16:"0x"}[n]||"",e=s+t(c.toString(n),r||0,"0",!1),i(e,s,o,a,l)}function s(t,e,n,s,o){return null!=s&&(t=t.slice(0,s)),i(t,"",e,n,o)}var o=arguments,a=0,r=o[a++];return r.replace(e.jqChartSprintf.regex,function(e,r,l,c,h,d,u){if("%%"==e)return"%";for(var p=!1,m="",f=!1,g=!1,v=0;l&&v<l.length;v++)switch(l.charAt(v)){case" ":m=" ";break;case"+":m="+";break;case"-":p=!0;break;case"0":f=!0;break;case"#":g=!0}if(c=c?"*"==c?+o[a++]:"*"==c.charAt(0)?+o[c.slice(1,-1)]:+c:0,0>c&&(c=-c,p=!0),!isFinite(c))throw new Error("sprintf: (minimum-)width must be finite");d=d?"*"==d?+o[a++]:"*"==d.charAt(0)?+o[d.slice(1,-1)]:+d:"fFeE".indexOf(u)>-1?6:"d"==u?0:void 0;var _=r?o[r.slice(0,-1)]:o[a++];switch(u){case"s":return s(String(_),p,c,d,f);case"c":return s(String.fromCharCode(+_),p,c,d,f);case"b":return n(_,2,g,p,c,d,f);case"o":return n(_,8,g,p,c,d,f);case"x":return n(_,16,g,p,c,d,f);case"X":return n(_,16,g,p,c,d,f).toUpperCase();case"u":return n(_,10,g,p,c,d,f);case"i":case"d":var b=parseInt(+_),y=0>b?"-":m;return _=y+t(String(Math.abs(b)),d,"0",!1),i(_,y,p,c,f);case"e":case"E":case"f":case"F":case"g":case"G":var b=+_,y=0>b?"-":m,w=["toExponential","toFixed","toPrecision"]["efg".indexOf(u.toLowerCase())],x=["toString","toUpperCase"]["eEfFgG".indexOf(u)%2];return _=y+Math.abs(b)[w](d),i(_,y,p,c,f)[x]();default:return e}})},e.jqChartSprintf.regex=/%%|%(\d+\$)?([-+#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuidfegEG])/g,e.jqChartDateFormatter=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,s=function(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t};return function(o,a,r){var l=e.jqChartDateFormat,c=l.amPm;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(a=o,o=void 0),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");a=String(l.masks[a]||a||"ddd mmm dd yyyy HH:MM:ss"),"UTC:"==a.slice(0,4)&&(a=a.slice(4),r=!0);var h=r?"getUTC":"get",d=o[h+"Date"](),u=o[h+"Day"](),p=o[h+"Month"](),m=o[h+"FullYear"](),f=o[h+"Hours"](),g=o[h+"Minutes"](),v=o[h+"Seconds"](),_=o[h+"Milliseconds"](),b=r?0:o.getTimezoneOffset(),y={d:d,dd:s(d),ddd:l.dayNames[u],dddd:l.dayNames[u+7],m:p+1,mm:s(p+1),mmm:l.monthNames[p],mmmm:l.monthNames[p+12],yy:String(m).slice(2),yyyy:m,h:f%12||12,hh:s(f%12||12),H:f,HH:s(f),M:g,MM:s(g),s:v,ss:s(v),l:s(_,3),L:s(_>99?Math.round(_/10):_),t:12>f?c[0].charAt(0)||"":c[1].charAt(0)||"",tt:12>f?c[0]:c[1],T:12>f?c[2].charAt(0)||"":c[3].charAt(0)||"",TT:12>f?c[2]:c[3],Z:r?"UTC":(String(o).match(i)||[""]).pop().replace(n,""),o:(b>0?"-":"+")+s(100*Math.floor(Math.abs(b)/60)+Math.abs(b)%60,4),S:l.s(d)};return a.replace(t,function(t){return t in y?y[t]:t.slice(1,t.length-1)})}}(),e.jqChartDateFormat={masks:{shortDate:"m/d/yyyy",shortTime:"h:MM TT",longTime:"h:MM:ss TT"},dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],amPm:["am","pm","AM","PM"],s:function(t){return 11>t||t>13?["st","nd","rd","th"][Math.min((t-1)%10,3)]:"th"},monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},i.prototype={begin:function(){if(!l.use_excanvas){var t=this.animations;if(t&&0!=t.length){this.stopped=!1;for(var e=new Date,i=0;i<t.length;i++){var n=t[i];n.begin(e)}this.animate()}}},animate:function(){if(!this.stopped){for(var t=this.animations,i=new Date,n=!1,s=0;s<t.length;s++){var o=t[s],a=o.animate(i);n=n||a}n&&(this.callback(),Te(e.proxy(this.animate,this)))}},stop:function(){this.stopped=!0},clear:function(){this.animations=[]},addAnimation:function(t){this.animations.push(t)}};var Te=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(function(){t()},25)}}();s.prototype={begin:function(t){this.startTime=d.addSeconds(t,this.delayTime),this.endTime=d.addSeconds(this.startTime,this.duration),this.timeDiff=this.endTime.getTime()-this.startTime.getTime(),this.valueDiff=this.to-this.from,this.object[this.option]=this.from,this.lastIsSet=!1},animate:function(t){if(t>=this.endTime)return this.lastIsSet?!1:(this.object[this.option]=this.to,this.lastIsSet=!0,!0);if(t>this.startTime){var e=t.getTime()-this.startTime.getTime(),i=this.from+this.valueDiff*e/this.timeDiff;i===this.to&&(this.lastIsSet=!0),this.object[this.option]=i}return!0}},o.prototype=new s,o.constructor=o,o.prototype.begin=function(t){this.startTime=d.addSeconds(t,this.delayTime),this.endTime=d.addSeconds(this.startTime,this.duration),this.object[this.option]=this.from,this.lastIsSet=!1},o.prototype.animate=function(t){return t>=this.endTime?this.lastIsSet?!1:(this.object[this.option]=this.to,this.lastIsSet=!0,!0):!0},a.prototype={canStart:function(){return!1},start:function(){},keyDown:function(){},keyUp:function(){},mouseMove:function(){},mouseDown:function(){},mouseUp:function(){},touchStart:function(){},touchMove:function(){},touchEnd:function(){},mouseWheel:function(){},stop:function(){},stopTool:function(){this.view.currentTool==this&&this.view.setCurrentTool(null)}},r.prototype=new a,r.constructor=r,r.prototype.mouseDown=function(t){for(var e=this.view.mouseDownTools,i=0;i<e.length;i++){var n=e[i];if(n.canStart(t))return this.view.setCurrentTool(n),void 0}},r.prototype.mouseMove=function(t){for(var e=this.view.mouseMoveTools,i=0;i<e.length;i++){var n=e[i];if(n.canStart(t))return this.view.setCurrentTool(n),void 0}this.view._processMouseMove(t)},r.prototype.touchStart=function(t){for(var e=this.view.touchStartTools,i=0;i<e.length;i++){var n=e[i];if(n.canStart(t))return this.view.setCurrentTool(n),void 0}this.view._processTouchStart(t)},r.prototype.touchMove=function(t){for(var e=this.view.touchMoveTools,i=0;i<e.length;i++){var n=e[i];if(n.canStart(t))return this.view.setCurrentTool(n),void 0}this.view._processTouchMove(t)},l.setShadows=function(t,e,i){if(i){var n=i.options.shadows;t.shadowColor=h.isNull(e.shadowColor)?n.shadowColor:e.shadowColor,t.shadowBlur=h.isNull(e.shadowBlur)?n.shadowBlur:e.shadowBlur,t.shadowOffsetX=h.isNull(e.shadowOffsetX)?n.shadowOffsetX:e.shadowOffsetX,t.shadowOffsetY=h.isNull(e.shadowOffsetY)?n.shadowOffsetY:e.shadowOffsetY}},l.support_canvas=function(){return!!document.createElement("canvas").getContext},l.use_excanvas=l.support_canvas()?!1:!0,l.isTouchDevice=!!("ontouchstart"in window),l.isGestureDevice=!!("ongesturestart"in window),l.checkIfRetinaDisplay=function(){var t="(-webkit-min-device-pixel-ratio: 1.5),                      (min--moz-device-pixel-ratio: 1.5),                      (-o-min-device-pixel-ratio: 3/2),                      (min-resolution: 1.5dppx)";return window.devicePixelRatio>1?!0:window.matchMedia&&window.matchMedia(t).matches?!0:!1},l.isRetinaDisplay=l.checkIfRetinaDisplay(),l.prototype={_createElements:function(t){this.elem=t;var i=this;t.mouseenter(function(t){i._mouseEnter(t)}),t.mouseleave(function(t){i._mouseLeave(t)}),t.jqMouseCapture({down:e.proxy(i._mouseDown,this),move:e.proxy(i._mouseMove,this),up:e.proxy(i._mouseUp,this)}),t.mousemove(function(t){i.isMouseDown||i._mouseMove(t)}),t.keydown(function(t){i._keyDown(t)}),t.keyup(function(t){i._keyUp(t)}),t.resize(function(){i._resize()}),t.data("resizable")!==!1&&e(window).bind("resize.jqChart",function(){i._resize()}),e(window.document).bind("keydown.jqChart",function(t){i._keyDown(t)}),t.bind("mousewheel",function(t,e,n,s){i._mouseWheel(t,e,n,s)}),l.isTouchDevice&&(t.bind("touchstart",function(t){i._touchStart(t)}),t.bind("touchmove",function(t){i._touchMove(t)}),t.bind("touchend",function(t){i._touchEnd(t)})),this.canvas=this._createCanvas(),this.tooltip=this._createTooltip(),this.shapeRenderer=new I(this.canvas,this),this.ctx=this.shapeRenderer.ctx},_setOptions:function(){this.locOffset=null;var t=this.elem;this.originalCursor="auto",t.hasClass(this.pluginClass)||t.addClass(this.pluginClass),"static"==t.css("position")&&t.css("position","relative"),this.tooltip.hasClass(this.tooltipClass)||this.tooltip.addClass(this.tooltipClass)},_createHighlightRenderer:function(){if(l.use_excanvas){this.hlCanvas=this._createCanvas(!0);var t=e('<div style="position:absolute"></div>');this.elem.append(t),t.append(this.hlCanvas),this.hlRenderer=new I(this.hlCanvas,this),this.hlRenderer.div=t}else this.hlCanvas=this._createCanvas(),this.hlRenderer=new I(this.hlCanvas,this);this.hlRenderer.isHighlighting=!0},_createCanvas:function(t){var i=document.createElement("canvas");return i.width=10,i.height=10,e(i).css({position:"absolute",left:0,top:0}),l.use_excanvas&&(window.G_vmlCanvasManager.init_(document),window.G_vmlCanvasManager.initElement(i)),t||this.elem.append(i),i},_setCanvasSize:function(t,e,i){t.width=e,t.height=i},_setRetinaDispOpts:function(t,e,i){t.setAttribute("width",2*e),t.setAttribute("height",2*i);var n=t.getContext("2d");n.scale(2,2)},_createTooltip:function(){var t=e('<div style="position:absolute;display:none"></div>');return this.elem.append(t),t},_addTrialWatermark:function(t){var e=window.location.host.indexOf("www.jquerychart.com");if(-1==e&&(e=window.location.host.indexOf("www.jqchart.com"),-1==e)){var i=new T("www.jqchart.com");i.chart=this,i.font="14px sans-serif",i.fillStyle="gray",i.measure(this.ctx),i.x=this._width-i.width-16,i.y=this._height-i.height,t.push(i)
}},_measure:function(){},_arrange:function(){},_keyDown:function(t){this.currentTool.keyDown(t)},_keyUp:function(t){this.currentTool.keyUp(t)},_mouseEnter:function(){this.isMouseOver=!0},_mouseLeave:function(){this._clearRenderers(),this.locOffset=null,this.isMouseOver=!1},_mouseDown:function(t){null!=this._oldShape&&this._triggerShapeEvent("MouseDown",this._oldShape),this.isMouseDown=!0,this.currentTool.mouseDown(t)},_mouseMove:function(t){this._initMouseInput(t),this._processMouseEvents(),this.currentTool.mouseMove(t)},_mouseUp:function(t){null!=this._oldShape&&this._triggerShapeEvent("MouseUp",this._oldShape),this.isMouseDown=!1,this.currentTool.mouseUp(t)},_mouseWheel:function(t,e,i,n){this.currentTool.mouseWheel(t,e,i,n)},_touchStart:function(t){this._initTouchInput(t),this.isTouchOver=!0,this._processTouchEvents(),this.currentTool.touchStart(t)},_touchMove:function(t){this._initTouchInput(t);var e=this.touchInput[0];this.isTouchOver=this.contains(e.locX,e.locY),this._processTouchEvents(),this.currentTool.touchMove(t)},_touchEnd:function(t){this._initTouchInput(t),null!=this._oldShape&&(this._triggerShapeEvent("TouchEnd",this._oldShape),this._oldShape=null),this.currentTool.touchEnd(t)},_initMouseInput:function(t){this.isMouseOver=!0;var e=t.pageX,i=t.pageY;this.locOffset||(this.locOffset=this.elem.offset());var n=this.locOffset,s=e-n.left,o=i-n.top,a={x:e,y:i,locX:s,locY:o};this.mouseInput=a},_initTouchInput:function(t){var e=t.originalEvent.touches;this.locOffset||(this.locOffset=this.elem.offset());for(var i=this.locOffset,n=[],s=0;s<e.length;s++){var o=e[s],a=o.pageX,r=o.pageY,l=a-i.left,c=r-i.top;n.push({x:a,y:r,locX:l,locY:c})}this.touchInput=n},getAllTouches:function(t){for(var i=["touches","changedTouches"],n=[],s=0;s<i.length;s++)for(var o=t.originalEvent[i[s]],a=0;a<o.length;a++){var r=o[a];-1==e.inArray(r,n)&&n.push(r)}return n},_resize:function(){var t=this.elem,e=t.width(),i=t.height();if(e!=this._width||i!=this._height){var n=this.options;n&&(h.isNull(n.width)||(n.width=e),h.isNull(n.height)||(n.height=i)),this._setOptions(this.options)}},_clearRenderers:function(){this._oldTShapes&&(this._oldTShapes=null,this.elem.trigger("dataHighlighting",null)),this._oldShape=null,this._resetCursor(),this.hideTooltip(),this.hlRenderer&&this.hlRenderer._clear()},_processMouseMove:function(){this._processTooltips(this.mouseInput)},_processMouseEvents:function(){var t=this.mouseInput,e=this.hitTest(t.locX,t.locY);null!=this._oldShape&&this._oldShape==e?this._triggerShapeEvent("MouseMove",this._oldShape):(null!=this._oldShape&&(this._triggerShapeEvent("MouseLeave",this._oldShape),this._oldShape.cursor&&this._resetCursor()),null!=e&&(this._triggerShapeEvent("MouseEnter",e),e.cursor&&this.elem.css("cursor",e.cursor)),this._oldShape=e)},_processTouchEvents:function(){var t=this.touchInput[0];if(t){var e=this.hitTest(t.locX,t.locY);null!=this._oldShape&&this._oldShape==e?this._triggerShapeEvent("TouchMove",this._oldShape):(null!=this._oldShape&&this._triggerShapeEvent("TouchEnd",this._oldShape),null!=e&&this._triggerShapeEvent("TouchStart",e),this._oldShape=e)}},_processTooltips:function(t){var e=this.hasTooltips,i=this.hasHighlighting;if(e||i){var n=this.options.tooltips.snapArea,s=this._getTooltipShapes(t.locX,t.locY,n,t),o=!0;null!=this._oldTShapes&&h.compareArrays(this._oldTShapes,s)?o=!1:(null!=s&&(this._initTooltip(s),this._highlightShapes(s)),s&&(this._oldTShapes=s)),s&&e&&o&&this._setTooltipPos(s,t)}},_setTooltipPos:function(t,i){var n=this.tooltip.outerWidth(!0),s=this.tooltip.outerHeight(!0),o=this._width,a=this._height,r=t[0]._getTooltipPosition(i,n,s,o,a),l=r.y,c=t.length;c>1&&(l=0,e.each(t,function(){l+=this._getTooltipPosition(i,n,s,o,a).y}),l/=c),l=h.fitInRange(l,0,a-s),this.tooltip.stop(),this.tooltip.animate({left:r.x,top:l},100)},_processTouchStart:function(){this._processTooltips(this.touchInput[0])},_processTouchMove:function(){this._processTooltips(this.touchInput[0])},_initTooltip:function(t){if(this.hasTooltips&&t&&t.length){var i,n=t.length,s="";if(1==n?i=t[0].context:(i=[],e.each(t,function(){i.push(this.context)})),i){var o=new e.Event("tooltipFormat");this.elem.trigger(o,[i]),s=o.result?o.result:this._getTooltipText(t),this.tooltip.html(s);var a=this.options.tooltips;1==n&&a.borderColor&&("auto"==a.borderColor&&this.tooltip.css("border-color",t[0].getTooltipColor()),this.tooltip.css("border-color",a.borderColor)),a.background&&this.tooltip.css("background",a.background),this.showTooltip()}}},_highlightShapes:function(t){if(this.hasHighlighting){this.hlRenderer._clear();var i=this.options.tooltips,n=[];e.each(t,function(t,e){var s=e._createHighlightShape(i.highlightingFillStyle,i.highlightingStrokeStyle);n.push(s)});var s;1==n.length?(s=n[0].context,s.shape=n[0]):(s=[],e.each(n,function(){s.push(this.context),s.shape=this}));var o=new e.Event("dataHighlighting");this.elem.trigger(o,[s]),o.result!==!1&&(l.use_excanvas?this.hlRenderer._render(n):(this.hlRenderer.ctx.save(),this._setClip&&this._setClip(this.hlRenderer.ctx),this.hlRenderer._render(n),this.hlRenderer.ctx.restore()))}},_getClosestShape:function(t,e,i){for(var n=t[0],s=1;s<t.length;s++){var o=t[s];0==u.compare(n,o,i,e)&&(n=o)}return n},_getTooltip:function(){return"Tooltip"},_getTooltipText:function(t){var i="",n=this;return e.each(t,function(){i+=n._getTooltip(this)}),i},_getTooltipShapes:function(t,e,i,n){i||(i=0);for(var s=[],o=this.shapes.length-1;o>=0;o--){var a=this.shapes[o];if(a.context&&!a.isLegendItem&&!a.isAxisLabel){var r=a.hitTest(n.locX,n.locY,i);"function"==typeof a.hitTestNonHV&&(r=a.hitTestNonHV(n.locX,n.locY,i)),r===!0?s.push(a):r&&s.push(r)}}var l=this._getClosestShape(s,i,n);return l?[l]:null},_resetCursor:function(){this.elem.css("cursor")!=this.originalCursor&&this.elem.css("cursor",this.originalCursor)},_triggerShapeEvent:function(t,e){e.context.shape=e,this.elem.trigger("dataPoint"+t,e.context)},_exportToImage:function(t,i){t=t||{};var n=e.extend({},i,t);if(n.type=t.type||"image/png",t.fileName)n.fileName=t.fileName;else switch(n.type){case"image/jpeg":n.fileName="jqChart.jpg";break;case"image/png":default:n.fileName="jqChart.png"}var s=this.toJSON(n);this._doRequest(n.server,"canvas="+s,n.method)},_exportToPdf:function(t,i){t=t||{};var n=e.extend({},i,t);n.type="application/pdf",n.fileName=t.fileName||"chart.pdf";var s=this.toJSON(n);this._doRequest(n.server,"canvas="+s,n.method)},_toJSON:function(t,e){var i=this,n="{type:'"+e.type+"',fileName:'"+e.fileName+"'";n+=",width:"+i._width+",height:"+i._height+",shapes:[";for(var s=0;s<t.length;s++){var o=t[s].toJSON();o&&(n+="{"+o+"}",s!=t.length-1&&(n+=","))}return n+"]}"},_doRequest:function(e,i,n){if(e&&i){i="string"==typeof i?i:t.param(i);var s="";t.each(i.split("&"),function(){var t=this.split("=");s+='<input type="hidden" name="'+t[0]+'" value="'+t[1]+'" />'}),t('<form action="'+e+'" method="'+(n||"post")+'">'+s+"</form>").appendTo("body").submit().remove()}},getCurrentTool:function(){return this.currentTool},setCurrentTool:function(t){this.currentTool!=t&&(null!=this.currentTool&&this.currentTool.stop(),this.currentTool=t?t:this.defaultTool,this.currentTool&&this.currentTool.start())},contains:function(t,e){return t>=0&&t<=this._width&&e>=0&&e<=this._height},hitTest:function(t,e,i){i||(i=0);for(var n=this.shapes.length-1;n>=0;n--){var s=this.shapes[n];if(s.context&&s.hitTest(t,e,i))return s}},showTooltip:function(){this.tooltip.show()},hideTooltip:function(){this.tooltip.hide()},stringFormat:function(t,i){return e.jqChartSprintf(i,t)},clear:function(){this._clearRenderers(),this.shapeRenderer._clear()},render:function(){},destroy:function(){var t=this.elem;t.empty(),t.unbind(),e(window).unbind("resize.jqChart"),e(window.document).unbind("keydown.jqChart"),this.options,t.hasClass(this.pluginClass)&&t.removeClass(this.pluginClass)},toDataURL:function(t){return l.use_excanvas?null:this.canvas.toDataURL(t)},getShapesPerData:function(t){var i=[],n=this.shapes;return e.each(t,function(){var t=this;e.each(n,function(){this.context&&this.context.dataItem==t&&i.push(this)})}),i},highlightData:function(t){if(!t)return this._clearRenderers(),null;var e=this.getShapesPerData(t);if(0==e.length)return null;this._highlightShapes(e),this._initTooltip(e);var i=e[0].getCenter();return this._setTooltipPos(e,{locX:i.x,locY:i.y}),e}},c.prototype={_initDefs:function(){e.extend(this,{maxInter200Px:8,lblMargin:4,crossOffsetX:0,crossOffsetY:0,origin:0,length:300,x:0,y:0})},_calculateActualInterval:function(t,e){if(this.interval)return this.interval;var i=1;this.getOrientation&&"x"!=this.getOrientation()||(i=.8);for(var n=i*this.maxInter200Px,s=Math.max(this.length*n/200,1),o=e-t,a=o/s,r=Math.pow(10,Math.floor(h.log10(a))),l=[10,5,2,1],c=0;c<l.length;c++){var d=l[c],u=r*d;if(o/u>s)break;a=u}return a},_setVisibleRanges:function(){this.actualVisibleMinimum=h.isNull(this.visibleMinimum)?this.actualMinimum:this.visibleMinimum,this.actualVisibleMaximum=h.isNull(this.visibleMaximum)?this.actualMaximum:this.visibleMaximum,"date"==e.type(this.actualVisibleMinimum)&&(this.actualVisibleMinimum=this.actualVisibleMinimum.getTime()),"date"==e.type(this.actualVisibleMaximum)&&(this.actualVisibleMaximum=this.actualVisibleMaximum.getTime()),this.options&&(this.options.visibleMinimum=this.visibleMinimum,this.options.visibleMaximum=this.visibleMaximum)},_setMinMax:function(t,e){this.logarithmic?(this.actualMinimum=h.isNull(this.minimum)?t:h.log(this.minimum,this.logBase),this.actualMaximum=h.isNull(this.maximum)?e:h.log(this.maximum,this.logBase)):(this.actualMinimum=h.isNull(this.minimum)?t:this.minimum,this.actualMaximum=h.isNull(this.maximum)?e:this.maximum)},_getNextPosition:function(t,e){return h.round(t+e)},_getMarkInterval:function(t,e){var i;return i=t.interval?t.interval:e?this.actualInterval:this.actualInterval/2},_getIntervals:function(t,e){var i=0;e&&e.intervalOffset&&(i=e.intervalOffset);for(var n=[],s=this._getIntervalStart(this.actualVisibleMinimum,t),o=s+i;o<=this.actualVisibleMaximum;o=this._getNextPosition(o,t))n.push(o);return n},_getIntervalStart:function(t,e){var i=t-this.getCrossing(),n=this._alignToInterval(i,e);return t>n&&(n=this._alignToInterval(i+e,e)),n},_alignToInterval:function(t,e){return h.round(h.round(Math.floor(t/e))*e)+this.getCrossing()},_createLabel:function(t,i){var n=new T(t);return n.isAxisLabel=!0,n.context={chart:this.chart,axis:this,text:t},e.extend(n,i),this.chart.elem.trigger("axisLabelCreating",n),n.measure(this.chart.ctx),n},_getLabelIntervals:function(t,e){return this._getIntervals(t,e)},_measureRotatedLabels:function(t){for(var e=this.isAxisVertical,i=0,n=0,s=0;s<t.length;s++){var o=t[s],a=Math.sqrt(o.width*o.width+o.height*o.height),r=o.rotationAngle;if(e){var l=Math.abs(Math.cos(r)*a);i=Math.max(i,l)}else{var c=Math.abs(Math.sin(r)*a);n=Math.max(n,c)}}return"inside"==this.labels.position?(this.lblsW=i,this.lblsH=n,{w:0,h:0}):{w:i,h:n}},_correctLabelsPositions:function(t){var e=0,i=0,n=this.reversed===!0,s="inside"==this.labels.position,o=this.isAxisVertical,a=this.lblMargin;if(o){for(var r=[],l=0;l<t.length;l++){var c=t[l],h=!1,d=c.y;switch(c.textBaseline){case"middle":d-=c.height/2;break;case"bottom":d-=c.height}var u=0;for(u=0;u<r.length;u++){var p=r[u];if(h=n?d>p.y+p.h:p.y>d+c.height){p.y=d,p.h=c.height,p.w=Math.max(p.w,c.width+a),p.labels.push(c);break}}0==h&&(r[u]={y:d,h:c.height,w:c.width+a,labels:[c]})}var m="right"==this.location;m=s?!m:m,e=0;for(var l=0;l<r.length;l++){for(var p=r[l],u=0;u<p.labels.length;u++){var c=p.labels[u];m?c.x+=e:c.x-=e}e+=p.w}}else{for(var r=[],l=0;l<t.length;l++){var c=t[l],f=c.x;switch(c.textAlign){case"center":f-=c.width/2;break;case"right":f-=c.width}var h=!1,u=0;for(u=0;u<r.length;u++){var p=r[u];if(h=n?p.x>f+c.width+a:f>p.x+p.w+a){p.x=f,p.w=c.width,p.h=Math.max(p.h,c.height+a),p.labels.push(c),h=!0;break}}0==h&&(r[u]={x:f,w:c.width,h:c.height+a,labels:[c]})}var g="bottom"==this.location;g=s?!g:g,i=0;for(var l=0;l<r.length;l++){for(var p=r[l],u=0;u<p.labels.length;u++){var c=p.labels[u];g?c.y+=i:c.y-=i}i+=p.h}}return"inside"==this.labels.position?(this.lblsW=e,this.lblsH=i,{w:0,h:0}):{w:e,h:i}},_removeOverlappedLabels:function(t){var e=0,i=0,n=0,s=0,o=0,a=0,r=0,l=Le;this.reversed===!0,"inside"==this.labels.position;var c=this.isAxisVertical,h=this.lblMargin,d=2*h;if(c)for(var u=0;u<t.length;u++){var p=u;this.reversed&&(p=t.length-u-1);var m=t[p],f=m.y;switch(m.textBaseline){case"middle":f-=m.height/2;break;case"bottom":f-=m.height}a=m.y,r=a+m.height+d,l>r?(l=a,e=Math.max(e,m.width+h)):m.visible=!1}else for(var u=0;u<t.length;u++){var p=u;this.reversed&&(p=t.length-u-1);var m=t[p],g=m.x;switch(m.textAlign){case"center":g-=m.width/2;break;case"right":g-=m.width}n=m.x,s=n+m.width+d,n>o?(o=s,i=Math.max(i,m.height+h)):m.visible=!1}return"inside"==this.labels.position?(this.lblsW=e,this.lblsH=i,{w:0,h:0}):{w:e,h:i}},_measure:function(){var t=0;this.zoomEnabled&&(t=this.rangeSlider.breadth);var e={w:0,h:0};if(this.labels)if(this.labels.angle)e=this._measureRotatedLabels(this._getLabels());else switch(this.labels.resolveOverlappingMode){case"hide":e=this._removeOverlappedLabels(this._getLabels());break;case"multipleRows":default:e=this._correctLabelsPositions(this._getLabels())}this.title._measure();var i=this.title.height+t+this.lineWidth/2;this.isAxisVertical?e.w+=i:e.h+=i;var n=this.margin+this._getMaxOutsideTickMarksLength();if(this.isAxisVertical){if(0==this.isCustomWidth){var s=e.w+n;if(this.width!=s)return this.width=s,!0}}else if(0==this.isCustomHeight){var o=e.h+n;if(this.height!=o)return this.height=o,!0}return!1},_arrange:function(){var t=this.x,e=this.y,i=this.x+this.width,n=this.y+this.height;switch(this.location){case"left":i=t=this.x+this.width;break;case"right":i=t=this.x;break;case"top":n=e=this.y+this.height;break;case"bottom":n=e=this.y}if(this.title.text)switch(this.location){case"left":this.title.rotX=this.x,this.title.rotY=this.y+(this.height+this.title.width)/2,this.title.rotationAngle=h.radians(-90);break;case"right":this.title.rotX=this.x+this.width,this.title.rotY=this.y+(this.height-this.title.width)/2,this.title.rotationAngle=h.radians(90);break;case"top":this.title.x=this.x+(this.width-this.title.width)/2,this.title.y=this.y;break;case"bottom":this.title.x=this.x+(this.width-this.title.width)/2,this.title.y=this.y+this.height-this.title.height}this.x1=t,this.y1=e,this.x2=i,this.y2=n,this.offset=this.lineWidth/2},_updateOrigin:function(){this.isAxisVertical?(this.origin=this.y,this.length=this.height):(this.origin=this.x,this.length=this.width)},_render:function(){var t=[];if(this.bands&&this.bands.length){var i=this._getBands();e.merge(t,i)}var n=this._getTickMarks(this.minorTickMarks,!1);e.merge(t,n);var s=this._getTickMarks(this.majorTickMarks,!0);e.merge(t,s);var o=this._getMainLine();t.push(o);var a=this._getLabels();if(this.labels&&!this.labels.angle)switch(this.labels.resolveOverlappingMode){case"hide":this._removeOverlappedLabels(a);break;case"multipleRows":default:this._correctLabelsPositions(a)}return this._filterLabels(a),this.title._render(t),e.merge(t,a),{postShapes:t,contextShapes:a}},_getBands:function(){for(var t,e,i=[],n=pos21=pos12=pos22=anotherSize=0,s=this.getOrientation(),o=0,a=this.bands.length;a>o;++o)if(e=this.bands[o],!(e.length<2)){if("x"==s){if(n=this.getPosition(e[0]),pos12=this.getPosition(e[1]),n>=this.x2||pos12<=this.x1)continue;n=Math.max(n,this.x1),pos12=Math.min(pos12,this.x2),t=new m(n,this.sharedAxis.y1,pos12-n,this.sharedAxis.height)}else{if(pos12=this.getPosition(e[0]),n=this.getPosition(e[1]),n<=this.y1||pos12>=this.y2)continue;pos12=Math.min(pos12,this.y2),n=Math.max(n,this.y1),t=new m(this.sharedAxis.x1,n,this.sharedAxis.width,n-pos12)}t.strokeStyle=null,t.fillStyle=e[2]||"rgba(0,0,0,0.2)",i[o]=t}return i},_getMainLine:function(){var t=this.crossOffsetX,e=this.crossOffsetY,i=new p(this.x1+t,this.y1+e,this.x2+t,this.y2+e);return i.strokeStyle=this.strokeStyle,i.lineWidth=this.lineWidth,i.strokeDashArray=this.strokeDashArray,i},_getMaxInsideTickMarksLength:function(){var t=0;return null!=this.minorTickMarks&&this.minorTickMarks.visible&&this.minorTickMarks.isInside()&&(t=Math.max(t,this.minorTickMarks.length)),null!=this.majorTickMarks&&this.majorTickMarks.visible&&this.majorTickMarks.isInside()&&(t=Math.max(t,this.majorTickMarks.length)),t},_getMaxOutsideTickMarksLength:function(){var t=0;return null!=this.minorTickMarks&&this.minorTickMarks.visible&&!this.minorTickMarks.isInside()&&(t=Math.max(t,this.minorTickMarks.length)),null!=this.majorTickMarks&&this.majorTickMarks.visible&&!this.majorTickMarks.isInside()&&(t=Math.max(t,this.majorTickMarks.length)),t},_getLabels:function(){var t=this.labels;if(null==t||t.visible===!1)return[];var e="inside"==t.position,i=this.lblMargin,n=this.offset,s=this.crossOffsetX,o=this.crossOffsetY,a=this.isAxisVertical;(a&&"center"==t.vAlign||!a&&"center"==t.hAlign)&&(i+=e?this._getMaxInsideTickMarksLength()+this.lineWidth/2:this._getMaxOutsideTickMarksLength());var r=[],l=this._getMarkInterval(t,!0);if(!l)return[];for(var c=this._getLabelIntervals(l,t),d=c.length,u=t.showFirstLabel,p=t.showLastLabel,m=0;d>m;m++)if((u||0!=m)&&(p||m!=d-1)){var f=c[m],g=this.getLabel(f),v=this._createLabel(g,t),_=this.getPosition(f);switch(this.location){case"left":switch(e?v.x=this.x+this.width+i+s:(v.x=this.x+this.width-i-n+s,v.textAlign="right"),v.y=_,t.vAlign){case"bottom":v.textBaseline="top";break;case"top":v.textBaseline="bottom"}if(this.labels.angle){var b=Math.min(90,Math.max(-90,this.labels.angle)),y=h.radians(b);v.rotX=v.x,v.rotY=v.y,v.rotationAngle=y}break;case"right":switch(e?(v.x=this.x-i+s,v.textAlign="right"):v.x=this.x+i+n+s,v.y=_,t.vAlign){case"bottom":v.textBaseline="top";break;case"top":v.textBaseline="bottom"}if(this.labels.angle){var b=Math.min(90,Math.max(-90,this.labels.angle)),y=h.radians(b);v.rotX=v.x,v.rotY=v.y,v.rotationAngle=y}break;case"top":switch(v.x=_,v.y=e?this.y+this.height+i+v.height/2+o:this.y+this.height-i-v.height/2-n+o,v.textBaseline="middle",t.hAlign){case"center":v.textAlign="center";break;case"left":v.textAlign="right";break;case"right":v.textAlign="left"}if(this.labels.angle){var b=Math.min(90,Math.max(-90,this.labels.angle));v.flip=b>0,b>0&&(b=-180+b);var y=h.radians(b),w=Math.sqrt(v.width*v.width+v.height*v.height);v.rotX=v.x+.5*Math.cos(y)*w,v.rotY=v.y+.5*Math.sin(y)*w,v.rotationAngle=y}break;case"bottom":switch(v.x=_,v.y=e?this.y-i-v.height/2+o:this.y+i+v.height/2+n+o,v.textBaseline="middle",t.hAlign){case"center":v.textAlign="center";break;case"left":v.textAlign="right";break;case"right":v.textAlign="left"}if(this.labels.angle){var b=Math.min(90,Math.max(-90,this.labels.angle));v.flip=0>b,0>b&&(b=180+b);var y=h.radians(b),w=Math.sqrt(v.width*v.width+v.height*v.height);v.rotX=v.x+.5*Math.cos(y)*w,v.rotY=v.y+.5*Math.sin(y)*w,v.rotationAngle=y}}r.push(v)}return r},_filterLabels:function(t){if(this.labels&&"inside"==this.labels.position)for(var i=this.chart.gridArea,n=i.x,s=i.y,o=i.width,a=i.height,r=t.length-1;r>=0;r--){var l=t[r];if(!l.isInRect(n,s,o,a)){var c=e.inArray(l,t);t.splice(c,1)}}},_getTickMarks:function(t,e){if(null==t||1!=t.visible)return[];for(var i,n,s,o,a=[],r=this.crossOffsetX,l=this.crossOffsetY,c=this.offset,h="inside"==t.position,d=this._getMarkInterval(t,e),u=t.length,m=this._getIntervals(d,t,e),f=0;f<m.length;f++){var g=this.getPosition(m[f]);switch(this.location){case"left":n=o=g,s=h?this.x+this.width+u+this.lineWidth/2+r:this.x+this.width-c+r,i=s-u;break;case"right":n=o=g,i=h?this.x-u-this.lineWidth/2+r:this.x+c+r,s=i+u;break;case"top":i=s=g,o=h?this.y+this.height+u+this.lineWidth/2+l:this.y+this.height-c+l,n=o-u;break;case"bottom":i=s=g,o=h?this.y-u-this.lineWidth/2+l:this.y+c+l,n=o+u}var v=new p(i,n,s,o);t._setLineSettings(v),a.push(v)}return a},_setChart:function(t){this.chart=t,this.title.chart=t},_getValue:function(t){return t},getCrossing:function(){return this.crossing||0},_initRadialMeasures:function(){var t;this.chart.options.halfPolar?(t=Math.min(2*this.width-10,this.height),this.cx=this.x+10):(t=Math.min(this.width,this.height),this.cx=this.x+this.width/2),this.cy=this.y+this.height/2,this.radius=t/2},getZoom:function(){if(!this.actualMaximum)return 1;var t=this.actualMaximum-this.actualMinimum,e=this.actualVisibleMaximum-this.actualVisibleMinimum,i=e/t;return i},setOptions:function(t){null!=t&&"string"==typeof t.title&&(t.title={text:t.title},e.extend(t.title,this.defaults.title));var i=e.extend(!0,{},this.defaults,t||{});e.extend(this,i),this.options=t,t&&(this.isCustomWidth=null!=t.width,this.isCustomHeight=null!=t.height),this.majorTickMarks=new O(i.majorTickMarks),i.minorTickMarks&&(this.minorTickMarks=new O(i.minorTickMarks),this.minorTickMarks.major=this.majorTickMarks),i.majorGridLines&&(this.majorGridLines=new q(i.majorGridLines)),i.minorGridLines&&(this.minorGridLines=new q(i.minorGridLines),this.minorGridLines.major=this.majorGridLines),this.isAxisVertical=this.isVertical(),this.title=new P(i.title)},getPosition:function(t){var e=this.actualVisibleMaximum,i=this.actualVisibleMinimum,n=this.length/(e-i)*(t-i),s=this.reversed===!0,o=this.isAxisVertical;return o&&s===!1||o===!1&&s?n=this.origin+this.length-n:n+=this.origin,n},getValue:function(t){var e=this.actualVisibleMaximum,i=this.actualVisibleMinimum,n=(t-this.origin)*(e-i)/this.length+i,s=this.reversed===!0,o=this.isAxisVertical;return(o&&s===!1||o===!1&&s)&&(n=i+e-n),n},getLabel:function(t){var i=null;null!=this.labels&&(i=this.labels.stringFormat);var n=e.fn.jqChart.labelFormatter(i,t);return n},isVertical:function(){return"left"==this.location||"right"==this.location?!0:!1},isValueVisible:function(t){return this.logarithmic&&(t=h.log(t,this.logBase)),t>=this.actualVisibleMinimum&&t<=this.actualVisibleMaximum},isInVisibleRange:function(t){var e=this.visibleMinimum,i=this.visibleMaximum;return h.isNull(e)||h.isNull(i)?!0:(this.logarithmic&&(e=h.log(e,this.logBase),i=h.log(i,this.logBase)),t>=e&&i>=t)}};var Ae=-Number.MAX_VALUE,Le=Number.MAX_VALUE;h.isNull=function(t){return null===t||void 0===t},h.roundH=function(t){return Math.round(t)-.5},h.round=function(t){var e=1/t;if(Math.abs(e)>1e4){var i=h.log10(Math.abs(e));if(i>13)return t}var n=t.toPrecision(14),s=parseFloat(n);return s},h.log10=function(t){return Math.log(t)/Math.LN10},h.log=function(t,e){return Math.log(t)/Math.log(e)},h.radians=function(t){return t*(Math.PI/180)},h.fitInRange=function(t,e,i){return e>t?t=e:t>i&&(t=i),t},h.sum=function(t){for(var e=0,i=0;i<t.length;i++)e+=t[i];return e},h.compareArrays=function(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},h.rotatePointAt=function(t,e,i,n,s){var o=Math.sin(i),a=Math.cos(i),r=t-n,l=e-s,c=n+r*a-l*o,h=s+r*o+l*a;return{x:c,y:h}},h.rotatePointsAt=function(t,e,i,n){for(var s=[],o=0;o<t.length;o+=2){var a=h.rotatePointAt(t[o],t[o+1],e,i,n);s.push(a.x),s.push(a.y)}return s},h.reversePoints=function(t){for(var e=[],i=t.length-2;i>=0;i-=2)e.push(t[i]),e.push(t[i+1]);return e},h.trimPoints=function(t){for(var e=t.slice(0),i=e.length;i>1&&(h.isNull(e[0])||h.isNull(e[1]));)e.splice(0,2),i=e.length;for(;i>1&&(h.isNull(e[i-2])||h.isNull(e[i-1]));)e.splice(i-2,2),i=e.length;return e},h.processDataField=function(t,i){if(!i)return null;var n,s,o,a=e.isPlainObject(i);a?(n=i.name,s=i.type,o=i.convert):n=i;for(var r,l,c=[],h=0;h<t.length;h++){if(r=t[h],l=r[n],o)l=o(l);else if(s)switch(s){case"numeric":"string"==typeof l&&(l=parseFloat(l));break;case"dateTime":"string"==typeof l&&(l=new Date(l))}c.push(l)}return c},h.mergeArraysXY=function(t,e){if(!t||0==t.length)return e;for(var i=[],n=0;n<t.length;n++){var s=[];s.push(t[n]),i.push(s)}for(var o,a=i.length,n=0;n<e.length;n++)if(o=e[n],a>n){var s=i[n];s.push(o)}else{var s=[null,o];i.Add(s)}return i},h.mergeArrays=function(t){for(var e=t.length,i=[],n=0;e>n;n++){var s=t[n];if(null==s)return null;for(var o=i.length,a=0;a<s.length;a++){var r=s[a];if(o>a){var l=i[a];l[n]=r}else{var l=[];l[n]=r,i.push(l)}}}return i},d.ticksInDay=864e5,d.getDaysInMonth=function(t,e){return 1==e?29==new Date(t,1,29).getDate()?29:28:[31,void 0,31,30,31,30,31,31,30,31,30,31][e]},d.addSeconds=function(t,e){var i=new Date(t.getTime()+1e3*e);return i},d.addDays=function(t,e){e=Math.max(e,1);var i=new Date(t.getTime());return i.setDate(t.getDate()+e),i},d.addYears=function(t,e){var i=new Date(t.getTime());return i.setFullYear(t.getFullYear()+e),i},d.addMonths=function(t,e){var i=new Date(t.getTime()),n=i.getDate();return i.setDate(1),i.setMonth(i.getMonth()+e),i.setDate(Math.min(n,d.getDaysInMonth(i.getFullYear(),i.getMonth()))),i},d.getDayOfWeek=function(t){var e=t.getDay();return 0===e?7:e},d.fromDays=function(t){return t*d.ticksInDay},d.fromHours=function(t){return 1e3*60*60*t},d.fromMinutes=function(t){return 1e3*60*t},d.fromSeconds=function(t){return 1e3*t},d.roundToDay=function(t){var e=new Date(t.getFullYear(),t.getMonth(),t.getDate());return e},u.compare=function(t,e,i,n){if(!t.useHitTestArea&&!e.useHitTestArea)return!0;if(t.useHitTestArea&&!e.useHitTestArea)return t.hitTest(i.locX,i.locY,n/3);if(t.hitTest(i.locX,i.locY,0))return!0;var s=t.getCenter(i),o=e.getCenter(i),a=i.locX-s.x,r=i.locY-s.y,l=Math.sqrt(a*a+r*r);a=i.locX-o.x,r=i.locY-o.y;var c=Math.sqrt(a*a+r*r);return c>=l},u.getColorFromFillStyle=function(t){if(null==t)return"#dddddd";if("string"==typeof t)return t;if(t.colorStops&&t.colorStops[0]){var e=t.colorStops[0].color;return"white"!=e&&"#ffffff"!=e?e:t.colorStops[1].color}return"#dddddd"},u.prototype.hitTest=function(){return!1},u.prototype.boundsHitTest=function(t,e,i){return this.useHitTestArea||(i=0),t>=this.x-i&&t<=this.x+this.width+i&&e>=this.y-i&&e<=this.y+this.height+i},u.prototype.render=function(t,e){e||this.setProperties(t)},u.prototype.renderDashedLine=function(t,e,i,n,s,o){var a=function(t,e){return Math.round(t)<=Math.round(e)},r=function(t,e){return Math.round(t)>=Math.round(e)},l=function(t,e){return Math.min(t,e)},c=function(t,e){return Math.max(t,e)},h={thereYet:r,cap:l},d={thereYet:r,cap:l};o.beginPath(),e-n>0&&(d.thereYet=a,d.cap=c),t-i>0&&(h.thereYet=a,h.cap=c),o.moveTo(t,e);for(var u=t,p=e,m=0,f=!0,g=s.length;!h.thereYet(u,i)||!d.thereYet(p,n);){var v=Math.atan2(n-e,i-t),_=s[m];u=h.cap(i,u+Math.cos(v)*_),p=d.cap(n,p+Math.sin(v)*_),f?o.lineTo(u,p):o.moveTo(u,p),m=(m+1)%g,f=!f}null!=this.strokeStyle&&this.lineWidth>0&&o.stroke()},u.prototype.setProperties=function(t){t.fillStyle=this._createGradient(t,this.fillStyle)||"#000000",t.strokeStyle=this.strokeStyle||"#000000",t.lineWidth=this.lineWidth||0,t.lineCap=this.lineCap,t.lineJoin=this.lineJoin,t.miterLimit=this.miterLimit,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY},u.prototype.calculateBounds=function(t){if(null!=t){for(var e=Le,i=Le,n=Ae,s=Ae,o=0;o<t.length;o+=2){var a=t[o],r=t[o+1];e=Math.min(e,a),i=Math.min(i,r),n=Math.max(n,a),s=Math.max(s,r)}this.x=e,this.y=i,this.width=n-e,this.height=s-i,this.center=this.getCenter()}},u.prototype.getCenter=function(){return this.center?this.center:{x:this.x+this.width/2,y:this.y+this.height/2}},u.prototype.getTooltipColor=function(){return u.getColorFromFillStyle(this.fillStyle)},u.prototype.fillStyleToJSON=function(t){if("string"==typeof t||null==this.width||null==this.height||null==this.x||null==this.y)return"'"+t+"'";var e="{type:'"+t.type+"'";h.isNull(t.x0)||(e+=",x0:"+t.x0),h.isNull(t.x1)||(e+=",x1:"+t.x1),h.isNull(t.y0)||(e+=",y0:"+t.y0),h.isNull(t.y1)||(e+=",y1:"+t.y1),"radialGradient"==t.type&&(h.isNull(t.r0)||(e+=",r0:"+t.r0),h.isNull(t.r1)||(e+=",r1:"+t.r1)),e+=",colorStops:[";for(var i=t.colorStops.length,n=0;i>n;n++){var s=t.colorStops[n];e+="{color:'"+s.color+"'",h.isNull(s.offset)||(e+=",offset:"+s.offset),e+="}",n!=i-1&&(e+=",")}return e+="]}"},u.prototype.arrayToJSON=function(t){for(var e,i="[",n=0;n<t.length;n++)e=t[n],i+=e,n!=t.length-1&&(i+=",");return i+"]"},u.prototype.toJSON=function(){var t=this,e="";return t.lineWidth&&(e=",lineWidth:"+t.lineWidth),t.fillStyle&&(e+=",fillStyle:"+t.fillStyleToJSON(t.fillStyle)),t.strokeStyle&&(e+=",strokeStyle:'"+t.strokeStyle+"'"),t.visible||(e+=",visible:"+t.visible),"rgba(0, 0, 0, 0)"!=t.shadowColor&&(e+=",shadowColor:'"+t.shadowColor+"'"),t.shadowBlur&&(e+=",shadowBlur:"+t.shadowBlur),t.shadowOffsetX&&(e+=",shadowOffsetX:"+t.shadowOffsetX),t.shadowOffsetY&&(e+=",shadowOffsetY:"+t.shadowOffsetY),t.strokeDashArray&&(e+=",strokeDashArray:"+t.arrayToJSON(t.strokeDashArray)),e},u.prototype._createGradient=function(t,i){var n=this.x,s=this.y;if(null==i||"string"==typeof i||null==this.width||null==this.height||null==n||null==s)return i;this.xOffset&&(n+=this.xOffset),this.yOffset&&(s+=this.yOffset);var o,a={x0:0,y0:0,x1:1,y1:1,r0:0,r1:1};switch(e.extend(a,i),i.type){case"radialGradient":var r=n+a.x0*this.width,l=s+a.y0*this.height,c=a.r0*this.width/2,h=n+a.x1*this.width,d=s+a.y1*this.height,u=a.r1*this.width/2;o=t.createRadialGradient(r,l,c,h,d,u);break;default:var p=n+a.x0*this.width,m=s+a.y0*this.height,f=n+a.x1*this.width,g=s+a.y1*this.height;o=t.createLinearGradient(p,m,f,g)}var v=a.colorStops;if(null!=v)for(var _=0;_<v.length;_++){var b=v[_];o.addColorStop(b.offset||0,b.color)}return o},u.prototype._createHighlightShape=function(t,i){var n=new u;return e.extend(n,this),n.fillStyle=n.highlightingFillStyle||t,this instanceof p&&(n.strokeStyle=n.highlightingStrokeStyle||i),n},u.prototype._getTooltipPosition=function(t,e,i,n,s){var o=this._getTooltipOrigin(t);return this._getTooltipPositionFromOrigin(o.x,o.y,e,i,n,s)},u.prototype._getTooltipOrigin=function(){return this.tooltipOrigin?this.tooltipOrigin:{x:this.x+this.width/2,y:this.y}},u.prototype._getTooltipPositionFromOrigin=function(t,e,i,n){var s=15,o=t-i-s,a=e-n+10;return 0>o&&(o=Math.max(0,t+s)),0>a&&(a=Math.max(0,e-s)),{x:o,y:a}},u.prototype._getAnimationPoints=function(t,e){if(t.length==e)return t;var i=e%2;e-=i;var n=t.slice(0,e);i/=2;var s=t[e-2],o=t[e-1],a=t[e],r=t[e+1];return h.isNull(o)||h.isNull(r)||(a=s+(a-s)*i,r=o+(r-o)*i,n.push(a),n.push(r)),n},p.prototype=new u,p.constructor=new p,p.prototype.hitTest=function(t,e,i){var n=this.x1,s=this.y1,o=this.x2,a=this.y2,r=Math.max(i,Math.max(3,this.lineWidth/2));if(n==o){var l=t+1;return l>n-r&&o+r>l&&e>=s-r&&a+r>=e?!0:!1}if(s==a){var c=e+.5;return t>=n-r&&o+r>=t&&c>s-r&&a+r>c?!0:!1}return!1},p.prototype.hitTestNonHV=function(t,e,i){var n=this.x1,s=this.y1,o=this.x2,a=this.y2;o>n?(this.x=n,this.width=o-n):(this.x=o,this.width=n-o),a>s?(this.y=s,this.width=a-s):(this.y=a,this.width=s-a);var r,l,c,h=o-n,d=a-s;0==h?(r=1,l=0,c=-n):0==d?(r=0,l=-1,c=-s):Math.abs(h)<Math.abs(d)?(r=1,l=h/d,c=-((n*a-s*o)/d)):(r=-(d/h),l=-1,c=-((s*o-n*a)/h));var u=Math.sqrt(r*r+l*l),p=(r*t-l*e+c)/u,m=Math.max(i,3);return Math.abs(p)<m?!0:!1},p.prototype.render=function(t,e){if(this.visible){u.prototype.render.call(this,t,e);var i=Math.floor(this.lineWidth%2)?h.roundH:Math.round;this.dontRound&&(i=function(t){return t});var n=i(this.x1),s=i(this.y1),o=i(this.x2),a=i(this.y2);if(this.xOffset&&(n+=this.xOffset,o+=this.xOffset),this.yOffset&&(s+=this.yOffset,a+=this.yOffset),this.rotationAngle&&!h.isNull(this.rotX)&&!h.isNull(this.rotY)){var r=h.rotatePointsAt([n,s,o,a],this.rotationAngle,this.rotX,this.rotY);n=r[0],s=r[1],o=r[2],a=r[3]}if(this.strokeDashArray)return this.renderDashedLine(n,s,o,a,this.strokeDashArray,t),void 0;t.beginPath(),t.moveTo(n,s),t.lineTo(o,a),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}},p.prototype.toJSON=function(){var t=this,e="type:'line',x1:"+t.x1+",y1:"+t.y1+",x2:"+t.x2+",y2:"+t.y2;return e+=u.prototype.toJSON.call(this)},m.prototype=new u,m.constructor=new m,m.prototype.hitTest=function(t,e,i){return this.boundsHitTest(t,e,i)},m.prototype.render=function(t,e){if(this.visible){u.prototype.render.call(this,t,e);var i=null!=this.strokeStyle&&this.lineWidth>0,n=i&&Math.floor(this.lineWidth%2)?h.roundH:Math.round,s=this.correction||0;s=Math.round(s);var o=n(this.x),a=n(this.y),r=Math.round(this.width),l=Math.round(this.height);
this.context,this.xDecrease&&(r-=this.xDecrease,this.isAnimReversed&&(o+=this.xDecrease)),this.yDecrease&&(l-=this.yDecrease,this.isAnimReversed&&(a+=this.yDecrease)),this.xOffset&&(o+=this.xOffset),this.yOffset&&(a+=this.yOffset),0>=r||0>=l||(0==this.cornerRadius?m.renderRectPath(t,o,a,r,l):this.renderRoundedRectPath(t,o,a,r,l),null!=this.fillStyle&&t.fill(),i&&t.stroke())}},m.renderRectPath=function(t,e,i,n,s){t.beginPath(),t.moveTo(e,i),t.lineTo(e+n,i),t.lineTo(e+n,i+s),t.lineTo(e,i+s),t.closePath()},m.prototype.renderRoundedRectPath=function(t,e,i,n,s){var o=this.cornerRadius,a=Math.PI/2;t.beginPath(),t.moveTo(e+o,i),t.lineTo(e+n-o,i),t.arc(e+n-o,i+o,o,-a,0,!1),t.lineTo(e+n,i+s-o),t.arc(e+n-o,i+s-o,o,0,a,!1),t.lineTo(e+o,i+s),t.arc(e+o,i+s-o,o,a,2*a,!1),t.lineTo(e,i+o),t.arc(e+o,i+o,o,2*a,-a,!1),t.closePath()},m.prototype.toJSON=function(){var t=this,e="type:'rectangle',x:"+t.x+",y:"+t.y+",width:"+t.width+",height:"+t.height;return t.cornerRadius&&(e+=",cornerRadius:"+t.cornerRadius),e+=u.prototype.toJSON.call(this)},f.prototype=new u,f.constructor=new f,f.prototype.hitTest=function(t,e,i){if(0==this.boundsHitTest(t,e,i))return!1;var n=(this.width+i)/2,s=(this.height+i)/2,o=this.x+n,a=this.y+s,r=t-o,l=e-a,c=r*r/(n*n),h=l*l/(s*s);return 1>=c+h},f.prototype.render=function(t,e){if(this.visible){u.prototype.render.call(this,t,e);var i=this.x,n=this.y,s=this.width,o=this.height;this.xOffset&&(i+=this.xOffset),this.yOffset&&(n+=this.yOffset);var a=.5522848*(this.width/2),r=.5522848*(this.height/2),l=i+s,c=n+o,h=i+s/2,d=n+o/2;t.beginPath(),t.moveTo(i,d),t.bezierCurveTo(i,d-r,h-a,n,h,n),t.bezierCurveTo(h+a,n,l,d-r,l,d),t.bezierCurveTo(l,d+r,h+a,c,h,c),t.bezierCurveTo(h-a,c,i,d+r,i,d),t.closePath(),null!=this.fillStyle&&t.fill(),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}},f.prototype.toJSON=function(){var t=this,e="type:'ellipse',x:"+t.x+",y:"+t.y+",width:"+t.width+",height:"+t.height;return e+=u.prototype.toJSON.call(this)},g.prototype=new u,g.constructor=new g,g.prototype.render=function(t,e){if(this.visible){u.prototype.render.call(this,t,e),t.beginPath();var i=Math.max(0,this.radius);t.arc(Math.round(this.x+i),Math.round(this.y+i),Math.round(i),this.startAngle,this.endAngle,!1),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}},g.prototype.toJSON=function(){var t=this,e="type:'arc',x:"+t.x+",y:"+t.y+",radius:"+t.radius+",startAngle:"+t.startAngle+",endAngle:"+t.endAngle;return e+=u.prototype.toJSON.call(this)},v.prototype=new u,v.constructor=new v,v.prototype.hitTest=function(t,e,i){this.useHitTestArea||(i=0);var n=this.x+this.width/2,s=this.y+this.height/2,o=Math.pow(t-n,2)+Math.pow(e-s,2);return o>Math.pow(this.radius+i,2)?!1:!0},v.prototype.render=function(t,e){if(this.visible){u.prototype.render.call(this,t,e),t.beginPath();var i=Math.max(0,this.radius);t.arc(Math.round(this.x+i),Math.round(this.y+i),Math.round(i),0,2*Math.PI,!1),t.closePath(),null!=this.fillStyle&&t.fill(),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}},v.prototype.toJSON=function(){var t=this,e="type:'circle',x:"+t.x+",y:"+t.y+",radius:"+t.radius;return e+=u.prototype.toJSON.call(this)},_.prototype=new u,_.constructor=new _,_.prototype.hitTest=function(t,e){var i=this.x,n=this.y,s=Math.pow(t-i,2)+Math.pow(e-n,2);if(s>Math.pow(this.radius,2))return!1;var o=i-t,a=n-e,r=Math.atan2(a,o)+Math.PI;return r>3*Math.PI/2&&(r-=2*Math.PI),r>=this.startAngle&&r<this.endAngle?!0:!1},_.prototype.render=function(t,e){if(this.visible&&this.startAngle!=this.endAngle){u.prototype.render.call(this,t,e),t.beginPath();var i=Math.round(this.x),n=Math.round(this.y),s=this.startAngle,o=this.endAngle;if(l.use_excanvas){var a=2*Math.PI-125e-6;o-s>=a&&(o=s+a)}t.moveTo(i,n),t.arc(i,n,Math.round(this.radius),s,o,!1),t.closePath(),null!=this.fillStyle&&t.fill(),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}},_.prototype.toJSON=function(){var t=this,e="type:'pieSlice',x:"+t.x+",y:"+t.y+",radius:"+t.radius+",startAngle:"+t.startAngle+",endAngle:"+t.endAngle;return e+=u.prototype.toJSON.call(this)},b.prototype=new u,b.constructor=new b,b.prototype.hitTest=function(t,e,i){var n=this.context;if(!n||!n.points)return this.boundsHitTest(t,e,i);for(var s,o,a,r=this.pts,l=Math.pow(i,2),c=-1,h=Le,d=this.isStepLine?4:2,u=0;u<r.length;u+=d)s=r[u],o=r[u+1],a=Math.pow(t-s,2)+Math.pow(e-o,2),a>h||a>l||(h=a,c=u);return-1==c?!1:this.createHighlightMark(c)},b.prototype.createHighlightMark=function(t){if(-1==t)return null;var i=this.context,n=this.pts,s=t/2;this.isStepLine&&(s/=2);var o=i.points[s],a=5,r=new v(n[t]-a,n[t+1]-a,a);return r.fillStyle=r.highlightingFillStyle=this.strokeStyle,r.strokeStyle="white",r.lineWidth=1,r.useHitTestArea=!0,r.context={series:i.series,chart:i.chart},e.extend(r.context,o),r},b.prototype.getCenter=function(t){if(this.center)return this.center;var e=this.context;if(!e||!e.points)return{x:this.x+this.width/2,y:this.y+this.height/2};for(var i,n=this.pts,s=0,o=Le,a=t.locX,r=this.isStepLine?4:2,l=0;l<n.length;l+=r)i=Math.abs(n[l]-a),o>i&&(o=i,s=l);return{x:n[s],y:n[s+1],mark:this.createHighlightMark(s)}},b.prototype.getLength=function(){return this.pts.length},y.prototype=new b,y.constructor=new y,y.prototype.renderPoints=function(t,e,i){var n=e.length;if(!(2>=n)){if(this.strokeDashArray)return this.renderDashed(t,e),void 0;for(var s="connect"!=this.nullHandling,o=!0,a=2;n>a;a+=2){var r=e[a];if(null!=r){var l=e[a+1];o?(t.lineTo(r,l),0!=a%1e3||i||(null!=this.strokeStyle&&this.lineWidth>0&&t.stroke(),t.beginPath(),t.moveTo(r,l))):(t.beginPath(),t.moveTo(r,l),o=!0)}else s&&(null!=this.strokeStyle&&this.lineWidth>0&&t.stroke(),o=!1)}}},y.prototype.render=function(t,e){if(this.visible){u.prototype.render.call(this,t,e);var i=h.trimPoints(this.pts);if(this.closed&&(i.push(i[0]),i.push(i[1])),!h.isNull(this.length)){var n=this.closed?this.length+2:this.length;i=this._getAnimationPoints(i,n)}var s=i.length;if(!(2>=s)){if(this.xOffset){i=i.slice(0);for(var o=0;o<i.length;o+=2)i[o]+=this.xOffset}if(this.yOffset){i=i.slice(0);for(var o=1;o<i.length;o+=2)i[o]+=this.yOffset}t.beginPath(),t.moveTo(i[0],i[1]),this.renderPoints(t,i),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}}},y.prototype.renderDashed=function(t,e){for(var i,n,s=e.length,o="connect"!=this.nullHandling,a=this.strokeDashArray,r=!1,l=0;s>l;l+=2){var c=e[l];if(null!=c){var h=e[l+1];r?(this.renderDashedLine(i,n,c,h,a,t),i=c,n=h):(i=c,n=h,r=!0)}else o&&(r=!1)}},y.prototype.toJSON=function(){var t=this,e="type:'polyline',pts:"+t.arrayToJSON(t.pts);return this.nullHandling&&(e+=",nullHandling:'"+t.nullHandling+"'"),t.closed&&(e+=",closed:"+t.closed),e+=u.prototype.toJSON.call(this)},w.prototype=new b,w.constructor=new w,w.prototype.renderPoints=function(t,i){var n=.4,s=this.closed,o=[];e.merge(o,i);var a=[],r=o.length;if(!(2>=r)){if(4==r)return t.lineTo(o[2],o[3]),void 0;if(s){o.push(o[0],o[1],o[2],o[3]),o.unshift(o[r-1]),o.unshift(o[r-1]);for(var l=0;r>l;l+=2)a=a.concat(this.getControlPoints(o[l],o[l+1],o[l+2],o[l+3],o[l+4],o[l+5],n));a=a.concat(a[0],a[1]);for(var l=2;r+2>l;l+=2)t.bezierCurveTo(a[2*l-2],a[2*l-1],a[2*l],a[2*l+1],o[l+2],o[l+3])}else{for(var l=0;r-4>l;l+=2)a=a.concat(this.getControlPoints(o[l],o[l+1],o[l+2],o[l+3],o[l+4],o[l+5],n));t.quadraticCurveTo(a[0],a[1],o[2],o[3]);for(var l=2;r-5>l;l+=2)t.bezierCurveTo(a[2*l-2],a[2*l-1],a[2*l],a[2*l+1],o[l+2],o[l+3]);t.quadraticCurveTo(a[2*r-10],a[2*r-9],o[r-2],o[r-1])}}},w.prototype.render=function(t,e){if(this.visible){u.prototype.render.call(this,t,e);var i=h.trimPoints(this.pts);h.isNull(this.length)||(i=this._getAnimationPoints(i,this.length));var n=i.length;4>n||(t.beginPath(),t.moveTo(i[0],i[1]),this.renderPoints(t,i),this.closed&&(t.closePath(),null!=this.fillStyle&&t.fill()),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke())}},w.prototype.getControlPoints=function(t,e,i,n,s,o,a){var r=Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2)),l=Math.sqrt(Math.pow(s-i,2)+Math.pow(o-n,2)),c=a*r/(r+l),h=a-c,d=i+c*(t-s),u=n+c*(e-o),p=i-h*(t-s),m=n-h*(e-o);return[d,u,p,m]},w.prototype.toJSON=function(){var t=this,e="type:'curve',pts:"+t.arrayToJSON(t.pts);return t.closed&&(e+=",closed:"+t.closed),e+=u.prototype.toJSON.call(this)},x.prototype=new b,x.constructor=new x,x.prototype.render=function(t,e){if(this.visible){u.prototype.render.call(this,t,e);var i=h.trimPoints(this.pts);h.isNull(this.length)||(i=this._getAnimationPoints(i,this.length));var n=i.length;if(!(2>=n)){var s;this.isCurve?s=new w(i):(s=new y(i),s.nullHandling="connect"),t.beginPath(),t.moveTo(i[0],i[1]),s.renderPoints(t,i,!0),this.vertical?(t.lineTo(this.crossPos,i[i.length-1]),t.lineTo(this.crossPos,i[1])):(t.lineTo(i[i.length-2],this.crossPos),t.lineTo(i[0],this.crossPos)),t.closePath(),null!=this.fillStyle&&t.fill(),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}}},x.prototype.toJSON=function(){var t=this,e="type:'area',pts:"+t.arrayToJSON(t.pts)+",crossPos:"+t.crossPos+",vertical:"+t.vertical;return t.isCurve&&(e+=",isCurve:"+t.isCurve),e+=u.prototype.toJSON.call(this)},C.prototype=new b,C.constructor=new C,C.prototype.getLength=function(){return this.pts1.length},C.prototype.render=function(t,e){if(this.visible){u.prototype.render.call(this,t,e);var i=this.pts1,n=this.pts2;h.isNull(this.length)||(i=this._getAnimationPoints(i,this.length),n=this._getAnimationPoints(n,this.length)),n=h.reversePoints(n);var s=i.length;if(!(2>s)){var o;o=this.isCurve?new w(i):new y(i),t.beginPath(),t.moveTo(i[0],i[1]),o.renderPoints(t,i,!0),t.lineTo(n[0],n[1]),o=this.isCurve?new w(n):new y(n),o.renderPoints(t,n,!0),t.closePath(),null!=this.fillStyle&&t.fill(),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}}},C.prototype.toJSON=function(){var t=this,e="type:'rangeShape',pts1:"+t.arrayToJSON(t.pts1)+",pts2:"+t.arrayToJSON(t.pts2);return t.isCurve&&(e+=",isCurve:"+t.isCurve),e+=u.prototype.toJSON.call(this)},S.prototype=new b,S.constructor=new S,S.prototype.hitTest=function(t,e,i){var n=this.context;if(n&&n.points)return b.prototype.hitTest.call(this,t,e,i);var s=this.boundsHitTest(t,e,i);if(0==s)return!1;if(this.isBoundsHitTest&&i)return!0;for(var o,a,r,l,c=this.pts,h=!1,d=c.length,u=0,p=0;d>p;p+=2)u+=2,u==d&&(u=0),o=c[p],a=c[p+1],r=c[u],l=c[u+1],(e>a&&l>=e||e>l&&a>=e)&&t>o+(e-a)/(l-a)*(r-o)&&(h=!h);return h},S.prototype.render=function(t,e){if(this.visible){u.prototype.render.call(this,t,e);var i=this.pts,n=i.length;if(!(4>n)){if(this.xOffset){i=i.slice(0);for(var s=0;s<i.length;s+=2)i[s]+=this.xOffset}if(this.yOffset){i=i.slice(0);for(var s=1;s<i.length;s+=2)i[s]+=this.yOffset}!this.rotationAngle||h.isNull(this.rotX)||h.isNull(this.rotY)||(i=h.rotatePointsAt(i,this.rotationAngle,this.rotX,this.rotY));var o=Math.floor(this.lineWidth%2)?h.roundH:Math.round;this.dontRound&&(o=function(t){return t}),t.beginPath(),t.moveTo(o(i[0]),o(i[1]));for(var s=2;n>s;s+=2)t.lineTo(o(i[s]),o(i[s+1]));t.closePath(),null!=this.fillStyle&&t.fill(),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}}},S.prototype.toJSON=function(){var t=this,e="type:'polygon',pts:"+t.arrayToJSON(t.pts);return e+=u.prototype.toJSON.call(this)},T.prototype=new u,T.constructor=T,T.prototype.render=function(t,e){if(this.visible){u.prototype.render.call(this,t,e);var i=h.roundH(this.x),n=h.roundH(this.y);!this.rotationAngle||h.isNull(this.rotX)||h.isNull(this.rotY)?(this.renderBg(t),null!=this.fillStyle&&t.fillText(this.text,i,n),null!=this.strokeStyle&&t.strokeText(this.text,i,n)):(t.save(),t.translate(this.rotX,this.rotY),t.rotate(this.rotationAngle),this.flip&&t.scale(-1,-1),this.renderBg(t),null!=this.fillStyle&&t.fillText(this.text,0,0),null!=this.strokeStyle&&t.strokeText(this.text,0,0),t.restore())}},T.prototype.renderBg=function(t){var e=this.background;if(e){var i=h.roundH(this.x),n=h.roundH(this.y);this.width||this.measure(t);var s=Math.round(this.width),o=Math.round(this.height);t.fillStyle=this._createGradient(t,e)||"#000000";var a=this._correctXY(i,n,s,o);m.renderRectPath(t,a.x,a.y,s,o),t.fill(),t.fillStyle=this._createGradient(t,this.fillStyle)||"#000000"}},T.prototype.measure=function(t){this.setProperties(t);var e=t.measureText(this.text),i=parseFloat(this.font)||0,n=e.width;return this.width=n,this.height=i,{width:n,height:i}},T.prototype._correctXY=function(t,e,i,n){switch(this.textAlign){case"center":t-=i/2;break;case"right":t-=i}switch(this.textBaseline){case"middle":e-=n/2;break;case"bottom":e-=n}return{x:t,y:e}},T.prototype.isInRect=function(t,e,i,n){var s=this.x,o=this.y,a=this.width,r=this.height;switch(this.textAlign){case"center":s-=a/2;break;case"right":s-=a}switch(this.textBaseline){case"middle":o-=r/2;break;case"bottom":o-=r}return s>=t&&o>=e&&t+i>=s+a&&e+n>=o+r},T.prototype.intersectWith=function(t,e,i,n){var s=this.x,o=this.y,a=this.width,r=this.height,l=this._correctXY(s,o,a,r);return s=l.x,o=l.y,s+a>t&&t+i>s&&o+r>e&&e+n>o},T.prototype.setProperties=function(t){u.prototype.setProperties.call(this,t),t.font=this.font,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline},T.prototype.hitTest=function(t,e,i){if(!this.isLegendItem&&!this.isAxisLabel)return!1;var n=this.width,s=this.height;switch(this.textAlign){case"center":t+=n/2;break;case"right":t+=n}switch(this.textBaseline){case"middle":e+=s/2;break;case"bottom":e+=s}return this.boundsHitTest(t,e,i)},T.prototype.toJSON=function(){var t=this;if(!t.text||""==t.text)return!1;var e="type:'textBlock',x:"+t.x+",y:"+t.y+",width:"+t.width+",height:"+t.height+",text:'"+t.text+"'";return e+=",font:'"+t.font+"'",e+=",textBaseline:'"+t.textBaseline+"'",e+=",textAlign:'"+t.textAlign+"'",h.isNull(t.rotationAngle)||(e+=",rotationAngle:"+t.rotationAngle),h.isNull(t.rotX)||(e+=",rotX:"+t.rotX),h.isNull(t.rotY)||(e+=",rotY:"+t.rotY),t.flip&&(e+=",flip:"+t.flip),e+=u.prototype.toJSON.call(this)},A.prototype=new u,A.constructor=A,A.prototype.hitTest=function(t,e,i){return this.boundsHitTest(t,e,i)},A.prototype.render=function(t){if(this.visible){var e=new Image,i=this.x,n=this.y,s=this;e.onload=function(){var o=e.width,a=e.height;i-=o/2,n-=a/2,s.x=i,s.y=n,s.offsetX&&(i+=s.offsetX),s.offsetY&&(n+=s.offsetY),s.width=o,s.height=a,t.drawImage(e,i,n)},e.src=this.src}},A.prototype._createHighlightShape=function(t){var e=new m;return e.context=this.context,e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e.fillStyle=t,e.strokeStyle="gray",e},L.prototype=new u,L.constructor=new L,L.prototype.hitTest=function(t,e,i){for(var n=this.shapes,s=0;s<n.length;s++){var o=n[s];if(o.hitTest(t,e,i))return!0}return!1},L.prototype._getTooltipOrigin=function(t){return{x:t.locX,y:t.locY}},L.prototype.render=function(t){if(this.visible){u.prototype.render.call(this,t);for(var e=this.shapes,i=0;i<e.length;i++){var n=e[i];n.render(t,!0)}}},M.prototype.toJSON=function(){var t=this,e="type:'clip',x:"+t.x+",y:"+t.y+",width:"+t.width+",height:"+t.height;return e},k.prototype.toJSON=function(){var t="type:'resetClip'";return t},D.prototype.toJSON=function(){var t=this,e="type:'shadows',renderShadows:"+t.renderShadows;return e},I.prototype._getContext=function(t){return t.getContext?t.getContext("2d"):null},I.emptyColor="rgba(0, 0, 0, 0)",I.prototype._render=function(t){var e=this.offsetX||this.offsetY,i=this.chart.options,n=this.ctx;h.isNull(i.globalAlpha)||(n.globalAlpha=i.globalAlpha),e&&(n.save(),n.translate(this.offsetX,this.offsetY));for(var s=0;s<t.length;s++){var o=t[s];if(o)if(this.isHighlighting||!o.context||!o.context.series||o.isLegendItem||o instanceof T||this.chart.elem.trigger("shapeRendering",o),o.src&&this.isExcanvas)o.offsetX=this.offsetX,o.offsetY=this.offsetY,n.translate(-this.offsetX,-this.offsetY),o.render(n),n.translate(this.offsetX,this.offsetY);else{var a=o.shadowColor;o.shadowColor=I.emptyColor,o.render(n),o.shadowColor=a}}e&&n.restore()},I.prototype._renderShadows=function(t){if(!l.use_excanvas){var e=this.offsetX&&this.offsetY,i=this.chart.options;if(i.shadows&&i.shadows.enabled){var n=this.ctx;h.isNull(i.globalAlpha)||(n.globalAlpha=i.globalAlpha),e&&(n.save(),n.translate(this.offsetX,this.offsetY));for(var s=0;s<t.length;s++){var o=t[s];o&&o.shadowColor&&"rgba(0, 0, 0, 0)"!=o.shadowColor&&o.render(n)}e&&n.restore()}}},I.prototype._clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},P.prototype._render=function(t){null!=this.text&&(this.textBlock.x=this.x+this.margin,this.textBlock.y=this.y+this.margin,this.textBlock.rotX=this.rotX,this.textBlock.rotY=this.rotY,this.textBlock.rotationAngle=this.rotationAngle,t.push(this.textBlock))},P.prototype._measure=function(){var t;if(!this.text)return this.width=0,this.height=0,void 0;t=this.textBlock.measure(this.chart.ctx);var e=2*this.margin;this.width=t.width+e,this.height=t.height+e},P.prototype.setOptions=function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i),this.textBlock=new T(this.text),this.textBlock.textBaseline="top",this.textBlock.font=this.font,this.textBlock.fillStyle=this.fillStyle,this.textBlock.strokeStyle=this.strokeStyle,this.textBlock.lineWidth=this.lineWidth},R.prototype=new P,R.constructor=R,R.prototype._render=function(t){var e=this.chart;if(null!=this.text&&e){var i=e._width,n=e._height,s=this.margin+this.textBlock.width/2,o=this.margin;switch(this.hAlign){case"center":s+=(i-this.width)/2;break;case"right":s+=i-this.width}switch(this.vAlign){case"center":o+=(n-this.height)/2;break;case"bottom":o+=n-this.height}this.textBlock.textAlign="center",this.textBlock.x=s,this.textBlock.y=o,this.textBlock.rotX=s,this.textBlock.rotY=o,this.textBlock.rotationAngle=this.angle,t.push(this.textBlock)}},E.prototype._setShapeSettings=function(t){t.fillStyle=this.fillStyle,this.visible?(t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.lineCap=this.lineCap,t.lineJoin=this.lineJoin,t.miterLimit=this.miterLimit,t.cornerRadius=this.cornerRadius):t.lineWidth=0},E.prototype._render=function(t){var e=this.visible?this.lineWidth/2:0,i=this.x+e,n=this.y+e,s=this.width-2*e,o=this.height-2*e,a=new m(i,n,s,o);this._setShapeSettings(a),t.push(a)},E.prototype.setOptions=function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i)},E.prototype.getPaddings=function(){var t={left:0,right:0,top:0,bottom:0};if(!this.visible)return t;var i,n,s,o,a=this.lineWidth+this.cornerRadius/2,r=this.padding;return e.isPlainObject(r)?(i=r.left||0,n=r.top||0,s=r.right||0,o=r.bottom||0):i=n=s=o=r||0,t.left=i+a,t.top=n+a,t.right=s+a,t.bottom=o+a,t},O.prototype.isInside=function(){return"inside"==this.position},O.prototype._setLineSettings=function(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.strokeDashArray=this.strokeDashArray},O.prototype.setOptions=function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i)},j.prototype=new r,j.constructor=j,j.prototype.mouseWheel=function(t,e){if(e){var i=this.view.axes.getZoomableAxes();i.length>0&&t.preventDefault();for(var n=0;n<i.length;n++)i[n]._mouseWheelZoom(e);this.view.partialDelayedUpdate()}},N.prototype=new a,N.constructor=N,N.prototype.canStart=function(t){return"zooming"!=this.view.options.mouseInteractionMode?!1:this.view.gridArea.isMouseOver?this.view.canZoom?(t.preventDefault(),!0):!1:!1},N.prototype.start=function(){this.view._clearRenderers(),this.zoomableAxes=this.view.axes.getZoomableAxes(),this.mouseInput1=this.view.mouseInput,this.currCursor=this.view.elem.css("cursor").toString(),this.view.canZoomHor&&this.view.canZoomVer?this.view.elem.css("cursor","crosshair"):this.view.canZoomHor?this.view.elem.css("cursor","e-resize"):this.view.elem.css("cursor","s-resize")},N.prototype.mouseMove=function(){var t=this.view.mouseInput;this.view._renderSelectionRect(this.mouseInput1,t)},N.prototype.mouseUp=function(){var t=this.mouseInput1,e=this.view.mouseInput,i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y);if(i>1||n>1){for(var s=this.zoomableAxes,o=0;o<s.length;o++)s[o]._scaleToRegion(t,e);this.view.partialDelayedUpdate()}this.stopTool()},N.prototype.keyDown=function(t){27==t.which&&(t.preventDefault(),this.stopTool())},N.prototype.stop=function(){this.zoomableAxes=null,this.view._clearSelectionRect(),this.view.elem.css("cursor",this.currCursor),a.prototype.stop.call(this)},F.prototype=new a,F.constructor=F,F.prototype.canStart=function(t){return"panning"!=this.view.options.mouseInteractionMode?!1:this.view.gridArea.isMouseOver?this.view.canZoom?(t.preventDefault(),!0):!1:!1},F.prototype.start=function(){this.zoomableAxes=this.view.axes.getZoomableAxes(),this.oldMouseInput=this.view.mouseInput,this.currCursor=this.view.originalCursor;var t=this.view.originalCursor=e.browser&&e.browser.mozilla?"-moz-grabbing":"move";this.view.elem.css("cursor",t)},F.prototype.mouseMove=function(){this.zoomableAxes;for(var t=this.view.mouseInput,e=this.zoomableAxes,i=this.oldMouseInput.locX-t.locX,n=this.oldMouseInput.locY-t.locY,s=0;s<e.length;s++)e[s]._moveVisibleRange(i,n);this.oldMouseInput=t,this.view.partialDelayedUpdate()},F.prototype.mouseUp=function(){this.stopTool()},F.prototype.stop=function(){this.zoomableAxes=null,this.view.originalCursor=this.currCursor,this.view._resetCursor(),a.prototype.stop.call(this)},B.prototype=new a,B.constructor=B,B.prototype.canStart=function(t){if(!this.view.canZoom)return!1;for(var e=this.view.touchInput,i=0;i<e.length;i++){var n=e[i];if(!this.view.gridArea._contains(n.locX,n.locY))return!1}return t.preventDefault(),!0},B.prototype.start=function(){this.zoomableAxes=this.view.axes.getZoomableAxes(),this.oldTouchInput=this.view.touchInput},B.prototype.touchMove=function(t){if(t.preventDefault(),!this.oldTouchInput)return this.oldTouchInput=this.view.touchInput,void 0;var e=this.view.touchInput.length;if(!(e>2)){var i=!1;2==e&&(i=!0),this.isScaling!=i&&(this.oldTouchInput=this.view.touchInput,this.isScaling=i),i?this.doScale(t):this.doPan(t)}},B.prototype.touchEnd=function(){0==this.view.touchInput.length?this.stopTool():this.oldTouchInput=null},B.prototype.stop=function(){this.zoomableAxes=null,this.oldTouchInput=null,a.prototype.stop.call(this)},B.prototype.doPan=function(){for(var t=this.zoomableAxes,e=this.view.touchInput,i=e[0],n=this.oldTouchInput[0],s=n.locX-i.locX,o=n.locY-i.locY,a=0;a<t.length;a++)t[a]._moveVisibleRange(s,o);this.oldTouchInput=e,this.view.partialDelayedUpdate()},B.prototype.doScale=function(){var t=this.view.touchInput;if(!this.oldTouchInput||2!=this.oldTouchInput.length)return this.oldTouchInput=t,void 0;for(var e=this.getTwoTouchPointData(this.oldTouchInput),i=this.getTwoTouchPointData(t),n=this.zoomableAxes,s=0;s<n.length;s++)n[s]._scaleVisibleRange(e,i);this.oldTouchInput=t,this.view.partialDelayedUpdate()},B.prototype.getTwoTouchPointData=function(t){var e={x1:t[0].locX,y1:t[0].locY,x2:t[1].locX,y2:t[1].locY};return e.centerX=(e.x1+e.x2)/2,e.centerY=(e.y1+e.y2)/2,e.dx=Math.abs(e.x2-e.x1),e.dy=Math.abs(e.y2-e.y1),e},U.prototype=new l,U.constructor=U,U.prototype._createElements=function(t){if(l.prototype._createElements.call(this,t),l.use_excanvas){this.areaCanvas=this._createCanvas(!0);var i=e('<div style="position:absolute"></div>');this.elem.append(i),i.append(this.areaCanvas),this.areaRenderer=new I(this.areaCanvas,this),this.areaRenderer.div=i,this.areaRenderer.isExcanvas=!0,this.upperCanvas=this._createCanvas(!0);var n=e('<div style="position:absolute"></div>');this.elem.append(n),n.append(this.upperCanvas),this.upperRenderer=new I(this.upperCanvas,this),this.upperRenderer.div=n,this.upperRenderer.isExcanvas=!0}this.chCanvas=this._createCanvas(),this.chRenderer=new I(this.chCanvas,this),this._createHighlightRenderer(),this.gridArea=new J(this),this.border=new E,this.paletteColors=new H,this.title=new P,this.title.chart=this,this.legend=new X,this.legend.chart=this,this.watermark=new R(this),this.toolbar=new W(this),this.noDataMessage=new P,this.noDataMessage.chart=this,this.series=new Q(this),this.axes=new be(this)},U.prototype._processOptions=function(t){var i=this;t=t||{},i.arrDataSource=null;var n=t.dataSource;if(n&&e.isArray(n))return i.arrDataSource=n,i._setOptions(t),void 0;if(e.isPlainObject(n)&&n.ajax){var s=n.ajax,o={};return e.extend(o,s),o.success=function(t){i.arrDataSource=t},o.complete=function(){i._setOptions(t)},e.ajax(o),void 0}i._setOptions(t)},U.prototype._setOptions=function(t){if(this.elem&&0!=this.elem.length){var i=t||{};"string"==typeof i.title&&(i.title={text:i.title}),i.title=i.title||{},i.title=e.extend({},e.fn.jqChart.defaults.title,i.title),i.crosshairs=e.extend(!0,{},e.fn.jqChart.defaults.crosshairs,i.crosshairs),i.tooltips=e.extend(!0,{},e.fn.jqChart.defaults.tooltips,i.tooltips),i.shadows=e.extend(!0,{},e.fn.jqChart.defaults.shadows,i.shadows),i.selectionRect=e.extend(!0,{},e.fn.jqChart.defaults.selectionRect,i.selectionRect),i.watermark=e.extend(!0,{},e.fn.jqChart.defaults.watermark,i.watermark),"string"==typeof i.noDataMessage&&(i.noDataMessage={text:i.noDataMessage}),i.noDataMessage=e.extend(!0,{},e.fn.jqChart.defaults.noDataMessage,i.noDataMessage),i.globalAlpha=h.isNull(i.globalAlpha)?e.fn.jqChart.defaults.globalAlpha:i.globalAlpha,i.mouseInteractionMode=i.mouseInteractionMode||e.fn.jqChart.defaults.mouseInteractionMode,this.hasCrosshairs=i.crosshairs.enabled===!0,this.hasTooltips=i.tooltips&&!i.tooltips.disabled,this.hasHighlighting=i.tooltips&&i.tooltips.highlighting,this.options=i,l.prototype._setOptions.call(this,i);var n=t||{};n.width?this.elem.css("width",n.width):0==this.elem.width()&&this.elem.css("width","400px"),n.height?this.elem.css("height",n.height):0==this.elem.height()&&this.elem.css("height","250px");var s=this._width=this.elem.width(),o=this._height=this.elem.height(),i=this.options;this.border.setOptions(i.border),this.border.fillStyle=i.background||this.border.fillStyle,this.gridArea.fillStyle=i.chartAreaBackground,this.paletteColors.setOptions(i.paletteColors),this.title.setOptions(i.title),this.legend.setOptions(i.legend),this.watermark.setOptions(i.watermark),this.toolbar.setOptions(i.toolbar),this.noDataMessage.setOptions(i.noDataMessage),this.series.setOptions(i.series),this.axes.setOptions(i.axes),this._setCanvasSize(this.canvas,s,o),this._setCanvasSize(this.chCanvas,s,o),this._setCanvasSize(this.hlCanvas,s,o),this.areaCanvas&&this._setCanvasSize(this.areaCanvas,s,o),this.upperCanvas&&this._setCanvasSize(this.upperCanvas,s,o),this.update()}},U.prototype._mouseEnter=function(t){l.prototype._mouseEnter.call(this,t),this.toolbar.show()},U.prototype._mouseLeave=function(t){l.prototype._mouseLeave.call(this,t),this.toolbar.hide()},U.prototype._measure=function(){return this.title._measure(),this.legend._measure(),this.watermark._measure(),this.noDataMessage._measure(),this.axes._measure()},U.prototype._arrange=function(){var t=this._width,e=this._height;this.border.width=t,this.border.height=e;var i=this.border.getPaddings();t-=i.left+i.right,e-=i.top+i.bottom;var n=i.left,s=i.top+this.title.height,o=this.axes._getTotalWidth(),a=this.axes._getTotalHeight();switch(this.legend._isHorizontal()?(this.gridArea.width=Math.round(t-o),this.gridArea.height=Math.round(e-(a+this.title.height+this.legend.height))):(this.gridArea.width=Math.round(t-(o+this.legend.width)),this.gridArea.height=Math.round(e-(a+this.title.height))),this.legend.location){case"left":n+=this.legend.width;break;case"top":s+=this.legend.height}for(var r=this.axes.verCrossingAxis,l=this.axes.horCrossingAxis,c=this.axes._getAxesInLoc("left"),h=c.length-1;h>=0;h--){var d=c[h];d.x=n,d.height=this.gridArea.height,l||(n=Math.ceil(n+d.width))}this.gridArea.x=n,n+=this.gridArea.width;for(var u=this.axes._getAxesInLoc("right"),h=0;h<u.length;h++){var d=u[h];d.x=n,d.height=this.gridArea.height,l||(n=Math.ceil(n+d.width))}for(var p=this.axes._getAxesInLoc("top"),h=p.length-1;h>=0;h--){var d=p[h];d.x=this.gridArea.x,d.y=s,d.width=this.gridArea.width,r||(s=Math.ceil(s+d.height))}this.gridArea.y=s,s+=this.gridArea.height;for(var m=this.axes._getAxesInLoc("bottom"),h=0;h<m.length;h++){var d=m[h];d.x=this.gridArea.x,d.y=s,d.width=this.gridArea.width,r||(s=Math.ceil(s+d.height))}for(var f=c.concat(u),h=0;h<f.length;h++){var d=f[h];d.y=this.gridArea.y}for(var m=this.axes._getAxesInLoc("radial"),h=0;h<m.length;h++){var d=m[h];d.x=this.gridArea.x,d.y=this.gridArea.y,d.width=this.gridArea.width,d.height=this.gridArea.height}switch(this.title.x=i.left+(t-this.title.width)/2,this.title.y=i.top,this.legend.location){case"bottom":this.legend.x=i.left+(t-this.legend.width)/2,this.legend.y=i.top+e-this.legend.height;break;case"left":this.legend.x=i.left,this.legend.y=i.top+this.gridArea.y+(this.gridArea.height-this.legend.height)/2;break;case"top":this.legend.x=i.left+(t-this.legend.width)/2,this.legend.y=i.top+this.title.height;break;case"right":default:this.legend.x=i.left+t-this.legend.width,this.legend.y=this.gridArea.y+(this.gridArea.height-this.legend.height)/2}this.gridArea._arrange(),this.axes._arrange(),this.legend._arrange(),this.noDataMessage.x=i.left+(t-this.noDataMessage.width)/2,this.noDataMessage.y=i.top+(e-this.noDataMessage.height)/2},U.prototype._processMouseMove=function(){var t=this.mouseInput;if(this.gridArea){var e=this.gridArea._contains(t.locX,t.locY);this.gridArea.isMouseOver!=e&&(e||this._clearRenderers(),this.gridArea.isMouseOver=e)}this._processMouseEvents(),this.gridArea.isMouseOver&&(this._processTooltips(t),this._initCrosshairs(t))},U.prototype._initTouchInput=function(t){l.prototype._initTouchInput.call(this,t);var e=this.touchInput[0];if(this.gridArea&&e){var i=this.gridArea._contains(e.locX,e.locY);this.gridArea.isTouchOver!=i&&(i||this._clearRenderers(),this.gridArea.isTouchOver=i)}},U.prototype._processTouchStart=function(t){if(this.gridArea.isTouchOver){var e=this.touchInput[0];t.preventDefault(),this._processTooltips(e),this._initCrosshairs(e)}},U.prototype._processTouchMove=function(t){if(this.gridArea.isTouchOver){var e=this.touchInput[0];t.preventDefault(),this._processTouchEvents(),this._processTooltips(e),this._initCrosshairs(e)}},U.prototype._clearRenderers=function(){l.prototype._clearRenderers.call(this),this.chRenderer&&this.chRenderer._clear()},U.prototype._getClosestShapeAtX=function(t,e){for(var i=null,n=Le,s=e.locX,o=t.length-1;o>=0;o--){var a=t[o];if(a.context&&!a.isLegendItem&&!a.isAxisLabel){var r=a.context.series;if(!r.tooltips||!r.tooltips.disabled){var l=a.getCenter(e),c=Math.abs(l.x-s);n>c&&(n=c,i=a,l.mark&&(i=l.mark))}}}return i},U.prototype._getClosestShapeAtY=function(t,e){for(var i=null,n=Le,s=e.locY,o=t.length-1;o>=0;o--){var a=t[o],r=a.getCenter(e).y,l=Math.abs(r-s);n>l&&(n=l,i=a)}return i},U.prototype._getShapesAtX=function(t,i,n,s){for(var o=[i],a=[i.context.series],r=[0],l=0;l<n.length;l++){var c=n[l];if(c!=i&&c.context&&!c.isLegendItem&&!c.isAxisLabel){var h=c.context.series,d=e.inArray(h,a);if(0!=d){var u=c.getCenter(s),p=Math.abs(t-u.x);if(!(p>=3))if(-1==d)u.mark?o.push(u.mark):o.push(c),a.push(h),r.push(p);else{var m=r[d];m>p&&(o[d]=u.mark?u.mark:c,r[d]=p)}}}}return o},U.prototype._getTooltipShapes=function(t,i,n,s){var o=null,a=this.options.tooltips;if("shared"==a.type){var r=this._getClosestShapeAtX(this.shapes,s);r&&(o=this._getShapesAtX(r.getCenter(s).x,r,this.shapes,s))}else o=l.prototype._getTooltipShapes.call(this,t,i,n,s);return o&&(series=this.series.items,o.sort(function(t,i){var n=e.inArray(t.context.series,series),s=e.inArray(i.context.series,series);return n-s})),o},U.prototype._getTooltip=function(t){return t.context.series._getTooltip(t.context)},U.prototype._getTooltipText=function(t){for(var i="",n=this,s=[],o=0;o<t.length;o++){var a=t[o];if(a.context.series){var r=a.context.series.realXAxis;if(r&&a.context.x&&-1==e.inArray(r,s)){var l=r._getTooltip(a.context.x);i+=l,s.push(r)}}}return e.each(t,function(){var t=n._getTooltip(this);t&&(i+=t)}),i},U.prototype._initCrosshairs=function(t){if(this.hasCrosshairs){var e=this.options.crosshairs,i=t.locX,n=t.locY;if(e.snapToDataPoints){var s=this._getClosestShapeAtX(this.shapes,t);if(s){var o=this._getShapesAtX(s.getCenter(t).x,s,this.shapes,t);if(s=this._getClosestShapeAtY(o,t)){var a=s.getCenter(t);i=a.x,n=a.y}}}this._renderCrosshairs(i,n)}},U.prototype._renderCrosshairs=function(t,i){if(this.hasCrosshairs){var n=this.gridArea;
if(n._contains(t,i)){var s=this.options.crosshairs,o=[];if(s.hLine&&s.hLine.visible){var a=new p(n.x,i,n.x+n.width,i);s.hLine&&e.extend(a,s.hLine),o.push(a)}if(s.vLine&&s.vLine.visible){var r=new p(t,n.y,t,n.y+n.height);s.vLine&&e.extend(r,s.vLine),o.push(r)}this.chRenderer._clear(),this.chRenderer._render(o)}}},U.prototype._renderSelectionRect=function(t,i){var n=this.gridArea,s=n.fitHor(t.locX),o=n.fitVer(t.locY),a=n.fitHor(i.locX),r=n.fitVer(i.locY);this.canZoomVer?this.canZoomHor||(s=n.x,a=n.x+n.width):(o=n.y,r=n.y+n.height);var l=Math.min(s,a),c=Math.min(o,r),h=Math.abs(s-a),d=Math.abs(o-r),u=new m(l,c,h,d);e.extend(u,this.options.selectionRect),this.chRenderer._clear(),this.chRenderer._render([u])},U.prototype._clearSelectionRect=function(){this.chRenderer._clear()},U.prototype._initZooming=function(){var t=this;t.canZoomVer=!1,t.canZoomHor=!1,e.each(this.axes.items,function(){this.zoomEnabled&&"radial"!=this.location&&(this.isAxisVertical?t.canZoomVer=!0:t.canZoomHor=!0)}),this.canZoom=this.canZoomVer||this.canZoomHor},U.prototype._triggerShapeEvent=function(t,e){var i=e.isLegendItem?"legendItem":"dataPoint";e.isAxisLabel&&(i="axisLabel"),e.context.shape=e,this.elem.trigger(i+t,e.context)},U.prototype.setOptions=function(){},U.prototype.clear=function(){l.prototype.clear.call(this),l.use_excanvas&&(this.areaRenderer._clear(),this.upperRenderer._clear())},U.prototype._setClip=function(t){var e=this.gridArea;t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.clip()},U.prototype._createShapes=function(){var t={},i=[],n=this.gridArea,s=t.shapes=[];if(this.border._render(s),this.hasData){this.title._render(s);var o=this.legend._render(s);t.gaShapes=[],n._render(t.gaShapes),t.axesShapes=[];var a=this.axes._render(t.axesShapes);t.postAxisShapes=a.postShapes;var r=t.nonGridAreaSerShapes=[];this.series._render(r);var l=t.serShapes=[],c=n._renderSeries(l);e.merge(r,c),e.merge(i,l),e.merge(i,r),e.merge(i,o),e.merge(i,a.contextShapes)}else this.noDataMessage._render(s);s=t.ws=[],this.watermark._render(s),this.shapes=i,this.allShapes=t},U.prototype._renderShapes=function(){var t=l.isRetinaDisplay,i=this._width,n=this._height;t&&(this._setRetinaDispOpts(this.canvas,i,n),this._setRetinaDispOpts(this.chCanvas,i,n),this._setRetinaDispOpts(this.hlCanvas,i,n)),this.shapeRenderer._clear(),l.use_excanvas&&(this.areaRenderer._clear(),this.upperRenderer._clear()),this.gridArea;var s=this.allShapes;if(this.shapeRenderer._render(s.shapes),this.hasData){var o=s.gaShapes;l.use_excanvas?this.areaRenderer._render(o):(this.ctx.save(),this._setClip(this.ctx),this.shapeRenderer._renderShadows(o),this.shapeRenderer._render(o),this.ctx.restore());var a=s.serShapes;a.length>0&&this.elem.trigger("seriesShapesRendering",[a]),l.use_excanvas?this.areaRenderer._render(a):(this.ctx.save(),this._setClip(this.ctx),this.shapeRenderer._renderShadows(a),this.shapeRenderer._render(a),this.ctx.restore());var r;r=l.use_excanvas?this.upperRenderer:this.shapeRenderer,r._render(s.axesShapes);var c=s.nonGridAreaSerShapes;c.length>0&&this.elem.trigger("seriesShapesRendering",[c]),r._renderShadows(c),r._render(c),r._render(s.postAxisShapes)}this.shapeRenderer._render(s.ws),t&&(e(this.canvas).css({width:i,height:n}),e(this.chCanvas).css({width:i,height:n}),e(this.hlCanvas).css({width:i,height:n}))},U.prototype.stringFormat=function(t,i){return"date"==e.type(t)?e.jqChartDateFormatter(t,i):e.jqChartSprintf(i,t)},U.prototype.render=function(){this._clearRenderers(),this._createShapes(),this._renderShapes()},U.prototype.findAxis=function(t){return this.axes?this.axes.find(t):void 0},U.prototype.update=function(){this.hasData=this.series.hasData(),this.series._initData(),this.axes._initSeriesAxes(),this.axes._initSeries(),this._initZooming(),this.axes._initRanges(),this.series._initVisibleData(),this.series._initColors(),this.legend._init(),this.axes._resetWH(),this.axes._initCrossingAxes();for(var t=!1,e=0;10>e&&(t=this._measure(),this._arrange(),this.axes._updateOrigins(),this.axes._initRanges(),this.axes._updateCrossings(),this.axes._correctOrigins(),0!=t);e++);this.toolbar._init(),this.render(),this.storyboard.begin()},U.prototype.partialDelayedUpdate=function(){this.timer.kick()},U.prototype.partialUpdate=function(){this.series._initVisibleData(),this.axes._resetWH();var t=!1;this.axes._initRanges();for(var e=0;10>e&&(t=this._measure(),this._arrange(),this.axes._updateOrigins(),this.axes._initRanges(),this.axes._updateCrossings(),this.axes._correctOrigins(),0!=t);e++);this.render()},U.prototype.highlightData=function(t){var e=l.prototype.highlightData.call(this,t);if(e){var i=e[0].getCenter();this._renderCrosshairs(i.x,i.y)}},U.prototype.destroy=function(){this.axes.clear(),l.prototype.destroy.call(this)},U.prototype.exportToImage=function(t){this._exportToImage(t,e.fn.jqChart.defaults.exportConfig)},U.prototype.exportToPdf=function(t){this._exportToPdf(t,e.fn.jqChart.defaults.exportConfig)},U.prototype.toJSON=function(t){var i=this.gridArea,n=this.options.shadows,s=n&&n.enabled,o=new M(i.x,i.y,i.width,i.height),a=new k,n=new D(!0),r=new D(!1),l=this.allShapes,c=[];return e.merge(c,l.shapes),this.hasData&&(c.push(o),s&&(c.push(n),e.merge(c,l.gaShapes),c.push(r)),e.merge(c,l.gaShapes),c.push(a),e.merge(c,l.axesShapes),c.push(o),s&&(c.push(n),e.merge(c,l.serShapes),c.push(r)),e.merge(c,l.serShapes),c.push(a),s&&(c.push(n),e.merge(c,l.nonGridAreaSerShapes),c.push(r)),e.merge(c,l.nonGridAreaSerShapes),e.merge(c,l.postAxisShapes)),e.merge(c,l.ws),this._toJSON(c,t)},z.prototype=new u,z.constructor=new z,z.prototype.createElements=function(t,e,i,n,s,o){var a=[],r=o/2,l=new p(t,e,t,i);a.push(l),l=new p(t-r,n,t,n),a.push(l),l=new p(t,s,t+r,s),a.push(l),this.items=a},z.prototype.hitTest=function(t,e,i){if(i)return this.boundsHitTest(t,e,i);for(var n=0;n<this.items.length;n++){var s=this.items[n];if(s.hitTest(t,e,i))return!0}return!1},z.prototype.render=function(t){if(this.visible){u.prototype.render.call(this,t);for(var e=0;e<this.items.length;e++){var i=this.items[e];this.setProperties(i),this.isUp?this.priceUpStrokeStyle&&(i.strokeStyle=this.priceUpStrokeStyle):this.priceDownStrokeStyle&&(i.strokeStyle=this.priceDownStrokeStyle),i.render(t)}}},z.prototype._createHighlightShape=function(t,i){var n=new z;return e.extend(n,this),n.fillStyle=t,n.priceUpFillStyle=t,n.priceDownFillStyle=t,n.strokeStyle=i,n.lineWidth+=2,n},z.prototype.getTooltipColor=function(){return this.isUp&&this.priceUpStrokeStyle?u.getColorFromFillStyle(this.priceUpStrokeStyle):this.priceDownStrokeStyle?u.getColorFromFillStyle(this.priceDownStrokeStyle):u.prototype.getTooltipColor.call(this)},z.prototype.toJSON=function(){var t=this,e="type:'stock',x:"+t.x+",width:"+t.width+",high:"+t.high+",low:"+t.low+",open:"+t.open+",close:"+t.close;return t.priceUpStrokeStyle&&(e+=",priceUpStrokeStyle:'"+t.priceUpStrokeStyle+"'"),t.priceDownStrokeStyle&&(e+=",priceDownStrokeStyle:'"+t.priceDownStrokeStyle+"'"),e+=u.prototype.toJSON.call(this)},V.prototype=new z,V.constructor=new V,V.prototype.createElements=function(t,e,i,n,s,o){var a=[],r=Math.floor(o/2),t=Math.round(t),l=Math.round(n),c=Math.round(s);if(l>c){var h=c;c=l,l=h}if(e>i){var h=i;i=e,e=h}if(c-l>=1){var d=new m(t-r,l,2*r,c-l);d.useHitTestArea=!0,a.push(d)}else{var u=new p(t-r,l,t+r,l);a.push(u)}var u=new p(t,e,t,l);a.push(u);var u=new p(t,c,t,i);a.push(u),this.items=a},V.prototype.render=function(t){if(this.visible){u.prototype.render.call(this,t);for(var e=0;e<this.items.length;e++){var i=this.items[e];this.setProperties(i),i instanceof m&&(i.fillStyle=this.isUp?this.priceUpFillStyle:this.priceDownFillStyle),i.render(t)}}},V.prototype.getTooltipColor=function(){return this.isUp?u.getColorFromFillStyle(this.priceUpFillStyle):u.getColorFromFillStyle(this.priceDownFillStyle)},V.prototype.toJSON=function(){var t=this,e="type:'candlestick',x:"+t.x+",width:"+t.width+",high:"+t.high+",low:"+t.low+",open:"+t.open+",close:"+t.close;return t.priceUpFillStyle&&(e+=",priceUpFillStyle:"+t.fillStyleToJSON(t.priceUpFillStyle)),t.priceDownFillStyle&&(e+=",priceDownFillStyle:"+t.fillStyleToJSON(t.priceDownFillStyle)),e+=u.prototype.toJSON.call(this)},H.prototype.setOptions=function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i)},H.prototype.getColor=function(t){var e=this.getColors(this.type),i=e.length;return t%=i,e[t]},H.prototype.getColors=function(t){switch(t.toLowerCase()){case"customcolors":return this.customColors;case"grayscale":return this.colorsGrayScale;case"default":default:return this.colorsDefault}},W.prototype={setOptions:function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i)},_init:function(){var t=this.toolbar,i=this.chart;if("hidden"==this.visibility||"auto"==this.visibility&&!i.canZoom)return t&&(t.remove(),this.toolbar=null),void 0;t||(this.toolbar=t=e('<ul onselectstart="return false;" class="ui-jqchart-toolbar ui-widget ui-widget-content ui-corner-all"></ul>'),this._addButtons(),t.hide(),i.elem.append(t),t.mousedown(function(t){return t.preventDefault(),!1}),t.mouseenter(function(t){return i._clearRenderers(),t.preventDefault(),!1}),t.mousemove(function(t){return t.preventDefault(),!1}));var n=t.outerWidth(),s=t.outerHeight(),o=i.gridArea,a=o.x,r=o.y;switch(this.hAlign){case"center":a+=(o.width-n)/2;break;case"right":a+=o.width-n}switch(this.vAlign){case"center":r+=(o.height-s)/2;break;case"bottom":r+=o.height-s}t.css({left:a,top:r}),"visible"==this.visibility&&t.show()},_addButtons:function(){var t=this.toolbar,i=this.chart,n=e("<li class='ui-corner-all ui-widget-header'><span class='ui-icon ui-icon-arrow-4-diag'></span></li>");if(t.append(n),this._addHover(n),n.attr("title",this.resetZoomTooltipText),n.mousedown(function(t){t.preventDefault();for(var e=i.axes.items,n=0;n<e.length;n++)e[n].resetZoom();return i.partialDelayedUpdate(),!1}),this.zoomingButtonVisible||this.panningButtonVisible){var s=e("<li class='ui-jqchart-toolbar-separator'></li>");if(t.append(s),this.panningButtonVisible){var o=e("<li class='ui-corner-all ui-widget-header'><span class='ui-icon ui-icon-arrow-4'></span></li>");t.append(o),this._addHover(o),o.attr("title",this.panningTooltipText),o.mousedown(function(t){return t.preventDefault(),i.options.mouseInteractionMode="panning",o.addClass("ui-state-active"),a.removeClass("ui-state-active"),!1}),"zooming"!==i.options.mouseInteractionMode&&o.addClass("ui-state-active")}if(this.zoomingButtonVisible){var a=e("<li class='ui-corner-all ui-widget-header'><span class='ui-icon ui-icon-zoomin'></span></li>");t.append(a),this._addHover(a),a.attr("title",this.zoomingTooltipText),a.mousedown(function(t){return t.preventDefault(),i.options.mouseInteractionMode="zooming",o.removeClass("ui-state-active"),a.addClass("ui-state-active"),!1}),"zooming"===i.options.mouseInteractionMode&&a.addClass("ui-state-active")}}},_addHover:function(t){t.hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")})},show:function(){this.toolbar&&"auto"==this.visibility&&this.toolbar.stop(!0,!0).fadeIn("slow")},hide:function(){this.toolbar&&"auto"==this.visibility&&this.toolbar.stop(!0,!0).fadeOut("slow")}},G.prototype._setShapeSettings=function(t){t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.lineCap=this.lineCap,t.lineJoin=this.lineJoin,t.miterLimit=this.miterLimit,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.cursor=this.cursor},G.prototype._setLineSettings=function(t){t.lineWidth=this.linkLineWidth,t.strokeStyle=this.linkLineStrokeStyle},G.prototype.setOptions=function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i)},G.prototype.getSize=function(){return{width:this.size,height:this.size}},G.prototype.getShape=function(t,e,i,n){if(this.visible===!1)return null;var s=2*i,o=null;switch(this.type){case"circle":o=new v(t-i,e-i,i);break;case"rectangle":o=new m(t-i,e-i,s,s);break;case"diamond":var a=[];a.push(t),a.push(e-i),a.push(t+i),a.push(e),a.push(t),a.push(e+i),a.push(t-i),a.push(e),o=new S(a),o.isBoundsHitTest=!0;break;case"triangle":var a=[];a.push(t),a.push(e-i),a.push(t+i),a.push(e+i),a.push(t-i),a.push(e+i),o=new S(a),o.isBoundsHitTest=!0;break;case"line":o=new p(t-i,e,t+i,e);break;case"plus":var a=[];a.push(t-i),a.push(e),a.push(t+i),a.push(e),a.push(null),a.push(null),a.push(t),a.push(e-i),a.push(t),a.push(e+i),o=new y(a,!0);break;case"image":if(!n)return null;o=new A(t,e,n)}return o.useHitTestArea=!0,o.center={x:Math.round(t),y:Math.round(e)},o},G.prototype.isVisible=function(){return this.visible!==!1&&"none"!=this.type},q.prototype._setLineSettings=function(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.strokeDashArray=this.strokeDashArray},q.prototype.setOptions=function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i)},Y.prototype={_setLineSettings:function(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.strokeDashArray=this.strokeDashArray},setOptions:function(t){null!=t&&"string"==typeof t.title&&(t.title={text:t.title},e.extend(t.title,this.defaults.title));var i=e.extend(!0,{},this.defaults,t||{});e.extend(this,i)}},Z.prototype={_setShapeSettings:function(t){t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.strokeDashArray=this.strokeDashArray},setOptions:function(t){null!=t&&"string"==typeof t.title&&(t.title={text:t.title},e.extend(t.title,this.defaults.title));var i=e.extend(!0,{},this.defaults,t||{});e.extend(this,i)}},X.prototype._isHorizontal=function(){return"top"==this.location||"bottom"==this.location?!0:!1},X.prototype._init=function(){if(this.items=[],0!=this.visible)if(this.customItems)for(var t=0;t<this.customItems.length;t++){var i=this.customItems[t];null!=i&&"string"==typeof i.text&&(i.text={text:i.text});var n={marker:{type:"rectangle",fillStyle:"#418CF0"}};i=e.extend(!0,{},n,i||{});var s=new G(i.marker);i.marker=s;var o={};e.extend(o,i),o.text=i.text.text,o.font=i.text.font||"12px sans-serif",o.textFillStyle=i.text.fillStyle||"black",o.textStrokeStyle=i.text.strokeStyle,o.textLineWidth=i.text.lineWidth,o.context={chart:this.chart,title:o.text},o.cursor=this.itemsCursor;var a=new K(o);a.chart=this.chart,this.items.push(a)}else for(var r={font:this.font,textStrokeStyle:this.textStrokeStyle,textFillStyle:this.textFillStyle,textLineWidth:this.textLineWidth,cursor:this.itemsCursor},l=this.chart.series.items,t=0;t<l.length;t++){var c=l[t];c.visible&&e.merge(this.items,c._getLegendItems(r))}},X.prototype._measure=function(){if(0==this.visible)return this.width=0,this.height=0,void 0;var t=this.paddings=this.border.getPaddings();this.title._measure();var e=this.title.width,i=this.title.height;this.title.text&&(i+=t.top);for(var n=this._isHorizontal(),s=0,o=0,a=0,r=0;r<this.items.length;r++){var l=this.items[r];l._measure(),n?(s+=l.width+this._itemMargin,o=Math.max(o,l.height),a=Math.max(a,l.width+this._itemMargin)):(s=Math.max(s,l.width),o+=l.height)}var c=2*this.margin+t.left+t.right,h=2*this.margin+t.top+t.bottom,d=this.chart.border.getPaddings(),u=this.chart._width-d.left-d.right-c;if(n&&s>u){var p=Math.floor(u/a)||1,m=Math.ceil(this.items.length/p);this.rows=p,this.cellHeight=o+this._itemMargin,this.cellWidth=a,s=p*a,o=m*o+(m-1)*this._itemMargin}else this.rows=0;e=Math.max(e,s),i+=o,this.width=this.isCustomWidth||e+c,this.height=this.isCustomHeight||i+h},X.prototype._arrange=function(){if(0!=this.visible){var t=this.x+this.margin,e=this.y+this.margin,i=2*this.margin;this.border.x=t,this.border.y=e;var n=this.width-i;this.border.width=n,this.border.height=this.height-i;var s=this.paddings;n-=s.left+s.right,t+=s.left,e+=s.top,this.title.text&&(this.title.x=t+(n-this.title.width)/2,this.title.y=e,e+=this.title.height+s.top);for(var o=this._isHorizontal(),a=this.rows,r=0;r<this.items.length;r++){var l=this.items[r];l.x=t,l.y=e,o?a?(l.x+=r%a*this.cellWidth,l.y+=Math.floor(r/a)*this.cellHeight):t+=l.width+this._itemMargin:e+=l.height,l._arrange()}}},X.prototype._render=function(t){if(0==this.visible)return[];this.border._render(t),this.title._render(t);for(var i=[],n=0;n<this.items.length;n++){var s=this.items[n],o=s._render(t);e.merge(i,o)}return i},X.prototype.setOptions=function(t){null!=t&&"string"==typeof t.title&&(t.title={text:t.title},e.extend(t.title,this.defaults.title));var i=e.extend(!0,{},this.defaults,t||{});e.extend(this,i),this.margin=i.margin,t&&(this.isCustomWidth=t.width,this.isCustomHeight=t.height),this.border=new E(i.border),this.border.fillStyle=this.background||this.border.fillStyle,this.title=new P(i.title),this.title.chart=this.chart},K.prototype._measure=function(){var t;t=this.text?this.textBlock.measure(this.chart.ctx):{width:0,height:0},this.width=t.width+this.marker.size+this.lblMargin,this.height=t.height},K.prototype._arrange=function(){var t=this.marker.size/2,e=this.x+t,i=this.y+t+(this.height-this.marker.size)/2;this.markerShape=this.marker.getShape(e,i,t),this.markerShape&&(this.marker._setShapeSettings(this.markerShape),this.markerShape.context=this.context,this.markerShape.cursor=this.cursor,this.markerShape.isLegendItem=!0),this.textBlock.x=this.x+this.marker.size+this.lblMargin,this.textBlock.y=this.y},K.prototype._render=function(t){var i=[];return this.markerShape&&i.push(this.markerShape),this.textBlock&&i.push(this.textBlock),e.merge(t,i),i},K.prototype.setOptions=function(t){var i=e.extend(!1,{},this.defaults,t||{});e.extend(this,i),this.textBlock=new T(this.text),this.textBlock.textBaseline="top",this.textBlock.font=this.font,this.textBlock.fillStyle=this.textFillStyle,this.textBlock.strokeStyle=this.textStrokeStyle,this.textBlock.lineWidth=this.textLineWidth,this.textBlock.cursor=this.cursor,this.textBlock.context=this.context,this.textBlock.isLegendItem=!0},J.prototype._arrange=function(){var t=this.x,e=this.y;this.border.x=t,this.border.y=e,this.border.width=this.width,this.border.height=this.height,this._arrangeRenderer(this.chart.areaRenderer),this._arrangeRenderer(this.chart.hlRenderer)},J.prototype._arrangeRenderer=function(t){if(l.use_excanvas){var e=this.x,i=this.y,n=t.canvas,s=t.div,o=Math.max(this.width,0),a=Math.max(this.height,0);s.css({left:e,top:i,width:o,height:a}),n.width=o,n.height=a,t.offsetX=-e,t.offsetY=-i}},J.prototype._render=function(t){this.border.fillStyle=this.fillStyle,this.border._render(t);var i=this._renderPlots(t);this._renderGridLines(t),e.merge(t,i)},J.prototype._renderSeries=function(t){for(var i=this.chart.series.items,n=[],s=0;s<i.length;s++){var o=i[s];if(!o.notInGridArea){var a=o._render(t);a&&e.merge(n,a)}}return n},J.prototype._renderStripes=function(t){for(var i=this.chart.axes.items,n=0;n<i.length;n++){var s=i[n],o=this._getStripes(s);e.merge(t,o)}},J.prototype._renderPlots=function(t){for(var i=[],n=this.chart.axes.items,s=0;s<n.length;s++){var o=n[s],a=this._getPlotBands(o);a&&(e.merge(t,a.shapes),e.merge(i,a.texts));var r=this._getPlotLines(o);r&&(e.merge(t,r.shapes),e.merge(i,r.texts))}return i},J.prototype._renderGridLines=function(t){for(var i=this.chart.axes.items,n=0;n<i.length;n++){var s=i[n],o=s.majorGridLines;null==o&&"y"==s.getOrientation()&&(o=new q,null!=s.minorGridLines&&(s.minorGridLines.major=o));var a=this._getGridLines(s,s.minorGridLines,!1);e.merge(t,a);var r=this._getGridLines(s,o,!0);e.merge(t,r)}},J.prototype._getStripes=function(t){var i=t.stripes;if(null==i||1!=e.isArray(i))return[];var n=this,s=[];return e.each(i,function(){var e,i=new Stripe(this);e=i.interval?i.interval:2*t.actualInterval;var o;o=i.width?i.width:t.actualInterval;for(var a=i.lineWidth,r=a/2,l=t._getIntervals(e,i,!0),c=0;c<l.length;c++){var h=l[c];if(!(h>=t.actualVisibleMaximum)){var d,u=t.getPosition(h),p=t._getNextPosition(h,o),f=t.getPosition(p);d=t.isAxisVertical?new m(n.x+r,Math.min(u,f),n.width-a,Math.abs(f-u)):new m(Math.min(u,f),n.y+r,Math.abs(f-u),n.height-a),i._setSettings(d),s.push(d)}}}),s},J.prototype._getGridLines=function(t,e,i){if("radial"==t.location||null==e||1!=e.visible)return[];for(var n,s,o,a,r=[],l=t._getMarkInterval(e,i),c=t._getIntervals(l,e,i),h=0;h<c.length;h++){var d=t.getPosition(c[h]);t.isAxisVertical?(s=a=d,n=this.x,o=n+this.width):(n=o=d,s=this.y,a=s+this.height);var u=new p(n,s,o,a);e._setLineSettings(u),r.push(u)}return r},J.prototype._getPlotLines=function(t){var i=t.plotLines;if(null==i||1!=e.isArray(i))return null;for(var n=this,s=[],o=[],a=0;a<i.length;a++){var r=new Y;t.isAxisVertical||(r.defaults.title.hAlign="right"),r.setOptions(i[a]);var l=r.lineWidth/2,c=t.getPosition(r.value),d=new P(r.title);if(d.chart=this.chart,d._measure(),t.isAxisVertical){switch(y1=y2=c,x1=this.x,x2=x1+this.width,d.x=x1,d.y=y1,d.hAlign){case"center":d.x=n.x+(n.width-d.width)/2;break;case"right":d.x=n.x+n.width-d.width}switch(d.vAlign){case"bottom":d.y+=l;break;case"center":d.y-=d.height/2;break;case"top":d.y-=d.height+l}}else{switch(x1=x2=c,y1=this.y,y2=y1+this.height,d.x=x1,d.y=y1,d.hAlign){case"right":d.x+=l;break;case"center":d.x-=d.height/2;break;case"left":d.x-=d.height+l}switch(d.vAlign){case"center":d.y+=(n.height-d.width)/2;break;case"bottom":d.y+=n.height-d.width}d.rotX=d.x+d.height-d.margin,d.rotY=d.y+d.margin,d.rotationAngle=h.radians(90)}var u=new p(x1,y1,x2,y2);r._setLineSettings(u),s.push(u),d._render(o)}return{shapes:s,texts:o}},J.prototype._getPlotBands=function(t){var i=t.plotBands;if(null==i||1!=e.isArray(i))return null;for(var n=this,s=[],o=[],a=0;a<i.length;a++){var r=new Z;t.isAxisVertical||(r.defaults.title.hAlign="right"),r.setOptions(i[a]);var l,c,d,u,p=r.lineWidth,f=p/2,g=t.getPosition(r.from),v=t.getPosition(r.to);t.isAxisVertical?(l=n.x+f,c=Math.min(g,v),d=n.width-p,u=Math.abs(v-g)):(l=Math.min(g,v),c=n.y+f,d=Math.abs(v-g),u=n.height-p);var _=new m(l,c,d,u);r._setShapeSettings(_),s.push(_);var b=new P(r.title);if(b.chart=this.chart,b._measure(),t.isAxisVertical){switch(b.x=l,b.y=c,b.hAlign){case"center":b.x+=(d-b.width)/2;break;case"right":b.x+=d-b.width}switch(b.vAlign){case"center":b.y+=(u-b.height)/2;break;case"bottom":b.y+=u-b.height}}else{switch(b.x=l,b.y=c,b.hAlign){case"center":b.x+=(d-b.height)/2;break;case"right":b.x+=d-b.height}switch(b.vAlign){case"center":b.y+=(u-b.width)/2;break;case"bottom":b.y+=u-b.width}b.rotX=b.x+b.height-b.margin,b.rotY=b.y+b.margin,b.rotationAngle=h.radians(90)}b._render(o)}return{shapes:s,texts:o}},J.prototype._contains=function(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height},J.prototype.getRight=function(){return this.x+this.width},J.prototype.fitHor=function(t){return h.fitInRange(t,this.x,this.getRight())},J.prototype.fitVer=function(t){return h.fitInRange(t,this.y,this.y+this.height)},Q.prototype.setOptions=function(t){if(this.items=[],0!=e.isArray(t)){for(var i=0;i<t.length;i++){var n=t[i];if(null!=n){var s,o=n.type||"column";switch(o=o.toLowerCase()){case"area":s=new ie(n);break;case"splinearea":s=new ne(n);break;case"bar":s=new se(n);break;case"line":s=new ee(n);break;case"stepline":s=new ce(n);break;case"steparea":s=new he(n);break;case"spline":s=new le(n);break;case"pie":s=new ae(n);break;case"scatter":s=new re(n);break;case"stackedcolumn":s=new de(n);break;case"stackedbar":s=new ue(n);break;case"stacked100column":s=new pe(n);break;case"stacked100bar":s=new me(n);break;case"rangecolumn":s=new fe(n);break;case"rangebar":s=new ge(n);break;case"band":s=new BandSeries(n);break;case"verticalarea":s=new ve(n);break;case"range":s=new _e(n);break;case"column":default:s=new oe(n)}s.type=o,s.chart=this.chart,this.items.push(s)}}this._processData()}},Q.prototype._processData=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i.visible&&i._processData()}},Q.prototype._initData=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i.visible&&i._initData()}},Q.prototype._initVisibleData=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i.visible&&i._initVisibleData()}},Q.prototype._initCategories=function(){for(var t=[],e=0,i=0,n=this.items,s=0;s<n.length;s++){var o=n[s];if(o.visible&&o.categories){for(i=e;i<o.categories.length;i++){var a=o.categories[i];t.push(a)}e=i}}this.categories=t},Q.prototype._initRanges=function(){for(var t=Le,e=Ae,i=Le,n=Ae,s=this.items,o=0;o<s.length;o++){var a=s[o];a.visible&&(t>a.min&&(t=a.min),e<a.max&&(e=a.max),i>a.minX&&(i=a.minX),n<a.maxX&&(n=a.maxX))}this.min=t,this.max=e,this.minX=i,this.maxX=n},Q.prototype._findClusters=function(t,e){for(var i=-1,n=0,s=this.items,o=0;o<s.length;o++){var a=s[o];a.visible&&(a==t&&(i=n),a.type==e&&n++)}return{index:i,count:n}},Q.prototype._findStackedClusters=function(t,i){for(var n=t.stackedGroupName,s=this._getStackedGroupsFromType(i),o=e.inArray(n,s),a=s.length,r=-1,l=0,c=this.items,h=0;h<c.length;h++){var d=c[h];d.visible&&(d==t&&(r=l),d.type==i&&d.stackedGroupName==n&&l++)}return{index:r,count:l,groupIndex:o,groupCount:a}},Q.prototype._getSeriesFromType=function(t){for(var e=[],i=this.items,n=0;n<i.length;n++){var s=i[n];s.visible&&s.type==t&&e.push(s)}return e},Q.prototype._getStackedSeriesFromType=function(t,e){for(var i=[],n=this.items,s=0;s<n.length;s++){var o=n[s];o.visible&&o.type==t&&o.stackedGroupName==e&&i.push(o)}return i},Q.prototype._getStackedGroupsFromType=function(t){var i=[];return e.each(this.items,function(){if(this.visible&&this.type==t){var n=e.inArray(this.stackedGroupName,i);-1==n&&i.push(this.stackedGroupName)}}),i},Q.prototype._initColors=function(){for(var t=this.chart.paletteColors,e=this.items,i=0;i<e.length;i++){var n=e[i];n._initColors(t.getColor(i),t)}},Q.prototype._getPixelMargins=function(t){for(var e=0,i=0,n=this.items,s=0;s<n.length;s++){var o=n[s];if(o.visible){var a=o._getPixelMargins(t);e=Math.max(e,a.left),i=Math.max(i,a.right)}}return{left:e,right:i}},Q.prototype._isAnchoredToOrigin=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];if(i.visible&&i._isAnchoredToOrigin())return!0}return!1},Q.prototype._render=function(t){for(var e=this.items,i=0;i<e.length;i++){var n=e[i];n.visible&&n.notInGridArea&&n._render(t)}},Q.prototype.getSeries=function(t){return this.items[t]},Q.prototype.hasData=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];if(i.visible&&i.hasData())return!0}return!1},te.prototype={_getMarker:function(t,e,i,n,s){null==i&&(i=this.markers.size/2);var o=this.markers.getShape(t,e,i,s);return null==o?null:(this.markers._setShapeSettings(o),this._setMarkerSettings(o),o)},_addMarker:function(t,e,i,n,s){var o=this._correctMarkerPosition(t,e,n),a=this._getMarker(o.x,o.y,i,n,s),r=this.markers.offset,l=null;return r&&(l=new p(t,e,o.x,o.y),this.markers._setLineSettings(l),this._setMarkerLinkLineSettings(l)),{marker:a,line:l,offset:o.offset}},_correctMarkerPosition:function(t,e,i){var n=this.markers.offset;if(n){var s=i>=this.realYAxis.getCrossing();e=s?e-n:e+n}return{x:t,y:e,offset:n}},_addMarkerAndLabel:function(t,e,i,n,s,o,a,r,l,c){var h=0,d=a?a:s;if(c||(c={chart:this.chart,series:this,dataItem:this.arrData[s],index:s,x:this.realXAxis._getValue(d),y:r}),this.markers&&this.markers.isVisible()&&this.realYAxis.isValueVisible(r)){var u=c.dataItem[2],p=this._addMarker(i,n,null,r,u);p.marker&&(p.marker.context=c,p.line&&t.push(p.line),t.push(p.marker),h=this.markers.offset,this._addShapeAnimation(p.marker,s,o))}if(this.labels&&this.labels.visible!==!1){var m=this._getLabelValue(r,s);"percentage"==this.labels.valueType&&(m=c.percentage);var f=this._getDataPointLabel(r,i,n,l+h,m);f.context=c,this.chart.elem.trigger("dataPointLabelCreating",f),e.push(f),this._addShapeAnimation(f,s,o)}},_getAnimation:function(){return this.animation||this.chart.options.animation},_addShapeAnimation:function(t,e,i){var n=this._getAnimation();if(n&&n.enabled!==!1){var s=new o(n,t,"visible",!1,!0),a=s.duration/i,r=s.delayTime+e*a;s.delayTime=r,s.duration=a,this.chart.storyboard.addAnimation(s)}},_addLengthAnimation:function(t){var e=this._getAnimation();if(e&&e.enabled!==!1){var i=new s(e,t,"length",0,t.getLength());this.chart.storyboard.addAnimation(i)}},_setMarkerSettings:function(t){t.fillStyle=t.fillStyle||this.fillStyle,t.cursor=t.cursor||this.cursor;var e=this.chart.options.shadows;h.isNull(t.shadowColor)&&(t.shadowColor=h.isNull(this.shadowColor)?e.shadowColor:this.shadowColor),h.isNull(t.shadowBlur)&&(t.shadowBlur=h.isNull(this.shadowBlur)?e.shadowBlur:this.shadowBlur),h.isNull(t.shadowOffsetX)&&(t.shadowOffsetX=h.isNull(this.shadowOffsetX)?e.shadowOffsetX:this.shadowOffsetX),h.isNull(t.shadowOffsetY)&&(t.shadowOffsetY=h.isNull(this.shadowOffsetY)?e.shadowOffsetY:this.shadowOffsetY)},_setMarkerLinkLineSettings:function(t){t.strokeStyle=t.strokeStyle||this.markers.strokeStyle||this.fillStyle},_setShapeSettings:function(t,e){t.fillStyle=this.fillStyles&&!h.isNull(e)?this.fillStyles[e%this.fillStyles.length]:this.fillStyle,t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.lineCap=this.lineCap,t.lineJoin=this.lineJoin,t.miterLimit=this.miterLimit,t.strokeDashArray=this.strokeDashArray,l.setShadows(t,this,this.chart),t.nullHandling=this.nullHandling,t.cursor=this.cursor},_getXAxisType:function(){var t=this.arrData;if(0==e.isArray(t))return"none";for(var i=0;i<t.length;i++){var n=t[i];if(null!=n){if(0==e.isArray(n))return"CategoryAxis";var s=n[0];if(null!=s){var o=e.type(s);switch(o){case"number":return"LinearAxis";case"date":return"DateTimeAxis";case"string":return"CategoryAxis";default:return"none"}}}}return"none"},_resolveAxisType:function(t){var e=t.location;if(e){if(this.isVertical){if("bottom"==e||"top"==e)return}else if("left"==e||"right"==e)return;var i=this._getXAxisType();switch(i){case"LinearAxis":t.type="linear";break;case"DateTimeAxis":t.type="dateTime";break;case"CategoryAxis":t.type="category"}}},_processData:function(){if(this.arrData=null,this.data)return this.arrData=this.data,void 0;var t=this.chart.arrDataSource;if(t){var e=this.xValuesField,i=this.yValuesField,n=h.processDataField(t,e),s=h.processDataField(t,i);s&&(this.arrData=h.mergeArraysXY(n,s))}},_processDataXYZ:function(){if(this.arrData=null,this.data)return this.arrData=this.data,void 0;var t=this.chart.arrDataSource;if(t){var e=this.xValuesField,i=this.fromValuesField,n=this.toValuesField,s=h.processDataField(t,e),o=h.processDataField(t,i),a=h.processDataField(t,n);s&&o&&a&&(this.arrData=h.mergeArrays([s,o,a]))}},_initXYData:function(){for(var t=this.arrData,e=Le,i=Ae,n=Le,s=Ae,o=t.length,a=0;o>a;a++){var r=t[a];if(null!=r){var l=r[0];n>l&&(n=l),l>s&&(s=l);var c=r[1];h.isNull(c)||(e>c&&(e=c),c>i&&(i=c))}}this.min=e,this.max=i,this.minX=n,this.maxX=s},_initCatValueData:function(){for(var t=this.arrData,i=Le,n=Ae,s=[],o=t.length,a=0;o>a;a++){var r=t[a];if(null!=r){var l=r;0==e.isArray(r)?s.push((a+1).toString()):(s.push(r[0]),l=r[1]),h.isNull(l)||(i>l&&(i=l),l>n&&(n=l))}else s.push((a+1).toString())}this.min=i,this.max=n,this.categories=s},_initDateValueData:function(){for(var t=this.arrData,e=Le,i=Ae,n=Le,s=Ae,o=t.length,a=0;o>a;a++){var r=t[a];if(null!=r){var l=r[0].getTime();n>l&&(n=l),l>s&&(s=l);var c=r[1];h.isNull(c)||(e>c&&(e=c),c>i&&(i=c))}}this.min=e,this.max=i,this.minX=n,this.maxX=s},_initXYDataRange:function(t,i){for(var n=this.arrData,s=Le,o=Ae,a=Le,r=Ae,l=n.length,c=0;l>c;c++){var h=n[c];if(null!=h&&0!=e.isArray(h)){var d=h[0];a>d&&(a=d),d>r&&(r=d);for(var u=t;i>u;u++){var p=h[u];s>p&&(s=p),p>o&&(o=p)}}}this.min=s,this.max=o,this.minX=a,this.maxX=r},_initCatValueDataRange:function(t,i,n){for(var s=this.arrData,o=Le,a=Ae,r=[],l=s.length,c=0;l>c;c++){var h=s[c];if(null!=h){var d=h[0];(n||-1==e.inArray(d,r))&&r.push(d);for(var u=t;i>u;u++){var p=h[u];o>p&&(o=p),p>a&&(a=p)}}else r.push((c+1).toString())}this.min=o,this.max=a,this.categories=r},_initDateValueDataRange:function(t,i){for(var n=this.arrData,s=Le,o=Ae,a=Le,r=Ae,l=n.length,c=0;l>c;c++){var h=n[c];if(null!=h&&0!=e.isArray(h)){var d=h[0].getTime();a>d&&(a=d),d>r&&(r=d);for(var u=t;i>u;u++){var p=h[u];s>p&&(s=p),p>o&&(o=p)}}}this.min=s,this.max=o,this.minX=a,this.maxX=r},_initData:function(){var t=this._getXAxisType();switch(this.xAxisType=t,t){case"LinearAxis":return this._initXYData(),void 0;
case"DateTimeAxis":return this._initDateValueData(),void 0;case"CategoryAxis":return this._initCatValueData(),void 0}},_initVisibleData:function(){var t=this._getXAxisType();switch(this.xAxisType=t,t){case"LinearAxis":case"DateTimeAxis":return this._initVisibleXYData(),void 0;case"CategoryAxis":return this._initVisibleCatValueData(),void 0}},_initVisibleXYData:function(){if(!this.realYAxis.zoomEnabled){var t=this.realXAxis,e=t.visibleMinimum||t.minimum,i=t.visibleMaximum||t.maximum,n=!h.isNull(e),s=!h.isNull(i);if(n||s){t.skipEmptyDays&&(e=t._addEmptyDaysOffset(e),i=t._addEmptyDaysOffset(i));for(var o=this.arrData,a=Le,r=Ae,l=o.length,c=0;l>c;c++){var d=o[c];if(null!=d){var u=d[1];if(!h.isNull(u)){var p=d[0];n&&e>p||s&&p>i||(a>u&&(a=u),u>r&&(r=u))}}}this.min=a,this.max=r}}},_initVisibleCatValueData:function(){if(!this.realYAxis.zoomEnabled){var t=this.realXAxis,i=t.visibleMinimum||t.minimum,n=t.visibleMaximum||t.maximum,s=!h.isNull(i),o=!h.isNull(n);if(s||o){for(var a=this.arrData,r=Le,l=Ae,c=a.length,d=0;c>d;d++){var u=a[d];if(null!=u){var p=u;e.isArray(u)&&(p=u[1]),h.isNull(p)||s&&i>d+1||o&&d>n||(r>p&&(r=p),p>l&&(l=p))}}this.min=r,this.max=l}}},_initVisibleCatValueDataRange:function(t,e){if(!this.realYAxis.zoomEnabled){var i=this.realXAxis,n=i.visibleMinimum||i.minimum,s=i.visibleMaximum||i.maximum,o=!h.isNull(n),a=!h.isNull(s);if(o||a){for(var r=this.arrData,l=Le,c=Ae,d=r.length,u=0;d>u;u++){var p=r[u];if(null!=p&&!(o&&n>u+1||a&&u>s))for(var m=t;e>m;m++){var f=p[m];l>f&&(l=f),f>c&&(c=f)}}this.min=l,this.max=c}}},_initVisibleXYDataRange:function(t,e){if(!this.realYAxis.zoomEnabled){var i=this.realXAxis,n=i.visibleMinimum||i.minimum,s=i.visibleMaximum||i.maximum,o=!h.isNull(n),a=!h.isNull(s);if(o||a){i.skipEmptyDays&&(n=i._addEmptyDaysOffset(n),s=i._addEmptyDaysOffset(s));for(var r=this.arrData,l=Le,c=Ae,d=r.length,u=0;d>u;u++){var p=r[u];if(null!=p){var m=p[0];if(!(o&&n>m||a&&m>s))for(var f=t;e>f;f++){var g=p[f];l>g&&(l=g),g>c&&(c=g)}}}this.min=l,this.max=c}}},_initStackedData:function(t){var i=this._getXAxisType();this.xAxisType=i;var n=this.arrData;if(0!=e.isArray(n)){var s=this.chart.series._findStackedClusters(this,t),o=this.chart.series._getStackedSeriesFromType(t,this.stackedGroupName),a=this._calcStackedData(n,s,o);e.extend(this,a)}},_initVisibleStackedData:function(t){var i=this._getXAxisType();this.xAxisType=i;var n=this.arrData;if(0!=e.isArray(n)){var s=this.chart.series._findStackedClusters(this,t),o=this.chart.series._getStackedSeriesFromType(t,this.stackedGroupName),a=this._calcVisibleStackedData(n,s,o);e.extend(this,a)}},_calcStackedData:function(t,i,n){for(var s=Le,o=Ae,a=Le,r=Ae,l=[],c=t.length,h={},d=0;c>d;d++){var u=t[d];if(null!=u){if("CategoryAxis"==this.xAxisType)0==e.isArray(u)?l.push((d+1).toString()):l.push(u[0]);else{var p=u[0];"date"==e.type(p)&&(p=p.getTime()),a>p&&(a=p),p>r&&(r=p)}for(var m=this._getXValue(u,d),f={positive:0,negative:0},g=null,v=i.index-1;v>=0;v--)if(g=n[v].dataValues[m]){f.positive=g.positive,f.negative=g.negative;break}e.isArray(u)&&(u=u[1]),f.actualValue=u,u>0?(f.positive+=u,f.value=f.positive):0>u?(f.negative+=u,f.value=f.negative):f.value=null!=g?g.value:0,h[m]=f,o=Math.max(o,f.value),s=Math.min(s,f.value)}else l.push((d+1).toString())}var _={min:s,max:o,dataValues:h};return"CategoryAxis"==this.xAxisType?_.categories=l:(_.minX=a,_.maxX=r),_},_calcVisibleStackedData:function(t,i,n){if(!this.realYAxis.zoomEnabled){var s=this.realXAxis,o=s.visibleMinimum||s.minimum,a=s.visibleMaximum||s.maximum,r=!h.isNull(o),l=!h.isNull(a);if(r||l){s.skipEmptyDays&&(o=s._addEmptyDaysOffset(o),a=s._addEmptyDaysOffset(a));for(var c=Le,d=Ae,u=t.length,p={},m=0;u>m;m++){var f=t[m];if(null!=f){if("CategoryAxis"==this.xAxisType){if(r&&o>m+1||l&&m>a)continue}else{var g=f[0];if(r&&o>g||l&&g>a)continue}for(var v=this._getXValue(f,m),_={positive:0,negative:0},b=null,y=i.index-1;y>=0;y--)if(b=n[y].dataValues[v]){_.positive=b.positive,_.negative=b.negative;break}e.isArray(f)&&(f=f[1]),_.actualValue=f,f>0?(_.positive+=f,_.value=_.positive):0>f?(_.negative+=f,_.value=_.negative):_.value=null!=b?b.value:0,p[v]=_,d=Math.max(d,_.value),c=Math.min(c,_.value)}}var w={min:c,max:d,dataValues:p};return w}}},_createXAxis:function(){var t,e={location:"bottom",orientation:"x"};switch(this.xAxisType){case"DateTimeAxis":t=new Ce(e);break;case"CategoryAxis":t=new we(e);break;default:t=new xe(e)}return t.chart=this.chart,t},_createYAxis:function(){var t=new xe({location:"left",orientation:"y"});return t.chart=this.chart,t},_initXAxis:function(t){var e=this._findXAxis(t);null==e&&(e=this._createXAxis(),t.push(e)),this.realXAxis=e},_initYAxis:function(t){var e=this._findYAxis(t);null==e&&(e=this._createYAxis(),t.push(e)),this.realYAxis=e},_initSharedAxes:function(){this.realXAxis&&this.realYAxis&&(this.realXAxis.sharedAxis=this.realYAxis,this.realYAxis.sharedAxis=this.realXAxis)},_findAxis:function(t,e){if(null!=e)for(var i=0;i<t.length;i++){var n=t[i];if(n.name==e)return n}return null},_findXAxis:function(t){var e=this._findAxis(t,this.axisX);if(null!=e)return e;for(var i=0;i<t.length;i++)if(e=t[i],"x"==e.getOrientation(this)&&!e.isVertical()&&e.DataType==this.xAxisType)return e;return null},_findYAxis:function(t){var e=this._findAxis(t,this.axisY);if(null!=e)return e;for(var i=0;i<t.length;i++)if(e=t[i],"y"==e.getOrientation(this)&&0!=e.isVertical()&&"LinearAxis"==e.DataType)return e;return null},_getLegendItems:function(t){var i,n=[];if(null!=this.title)i=this.title;else{var s=e.inArray(this,this.chart.series.items)+1;i="Series "+s.toString()}var o=new G;switch(o.fillStyle=this.fillStyle,o.lineWidth=this.lineWidth,o.strokeStyle=this.strokeStyle,this.type){case"line":case"trendline":o.type="line";break;case"scatter":o.fillStyle=this.fillStyle,o.lineWidth=0,this.markers&&(o.type=this.markers.type)}var a={chart:this.chart,series:this};t=e.extend(!1,{},t,{context:a,text:i,marker:o});var r=new K(t);return r.chart=this.chart,r.series=this,n.push(r),n},_initColors:function(t){this.fillStyle=this.fillStyle||t,this.strokeStyle=this.strokeStyle||t},_getPixelMargins:function(t){var i,n=4,s=0;this.markers?(i=this.markers.getSize(),s=this.markers.offset):i={width:0,height:0};var o;if(this.labels&&this.labels.visible!==!1){var a=new T("TEST");e.extend(a,this.labels),o=a.measure(this.chart.ctx)}else o={width:0,height:0};var r,l=t.isVertical(),c=this.isVertical;if(r=l?i.height/2+o.height+n:i.width/2+o.width+n,c&&!l||!c&&l){r+=s,r*=1.25;var h=r/t.length;r*=1+h}return r="x"==t.getOrientation(this)?Math.max(r,6):Math.max(r,12),{left:r,right:r}},_isAnchoredToOrigin:function(){return!1},_getLabelText:function(t){var i=e.fn.jqChart.labelFormatter(this.labels.stringFormat,t);return i},_getLabelValue:function(t,e){switch(this.labels.valueType){case"percentage":t=this.getPercentage(t,e)}return t},_getDataPointLabel:function(t,i,n,s,o){var a=t>=this.realYAxis.getCrossing(),r=this._getLabelText(o),c=new T(r);return l.setShadows(c,this,this.chart),e.extend(c,this.labels),c.measure(this.chart.ctx),c.textAlign="center",c.x=i,a?(c.y=n-s,c.textBaseline="bottom"):(c.y=n+s,c.textBaseline="top"),c},_getTotal:function(t,i){for(var n=this.chart.series._getSeriesFromType(t),s=0,o=0,a=0;a<n.length;a++){var r=n[a],l=r.arrData;if(null!=l){var c=l[i];e.isArray(c)&&(c=c[1]),null!=c&&(c>0?s+=c:o+=c)}}return{positive:s,negative:o}},_getStackedTotal:function(t,e){for(var i=0,n=0,s=0;s<t.length;s++){var o=t[s],a=o.dataValues[e];a&&(a.actualValue>0?i+=a.actualValue:n+=a.actualValue)}return{positive:i,negative:n}},_getPrevStackedPosition:function(t,e,i,n,s,o){for(var a=e-1;a>=0;a--){var r=t[a].dataValues[i];if(r){var l=this._scaleValue(t,r.value,i);if(o){if(r.value==r.positive)return s.getPosition(l)}else if(r.value==r.negative)return s.getPosition(l)}}return n},_getXValue:function(t,i){var n;return this.arrData,"CategoryAxis"==this.xAxisType?n=0==e.isArray(t)?(i+1).toString():t[0]:(n=t[0],"date"==e.type(n)&&(n=n.getTime())),n=n?n.toString():""},_getTooltip:function(t){var e="<b>"+t.y+"</b><br/>";if(this.title){var i=u.getColorFromFillStyle(this.fillStyle);e='<span style="color:'+i+'">'+this.title+"</span>: "+e}return e},_calcColumnScale:function(t){for(var i=[],n=0;n<t.length;n++)e.merge(i,t[n].arrData||[]);i.sort(function(t,e){return t[0]-e[0]});for(var s,o,a=Le,n=0;n<i.length-1;n++)s=i[n][0],"date"==e.type(s)&&(s=s.getTime()),o=i[n+1][0],"date"==e.type(o)&&(o=o.getTime()),s!=o&&(a=Math.min(a,o-s));var r=this.realXAxis,l=r.series,c=l.maxX-l.minX;return r.skipEmptyDays&&(c-=r.totalEmptyDaysTicks),c=Math.min(.5,a/c)},_getSeriesFromThisType:function(){return this.chart.series._getSeriesFromType(this.type)},_render:function(t){if(this.arrData)switch(this.xAxisType){case"LinearAxis":case"DateTimeAxis":return this._renderLinearData(t);case"CategoryAxis":return this._renderCatData(t)}},hasData:function(){return!!this.arrData},getPercentage:function(t,e){var i=this._getTotal(this.type,e),n=t>0?i.positive:i.negative;return t=0!=n?100*Math.abs(t)/Math.abs(n):0},setOptions:function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i),null!=i.markers&&(this.markers=new G(i.markers))},defaults:{nullHandling:"break",lineCap:"butt",lineJoin:"round",miterLimit:10,pointWidth:.6,visible:!0,lineWidth:1,strokeStyle:null}},ee.prototype=new te,ee.constructor=ee,ee.prototype._renderCatData=function(t){for(var i,n,s,o,a=this.arrData,r=a.length,l=null!=this.markers&&this.markers.isVisible(),c=[],d=[],u=[],p=[],m=l?this.markers.size/2:0,f=0;r>f;f++){var g=a[f];if(null!==g){if(s=i=f+.5,0==e.isArray(g))o=g;else if(o=g[1],h.isNull(o)){c.push(null),c.push(null),l||d.push(null);continue}i=this.realXAxis.getPosition(i),n=this.realYAxis.getPosition(o),c.push(i),c.push(n),l||d.push({dataItem:g,index:f,x:this.realXAxis._getValue(f),y:o}),this.realYAxis.isValueVisible(o)!==!1&&this._addMarkerAndLabel(u,p,i,n,f,r,null,o,m)}else c.push(null),c.push(null),l||d.push(null)}var v=this._createShape(c,t);return!l&&v?v.context={chart:this.chart,series:this,points:d}:e.merge(t,u),p},ee.prototype._renderLinearData=function(t){var i=this.arrData,n=i.length,s=null!=this.markers&&this.markers.isVisible(),o=null!=this.labels&&this.labels.visible!==!1;if(n>1e3&&0==s&&0==o)return this._renderLargeXYData(t),void 0;for(var a,r,l,c,d=[],u=[],p=[],m=[],f=s?this.markers.size/2:0,g=0;n>g;g++){var v=i[g];null!==v?(l=v[0],c=v[1],h.isNull(l)||h.isNull(c)?(d.push(null),d.push(null),s||u.push(null)):(a=this.realXAxis.getPosition(l),r=this.realYAxis.getPosition(c),d.push(a),d.push(r),s||u.push({dataItem:v,index:g,x:l,y:c}),this.realYAxis.isValueVisible(c)!==!1&&this._addMarkerAndLabel(p,m,a,r,g,n,l,c,f))):(d.push(null),d.push(null),s||u.push(null))}var _=this._createShape(d,t);return!s&&_?_.context={chart:this.chart,series:this,points:u}:e.merge(t,p),m},ee.prototype._renderLargeXYData=function(t){for(var e,i,n,s,o,a,r,l=this.arrData,c=l.length,h=this.chart.gridArea.width,d=this.chart.gridArea.height,u=this.realXAxis,p=this.realYAxis,m=2*(u.actualVisibleMaximum-u.actualVisibleMinimum)/h,f=2*(p.actualVisibleMaximum-p.actualVisibleMinimum)/d,g=[],v=0,_=0,b=0,y=0,w=[],x=0;c>x;x++)o=l[x],null!==o?(n=o[0],s=o[1],null!==s?(a=v-n,r=_-s,b+=0>a?-a:a,y+=0>r?-r:r,m>b&&f>y||(b=0,y=0,v=n,_=s,e=u.getPosition(n),i=p.getPosition(s),g.push(e),g.push(i),w.push({dataItem:o,index:x,x:n,y:s}))):(g.push(null),g.push(null),w.push(null))):(g.push(null),g.push(null),w.push(null));var C=this._createShape(g,t);C&&(C.context={chart:this.chart,series:this,points:w})},ee.prototype._createShape=function(t,e){var i=new y(t);return this._setShapeSettings(i),e.push(i),this._addLengthAnimation(i),i},ie.prototype=new ee,ie.constructor=ie,ie.prototype._createShape=function(t,i){var n=[];e.merge(n,t);var s=new y(n);this._setShapeSettings(s);var o=this.chart.gridArea,a=o.y,r=o.y+o.height,l=this.realYAxis.getCrossingPosition();l=h.fitInRange(l,a,r);var c=new x(t,l);return this._setShapeSettings(c),c.lineWidth=0,i.push(c),i.push(s),this._addLengthAnimation(c),this._addLengthAnimation(s),s},ie.prototype._isAnchoredToOrigin=function(){return!0},ne.prototype=new ie,ne.constructor=ne,ne.prototype._createShape=function(t,i){var n=[];e.merge(n,t);var s=new w(n);this._setShapeSettings(s);var o=this.chart.gridArea,a=o.y,r=o.y+o.height,l=this.realYAxis.getCrossingPosition();l=h.fitInRange(l,a,r);var c=new x(t,l,!1,!0);return this._setShapeSettings(c),c.lineWidth=0,i.push(c),i.push(s),this._addLengthAnimation(c),this._addLengthAnimation(s),s},se.prototype=new te,se.constructor=se,se.prototype._createXAxis=function(){var t,e={location:"left",orientation:"x"};switch(this.xAxisType){case"DateTimeAxis":t=new Ce(e);break;case"CategoryAxis":t=new we(e);break;default:t=new xe(e)}return t.chart=this.chart,t},se.prototype._createYAxis=function(){var t=new xe({location:"bottom",orientation:"y"});return t.chart=this.chart,t},se.prototype._findXAxis=function(t){var e=this._findAxis(t,this.axisX);if(null!=e)return e;var i;i=this.categories?we:xe;for(var n=0;n<t.length;n++)if(e=t[n],"x"==e.getOrientation(this)&&0!=e.isVertical()&&e instanceof i)return e;return null},se.prototype._findYAxis=function(t){var e=this._findAxis(t,this.axisY);if(null!=e)return e;for(var i=0;i<t.length;i++)if(e=t[i],"y"==e.getOrientation(this)&&!e.isVertical()&&e instanceof xe)return e;return null},se.prototype._renderCatData=function(t){var i=this.arrData,n=this.chart.gridArea,s=n.x,o=s+n.width,a=this.realYAxis.getCrossingPosition();a=h.fitInRange(a,s,o),a=Math.round(a);var r=this.chart.series._findClusters(this,this.type),l=i.length,c=n.height/this.realXAxis.getZoom(),d=c/l,u=d/r.count,p=Math.round(this.pointWidth*u),f=r.count*p,g=(d-f)/2;g=Math.round(g+r.index*p),p=Math.max(p,1);for(var v,_,b=[],y=[],w=this.markers&&this.markers.isVisible()?this.markers.size/2+2:2,x=0;l>x;x++){var C=i[x];if(null!=C){var S,T=x;if(S=0==e.isArray(C)?C:C[1],null!=S){_=Math.round(this.realXAxis.getCatPosition(T)-g-p),v=Math.round(this.realYAxis.getPosition(S));var A,L=v;if(a>=v){A=a-v;var M=n.x-10;if(M>v){var k=M-v;v+=k,A-=k}}else{A=v-a,v=a;var D=n.getRight()+10;v+A>D&&(A=D-v)}var I={chart:this.chart,series:this,dataItem:i[x],index:x,x:this.realXAxis._getValue(x),y:S},P=new m(v,_,A,p);P.context=I,P.center={x:Math.round(L),y:Math.round(_+p/2)},this._setShapeSettings(P,x),t.push(P),this._addAnimation(P,x,l),_+=p/2,this._addMarkerAndLabel(b,y,L,_,x,l,null,S,w,I)}}}return e.merge(t,b),y},se.prototype._renderLinearData=function(t){var i=this.arrData,n=this.chart.gridArea,s=n.x,o=s+n.width,a=this.realYAxis.getCrossingPosition();a=h.fitInRange(a,s,o),a=Math.round(a);var r=i.length,l=n.height/this.realXAxis.getZoom(),c=this._getSeriesFromThisType(),d=this._calcColumnScale(c)*l,u=this.pointWidth*d;u=Math.max(u,1);for(var p,f,g=[],v=[],_=this.markers&&this.markers.isVisible()?this.markers.size/2:0,b=0;r>b;b++){var y=i[b];if(null!=y&&0!=e.isArray(y)){var w=y[0],x=y[1];if(null!=w&&null!=x){var C={chart:this.chart,series:this,dataItem:i[b],index:b,x:w,y:x};f=this.realXAxis.getPosition(w),p=Math.round(this.realYAxis.getPosition(x));var S,T=p;if(a>=p){S=a-p;var A=n.x-10;if(A>p){var L=A-p;p+=L,S-=L}}else{S=p-a,p=a;var M=n.getRight()+10;p+S>M&&(S=M-p)}var k=f-u/2,D=new m(p,k,S,u);D.context=C,D.center={x:Math.round(T),y:Math.round(k+u/2)},this._setShapeSettings(D,b),t.push(D),this._addAnimation(D,b,r),this._addMarkerAndLabel(g,v,T,f,b,r,null,x,_,C)}}}return e.merge(t,g),v},se.prototype._addAnimation=function(t,e,i){var n=this._getAnimation();if(n&&n.enabled!==!1){var o=new s(n,t,"xDecrease",t.width,0);this._setIsAnimReversed(t);var a=o.duration/i,r=o.delayTime+e*a;o.delayTime=r,o.duration=a,this.chart.storyboard.addAnimation(o)}},se.prototype._setIsAnimReversed=function(t){var e=t.context.y<this.realYAxis.getCrossing(),i=this.realYAxis.reversed;t.isAnimReversed=!i&&e||i&&!e},se.prototype._correctMarkerPosition=function(t,e,i){var n=this.markers.offset;if(n){var s=i>=this.realYAxis.getCrossing();t=s?t+n:t-n}return{x:t,y:e}},se.prototype._getPixelMargins=function(t){if(0==t.isVertical()){var e=te.prototype._getPixelMargins.call(this,t),i=t.length/10,n=Math.max(i,e.left),s=Math.max(i,e.right);return{left:n,right:s}}if(null==this.arrData)return{left:0,right:0};var o=4,a=this._getSeriesFromThisType(),r=this._calcColumnScale(a),l=t.length,c=.5*r*l+o;return{left:c,right:c}},se.prototype._isAnchoredToOrigin=function(){return!0},se.prototype._getDataPointLabel=function(t,i,n,s,o){var a=t<=this.realYAxis.getCrossing(),r=this._getLabelText(o),c=new T(r);l.setShadows(c,this,this.chart),e.extend(c,this.labels),c.measure(this.chart.ctx),c.y=n;var h=this.chart.gridArea;if(a)c.x=i-s,c.textAlign="right",c.x-c.width<h.x+4&&(c.x=h.x+c.width+4);else{c.x=i+s,c.textAlign="left";var d=h.getRight()-4;c.x+c.width>d&&(c.x=d-c.width)}return c},se.prototype._initColors=function(t){this.fillStyle=this.fillStyle||t},oe.prototype=new te,oe.constructor=oe,oe.prototype._renderCatData=function(t){var i=this.arrData,n=this.chart.gridArea,s=n.y,o=n.y+n.height,a=this.realYAxis.getCrossingPosition();a=h.fitInRange(a,s,o),a=Math.round(a);var r=this.chart.series._findClusters(this,this.type),l=i.length,c=n.width/this.realXAxis.getZoom(),d=c/l,u=d/r.count,p=Math.round(this.pointWidth*u),f=r.count*p,g=(d-f)/2;g=Math.round(g+r.index*p),p=Math.max(p,1);for(var v,_,b=[],y=[],w=this.markers&&this.markers.isVisible()?this.markers.size/2:0,x=0;l>x;x++){var C=i[x];if(null!=C){v=x;var S;if(S=0==e.isArray(C)?C:C[1],null!=S){v=Math.round(this.realXAxis.getCatPosition(v)+g),_=Math.round(this.realYAxis.getPosition(S));var T,A=_;a>=_?T=a-_:(T=_-a,_=a);var L={chart:this.chart,series:this,dataItem:i[x],index:x,x:this.realXAxis._getValue(x),y:S},M=new m(v,_,p,T);M.context=L,M.center={x:Math.round(v+p/2),y:Math.round(A)},this._setShapeSettings(M,x),t.push(M),this._addAnimation(M,x,l),this.realYAxis.isValueVisible(S)!==!1&&(v+=p/2,this._addMarkerAndLabel(b,y,v,A,x,l,null,S,w,L))}}}return e.merge(t,b),y},oe.prototype._renderLinearData=function(t){var i=this.arrData,n=this.chart.gridArea,s=n.y,o=n.y+n.height,a=this.realYAxis.getCrossingPosition();a=h.fitInRange(a,s,o),a=Math.round(a);var r=i.length,l=n.width/this.realXAxis.getZoom(),c=this._getSeriesFromThisType(),d=this._calcColumnScale(c)*l,u=this.pointWidth*d;u=Math.max(u,1);for(var p,f,g=[],v=[],_=this.markers&&this.markers.isVisible()?this.markers.size/2:0,b=0;r>b;b++){var y=i[b];if(null!=y&&0!=e.isArray(y)){p=y[0];var w=y[1];if(null!=p&&null!=w){var x={chart:this.chart,series:this,dataItem:i[b],index:b,x:p,y:w};p=this.realXAxis.getPosition(p),f=Math.round(this.realYAxis.getPosition(w));var C,S=f;a>=f?C=a-f:(C=f-a,f=a);var T=p-u/2,A=new m(T,f,u,C);A.context=x,A.center={x:Math.round(T+u/2),y:Math.round(S)},this._setShapeSettings(A,b),t.push(A),this._addAnimation(A,b,r),this.realYAxis.isValueVisible(w)!==!1&&this._addMarkerAndLabel(g,v,p,S,b,r,null,w,_,x)}}}return e.merge(t,g),v},oe.prototype._addAnimation=function(t,e,i){var n=this._getAnimation();if(n&&n.enabled!==!1){var o=new s(n,t,"yDecrease",t.height,0);this._setIsAnimReversed(t);var a=o.duration/i,r=o.delayTime+e*a;o.delayTime=r,o.duration=a,this.chart.storyboard.addAnimation(o)}},oe.prototype._setIsAnimReversed=function(t){var e=t.context.y>=this.realYAxis.getCrossing(),i=this.realYAxis.reversed;t.isAnimReversed=!i&&e||i&&!e},oe.prototype._getPixelMargins=function(t){if(t.isVertical()){var e=te.prototype._getPixelMargins.call(this,t),i=t.length/10,n=Math.max(i,e.left),s=Math.max(i,e.right);return{left:n,right:s}}if(null==this.arrData)return{left:0,right:0};var o=4,a=this._getSeriesFromThisType(),r=this._calcColumnScale(a),l=t.length,c=.5*r*l+o;return{left:c,right:c}},oe.prototype._isAnchoredToOrigin=function(){return!0},oe.prototype._initColors=function(t){this.fillStyle=this.fillStyle||t},ae.prototype=new te,ae.constructor=ae,ae.prototype._initXAxis=function(){},ae.prototype._initYAxis=function(){},ae.prototype._initVisibleData=function(){},ae.prototype._processData=function(){if(this.arrData=null,this.data)return this.arrData=this.data,this.expIndexes=this.explodedSlices,void 0;var t=this.chart.arrDataSource;if(t){var e=this.dataLabelsField,i=this.dataValuesField,n=h.processDataField(t,e),s=h.processDataField(t,i);this.arrData=h.mergeArraysXY(n,s),this.expIndexes=[];for(var o=0;o<t.length;o++){var a=t[o],r=a[this.explodedField];r&&this.expIndexes.push(o)}}},ae.prototype._getYValues=function(){for(var t=[],i=this.arrData,n=i.length,s=0;n>s;s++){var o=i[s];if(null!=o){var a;a=0==e.isArray(o)?o:o[1],t.push(Math.abs(a))}}return t},ae.prototype._render=function(t){var i=this.arrData;if(i){var n,s=this.chart.gridArea,o=s.width,a=s.height,r=this._getYValues(),l=h.sum(r),c=r.length,d=10;if(n=a>o?o/2-d:a/2-d,this.expIndexes&&this.expIndexes.length>0&&(n-=this.explodedRadius),!(0>n)){for(var u,p=s.x+o/2,m=s.y+a/2,f=2*Math.PI/l,g=-Math.PI/2,v=this.fillStyles,b=this.explodedRadius,y=0;c>y;y++){var w=r[y],x=100*w/l,C=g+w*f,S=p,A=m;if(u=this.isExploded(y)){var L=(g+C)/2;A=m+b*Math.sin(L),S=p+b*Math.cos(L)}var M=new _(S,A,n,g,C);this._setShapeSettings(M),M.fillStyle=v?v[y%v.length]:this.palette.getColor(y);var k={chart:this.chart,series:this,dataItem:i[y],index:y,value:w,percentage:x};M.context=k,t.push(M),this._addSliceAnimation(M,y,c),g=C}if(this.labels&&this.labels.visible!==!1)for(var D=[],g=-Math.PI/2,y=0;c>y;y++){var w=r[y],x=100*w/l,I=w,C=g+w*f;switch(this.labels.valueType){case"percentage":I=x}if(0!=w){var P=this._getLabelText(I),R=new T(P);R.textBaseline="top",e.extend(R,this.labels);var E=R.measure(this.chart.ctx),S=p,A=m;if(u=this.isExploded(y)){var L=(g+C)/2;A=m+b*Math.sin(L),S=p+b*Math.cos(L)}var O=this._getSliceCenter(S,A,(g+C)/2,.6*n);R.x=O.x-E.width/2,R.y=O.y-E.height/2;var j=this.isOverlap(R,D);j||(R.context={chart:this.chart,series:this,dataItem:i[y],index:y,value:w,percentage:x},this.chart.elem.trigger("dataPointLabelCreating",R),t.push(R),D.push(R),this._addShapeAnimation(R,y,c),g=C)}}}}},ae.prototype.isExploded=function(t){var i=this.expIndexes;return i&&i.length?-1!=e.inArray(t,i):!1},ae.prototype.isOverlap=function(t,e){for(var i=0;i<e.length;i++){var n=e[i];if(n.intersectWith(t.x,t.y,t.width,t.height))return!0}return!1},ae.prototype._getSliceCenter=function(t,e,i,n){return{x:t+n*Math.cos(i),y:e+n*Math.sin(i)}},ae.prototype._getLegendItems=function(t){var i=[],n=this.arrData;if(!n)return i;for(var s,o=this._getYValues(),a=n.length,r=0;a>r;r++){var l=n[r];if(null!=l){if(0==e.isArray(l)){var c=r+1;s=c.toString()}else s=l[0];var h=new G;h.fillStyle=this.palette.getColor(r);var d={chart:this.chart,series:this,dataItem:l,index:r,value:o[r]};t=e.extend(!1,{},t,{context:d,text:s,marker:h});var u=new K(t);u.chart=this.chart,u.series=this,i.push(u)}}return i},ae.prototype._initColors=function(t,e){this.palette=e},ae.prototype._getTooltip=function(t){var e=this.chart.stringFormat(t.percentage,"%.2f%%"),i="<b>"+t.value+" ("+e+")"+"</b><br/>",n=t.dataItem[0];return n&&(i=n+"<br/>"+i),i},ae.prototype._addSliceAnimation=function(t,e,i){var n=this._getAnimation();if(n&&n.enabled!==!1){var o=new s(n,t,"endAngle",t.startAngle,t.endAngle),a=o.duration/i,r=o.delayTime+e*a;o.delayTime=r,o.duration=a,this.chart.storyboard.addAnimation(o)}},ae.prototype.getTotal=function(){var t=this._getYValues(),e=h.sum(t);return e},ae.prototype.getPercentage=function(t){var e=this.getTotal();return 100*t/e},re.prototype=new ee,re.constructor=re,re.prototype._createShape=function(){return null},le.prototype=new ee,le.constructor=le,le.prototype._createShape=function(t,e){var i=new w(t);return this._setShapeSettings(i),e.push(i),this._addLengthAnimation(i),i},ce.prototype=new ee,ce.constructor=ce,ce.prototype._createShape=function(t,e){for(var i,n,s=[],o=t.length,a=0;o>a&&(i=t[a],n=t[a+1],s.push(i),s.push(n),!(a>=o-2));a+=2)s.push(t[a+2]),s.push(n);var r=new y(s);return r.isStepLine=!0,this._setShapeSettings(r),e.push(r),this._addLengthAnimation(r),r},he.prototype=new ee,he.constructor=he,he.prototype._createShape=function(t,i){for(var n,s,o=[],a=t.length,r=0;a>r&&(n=t[r],s=t[r+1],o.push(n),o.push(s),!(r>=a-2));r+=2)o.push(t[r+2]),o.push(s);var l=[];e.merge(l,o);var c=new y(l);c.isStepLine=!0,this._setShapeSettings(c);var d=this.chart.gridArea,u=d.y,p=d.y+d.height,m=this.realYAxis.getCrossingPosition();m=h.fitInRange(m,u,p);var f=new x(o,m);return f.isStepLine=!0,this._setShapeSettings(f),f.lineWidth=0,i.push(f),i.push(c),this._addLengthAnimation(f),this._addLengthAnimation(c),c},de.prototype=new oe,de.constructor=de,de.prototype._initData=function(){this._initStackedData(this.type)},de.prototype._initVisibleData=function(){this._initVisibleStackedData(this.type)},de.prototype._renderCatData=function(t){var i=this.arrData;if(i){var n=this.chart.gridArea,s=n.y,o=n.y+n.height,a=this.realYAxis.getCrossingPosition();a=h.fitInRange(a,s,o),a=Math.round(a);var r=this.chart.series._findStackedClusters(this,this.type),l=i.length,c=n.width/this.realXAxis.getZoom(),d=c/l,u=d/r.groupCount,p=Math.round(this.pointWidth*u),f=r.groupCount*p,g=(d-f)/2;g=Math.round(g+r.groupIndex*p),p=Math.max(p,1);for(var v,_,b,y=[],w=[],x=this.chart.series._getStackedSeriesFromType(this.type,this.stackedGroupName),C=this.markers&&this.markers.isVisible()?this.markers.size/2:0,S=0;l>S;S++)if(b=i[S],null!=b){var T=this._getXValue(b,S);if(b=this.dataValues[T],null!=b){var A=this._scaleValue(x,b.value,T);v=S,v=Math.round(this.realXAxis.getCatPosition(v)+g),_=Math.round(this.realYAxis.getPosition(A));var L,M=this._getPrevStackedPosition(x,r.index,T,a,this.realYAxis,A>=0),k=_;M>=_?L=M-_:(L=_-M,_=M);var D=b.actualValue,I=this._getStackedTotal(x,T),P=D>0?I.positive:I.negative,R=0!=P?100*Math.abs(D)/Math.abs(P):0,E={chart:this.chart,series:this,dataItem:i[S],index:S,value:D,x:this.realXAxis._getValue(S),y:A,percentage:R},O=new m(v,_,p,L);if(O.context=E,O.center={x:Math.round(v+p/2),y:Math.round(k)},this._setShapeSettings(O,S),t.push(O),this._addAnimation(O,r.index,r.count),v+=p/2,this.markers&&this.realYAxis.isValueVisible(A)){var j=this._getMarker(v,k,null,A);j.context=E,y.push(j),this._addShapeAnimation(j,r.index,r.count)}if(this.labels&&this.labels.visible!==!1&&0!=b.actualValue){var N=D;switch(this.labels.valueType){case"percentage":N=R}var F="outside"==this.labels.position,B=F?C:-L/2,U=this._getDataPointLabel(b.actualValue,v,k,B,N);F||(U.textBaseline="middle"),U.context=E,this.chart.elem.trigger("dataPointLabelCreating",U),w.push(U),this._addShapeAnimation(U,r.index,r.count)}}}return e.merge(t,y),w}},de.prototype._renderLinearData=function(t){var i=this.arrData;if(i){var n=this.chart.gridArea,s=n.y,o=n.y+n.height,a=this.realYAxis.getCrossingPosition();a=h.fitInRange(a,s,o),a=Math.round(a);for(var r,l,c,d=this.chart.series._findStackedClusters(this,this.type),u=this.chart.series._getStackedSeriesFromType(this.type,this.stackedGroupName),p=i.length,f=n.width/this.realXAxis.getZoom(),g=this._calcColumnScale(u)*f,v=this.pointWidth*g,_=[],b=[],y=this.markers&&this.markers.isVisible()?this.markers.size/2:0,w=0;p>w;w++)if(c=i[w],null!=c){var x=this._getXValue(c,w);if(c=this.dataValues[x],null!=c){var C=this._scaleValue(u,c.value,x);r=i[w][0],r=Math.round(this.realXAxis.getPosition(r)),l=Math.round(this.realYAxis.getPosition(C));var S,T=this._getPrevStackedPosition(u,d.index,x,a,this.realYAxis,C>=0),A=l;T>=l?S=T-l:(S=l-T,l=T);var L=c.actualValue,M=this._getStackedTotal(u,x),k=L>0?M.positive:M.negative,D=0!=k?100*Math.abs(L)/Math.abs(k):0,I={chart:this.chart,series:this,dataItem:i[w],index:w,value:L,x:i[w][0],y:C,percentage:D},P=r-v/2,R=new m(P,l,v,S);if(R.context=I,R.center={x:Math.round(r+v/2),y:Math.round(A)},this._setShapeSettings(R,w),t.push(R),this._addAnimation(R,d.index,d.count),this.markers&&this.realYAxis.isValueVisible(C)){var E=this._getMarker(r,A,null,C);E.context=I,_.push(E),this._addShapeAnimation(E,d.index,d.count)}if(this.labels&&this.labels.visible!==!1&&0!=c.actualValue){var O=L;switch(this.labels.valueType){case"percentage":O=D}var j="outside"==this.labels.position,N=j?y:-S/2,F=this._getDataPointLabel(c.actualValue,r,A,N,O);j||(F.textBaseline="middle"),F.context=I,this.chart.elem.trigger("dataPointLabelCreating",F),b.push(F),this._addShapeAnimation(F,d.index,d.count)}}}return e.merge(t,_),b}},de.prototype._getSeriesFromThisType=function(){return this.chart.series._getStackedSeriesFromType(this.type,this.stackedGroupName)},de.prototype._getTooltip=function(t){var e="<b>"+t.value+"</b><br/>";if(this.title){var i=u.getColorFromFillStyle(this.fillStyle);e='<span style="color:'+i+'">'+this.title+"</span>: "+e}return e},de.prototype._scaleValue=function(t,e){return e},ue.prototype=new se,ue.constructor=ue,ue.prototype._initData=function(){this._initStackedData(this.type)},ue.prototype._initVisibleData=function(){this._initVisibleStackedData(this.type)},ue.prototype._renderCatData=function(t){var i=this.arrData;if(i){var n=this.chart.gridArea,s=n.x,o=s+n.width,a=this.realYAxis.getCrossingPosition();a=h.fitInRange(a,s,o),a=Math.round(a);var r=this.chart.series._findStackedClusters(this,this.type),l=i.length,c=n.height/this.realXAxis.getZoom(),d=c/l,u=d/r.groupCount,p=Math.round(this.pointWidth*u),f=r.groupCount*p,g=(d-f)/2;g=Math.round(g+r.groupIndex*p),p=Math.max(p,1);for(var v,_,b,y=[],w=[],x=this.chart.series._getStackedSeriesFromType(this.type,this.stackedGroupName),C=this.markers&&this.markers.isVisible()?this.markers.size/2+2:2,S=0;l>S;S++)if(b=i[S],null!=b){var T=this._getXValue(b,S);if(b=this.dataValues[T],null!=b){var A=this._scaleValue(x,b.value,T);v=S,_=Math.round(this.realXAxis.getCatPosition(v)-g-p),v=Math.round(this.realYAxis.getPosition(A));var L,M=this._getPrevStackedPosition(x,r.index,T,a,this.realYAxis,A>=0),k=v;M>=v?L=M-v:(L=v-M,v=M);var D=b.actualValue,I=this._getStackedTotal(x,T),P=D>0?I.positive:I.negative,R=0!=P?100*Math.abs(D)/Math.abs(P):0,E={chart:this.chart,series:this,dataItem:i[S],index:S,value:D,x:this.realXAxis._getValue(S),y:A,percentage:R},O=new m(v,_,L,p);if(O.context=E,O.center={x:Math.round(k),y:Math.round(_+p/2)},this._setShapeSettings(O,S),t.push(O),this._addAnimation(O,r.index,r.count),_+=p/2,this.markers&&this.realYAxis.isValueVisible(A)){var j=this._getMarker(k,_,null,A);j.context=E,y.push(j),this._addShapeAnimation(j,r.index,r.count)}if(this.labels&&this.labels.visible!==!1&&0!=b.actualValue){var N=D;switch(this.labels.valueType){case"percentage":N=R}var F="outside"==this.labels.position,B=F?C:-L/2,U=this._getDataPointLabel(b.actualValue,k,_,B,N);F||(U.textBaseline="middle",U.textAlign="center"),U.context=E,this.chart.elem.trigger("dataPointLabelCreating",U),w.push(U),this._addShapeAnimation(U,r.index,r.count)}}}return e.merge(t,y),w}},ue.prototype._renderLinearData=function(t){var i=this.arrData;if(i){var n=this.chart.gridArea,s=n.x,o=s+n.width,a=this.realYAxis.getCrossingPosition();a=h.fitInRange(a,s,o),a=Math.round(a);for(var r,l,c,d=this.chart.series._getStackedSeriesFromType(this.type,this.stackedGroupName),u=this.chart.series._findStackedClusters(this,this.type),p=i.length,f=n.height/this.realXAxis.getZoom(),g=this._getSeriesFromThisType(),v=this._calcColumnScale(g)*f,_=this.pointWidth*v,b=[],y=[],w=this.markers&&this.markers.isVisible()?this.markers.size/2+2:2,x=0;p>x;x++)if(c=i[x],null!=c){var C=this._getXValue(c,x);if(c=this.dataValues[C],null!=c){var S=this._scaleValue(d,c.value,C);r=i[x][0],l=Math.round(this.realXAxis.getCatPosition(r)),r=Math.round(this.realYAxis.getPosition(S));var T,A=this._getPrevStackedPosition(d,u.index,C,a,this.realYAxis,S>=0),L=r;A>=r?T=A-r:(T=r-A,r=A);var M=c.actualValue,k=this._getStackedTotal(d,C),D=M>0?k.positive:k.negative,I=0!=D?100*Math.abs(M)/Math.abs(D):0,P={chart:this.chart,series:this,dataItem:i[x],index:x,value:M,x:i[x][0],y:S,percentage:I},R=l-_/2,E=new m(r,R,T,_);if(E.context=P,E.center={x:Math.round(L),y:Math.round(l+_/2)},this._setShapeSettings(E,x),t.push(E),this._addAnimation(E,u.index,u.count),this.markers&&this.realYAxis.isValueVisible(S)){var O=this._getMarker(L,l,null,S);O.context=P,b.push(O),this._addShapeAnimation(O,u.index,u.count)}if(this.labels&&this.labels.visible!==!1&&0!=c.actualValue){var j=M;switch(this.labels.valueType){case"percentage":j=I
}var N="outside"==this.labels.position,F=N?w:-T/2,B=this._getDataPointLabel(c.actualValue,L,l,F,j);N||(B.textBaseline="middle",B.textAlign="center"),B.context=P,this.chart.elem.trigger("dataPointLabelCreating",B),y.push(B),this._addShapeAnimation(B,u.index,u.count)}}}return e.merge(t,b),y}},ue.prototype._getSeriesFromThisType=function(){return this.chart.series._getStackedSeriesFromType(this.type,this.stackedGroupName)},ue.prototype._getTooltip=function(t){var e="<b>"+t.value+"</b><br/>";if(this.title){var i=u.getColorFromFillStyle(this.fillStyle);e='<span style="color:'+i+'">'+this.title+"</span>: "+e}return e},ue.prototype._scaleValue=function(t,e){return e},pe.prototype=new de,pe.constructor=pe,pe.prototype._initVisibleData=function(){de.prototype._initVisibleData.call(this),this.min=0,this.max=100},pe.prototype._getPixelMargins=function(t){if(t.isVertical()||null==this.arrData)return{left:0,right:0};var e=4,i=this._getSeriesFromThisType(),n=this._calcColumnScale(i),s=t.length,o=.5*n*s+e;return{left:o,right:o}},pe.prototype._scaleValue=function(t,e,i){var n=this._getStackedTotal(t,i).positive||1;return 100*e/n},pe.prototype._getTooltip=function(t){var e=this.chart.stringFormat(t.percentage,"%.2f%%"),i="<b>"+t.value+" ("+e+")"+"</b><br/>";if(this.title){var n=u.getColorFromFillStyle(this.fillStyle);i='<span style="color:'+n+'">'+this.title+"</span>: "+i}return i},me.prototype=new ue,me.constructor=ue,me.prototype._initVisibleData=function(){ue.prototype._initVisibleData.call(this),this.min=0,this.max=100},me.prototype._getPixelMargins=function(t){if(0==t.isVertical()||null==this.arrData)return{left:0,right:0};var e=4,i=this._getSeriesFromThisType(),n=this._calcColumnScale(i),s=t.length,o=.5*n*s+e;return{left:o,right:o}},me.prototype._scaleValue=function(t,e,i){var n=this._getStackedTotal(t,i).positive||1;return 100*e/n},me.prototype._getTooltip=function(t){var e=this.chart.stringFormat(t.percentage,"%.2f%%"),i="<b>"+t.value+" ("+e+")"+"</b><br/>";if(this.title){var n=u.getColorFromFillStyle(this.fillStyle);i='<span style="color:'+n+'">'+this.title+"</span>: "+i}return i},fe.prototype=new oe,fe.constructor=fe,fe.prototype._initXYData=function(){this._initXYDataRange(1,3)},fe.prototype._initCatValueData=function(){this._initCatValueDataRange(1,3)},fe.prototype._initDateValueData=function(){this._initDateValueDataRange(1,3)},fe.prototype._initVisibleCatValueData=function(){this._initVisibleCatValueDataRange(1,3)},fe.prototype._initVisibleXYData=function(){this._initVisibleXYDataRange(1,3)},fe.prototype._processData=function(){this._processDataXYZ()},fe.prototype._renderCatData=function(t){for(var i,n,s,o,a,r,l=this.arrData,c=this.chart.gridArea,h=this.categories,d=h.length,u=c.width/this.realXAxis.getZoom(),p=u/d,f=Math.round(this.pointWidth*p),g=Math.round((p-f)/2),v=0;v<l.length;v++){var _=l[v];if(null!=_){var b=e.inArray(_[0],h);o=b>-1?b:v,a=_[1],r=_[2],i=Math.round(this.realXAxis.getCatPosition(o)+g),n=Math.round(this.realYAxis.getPosition(a)),s=Math.round(this.realYAxis.getPosition(r));var y={chart:this.chart,series:this,dataItem:l[v],index:v,catIndex:o,x:this.realXAxis._getValue(o),from:a,to:r},w=Math.min(n,s),x=Math.abs(n-s),C=new m(i,w,f,x);C.context=y,this._setShapeSettings(C,v),t.push(C),this._addAnimation(C,v,d)}}},fe.prototype._renderLinearData=function(t){for(var i,n,s,o,a,r,l=this.arrData,c=this.chart.gridArea,h=l.length,d=c.width/this.realXAxis.getZoom(),u=this._getSeriesFromThisType(),p=this._calcColumnScale(u)*d,f=this.pointWidth*p,g=0;h>g;g++){var v=l[g];if(null!=v&&0!=e.isArray(v)){o=v[0],a=v[1],r=v[2];var _={chart:this.chart,series:this,dataItem:l[g],index:g,catIndex:g,x:o,from:a,to:r};i=this.realXAxis.getPosition(o),n=Math.round(this.realYAxis.getPosition(a)),s=Math.round(this.realYAxis.getPosition(r));var b=i-f/2,y=Math.min(n,s),w=Math.abs(n-s),x=new m(b,y,f,w);x.context=_,this._setShapeSettings(x,g),t.push(x)}}},fe.prototype._setIsAnimReversed=function(t){var e=t.context,i=this.realYAxis.reversed;t.isAnimReversed=!i&&e.from<e.to||i&&e.from>e.to},fe.prototype._setShapeSettings=function(t){te.prototype._setShapeSettings.call(this,t,t.context.catIndex),t.context.from<=t.context.to?(this.priceUpStrokeStyle&&(t.strokeStyle=this.priceUpStrokeStyle),this.priceUpFillStyle&&(t.fillStyle=this.priceUpFillStyle)):(this.priceDownStrokeStyle&&(t.strokeStyle=this.priceDownStrokeStyle),this.priceDownFillStyle&&(t.fillStyle=this.priceDownFillStyle))},fe.prototype._getTooltip=function(t){var e="From: <b>"+t.from.toString()+"</b><br/>"+"To: <b>"+t.to.toString()+"</b>";if(this.title){var i=u.getColorFromFillStyle(this.fillStyle);e='<div style="color:'+i+'">'+this.title+"</div>"+e}return e},ge.prototype=new se,ge.constructor=ge,ge.prototype._initXYData=function(){this._initXYDataRange(1,3)},ge.prototype._initCatValueData=function(){this._initCatValueDataRange(1,3)},ge.prototype._initDateValueData=function(){this._initDateValueDataRange(1,3)},ge.prototype._initVisibleCatValueData=function(){this._initVisibleCatValueDataRange(1,3)},ge.prototype._initVisibleXYData=function(){this._initVisibleXYDataRange(1,3)},ge.prototype._processData=function(){this._processDataXYZ()},ge.prototype._renderCatData=function(t){for(var i,n,s,o,a,r,l=this.arrData,c=this.chart.gridArea,h=this.categories,d=h.length,u=c.height/this.realXAxis.getZoom(),p=u/d,f=this.pointWidth*p,g=Math.round((p-f)/2),v=0;v<l.length;v++){var _=l[v];if(null!=_){var b=e.inArray(_[0],h);o=b>-1?b:v,a=_[1],r=_[2],s=Math.round(this.realXAxis.getCatPosition(o)-g-f),i=Math.round(this.realYAxis.getPosition(a)),n=Math.round(this.realYAxis.getPosition(r));var y={chart:this.chart,series:this,dataItem:l[v],index:v,catIndex:o,x:this.realXAxis._getValue(o),from:a,to:r},w=Math.min(i,n),x=Math.abs(i-n),C=new m(w,s,x,f);C.context=y,this._setShapeSettings(C,v),t.push(C),this._addAnimation(C,v,d)}}},ge.prototype._renderLinearData=function(t){for(var i,n,s,o,a,r,l=this.arrData,c=this.chart.gridArea,h=l.length,d=c.height/this.realXAxis.getZoom(),u=this._getSeriesFromThisType(),p=this._calcColumnScale(u)*d,f=this.pointWidth*p,g=0;h>g;g++){var v=l[g];if(null!=v&&0!=e.isArray(v)){o=v[0],a=v[1],r=v[2];var _={chart:this.chart,series:this,dataItem:l[g],index:g,catIndex:g,x:o,from:a,to:r};s=this.realXAxis.getPosition(o),i=Math.round(this.realYAxis.getPosition(a)),n=Math.round(this.realYAxis.getPosition(r));var b=s-f/2,y=Math.min(i,n),w=Math.abs(i-n),x=new m(y,b,w,f);x.context=_,this._setShapeSettings(x,g),t.push(x),this._addAnimation(x,g,h)}}},ge.prototype._setIsAnimReversed=function(t){var e=t.context,i=this.realYAxis.reversed;t.isAnimReversed=!i&&e.from>e.to||i&&e.from<e.to},ge.prototype._setShapeSettings=function(t){te.prototype._setShapeSettings.call(this,t,t.context.catIndex),t.context.from<=t.context.to?(this.priceUpStrokeStyle&&(t.strokeStyle=this.priceUpStrokeStyle),this.priceUpFillStyle&&(t.fillStyle=this.priceUpFillStyle)):(this.priceDownStrokeStyle&&(t.strokeStyle=this.priceDownStrokeStyle),this.priceDownFillStyle&&(t.fillStyle=this.priceDownFillStyle))},ge.prototype._getTooltip=function(t){var e="From: <b>"+t.from.toString()+"</b><br/>"+"To: <b>"+t.to.toString()+"</b>";if(this.title){var i=u.getColorFromFillStyle(this.fillStyle);e='<div style="color:'+i+'">'+this.title+"</div>"+e}return e},_e.prototype=new te,_e.constructor=_e,_e.prototype._initXYData=function(){this._initXYDataRange(1,3)},_e.prototype._initCatValueData=function(){this._initCatValueDataRange(1,3,!0)},_e.prototype._initDateValueData=function(){this._initDateValueDataRange(1,3)},_e.prototype._initVisibleCatValueData=function(){this._initVisibleCatValueDataRange(1,3)},_e.prototype._initVisibleXYData=function(){this._initVisibleXYDataRange(1,3)},_e.prototype._processData=function(){this._processDataXYZ()},_e.prototype._renderCatData=function(t){for(var i,n,s,o,a,r,l=this.arrData,c=l.length,h=null!=this.markers&&this.markers.isVisible(),d=[],u=[],p=[],m=[],f=[],g=h?this.markers.size/2:0,v=0;c>v;v++){var _=l[v];null!==_?(o=v+.5,a=_[1],r=_[2],i=this.realXAxis.getPosition(o),n=this.realYAxis.getPosition(a),s=this.realYAxis.getPosition(r),d.push(i),d.push(n),u.push(i),u.push(s),h||(p[v]=p[2*c-v-1]={dataItem:_,index:v,x:o,from:a,to:r}),this._addMarkersAndLabels(m,f,i,n,s,v,c,null,a,r,g)):(d.push(null),d.push(null),u.push(null),u.push(null),h||p.push(null))}var b=this._createShape(d,u,t);return!h&&b?b.context={chart:this.chart,series:this,points:p}:e.merge(t,m),f},_e.prototype._renderLinearData=function(t){var i=this.arrData,n=i.length,s=null!=this.markers&&this.markers.isVisible();null!=this.labels&&this.labels.visible!==!1;for(var o,a,r,l,c,h,d=[],u=[],p=[],m=[],f=[],g=s?this.markers.size/2:0,v=0;n>v;v++){var _=i[v];null!==_?(l=_[0],c=_[1],h=_[2],o=this.realXAxis.getPosition(l),a=this.realYAxis.getPosition(c),r=this.realYAxis.getPosition(h),d.push(o),d.push(a),u.push(o),u.push(r),s||(p[v]=p[2*n-v-1]={dataItem:_,index:v,x:l,from:c,to:h}),this._addMarkersAndLabels(m,f,o,a,r,v,n,null,c,h,g)):(pts.push(null),pts.push(null),s||p.push(null))}var b=this._createShape(d,u,t);return!s&&b?b.context={chart:this.chart,series:this,points:p}:e.merge(t,m),f},_e.prototype._createShape=function(t,e,i){var n=new C(t,e);return this._setShapeSettings(n),i.push(n),this._addLengthAnimation(n),n},_e.prototype._addMarkersAndLabels=function(t,e,i,n,s,o,a,r,l,c,h){var d=0,u=r?r:o;if(this.markers&&this.markers.isVisible()){var p={chart:this.chart,series:this,dataItem:data[o],index:o,x:this.realXAxis._getValue(u),from:l,to:c};d=this.markers.offset;var m=p.dataItem[3],f=this._addMarker(i,n,null,l,m);f.marker&&(f.marker.context=p,f.line&&t.push(f.line),t.push(f.marker),this._addShapeAnimation(f.marker,o,a)),f=this._addMarker(i,s,null,c,m),f.marker&&(f.marker.context=p,f.line&&t.push(f.line),t.push(f.marker),this._addShapeAnimation(f.marker,o,a))}if(this.labels&&this.labels.visible!==!1){var g=this._getLabelValue(l,o),v=this._getDataPointLabel(l,i,n,h+d,g,l>c),p={chart:this.chart,series:this,dataItem:data[o],index:o};v.context=p,this.chart.elem.trigger("dataPointLabelCreating",v),e.push(v),this._addShapeAnimation(v,o,a),g=this._getLabelValue(c,o),v=this._getDataPointLabel(c,i,s,h+d,g,c>l),v.context=p,this.chart.elem.trigger("dataPointLabelCreating",v),e.push(v),this._addShapeAnimation(v,o,a)}},_e.prototype._getDataPointLabel=function(t,i,n,s,o,a){var r=this._getLabelText(o),c=new T(r);return l.setShadows(c,this,this.chart),e.extend(c,this.labels),c.measure(this.chart.ctx),c.textAlign="center",c.x=i,a?(c.y=n-s,c.textBaseline="bottom"):(c.y=n+s,c.textBaseline="top"),c},_e.prototype._getTooltip=function(t){var e="From: <b>"+t.from.toString()+"</b><br/>"+"To: <b>"+t.to.toString()+"</b>";if(this.title){var i=u.getColorFromFillStyle(this.fillStyle);e='<div style="color:'+i+'">'+this.title+"</div>"+e}return e},be.prototype.setOptions=function(t){this.clear(),t=t||{};for(var e=[],i=0;i<t.length;i++){var n=t[i];this._resolveType(n);var s;switch(n.type){case"category":s=new we(n);break;case"dateTime":s=new Ce(n);break;case"linear":default:s=new xe(n)}s._setChart(this.chart),e.push(s)}this.userAxes=e},be.prototype._resolveType=function(t){if(!t.type){var e=this.chart.series.items;e.length<1||e[0]._resolveAxisType(t)}},be.prototype._initSeriesAxes=function(){var t=[];e.merge(t,this.userAxes);for(var i=this.chart.series.items,n=0;n<i.length;n++){var s=i[n];s.visible&&(s._initXAxis(t),s._initYAxis(t),s._initSharedAxes())}this.items=t},be.prototype._initSeries=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i._initSeries()}},be.prototype._initRanges=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i._initRange()}},be.prototype._resetWH=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i.isCustomWidth||(i.width=0,i.height=0)}},be.prototype._measure=function(){for(var t=this.items,e=!1,i=0;i<t.length;i++){var n=t[i],s=n._measure();e=e||s}return e},be.prototype._arrange=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i._arrange()}},be.prototype._getAxesInLoc=function(t){for(var e=[],i=this.items,n=0;n<i.length;n++){var s=i[n];s.location==t&&e.push(s)}return e},be.prototype._getVAxes=function(){for(var t=[],e=this.items,i=0;i<e.length;i++){var n=e[i];n.isVertical()&&t.push(n)}return t},be.prototype._getHAxes=function(){for(var t=[],e=this.items,i=0;i<e.length;i++){var n=e[i];0==n.isVertical()&&t.push(n)}return t},be.prototype._getTotalWidth=function(){if(this.horCrossingAxis)return 0;for(var t=0,e=this.items,i=0;i<e.length;i++){var n=e[i];n.isVertical()&&(t+=n.width)}return t},be.prototype._getTotalHeight=function(){if(this.verCrossingAxis)return 0;for(var t=0,e=this.items,i=0;i<e.length;i++){var n=e[i];0==n.isVertical()&&(t+=n.height)}return t},be.prototype._render=function(t){for(var i=this.items,n=[],s=[],o=0;o<i.length;o++){var a=i[o],r=a._render(t);r.postShapes&&e.merge(n,r.postShapes),r.contextShapes&&e.merge(s,r.contextShapes)}return{postShapes:n,contextShapes:s}},be.prototype._updateOrigins=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i._updateOrigin()}},be.prototype._correctOrigins=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i._correctOrigin&&i._correctOrigin()}},be.prototype._updateCrossings=function(){var t=this.verCrossingAxis,e=this.horCrossingAxis;if(t)for(var i=t.getPosition(t.crossing),n=this._getHAxes(),s=0;s<n.length;s++){var o=n[s];o.crossOffsetY=i-o.y,"top"==o.location&&(o.crossOffsetY-=o.height)}if(e)for(var i=e.getPosition(e.crossing),a=this._getVAxes(),s=0;s<a.length;s++){var o=a[s];o.crossOffsetX=i-o.x,"left"==o.location&&(o.crossOffsetX-=o.width)}},be.prototype._initCrossingAxes=function(){for(var t=this._getVAxes(),e=this._getHAxes(),i=null,n=null,s=0;s<t.length;s++){var o=t[s];if(!h.isNull(o.crossing)){n=o;break}}for(var s=0;s<e.length;s++){var o=e[s];if(!h.isNull(o.crossing)){i=o;break}}this.horCrossingAxis=i,this.verCrossingAxis=n},be.prototype.getZoomableAxes=function(){for(var t=[],e=this.items,i=0;i<e.length;i++){var n=e[i];n.zoomEnabled&&t.push(n)}return t},be.prototype.find=function(t){var e=this.items;if(null!=t)for(var i=0;i<e.length;i++){var n=e[i];if(n.name==t)return n}return null},be.prototype.clear=function(){this.items&&e.each(this.items,function(){this.clear()})},Se(ye,c),ye.prototype._initDefs=function(){c.prototype._initDefs.call(this);var t=e.extend(!0,{},this.defaults,{rangeSlider:{visible:!0,breadth:20},margin:5,strokeStyle:"black",lineWidth:1,zoomEnabled:!1,visible:!0});this.defaults=t},ye.prototype._initSeries=function(){for(var t=new Q(null,this.chart),e=this.chart.series.items,i=0;i<e.length;i++){var n=e[i];(n.realXAxis==this||n.realYAxis==this)&&t.items.push(n)}this.series=t},ye.prototype._setVisibleRanges=function(){if(c.prototype._setVisibleRanges.call(this),this.jqRangeSlider){var t=(this.actualMaximum-this.actualMinimum)/10;this.jqRangeSlider.jqRangeSlider("update",{minimum:this.actualMinimum,maximum:this.actualMaximum,smallChange:t,largeChange:2*t,minRange:t/100,range:{minimum:this.actualVisibleMinimum,maximum:this.actualVisibleMaximum}})}},ye.prototype._arrange=function(){if(c.prototype._arrange.call(this),!this.zoomEnabled)return this.clear(),void 0;var t=this.rangeSlider.breadth;if(this.rangeSlider.visible!==!1){this.offset+=t;var i=this.offset;if(!this.jqRangeSlider){var n=e('<div style="position:absolute"></div>').jqRangeSlider({}),s=this;n.bind("rangeChanging",function(t,e){s._sliderZoom(e)}),n.bind("rangeChanged",function(t,e){s._sliderZoom(e)}),this.chart.elem.append(n),this.jqRangeSlider=n}var o;switch(this.location){case"left":o={left:this.x+this.width-i,top:this.y,width:t,height:this.height};break;case"right":o={left:this.x+this.lineWidth/2,top:this.y,width:t,height:this.height};break;case"top":o={left:this.x,top:this.y+this.height-i,width:this.width,height:t};break;case"bottom":o={left:this.x,top:this.y+this.lineWidth/2,width:this.width,height:t}}if(o){var a=this.isAxisVertical?"vertical":"horizontal";this.jqRangeSlider.css(o).jqRangeSlider("update",{orientation:a,reversed:this.reversed})}}},ye.prototype._moveVisibleRange=function(t,e){var i=this.isAxisVertical,n=this.actualVisibleMinimum,s=this.actualVisibleMaximum,o=s-n,a=0;a=i?-o*e/this.length:o*t/this.length,this.reversed&&(a=-a),a=Math.max(a,this.actualMinimum-n),a=Math.min(a,this.actualMaximum-s),this.visibleMinimum=n+a,this.visibleMaximum=s+a,this._setVisibleRanges(),this._zoom()},ye.prototype._mouseWheelZoom=function(t){var e=this.actualVisibleMinimum,i=this.actualVisibleMaximum,n=(this.actualMaximum-this.actualMinimum)/1e3,s=50*t*n;if(e=Math.max(this.actualMinimum,e+s),i=Math.min(this.actualMaximum,i-s),e>i-n){n/=2;var o=(e+i)/2;e=o-n,i=o+n}this.visibleMinimum=e,this.visibleMaximum=i,this._setVisibleRanges(),this._zoom()},ye.prototype._scaleVisibleRange=function(t,e){var i,n,s,o=this.actualVisibleMinimum,a=this.actualVisibleMaximum,r=a-o,l=this.getZoom(),c=this.isAxisVertical;if(c){i=t.dy/e.dy;var h=e.y1-t.y1,d=e.y2-t.y2;if(n=-r*d/this.length/l,s=-r*h/this.length/l,t.y1>t.y2){var u=n;n=s,s=u}}else{i=t.dx/e.dx;var p=e.x1-t.x1,m=e.x2-t.x2;if(n=r*p/this.length/l,s=r*m/this.length/l,t.x1>t.x2){var u=n;n=s,s=u}}if(this.reversed){var u=n;n=-s,s=-u}var f=(o+a)/2,g=(this.actualMaximum-this.actualMinimum)/1e3;o=Math.max(this.actualMinimum,o-n),a=Math.min(this.actualMaximum,a-s),o>a-g&&(g/=2,o=f-g,a=f+g),this.visibleMinimum=o,this.visibleMaximum=a,this._setVisibleRanges(),this._zoom()},ye.prototype._scaleToRegion=function(t,e){var i,n,s=this.chart.gridArea,o=s.fitHor(t.locX),a=s.fitVer(t.locY),r=s.fitHor(e.locX),l=s.fitVer(e.locY),c=this.reversed;this.isAxisVertical?c?(i=Math.min(a,l),n=Math.max(a,l)):(i=Math.max(a,l),n=Math.min(a,l)):c?(i=Math.max(o,r),n=Math.min(o,r)):(i=Math.min(o,r),n=Math.max(o,r)),i=this.getValue(i),n=this.getValue(n);var h=(this.actualMaximum-this.actualMinimum)/1e3;if(h>n-i){var d=(h-(n-i))/2;i-=d,n+=d}this.visibleMinimum=i,this.visibleMaximum=n,this._setVisibleRanges(),this._zoom()},ye.prototype._sliderZoom=function(t){this.visibleMinimum=this.options.visibleMinimum=t.minimum,this.visibleMaximum=this.options.visibleMaximum=t.maximum,this.chart.partialDelayedUpdate(),this._zoom()},ye.prototype._zoom=function(){this.chart.elem.trigger("axisZoom",{chart:this.chart,axis:this})},ye.prototype._getTooltip=function(t){return"<b>"+t+"</b><br/>"},ye.prototype.getCatPosition=function(t){return c.prototype.getPosition.call(this,t)},ye.prototype.resetZoom=function(){this.zoomEnabled&&(this.visibleMinimum=this.actualMinimum,this.visibleMaximum=this.actualMaximum,this._setVisibleRanges(),this._zoom())},ye.prototype.clear=function(){this.jqRangeSlider&&(this.jqRangeSlider.jqRangeSlider("destroy"),this.jqRangeSlider.remove(),this.jqRangeSlider=null)},Se(we,ye),we.prototype.getCategories=function(){if(this.categories)return this.categories;var t=this.chart.arrDataSource;if(!t)return null;var e=this.categoriesField,i=h.processDataField(t,e);return i},we.prototype._initRange=function(){var t=this.series;t._initCategories();var e=t.categories;this.arrCats=this.getCategories();var i=e.length;this.arrCats&&(i=Math.max(i,this.arrCats.length));var n=0,s=i;h.isNull(this.minimum)||(n=this.minimum),h.isNull(this.maximum)||(s=this.maximum),this.actualMinimum=n,this.actualMaximum=s,this._setVisibleRanges(),this.actualInterval=this.interval||1,this.seriesCategories=e},we.prototype._getLabelIntervals=function(t,e){var i=0;e&&e.intervalOffset&&(i=e.intervalOffset);for(var n=[],s=Math.round(this.actualVisibleMinimum),o=this._getIntervalStart(s,t)+.5,a=o+i;a<=this.actualVisibleMaximum;a=h.round(a+t))n.push(a);return n},we.prototype._getIntervalCount=function(){return this.arrCats.length},we.prototype._getValue=function(t){var e,i=Math.round(t);return e=this.arrCats&&i<this.arrCats.length?this.arrCats[i]:this.seriesCategories[i]},we.prototype.getLabel=function(t){var i;if("string"==e.type(t))i=t;else{var n=Math.round(t-.5);i=this.arrCats&&n<this.arrCats.length?this.arrCats[n]:this.seriesCategories[n]}return i=i||"",ye.prototype.getLabel.call(this,i)},we.prototype.getCatPosition=function(t){return this.reversed&&t++,c.prototype.getPosition.call(this,t)},we.prototype.getOrientation=function(){return"x"},Se(xe,ye),xe.prototype._initDefs=function(){ye.prototype._initDefs.call(this);var t=e.extend(!0,{},this.defaults,{extendRangeToOrigin:!1,logarithmic:!1,logBase:10,labels:{resolveOverlappingMode:"hide"}});this.defaults=t},xe.prototype._initRange=function(){var t=this.series;t._initRanges();var e,i;"x"==this.getOrientation()?(e=t.minX,i=t.maxX):(e=t.min,i=t.max),e==Le&&i==Ae&&(e=0,i=10);var n=this._addPlotsInRange(e,i);e=n.min,i=n.max,h.isNull(this.minimum)||(e=this.minimum),h.isNull(this.maximum)||(i=this.maximum),this.skipEmptyDays&&(i-=this.totalEmptyDaysTicks);var s=Math.abs(i-e);0==s&&(s=1);var o=0,a=0,r=t._getPixelMargins(this);this.isAxisVertical?(r.left=h.isNull(this.bottomMargin)?r.left+.5:this.bottomMargin,r.right=h.isNull(this.topMargin)?r.right+.5:this.topMargin):(r.left=h.isNull(this.leftMargin)?r.left+.5:this.leftMargin,r.right=h.isNull(this.rightMargin)?r.right+.5:this.rightMargin);var l=s/this.length;o=l*r.left,a=l*r.right,this.logarithmic===!0&&(o=Math.max(0,h.log(o,this.logBase)),a=Math.max(0,h.log(a,this.logBase)));var c=e-o,d=i+a,u=this.series._isAnchoredToOrigin(),p=this.getCrossing();if(u&&"y"==this.getOrientation()&&(e>=p&&p>c?c=p:p>=i&&d>p&&(d=p)),this.extendRangeToOrigin&&(c>p?c=p:p>d&&(d=p)),this.logarithmic===!0){var m=1;m>c&&(c=m),c=h.log(c,this.logBase),d=h.log(d,this.logBase);var f=this._calculateActualIntervalLogarithmic(c,d);c=h.round(Math.floor(c/f)*f),d=h.round(Math.ceil(d/f)*f)}this._setMinMax(c,d),this._setVisibleRanges(),this.actualInterval=this.logarithmic===!0?this._calculateActualIntervalLogarithmic(this.actualVisibleMinimum,this.actualVisibleMaximum):this._calculateActualInterval(this.actualVisibleMinimum,this.actualVisibleMaximum)},xe.prototype._addPlotsInRange=function(t,e){var i=this.plotLines;if(i)for(var n=0;n<i.length;n++){var s=i[n].value;t=Math.min(t,s),e=Math.max(e,s)}var o=this.plotBands;if(o)for(var n=0;n<o.length;n++){var a=o[n].from,r=o[n].to;t=Math.min(t,a),e=Math.max(e,a),t=Math.min(t,r),e=Math.max(e,r)}return{min:t,max:e}},xe.prototype._calculateActualIntervalLogarithmic=function(t,e){if(this.interval)return this.interval;var i=(e-t)/3,n=Math.floor(h.log10(Math.abs(i)));return 0==n&&(n=1),h.round(Math.floor(i/n)*n)},xe.prototype._getIntervals=function(t,e,i){if(this.customTickMarks)return this.customTickMarks;if(this.logarithmic===!1)return ye.prototype._getIntervals.call(this,t,e);if(i===!1)return this._getLogarithmicMinorIntervals(t,e);var n=0;e&&e.intervalOffset&&(n=e.intervalOffset);for(var s=[],o=this._getIntervalStart(this.actualVisibleMinimum,t),a=o+n;a<=this.actualVisibleMaximum;a=h.round(a+t))s.push(Math.pow(this.logBase,a));return s},xe.prototype._getLogarithmicMinorIntervals=function(t,e){for(var i=this._getMarkInterval(e.major,!0),n=this._getIntervals(i,e.major,!0),s=[],o=null,a=0;a<n.length;a++){var r=n[a];if(null!=o){var l=o,c=r;if(c>l){var d=l;l=c,c=d}for(var u=(l-c)*t/10,p=c+u;l>p;)s.push(h.round(p)),p+=u;o=r}else o=r}return s},xe.prototype._getIntervalCount=function(){return Math.ceil(this.actualMaximum-this.actualMinimum)},xe.prototype.getCrossingPosition=function(){return this.getPosition(this.getCrossing())},xe.prototype.getOrientation=function(t){var e=this.isVertical();if(this.series)for(var i=0;i<this.series.items.length;i++)t=this.series.items[i];return t&&t.isVertical&&(e=!e),e?"y":"x"},xe.prototype.getPosition=function(t){1==this.logarithmic&&(t=h.log(t,this.logBase));var e=ye.prototype.getPosition.call(this,t);return e},Ce.prototype=new xe,Ce.constructor=Ce,Ce.prototype._initDefs=function(){xe.prototype._initDefs.call(this);var t=e.jqChartDateFormat.masks,i=e.extend(!0,{},this.defaults,{labels:{yearsIntervalStringFormat:"yyyy",monthsIntervalStringFormat:t.shortDate,weeksIntervalStringFormat:t.shortDate,daysIntervalStringFormat:t.shortDate,hoursIntervalStringFormat:t.shortDate+" "+t.shortTime,minutesIntervalStringFormat:t.shortTime,secondsIntervalStringFormat:t.longTime,millisecondsIntervalStringFormat:t.longTime},skipEmptyDays:!1});this.defaults=i},Ce.prototype._initRange=function(){this.skipEmptyDays?(this.emptyDays=this._getEmptyDays(),this.totalEmptyDaysTicks=this.emptyDays.length*d.ticksInDay):this.totalEmptyDaysTicks=0,xe.prototype._initRange.call(this),this._initActualStringFormat()},Ce.prototype._setMinMax=function(t,i){this.actualMinimum=null!=this.minimum?"date"==e.type(this.minimum)?this.minimum.getTime():this.minimum:t,this.actualMaximum=null!=this.maximum?"date"==e.type(this.minimum)?this.maximum.getTime():this.maximum:i},Ce.prototype._calculateActualInterval=function(t,e){this.skipEmptyDays&&(e+=this.totalEmptyDaysTicks);var i=this._calculateDateTimeInterval(t,e);return this.actualIntervalType=null!=this.intervalType?this.intervalType:this.type,null!=this.interval&&(i=this.interval),i},Ce.prototype._calculateDateTimeInterval=function(t,e){var i=e-t,n=.8*this.maxInter200Px,s=Math.max(1,this.length),o=s/(2e3/n),a=i/o;this.type="year";var r=a/6e4;if(1>=r){if(10>=a)return this.type="milliseconds",1;if(50>=a)return this.type="milliseconds",4;if(200>=a)return this.type="milliseconds",20;if(500>=a)return this.type="milliseconds",50;var l=a/1e3;if(7>=l)return this.type="seconds",1;if(15>=l)return this.type="seconds",2;if(30>=l)return this.type="seconds",5;if(60>=l)return this.type="seconds",10}else if(2>=r)return this.type="seconds",20;if(3>=r)return this.type="seconds",30;if(10>=r)return this.type="minutes",1;if(20>=r)return this.type="minutes",2;if(60>=r)return this.type="minutes",5;if(120>=r)return this.type="minutes",10;if(180>=r)return this.type="minutes",30;if(720>=r)return this.type="hours",1;if(1440>=r)return this.type="hours",4;if(2880>=r)return this.type="hours",6;if(4320>=r)return this.type="hours",12;if(14400>=r)return this.type="days",1;if(28800>=r)return this.type="days",2;if(43200>=r)return this.type="days",3;if(87840>=r)return this.type="weeks",1;if(219600>=r)return this.type="weeks",2;if(527040>=r)return this.type="months",1;if(1054080>=r)return this.type="months",3;if(2108160>=r)return this.type="months",6;this.type="years";var c=r/60/24/365;return 5>c?1:10>c?2:Math.floor(c/5)},Ce.prototype._getNextPosition=function(t,e){return this._incrementDateTime(t,e,this.actualIntervalType)},Ce.prototype._incrementDateTime=function(t,e,i){var n=new Date(t),s=0;if("days"==i)n=d.addDays(n,e);else if("hours"==i)s=d.fromHours(e);else if("milliseconds"==i)s=e;else if("seconds"==i)s=d.fromSeconds(e);else if("minutes"==i)s=d.fromMinutes(e);else if("weeks"==i)n=d.addDays(n,7*e);else if("months"==i){var o=!1;if(n.getDate()==d.getDaysInMonth(n.getFullYear(),n.getMonth())&&(o=!0),n=d.addMonths(n,Math.floor(e)),s=d.fromDays(30*(e-Math.floor(e))),o&&0==s){var a=d.getDaysInMonth(n.getFullYear(),n.getMonth());n=d.addDays(n,a-n.getDate())}}else"years"==i&&(n=d.addYears(n,Math.floor(e)),s=d.fromDays(365*(e-Math.floor(e))));return n.getTime()+s},Ce.prototype._getIntervalStart=function(t,e,i){if(null==i)return t;var n=new Date(t);if(e>0&&1!=e&&"months"==i&&12>=e&&e>1){for(var s=n,o=new Date(n.getFullYear(),0,1,0,0,0);n>o;)s=o,o=d.addMonths(o,e);return n=s,n.getTime()}switch(i){case"years":var a=n.getFullYear()/e*e;0>=a&&(a=1),n=new Date(a,0,1,0,0,0);break;case"months":var r=n.getMonth()/e*e;0>r&&(r=0),n=new Date(n.getFullYear(),r,1,0,0,0);break;case"days":var l=n.getDate()/e*e;0>=l&&(l=1),n=new Date(n.getFullYear(),n.getMonth(),l,0,0,0);break;case"hours":var c=n.getHours()/e*e;n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),c,0,0);break;case"minutes":var h=n.getMinutes()/e*e;n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),h,0);break;case"seconds":var u=n.getSeconds()/e*e;n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),u,0);break;case"milliseconds":var p=n.getMilliseconds()/e*e;n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),p);break;case"weeks":n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0),n=d.addDays(n,-d.getDayOfWeek(n))}return n.getTime()},Ce.prototype._initActualStringFormat=function(){if(this.labels&&this.labels.visible!==!1){if(this.labels.stringFormat)return this.actualStringFormat=this.labels.stringFormat,void 0;switch(this.actualIntervalType){case"years":this.actualStringFormat=this.labels.yearsIntervalStringFormat;break;case"months":this.actualStringFormat=this.labels.monthsIntervalStringFormat;break;case"weeks":this.actualStringFormat=this.labels.weeksIntervalStringFormat;break;case"days":this.actualStringFormat=this.labels.daysIntervalStringFormat;break;case"hours":this.actualStringFormat=this.labels.hoursIntervalStringFormat;break;case"minutes":this.actualStringFormat=this.labels.minutesIntervalStringFormat;break;case"seconds":this.actualStringFormat=this.labels.secondsIntervalStringFormat;break;case"milliseconds":this.actualStringFormat=this.labels.millisecondsIntervalStringFormat;break;default:this.actualStringFormat="default"}}},Ce.prototype._getIntervals=function(t,e){if(this.customTickMarks)return this.customTickMarks;var i=[],n=this.actualVisibleMinimum,s=this.actualVisibleMaximum;this.skipEmptyDays&&(n=this._addEmptyDaysOffset(n),s=this._addEmptyDaysOffset(s));for(var o=this._getIntervalStart(n,t,this.actualIntervalType);n>o;)o=this._incrementDateTime(o,t,this.actualIntervalType);if(e&&e.intervalOffset){var a=this.actualIntervalType,r=e.intervalOffset;e.intervalOffsetType&&(a=e.intervalOffsetType),o=this._incrementDateTime(o,r,a)}for(var l=o;s>=l;l=this._incrementDateTime(l,t,this.actualIntervalType)){var c=this._getNextNonEmptyDay(l);c&&(this.skipEmptyDays&&c>l&&(l=c),i.push(c))}return i},Ce.prototype._getIntervalCount=function(){var t=this.actualMaximum-this.actualMinimum;return t=Math.ceil(t/d.ticksInDay)},Ce.prototype._getNextNonEmptyDay=function(t){if(!this.emptyDays)return t;var i=e.inArray(t,this.emptyDays);if(-1==i)return t;var n=d.addDays(new Date(t),1),s=this.actualMaximum;this.skipEmptyDays&&(s+=this.totalEmptyDaysTicks);for(var o=n;s>=o;o=d.addDays(o,1)){var a=o.getTime();if(i=e.inArray(a,this.emptyDays),-1==i)return a}return null},Ce.prototype._getEmptyDaysOffset=function(t){if(!this.emptyDays)return 0;for(var e=0,i=0;i<this.emptyDays.length;i++){var n=this.emptyDays[i];if(!(t>n))break;e++}return e*d.ticksInDay},Ce.prototype._addEmptyDaysOffset=function(t){if(h.isNull(t))return null;var e=t+this._getEmptyDaysOffset(t),i=this._getEmptyDaysOffset(e)-this._getEmptyDaysOffset(t);for(t=e,e+=i;i;)i=this._getEmptyDaysOffset(e)-this._getEmptyDaysOffset(t),t=e,e+=i;return e},Ce.prototype._getEmptyDays=function(){for(var t=[],e=0;e<this.series.items.length;e++){var i=this.series.items[e];0==e?t=this._getEmptyDaysFromSeries(i):this._excludeDaysFromSeries(i,t)}return t},Ce.prototype._getEmptyDaysFromSeries=function(t){var i=[],n=[];e.merge(n,t.arrData),n.sort(function(t,e){return t[0]-e[0]});for(var s=d.roundToDay(n[0][0]),o=1;o<n.length;o++){for(var a=d.roundToDay(n[o][0]),r=(a-s)/d.ticksInDay,l=1;r>l;l++)i.push(d.addDays(s,l).getTime());s=a}return i},Ce.prototype._excludeDaysFromSeries=function(t,i){e.each(t.arrData,function(t,n){var s=d.roundToDay(n[0]).getTime(),o=e.inArray(s,i);-1!=o&&i.splice(o,1)})},Ce.prototype._getTooltip=function(t){var i=e.jqChartDateFormat.masks,n="";return 0!=t.getSeconds()?n+=i.shortDate+" "+i.longTime:0!=t.getHours()||0!=t.getMinutes()?n+=i.shortDate+" "+i.shortTime:n=i.shortDate,t=this.chart.stringFormat(t,n),"<b>"+t+"</b><br/>"},Ce.prototype.getPosition=function(t){"date"==e.type(t)&&(t=t.getTime());var i=0;this.skipEmptyDays&&(i=this._getEmptyDaysOffset(t));var n=xe.prototype.getPosition.call(this,t-i);return n},Ce.prototype.getLabel=function(t){if(this.labels&&this.labels.visible!==!1&&this.actualStringFormat){var i=new Date(t);return e.jqChartDateFormatter(i,this.actualStringFormat)}}}(t)}),define("_libs/charts/jqChart/src/js/jquery.jqRangeSlider.js",["jquery"],function(t){!function(t){function e(t){function e(){s?(i(),n(e),o=!0,s=!1):o=!1
}var i=t,s=!1,o=!1;this.kick=function(){s=!0,!o&&e()},this.end=function(t){var e=i;t&&(o?(i=s?function(){e(),t()}:t,s=!0):t())}}function i(i){this._init(i),this.isTouchDevice=!!("ontouchstart"in window),this.timer=new e(t.proxy(this._arrangeElements,this))}t.fn.jqRangeSlider=function(e,n,s){if("object"==typeof e)n=e;else if("string"==typeof e){if(e=e.toLowerCase(),t.fn.jqRangeSlider.methods[e])return t.fn.jqRangeSlider.methods[e].call(this,n,s);t.error("Method "+method+" does not exist on jQuery.jqRangeSlider")}var o=this.data("data");return o||(o=new i(this),this.data("data",o)),o._setOptions(n),this},t.fn.jqRangeSlider.methods={rangeslider:function(){return this.data("data")},destroy:function(){var t=this.data("data");t&&(t.destroy(),this.removeData("data"))},options:function(){var t=this.data("data");return t?t.options:void 0},option:function(t,e){var i=this.data("data");if(i){if(!e)return i.options[t];i.options[t]=e,i._setOptions(i.options)}},update:function(e){var i=this.data("data");if(!i)return this;var n=t.extend(!1,{},i.options,e||{});return i._setOptions(n),this},preview:function(){var t=this.data("data");return t?"horizontal"==t.orientation?t.bgHor:t.bgVer:null}},t.fn.jqRangeSlider.defaults={orientation:"horizontal",mode:"normal",minimum:0,maximum:100,minRange:0,range:{minimum:null,maximum:null},smallChange:10,largeChange:20,reversed:!1},t.fn.jqMouseCapture=function(e){var i=t(document);return this.each(function(){var n=t(this),s={};n.mousedown(function(t){var o;e.move&&(o=function(t){e.move.call(n,t,s)},i.mousemove(o));var a,r=function(){e.move&&i.unbind("mousemove",o),i.unbind("mouseup",a)};return a=e.up?function(t){return r(),e.up.call(n,t,s)}:r,i.mouseup(a),t.preventDefault(),e.down.call(n,t,s)})}),this};var n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(function(){t()},25)}}();i.prototype={_init:function(t){this.elem=t,t.addClass("ui-jqrangeslider ui-widget"),"static"==t.css("position")&&t.css("position","relative")},_createElements:function(){var t=this.elem;t.children().remove(),"horizontal"==this.orientation?this._createHorElements(t):this._createVerElements(t)},_createHorElements:function(e){var i=this;this.bgHor=t("<div class='ui-jqrangeslider-background-horizontal'></div>").css("top",0).css("left",0),e.append(this.bgHor),this.bgHorLeft=t("<div class='ui-jqrangeslider-background-horizontal-left'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(t){i._largeScrollStart(t),i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()},up:t.proxy(i._stopScroll,this)}),e.append(this.bgHorLeft),this.bgHorRight=t("<div class='ui-jqrangeslider-background-horizontal-right'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(t){i._largeScrollStart(t),i.scrolling=!0,i.scrollingCount=0,i._scrollRight()},up:t.proxy(i._stopScroll,this)}),e.append(this.bgHorRight),this.arrowLeft=t("<div class='ui-jqrangeslider-arrow-left ui-corner-left ui-widget-header'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(){i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()},up:t.proxy(i._stopScroll,this)}),e.append(this.arrowLeft),this._addHover(this.arrowLeft),this.arrowIconLeft=t("<span class='ui-jqrangeslider-arrow-icon-left ui-icon ui-icon-circle-triangle-w'></span>"),this.arrowLeft.append(this.arrowIconLeft),this.arrowRight=t("<div class='ui-jqrangeslider-arrow-right ui-corner-right ui-widget-header'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(){i.scrolling=!0,i.scrollingCount=0,i._scrollRight()},up:t.proxy(i._stopScroll,this)}),e.append(this.arrowRight),this._addHover(this.arrowRight),this.arrowIconRight=t("<span class='ui-jqrangeslider-arrow-icon-right ui-icon ui-icon-circle-triangle-e'></span>"),this.arrowRight.append(this.arrowIconRight),this.sliderHor=t("<div class='ui-jqrangeslider-slider-horizontal'></div>").css("top",0).css("left",0).jqMouseCapture({down:t.proxy(i._startDragHor,this),move:t.proxy(i._draggingHor,this),up:t.proxy(i._stopDragHor,this)}),e.append(this.sliderHor),this.handleLeft=t("<div class='ui-jqrangeslider-handle-left ui-state-default'></div>").css("top",0).css("left",0).jqMouseCapture({down:t.proxy(i._startResizeLeft,this),move:t.proxy(i._resizeLeft,this),up:t.proxy(i._stopResizeLeft,this)}),e.append(this.handleLeft),this._addHover(this.handleLeft),this.handleIconLeft=t("<span class='ui-jqrangeslider-handle-icon-left ui-icon ui-icon-grip-solid-vertical'></span>"),this.handleLeft.append(this.handleIconLeft),this.handleRight=t("<div class='ui-jqrangeslider-handle-right ui-state-default'></div>").css("top",0).css("left",0).jqMouseCapture({down:t.proxy(i._startResizeRight,this),move:t.proxy(i._resizeRight,this),up:t.proxy(i._stopResizeRight,this)}),e.append(this.handleRight),this._addHover(this.handleRight),this.handleIconRight=t("<span class='ui-jqrangeslider-handle-icon-right ui-icon ui-icon-grip-solid-vertical'></span>"),this.handleRight.append(this.handleIconRight),"preview"!=this.mode&&(this.bgHorLeft.addClass("ui-widget-content"),this.bgHorRight.addClass("ui-widget-content"),this.sliderHor.addClass("ui-widget-header")),this.isTouchDevice&&(this.bgHorLeft.bind("touchstart",function(t){t.preventDefault(),i._largeScrollStart(t,!0),i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()}).bind("touchend",function(){i._stopScroll()}),this.bgHorRight.bind("touchstart",function(t){t.preventDefault(),i._largeScrollStart(t,!0),i.scrolling=!0,i.scrollingCount=0,i._scrollRight()}).bind("touchend",function(){i._stopScroll()}),this.arrowLeft.bind("touchstart",function(t){t.preventDefault(),i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()}).bind("touchend",function(){i._stopScroll()}),this.arrowRight.bind("touchstart",function(t){t.preventDefault(),i.scrolling=!0,i.scrollingCount=0,i._scrollRight()}).bind("touchend",function(){i._stopScroll()}),this.sliderHor.bind("touchstart",function(t){i._startDragHor(t,!0)}).bind("touchmove",function(t){i._draggingHor(t,!0)}).bind("touchend",function(t){i._stopDragHor(t)}),this.handleLeft.bind("touchstart",function(t){i._startResizeLeft(t,!0)}).bind("touchmove",function(t){i._resizeLeft(t,!0)}).bind("touchend",function(t){i._stopResizeLeft(t)}),this.handleRight.bind("touchstart",function(t){i._startResizeRight(t,!0)}).bind("touchmove",function(t){i._resizeRight(t,!0)}).bind("touchend",function(t){i._stopResizeRight(t)}))},_createVerElements:function(e){var i=this;this.bgVer=t("<div class='ui-jqrangeslider-background-vertical'></div>").css("top",0).css("left",0),e.append(this.bgVer),this.bgVerBottom=t("<div class='ui-jqrangeslider-background-vertical-bottom'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(t){i._largeScrollStart(t),i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()},up:t.proxy(i._stopScroll,this)}),e.append(this.bgVerBottom),this.bgVerTop=t("<div class='ui-jqrangeslider-background-vertical-top'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(t){i._largeScrollStart(t),i.scrolling=!0,i.scrollingCount=0,i._scrollRight()},up:t.proxy(i._stopScroll,this)}),e.append(this.bgVerTop),this.arrowBottom=t("<div class='ui-jqrangeslider-arrow-bottom ui-corner-bottom ui-widget-header'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(){i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()},up:t.proxy(i._stopScroll,this)}),e.append(this.arrowBottom),this._addHover(this.arrowBottom),this.arrowIconBottom=t("<span class='ui-jqrangeslider-arrow-icon-bottom ui-icon ui-icon-circle-triangle-s'></span>"),this.arrowBottom.append(this.arrowIconBottom),this.arrowTop=t("<div class='ui-jqrangeslider-arrow-top ui-corner-top ui-widget-header'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(){i.scrolling=!0,i.scrollingCount=0,i._scrollRight()},up:t.proxy(i._stopScroll,this)}),e.append(this.arrowTop),this._addHover(this.arrowTop),this.arrowIconTop=t("<span class='ui-jqrangeslider-arrow-icon-top ui-icon ui-icon-circle-triangle-n'></span>"),this.arrowTop.append(this.arrowIconTop),this.sliderVer=t("<div class='ui-jqrangeslider-slider-vertical'></div>").css("top",0).css("left",0).jqMouseCapture({down:t.proxy(i._startDragVer,this),move:t.proxy(i._draggingVer,this),up:t.proxy(i._stopDragVer,this)}),e.append(this.sliderVer),this.handleBottom=t("<div class='ui-jqrangeslider-handle-bottom ui-state-default'></div>").css("top",0).css("left",0).jqMouseCapture({down:t.proxy(i._startResizeBottom,this),move:t.proxy(i._resizeBottom,this),up:t.proxy(i._stopResizeBottom,this)}),e.append(this.handleBottom),this._addHover(this.handleBottom),this.handleIconBottom=t("<span class='ui-jqrangeslider-handle-icon-bottom ui-icon ui-icon-grip-solid-horizontal'></span>"),this.handleBottom.append(this.handleIconBottom),this.handleTop=t("<div class='ui-jqrangeslider-handle-top ui-state-default'></div>").css("top",0).css("left",0).jqMouseCapture({down:t.proxy(i._startResizeTop,this),move:t.proxy(i._resizeTop,this),up:t.proxy(i._stopResizeTop,this)}),e.append(this.handleTop),this._addHover(this.handleTop),this.handleIconTop=t("<span class='ui-jqrangeslider-handle-icon-top ui-icon ui-icon-grip-solid-horizontal'></span>"),this.handleTop.append(this.handleIconTop),"preview"!=this.mode&&(this.bgVerBottom.addClass("ui-widget-content"),this.bgVerTop.addClass("ui-widget-content"),this.sliderVer.addClass("ui-widget-header")),this.isTouchDevice&&(this.bgVerBottom.bind("touchstart",function(t){t.preventDefault(),i._largeScrollStart(t,!0),i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()}).bind("touchend",function(){i._stopScroll()}),this.bgVerTop.bind("touchstart",function(t){t.preventDefault(),i._largeScrollStart(t,!0),i.scrolling=!0,i.scrollingCount=0,i._scrollRight()}).bind("touchend",function(){i._stopScroll()}),this.arrowBottom.bind("touchstart",function(t){t.preventDefault(),i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()}).bind("touchend",function(){i._stopScroll()}),this.arrowTop.bind("touchstart",function(t){t.preventDefault(),i.scrolling=!0,i.scrollingCount=0,i._scrollRight()}).bind("touchend",function(){i._stopScroll()}),this.sliderVer.bind("touchstart",function(t){i._startDragVer(t,!0)}).bind("touchmove",function(t){i._draggingVer(t,!0)}).bind("touchend",function(t){i._stopDragVer(t)}),this.handleBottom.bind("touchstart",function(t){i._startResizeBottom(t,!0)}).bind("touchmove",function(t){i._resizeBottom(t,!0)}).bind("touchend",function(t){i._stopResizeBottom(t)}),this.handleTop.bind("touchstart",function(t){i._startResizeTop(t,!0)}).bind("touchmove",function(t){i._resizeTop(t,!0)}).bind("touchend",function(t){i._stopResizeTop(t)}))},_setOptions:function(e){var i=t.extend(!0,{},t.fn.jqRangeSlider.defaults,e||{});this.options=i,i.range||(i.range={}),(this.orientation!=i.orientation||this.mode!=i.mode)&&(this.orientation=i.orientation,this.mode=i.mode,this._createElements());var n=i.range;n.minimum=null===n.minimum||void 0===n.minimum?i.minimum:n.minimum,n.maximum=null===n.maximum||void 0===n.maximum?i.maximum:n.maximum,this.lastChange=t.extend({},n),this._arrange()},_arrange:function(){this.timer.kick()},_arrangeElements:function(){"horizontal"==this.orientation?this._arrangeHor():this._arrangeVer()},_arrangeHor:function(){var t=this.options,e=t.range,i=this.elem,n=i.width(),s=i.height(),o=this.arrowLeft.outerWidth(),a=this.arrowRight.outerWidth(),r=this.handleLeft.outerWidth(),l=this.handleRight.outerWidth();this._outerH(this.arrowLeft,s),this._outerH(this.arrowRight,s).css("left",n-a),this.arrowIconLeft.css({top:(this.arrowLeft.height()-this.arrowIconLeft.height())/2,left:(this.arrowLeft.width()-this.arrowIconLeft.width())/2}),this.arrowIconRight.css({top:(this.arrowRight.height()-this.arrowIconRight.height())/2,left:(this.arrowRight.width()-this.arrowIconRight.width())/2});var c=o,h=n-c-a-r-l;this.innerW=h,this._outerH(this.bgHor,s).css("left",c+r),this._outerW(this.bgHor,h);var d=Math.round(this._map(e.minimum,h)),u=Math.round(h-this._map(e.maximum,h));if(t.reversed){var p=d;d=u,u=p}c+=d,h-=d+u,this._outerH(this.handleLeft,s).css("left",c),this._outerH(this.handleRight,s).css("left",c+h+r),this.handleIconLeft.css({top:(this.handleLeft.height()-this.handleIconLeft.height())/2,left:(this.handleLeft.width()-this.handleIconLeft.width())/2}),this.handleIconRight.css({top:(this.handleRight.height()-this.handleIconRight.height())/2,left:(this.handleRight.width()-this.handleIconRight.width())/2}),this._outerH(this.sliderHor,s).css("left",c+r),this._outerW(this.sliderHor,h),this._outerH(this.bgHorLeft,s).css("left",o),this._outerW(this.bgHorLeft,c-o),c+=h+r+l,this._outerH(this.bgHorRight,s).css("left",c),this._outerW(this.bgHorRight,n-c-a)},_arrangeVer:function(){var t=this.options,e=t.range,i=this.elem,n=i.width(),s=i.height(),o=this.arrowBottom.outerHeight(),a=this.arrowTop.outerHeight(),r=this.handleBottom.outerHeight(),l=this.handleTop.outerHeight();this._outerW(this.arrowBottom,n).css("top",s-o),this._outerW(this.arrowTop,n),this.arrowIconBottom.css({top:(this.arrowBottom.height()-this.arrowIconBottom.height())/2,left:(this.arrowBottom.width()-this.arrowIconBottom.width())/2}),this.arrowIconTop.css({top:(this.arrowTop.height()-this.arrowIconTop.height())/2,left:(this.arrowTop.width()-this.arrowIconTop.width())/2});var c=a,h=s-c-o-r-l;this.innerH=h,this._outerW(this.bgVer,n).css("top",c+l),this._outerH(this.bgVer,h);var d=Math.round(this._map(e.minimum,h)),u=Math.round(h-this._map(e.maximum,h));if(t.reversed){var p=d;d=u,u=p}c+=u,h-=d+u,this._outerW(this.handleTop,n).css("top",c),this._outerW(this.handleBottom,n).css("top",c+h+l),this.handleIconBottom.css({top:(this.handleBottom.height()-this.handleIconBottom.height())/2,left:(this.handleBottom.width()-this.handleIconBottom.width())/2}),this.handleIconTop.css({top:(this.handleTop.height()-this.handleIconTop.height())/2,left:(this.handleTop.width()-this.handleIconTop.width())/2}),this._outerW(this.sliderVer,n).css("top",c+l),this._outerH(this.sliderVer,h),this._outerW(this.bgVerTop,n).css("top",a),this._outerH(this.bgVerTop,c-a),c+=h+r+l,this._outerW(this.bgVerBottom,n).css("top",c),this._outerH(this.bgVerBottom,s-c-o)},_map:function(t,e){var i=this.options,n=i.maximum-i.minimum,s=t-i.minimum,o=e*s/n;return o=Math.min(o,e),o=Math.max(o,0)},_trigger:function(e,i){var n=this.options.range,s=this.lastChange;(this.startMin!==n.minimum||this.startMax!==n.maximum)&&(i||s.minimum!==n.minimum||s.maximum!==n.maximum)&&(this.startMin=null,this.startMax=null,this.elem.trigger(e,{minimum:n.minimum,maximum:n.maximum}),t.extend(s,n))},_startChange:function(){this.valueMin=this.startMin=this.options.range.minimum,this.valueMax=this.startMax=this.options.range.maximum},_largeScrollStart:function(t,e){e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]);var i,n=t.pageX,s=t.pageY,o=this.elem.offset(),a=n-o.left,r=s-o.top,l=this.options,c=l.maximum-l.minimum;"horizontal"==this.orientation?(a-=parseFloat(this.bgHor.css("left")),i=l.minimum+c*a/this.innerW):(r-=parseFloat(this.bgVer.css("top")),i=l.maximum-c*r/this.innerH),l.reversed&&(i=l.minimum+l.maximum-i),this.endScrollValue=i},_moveLeft:function(){var t=this.options,e=t.range.maximum-t.range.minimum,i=t.range.minimum-t.smallChange;i=Math.max(t.minimum,i);var n=i+e;return t.range.minimum=i,t.range.maximum=n,this._arrange(),this._trigger("rangeChanged"),this.endScrollValue&&(i+n)/2<this.endScrollValue?!0:!1},_moveRight:function(){var t=this.options,e=t.range.maximum-t.range.minimum,i=t.range.maximum+t.smallChange;i=Math.min(t.maximum,i);var n=i-e;return t.range.minimum=n,t.range.maximum=i,this._arrange(),this._trigger("rangeChanged"),this.endScrollValue&&(n+i)/2>this.endScrollValue?!0:!1},_scrollLeft:function(){if(this.scrolling){var e;if(e=this.options.reversed?this._moveRight():this._moveLeft())return this.endScrollValue=null,void 0;var i=this.scrollingCount?100:200;this.scrollingCount++,setTimeout(t.proxy(this._scrollLeft,this),i)}},_scrollRight:function(){if(this.scrolling){var e;if(e=this.options.reversed?this._moveLeft():this._moveRight())return this.endScrollValue=null,void 0;var i=this.scrollingCount?100:200;this.scrollingCount++,setTimeout(t.proxy(this._scrollRight,this),i)}},_stopScroll:function(){this.scrolling=!1},_startDragHor:function(t,e){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),this.dragging=!0,this.pos=t.pageX,this._startChange(),this.sliderHor.addClass("ui-jqrangeslider-slider-horizontal-dragging")},_draggingHor:function(t,e){if(this.dragging){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]);var i=t.pageX-this.pos,n=this.options,s=n.maximum-n.minimum,o=s*i/this.innerW;n.reversed&&(o=-o),o=Math.max(o,n.minimum-this.valueMin),o=Math.min(o,n.maximum-this.valueMax),n.range.minimum=this.valueMin+o,n.range.maximum=this.valueMax+o,this._arrange(),this._trigger("rangeChanging")}},_stopDragHor:function(t){t.preventDefault(),this.dragging=!1,this.sliderHor.removeClass("ui-jqrangeslider-slider-horizontal-dragging"),this._trigger("rangeChanged",!0),this.valueMin=null,this.valueMax=null},_startDragVer:function(t,e){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),this.dragging=!0,this.pos=t.pageY,this._startChange(),this.sliderVer.addClass("ui-jqrangeslider-slider-vertical-dragging")},_draggingVer:function(t,e){if(this.dragging){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]);var i=this.pos-t.pageY,n=this.options,s=n.maximum-n.minimum,o=s*i/this.innerH;n.reversed&&(o=-o),o=Math.max(o,n.minimum-this.valueMin),o=Math.min(o,n.maximum-this.valueMax),n.range.minimum=this.valueMin+o,n.range.maximum=this.valueMax+o,this._arrange(),this._trigger("rangeChanging")}},_stopDragVer:function(t){t.preventDefault(),this.dragging=!1,this.sliderVer.removeClass("ui-jqrangeslider-slider-vertical-dragging"),this._trigger("rangeChanged",!0),this.valueMin=null,this.valueMax=null},_startResizeLeft:function(t,e){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),this.resize=!0,this.pos=t.pageX,this._startChange()},_resizeLeft:function(t,e){if(this.resize){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]);var i=t.pageX-this.pos,n=this.options,s=n.maximum-n.minimum,o=s*i/this.innerW,a=this.options.minRange;n.reversed?(o=-o,o=Math.min(o,n.maximum-this.valueMax),o=Math.max(o,n.range.minimum-this.valueMax+a),n.range.maximum=this.valueMax+o):(o=Math.max(o,n.minimum-this.valueMin),o=Math.min(o,n.range.maximum-this.valueMin-a),n.range.minimum=this.valueMin+o),this._arrange(),this._trigger("rangeChanging")}},_stopResizeLeft:function(t){t.preventDefault(),this.resize=!1,this._trigger("rangeChanged",!0),this.valueMin=null,this.valueMax=null},_startResizeBottom:function(t,e){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),this.resize=!0,this.pos=t.pageY,this._startChange()},_resizeBottom:function(t,e){if(this.resize){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]);var i=this.pos-t.pageY,n=this.options,s=this.options.minRange,o=n.maximum-n.minimum,a=o*i/this.innerH;n.reversed?(a=-a,a=Math.min(a,n.maximum-this.valueMax),a=Math.max(a,n.range.minimum-this.valueMax+s),n.range.maximum=this.valueMax+a):(a=Math.max(a,n.minimum-this.valueMin),a=Math.min(a,n.range.maximum-this.valueMin-s),n.range.minimum=this.valueMin+a),this._arrange(),this._trigger("rangeChanging")}},_stopResizeBottom:function(t){t.preventDefault(),this.resize=!1,this._trigger("rangeChanged",!0),this.valueMin=null,this.valueMax=null},_startResizeRight:function(t,e){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),this.resize=!0,this.pos=t.pageX,this._startChange()},_resizeRight:function(t,e){if(this.resize){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]);var i=t.pageX-this.pos,n=this.options,s=this.options.minRange,o=n.maximum-n.minimum,a=o*i/this.innerW;n.reversed?(a=-a,a=Math.max(a,n.minimum-this.valueMin),a=Math.min(a,n.range.maximum-this.valueMin-s),n.range.minimum=this.valueMin+a):(a=Math.min(a,n.maximum-this.valueMax),a=Math.max(a,n.range.minimum-this.valueMax+s),n.range.maximum=this.valueMax+a),this._arrange(),this._trigger("rangeChanging")}},_stopResizeRight:function(t){t.preventDefault(),this.resize=!1,this._trigger("rangeChanged",!0),this.valueMin=null,this.valueMax=null},_startResizeTop:function(t,e){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),this.resize=!0,this.pos=t.pageY,this._startChange()},_resizeTop:function(t,e){if(this.resize){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]);var i=this.pos-t.pageY,n=this.options,s=this.options.minRange,o=n.maximum-n.minimum,a=o*i/this.innerH;n.reversed?(a=-a,a=Math.max(a,n.minimum-this.valueMin),a=Math.min(a,n.range.maximum-this.valueMin-s),n.range.minimum=this.valueMin+a):(a=Math.min(a,n.maximum-this.valueMax),a=Math.max(a,n.range.minimum-this.valueMax+s),n.range.maximum=this.valueMax+a),this._arrange(),this._trigger("rangeChanging")}},_stopResizeTop:function(t){t.preventDefault(),this.resize=!1,this._trigger("rangeChanged",!0),this.valueMin=null,this.valueMax=null},_outerH:function(e,i){var n=["Top","Bottom"];return t.each(n,function(){i-=parseFloat(e.css("border"+this+"Width"))||0}),i=Math.max(0,i),e.height(i),e},_outerW:function(e,i){var n=["Left","Right"];return t.each(n,function(){i-=parseFloat(e.css("border"+this+"Width"))||0}),i=Math.max(0,i),e.width(i),e},_addHover:function(e){e.hover(function(){t(this).addClass("ui-state-hover")},function(){t(this).removeClass("ui-state-hover")})},destroy:function(){var t=this.elem;t.children().remove(),t.removeClass("ui-jqrangeslider ui-widget")}}}(t)}),define("_libs/charts/Chart",["jquery","./jqChart/src/js/jquery.jqChart.dev","./jqChart/src/js/jquery.jqRangeSlider.js","css!./jqChart/css/jquery.jqChart.css","css!./jqChart/css/jquery.jqRangeSlider.css"],function(t){function e(n,s){this.el=t(n),this.options=t.extend(!0,{},e.getDefaults(),s||{}),this._chart=null,i.build.call(this)}e.DEFAULT_LINE_WIDTH=2,e.getDefaults=function(){return{title:!1,height:350,border:{lineWidth:0},legend:{visible:!1},crosshairs:{enabled:!1,hLine:!1,vLine:{strokeStyle:"#cc0a0c"}},axes:[{type:"dateTime",location:"bottom",strokeStyle:"black",lineWidth:1,margin:0,zoomEnabled:!0,labels:{stringFormat:"HH:MM dd.mm",fillStyle:"black",font:"10px sans-serif",angle:0},bands:null},{type:"linear",location:"left",margin:0,minimum:0,majorGridLines:{lineWidth:1,strokeStyle:"#dadada",interval:1}}],series:[],toolbar:{visibility:"auto",resetZoomTooltipText:"1:1",zoomingTooltipText:"Zoom in to selection area",panningTooltipText:"Pan the chart"}}},e.setWidth=function(e,i){t(e).jqChart("option","width",i)},e.destroy=function(e){t(e).jqChart("destroy")},t.extend(e.prototype,{getChart:function(){return this._chart}});var i={build:function(){this.el&&this.el.length&&(this.el.jqChart(this.options),this._chart=this.el.jqChart("chart"))}};return e}),function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("EasyPieChart",[],e):t.EasyPieChart=e()}(this,function(){var t=function(t,e){var i,n=document.createElement("canvas");"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(n);var s=n.getContext("2d");n.width=n.height=e.size,t.appendChild(n);var o=1;window.devicePixelRatio>1&&(o=window.devicePixelRatio,n.style.width=n.style.height=[e.size,"px"].join(""),n.width=n.height=e.size*o,s.scale(o,o)),s.translate(e.size/2,e.size/2),s.rotate((-0.5+e.rotate/180)*Math.PI);var a=(e.size-e.lineWidth)/2;e.scaleColor&&e.scaleLength&&(a-=e.scaleLength+2),Date.now=Date.now||function(){return+new Date};var r=function(t,e,i){i=Math.min(Math.max(0,i||1),1),s.beginPath(),s.arc(0,0,a,0,2*Math.PI*i,!1),s.strokeStyle=t,s.lineWidth=e,s.stroke()},l=function(){var t,i,n=24;s.lineWidth=1,s.fillStyle=e.scaleColor,s.save();for(var n=24;n>0;--n)0===n%6?(i=e.scaleLength,t=0):(i=.6*e.scaleLength,t=e.scaleLength-i),s.fillRect(-e.size/2+t,0,i,1),s.rotate(Math.PI/12);s.restore()},c=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),h=function(){e.scaleColor&&l(),e.trackColor&&r(e.trackColor,e.lineWidth)};this.clear=function(){s.clearRect(e.size/-2,e.size/-2,e.size,e.size)},this.draw=function(t){e.scaleColor||e.trackColor?s.getImageData&&s.putImageData?i?s.putImageData(i,0,0):(h(),i=s.getImageData(0,0,e.size*o,e.size*o)):(this.clear(),h()):this.clear(),s.lineCap=e.lineCap;var n;n="function"==typeof e.barColor?e.barColor(t):e.barColor,t>0&&r(n,e.lineWidth,t/100)}.bind(this),this.animate=function(t,i){var n=Date.now();e.onStart(t,i);var s=function(){var o=Math.min(Date.now()-n,e.animate),a=e.easing(this,o,t,i-t,e.animate);this.draw(a),e.onStep(t,i,a),o>=e.animate?e.onStop(t,i):c(s)}.bind(this);c(s)}.bind(this)},e=function(e,i){var n={barColor:"#ef1e25",trackColor:"#f9f9f9",scaleColor:"#dfe0e0",scaleLength:5,lineCap:"round",lineWidth:3,size:110,rotate:0,animate:1e3,easing:function(t,e,i,n,s){return e/=s/2,1>e?n/2*e*e+i:-n/2*(--e*(e-2)-1)+i},onStart:function(){},onStep:function(){},onStop:function(){}};if("undefined"!=typeof t)n.renderer=t;else{if("undefined"==typeof SVGRenderer)throw new Error("Please load either the SVG- or the CanvasRenderer");n.renderer=SVGRenderer}var s={},o=0,a=function(){this.el=e,this.options=s;for(var t in n)n.hasOwnProperty(t)&&(s[t]=i&&"undefined"!=typeof i[t]?i[t]:n[t],"function"==typeof s[t]&&(s[t]=s[t].bind(this)));s.easing="string"==typeof s.easing&&"undefined"!=typeof jQuery&&jQuery.isFunction(jQuery.easing[s.easing])?jQuery.easing[s.easing]:n.easing,this.renderer=new s.renderer(e,s),this.renderer.draw(o),e.dataset&&e.dataset.percent?this.update(parseFloat(e.dataset.percent)):e.getAttribute&&e.getAttribute("data-percent")&&this.update(parseFloat(e.getAttribute("data-percent")))}.bind(this);this.update=function(t){return t=parseFloat(t),s.animate?this.renderer.animate(o,t):this.renderer.draw(t),o=t,e.dataset&&e.dataset.percent?e.dataset.percent=t:e.getAttribute&&e.getAttribute("data-percent")&&e.setAttribute("data-percent",t),this}.bind(this),a()};return e}),define("_libs/charts/ragAndFunnel/ragAndFunnel",function(){}),define("fileDownload",["jquery"],function(t){var e=/[<>&\r\n"']/gm,i={"<":"lt;",">":"gt;","&":"amp;","\r":"#13;","\n":"#10;",'"':"quot;","'":"apos;"};t.extend({fileDownload:function(n,s){function o(){if(-1!=document.cookie.indexOf(u.cookieName+"="+u.cookieValue))return v.onSuccess(n),document.cookie=u.cookieName+"=; expires="+new Date(1e3).toUTCString()+"; path="+u.cookiePath,r(!1),void 0;if(b||_)try{var e=b?b.document:a(_);if(e&&null!=e.body&&e.body.innerHTML.length){var i=!0;if(w&&w.length){var s=t(e.body).contents().first();s.length&&s[0]===w[0]&&(i=!1)}if(i)return v.onFail(e.body.innerHTML,n),r(!0),void 0}}catch(l){return v.onFail("",n),r(!0),void 0}setTimeout(o,u.checkInterval)}function a(t){var e=t[0].contentWindow||t[0].contentDocument;return e.document&&(e=e.document),e}function r(t){setTimeout(function(){b&&(h&&b.close(),c&&(b.focus(),t&&b.close()))},0)}function l(t){return t.replace(e,function(t){return"&"+i[t]})}var c,h,d,u=t.extend({preparingMessageHtml:null,failMessageHtml:null,androidPostUnsupportedMessageHtml:"Unfortunately your Android browser doesn't support this type of file download. Please try again with a different browser.",dialogOptions:{modal:!0},prepareCallback:function(){},successCallback:function(){},failCallback:function(){},httpMethod:"GET",data:null,checkInterval:100,cookieName:"fileDownload",cookieValue:"true",cookiePath:"/",popupWindowTitle:"Initiating file download...",encodeHTMLEntities:!0},s),p=new t.Deferred,m=(navigator.userAgent||navigator.vendor||window.opera).toLowerCase();/ip(ad|hone|od)/.test(m)?c=!0:-1!==m.indexOf("android")?h=!0:d=/avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|playbook|silk|iemobile|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(m)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(m.substr(0,4));var f=u.httpMethod.toUpperCase();if(h&&"GET"!==f)return t().dialog?t("<div>").html(u.androidPostUnsupportedMessageHtml).dialog(u.dialogOptions):alert(u.androidPostUnsupportedMessageHtml),p.reject();var g=null,v={onPrepare:function(e){u.preparingMessageHtml?g=t("<div>").html(u.preparingMessageHtml).dialog(u.dialogOptions):u.prepareCallback&&u.prepareCallback(e)},onSuccess:function(t){g&&g.dialog("close"),u.successCallback(t),p.resolve(t)},onFail:function(e,i){g&&g.dialog("close"),u.failMessageHtml&&t("<div>").html(u.failMessageHtml).dialog(u.dialogOptions),u.failCallback(e,i),p.reject(e,i)}};v.onPrepare(n),null!==u.data&&"string"!=typeof u.data&&(u.data=t.param(u.data));var _,b,y,w;if("GET"===f){if(null!==u.data){var x=n.indexOf("?");-1!==x?"&"!==n.substring(n.length-1)&&(n+="&"):n+="?",n+=u.data}c||h?(b=window.open(n),b.document.title=u.popupWindowTitle,window.focus()):d?window.location(n):_=t("<iframe>").hide().prop("src",n).appendTo("body")}else{var C="";null!==u.data&&t.each(u.data.replace(/\+/g," ").split("&"),function(){var t=this.split("="),e=u.encodeHTMLEntities?l(decodeURIComponent(t[0])):decodeURIComponent(t[0]);if(e){var i=u.encodeHTMLEntities?l(decodeURIComponent(t[1])):decodeURIComponent(t[1]);C+='<input type="hidden" name="'+e+'" value="'+i+'" />'}}),d?(w=t("<form>").appendTo("body"),w.hide().prop("method",u.httpMethod).prop("action",n).html(C)):(c?(b=window.open("about:blank"),b.document.title=u.popupWindowTitle,y=b.document,window.focus()):(_=t("<iframe style='display: none' src='about:blank'></iframe>").appendTo("body"),y=a(_)),y.write("<html><head></head><body><form method='"+u.httpMethod+"' action='"+n+"'>"+C+"</form>"+u.popupWindowTitle+"</body></html>"),w=t(y).find("form")),w.submit()}return setTimeout(o,u.checkInterval),p.promise()}})}),function(t,e,i){var n=function(n){function s(t){var e,i,o={};n.each(t,function(n){(e=n.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(e[1]+" ")&&(i=n.replace(e[0],e[2].toLowerCase()),o[i]=n,"o"===e[1]&&s(t[n]))}),t._hungarianMap=o}function o(t,e,a){t._hungarianMap||s(t);var r;
n.each(e,function(s){r=t._hungarianMap[s],r===i||!a&&e[r]!==i||("o"===r.charAt(0)?(e[r]||(e[r]={}),n.extend(!0,e[r],e[s]),o(t[r],e[r],a)):e[r]=e[s])})}function a(t){var e=$e.defaults.oLanguage,i=t.sZeroRecords;!t.sEmptyTable&&i&&"No data available in table"===e.sEmptyTable&&Re(t,t,"sZeroRecords","sEmptyTable"),!t.sLoadingRecords&&i&&"Loading..."===e.sLoadingRecords&&Re(t,t,"sZeroRecords","sLoadingRecords"),t.sInfoThousands&&(t.sThousands=t.sInfoThousands),(t=t.sDecimal)&&Ve(t)}function r(t){hi(t,"ordering","bSort"),hi(t,"orderMulti","bSortMulti"),hi(t,"orderClasses","bSortClasses"),hi(t,"orderCellsTop","bSortCellsTop"),hi(t,"order","aaSorting"),hi(t,"orderFixed","aaSortingFixed"),hi(t,"paging","bPaginate"),hi(t,"pagingType","sPaginationType"),hi(t,"pageLength","iDisplayLength"),hi(t,"searching","bFilter")}function l(t){hi(t,"orderable","bSortable"),hi(t,"orderData","aDataSort"),hi(t,"orderSequence","asSorting"),hi(t,"orderDataType","sortDataType")}function c(t){var t=t.oBrowser,e=n("<div/>").css({position:"absolute",top:0,left:0,height:1,width:1,overflow:"hidden"}).append(n("<div/>").css({position:"absolute",top:1,left:1,width:100,overflow:"scroll"}).append(n('<div class="test"/>').css({width:"100%",height:10}))).appendTo("body"),i=e.find(".test");t.bScrollOversize=100===i[0].offsetWidth,t.bScrollbarLeft=1!==i.offset().left,e.remove()}function h(t,e,n,s,o,a){var r,l=!1;for(n!==i&&(r=n,l=!0);s!==o;)t.hasOwnProperty(s)&&(r=l?e(r,t[s],s,t):t[s],l=!0,s+=a);return r}function d(t,i){var s=$e.defaults.column,o=t.aoColumns.length,s=n.extend({},$e.models.oColumn,s,{nTh:i?i:e.createElement("th"),sTitle:s.sTitle?s.sTitle:i?i.innerHTML:"",aDataSort:s.aDataSort?s.aDataSort:[o],mData:s.mData?s.mData:o,idx:o});t.aoColumns.push(s),s=t.aoPreSearchCols,s[o]=n.extend({},$e.models.oSearch,s[o]),u(t,o,null)}function u(t,e,s){var a=t.aoColumns[e],e=t.oClasses,r=n(a.nTh);if(!a.sWidthOrig){a.sWidthOrig=r.attr("width")||null;var c=(r.attr("style")||"").match(/width:\s*(\d+[pxem%])/);c&&(a.sWidthOrig=c[1])}s!==i&&null!==s&&(l(s),o($e.defaults.column,s),s.mDataProp!==i&&!s.mData&&(s.mData=s.mDataProp),s.sType&&(a._sManualType=s.sType),s.className&&!s.sClass&&(s.sClass=s.className),n.extend(a,s),Re(a,s,"sWidth","sWidthOrig"),"number"==typeof s.iDataSort&&(a.aDataSort=[s.iDataSort]),Re(a,s,"aDataSort"));var s=a.mData,h=T(s),d=a.mRender?T(a.mRender):null,c=function(t){return"string"==typeof t&&-1!==t.indexOf("@")};a._bAttrSrc=n.isPlainObject(s)&&(c(s.sort)||c(s.type)||c(s.filter)),a.fnGetData=function(t,e){var i=h(t,e);return a.mRender&&e&&""!==e?d(i,e,t):i},a.fnSetData=A(s),t.oFeatures.bSort||(a.bSortable=!1,r.addClass(e.sSortableNone)),t=-1!==n.inArray("asc",a.asSorting),r=-1!==n.inArray("desc",a.asSorting),a.bSortable&&(t||r)?t&&!r?(a.sSortingClass=e.sSortableAsc,a.sSortingClassJUI=e.sSortJUIAscAllowed):!t&&r?(a.sSortingClass=e.sSortableDesc,a.sSortingClassJUI=e.sSortJUIDescAllowed):(a.sSortingClass=e.sSortable,a.sSortingClassJUI=e.sSortJUI):(a.sSortingClass=e.sSortableNone,a.sSortingClassJUI="")}function p(t){if(!1!==t.oFeatures.bAutoWidth){var e=t.aoColumns;me(t);for(var i=0,n=e.length;n>i;i++)e[i].nTh.style.width=e[i].sWidth}e=t.oScroll,(""!==e.sY||""!==e.sX)&&ue(t),Ne(t,null,"column-sizing",[t])}function m(t,e){var i=v(t,"bVisible");return"number"==typeof i[e]?i[e]:null}function f(t,e){var i=v(t,"bVisible"),i=n.inArray(e,i);return-1!==i?i:null}function g(t){return v(t,"bVisible").length}function v(t,e){var i=[];return n.map(t.aoColumns,function(t,n){t[e]&&i.push(n)}),i}function _(t){var e,n,s,o,a,r,l,c,h,d=t.aoColumns,u=t.aoData,p=$e.ext.type.detect;for(e=0,n=d.length;n>e;e++)if(l=d[e],h=[],!l.sType&&l._sManualType)l.sType=l._sManualType;else if(!l.sType){for(s=0,o=p.length;o>s;s++){for(a=0,r=u.length;r>a&&(h[a]===i&&(h[a]=x(t,a,e,"type")),c=p[s](h[a],t),!(!c||"html"===c));a++);if(c){l.sType=c;break}}l.sType||(l.sType="string")}}function b(t,e,s,o){var a,r,l,c,h,u,p=t.aoColumns;if(e)for(a=e.length-1;a>=0;a--){u=e[a];var m=u.targets!==i?u.targets:u.aTargets;for(n.isArray(m)||(m=[m]),r=0,l=m.length;l>r;r++)if("number"==typeof m[r]&&0<=m[r]){for(;p.length<=m[r];)d(t);o(m[r],u)}else if("number"==typeof m[r]&&0>m[r])o(p.length+m[r],u);else if("string"==typeof m[r])for(c=0,h=p.length;h>c;c++)("_all"==m[r]||n(p[c].nTh).hasClass(m[r]))&&o(c,u)}if(s)for(a=0,t=s.length;t>a;a++)o(a,s[a])}function y(t,e,i,s){var o=t.aoData.length,a=n.extend(!0,{},$e.models.oRow,{src:i?"dom":"data"});a._aData=e,t.aoData.push(a);for(var e=t.aoColumns,a=0,r=e.length;r>a;a++)i&&C(t,o,a,x(t,o,a)),e[a].sType=null;return t.aiDisplayMaster.push(o),t.oFeatures.bDeferRender||P(t,o,i,s),o}function w(t,e){var i;return e instanceof n||(e=n(e)),e.map(function(e,n){return i=I(t,n),y(t,i.data,n,i.cells)})}function x(t,e,n,s){var n=t.aoColumns[n],o=t.aoData[e]._aData,a=n.fnGetData(o,s);if(a===i)return t.iDrawError!=t.iDraw&&null===n.sDefaultContent&&(Pe(t,0,"Requested unknown parameter "+("function"==typeof n.mData?"{function}":"'"+n.mData+"'")+" for row "+e,4),t.iDrawError=t.iDraw),n.sDefaultContent;if(a!==o&&null!==a||null===n.sDefaultContent){if("function"==typeof a)return a()}else a=n.sDefaultContent;return null===a&&"display"==s?"":a}function C(t,e,i,n){t.aoColumns[i].fnSetData(t.aoData[e]._aData,n)}function S(t){return n.map(t.match(/(\\.|[^\.])+/g),function(t){return t.replace("\\.",".")})}function T(t){if(n.isPlainObject(t)){var e={};return n.each(t,function(t,i){i&&(e[t]=T(i))}),function(t,n,s){var o=e[n]||e._;return o!==i?o(t,n,s):t}}if(null===t)return function(t){return t};if("function"==typeof t)return function(e,i,n){return t(e,i,n)};if("string"==typeof t&&(-1!==t.indexOf(".")||-1!==t.indexOf("[")||-1!==t.indexOf("("))){var s=function(t,e,n){var o,a;if(""!==n){a=S(n);for(var r=0,l=a.length;l>r;r++){if(n=a[r].match(di),o=a[r].match(ui),n){for(a[r]=a[r].replace(di,""),""!==a[r]&&(t=t[a[r]]),o=[],a.splice(0,r+1),a=a.join("."),r=0,l=t.length;l>r;r++)o.push(s(t[r],e,a));t=n[0].substring(1,n[0].length-1),t=""===t?o:o.join(t);break}if(o)a[r]=a[r].replace(ui,""),t=t[a[r]]();else{if(null===t||t[a[r]]===i)return i;t=t[a[r]]}}}return t};return function(e,i){return s(e,i,t)}}return function(e){return e[t]}}function A(t){if(n.isPlainObject(t))return A(t._);if(null===t)return function(){};if("function"==typeof t)return function(e,i){t(e,"set",i)};if("string"==typeof t&&(-1!==t.indexOf(".")||-1!==t.indexOf("[")||-1!==t.indexOf("("))){var e=function(t,n,s){var o,s=S(s);o=s[s.length-1];for(var a,r,l=0,c=s.length-1;c>l;l++){if(a=s[l].match(di),r=s[l].match(ui),a){for(s[l]=s[l].replace(di,""),t[s[l]]=[],o=s.slice(),o.splice(0,l+1),a=o.join("."),r=0,c=n.length;c>r;r++)o={},e(o,n[r],a),t[s[l]].push(o);return}r&&(s[l]=s[l].replace(ui,""),t=t[s[l]](n)),(null===t[s[l]]||t[s[l]]===i)&&(t[s[l]]={}),t=t[s[l]]}o.match(ui)?t[o.replace(ui,"")](n):t[o.replace(di,"")]=n};return function(i,n){return e(i,n,t)}}return function(e,i){e[t]=i}}function L(t){return ai(t.aoData,"_aData")}function M(t){t.aoData.length=0,t.aiDisplayMaster.length=0,t.aiDisplay.length=0}function k(t,e,n){for(var s=-1,o=0,a=t.length;a>o;o++)t[o]==e?s=o:t[o]>e&&t[o]--;-1!=s&&n===i&&t.splice(s,1)}function D(t,e,n,s){var o,a=t.aoData[e];if("dom"!==n&&(n&&"auto"!==n||"dom"!==a.src)){var r=a.anCells;if(r)for(n=0,o=r.length;o>n;n++)r[n].innerHTML=x(t,e,n,"display")}else a._aData=I(t,a).data;if(a._aSortData=null,a._aFilterData=null,t=t.aoColumns,s!==i)t[s].sType=null;else for(n=0,o=t.length;o>n;n++)t[n].sType=null;R(a)}function I(t,e){var i,s,o,a,r=[],l=[],c=e.firstChild,h=0,d=t.aoColumns,u=function(t,e,i){"string"==typeof t&&(e=t.indexOf("@"),-1!==e&&(t=t.substring(e+1),o["@"+t]=i.getAttribute(t)))},p=function(t){s=d[h],a=n.trim(t.innerHTML),s&&s._bAttrSrc?(o={display:a},u(s.mData.sort,o,t),u(s.mData.type,o,t),u(s.mData.filter,o,t),r.push(o)):r.push(a),l.push(t),h++};if(c)for(;c;)i=c.nodeName.toUpperCase(),("TD"==i||"TH"==i)&&p(c),c=c.nextSibling;else for(l=e.anCells,c=0,i=l.length;i>c;c++)p(l[c]);return{data:r,cells:l}}function P(t,i,n,s){var o,a,r,l,c,h=t.aoData[i],d=h._aData,u=[];if(null===h.nTr){for(o=n||e.createElement("tr"),h.nTr=o,h.anCells=u,o._DT_RowIndex=i,R(h),l=0,c=t.aoColumns.length;c>l;l++)r=t.aoColumns[l],a=n?s[l]:e.createElement(r.sCellType),u.push(a),(!n||r.mRender||r.mData!==l)&&(a.innerHTML=x(t,i,l,"display")),r.sClass&&(a.className+=" "+r.sClass),r.bVisible&&!n?o.appendChild(a):!r.bVisible&&n&&a.parentNode.removeChild(a),r.fnCreatedCell&&r.fnCreatedCell.call(t.oInstance,a,x(t,i,l,"display"),d,i,l);Ne(t,"aoRowCreatedCallback",null,[o,d,i])}h.nTr.setAttribute("role","row")}function R(t){var e=t.nTr,i=t._aData;if(e){if(i.DT_RowId&&(e.id=i.DT_RowId),i.DT_RowClass){var s=i.DT_RowClass.split(" ");t.__rowc=t.__rowc?ci(t.__rowc.concat(s)):s,n(e).removeClass(t.__rowc.join(" ")).addClass(i.DT_RowClass)}i.DT_RowData&&n(e).data(i.DT_RowData)}}function E(t){var e,i,s,o,a,r=t.nTHead,l=t.nTFoot,c=0===n("th, td",r).length,h=t.oClasses,d=t.aoColumns;for(c&&(o=n("<tr/>").appendTo(r)),e=0,i=d.length;i>e;e++)a=d[e],s=n(a.nTh).addClass(a.sClass),c&&s.appendTo(o),t.oFeatures.bSort&&(s.addClass(a.sSortingClass),!1!==a.bSortable&&(s.attr("tabindex",t.iTabIndex).attr("aria-controls",t.sTableId),Ae(t,a.nTh,e))),a.sTitle!=s.html()&&s.html(a.sTitle),Be(t,"header")(t,s,a,h);if(c&&B(t.aoHeader,r),n(r).find(">tr").attr("role","row"),n(r).find(">tr>th, >tr>td").addClass(h.sHeaderTH),n(l).find(">tr>th, >tr>td").addClass(h.sFooterTH),null!==l)for(t=t.aoFooter[0],e=0,i=t.length;i>e;e++)a=d[e],a.nTf=t[e].cell,a.sClass&&n(a.nTf).addClass(a.sClass)}function O(t,e,s){var o,a,r,l,c=[],h=[],d=t.aoColumns.length;if(e){for(s===i&&(s=!1),o=0,a=e.length;a>o;o++){for(c[o]=e[o].slice(),c[o].nTr=e[o].nTr,r=d-1;r>=0;r--)!t.aoColumns[r].bVisible&&!s&&c[o].splice(r,1);h.push([])}for(o=0,a=c.length;a>o;o++){if(t=c[o].nTr)for(;r=t.firstChild;)t.removeChild(r);for(r=0,e=c[o].length;e>r;r++)if(l=d=1,h[o][r]===i){for(t.appendChild(c[o][r].cell),h[o][r]=1;c[o+d]!==i&&c[o][r].cell==c[o+d][r].cell;)h[o+d][r]=1,d++;for(;c[o][r+l]!==i&&c[o][r].cell==c[o][r+l].cell;){for(s=0;d>s;s++)h[o+s][r+l]=1;l++}n(c[o][r].cell).attr("rowspan",d).attr("colspan",l)}}}}function j(t){var e=Ne(t,"aoPreDrawCallback","preDraw",[t]);if(-1!==n.inArray(!1,e))he(t,!1);else{var e=[],s=0,o=t.asStripeClasses,a=o.length,r=t.oLanguage,l=t.iInitDisplayStart,c="ssp"==Ue(t),h=t.aiDisplay;t.bDrawing=!0,l!==i&&-1!==l&&(t._iDisplayStart=c?l:l>=t.fnRecordsDisplay()?0:l,t.iInitDisplayStart=-1);var l=t._iDisplayStart,d=t.fnDisplayEnd();if(t.bDeferLoading)t.bDeferLoading=!1,t.iDraw++,he(t,!1);else if(c){if(!t.bDestroying&&!V(t))return}else t.iDraw++;if(0!==h.length)for(r=c?t.aoData.length:d,c=c?0:l;r>c;c++){var u=h[c],p=t.aoData[u];if(null===p.nTr&&P(t,u),u=p.nTr,0!==a){var m=o[s%a];p._sRowStripe!=m&&(n(u).removeClass(p._sRowStripe).addClass(m),p._sRowStripe=m)}Ne(t,"aoRowCallback",null,[u,p._aData,s,c]),e.push(u),s++}else s=r.sZeroRecords,1==t.iDraw&&"ajax"==Ue(t)?s=r.sLoadingRecords:r.sEmptyTable&&0===t.fnRecordsTotal()&&(s=r.sEmptyTable),e[0]=n("<tr/>",{"class":a?o[0]:""}).append(n("<td />",{valign:"top",colSpan:g(t),"class":t.oClasses.sRowEmpty}).html(s))[0];Ne(t,"aoHeaderCallback","header",[n(t.nTHead).children("tr")[0],L(t),l,d,h]),Ne(t,"aoFooterCallback","footer",[n(t.nTFoot).children("tr")[0],L(t),l,d,h]),o=n(t.nTBody),o.children().detach(),o.append(n(e)),Ne(t,"aoDrawCallback","draw",[t]),t.bSorted=!1,t.bFiltered=!1,t.bDrawing=!1}}function N(t,e){var i=t.oFeatures,n=i.bFilter;i.bSort&&Ce(t),n?q(t,t.oPreviousSearch):t.aiDisplay=t.aiDisplayMaster.slice(),!0!==e&&(t._iDisplayStart=0),j(t)}function F(t){var e=t.oClasses,i=n(t.nTable),i=n("<div/>").insertBefore(i),s=t.oFeatures,o=n("<div/>",{id:t.sTableId+"_wrapper","class":e.sWrapper+(t.nTFoot?"":" "+e.sNoFooter)});t.nHolding=i[0],t.nTableWrapper=o[0],t.nTableReinsertBefore=t.nTable.nextSibling;for(var a,r,l,c,h,d,u=t.sDom.split(""),p=0;p<u.length;p++){if(a=null,r=u[p],"<"==r){if(l=n("<div/>")[0],c=u[p+1],"'"==c||'"'==c){for(h="",d=2;u[p+d]!=c;)h+=u[p+d],d++;"H"==h?h=e.sJUIHeader:"F"==h&&(h=e.sJUIFooter),-1!=h.indexOf(".")?(c=h.split("."),l.id=c[0].substr(1,c[0].length-1),l.className=c[1]):"#"==h.charAt(0)?l.id=h.substr(1,h.length-1):l.className=h,p+=d}o.append(l),o=n(l)}else if(">"==r)o=o.parent();else if("l"==r&&s.bPaginate&&s.bLengthChange)a=ae(t);else if("f"==r&&s.bFilter)a=G(t);else if("r"==r&&s.bProcessing)a=ce(t);else if("t"==r)a=de(t);else if("i"==r&&s.bInfo)a=te(t);else if("p"==r&&s.bPaginate)a=re(t);else if(0!==$e.ext.feature.length)for(l=$e.ext.feature,d=0,c=l.length;c>d;d++)if(r==l[d].cFeature){a=l[d].fnInit(t);break}a&&(l=t.aanFeatures,l[r]||(l[r]=[]),l[r].push(a),o.append(a))}i.replaceWith(o)}function B(t,e){var i,s,o,a,r,l,c,h,d,u,p=n(e).children("tr");for(t.splice(0,t.length),o=0,l=p.length;l>o;o++)t.push([]);for(o=0,l=p.length;l>o;o++)for(i=p[o],s=i.firstChild;s;){if("TD"==s.nodeName.toUpperCase()||"TH"==s.nodeName.toUpperCase()){for(h=1*s.getAttribute("colspan"),d=1*s.getAttribute("rowspan"),h=h&&0!==h&&1!==h?h:1,d=d&&0!==d&&1!==d?d:1,a=0,r=t[o];r[a];)a++;for(c=a,u=1===h?!0:!1,r=0;h>r;r++)for(a=0;d>a;a++)t[o+a][c+r]={cell:s,unique:u},t[o+a].nTr=i}s=s.nextSibling}}function U(t,e,i){var n=[];i||(i=t.aoHeader,e&&(i=[],B(i,e)));for(var e=0,s=i.length;s>e;e++)for(var o=0,a=i[e].length;a>o;o++)!i[e][o].unique||n[o]&&t.bSortCellsTop||(n[o]=i[e][o].cell);return n}function z(t,e,i){if(Ne(t,"aoServerParams","serverParams",[e]),e&&n.isArray(e)){var s={},o=/(.*?)\[\]$/;n.each(e,function(t,e){var i=e.name.match(o);i?(i=i[0],s[i]||(s[i]=[]),s[i].push(e.value)):s[e.name]=e.value}),e=s}var a,r=t.ajax,l=t.oInstance;if(n.isPlainObject(r)&&r.data){a=r.data;var c=n.isFunction(a)?a(e):a,e=n.isFunction(a)&&c?c:n.extend(!0,e,c);delete r.data}c={data:e,success:function(e){var n=e.error||e.sError;n&&t.oApi._fnLog(t,0,n),t.json=e,Ne(t,null,"xhr",[t,e]),i(e)},dataType:"json",cache:!1,type:t.sServerMethod,error:function(e,i){var n=t.oApi._fnLog;"parsererror"==i?n(t,0,"Invalid JSON response",1):4===e.readyState&&n(t,0,"Ajax error",7),he(t,!1)}},t.oAjaxData=e,Ne(t,null,"preXhr",[t,e]),t.fnServerData?t.fnServerData.call(l,t.sAjaxSource,n.map(e,function(t,e){return{name:e,value:t}}),i,t):t.sAjaxSource||"string"==typeof r?t.jqXHR=n.ajax(n.extend(c,{url:r||t.sAjaxSource})):n.isFunction(r)?t.jqXHR=r.call(l,e,i,t):(t.jqXHR=n.ajax(n.extend(c,r)),r.data=a)}function V(t){if(t.bAjaxDataGet){t.iDraw++,he(t,!0);var e=H(t);return z(t,e,function(e){$(t,e)},t),!1}return!0}function H(t){var e,i,s,o,a=t.aoColumns,r=a.length,l=t.oFeatures,c=t.oPreviousSearch,h=t.aoPreSearchCols,d=[],u=xe(t);e=t._iDisplayStart,i=!1!==l.bPaginate?t._iDisplayLength:-1;var p=function(t,e){d.push({name:t,value:e})};p("sEcho",t.iDraw),p("iColumns",r),p("sColumns",ai(a,"sName").join(",")),p("iDisplayStart",e),p("iDisplayLength",i);var m={draw:t.iDraw,columns:[],order:[],start:e,length:i,search:{value:c.sSearch,regex:c.bRegex}};for(e=0;r>e;e++)s=a[e],o=h[e],i="function"==typeof s.mData?"function":s.mData,m.columns.push({data:i,name:s.sName,searchable:s.bSearchable,orderable:s.bSortable,search:{value:o.sSearch,regex:o.bRegex}}),p("mDataProp_"+e,i),l.bFilter&&(p("sSearch_"+e,o.sSearch),p("bRegex_"+e,o.bRegex),p("bSearchable_"+e,s.bSearchable)),l.bSort&&p("bSortable_"+e,s.bSortable);return l.bFilter&&(p("sSearch",c.sSearch),p("bRegex",c.bRegex)),l.bSort&&(n.each(u,function(t,e){m.order.push({column:e.col,dir:e.dir}),p("iSortCol_"+t,e.col),p("sSortDir_"+t,e.dir)}),p("iSortingCols",u.length)),a=$e.ext.legacy.ajax,null===a?t.sAjaxSource?d:m:a?d:m}function $(t,e){var n=e.sEcho!==i?e.sEcho:e.draw,s=e.iTotalRecords!==i?e.iTotalRecords:e.recordsTotal,o=e.iTotalDisplayRecords!==i?e.iTotalDisplayRecords:e.recordsFiltered;if(n){if(1*n<t.iDraw)return;t.iDraw=1*n}for(M(t),t._iRecordsTotal=parseInt(s,10),t._iRecordsDisplay=parseInt(o,10),n=W(t,e),s=0,o=n.length;o>s;s++)y(t,n[s]);t.aiDisplay=t.aiDisplayMaster.slice(),t.bAjaxDataGet=!1,j(t),t._bInitComplete||se(t,e),t.bAjaxDataGet=!0,he(t,!1)}function W(t,e){var s=n.isPlainObject(t.ajax)&&t.ajax.dataSrc!==i?t.ajax.dataSrc:t.sAjaxDataProp;return"data"===s?e.aaData||e[s]:""!==s?T(s)(e):e}function G(t){var i=t.oClasses,s=t.sTableId,o=t.oPreviousSearch,a=t.aanFeatures,r='<input type="search" class="'+i.sFilterInput+'"/>',l=t.oLanguage.sSearch,l=l.match(/_INPUT_/)?l.replace("_INPUT_",r):l+r,i=n("<div/>",{id:a.f?null:s+"_filter","class":i.sFilter}).append(n("<label/>").append(l)),a=function(){var e=this.value?this.value:"";e!=o.sSearch&&(q(t,{sSearch:e,bRegex:o.bRegex,bSmart:o.bSmart,bCaseInsensitive:o.bCaseInsensitive}),t._iDisplayStart=0,j(t))},c=n("input",i).val(o.sSearch.replace('"',"&quot;")).bind("keyup.DT search.DT input.DT paste.DT cut.DT","ssp"===Ue(t)?fe(a,400):a).bind("keypress.DT",function(t){return 13==t.keyCode?!1:void 0}).attr("aria-controls",s);return n(t.nTable).on("filter.DT",function(){try{c[0]!==e.activeElement&&c.val(o.sSearch)}catch(t){}}),i[0]}function q(t,e,n){var s=t.oPreviousSearch,o=t.aoPreSearchCols,a=function(t){s.sSearch=t.sSearch,s.bRegex=t.bRegex,s.bSmart=t.bSmart,s.bCaseInsensitive=t.bCaseInsensitive};if(_(t),"ssp"!=Ue(t)){for(X(t,e.sSearch,n,e.bEscapeRegex!==i?!e.bEscapeRegex:e.bRegex,e.bSmart,e.bCaseInsensitive),a(e),e=0;e<o.length;e++)Z(t,o[e].sSearch,e,o[e].bEscapeRegex!==i?!o[e].bEscapeRegex:o[e].bRegex,o[e].bSmart,o[e].bCaseInsensitive);Y(t)}else a(e);t.bFiltered=!0,Ne(t,null,"search",[t])}function Y(t){for(var e,i,n=$e.ext.search,s=t.aiDisplay,o=0,a=n.length;a>o;o++)for(var r=s.length-1;r>=0;r--)i=s[r],e=t.aoData[i],n[o](t,e._aFilterData,i,e._aData)||s.splice(r,1)}function Z(t,e,i,n,s,o){if(""!==e)for(var a=t.aiDisplay,n=K(e,n,s,o),s=a.length-1;s>=0;s--)e=t.aoData[a[s]]._aFilterData[i],n.test(e)||a.splice(s,1)}function X(t,e,i,n,s,o){var a,n=K(e,n,s,o),s=t.oPreviousSearch.sSearch,o=t.aiDisplayMaster;if(0!==$e.ext.search.length&&(i=!0),a=Q(t),0>=e.length)t.aiDisplay=o.slice();else for((a||i||s.length>e.length||0!==e.indexOf(s)||t.bSorted)&&(t.aiDisplay=o.slice()),e=t.aiDisplay,i=e.length-1;i>=0;i--)n.test(t.aoData[e[i]]._sFilterRow)||e.splice(i,1)}function K(t,e,i,s){return t=e?t:J(t),i&&(t="^(?=.*?"+n.map(t.match(/"[^"]+"|[^ ]+/g)||"",function(t){return'"'===t.charAt(0)?t.match(/^"(.*)"$/)[1]:t}).join(")(?=.*?")+").*$"),RegExp(t,s?"i":"")}function J(t){return t.replace(Qe,"\\$1")}function Q(t){var e,i,n,s,o,a,r,l,c=t.aoColumns,h=$e.ext.type.search;for(e=!1,i=0,s=t.aoData.length;s>i;i++)if(l=t.aoData[i],!l._aFilterData){for(a=[],n=0,o=c.length;o>n;n++)e=c[n],e.bSearchable?(r=x(t,i,n,"filter"),r=h[e.sType]?h[e.sType](r):null!==r?r:""):r="",r.indexOf&&-1!==r.indexOf("&")&&(pi.innerHTML=r,r=mi?pi.textContent:pi.innerText),r.replace&&(r=r.replace(/[\r\n]/g,"")),a.push(r);l._aFilterData=a,l._sFilterRow=a.join("  "),e=!0}return e}function te(t){var e=t.sTableId,i=t.aanFeatures.i,s=n("<div/>",{"class":t.oClasses.sInfo,id:i?null:e+"_info"});return i||(t.aoDrawCallback.push({fn:ee,sName:"information"}),s.attr("role","status").attr("aria-live","polite"),n(t.nTable).attr("aria-describedby",e+"_info")),s[0]}function ee(t){var e=t.aanFeatures.i;if(0!==e.length){var i=t.oLanguage,s=t._iDisplayStart+1,o=t.fnDisplayEnd(),a=t.fnRecordsTotal(),r=t.fnRecordsDisplay(),l=r?i.sInfo:i.sInfoEmpty;r!==a&&(l+=" "+i.sInfoFiltered),l+=i.sInfoPostFix,l=ie(t,l),i=i.fnInfoCallback,null!==i&&(l=i.call(t.oInstance,t,s,o,a,r,l)),n(e).html(l)}}function ie(t,e){var i=t.fnFormatNumber,n=t._iDisplayStart+1,s=t._iDisplayLength,o=t.fnRecordsDisplay(),a=-1===s;return e.replace(/_START_/g,i.call(t,n)).replace(/_END_/g,i.call(t,t.fnDisplayEnd())).replace(/_MAX_/g,i.call(t,t.fnRecordsTotal())).replace(/_TOTAL_/g,i.call(t,o)).replace(/_PAGE_/g,i.call(t,a?1:Math.ceil(n/s))).replace(/_PAGES_/g,i.call(t,a?1:Math.ceil(o/s)))}function ne(t){var e,i,n,s=t.iInitDisplayStart,o=t.aoColumns;if(i=t.oFeatures,t.bInitialised){for(F(t),E(t),O(t,t.aoHeader),O(t,t.aoFooter),he(t,!0),i.bAutoWidth&&me(t),e=0,i=o.length;i>e;e++)n=o[e],n.sWidth&&(n.nTh.style.width=ye(n.sWidth));N(t),o=Ue(t),"ssp"!=o&&("ajax"==o?z(t,[],function(i){var n=W(t,i);for(e=0;e<n.length;e++)y(t,n[e]);t.iInitDisplayStart=s,N(t),he(t,!1),se(t,i)},t):(he(t,!1),se(t)))}else setTimeout(function(){ne(t)},200)}function se(t,e){t._bInitComplete=!0,e&&p(t),Ne(t,"aoInitComplete","init",[t,e])}function oe(t,e){var i=parseInt(e,10);t._iDisplayLength=i,Fe(t),Ne(t,null,"length",[t,i])}function ae(t){for(var e=t.oClasses,i=t.sTableId,s=t.aLengthMenu,o=n.isArray(s[0]),a=o?s[0]:s,o=o?s[1]:s,s=n("<select/>",{name:i+"_length","aria-controls":i,"class":e.sLengthSelect}),r=0,l=a.length;l>r;r++)s[0][r]=new Option(o[r],a[r]);var c=n("<div><label/></div>").addClass(e.sLength);return t.aanFeatures.l||(c[0].id=i+"_length"),e=t.oLanguage.sLengthMenu.split(/(_MENU_)/),c.children().append(1<e.length?[e[0],s,e[2]]:e[0]),n("select",c).val(t._iDisplayLength).bind("change.DT",function(){oe(t,n(this).val()),j(t)}),n(t.nTable).bind("length.dt.DT",function(t,e,i){n("select",c).val(i)}),c[0]}function re(t){var e=t.sPaginationType,i=$e.ext.pager[e],s="function"==typeof i,o=function(t){j(t)},e=n("<div/>").addClass(t.oClasses.sPaging+e)[0],a=t.aanFeatures;return s||i.fnInit(t,e,o),a.p||(e.id=t.sTableId+"_paginate",t.aoDrawCallback.push({fn:function(t){if(s){var e,n=t._iDisplayStart,r=t._iDisplayLength,l=t.fnRecordsDisplay(),c=-1===r,n=c?0:Math.ceil(n/r),r=c?1:Math.ceil(l/r),l=i(n,r),c=0;for(e=a.p.length;e>c;c++)Be(t,"pageButton")(t,a.p[c],c,l,n,r)}else i.fnUpdate(t,o)},sName:"pagination"})),e}function le(t,e,i){var n=t._iDisplayStart,s=t._iDisplayLength,o=t.fnRecordsDisplay();return 0===o||-1===s?n=0:"number"==typeof e?(n=e*s,n>o&&(n=0)):"first"==e?n=0:"previous"==e?(n=s>=0?n-s:0,0>n&&(n=0)):"next"==e?o>n+s&&(n+=s):"last"==e?n=Math.floor((o-1)/s)*s:Pe(t,0,"Unknown paging action: "+e,5),e=t._iDisplayStart!==n,t._iDisplayStart=n,e&&(Ne(t,null,"page",[t]),i&&j(t)),e}function ce(t){return n("<div/>",{id:t.aanFeatures.r?null:t.sTableId+"_processing","class":t.oClasses.sProcessing}).html(t.oLanguage.sProcessing).insertBefore(t.nTable)[0]}function he(t,e){t.oFeatures.bProcessing&&n(t.aanFeatures.r).css("display",e?"block":"none"),Ne(t,null,"processing",[t,e])}function de(t){var e=n(t.nTable);e.attr("role","grid");var i=t.oScroll;if(""===i.sX&&""===i.sY)return t.nTable;var s=i.sX,o=i.sY,a=t.oClasses,r=e.children("caption"),l=r.length?r[0]._captionSide:null,c=n(e[0].cloneNode(!1)),h=n(e[0].cloneNode(!1)),d=e.children("tfoot");i.sX&&"100%"===e.attr("width")&&e.removeAttr("width"),d.length||(d=null),i=n("<div/>",{"class":a.sScrollWrapper}).append(n("<div/>",{"class":a.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:s?s?ye(s):null:"100%"}).append(n("<div/>",{"class":a.sScrollHeadInner}).css({"box-sizing":"content-box",width:i.sXInner||"100%"}).append(c.removeAttr("id").css("margin-left",0).append(e.children("thead")))).append("top"===l?r:null)).append(n("<div/>",{"class":a.sScrollBody}).css({overflow:"auto",height:o?ye(o):null,width:s?ye(s):null}).append(e)),d&&i.append(n("<div/>",{"class":a.sScrollFoot}).css({overflow:"hidden",border:0,width:s?s?ye(s):null:"100%"}).append(n("<div/>",{"class":a.sScrollFootInner}).append(h.removeAttr("id").css("margin-left",0).append(e.children("tfoot")))).append("bottom"===l?r:null));var e=i.children(),u=e[0],a=e[1],p=d?e[2]:null;return s&&n(a).scroll(function(){var t=this.scrollLeft;u.scrollLeft=t,d&&(p.scrollLeft=t)}),t.nScrollHead=u,t.nScrollBody=a,t.nScrollFoot=p,t.aoDrawCallback.push({fn:ue,sName:"scrolling"}),i[0]}function ue(t){var e,i,s,o,a,r,l=t.oScroll,c=l.sX,h=l.sXInner,d=l.sY,u=l.iBarWidth,p=n(t.nScrollHead),f=p[0].style,g=p.children("div"),v=g[0].style,_=g.children("table"),g=t.nScrollBody,b=n(g),y=g.style,w=n(t.nScrollFoot).children("div"),x=w.children("table"),C=n(t.nTHead),S=n(t.nTable),T=S[0],A=T.style,L=t.nTFoot?n(t.nTFoot):null,M=t.oBrowser,k=M.bScrollOversize,D=[],I=[],P=[],R=function(t){t=t.style,t.paddingTop="0",t.paddingBottom="0",t.borderTopWidth="0",t.borderBottomWidth="0",t.height=0};S.children("thead, tfoot").remove(),a=C.clone().prependTo(S),e=C.find("tr"),s=a.find("tr"),a.find("th, td").removeAttr("tabindex"),L&&(o=L.clone().prependTo(S),i=L.find("tr"),o=o.find("tr")),c||(y.width="100%",p[0].style.width="100%"),n.each(U(t,a),function(e,i){r=m(t,e),i.style.width=t.aoColumns[r].sWidth}),L&&pe(function(t){t.style.width=""},o),l.bCollapse&&""!==d&&(y.height=b[0].offsetHeight+C[0].offsetHeight+"px"),p=S.outerWidth(),""===c?(A.width="100%",k&&(S.find("tbody").height()>g.offsetHeight||"scroll"==b.css("overflow-y"))&&(A.width=ye(S.outerWidth()-u))):""!==h?A.width=ye(h):p==b.width()&&b.height()<S.height()?(A.width=ye(p-u),S.outerWidth()>p-u&&(A.width=ye(p))):A.width=ye(p),p=S.outerWidth(),pe(R,s),pe(function(t){P.push(t.innerHTML),D.push(ye(n(t).css("width")))},s),pe(function(t,e){t.style.width=D[e]},e),n(s).height(0),L&&(pe(R,o),pe(function(t){I.push(ye(n(t).css("width")))},o),pe(function(t,e){t.style.width=I[e]},i),n(o).height(0)),pe(function(t,e){t.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+P[e]+"</div>",t.style.width=D[e]},s),L&&pe(function(t,e){t.innerHTML="",t.style.width=I[e]},o),S.outerWidth()<p?(i=g.scrollHeight>g.offsetHeight||"scroll"==b.css("overflow-y")?p+u:p,k&&(g.scrollHeight>g.offsetHeight||"scroll"==b.css("overflow-y"))&&(A.width=ye(i-u)),(""===c||""!==h)&&Pe(t,1,"Possible column misalignment",6)):i="100%",y.width=ye(i),f.width=ye(i),L&&(t.nScrollFoot.style.width=ye(i)),!d&&k&&(y.height=ye(T.offsetHeight+u)),d&&l.bCollapse&&(y.height=ye(d),l=c&&T.offsetWidth>g.offsetWidth?u:0,T.offsetHeight<g.offsetHeight&&(y.height=ye(T.offsetHeight+l))),l=S.outerWidth(),_[0].style.width=ye(l),v.width=ye(l),_=S.height()>g.clientHeight||"scroll"==b.css("overflow-y"),M="padding"+(M.bScrollbarLeft?"Left":"Right"),v[M]=_?u+"px":"0px",L&&(x[0].style.width=ye(l),w[0].style.width=ye(l),w[0].style[M]=_?u+"px":"0px"),b.scroll(),(t.bSorted||t.bFiltered)&&(g.scrollTop=0)}function pe(t,e,i){for(var n,s,o=0,a=0,r=e.length;r>a;){for(n=e[a].firstChild,s=i?i[a].firstChild:null;n;)1===n.nodeType&&(i?t(n,s,o):t(n,o),o++),n=n.nextSibling,s=i?s.nextSibling:null;a++}}function me(e){var i,s,o=e.nTable,a=e.aoColumns,r=e.oScroll,l=r.sY,c=r.sX,h=r.sXInner,d=a.length,r=v(e,"bVisible"),u=n("th",e.nTHead),m=o.getAttribute("width"),f=o.parentNode,_=!1;for(i=0;i<r.length;i++)s=a[r[i]],null!==s.sWidth&&(s.sWidth=ge(s.sWidthOrig,f),_=!0);if(_||c||l||d!=g(e)||d!=u.length){d=n(o.cloneNode(!1)).css("visibility","hidden").removeAttr("id").append(n(e.nTHead).clone(!1)).append(n(e.nTFoot).clone(!1)).append(n("<tbody><tr/></tbody>")),d.find("tfoot th, tfoot td").css("width","");var b=d.find("tbody tr"),u=U(e,d.find("thead")[0]);for(i=0;i<r.length;i++)s=a[r[i]],u[i].style.width=null!==s.sWidthOrig&&""!==s.sWidthOrig?ye(s.sWidthOrig):"";if(e.aoData.length)for(i=0;i<r.length;i++)_=r[i],s=a[_],n(_e(e,_)).clone(!1).append(s.sContentPadding).appendTo(b);if(d.appendTo(f),c&&h?d.width(h):c?(d.css("width","auto"),d.width()<f.offsetWidth&&d.width(f.offsetWidth)):l?d.width(f.offsetWidth):m&&d.width(m),ve(e,d[0]),c){for(i=h=0;i<r.length;i++)s=a[r[i]],l=n(u[i]).outerWidth(),h+=null===s.sWidthOrig?l:parseInt(s.sWidth,10)+l-n(u[i]).width();d.width(ye(h)),o.style.width=ye(h)}for(i=0;i<r.length;i++)s=a[r[i]],(l=n(u[i]).width())&&(s.sWidth=ye(l));o.style.width=ye(d.css("width")),d.remove()}else for(i=0;d>i;i++)a[i].sWidth=ye(u.eq(i).width());m&&(o.style.width=ye(m)),!m&&!c||e._reszEvt||(n(t).bind("resize.DT-"+e.sInstance,fe(function(){p(e)})),e._reszEvt=!0)}function fe(t,e){var n,s,o=e||200;return function(){var e=this,a=+new Date,r=arguments;n&&n+o>a?(clearTimeout(s),s=setTimeout(function(){n=i,t.apply(e,r)},o)):n?(n=a,t.apply(e,r)):n=a}}function ge(t,i){if(!t)return 0;var s=n("<div/>").css("width",ye(t)).appendTo(i||e.body),o=s[0].offsetWidth;return s.remove(),o}function ve(t,e){var i=t.oScroll;(i.sX||i.sY)&&(i=i.sX?0:i.iBarWidth,e.style.width=ye(n(e).outerWidth()-i))}function _e(t,e){var i=be(t,e);if(0>i)return null;var s=t.aoData[i];return s.nTr?s.anCells[e]:n("<td/>").html(x(t,i,e,"display"))[0]}function be(t,e){for(var i,n=-1,s=-1,o=0,a=t.aoData.length;a>o;o++)i=x(t,o,e,"display")+"",i=i.replace(fi,""),i.length>n&&(n=i.length,s=o);return s}function ye(t){return null===t?"0px":"number"==typeof t?0>t?"0px":t+"px":t.match(/\d$/)?t+"px":t}function we(){if(!$e.__scrollbarWidth){var t=n("<p/>").css({width:"100%",height:200,padding:0})[0],e=n("<div/>").css({position:"absolute",top:0,left:0,width:200,height:150,padding:0,overflow:"hidden",visibility:"hidden"}).append(t).appendTo("body"),i=t.offsetWidth;e.css("overflow","scroll"),t=t.offsetWidth,i===t&&(t=e[0].clientWidth),e.remove(),$e.__scrollbarWidth=i-t}return $e.__scrollbarWidth}function xe(t){var e,i,s,o,a,r,l=[],c=t.aoColumns;e=t.aaSortingFixed,i=n.isPlainObject(e);var h=[];for(s=function(t){t.length&&!n.isArray(t[0])?h.push(t):h.push.apply(h,t)},n.isArray(e)&&s(e),i&&e.pre&&s(e.pre),s(t.aaSorting),i&&e.post&&s(e.post),t=0;t<h.length;t++)for(r=h[t][0],s=c[r].aDataSort,e=0,i=s.length;i>e;e++)o=s[e],a=c[o].sType||"string",l.push({src:r,col:o,dir:h[t][1],index:h[t][2],type:a,formatter:$e.ext.type.order[a+"-pre"]});return l}function Ce(t){var e,i,n,s,o=[],a=$e.ext.type.order,r=t.aoData,l=0,c=t.aiDisplayMaster;for(_(t),s=xe(t),e=0,i=s.length;i>e;e++)n=s[e],n.formatter&&l++,Me(t,n.col);if("ssp"!=Ue(t)&&0!==s.length){for(e=0,i=c.length;i>e;e++)o[c[e]]=e;l===s.length?c.sort(function(t,e){var i,n,a,l,c=s.length,h=r[t]._aSortData,d=r[e]._aSortData;for(a=0;c>a;a++)if(l=s[a],i=h[l.col],n=d[l.col],i=n>i?-1:i>n?1:0,0!==i)return"asc"===l.dir?i:-i;return i=o[t],n=o[e],n>i?-1:i>n?1:0}):c.sort(function(t,e){var i,n,l,c,h=s.length,d=r[t]._aSortData,u=r[e]._aSortData;for(l=0;h>l;l++)if(c=s[l],i=d[c.col],n=u[c.col],c=a[c.type+"-"+c.dir]||a["string-"+c.dir],i=c(i,n),0!==i)return i;return i=o[t],n=o[e],n>i?-1:i>n?1:0})}t.bSorted=!0}function Se(t){for(var e,i,n=t.aoColumns,s=xe(t),t=t.oLanguage.oAria,o=0,a=n.length;a>o;o++){i=n[o];var r=i.asSorting;e=i.sTitle.replace(/<.*?>/g,"");var l=i.nTh;l.removeAttribute("aria-sort"),i.bSortable&&(0<s.length&&s[0].col==o?(l.setAttribute("aria-sort","asc"==s[0].dir?"ascending":"descending"),i=r[s[0].index+1]||r[0]):i=r[0],e+="asc"===i?t.sSortAscending:t.sSortDescending),l.setAttribute("aria-label",e)}}function Te(t,e,s,o){var a=t.aaSorting,r=t.aoColumns[e].asSorting,l=function(t){var e=t._idx;return e===i&&(e=n.inArray(t[1],r)),e+1>=r.length?0:e+1};s&&t.oFeatures.bSortMulti?(s=n.inArray(e,ai(a,"0")),-1!==s?(e=l(a[s]),a[s][1]=r[e],a[s]._idx=e):(a.push([e,r[0],0]),a[a.length-1]._idx=0)):a.length&&a[0][0]==e?(e=l(a[0]),a.length=1,a[0][1]=r[e],a[0]._idx=e):(a.length=0,a.push([e,r[0]]),a[0]._idx=0),N(t),"function"==typeof o&&o(t)}function Ae(t,e,i,n){var s=t.aoColumns[i];Oe(e,{},function(e){!1!==s.bSortable&&(t.oFeatures.bProcessing?(he(t,!0),setTimeout(function(){Te(t,i,e.shiftKey,n),"ssp"!==Ue(t)&&he(t,!1)},0)):Te(t,i,e.shiftKey,n))})}function Le(t){var e,i,s=t.aLastSort,o=t.oClasses.sSortColumn,a=xe(t),r=t.oFeatures;if(r.bSort&&r.bSortClasses){for(r=0,e=s.length;e>r;r++)i=s[r].src,n(ai(t.aoData,"anCells",i)).removeClass(o+(2>r?r+1:3));for(r=0,e=a.length;e>r;r++)i=a[r].src,n(ai(t.aoData,"anCells",i)).addClass(o+(2>r?r+1:3))}t.aLastSort=a}function Me(t,e){var i,n=t.aoColumns[e],s=$e.ext.order[n.sSortDataType];s&&(i=s.call(t.oInstance,t,e,f(t,e)));for(var o,a=$e.ext.type.order[n.sType+"-pre"],r=0,l=t.aoData.length;l>r;r++)n=t.aoData[r],n._aSortData||(n._aSortData=[]),(!n._aSortData[e]||s)&&(o=s?i[r]:x(t,r,e,"sort"),n._aSortData[e]=a?a(o):o)}function ke(t){if(t.oFeatures.bStateSave&&!t.bDestroying){var e={iCreate:+new Date,iStart:t._iDisplayStart,iLength:t._iDisplayLength,aaSorting:n.extend(!0,[],t.aaSorting),oSearch:n.extend(!0,{},t.oPreviousSearch),aoSearchCols:n.extend(!0,[],t.aoPreSearchCols),abVisCols:ai(t.aoColumns,"bVisible")};Ne(t,"aoStateSaveParams","stateSaveParams",[t,e]),t.fnStateSaveCallback.call(t.oInstance,t,e)}}function De(t){var e,i,s=t.aoColumns;if(t.oFeatures.bStateSave){var o=t.fnStateLoadCallback.call(t.oInstance,t);if(o&&(e=Ne(t,"aoStateLoadParams","stateLoadParams",[t,o]),-1===n.inArray(!1,e)&&(e=t.iStateDuration,!(e>0&&o.iCreate<+new Date-1e3*e)&&s.length===o.aoSearchCols.length))){t.oLoadedState=n.extend(!0,{},o),t._iDisplayStart=o.iStart,t.iInitDisplayStart=o.iStart,t._iDisplayLength=o.iLength,t.aaSorting=n.map(o.aaSorting,function(t){return t[0]>=s.length?[0,t[1]]:t
}),n.extend(t.oPreviousSearch,o.oSearch),n.extend(!0,t.aoPreSearchCols,o.aoSearchCols);var a=o.abVisCols;for(e=0,i=a.length;i>e;e++)s[e].bVisible=a[e];Ne(t,"aoStateLoaded","stateLoaded",[t,o])}}}function Ie(t){var e=$e.settings,t=n.inArray(t,ai(e,"nTable"));return-1!==t?e[t]:null}function Pe(e,i,n,s){if(n="DataTables warning: "+(null!==e?"table id="+e.sTableId+" - ":"")+n,s&&(n+=". For more information about this error, please see http://datatables.net/tn/"+s),i)t.console&&console.log&&console.log(n);else{if(e=$e.ext,"alert"!=(e.sErrMode||e.errMode))throw Error(n);alert(n)}}function Re(t,e,s,o){n.isArray(s)?n.each(s,function(i,s){n.isArray(s)?Re(t,e,s[0],s[1]):Re(t,e,s)}):(o===i&&(o=s),e[s]!==i&&(t[o]=e[s]))}function Ee(t,e,i){var s,o;for(o in e)e.hasOwnProperty(o)&&(s=e[o],n.isPlainObject(s)?(n.isPlainObject(t[o])||(t[o]={}),n.extend(!0,t[o],s)):t[o]=i&&"data"!==o&&"aaData"!==o&&n.isArray(s)?s.slice():s);return t}function Oe(t,e,i){n(t).bind("click.DT",e,function(e){t.blur(),i(e)}).bind("keypress.DT",e,function(t){13===t.which&&(t.preventDefault(),i(t))}).bind("selectstart.DT",function(){return!1})}function je(t,e,i,n){i&&t[e].push({fn:i,sName:n})}function Ne(t,e,i,s){var o=[];return e&&(o=n.map(t[e].slice().reverse(),function(e){return e.fn.apply(t.oInstance,s)})),null!==i&&n(t.nTable).trigger(i+".dt",s),o}function Fe(t){var e=t._iDisplayStart,i=t.fnDisplayEnd(),n=t._iDisplayLength;i===t.fnRecordsDisplay()&&(e=i-n),(-1===n||0>e)&&(e=0),t._iDisplayStart=e}function Be(t,e){var i=t.renderer,s=$e.ext.renderer[e];return n.isPlainObject(i)&&i[e]?s[i[e]]||s._:"string"==typeof i?s[i]||s._:s._}function Ue(t){return t.oFeatures.bServerSide?"ssp":t.ajax||t.sAjaxSource?"ajax":"dom"}function ze(t,e){var i=[],i=Di.numbers_length,n=Math.floor(i/2);return i>=e?i=li(0,e):n>=t?(i=li(0,i-2),i.push("ellipsis"),i.push(e-1)):(t>=e-1-n?i=li(e-(i-2),e):(i=li(t-1,t+2),i.push("ellipsis"),i.push(e-1)),i.splice(0,0,"ellipsis"),i.splice(0,0,0)),i.DT_el="span",i}function Ve(t){n.each({num:function(e){return Ii(e,t)},"num-fmt":function(e){return Ii(e,t,ti)},"html-num":function(e){return Ii(e,t,Ke)},"html-num-fmt":function(e){return Ii(e,t,Ke,ti)}},function(e,i){We.type.order[e+t+"-pre"]=i})}function He(t){return function(){var e=[Ie(this[$e.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return $e.ext.internal[t].apply(this,e)}}var $e,We,Ge,qe,Ye,Ze={},Xe=/[\r\n]/g,Ke=/<.*?>/g,Je=/^[\d\+\-a-zA-Z]/,Qe=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)","g"),ti=/[',$\u00a3\u20ac\u00a5%\u2009\u202F]/g,ei=function(t){return t&&"-"!==t?!1:!0},ii=function(t){var e=parseInt(t,10);return!isNaN(e)&&isFinite(t)?e:null},ni=function(t,e){return Ze[e]||(Ze[e]=RegExp(J(e),"g")),"string"==typeof t?t.replace(/\./g,"").replace(Ze[e],"."):t},si=function(t,e,i){var n="string"==typeof t;return e&&n&&(t=ni(t,e)),i&&n&&(t=t.replace(ti,"")),!t||"-"===t||!isNaN(parseFloat(t))&&isFinite(t)},oi=function(t,e,i){return ei(t)?!0:t&&"string"!=typeof t?null:si(t.replace(Ke,""),e,i)?!0:null},ai=function(t,e,n){var s=[],o=0,a=t.length;if(n!==i)for(;a>o;o++)t[o]&&t[o][e]&&s.push(t[o][e][n]);else for(;a>o;o++)t[o]&&s.push(t[o][e]);return s},ri=function(t,e,n,s){var o=[],a=0,r=e.length;if(s!==i)for(;r>a;a++)o.push(t[e[a]][n][s]);else for(;r>a;a++)o.push(t[e[a]][n]);return o},li=function(t,e){var n,s=[];e===i?(e=0,n=t):(n=e,e=t);for(var o=e;n>o;o++)s.push(o);return s},ci=function(t){var e,i,n,s=[],o=t.length,a=0;i=0;t:for(;o>i;i++){for(e=t[i],n=0;a>n;n++)if(s[n]===e)continue t;s.push(e),a++}return s},hi=function(t,e,n){t[e]!==i&&(t[n]=t[e])},di=/\[.*?\]$/,ui=/\(\)$/,pi=n("<div>")[0],mi=pi.textContent!==i,fi=/<.*?>/g;$e=function(t){this.$=function(t,e){return this.api(!0).$(t,e)},this._=function(t,e){return this.api(!0).rows(t,e).data()},this.api=function(t){return t?new Ge(Ie(this[We.iApiIndex])):new Ge(this)},this.fnAddData=function(t,e){var s=this.api(!0),o=n.isArray(t)&&(n.isArray(t[0])||n.isPlainObject(t[0]))?s.rows.add(t):s.row.add(t);return(e===i||e)&&s.draw(),o.flatten().toArray()},this.fnAdjustColumnSizing=function(t){var e=this.api(!0).columns.adjust(),n=e.settings()[0],s=n.oScroll;t===i||t?e.draw(!1):(""!==s.sX||""!==s.sY)&&ue(n)},this.fnClearTable=function(t){var e=this.api(!0).clear();(t===i||t)&&e.draw()},this.fnClose=function(t){this.api(!0).row(t).child.hide()},this.fnDeleteRow=function(t,e,n){var s=this.api(!0),t=s.rows(t),o=t.settings()[0],a=o.aoData[t[0][0]];return t.remove(),e&&e.call(this,o,a),(n===i||n)&&s.draw(),a},this.fnDestroy=function(t){this.api(!0).destroy(t)},this.fnDraw=function(t){this.api(!0).draw(!t)},this.fnFilter=function(t,e,n,s,o,a){o=this.api(!0),null===e||e===i?o.search(t,n,s,a):o.column(e).search(t,n,s,a),o.draw()},this.fnGetData=function(t,e){var n=this.api(!0);if(t!==i){var s=t.nodeName?t.nodeName.toLowerCase():"";return e!==i||"td"==s||"th"==s?n.cell(t,e).data():n.row(t).data()||null}return n.data().toArray()},this.fnGetNodes=function(t){var e=this.api(!0);return t!==i?e.row(t).node():e.rows().nodes().flatten().toArray()},this.fnGetPosition=function(t){var e=this.api(!0),i=t.nodeName.toUpperCase();return"TR"==i?e.row(t).index():"TD"==i||"TH"==i?(t=e.cell(t).index(),[t.row,t.columnVisible,t.column]):null},this.fnIsOpen=function(t){return this.api(!0).row(t).child.isShown()},this.fnOpen=function(t,e,i){return this.api(!0).row(t).child(e,i).show().child()[0]},this.fnPageChange=function(t,e){var n=this.api(!0).page(t);(e===i||e)&&n.draw(!1)},this.fnSetColumnVis=function(t,e,n){t=this.api(!0).column(t).visible(e),(n===i||n)&&t.columns.adjust().draw()},this.fnSettings=function(){return Ie(this[We.iApiIndex])},this.fnSort=function(t){this.api(!0).order(t).draw()},this.fnSortListener=function(t,e,i){this.api(!0).order.listener(t,e,i)},this.fnUpdate=function(t,e,n,s,o){var a=this.api(!0);return n===i||null===n?a.row(e).data(t):a.cell(e,n).data(t),(o===i||o)&&a.columns.adjust(),(s===i||s)&&a.draw(),0},this.fnVersionCheck=We.fnVersionCheck;var e=this,s=t===i,h=this.length;s&&(t={}),this.oApi=this.internal=We.internal;for(var p in $e.ext.internal)p&&(this[p]=He(p));return this.each(function(){var p,m={},f=h>1?Ee(m,t,!0):t,g=0,v=this.getAttribute("id"),m=!1,_=$e.defaults;if("table"!=this.nodeName.toLowerCase())Pe(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{r(_),l(_.column),o(_,_,!0),o(_.column,_.column,!0),o(_,f);var x=$e.settings,g=0;for(p=x.length;p>g;g++){if(x[g].nTable==this){if(p=f.bRetrieve!==i?f.bRetrieve:_.bRetrieve,s||p)return x[g].oInstance;if(f.bDestroy!==i?f.bDestroy:_.bDestroy){x[g].oInstance.fnDestroy();break}return Pe(x[g],0,"Cannot reinitialise DataTable",3),void 0}if(x[g].sTableId==this.id){x.splice(g,1);break}}(null===v||""===v)&&(this.id=v="DataTables_Table_"+$e.ext._unique++);var C=n.extend(!0,{},$e.models.oSettings,{nTable:this,oApi:e.internal,oInit:f,sDestroyWidth:n(this)[0].style.width,sInstance:v,sTableId:v});x.push(C),C.oInstance=1===e.length?e:n(this).dataTable(),r(f),f.oLanguage&&a(f.oLanguage),f.aLengthMenu&&!f.iDisplayLength&&(f.iDisplayLength=n.isArray(f.aLengthMenu[0])?f.aLengthMenu[0][0]:f.aLengthMenu[0]),f=Ee(n.extend(!0,{},_),f),Re(C.oFeatures,f,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" ")),Re(C,f,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]),Re(C.oScroll,f,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]),Re(C.oLanguage,f,"fnInfoCallback"),je(C,"aoDrawCallback",f.fnDrawCallback,"user"),je(C,"aoServerParams",f.fnServerParams,"user"),je(C,"aoStateSaveParams",f.fnStateSaveParams,"user"),je(C,"aoStateLoadParams",f.fnStateLoadParams,"user"),je(C,"aoStateLoaded",f.fnStateLoaded,"user"),je(C,"aoRowCallback",f.fnRowCallback,"user"),je(C,"aoRowCreatedCallback",f.fnCreatedRow,"user"),je(C,"aoHeaderCallback",f.fnHeaderCallback,"user"),je(C,"aoFooterCallback",f.fnFooterCallback,"user"),je(C,"aoInitComplete",f.fnInitComplete,"user"),je(C,"aoPreDrawCallback",f.fnPreDrawCallback,"user"),v=C.oClasses,f.bJQueryUI?(n.extend(v,$e.ext.oJUIClasses,f.oClasses),f.sDom===_.sDom&&"lfrtip"===_.sDom&&(C.sDom='<"H"lfr>t<"F"ip>'),C.renderer?n.isPlainObject(C.renderer)&&!C.renderer.header&&(C.renderer.header="jqueryui"):C.renderer="jqueryui"):n.extend(v,$e.ext.classes,f.oClasses),n(this).addClass(v.sTable),(""!==C.oScroll.sX||""!==C.oScroll.sY)&&(C.oScroll.iBarWidth=we()),!0===C.oScroll.sX&&(C.oScroll.sX="100%"),C.iInitDisplayStart===i&&(C.iInitDisplayStart=f.iDisplayStart,C._iDisplayStart=f.iDisplayStart),null!==f.iDeferLoading&&(C.bDeferLoading=!0,g=n.isArray(f.iDeferLoading),C._iRecordsDisplay=g?f.iDeferLoading[0]:f.iDeferLoading,C._iRecordsTotal=g?f.iDeferLoading[1]:f.iDeferLoading),""!==f.oLanguage.sUrl?(C.oLanguage.sUrl=f.oLanguage.sUrl,n.getJSON(C.oLanguage.sUrl,null,function(t){a(t),o(_.oLanguage,t),n.extend(!0,C.oLanguage,f.oLanguage,t),ne(C)}),m=!0):n.extend(!0,C.oLanguage,f.oLanguage),null===f.asStripeClasses&&(C.asStripeClasses=[v.sStripeOdd,v.sStripeEven]);var g=C.asStripeClasses,S=n("tbody tr:eq(0)",this);-1!==n.inArray(!0,n.map(g,function(t){return S.hasClass(t)}))&&(n("tbody tr",this).removeClass(g.join(" ")),C.asDestroyStripes=g.slice());var T,x=[],g=this.getElementsByTagName("thead");if(0!==g.length&&(B(C.aoHeader,g[0]),x=U(C)),null===f.aoColumns)for(T=[],g=0,p=x.length;p>g;g++)T.push(null);else T=f.aoColumns;for(g=0,p=T.length;p>g;g++)d(C,x?x[g]:null);if(b(C,f.aoColumnDefs,T,function(t,e){u(C,t,e)}),S.length){var A=function(t,e){return t.getAttribute("data-"+e)?e:null};n.each(I(C,S[0]).cells,function(t,e){var n=C.aoColumns[t];if(n.mData===t){var s=A(e,"sort")||A(e,"order"),o=A(e,"filter")||A(e,"search");(null!==s||null!==o)&&(n.mData={_:t+".display",sort:null!==s?t+".@data-"+s:i,type:null!==s?t+".@data-"+s:i,filter:null!==o?t+".@data-"+o:i},u(C,t))}})}var L=C.oFeatures;if(f.bStateSave&&(L.bStateSave=!0,De(C,f),je(C,"aoDrawCallback",ke,"state_save")),f.aaSorting===i)for(x=C.aaSorting,g=0,p=x.length;p>g;g++)x[g][1]=C.aoColumns[g].asSorting[0];if(Le(C),L.bSort&&je(C,"aoDrawCallback",function(){if(C.bSorted){var t=xe(C),e={};n.each(t,function(t,i){e[i.src]=i.dir}),Ne(C,null,"order",[C,t,e]),Se(C)}}),je(C,"aoDrawCallback",function(){(C.bSorted||"ssp"===Ue(C)||L.bDeferRender)&&Le(C)},"sc"),c(C),g=n(this).children("caption").each(function(){this._captionSide=n(this).css("caption-side")}),p=n(this).children("thead"),0===p.length&&(p=n("<thead/>").appendTo(this)),C.nTHead=p[0],p=n(this).children("tbody"),0===p.length&&(p=n("<tbody/>").appendTo(this)),C.nTBody=p[0],p=n(this).children("tfoot"),0===p.length&&0<g.length&&(""!==C.oScroll.sX||""!==C.oScroll.sY)&&(p=n("<tfoot/>").appendTo(this)),0===p.length||0===p.children().length?n(this).addClass(v.sNoFooter):0<p.length&&(C.nTFoot=p[0],B(C.aoFooter,C.nTFoot)),f.aaData)for(g=0;g<f.aaData.length;g++)y(C,f.aaData[g]);else(C.bDeferLoading||"dom"==Ue(C))&&w(C,n(C.nTBody).children("tr"));C.aiDisplay=C.aiDisplayMaster.slice(),C.bInitialised=!0,!1===m&&ne(C)}}),e=null,this};var gi=[],vi=Array.prototype,_i=function(t){var e,i,s=$e.settings,o=n.map(s,function(t){return t.nTable});return t?t.nTable&&t.oApi?[t]:t.nodeName&&"table"===t.nodeName.toLowerCase()?(e=n.inArray(t,o),-1!==e?[s[e]]:null):t&&"function"==typeof t.settings?t.settings().toArray():("string"==typeof t?i=n(t):t instanceof n&&(i=t),i?i.map(function(){return e=n.inArray(this,o),-1!==e?s[e]:null}).toArray():void 0):[]};$e.Api=Ge=function(t,e){if(!this instanceof Ge)throw"DT API must be constructed as a new object";var i=[],s=function(t){(t=_i(t))&&i.push.apply(i,t)};if(n.isArray(t))for(var o=0,a=t.length;a>o;o++)s(t[o]);else s(t);this.context=ci(i),e&&this.push.apply(this,e.toArray?e.toArray():e),this.selector={rows:null,cols:null,opts:null},Ge.extend(this,this,gi)},Ge.prototype={concat:vi.concat,context:[],each:function(t){if(vi.forEach)vi.forEach.call(this,t,this);else for(var e=0,i=this.length;i>e;e++)t.call(this,this[e],e,this);return this},eq:function(t){var e=this.context;return e.length>t?new Ge(e[t],this[t]):null},filter:function(t){var e=[];if(vi.filter)e=vi.filter.call(this,t,this);else for(var i=0,n=this.length;n>i;i++)t.call(this,this[i],i,this)&&e.push(this[i]);return new Ge(this.context,e)},flatten:function(){var t=[];return new Ge(this.context,t.concat.apply(t,this.toArray()))},join:vi.join,indexOf:vi.indexOf||function(t,e){for(var i=e||0,n=this.length;n>i;i++)if(this[i]===t)return i;return-1},iterator:function(t,e,n){var s,o,a,r,l,c,h,d=[],u=this.context,p=this.selector;for("string"==typeof t&&(n=e,e=t,t=!1),o=0,a=u.length;a>o;o++)if("table"===e)s=n(u[o],o),s!==i&&d.push(s);else if("columns"===e||"rows"===e)s=n(u[o],this[o],o),s!==i&&d.push(s);else if("column"===e||"column-rows"===e||"row"===e||"cell"===e)for(h=this[o],"column-rows"===e&&(c=Ci(u[o],p.opts)),r=0,l=h.length;l>r;r++)s=h[r],s="cell"===e?n(u[o],s.row,s.column,o,r):n(u[o],s,o,r,c),s!==i&&d.push(s);return d.length?(t=new Ge(u,t?d.concat.apply([],d):d),e=t.selector,e.rows=p.rows,e.cols=p.cols,e.opts=p.opts,t):this},lastIndexOf:vi.lastIndexOf||function(){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(t){var e=[];if(vi.map)e=vi.map.call(this,t,this);else for(var i=0,n=this.length;n>i;i++)e.push(t.call(this,this[i],i));return new Ge(this.context,e)},pluck:function(t){return this.map(function(e){return e[t]})},pop:vi.pop,push:vi.push,reduce:vi.reduce||function(t,e){return h(this,t,e,0,this.length,1)},reduceRight:vi.reduceRight||function(t,e){return h(this,t,e,this.length-1,-1,-1)},reverse:vi.reverse,selector:null,shift:vi.shift,sort:vi.sort,splice:vi.splice,toArray:function(){return vi.slice.call(this)},to$:function(){return n(this)},toJQuery:function(){return n(this)},unique:function(){return new Ge(this.context,ci(this))},unshift:vi.unshift},Ge.extend=function(t,e,i){if(e&&(e instanceof Ge||e.__dt_wrapper)){var s,o,a,r=function(e,i){return function(){var n=e.apply(t,arguments);return Ge.extend(n,n,i.methodExt),n}};for(s=0,o=i.length;o>s;s++)a=i[s],e[a.name]="function"==typeof a.val?r(a.val,a):n.isPlainObject(a.val)?{}:a.val,e[a.name].__dt_wrapper=!0,Ge.extend(t,e[a.name],a.propExt)}},Ge.register=qe=function(t,e){if(n.isArray(t))for(var i=0,s=t.length;s>i;i++)Ge.register(t[i],e);else{for(var o,a,r=t.split("."),l=gi,i=0,s=r.length;s>i;i++){o=(a=-1!==r[i].indexOf("()"))?r[i].replace("()",""):r[i];var c;t:{c=0;for(var h=l.length;h>c;c++)if(l[c].name===o){c=l[c];break t}c=null}c||(c={name:o,val:{},methodExt:[],propExt:[]},l.push(c)),i===s-1?c.val=e:l=a?c.methodExt:c.propExt}Ge.ready&&$e.api.build()}},Ge.registerPlural=Ye=function(t,e,s){Ge.register(t,s),Ge.register(e,function(){var t=s.apply(this,arguments);return t===this?this:t instanceof Ge?t.length?n.isArray(t[0])?new Ge(t.context,t[0]):t[0]:i:t})},qe("tables()",function(t){var e;if(t){e=Ge;var i=this.context;if("number"==typeof t)t=[i[t]];else var s=n.map(i,function(t){return t.nTable}),t=n(s).filter(t).map(function(){var t=n.inArray(this,s);return i[t]}).toArray();e=new e(t)}else e=this;return e}),qe("table()",function(t){var t=this.tables(t),e=t.context;return e.length?new Ge(e[0]):t}),Ye("tables().nodes()","table().node()",function(){return this.iterator("table",function(t){return t.nTable})}),Ye("tables().body()","table().body()",function(){return this.iterator("table",function(t){return t.nTBody})}),Ye("tables().header()","table().header()",function(){return this.iterator("table",function(t){return t.nTHead})}),Ye("tables().footer()","table().footer()",function(){return this.iterator("table",function(t){return t.nTFoot})}),qe("draw()",function(t){return this.iterator("table",function(e){N(e,!1===t)})}),qe("page()",function(t){return t===i?this.page.info().page:this.iterator("table",function(e){le(e,t)})}),qe("page.info()",function(){if(0===this.context.length)return i;var t=this.context[0],e=t._iDisplayStart,n=t._iDisplayLength,s=t.fnRecordsDisplay(),o=-1===n;return{page:o?0:Math.floor(e/n),pages:o?1:Math.ceil(s/n),start:e,end:t.fnDisplayEnd(),length:n,recordsTotal:t.fnRecordsTotal(),recordsDisplay:s}}),qe("page.len()",function(t){return t===i?0!==this.context.length?this.context[0]._iDisplayLength:i:this.iterator("table",function(e){oe(e,t)})});var bi=function(t,e,i){if("ssp"==Ue(t)?N(t,e):(he(t,!0),z(t,[],function(i){M(t);for(var i=W(t,i),n=0,s=i.length;s>n;n++)y(t,i[n]);N(t,e),he(t,!1)})),i){var n=new Ge(t);n.one("draw",function(){i(n.ajax.json())})}};qe("ajax.json()",function(){var t=this.context;return 0<t.length?t[0].json:void 0}),qe("ajax.params()",function(){var t=this.context;return 0<t.length?t[0].oAjaxData:void 0}),qe("ajax.reload()",function(t,e){return this.iterator("table",function(i){bi(i,!1===e,t)})}),qe("ajax.url()",function(t){var e=this.context;return t===i?0===e.length?i:(e=e[0],e.ajax?n.isPlainObject(e.ajax)?e.ajax.url:e.ajax:e.sAjaxSource):this.iterator("table",function(e){n.isPlainObject(e.ajax)?e.ajax.url=t:e.ajax=t})}),qe("ajax.url().load()",function(t,e){return this.iterator("table",function(i){bi(i,!1===e,t)})});var yi=function(t,e){var s,o,a,r,l,c,h=[];for(t&&"string"!=typeof t&&t.length!==i||(t=[t]),a=0,r=t.length;r>a;a++)for(o=t[a]&&t[a].split?t[a].split(","):[t[a]],l=0,c=o.length;c>l;l++)(s=e("string"==typeof o[l]?n.trim(o[l]):o[l]))&&s.length&&h.push.apply(h,s);return h},wi=function(t){return t||(t={}),t.filter&&!t.search&&(t.search=t.filter),{search:t.search||"none",order:t.order||"current",page:t.page||"all"}},xi=function(t){for(var e=0,i=t.length;i>e;e++)if(0<t[e].length)return t[0]=t[e],t.length=1,t.context=[t.context[e]],t;return t.length=0,t},Ci=function(t,e){var i,s,o,a=[],r=t.aiDisplay;i=t.aiDisplayMaster;var l=e.search;if(s=e.order,o=e.page,"ssp"==Ue(t))return"removed"===l?[]:li(0,i.length);if("current"==o)for(i=t._iDisplayStart,s=t.fnDisplayEnd();s>i;i++)a.push(r[i]);else if("current"==s||"applied"==s)a="none"==l?i.slice():"applied"==l?r.slice():n.map(i,function(t){return-1===n.inArray(t,r)?t:null});else if("index"==s||"original"==s)for(i=0,s=t.aoData.length;s>i;i++)"none"==l?a.push(i):(o=n.inArray(i,r),(-1===o&&"removed"==l||1===o&&"applied"==l)&&a.push(i));return a};qe("rows()",function(t,e){t===i?t="":n.isPlainObject(t)&&(e=t,t="");var e=wi(e),s=this.iterator("table",function(i){var s=e;return yi(t,function(t){var e=ii(t);if(null!==e&&!s)return[e];var o=Ci(i,s);if(null!==e&&-1!==n.inArray(e,o))return[e];if(!t)return o;for(var e=[],a=0,r=o.length;r>a;a++)e.push(i.aoData[o[a]].nTr);return t.nodeName&&-1!==n.inArray(t,e)?[t._DT_RowIndex]:n(e).filter(t).map(function(){return this._DT_RowIndex}).toArray()})});return s.selector.rows=t,s.selector.opts=e,s}),qe("rows().nodes()",function(){return this.iterator("row",function(t,e){return t.aoData[e].nTr||i})}),qe("rows().data()",function(){return this.iterator(!0,"rows",function(t,e){return ri(t.aoData,e,"_aData")})}),Ye("rows().cache()","row().cache()",function(t){return this.iterator("row",function(e,i){var n=e.aoData[i];return"search"===t?n._aFilterData:n._aSortData})}),Ye("rows().invalidate()","row().invalidate()",function(t){return this.iterator("row",function(e,i){D(e,i,t)})}),Ye("rows().indexes()","row().index()",function(){return this.iterator("row",function(t,e){return e})}),Ye("rows().remove()","row().remove()",function(){var t=this;return this.iterator("row",function(e,i,s){var o=e.aoData;o.splice(i,1);for(var a=0,r=o.length;r>a;a++)null!==o[a].nTr&&(o[a].nTr._DT_RowIndex=a);n.inArray(i,e.aiDisplay),k(e.aiDisplayMaster,i),k(e.aiDisplay,i),k(t[s],i,!1),Fe(e)})}),qe("rows.add()",function(t){var e=this.iterator("table",function(e){var i,n,s,o=[];for(n=0,s=t.length;s>n;n++)i=t[n],i.nodeName&&"TR"===i.nodeName.toUpperCase()?o.push(w(e,i)[0]):o.push(y(e,i));return o}),i=this.rows(-1);return i.pop(),i.push.apply(i,e.toArray()),i}),qe("row()",function(t,e){return xi(this.rows(t,e))}),qe("row().data()",function(t){var e=this.context;return t===i?e.length&&this.length?e[0].aoData[this[0]]._aData:i:(e[0].aoData[this[0]]._aData=t,D(e[0],this[0],"data"),this)}),qe("row().node()",function(){var t=this.context;return t.length&&this.length?t[0].aoData[this[0]].nTr||null:null}),qe("row.add()",function(t){t instanceof n&&t.length&&(t=t[0]);var e=this.iterator("table",function(e){return t.nodeName&&"TR"===t.nodeName.toUpperCase()?w(e,t)[0]:y(e,t)});return this.row(e[0])});var Si=function(t){var e=this.context;if(e.length&&this.length){var i=e[0].aoData[this[0]];if(i._details){(i._detailsShow=t)?i._details.insertAfter(i.nTr):i._details.remove();var n=e[0],s=new Ge(n);s.off("draw.dt.DT_details column-visibility.dt.DT_details"),0<ai(n.aoData,"_details").length&&(s.on("draw.dt.DT_details",function(){s.rows({page:"current"}).eq(0).each(function(t){t=n.aoData[t],t._detailsShow&&t._details.insertAfter(t.nTr)})}),s.on("column-visibility.dt.DT_details",function(t,e){for(var i,n=g(e),s=0,o=e.aoData.length;o>s;s++)i=e.aoData[s],i._details&&i._details.children("td[colspan]").attr("colspan",n)}))}}return this};qe("row().child()",function(t,e){var s=this.context;if(t===i)return s.length&&this.length?s[0].aoData[this[0]]._details:i;if(s.length&&this.length){var o=s[0],s=s[0].aoData[this[0]],a=[],r=function(t,e){if(t.nodeName&&"tr"===t.nodeName.toLowerCase())a.push(t);else{var i=n("<tr><td/></tr>");n("td",i).addClass(e).html(t)[0].colSpan=g(o),a.push(i[0])}};if(n.isArray(t)||t instanceof n)for(var l=0,c=t.length;c>l;l++)r(t[l],e);else r(t,e);s._details&&s._details.remove(),s._details=n(a),s._detailsShow&&s._details.insertAfter(s.nTr)}return this}),qe(["row().child.show()","row().child().show()"],function(){return Si.call(this,!0),this}),qe(["row().child.hide()","row().child().hide()"],function(){return Si.call(this,!1),this}),qe("row().child.isShown()",function(){var t=this.context;return t.length&&this.length?t[0].aoData[this[0]]._detailsShow||!1:!1});var Ti=/^(.*):(name|visIdx|visible)$/;qe("columns()",function(t,e){t===i?t="":n.isPlainObject(t)&&(e=t,t="");var e=wi(e),s=this.iterator("table",function(e){var i=t,s=e.aoColumns,o=ai(s,"sName"),a=ai(s,"nTh");return yi(i,function(t){var i=ii(t);if(""===t)return li(s.length);if(null!==i)return[i>=0?i:s.length+i];var r="string"==typeof t?t.match(Ti):"";if(!r)return n(a).filter(t).map(function(){return n.inArray(this,a)}).toArray();switch(r[2]){case"visIdx":case"visible":return t=parseInt(r[1],10),0>t?(i=n.map(s,function(t,e){return t.bVisible?e:null}),[i[i.length+t]]):[m(e,t)];case"name":return n.map(o,function(t,e){return t===r[1]?e:null})}})});return s.selector.cols=t,s.selector.opts=e,s}),Ye("columns().header()","column().header()",function(){return this.iterator("column",function(t,e){return t.aoColumns[e].nTh})}),Ye("columns().footer()","column().footer()",function(){return this.iterator("column",function(t,e){return t.aoColumns[e].nTf})}),Ye("columns().data()","column().data()",function(){return this.iterator("column-rows",function(t,e,i,n,s){for(var i=[],n=0,o=s.length;o>n;n++)i.push(x(t,s[n],e,""));return i})}),Ye("columns().cache()","column().cache()",function(t){return this.iterator("column-rows",function(e,i,n,s,o){return ri(e.aoData,o,"search"===t?"_aFilterData":"_aSortData",i)})}),Ye("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(t,e,i,n,s){return ri(t.aoData,s,"anCells",e)})}),Ye("columns().visible()","column().visible()",function(t){return this.iterator("column",function(e,s){var o;if(t===i)o=e.aoColumns[s].bVisible;else{var a=e.aoColumns;o=a[s];var r,l,c,h=e.aoData;if(t===i)o=o.bVisible;else{if(o.bVisible!==t){if(t){var d=n.inArray(!0,ai(a,"bVisible"),s+1);for(r=0,l=h.length;l>r;r++)c=h[r].nTr,a=h[r].anCells,c&&c.insertBefore(a[s],a[d]||null)}else n(ai(e.aoData,"anCells",s)).detach(),o.bVisible=!1,O(e,e.aoHeader),O(e,e.aoFooter),ke(e);o.bVisible=t,O(e,e.aoHeader),O(e,e.aoFooter),p(e),(e.oScroll.sX||e.oScroll.sY)&&ue(e),Ne(e,null,"column-visibility",[e,s,t]),ke(e)}o=void 0}}return o})}),Ye("columns().indexes()","column().index()",function(t){return this.iterator("column",function(e,i){return"visible"===t?f(e,i):i})}),qe("columns.adjust()",function(){return this.iterator("table",function(t){p(t)})}),qe("column.index()",function(t,e){if(0!==this.context.length){var i=this.context[0];if("fromVisible"===t||"toData"===t)return m(i,e);if("fromData"===t||"toVisible"===t)return f(i,e)}}),qe("column()",function(t,e){return xi(this.columns(t,e))}),qe("cells()",function(t,e,s){if(n.isPlainObject(t)&&(t.row?(s=e,e=null):(s=t,t=null)),n.isPlainObject(e)&&(s=e,e=null),null===e||e===i)return this.iterator("table",function(e){var i,o,a,r,l,c=t,h=wi(s),d=e.aoData,u=Ci(e,h),h=ri(d,u,"anCells"),p=n([].concat.apply([],h)),m=e.aoColumns.length;return yi(c,function(t){if(!t){for(o=[],a=0,r=u.length;r>a;a++)for(i=u[a],l=0;m>l;l++)o.push({row:i,column:l});return o}return n.isPlainObject(t)?[t]:p.filter(t).map(function(t,e){return i=e.parentNode._DT_RowIndex,{row:i,column:n.inArray(e,d[i].anCells)}}).toArray()})});var o,a,r,l,c,h=this.columns(e,s),d=this.rows(t,s),u=this.iterator("table",function(t,e){for(o=[],a=0,r=d[e].length;r>a;a++)for(l=0,c=h[e].length;c>l;l++)o.push({row:d[e][a],column:h[e][l]});return o});return n.extend(u.selector,{cols:e,rows:t,opts:s}),u}),Ye("cells().nodes()","cell().node()",function(){return this.iterator("cell",function(t,e,i){return t.aoData[e].anCells[i]})}),qe("cells().data()",function(){return this.iterator("cell",function(t,e,i){return x(t,e,i)})}),Ye("cells().cache()","cell().cache()",function(t){return t="search"===t?"_aFilterData":"_aSortData",this.iterator("cell",function(e,i,n){return e.aoData[i][t][n]})}),Ye("cells().indexes()","cell().index()",function(){return this.iterator("cell",function(t,e,i){return{row:e,column:i,columnVisible:f(t,i)}})}),qe(["cells().invalidate()","cell().invalidate()"],function(t){var e=this.selector;return this.rows(e.rows,e.opts).invalidate(t),this}),qe("cell()",function(t,e,i){return xi(this.cells(t,e,i))}),qe("cell().data()",function(t){var e=this.context,n=this[0];return t===i?e.length&&n.length?x(e[0],n[0].row,n[0].column):i:(C(e[0],n[0].row,n[0].column,t),D(e[0],n[0].row,"data",n[0].column),this)}),qe("order()",function(t,e){var s=this.context;return t===i?0!==s.length?s[0].aaSorting:i:("number"==typeof t?t=[[t,e]]:n.isArray(t[0])||(t=Array.prototype.slice.call(arguments)),this.iterator("table",function(e){e.aaSorting=t.slice()}))}),qe("order.listener()",function(t,e,i){return this.iterator("table",function(n){Ae(n,t,e,i)})}),qe(["columns().order()","column().order()"],function(t){var e=this;return this.iterator("table",function(i,s){var o=[];n.each(e[s],function(e,i){o.push([i,t])}),i.aaSorting=o})}),qe("search()",function(t,e,s,o){var a=this.context;return t===i?0!==a.length?a[0].oPreviousSearch.sSearch:i:this.iterator("table",function(i){i.oFeatures.bFilter&&q(i,n.extend({},i.oPreviousSearch,{sSearch:t+"",bRegex:null===e?!1:e,bSmart:null===s?!0:s,bCaseInsensitive:null===o?!0:o}),1)})}),qe(["columns().search()","column().search()"],function(t,e,s,o){return this.iterator("column",function(a,r){var l=a.aoPreSearchCols;return t===i?l[r].sSearch:(a.oFeatures.bFilter&&(n.extend(l[r],{sSearch:t+"",bRegex:null===e?!1:e,bSmart:null===s?!0:s,bCaseInsensitive:null===o?!0:o}),q(a,a.oPreviousSearch,1)),void 0)})}),$e.versionCheck=$e.fnVersionCheck=function(t){for(var e,i,n=$e.version.split("."),t=t.split("."),s=0,o=t.length;o>s;s++)if(e=parseInt(n[s],10)||0,i=parseInt(t[s],10)||0,e!==i)return e>i;return!0},$e.isDataTable=$e.fnIsDataTable=function(t){var e=n(t).get(0),i=!1;return n.each($e.settings,function(t,n){(n.nTable===e||n.nScrollHead===e||n.nScrollFoot===e)&&(i=!0)}),i},$e.tables=$e.fnTables=function(t){return jQuery.map($e.settings,function(e){return!t||t&&n(e.nTable).is(":visible")?e.nTable:void 0})},$e.camelToHungarian=o,qe("$()",function(t,e){var i=this.rows(e).nodes(),i=n(i);return n([].concat(i.filter(t).toArray(),i.find(t).toArray()))}),n.each(["on","one","off"],function(t,e){qe(e+"()",function(){var t=Array.prototype.slice.call(arguments);-1===t[0].indexOf(".dt")&&(t[0]+=".dt");var i=n(this.tables().nodes());return i[e].apply(i,t),this})}),qe("clear()",function(){return this.iterator("table",function(t){M(t)})}),qe("settings()",function(){return new Ge(this.context,this.context)}),qe("data()",function(){return this.iterator("table",function(t){return ai(t.aoData,"_aData")}).flatten()}),qe("destroy()",function(e){return e=e||!1,this.iterator("table",function(i){var s,o=i.nTableWrapper.parentNode,a=i.oClasses,r=i.nTable,l=i.nTBody,c=i.nTHead,h=i.nTFoot,d=n(r),l=n(l),u=n(i.nTableWrapper),p=n.map(i.aoData,function(t){return t.nTr});i.bDestroying=!0,Ne(i,"aoDestroyCallback","destroy",[i]),e||new Ge(i).columns().visible(!0),u.unbind(".DT").find(":not(tbody *)").unbind(".DT"),n(t).unbind(".DT-"+i.sInstance),r!=c.parentNode&&(d.children("thead").detach(),d.append(c)),h&&r!=h.parentNode&&(d.children("tfoot").detach(),d.append(h)),d.detach(),u.detach(),i.aaSorting=[],i.aaSortingFixed=[],Le(i),n(p).removeClass(i.asStripeClasses.join(" ")),n("th, td",c).removeClass(a.sSortable+" "+a.sSortableAsc+" "+a.sSortableDesc+" "+a.sSortableNone),i.bJUI&&(n("th span."+a.sSortIcon+", td span."+a.sSortIcon,c).detach(),n("th, td",c).each(function(){var t=n("div."+a.sSortJUIWrapper,this);n(this).append(t.contents()),t.detach()})),!e&&o&&o.insertBefore(r,i.nTableReinsertBefore),l.children().detach(),l.append(p),d.css("width",i.sDestroyWidth).removeClass(a.sTable),(s=i.asDestroyStripes.length)&&l.children().each(function(t){n(this).addClass(i.asDestroyStripes[t%s])}),o=n.inArray(i,$e.settings),-1!==o&&$e.settings.splice(o,1)})}),$e.version="1.10.0",$e.settings=[],$e.models={},$e.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0},$e.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null},$e.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null},$e.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(t){try{return JSON.parse((-1===t.iStateDuration?sessionStorage:localStorage).getItem("DataTables_"+t.sInstance+"_"+location.pathname))}catch(e){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(t,e){try{(-1===t.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+t.sInstance+"_"+location.pathname,JSON.stringify(e))}catch(i){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sUrl:"",sZeroRecords:"No matching records found"},oSearch:n.extend({},$e.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null},s($e.defaults),$e.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null},s($e.defaults.column),$e.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:i,oAjaxData:i,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return"ssp"==Ue(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length
},fnRecordsDisplay:function(){return"ssp"==Ue(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var t=this._iDisplayLength,e=this._iDisplayStart,i=e+t,n=this.aiDisplay.length,s=this.oFeatures,o=s.bPaginate;return s.bServerSide?!1===o||-1===t?e+n:Math.min(e+t,this._iRecordsDisplay):!o||i>n||-1===t?n:i},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{}},$e.ext=We={classes:{},errMode:"alert",feature:[],search:[],internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:$e.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:$e.version},n.extend(We,{afnFiltering:We.search,aTypes:We.type.detect,ofnSearch:We.type.search,oSort:We.type.order,afnSortData:We.order,aoFeatures:We.feature,oApi:We.internal,oStdClasses:We.classes,oPagination:We.pager}),n.extend($e.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});var Ai="",Ai="",Li=Ai+"ui-state-default",Mi=Ai+"css_right ui-icon ui-icon-",ki=Ai+"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix";n.extend($e.ext.oJUIClasses,$e.ext.classes,{sPageButton:"fg-button ui-button "+Li,sPageButtonActive:"ui-state-disabled",sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sSortAsc:Li+" sorting_asc",sSortDesc:Li+" sorting_desc",sSortable:Li+" sorting",sSortableAsc:Li+" sorting_asc_disabled",sSortableDesc:Li+" sorting_desc_disabled",sSortableNone:Li+" sorting_disabled",sSortJUIAsc:Mi+"triangle-1-n",sSortJUIDesc:Mi+"triangle-1-s",sSortJUI:Mi+"carat-2-n-s",sSortJUIAscAllowed:Mi+"carat-1-n",sSortJUIDescAllowed:Mi+"carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead "+Li,sScrollFoot:"dataTables_scrollFoot "+Li,sHeaderTH:Li,sFooterTH:Li,sJUIHeader:ki+" ui-corner-tl ui-corner-tr",sJUIFooter:ki+" ui-corner-bl ui-corner-br"});var Di=$e.ext.pager;n.extend(Di,{simple:function(){return["previous","next"]},full:function(){return["first","previous","next","last"]},simple_numbers:function(t,e){return["previous",ze(t,e),"next"]},full_numbers:function(t,e){return["first","previous",ze(t,e),"next","last"]},_numbers:ze,numbers_length:7}),n.extend(!0,$e.ext.renderer,{pageButton:{_:function(t,i,s,o,a,r){var l,c,h=t.oClasses,d=t.oLanguage.oPaginate,u=0,p=function(e,i){var o,m,f,g,v=function(e){le(t,e.data.action,!0)};for(o=0,m=i.length;m>o;o++)if(g=i[o],n.isArray(g))f=n("<"+(g.DT_el||"div")+"/>").appendTo(e),p(f,g);else{switch(c=l="",g){case"ellipsis":e.append("<span>&hellip;</span>");break;case"first":l=d.sFirst,c=g+(a>0?"":" "+h.sPageButtonDisabled);break;case"previous":l=d.sPrevious,c=g+(a>0?"":" "+h.sPageButtonDisabled);break;case"next":l=d.sNext,c=g+(r-1>a?"":" "+h.sPageButtonDisabled);break;case"last":l=d.sLast,c=g+(r-1>a?"":" "+h.sPageButtonDisabled);break;default:l=g+1,c=a===g?h.sPageButtonActive:""}l&&(f=n("<a>",{"class":h.sPageButton+" "+c,"aria-controls":t.sTableId,"data-dt-idx":u,tabindex:t.iTabIndex,id:0===s&&"string"==typeof g?t.sTableId+"_"+g:null}).html(l).appendTo(e),Oe(f,{action:g},v),u++)}},m=n(e.activeElement).data("dt-idx");p(n(i).empty(),o),null!==m&&n(i).find("[data-dt-idx="+m+"]").focus()}}});var Ii=function(t,e,i,n){return t&&"-"!==t?(e&&(t=ni(t,e)),t.replace&&(i&&(t=t.replace(i,"")),n&&(t=t.replace(n,""))),1*t):-1/0};return n.extend(We.type.order,{"date-pre":function(t){return Date.parse(t)||0},"html-pre":function(t){return t?t.replace?t.replace(/<.*?>/g,"").toLowerCase():t+"":""},"string-pre":function(t){return"string"==typeof t?t.toLowerCase():t&&t.toString?t.toString():""},"string-asc":function(t,e){return e>t?-1:t>e?1:0},"string-desc":function(t,e){return e>t?1:t>e?-1:0}}),Ve(""),n.extend($e.ext.type.detect,[function(t,e){var i=e.oLanguage.sDecimal;return si(t,i)?"num"+i:null},function(t){if(t&&!Je.test(t))return null;var e=Date.parse(t);return null!==e&&!isNaN(e)||ei(t)?"date":null},function(t,e){var i=e.oLanguage.sDecimal;return si(t,i,!0)?"num-fmt"+i:null},function(t,e){var i=e.oLanguage.sDecimal;return oi(t,i)?"html-num"+i:null},function(t,e){var i=e.oLanguage.sDecimal;return oi(t,i,!0)?"html-num-fmt"+i:null},function(t){return ei(t)||"string"==typeof t&&-1!==t.indexOf("<")?"html":null}]),n.extend($e.ext.type.search,{html:function(t){return ei(t)?"":"string"==typeof t?t.replace(Xe," ").replace(Ke,""):""},string:function(t){return ei(t)?"":"string"==typeof t?t.replace(Xe," "):t}}),n.extend(!0,$e.ext.renderer,{header:{_:function(t,e,i,s){n(t.nTable).on("order.dt.DT",function(t,n,o,a){t=i.idx,e.removeClass(i.sSortingClass+" "+s.sSortAsc+" "+s.sSortDesc).addClass("asc"==a[t]?s.sSortAsc:"desc"==a[t]?s.sSortDesc:i.sSortingClass)})},jqueryui:function(t,e,i,s){var o=i.idx;n("<div/>").addClass(s.sSortJUIWrapper).append(e.contents()).append(n("<span/>").addClass(s.sSortIcon+" "+i.sSortingClassJUI)).appendTo(e),n(t.nTable).on("order.dt.DT",function(t,n,a,r){e.removeClass(s.sSortAsc+" "+s.sSortDesc).addClass("asc"==r[o]?s.sSortAsc:"desc"==r[o]?s.sSortDesc:i.sSortingClass),e.find("span."+s.sSortIcon).removeClass(s.sSortJUIAsc+" "+s.sSortJUIDesc+" "+s.sSortJUI+" "+s.sSortJUIAscAllowed+" "+s.sSortJUIDescAllowed).addClass("asc"==r[o]?s.sSortJUIAsc:"desc"==r[o]?s.sSortJUIDesc:i.sSortingClassJUI)})}}}),$e.render={number:function(t,e,i,n){return{display:function(s){var s=parseFloat(s),o=parseInt(s,10),s=i?(e+(s-o).toFixed(i)).substring(2):"";return(n||"")+o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,t)+s}}}},n.extend($e.ext.internal,{_fnExternApiFunc:He,_fnBuildAjax:z,_fnAjaxUpdate:V,_fnAjaxParameters:H,_fnAjaxUpdateDraw:$,_fnAjaxDataSrc:W,_fnAddColumn:d,_fnColumnOptions:u,_fnAdjustColumnSizing:p,_fnVisibleToColumnIndex:m,_fnColumnIndexToVisible:f,_fnVisbleColumns:g,_fnGetColumns:v,_fnColumnTypes:_,_fnApplyColumnDefs:b,_fnHungarianMap:s,_fnCamelToHungarian:o,_fnLanguageCompat:a,_fnBrowserDetect:c,_fnAddData:y,_fnAddTr:w,_fnNodeToDataIndex:function(t,e){return e._DT_RowIndex!==i?e._DT_RowIndex:null},_fnNodeToColumnIndex:function(t,e,i){return n.inArray(i,t.aoData[e].anCells)},_fnGetCellData:x,_fnSetCellData:C,_fnSplitObjNotation:S,_fnGetObjectDataFn:T,_fnSetObjectDataFn:A,_fnGetDataMaster:L,_fnClearTable:M,_fnDeleteIndex:k,_fnInvalidateRow:D,_fnGetRowElements:I,_fnCreateTr:P,_fnBuildHead:E,_fnDrawHead:O,_fnDraw:j,_fnReDraw:N,_fnAddOptionsHtml:F,_fnDetectHeader:B,_fnGetUniqueThs:U,_fnFeatureHtmlFilter:G,_fnFilterComplete:q,_fnFilterCustom:Y,_fnFilterColumn:Z,_fnFilter:X,_fnFilterCreateSearch:K,_fnEscapeRegex:J,_fnFilterData:Q,_fnFeatureHtmlInfo:te,_fnUpdateInfo:ee,_fnInfoMacros:ie,_fnInitialise:ne,_fnInitComplete:se,_fnLengthChange:oe,_fnFeatureHtmlLength:ae,_fnFeatureHtmlPaginate:re,_fnPageChange:le,_fnFeatureHtmlProcessing:ce,_fnProcessingDisplay:he,_fnFeatureHtmlTable:de,_fnScrollDraw:ue,_fnApplyToChildren:pe,_fnCalculateColumnWidths:me,_fnThrottle:fe,_fnConvertToWidth:ge,_fnScrollingWidthAdjust:ve,_fnGetWidestNode:_e,_fnGetMaxLenString:be,_fnStringToCss:ye,_fnScrollBarWidth:we,_fnSortFlatten:xe,_fnSort:Ce,_fnSortAria:Se,_fnSortListener:Te,_fnSortAttachListener:Ae,_fnSortingClasses:Le,_fnSortData:Me,_fnSaveState:ke,_fnLoadState:De,_fnSettingsFromNode:Ie,_fnLog:Pe,_fnMap:Re,_fnBindAction:Oe,_fnCallbackReg:je,_fnCallbackFire:Ne,_fnLengthOverflow:Fe,_fnRenderer:Be,_fnDataSource:Ue,_fnRowAttributes:R,_fnCalculateEnd:function(){}}),n.fn.dataTable=$e,n.fn.dataTableSettings=$e.settings,n.fn.dataTableExt=$e.ext,n.fn.DataTable=function(t){return n(this).dataTable(t).api()},n.each($e,function(t,e){n.fn.DataTable[t]=e}),n.fn.dataTable};"function"==typeof define&&define.amd?define("datatables",["jquery"],n):"object"==typeof exports?n(require("jquery")):jQuery&&!jQuery.fn.dataTable&&n(jQuery)}(window,document),function(t,e,i){var n=function(n){var s=function(t,i){!this instanceof s?alert("Scroller warning: Scroller must be initialised with the 'new' keyword."):("undefined"==typeof i&&(i={}),this.s={dt:t,tableTop:0,tableBottom:0,redrawTop:0,redrawBottom:0,autoHeight:!0,viewportRows:0,stateTO:null,drawTO:null,heights:{jump:null,page:null,virtual:null,scroll:null,row:null,viewport:null},topRowFloat:0,scrollDrawDiff:null},this.s=n.extend(this.s,s.oDefaults,i),this.s.heights.row=this.s.rowHeight,this.dom={force:e.createElement("div"),scroller:null,table:null},this.s.dt.oScroller=this,this._fnConstruct())};if(s.prototype={fnRowToPixels:function(t,e,n){return t=n?this._domain("virtualToPhysical",t*this.s.heights.row):this.s.baseScrollTop+(t-this.s.baseRowTop)*this.s.heights.row,e||e===i?parseInt(t,10):t},fnPixelsToRow:function(t,e,n){var s=t-this.s.baseScrollTop,t=n?this._domain("physicalToVirtual",t)/this.s.heights.row:s/this.s.heights.row+this.s.baseRowTop;return e||e===i?parseInt(t,10):t},fnScrollToRow:function(t,e){var i=this,s=!1,o=this.fnRowToPixels(t),a=t-(this.s.displayBuffer-1)/2*this.s.viewportRows;0>a&&(a=0),(o>this.s.redrawBottom||o<this.s.redrawTop)&&this.s.dt._iDisplayStart!==a&&(s=!0,o=this.fnRowToPixels(t,!1,!0)),"undefined"==typeof e||e?(this.s.ani=s,n(this.dom.scroller).animate({scrollTop:o},function(){setTimeout(function(){i.s.ani=!1},0)})):n(this.dom.scroller).scrollTop(o)},fnMeasure:function(t){this.s.autoHeight&&this._fnCalcRowHeight();var e=this.s.heights;e.viewport=n(this.dom.scroller).height(),this.s.viewportRows=parseInt(e.viewport/e.row,10)+1,this.s.dt._iDisplayLength=this.s.viewportRows*this.s.displayBuffer,("undefined"==typeof t||t)&&this.s.dt.oInstance.fnDraw()},_fnConstruct:function(){var e=this;if(this.s.dt.oFeatures.bPaginate){this.dom.force.style.position="absolute",this.dom.force.style.top="0px",this.dom.force.style.left="0px",this.dom.force.style.width="1px",this.dom.scroller=n("div."+this.s.dt.oClasses.sScrollBody,this.s.dt.nTableWrapper)[0],this.dom.scroller.appendChild(this.dom.force),this.dom.scroller.style.position="relative",this.dom.table=n(">table",this.dom.scroller)[0],this.dom.table.style.position="absolute",this.dom.table.style.top="0px",this.dom.table.style.left="0px",n(this.s.dt.nTableWrapper).addClass("DTS"),this.s.loadingIndicator&&n(this.dom.scroller.parentNode).css("position","relative").append('<div class="DTS_Loading">'+this.s.dt.oLanguage.sLoadingRecords+"</div>"),this.s.heights.row&&"auto"!=this.s.heights.row&&(this.s.autoHeight=!1),this.fnMeasure(!1),n(this.dom.scroller).on("scroll.DTS",function(){e._fnScroll.call(e)}),n(this.dom.scroller).on("touchstart.DTS",function(){e._fnScroll.call(e)}),this.s.dt.aoDrawCallback.push({fn:function(){e.s.dt.bInitialised&&e._fnDrawCallback.call(e)},sName:"Scroller"}),n(t).on("resize.DTS",function(){e._fnInfo()});var i=!0;this.s.dt.oApi._fnCallbackReg(this.s.dt,"aoStateSaveParams",function(t,n){i&&e.s.dt.oLoadedState?(n.iScroller=e.s.dt.oLoadedState.iScroller,i=!1):n.iScroller=e.dom.scroller.scrollTop},"Scroller_State"),this.s.dt.aoDestroyCallback.push({sName:"Scroller",fn:function(){n(t).off("resize.DTS"),n(e.dom.scroller).off("touchstart.DTS scroll.DTS"),n(e.s.dt.nTableWrapper).removeClass("DTS"),n("div.DTS_Loading",e.dom.scroller.parentNode).remove(),e.dom.table.style.position="",e.dom.table.style.top="",e.dom.table.style.left=""}})}else this.s.dt.oApi._fnLog(this.s.dt,0,"Pagination must be enabled for Scroller")},_fnScroll:function(){var t,e=this,i=this.s.heights,s=this.dom.scroller.scrollTop;if(!this.s.skip)if(this.s.dt.bFiltered||this.s.dt.bSorted)this.s.lastScrollTop=0;else{if(this._fnInfo(),clearTimeout(this.s.stateTO),this.s.stateTO=setTimeout(function(){e.s.dt.oApi._fnSaveState(e.s.dt)},250),s<this.s.redrawTop||s>this.s.redrawBottom){var o=Math.ceil((this.s.displayBuffer-1)/2*this.s.viewportRows);Math.abs(s-this.s.lastScrollTop)>i.viewport||this.s.ani?(t=parseInt(this._domain("physicalToVirtual",s)/i.row,10)-o,this.s.topRowFloat=this._domain("physicalToVirtual",s)/i.row):(t=this.fnPixelsToRow(s)-o,this.s.topRowFloat=this.fnPixelsToRow(s,!1)),0>=t?t=0:t+this.s.dt._iDisplayLength>this.s.dt.fnRecordsDisplay()?(t=this.s.dt.fnRecordsDisplay()-this.s.dt._iDisplayLength,0>t&&(t=0)):0!==t%2&&t++,t!=this.s.dt._iDisplayStart&&(this.s.tableTop=n(this.s.dt.nTable).offset().top,this.s.tableBottom=n(this.s.dt.nTable).height()+this.s.tableTop,i=function(){null===e.s.scrollDrawReq&&(e.s.scrollDrawReq=s),e.s.dt._iDisplayStart=t,e.s.dt.oApi._fnCalculateEnd&&e.s.dt.oApi._fnCalculateEnd(e.s.dt),e.s.dt.oApi._fnDraw(e.s.dt)},this.s.dt.oFeatures.bServerSide?(clearTimeout(this.s.drawTO),this.s.drawTO=setTimeout(i,this.s.serverWait)):i())}this.s.lastScrollTop=s}},_domain:function(t,e){var i,n=this.s.heights;if(n.virtual===n.scroll){if(i=(n.virtual-n.viewport)/(n.scroll-n.viewport),"virtualToPhysical"===t)return e/i;if("physicalToVirtual"===t)return e*i}var s=(n.scroll-n.viewport)/2,o=(n.virtual-n.viewport)/2;return i=o/(s*s),"virtualToPhysical"===t?o>e?Math.pow(e/i,.5):(e=2*o-e,0>e?n.scroll:2*s-Math.pow(e/i,.5)):"physicalToVirtual"===t?s>e?e*e*i:(e=2*s-e,0>e?n.virtual:2*o-e*e*i):void 0},_fnDrawCallback:function(){var t=this,e=this.s.heights,i=this.dom.scroller.scrollTop,s=n(this.s.dt.nTable).height(),o=this.s.dt._iDisplayStart,a=this.s.dt._iDisplayLength,r=this.s.dt.fnRecordsDisplay();this.s.skip=!0,this._fnScrollForce(),i=0===o?this.s.topRowFloat*e.row:o+a>=r?e.scroll-(r-this.s.topRowFloat)*e.row:this._domain("virtualToPhysical",this.s.topRowFloat*e.row),this.dom.scroller.scrollTop=i,this.s.baseScrollTop=i,this.s.baseRowTop=this.s.topRowFloat;var l=i-(this.s.topRowFloat-o)*e.row;0===o?l=0:o+a>=r&&(l=e.scroll-s),this.dom.table.style.top=l+"px",this.s.tableTop=l,this.s.tableBottom=s+this.s.tableTop,s=(i-this.s.tableTop)*this.s.boundaryScale,this.s.redrawTop=i-s,this.s.redrawBottom=i+s,this.s.skip=!1,setTimeout(function(){t._fnInfo.call(t)},0),this.s.dt.oFeatures.bStateSave&&null!==this.s.dt.oLoadedState&&"undefined"!=typeof this.s.dt.oLoadedState.iScroller&&((i=this.s.dt.sAjaxSource||t.s.dt.ajax?!0:!1)&&2==this.s.dt.iDraw||!i&&1==this.s.dt.iDraw)&&setTimeout(function(){n(t.dom.scroller).scrollTop(t.s.dt.oLoadedState.iScroller),t.s.redrawTop=t.s.dt.oLoadedState.iScroller-e.viewport/2},0)},_fnScrollForce:function(){var t=this.s.heights;t.virtual=t.row*this.s.dt.fnRecordsDisplay(),t.scroll=t.virtual,1e6<t.scroll&&(t.scroll=1e6),this.dom.force.style.height=t.scroll+"px"},_fnCalcRowHeight:function(){var t=this.s.dt.nTable,e=t.cloneNode(!1),i=n("<tbody/>").appendTo(e),s=n('<div class="'+this.s.dt.oClasses.sWrapper+' DTS"><div class="'+this.s.dt.oClasses.sScrollWrapper+'"><div class="'+this.s.dt.oClasses.sScrollBody+'"></div></div></div>');for(n("tbody tr:lt(4)",t).clone().appendTo(i);3>n("tr",i).length;)i.append("<tr><td>&nbsp;</td></tr>");n("div."+this.s.dt.oClasses.sScrollBody,s).append(e),s.appendTo(this.s.dt.nHolding),this.s.heights.row=n("tr",i).eq(1).outerHeight(),s.remove()},_fnInfo:function(){if(this.s.dt.oFeatures.bInfo){var t=this.s.dt,e=this.dom.scroller.scrollTop,i=Math.floor(this.fnPixelsToRow(e,!1,this.s.ani)+1),s=t.fnRecordsTotal(),o=t.fnRecordsDisplay(),e=Math.ceil(this.fnPixelsToRow(e+this.s.heights.viewport,!1,this.s.ani)),e=e>o?o:e,i=t.fnFormatNumber(i),e=t.fnFormatNumber(e),s=t.fnFormatNumber(s),o=t.fnFormatNumber(o),o=0===t.fnRecordsDisplay()&&t.fnRecordsDisplay()==t.fnRecordsTotal()?t.oLanguage.sInfoEmpty+t.oLanguage.sInfoPostFix:0===t.fnRecordsDisplay()?t.oLanguage.sInfoEmpty+" "+t.oLanguage.sInfoFiltered.replace("_MAX_",s)+t.oLanguage.sInfoPostFix:t.fnRecordsDisplay()==t.fnRecordsTotal()?t.oLanguage.sInfo.replace("_START_",i).replace("_END_",e).replace("_TOTAL_",o)+t.oLanguage.sInfoPostFix:t.oLanguage.sInfo.replace("_START_",i).replace("_END_",e).replace("_TOTAL_",o)+" "+t.oLanguage.sInfoFiltered.replace("_MAX_",t.fnFormatNumber(t.fnRecordsTotal()))+t.oLanguage.sInfoPostFix,t=t.aanFeatures.i;if("undefined"!=typeof t)for(s=0,i=t.length;i>s;s++)n(t[s]).html(o)}}},s.defaults={trace:!1,rowHeight:"auto",serverWait:200,displayBuffer:9,boundaryScale:.5,loadingIndicator:!1},s.oDefaults=s.defaults,s.version="1.2.1","function"==typeof n.fn.dataTable&&"function"==typeof n.fn.dataTableExt.fnVersionCheck&&n.fn.dataTableExt.fnVersionCheck("1.9.0")?n.fn.dataTableExt.aoFeatures.push({fnInit:function(t){var e=t.oInit;return new s(t,e.scroller||e.oScroller||{}).dom.wrapper},cFeature:"S",sFeature:"Scroller"}):alert("Warning: Scroller requires DataTables 1.9.0 or greater - www.datatables.net/download"),n.fn.dataTable.Scroller=s,n.fn.DataTable.Scroller=s,n.fn.dataTable.Api){var o=n.fn.dataTable.Api;o.register("scroller().rowToPixels()",function(t,e,i){var n=this.context;return n.length&&n[0].oScroller?n[0].oScroller.fnRowToPixels(t,e,i):void 0}),o.register("scroller().pixelsToRow()",function(t,e,i){var n=this.context;return n.length&&n[0].oScroller?n[0].oScroller.fnPixelsToRow(t,e,i):void 0}),o.register("scroller().scrollToRow()",function(t,e){return this.iterator("table",function(i){i.oScroller&&i.oScroller.fnScrollToRow(t,e)}),this}),o.register("scroller().measure()",function(t){return this.iterator("table",function(e){e.oScroller&&e.oScroller.fnMeasure(t)}),this})}return s};"function"==typeof define&&define.amd?define("datatables-scroller",["jquery","datatables"],n):jQuery&&!jQuery.fn.dataTable.Scroller&&n(jQuery,jQuery.fn.dataTable)}(window,document),define("colresize",["jquery","jqueryui","datatables"],function(t){return t.fn.dataTable.Api.register("columns().setWidth()",function(e){var i=this.context[0],n=i.aoColumns,s=new t.fn.dataTable.Api(i);for(var o in e){var a=n[o]||null;a&&(a.sWidthOrig=String(e[o]))}return s.columns.adjust().draw(!1),i.oInstance.trigger("colresize.dt",e),this}),t.widget("ui.colresize",{options:{selector:"th",minWidth:20},_create:function(){var e=this,i=this.options,n=this.element,s=n.find(i.selector).not(":last");s.each(function(){!function(o){o[0].style.position="relative";var a=t('<div class="colresize-handle"/>').appendTo(o);a.draggable({containment:n,axis:"x",start:function(){o.addClass("colresize-resized")},drag:function(t,e){e.position.left<i.minWidth?(a.addClass("colresize-fixed"),a[0].style.left=i.minWidth+"px"):a.removeClass("colresize-fixed")},stop:function(t,i){o.removeClass("colresize-resized"),a.removeClass("colresize-fixed"),a[0].style.left="auto",a[0].style.right=0,n.trigger("stop."+e.widgetName,{th:o,index:s.index(o),width:i.position.left,delta:i.position.left-i.originalPosition.left})}})}(t(this))})}}),{}}),define("abstracts/Group",["underscore","abstracts/Model"],function(t,e){var i=e.extend({constructor:function(){e.apply(this,arguments),this.groups=null,this.items=null},defaults:{nbItems:0,name:"",parentId:null},parse:function(t){return t.group||t}});return i}),define("geo",[],function(){var t={E2:.006739496742337,D_EXT:.08181979099211441,MerkElipsK:1e-7,E_LARGE_SEMIAXIS:6378137,E_LARGE_SEMIAXIS_RUS:6378245,EARTH_SEMIAXIS_S:6356752.314245,EARTH_SEMIAXIS_S_RUS:6356863,userLocation:null,getMeridianCurve:function(e){return t.E_LARGE_SEMIAXIS*(1-t.E2)/Math.pow(e,1.5)},getParallelCurve:function(e){return t.E_LARGE_SEMIAXIS/Math.sqrt(e)},getFz:function(t,e,i){var n=n||(t-e)*Math.D2R;return 2*Math.asin(Math.sqrt(Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.D2R)*Math.cos(t*Math.D2R)*Math.sin(i/2)*Math.sin(i/2)))},getDistanceBetweenPoints:function(e,i,n,s){var o=t;i=parseFloat(i),e=parseFloat(e),s=parseFloat(s),n=parseFloat(n);var a=0,r=0,l=0,c=0,h=0,d=0;a=(e+n)/2*Math.D2R;var u=Math.sin(a)*Math.sin(a),p=1-o.E2*u;if(0==p)return 0;r=o.getMeridianCurve(p),l=o.getParallelCurve(p),h=(e-n)*Math.D2R,c=(i-s)*Math.D2R;var m=o.getFz(e,n,c),f=Math.sin(m);if(0==f)return 0;d=Math.cos(n*Math.D2R)*Math.sin(c)/f;var g=Math.cos(Math.asin(d));return f=r*d*d+l*g*g,0==f?0:r*l*m/f},getDistanceBetweenPointsSimple:function(t,e,i,n){var s=6376554*Math.acos(Math.cos(t*Math.D2R)*Math.cos(i*Math.D2R)*Math.cos(n*Math.D2R-e*Math.D2R)+Math.sin(t*Math.D2R)*Math.sin(i*Math.D2R));return s},detectUserLocation:function(){try{var e=$.isFunction(arguments[0])?arguments[0]:null;navigator.geolocation.getCurrentPosition(function(i){t.userLocation=new t.Point({lat:i.coords.latitude,lon:i.coords.longitude}),e&&e(t.userLocation)})}catch(i){throw i}},getLonByStartAndDistance:function(e,i,n){if(0>=n)return i;i=parseFloat(i),e=parseFloat(e);var s=t,o=0,a=e,r=Math.sin(a)*Math.sin(a),l=1-s.E2*r,c=s.getParallelCurve(l);o=2*Math.PI*(n/(Math.PI*c));var h=parseFloat(i)+o/Math.D2R;return h>180&&(h-=360),h}};return t.Point=function(){this.lat=null,this.lon=null,arguments[0]&&"object"==typeof arguments[0]?(this.lat=arguments[0].lat,this.lon=arguments[0].lon):2==arguments.length&&(this.lat=arguments[0],this.lon=arguments[1]),this._view=null},t}),define("maps/GeoMap",["jquery","geo","i18n!_common/nls/common"],function(t,e,i){function n(){if(this.zoom=0,this.center={lat:0,lon:0},this._protocol="http"+(App.isHttpsClient()?"s":"")+"://",this._nbTiles=1,this._size=n.TILE_SIZE,this._useCache=!1,this._kLon=null,this._kLat=[],this._kDist=[],this.scode="YDX",this._geocoding=!1,this._geocodeQueue=[],this._geocodingBanned=!1,this._routingService=null,this._routingQueue=[],arguments[0]&&arguments[0]instanceof n){var t=arguments[0];this.setZoom(t.getZoom()),this.setCenter(t.getCenter())}}return n.__CLASS__="GeoMap",n.code=null,n.mapName=null,n.TILE_SIZE=256,n.EMPTY_IMG="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",n.MIN_ZOOM=2,n.MAX_ZOOM=20,n.getName=function(){return this.mapName},n.getCode=function(){return this.code},t.extend(n.prototype,{SEARCH_DATA_TYPE:"jsonp",setZoom:function(t){if(t==this.zoom)return!0;if(!this.checkZoomAvailable(t))return!1;this.zoom=t,this._nbTiles=Math.pow(2,this.zoom),this._size=this._nbTiles*n.TILE_SIZE,this._kLon=this.lonToX(0)/180;for(var i=0,s=0;80>=s;++s)i=this.getXYDistance(s,0,s+1,0),this._kLat[s]=i,this._kDist[s]=Math.round(1e4*e.getDistanceBetweenPointsSimple(s,0,s+1,0)/i)/1e4;return!0},getZoom:function(){return this.zoom},getMinZoom:function(){return"undefined"==typeof this.constructor.MIN_ZOOM?n.MIN_ZOOM:this.constructor.MIN_ZOOM},getMaxZoom:function(){return"undefined"==typeof this.constructor.MAX_ZOOM?n.MAX_ZOOM:this.constructor.MAX_ZOOM},checkZoomAvailable:function(t){return t>=this.getMinZoom()&&t<=this.getMaxZoom()},getKDistByLat:function(t){var t=Math.round(t);return this._kDist[t]||0},getMaxTileNumber:function(){return this._nbTiles-1},setCenter:function(){2===arguments.length?(this.center.lat=arguments[0],this.center.lon=arguments[1]):1===arguments.length&&(t.isArray(arguments[0])?(this.center.lat=arguments[0][0],this.center.lon=arguments[0][1]):this.center=arguments[0])},getCenter:function(){return this.center},getCenterXY:function(){return{x:this.lonToX(this.center.lon),y:this.latToY(this.center.lat)}},getSize:function(){return this._size},lonToX:function(t){return Math.round(this._size*(.5+t/360))},dLonToDX:function(t,e){return this._size*(e-t)/360},xToLon:function(t){return 360*(t%this._size)/this._size-180},latToY:function(t){t>90&&(t-=180),-90>t&&(t+=180);var e=Math.PI*t/180,i=.5*Math.log((1+Math.sin(e))/(1-Math.sin(e))),n=0;return 1/0===i?n:i===-1/0?this._size:(n=parseInt((1-i/Math.PI)/2*this._size),0>n?0:n>this._size?this._size:n)},dLatToDY:function(t,e){return this.latToY(e)-this.latToY(t)},getXYDistance:function(t,e,i,n){var s=this.dLonToDX(e,n),o=this.dLatToDY(t,i);return Math.sqrt(s*s+o*o)},yToLat:function(t){var e=(.5-t/this._size)*Math.PI2;return 180*(2*Math.atan(Math.exp(e))-Math.PI/2)/Math.PI},getImgSrc:function(t,e,i){return 0>e||e>this.getMaxTileNumber()?n.EMPTY_IMG:(0>t?t=0:t>=this._nbTiles&&(t%=this._nbTiles),i<this.getMinZoom()||i>this.getMaxZoom(),this._getSourceUrl()+this._buildImgParams(t,e,i))},getEmptySrc:function(){return n.EMPTY_IMG},_getSourceUrl:function(){var t=this.constructor,e=t.HOST[Math.floor(Math.random()*t.HOST.length)];return this._protocol+e+t.DEFAULT_PARAMS},_buildImgParams:function(){return""},getCode:function(){return this.constructor.code||null},getClass:function(){return this.constructor.__CLASS__||""},getProjectionType:function(){return"google"},getTrafficLayerClass:function(){return""},isHybrid:function(){return!1},search:function(e,n){var s=this,o=t.Deferred();if(n&&n.lat&&n.lon)return o.resolve([n]);if(this._geocodingBanned)return s._searchWithREST(e,o),o;var a=this.getSearchUrl(e);return t.ajax({url:a,type:"GET",method:"GET",dataType:this.SEARCH_DATA_TYPE,beforeSend:function(){},statusCode:{401:function(){}},success:function(t){try{var e=s.parseSearchJSON(t);o.resolve(e)}catch(i){o.reject({msg:i})}},error:function(t,n){"parsererror"==n||401==t.status?(s._geocodingBanned=!0,s._searchWithREST(e,o)):o.reject({msg:i.canNotFindCoordsByAddress})}}),o},_searchWithREST:function(e,n){var s=e.q,o={geoId:null,lon:e.center.lon,address:[s],scode:this.scode,lat:e.center.lat};t.ajax({url:App.getBaseUrl()+"address/find/",data:o}).done(function(t){s in t?n.resolve([t[s]]):n.reject({msg:i.canNotFindCoordsByAddress})}).fail(function(){n.reject({msg:i.canNotFindCoordsByAddress})})},getSearchUrl:function(t){var e="",i=App.getServerSettings(),n="";return t.center&&(e="&ll="+t.center.lon+","+t.center.lat),"yandexApiKey"in i&&(n="&apikey="+i.yandexApiKey),"https://geocode-maps.yandex.ru/1.x/?geocode="+encodeURIComponent(t.q)+e+"&format=json&sco=latlong&lang="+this.getLocale()+n},parseSearchJSON:function(t){for(var e=[],i=t.response.GeoObjectCollection.featureMember,n=null,s=[],o=0;o<i.length;o++)n=i[o].GeoObject,s=n.Point.pos.split(" "),e.push({lat:s[1],lon:s[0],title:n.metaDataProperty.GeocoderMetaData.text,original:n});return e},suggest:function(e){var i=this,n=t.Deferred(),s=new Date,o="jQuery"+s.getTime();window[o]=function(t){var e=t[0],s=t[1];try{var o=i.parseSuggestJSON(e,s);n.resolve(o)}catch(a){n.reject({msg:a})}};var a=this.getSuggestUrl(e)+"&callback="+o;return t.getScript(a),n},getSuggestUrl:function(t){var e="";t.center&&(e="&ll="+t.center.lon+","+t.center.lat);var i="ru",n="&spn=0.8,0.3";return-1!=App.getLocale().indexOf("en")&&(i="com"),this._protocol+"suggest-maps.yandex."+i+"/suggest-geo?search_type=all&lang="+this.getLocale()+"&fullpath=1&v=5&part="+t.q+e+n},parseSuggestJSON:function(e,i){return t.map(i,function(t){if("geo"==t[0]){for(var e="",i=0,n=t[1].length;n>i;i++)e+="string"==typeof t[1][i]?t[1][i]:t[1][i][1];return{label:e,value:e,original:t}}})},geocode:function(e){if(this._geocoding)return this._geocodeQueue.push(e),void 0;this._geocoding=!0;var i=this,n=this.getGeocodeUrl(e);!e.scode&&(e.scode=this.scode),t.ajax({url:n,type:"GET",method:"GET",timeout:1e3,beforeSend:function(){},statusCode:{401:function(){}},success:function(t){try{var n=i.parseGeocodeJSON(t);e.geoId&&(n.geoId=e.geoId),n.lat=e.lat,n.lon=e.lon,e.success&&e.success(n),e.complete&&e.complete()}catch(s){i._onExternalGeocodingFailed(e)}},complete:function(){i._geocoding=!1,i._geocodeQueue.length&&setTimeout(function(){i.geocode(i._geocodeQueue.shift())},100)},error:function(){i._onExternalGeocodingFailed(e)}})},getGeocodeUrl:function(t){var e=App.getServerSettings(),i="";return"yandexApiKey"in e&&(i="&apikey="+e.yandexApiKey),"https://geocode-maps.yandex.ru/1.x/?geocode="+t.lon+","+t.lat+"&format=json&results=1&lang="+this.getLocale()+i},parseGeocodeJSON:function(t){if(t.scode)return t;try{var e=t.response.GeoObjectCollection.featureMember[0].GeoObject.metaDataProperty.GeocoderMetaData;return{address:e.text,kind:e.kind}}catch(i){throw i}},routing:function(){return!0},routingTraffic:function(){return!1},routingReady:function(){return this._routingService},requestRoute:function(e,n){var s=this,o=new t.Deferred;return this.loadRouting?(this.loadRouting().done(function(){s._calcRoute.call(s,e,n).done(function(t){o.resolve(t)}).fail(function(){o.reject.apply(o,arguments)})}).fail(function(){o.reject.apply(o,arguments)}),o):o.reject(i.errNoRoutingOnMap)},getLocale:function(){return App.getLocale().replace("-","_")},_onExternalGeocodingFailed:function(e){if(e.scode){var i=this;t.ajax({url:App.getBaseUrl()+"address/",data:e,success:function(t){try{e.success&&e.success(i.parseGeocodeJSON(t))}catch(n){e.error&&e.error(n)}},complete:function(){e.complete&&e.complete()},error:function(){e.error&&e.error.apply(this,arguments)}})}}}),n.RouteData=function(){this.meta={bounds:[],time:0,trafficTime:0,length:0,trafficLength:0,source:""},this.steps=[],this.points=[]},t.extend(n.RouteData.prototype,{roundTime:function(t){var e=10;return t>86400?e=3600:t>43200?e=1800:t>10800?e=1200:t>3600?e=600:t>1800&&(e=60),Math.ceil(t/e)*e},roundLength:function(t){var e=10;return t>5e3?e=500:t>1e3?e=100:t>300&&(e=50),t=Math.round(t/e),0==t?e:t*e},formatTime:function(t){var e=i.DateTime,n=[],s=parseInt(t/86400),o=parseInt(t/3600)%24,a=parseInt(t/60)%60,r=Math.round(t%60),l=s?s+"&nbsp;"+e.labelsCompact[3]:"";return n.push(l),l=o?o+"&nbsp;"+e.labelsCompact[4]:"",n.push(l),l=a?a+"&nbsp;"+e.labelsCompact[5]:"",n.push(l),l=r?r+"&nbsp;"+e.labelsCompact[6]:0==n.join("").length?"0 "+e.labelsCompact[6]:"",n.push(l),n.join(" ")},formatLength:function(t){var e=Math.floor(t/1e3);return e>0?Math._round(t/1e3,1)+"&nbsp;"+i.km:t+"&nbsp;"+i.m}}),n}),define("abstracts/Collection",["jquery","underscore","backbone"],function(t,e){var i=Backbone.Collection.prototype,n=Backbone.Collection.extend({idProp:"id",fetch:function(){var n=arguments,s=arguments[1]||{};if(e.isArray(arguments[0])){if(s.data={},s.data[this.idProp]=arguments[0],s.merge){var o=this;return t.ajax({url:e.result(this,"url"),data:s.data}).done(function(t){o.add(t,e.extend({parse:!0},s))})}n=[s]}return i.fetch.apply(this,n)}});return n}),define("maps/routing/Route",["jquery","underscore","maps/GeoMap","abstracts/Model"],function(t,e,i,n){var s=n.extend({constructor:function(){n.apply(this,arguments)},defaults:{meta:null,source:null,traffic:!1,points:[],steps:[],color:"#584CD9",fadeColor:"#8282ad",hidden:!1,active:!0,options:{}},initialize:function(){var t=this;this.on("change:points change:source",function(){t.build()})},build:function(){var e=this,n=this.get("source"),s=new t.Deferred,o=[],a=this.get("options");if(n&&n.requestRoute){if(o=this.get("points"),!this.validatePoints(o))return s.reject();e.trigger("request"),n.requestRoute(o,a).done(function(t){t instanceof i.RouteData&&(t.points=o,e.set(t),e.trigger("sync",e,{autoZoom:e.get("active")}),s.resolve())}).fail(function(t){e.trigger("error",t),s.reject(t)})}else e.trigger("error",e,"No source for route or no requestRoute method"),s.reject("No source for route or no requestRoute method");return s},setPointIndex:function(t,e){var i=this.get("points"),n=i[t]||null;return n?(0>e&&(e=0),e>=i.length&&(e=i.length-1),i.splice(t,1),i.splice(e,0,n),!0):!1},setPointParams:function(t,i){var n=this.get("points");n[t]&&e.extend(n[t],i)},validatePoints:function(t){var t=t||this.get("points"),e=!0,i=t.length;if(2>i)return!1;for(;i--;)if(!t[i]||!t[i].lat||!t[i].lon){e=!1;break}return e}});return s}),define("maps/routing/RoutesCollection",["underscore","abstracts/Collection","maps/routing/Route"],function(t,e,i){var n=e.extend({model:i,constructor:function(){e.apply(this,arguments)}});return n}),define("text!maps/routing/tmpl/create.html",[],function(){return'<form action="" method="post" class="no-margin">\n    <div class="box-header"><h2><%= i18n.routeBuilding %></h2><a class="close">&times;</a></div>\n    <div class="box-content points-cont">\n        <ol class="points">\n            <%= pointsHtml %>\n        </ol>\n        <!--<div class="tools clearfix">\n            <a class="pull-right" href="javascript:;">Options</a>\n        </div>-->\n    </div>\n    <div class="box-footer">\n        <!--<button type="submit" class="btn btn-primary btn-build"><%= i18n.build.ucFirst() %></button>-->\n        <a href="#" class="btn btn-reset"><%= i18n.clear.ucFirst() %></a>\n    </div>\n</form>'
}),define("text!maps/routing/tmpl/point.html",[],function(){return'<li class="form-search<% if(point.text){%> active<% } %>" data-index="<%= i %>">\n    <i class="route-point-marker"></i>\n    <div class="input-prepend">\n        <a class="btn dropdown-toggle" data-toggle="dropdown" data-type="<%= point.type %>">\n            <svg class="svg-icon">\n                <use xlink:href="#smb-<%= icons[point.type] %>"></use>\n            </svg>\n            <span class="caret pull-right"></span>\n        </a>\n        <ul class="dropdown-menu nav nav-list">\n            <% _.each(searchTypes, function(name, key){%>\n            <li><a data-type="<%= key %>" href="javascript:;">\n                <svg class="svg-icon">\n                    <use xlink:href="#smb-<%= icons[key] %>"></use>\n                </svg>\n                <%- name %>\n            </a></li>\n            <% }); %>\n        </ul>\n        <div class="input-append">\n            <span class="add-on">\n                <input type="text" name="routePoint" value="<%= point.text %>"\n                       data-lat="<%= point.lat %>" data-lon="<%= point.lon %>"\n                       tabindex="<%= 1000 + i %>">\n                <i class="icon-clear svg-icon svg-icon-circle-remove"></i>\n            </span>\n        </div>\n    </div>\n    <div class="point-tools">\n        <a href="javascript:;" class="move-point move-down"><i class="icon-arrow-down"></i><i class="icon-arrow-up"></i></a>\n        <!--<i class="move-point move-down icon-arrow-down"></i>\n        <i class="move-point move-up icon-arrow-up"></i>\n        <i class="add-point icon-plus"></i>-->\n    </div>\n</li>'}),define("maps/routing/views/RoutingCreateView",["jquery","underscore","jqueryui","abstracts/View","text!maps/routing/tmpl/create.html","text!maps/routing/tmpl/point.html"],function(t,e,i,n,s,o){s=e.template(s),o=e.template(o);var a={address:"location",mobile:"car",stat:"home",guard:"shield"},r=n.extend({className:"routing",constructor:function(){this.form=null,this.pointsList=null,this.inputs=null,this._marker=null,n.apply(this,arguments)},initialize:function(){l.bindEvents.call(this),this.render()},render:function(){var e=this,i=s({pointsHtml:"",i18n:this.model.getTexts()});t("#page").append(this.$el.html(i)),this.form=this.$el.find("form"),this.pointsList=this.$el.find(".points"),t.fn.draggable&&this.$el.draggable({handle:".box-header",containment:"parent",stop:function(t,i){e.model.setUserData("left",i.position.left),e.model.setUserData("top",i.position.top)}}),t.fn.resizable&&this.$el.resizable({handles:"w,e",containment:"parent",minWidth:400,stop:function(t,i){e.model.setUserData("width",i.size.width)}});var n=this.model.getUserData("left"),o=this.model.getUserData("top"),a=this.model.getUserData("width");null!==n&&(this.el.style.left=n+"px"),null!==o&&(this.el.style.top=o+"px"),null!==a&&(this.el.style.width=a+"px"),this.form.on("submit",function(){return l.onSubmit.call(e),!1})},open:function(){this.$el.removeClass("hidden")},close:function(){this.$el.addClass("hidden"),this._marker&&this._marker.trigger("destroy")&&(this._marker=null)}}),l={bindEvents:function(){var e=this;this.on("suggestsuccess",function(t,e){e&&e(t)}),this.listenTo(this.model,"change:active",function(t,i){i?e.open():e.close()}).listenTo(this.model,"change:activeRoute",function(t,i){var n=t.previous("activeRoute");n&&(e.stopListening(n),e.collection.remove(n)),i?(l.bindRouteEvents.call(e,i),l.renderPoints.call(e)):e.close()}),this.$el.on("click",".close",function(){e.model.set("active",!1)}).on("click",".btn-reset",function(){e.collection.remove(e.collection.models),e.model.buildRoute([])}).on("click",".add-point",function(){}).on("click",".move-point",function(){var i=t(this).closest("li"),n=t(this).is(".move-up"),s=i[n?"prev":"next"]();s.length&&(i[n?"insertBefore":"insertAfter"](s),l.onSubmit.call(e))}).on("click","a[data-type]",function(){var e=t(this),i=e.data("type"),n=t(this).closest(".form-search");n.data("index"),n.removeClass("error").find("input").val("").focus(),n.find(".dropdown-toggle").data("type",i).find("use").attr("xlink:href","#smb-"+a[i])}).on("click",".icon-clear",function(){var e=t(this).closest(".form-search");e.find("input").val("").data("lat",0).data("lon",0).focus(),e.removeClass("active")})},bindRouteEvents:function(t){var e=this;this.listenTo(t,"sync",function(){var i=e.model.getStepsView(t.id);e.$el.find(i.$el).length||i.$el.appendTo(e.$el)}).listenTo(t,"request",function(){e.$el.addClass("loading")}).listenTo(t,"sync error",function(){e.$el.removeClass("loading")})},initAutocomplete:function(e){var i=this,n=this.model.get("parent");t(e).autocomplete({minLength:2,source:function(t,e){var s=this.element,o=s.closest("li"),a=(o.data("index"),{q:t.term,type:o.find(".btn[data-type]").data("type"),center:n.getWidget().getCenter(),bounds:n.getWidget().getBounds()}),r=e,l=function(t){var e=-1!=o[0].className.indexOf("error");t.length?e&&o.removeClass("error"):!e&&o.addClass("error"),r.apply(this,arguments)};i.once("suggestcomplete",function(){s.removeClass("ui-autocomplete-loading")}),-1==o[0].className.indexOf("active")&&(o[0].className+=" active"),n.publish("needsuggest",a,l,i)},select:function(e,n){if(n.item){var s=t(this),o=n.item.value,a=s.closest("li"),r=a.data("index"),c=a.find(".btn[data-type]").data("type");s.val(o),l.search.call(i,o,c,r,n.item.original||null)}}}).on("keyup",function(){})},onSubmit:function(){var e=this.form.find("input[data-lat]"),i=[];e.each(function(){var e=t(this),n=e.closest("li"),s=(n.data("index"),n.find(".btn[data-type]").data("type")),o=t.trim(e.val()),a={type:s,text:o};if(/^\-?[\d]{1,2}(\.[\d]*)?\,\s*?\-?[\d]{1,3}(\.[\d]*)?$/i.test(o)){var r=o.indexOf(",");a.lat=o.substr(0,r),a.lon=o.substr(r+1)}else a.lat=e.data("lat"),a.lon=e.data("lon");a.lat&&a.lon&&(a.lat=parseFloat(a.lat),a.lon=parseFloat(a.lon),i.push(a))}),this.model.get("activeRoute").set("points",i)},search:function(t,i,n,s){var o=this,a=this.model.get("parent"),r=t,c=i,h=s,d=o.pointsList.find(".form-search[data-index="+n+"]"),u=d.find("input");!function(t,i,n,s,d){s.one("searchstart",function(){!h&&s.addClass("ui-autocomplete-loading")}).one("searchcomplete",function(){s.removeClass("ui-autocomplete-loading")}).one("searchsuccess",function(i,a){if(!a||e.isArray(a)&&!a.length)return n.addClass("error"),void 0;var r=e.isArray(a)?a[0]:a,c=r.name||r.title||t;s.val(c).data("lat",r.lat).data("lon",r.lon),l.onSubmit.call(o)}).one("searcherror",function(){});var u={q:r,type:c,center:a.getWidget().getCenter(),bounds:a.getWidget().getBounds()};a.publish("needsearch",u,s,d||null)}(r,c,d,u,h)},renderPoints:function(){var t=this,i="",n=t.model.getTexts(),s=t.model.get("activeRoute").get("points"),r={address:n.address.ucFirst()};App.hasMobile()&&(r.mobile=n.vehiclesLabels[0].ucFirst()),App.hasStationary()&&(r.stat=n.stationaryLabels[0].ucFirst()),App.get("grGuardsAvailable")&&(r.guard=n.rrTeamShort),e.each(s,function(t,e){i+=o({point:t,i:e,i18n:n,searchTypes:r,icons:a})}),this.pointsList.html(i),this.inputs=t.pointsList.find("input"),this.inputs.each(function(){l.initAutocomplete.call(t,this)}),this.inputs.filter('[value=""]').first().focus()}};return r}),define("text!maps/routing/tmpl/stepInfo.html",[],function(){return'<div class="explain"><%= index %>. <%= actionHtml || actionText %></div>\n<div class="params">\n    <strong class="length" data-value="<%= length %>"><%= roundLengthS %></strong>,\n    <span class="time" data-value="<%= time %>"><%= roundTimeS %></span>\n</div>'}),define("text!maps/routing/tmpl/pointInfo.html",[],function(){return'<% if(\'undefined\' != typeof point) {%>\n<h4><%=point.text%></h4>\n<small><%= Math._round(point.lat, 4) %>,<%= Math._round(point.lon, 4) %></small>\n<% } %>\n<% if(step) {%>\n<div class="explain"><%= step.actionHtml || step.actionText %></div>\n<div class="params">\n    <strong class="length" data-value="<%= step.length %>"><%= step.roundLengthS %></strong>\n    <% if(step.time > 0) {%>\n    , <span class="time" data-value="<%= step.time %>"><%= step.roundTimeS %></span>\n    <% } %>\n</div>\n<% } %>'}),define("maps/routing/views/RouteMapView",["jquery","underscore","geo","abstracts/View","text!maps/routing/tmpl/stepInfo.html","text!maps/routing/tmpl/pointInfo.html"],function(t,e,i,n,s,o){s=e.template(s),o=e.template(o);var a=n.extend({constructor:function(){this.module=null,this._polyline=null,this._segments=[],this._pointsLayer=null,this._viaLayer=null,this._startMarker=null,this._finishMarker=null,this._popup=null,n.apply(this,arguments)},initialize:function(t){this.module=t.module;var e=this;this.listenTo(this.model,"sync",function(t,i){t.get("hidden")||(e._polyline&&r.clearLayers.call(e),e._segments=r.makeSegments.call(e),r.build.call(e,i))}).listenTo(this.model,"remove",function(){e.stopListening(e.model),r.clearLayers.call(e),e._segments=[]}).listenTo(this.model,"change:hidden",function(t,i){r.triggerOnLayers.call(e,i?"hide":"show")}).listenTo(this.model,"change:active",function(t,i){r.clearLayers.call(e),e._segments=r.makeSegments.call(e);var n=e.module.get("parent");if(i)r.build.call(e,{autoZoom:!0});else{var s=e._segments;s.length&&(e._polyline=n.getWidget().buildComplexPolyline());for(var o=0,a=s.length;a>o;o++)e._polyline.addSegment(s[o]);t.get("hidden")||e._polyline&&e._polyline.trigger("show")}})}}),r={makeSegments:function(){var t=[],n=this.model.get("steps");if(!n||!n.length)return t;var s=this.module.get("parent"),o=this.model.get("points"),a=o[0],r=e.last(o),l=n[0].points[0],c=e.last(e.last(n).points),h=20,d=this.model.get("active"),u=d?this.model.get("color"):this.model.get("fadeColor"),p={weight:2,weightArray:{9:4,12:6,15:8},color:u,opacity:d?.75:.65,dashArray:[5,15]};i.getDistanceBetweenPoints(a.lat,a.lon,l[0],l[1])>h&&t.push(s.buildPolyline([[a.lat,a.lon],[l[0],l[1]]],p)),e.extend(p,{dashArray:null,decor:d,decorMinZoom:12});for(var m=0,f=n.length;f>m;++m)t.push(s.buildPolyline(n[m].points,p));return i.getDistanceBetweenPoints(r.lat,r.lon,c[0],c[1])>h&&(e.extend(p,{dashArray:[5,15],decor:!1}),t.push(s.buildPolyline([[r.lat,r.lon],[c[0],c[1]]],p))),t},build:function(t){var e=this.module.get("parent"),i=this.model,n=this._segments;n.length&&(this._polyline=e.getWidget().buildComplexPolyline());for(var s=0,o=n.length;o>s;s++)this._polyline.addSegment(n[s]);var a;i.get("active")&&(a=this.model.get("meta").bounds)&&(!t||t.autoZoom)&&e.setBounds(a,{padding:[40,40]}),this._polyline&&this._polyline.trigger("show"),i.get("active")&&(r.putPoints.call(this),r.putMarkers.call(this),this._pointsLayer.bindPopup(""))},putMarkers:function(){if(!this._polyline)return!1;for(var t=this.model.get("points"),e=[],i=0,n=t.length;n>i;++i){var s;(s=r.buildPointMarker.call(this,i))&&e.push(s)}this._pointsLayer.addLayers(e)},putPoints:function(){if(!this._polyline)return!1;for(var t=this,e=this.model.get("steps"),i=[],n=1,s=e.length;s>n;++n){var o;(o=r.buildStepPointMarker.call(t,e[n]))&&i.push(o)}this._pointsLayer=this.module.get("parent").addLayersGroup({layers:i,clusters:!1})},buildStepPointMarker:function(t){var i=this,n=t.points[0],o=this.module.get("parent").buildMarker({lat:n[0],lon:n[1],className:"step-point-marker",data:t});return o.on("click",function(){this._popup&&this._popup.setContent(s(e.extend({},t,{i18n:i.module.getTexts()})))}),o},buildPointMarker:function(t){var i,n=this,s=this.model.get("points"),a=this.model.get("steps"),r=s[t],l=t==s.length-1,c=0==t?a[0]:null,h="";0==t?(i=a[0].points[0],h=" route-start-marker"):l?(i=e.last(e.last(a).points),h=" route-finish-marker"):(i=[r.lat,r.lon],h=" route-point-marker route-point-"+t);var d=this.module.get("parent").buildMarker({lat:i[0],lon:i[1],className:"route-point-marker"+h,data:{step:c,point:r}});return d.on("click",function(){this._popup&&this._popup.setContent(o(e.extend({},{step:c,point:r,isLast:l},{i18n:n.module.getTexts()})))}),d},triggerOnLayers:function(t){var i=this;e.each(["_polyline","_startMarker","_finishMarker","_viaLayer","_pointsLayer"],function(e){i[e]&&i[e].trigger(t)})},clearLayers:function(){r.triggerOnLayers.call(this,"destroy"),this._startMarker=this._finishMarker=this._viaLayer=this._pointsLayer=null}};return a}),define("text!maps/routing/tmpl/stepsList.html",[],function(){return'<p class="alert no-traffic-alert hidden"><%= i18n.routeNoTrafficAlert %></p>\n<div class="route-summary">\n    <h4><%= start.text %> - <%= finish.text %></h4>\n    <div class="params">\n        <strong data-value="<%= meta.length %>" data-roundvalue="<%= meta.roundLength %>"><%= meta.roundLengthS %></strong> ,\n        <span data-value="<%= meta.time %>" data-roundvalue="<%= meta.roundTime %>"><%= meta.roundTimeS %></span>\n    </div>\n</div>\n<ol class="selectable">\n<% _.each(steps, function(step, i){%>\n<li class="route-step <%= step.action %>" data-index="<%= i %>">\n    <div class="wrap">\n        <div class="explain"><%= step.actionHtml || step.actionText %></div>\n        <div class="params">\n            <strong class="length" data-value="<%= step.length %>"><%= step.roundLengthS %></strong>,\n            <span class="time" data-value="<%= step.time %>"><%= step.roundTimeS %></span>\n        </div>\n    </div>\n    <!--<div class="params">\n        <span class="length" data-value="<%= step.length %>">length: <%= step.length %></span><br />\n        <span class="time" data-value="<%= step.time %>">time: <%= step.time %></span>\n    </div>-->\n</li>\n<% }) %>\n</ol>'}),define("maps/routing/views/RouteStepsView",["jquery","underscore","abstracts/View","text!maps/routing/tmpl/stepsList.html"],function(t,e,i,n){n=e.template(n);var s=i.extend({className:"box-content route-steps",constructor:function(){this.module=null,this.container=null,i.apply(this,arguments)},initialize:function(e){this.module=e.module,this._i18n=this.module.getTexts();var i=this;this.listenTo(this.model,"sync",function(){i.model.get("active")&&i.render()}).listenTo(this.model,"error",function(){}).listenTo(this.model,"change:active",function(t,e){e?(i.$el.removeClass("hidden"),i.render()):i.$el.html("").addClass("hidden")}),this.$el.on("click","li[data-index]",function(){var e=t(this),n=e.data("index"),s=i.model.get("steps");i.module.get("parent").zoomTo(s[n].points[0])})},render:function(){var t=this.model.get("points"),i=this.model.get("source").routingTraffic();this.$el.html(n(e.extend({},this.model.attributes,{start:t[0],finish:e.last(t),i18n:this._i18n}))),this.$el.find(".no-traffic-alert")[i?"addClass":"removeClass"]("hidden")}});return s}),define("maps/routing/RoutingModule",["underscore","jquery","geo","abstracts/Module","./RoutesCollection","./Route","./views/RoutingCreateView","./views/RouteMapView","./views/RouteStepsView","i18n!_common/nls/common"],function(t,e,i,n,s,o,a,r,l,c){function h(){for(var e=u.length,i=new Array(e);e--;)i[e]=t.clone(u[e]);return i}var d=c,u=[{type:"mobile",text:"",model:null},{type:"address",text:""}],p=n.extend({constructor:function(){this.items=new s,this._routeId=0,this._stepViews={},n.apply(this,arguments)},defaults:{pointsEdit:!1,activeRoute:null},initialize:function(){m.bindEvents.call(this)},buildRoute:function(e,i){var n=this.get("pointsEdit"),s=new o({id:m.getRouteId.call(this),source:this.get("parent").getMap()});return e&&e.length?1==e.length?e.push(t.clone(u[1])):2!=e.length||e[0]||(e[0]=t.clone(u[0])):e=h(),(n||s.validatePoints(e))&&(new r({model:s,module:this,maps:this.get("parent")}),s.set("points",e).set(i),this.items.add(s),this._stepViews[s.id]=new l({model:s,module:this}),n&&(s.set("active",!0),this.set("activeRoute",s))),s},getStepsView:function(t){return this._stepViews[t]||null},getTexts:function(){return d}}),m={bindEvents:function(){var e=this;this.on("change:active",function(t,i){i&&e.get("pointsEdit")&&!e._view?e._view=new a({model:e,collection:e.items}):i||e.items.remove(e.items.models)}).listenTo(this.get("parent"),"mapchanged",function(i){var n=t.once(function(t){var e=d.errCanNotBuildRoute;"string"==typeof t&&(e=t),alert(e,d.error)});e.items.each(function(t){t.get("source").scode!=i.scode&&(e.listenToOnce(t,"error",n).listenToOnce(t,"sync",function(){e.stopListening(t,"error",n)}),t.set("source",i))})}).listenTo(this.items,"remove",function(t){t.id in e._stepViews&&(e._stepViews[t.id].remove(),delete e._stepViews[t.id])})},getRouteId:function(){return++this._routeId}};return p}),function(t,e,i){var n=t.L,s={};s.version="0.7.3","object"==typeof module&&"object"==typeof module.exports?module.exports=s:"function"==typeof define&&define.amd&&define("_libs/leaflet/leaflet-src",s),s.noConflict=function(){return t.L=n,this},t.L=s,s.Util={extend:function(t){var e,i,n,s,o=Array.prototype.slice.call(arguments,1);for(i=0,n=o.length;n>i;i++){s=o[i]||{};for(e in s)s.hasOwnProperty(e)&&(t[e]=s[e])}return t},bind:function(t,e){var i=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return t.apply(e,i||arguments)}},stamp:function(){var t=0,e="_leaflet_id";return function(i){return i[e]=i[e]||++t,i[e]}}(),invokeEach:function(t,e,i){var n,s;if("object"==typeof t){s=Array.prototype.slice.call(arguments,3);for(n in t)e.apply(i,[n,t[n]].concat(s));return!0}return!1},limitExecByInterval:function(t,e,i){var n,s;return function o(){var a=arguments;return n?(s=!0,void 0):(n=!0,setTimeout(function(){n=!1,s&&(o.apply(i,a),s=!1)},e),t.apply(i,a),void 0)}},falseFn:function(){return!1},formatNum:function(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return s.Util.trim(t).split(/\s+/)},setOptions:function(t,e){return t.options=s.extend({},t.options,e),t.options},getParamString:function(t,e,i){var n=[];for(var s in t)n.push(encodeURIComponent(i?s.toUpperCase():s)+"="+encodeURIComponent(t[s]));return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")},template:function(t,e){return t.replace(/\{ *([\w_]+) *\}/g,function(t,n){var s=e[n];if(s===i)throw new Error("No value provided for variable "+t);return"function"==typeof s&&(s=s(e)),s})},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function e(e){var i,n,s=["webkit","moz","o","ms"];for(i=0;i<s.length&&!n;i++)n=t[s[i]+e];return n}function i(e){var i=+new Date,s=Math.max(0,16-(i-n));return n=i+s,t.setTimeout(e,s)}var n=0,o=t.requestAnimationFrame||e("RequestAnimationFrame")||i,a=t.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){t.clearTimeout(e)};s.Util.requestAnimFrame=function(e,n,a,r){return e=s.bind(e,n),a&&o===i?(e(),void 0):o.call(t,e,r)},s.Util.cancelAnimFrame=function(e){e&&a.call(t,e)}}(),s.extend=s.Util.extend,s.bind=s.Util.bind,s.stamp=s.Util.stamp,s.setOptions=s.Util.setOptions,s.Class=function(){},s.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},i=function(){};i.prototype=this.prototype;var n=new i;n.constructor=e,e.prototype=n;for(var o in this)this.hasOwnProperty(o)&&"prototype"!==o&&(e[o]=this[o]);t.statics&&(s.extend(e,t.statics),delete t.statics),t.includes&&(s.Util.extend.apply(null,[n].concat(t.includes)),delete t.includes),t.options&&n.options&&(t.options=s.extend({},n.options,t.options)),s.extend(n,t),n._initHooks=[];var a=this;return e.__super__=a.prototype,n.callInitHooks=function(){if(!this._initHooksCalled){a.prototype.callInitHooks&&a.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;e>t;t++)n._initHooks[t].call(this)}},e},s.Class.include=function(t){s.extend(this.prototype,t)},s.Class.mergeOptions=function(t){s.extend(this.prototype.options,t)},s.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i)};var o="_leaflet_events";s.Mixin={},s.Mixin.Events={addEventListener:function(t,e,i){if(s.Util.invokeEach(t,this.addEventListener,this,e,i))return this;var n,a,r,l,c,h,d,u=this[o]=this[o]||{},p=i&&i!==this&&s.stamp(i);for(t=s.Util.splitWords(t),n=0,a=t.length;a>n;n++)r={action:e,context:i||this},l=t[n],p?(c=l+"_idx",h=c+"_len",d=u[c]=u[c]||{},d[p]||(d[p]=[],u[h]=(u[h]||0)+1),d[p].push(r)):(u[l]=u[l]||[],u[l].push(r));return this},hasEventListeners:function(t){var e=this[o];return!!e&&(t in e&&e[t].length>0||t+"_idx"in e&&e[t+"_idx_len"]>0)},removeEventListener:function(t,e,i){if(!this[o])return this;if(!t)return this.clearAllEventListeners();if(s.Util.invokeEach(t,this.removeEventListener,this,e,i))return this;var n,a,r,l,c,h,d,u,p,m=this[o],f=i&&i!==this&&s.stamp(i);for(t=s.Util.splitWords(t),n=0,a=t.length;a>n;n++)if(r=t[n],h=r+"_idx",d=h+"_len",u=m[h],e){if(l=f&&u?u[f]:m[r]){for(c=l.length-1;c>=0;c--)l[c].action!==e||i&&l[c].context!==i||(p=l.splice(c,1),p[0].action=s.Util.falseFn);i&&u&&0===l.length&&(delete u[f],m[d]--)}}else delete m[r],delete m[h],delete m[d];return this},clearAllEventListeners:function(){return delete this[o],this},fireEvent:function(t,e){if(!this.hasEventListeners(t))return this;var i,n,a,r,l,c=s.Util.extend({},e,{type:t,target:this}),h=this[o];if(h[t])for(i=h[t].slice(),n=0,a=i.length;a>n;n++)i[n].action.call(i[n].context,c);r=h[t+"_idx"];for(l in r)if(i=r[l].slice())for(n=0,a=i.length;a>n;n++)i[n].action.call(i[n].context,c);return this},addOneTimeEventListener:function(t,e,i){if(s.Util.invokeEach(t,this.addOneTimeEventListener,this,e,i))return this;var n=s.bind(function(){this.removeEventListener(t,e,i).removeEventListener(t,n,i)},this);return this.addEventListener(t,e,i).addEventListener(t,n,i)}},s.Mixin.Events.on=s.Mixin.Events.addEventListener,s.Mixin.Events.off=s.Mixin.Events.removeEventListener,s.Mixin.Events.once=s.Mixin.Events.addOneTimeEventListener,s.Mixin.Events.fire=s.Mixin.Events.fireEvent,function(){var n="ActiveXObject"in t,o=n&&!e.addEventListener,a=navigator.userAgent.toLowerCase(),r=-1!==a.indexOf("webkit"),l=-1!==a.indexOf("chrome"),c=-1!==a.indexOf("phantom"),h=-1!==a.indexOf("android"),d=-1!==a.search("android [23]"),u=-1!==a.indexOf("gecko"),p=typeof orientation!=i+"",m=t.navigator&&t.navigator.msPointerEnabled&&t.navigator.msMaxTouchPoints&&!t.PointerEvent,f=t.PointerEvent&&t.navigator.pointerEnabled&&t.navigator.maxTouchPoints||m,g="devicePixelRatio"in t&&t.devicePixelRatio>1||"matchMedia"in t&&t.matchMedia("(min-resolution:144dpi)")&&t.matchMedia("(min-resolution:144dpi)").matches,v=e.documentElement,_=n&&"transition"in v.style,b="WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix&&!d,y="MozPerspective"in v.style,w="OTransition"in v.style,x=!t.L_DISABLE_3D&&(_||b||y||w)&&!c,C=!t.L_NO_TOUCH&&!c&&function(){var t="ontouchstart";if(f||t in v)return!0;var i=e.createElement("div"),n=!1;return i.setAttribute?(i.setAttribute(t,"return;"),"function"==typeof i[t]&&(n=!0),i.removeAttribute(t),i=null,n):!1}();s.Browser={ie:n,ielt9:o,webkit:r,gecko:u&&!r&&!t.opera&&!n,android:h,android23:d,chrome:l,ie3d:_,webkit3d:b,gecko3d:y,opera3d:w,any3d:x,mobile:p,mobileWebkit:p&&r,mobileWebkit3d:p&&b,mobileOpera:p&&t.opera,touch:C,msPointer:m,pointer:f,retina:g}}(),s.Point=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e},s.Point.prototype={clone:function(){return new s.Point(this.x,this.y)},add:function(t){return this.clone()._add(s.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(s.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(t){t=s.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=s.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=s.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+s.Util.formatNum(this.x)+", "+s.Util.formatNum(this.y)+")"}},s.point=function(t,e,n){return t instanceof s.Point?t:s.Util.isArray(t)?new s.Point(t[0],t[1]):t===i||null===t?t:new s.Point(t,e,n)},s.Bounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,s=i.length;s>n;n++)this.extend(i[n])},s.Bounds.prototype={extend:function(t){return t=s.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new s.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new s.Point(this.min.x,this.max.y)},getTopRight:function(){return new s.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof s.Point?s.point(t):s.bounds(t),t instanceof s.Bounds?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=s.bounds(t);var e=this.min,i=this.max,n=t.min,o=t.max,a=o.x>=e.x&&n.x<=i.x,r=o.y>=e.y&&n.y<=i.y;return a&&r},isValid:function(){return!(!this.min||!this.max)}},s.bounds=function(t,e){return!t||t instanceof s.Bounds?t:new s.Bounds(t,e)},s.Transformation=function(t,e,i,n){this._a=t,this._b=e,this._c=i,this._d=n},s.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new s.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},s.DomUtil={get:function(t){return"string"==typeof t?e.getElementById(t):t},getStyle:function(t,i){var n=t.style[i];if(!n&&t.currentStyle&&(n=t.currentStyle[i]),(!n||"auto"===n)&&e.defaultView){var s=e.defaultView.getComputedStyle(t,null);n=s?s[i]:null}return"auto"===n?null:n},getViewportOffset:function(t){var i,n=0,o=0,a=t,r=e.body,l=e.documentElement;do{if(n+=a.offsetTop||0,o+=a.offsetLeft||0,n+=parseInt(s.DomUtil.getStyle(a,"borderTopWidth"),10)||0,o+=parseInt(s.DomUtil.getStyle(a,"borderLeftWidth"),10)||0,i=s.DomUtil.getStyle(a,"position"),a.offsetParent===r&&"absolute"===i)break;if("fixed"===i){n+=r.scrollTop||l.scrollTop||0,o+=r.scrollLeft||l.scrollLeft||0;break}if("relative"===i&&!a.offsetLeft){var c=s.DomUtil.getStyle(a,"width"),h=s.DomUtil.getStyle(a,"max-width"),d=a.getBoundingClientRect();("none"!==c||"none"!==h)&&(o+=d.left+a.clientLeft),n+=d.top+(r.scrollTop||l.scrollTop||0);break}a=a.offsetParent}while(a);a=t;do{if(a===r)break;n-=a.scrollTop||0,o-=a.scrollLeft||0,a=a.parentNode}while(a);return new s.Point(o,n)},documentIsLtr:function(){return s.DomUtil._docIsLtrCached||(s.DomUtil._docIsLtrCached=!0,s.DomUtil._docIsLtr="ltr"===s.DomUtil.getStyle(e.body,"direction")),s.DomUtil._docIsLtr},create:function(t,i,n){var s=e.createElement(t);return s.className=i,n&&n.appendChild(s),s},hasClass:function(t,e){if(t.classList!==i)return t.classList.contains(e);var n=s.DomUtil._getClass(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)},addClass:function(t,e){if(t.classList!==i)for(var n=s.Util.splitWords(e),o=0,a=n.length;a>o;o++)t.classList.add(n[o]);else if(!s.DomUtil.hasClass(t,e)){var r=s.DomUtil._getClass(t);s.DomUtil._setClass(t,(r?r+" ":"")+e)}},removeClass:function(t,e){t.classList!==i?t.classList.remove(e):s.DomUtil._setClass(t,s.Util.trim((" "+s.DomUtil._getClass(t)+" ").replace(" "+e+" "," ")))},_setClass:function(t,e){t.className.baseVal===i?t.className=e:t.className.baseVal=e},_getClass:function(t){return t.className.baseVal===i?t.className:t.className.baseVal},setOpacity:function(t,e){if("opacity"in t.style)t.style.opacity=e;else if("filter"in t.style){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(s){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}},testProp:function(t){for(var i=e.documentElement.style,n=0;n<t.length;n++)if(t[n]in i)return t[n];return!1},getTranslateString:function(t){var e=s.Browser.webkit3d,i="translate"+(e?"3d":"")+"(",n=(e?",0":"")+")";return i+t.x+"px,"+t.y+"px"+n},getScaleString:function(t,e){var i=s.DomUtil.getTranslateString(e.add(e.multiplyBy(-1*t))),n=" scale("+t+") ";return i+n},setPosition:function(t,e,i){t._leaflet_pos=e,!i&&s.Browser.any3d?t.style[s.DomUtil.TRANSFORM]=s.DomUtil.getTranslateString(e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos}},s.DomUtil.TRANSFORM=s.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),s.DomUtil.TRANSITION=s.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),s.DomUtil.TRANSITION_END="webkitTransition"===s.DomUtil.TRANSITION||"OTransition"===s.DomUtil.TRANSITION?s.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart"in e)s.extend(s.DomUtil,{disableTextSelection:function(){s.DomEvent.on(t,"selectstart",s.DomEvent.preventDefault)},enableTextSelection:function(){s.DomEvent.off(t,"selectstart",s.DomEvent.preventDefault)}});else{var i=s.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);s.extend(s.DomUtil,{disableTextSelection:function(){if(i){var t=e.documentElement.style;this._userSelect=t[i],t[i]="none"}},enableTextSelection:function(){i&&(e.documentElement.style[i]=this._userSelect,delete this._userSelect)}})}s.extend(s.DomUtil,{disableImageDrag:function(){s.DomEvent.on(t,"dragstart",s.DomEvent.preventDefault)},enableImageDrag:function(){s.DomEvent.off(t,"dragstart",s.DomEvent.preventDefault)}})}(),s.LatLng=function(t,e,n){if(t=parseFloat(t),e=parseFloat(e),isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=t,this.lng=e,n!==i&&(this.alt=parseFloat(n))},s.extend(s.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),s.LatLng.prototype={equals:function(t){if(!t)return!1;t=s.latLng(t);var e=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return e<=s.LatLng.MAX_MARGIN},toString:function(t){return"LatLng("+s.Util.formatNum(this.lat,t)+", "+s.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){t=s.latLng(t);var e=6378137,i=s.LatLng.DEG_TO_RAD,n=(t.lat-this.lat)*i,o=(t.lng-this.lng)*i,a=this.lat*i,r=t.lat*i,l=Math.sin(n/2),c=Math.sin(o/2),h=l*l+c*c*Math.cos(a)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))},wrap:function(t,e){var i=this.lng;return t=t||-180,e=e||180,i=(i+e)%(e-t)+(t>i||i===e?e:t),new s.LatLng(this.lat,i)}},s.latLng=function(t,e){return t instanceof s.LatLng?t:s.Util.isArray(t)?"number"==typeof t[0]||"string"==typeof t[0]?new s.LatLng(t[0],t[1],t[2]):null:t===i||null===t?t:"object"==typeof t&&"lat"in t?new s.LatLng(t.lat,"lng"in t?t.lng:t.lon):e===i?null:new s.LatLng(t,e)},s.LatLngBounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,s=i.length;s>n;n++)this.extend(i[n])},s.LatLngBounds.prototype={extend:function(t){if(!t)return this;var e=s.latLng(t);return t=null!==e?e:s.latLngBounds(t),t instanceof s.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(t.lat,this._southWest.lat),this._southWest.lng=Math.min(t.lng,this._southWest.lng),this._northEast.lat=Math.max(t.lat,this._northEast.lat),this._northEast.lng=Math.max(t.lng,this._northEast.lng)):(this._southWest=new s.LatLng(t.lat,t.lng),this._northEast=new s.LatLng(t.lat,t.lng)):t instanceof s.LatLngBounds&&(this.extend(t._southWest),this.extend(t._northEast)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,o=Math.abs(e.lng-i.lng)*t;
return new s.LatLngBounds(new s.LatLng(e.lat-n,e.lng-o),new s.LatLng(i.lat+n,i.lng+o))},getCenter:function(){return new s.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new s.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new s.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof s.LatLng?s.latLng(t):s.latLngBounds(t);var e,i,n=this._southWest,o=this._northEast;return t instanceof s.LatLngBounds?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=o.lat&&e.lng>=n.lng&&i.lng<=o.lng},intersects:function(t){t=s.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),o=t.getNorthEast(),a=o.lat>=e.lat&&n.lat<=i.lat,r=o.lng>=e.lng&&n.lng<=i.lng;return a&&r},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return t?(t=s.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},s.latLngBounds=function(t,e){return!t||t instanceof s.LatLngBounds?t:new s.LatLngBounds(t,e)},s.Projection={},s.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(t){var e=s.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),o=t.lng*e,a=n*e;return a=Math.log(Math.tan(Math.PI/4+a/2)),new s.Point(o,a)},unproject:function(t){var e=s.LatLng.RAD_TO_DEG,i=t.x*e,n=(2*Math.atan(Math.exp(t.y))-Math.PI/2)*e;return new s.LatLng(n,i)}},s.Projection.LonLat={project:function(t){return new s.Point(t.lng,t.lat)},unproject:function(t){return new s.LatLng(t.y,t.x)}},s.CRS={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},scale:function(t){return 256*Math.pow(2,t)},getSize:function(t){var e=this.scale(t);return s.point(e,e)}},s.CRS.Simple=s.extend({},s.CRS,{projection:s.Projection.LonLat,transformation:new s.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)}}),s.CRS.EPSG3857=s.extend({},s.CRS,{code:"EPSG:3857",projection:s.Projection.SphericalMercator,transformation:new s.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(t){var e=this.projection.project(t),i=6378137;return e.multiplyBy(i)}}),s.CRS.EPSG900913=s.extend({},s.CRS.EPSG3857,{code:"EPSG:900913"}),s.CRS.EPSG4326=s.extend({},s.CRS,{code:"EPSG:4326",projection:s.Projection.LonLat,transformation:new s.Transformation(1/360,.5,-1/360,.5)}),s.Map=s.Class.extend({includes:s.Mixin.Events,options:{crs:s.CRS.EPSG3857,fadeAnimation:s.DomUtil.TRANSITION&&!s.Browser.android23,trackResize:!0,markerZoomAnimation:s.DomUtil.TRANSITION&&s.Browser.any3d},initialize:function(t,e){e=s.setOptions(this,e),this._initContainer(t),this._initLayout(),this._onResize=s.bind(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.center&&e.zoom!==i&&this.setView(s.latLng(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(e.layers)},setView:function(t,e){return e=e===i?this.getZoom():e,this._resetView(s.latLng(t),this._limitZoom(e)),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=this._limitZoom(t),this)},zoomIn:function(t,e){return this.setZoom(this._zoom+(t||1),e)},zoomOut:function(t,e){return this.setZoom(this._zoom-(t||1),e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),o=this.getSize().divideBy(2),a=t instanceof s.Point?t:this.latLngToContainerPoint(t),r=a.subtract(o).multiplyBy(1-1/n),l=this.containerPointToLatLng(o.add(r));return this.setView(l,e,{zoom:i})},fitBounds:function(t,e){e=e||{},t=t.getBounds?t.getBounds():s.latLngBounds(t);var i=s.point(e.paddingTopLeft||e.padding||[0,0]),n=s.point(e.paddingBottomRight||e.padding||[0,0]),o=this.getBoundsZoom(t,!1,i.add(n)),a=n.subtract(i).divideBy(2),r=this.project(t.getSouthWest(),o),l=this.project(t.getNorthEast(),o),c=this.unproject(r.add(l).divideBy(2).add(a),o);return o=e&&e.maxZoom?Math.min(e.maxZoom,o):o,this.setView(c,o,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t){return this.fire("movestart"),this._rawPanBy(s.point(t)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(t){return t=s.latLngBounds(t),this.options.maxBounds=t,t?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(t,e){var i=this.getCenter(),n=this._limitCenter(i,this._zoom,t);return i.equals(n)?this:this.panTo(n,e)},addLayer:function(t){var e=s.stamp(t);return this._layers[e]?this:(this._layers[e]=t,!t.options||isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[e]=t,this._updateZoomLevels()),this.options.zoomAnimation&&s.TileLayer&&t instanceof s.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,t.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(t),this)},removeLayer:function(t){var e=s.stamp(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&this.fire("layerremove",{layer:t}),this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels()),this.options.zoomAnimation&&s.TileLayer&&t instanceof s.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,t.off("load",this._onTileLayerLoad,this)),this):this},hasLayer:function(t){return t?s.stamp(t)in this._layers:!1},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},invalidateSize:function(t){if(!this._loaded)return this;t=s.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var i=this.getSize(),n=e.divideBy(2).round(),o=i.divideBy(2).round(),a=n.subtract(o);return a.x||a.y?(t.animate&&t.pan?this.panBy(a):(t.pan&&this._rawPanBy(a),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(s.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i})):this},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet}catch(t){this._container._leaflet=i}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new s.LatLngBounds(e,i)},getMinZoom:function(){return this.options.minZoom===i?this._layersMinZoom===i?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===i?this._layersMaxZoom===i?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=s.latLngBounds(t);var n,o=this.getMinZoom()-(e?1:0),a=this.getMaxZoom(),r=this.getSize(),l=t.getNorthWest(),c=t.getSouthEast(),h=!0;i=s.point(i||[0,0]);do o++,n=this.project(c,o).subtract(this.project(l,o)).add(i),h=e?n.x<r.x||n.y<r.y:r.contains(n);while(h&&a>=o);return h&&e?null:e?o:o-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new s.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var t=this._getTopLeftPoint();return new s.Bounds(t,t.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t){var e=this.options.crs;return e.scale(t)/e.scale(this._zoom)},getScaleZoom:function(t){return this._zoom+Math.log(t)/Math.LN2},project:function(t,e){return e=e===i?this._zoom:e,this.options.crs.latLngToPoint(s.latLng(t),e)},unproject:function(t,e){return e=e===i?this._zoom:e,this.options.crs.pointToLatLng(s.point(t),e)},layerPointToLatLng:function(t){var e=s.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(s.latLng(t))._round();return e._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(t){return s.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return s.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(s.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(s.latLng(t)))},mouseEventToContainerPoint:function(t){return s.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=s.DomUtil.get(t);if(!e)throw new Error("Map container not found.");if(e._leaflet)throw new Error("Map container is already initialized.");e._leaflet=!0},_initLayout:function(){var t=this._container;s.DomUtil.addClass(t,"leaflet-container"+(s.Browser.touch?" leaflet-touch":"")+(s.Browser.retina?" leaflet-retina":"")+(s.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var e=s.DomUtil.getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._mapPane=t.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=t.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),t.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),t.shadowPane=this._createPane("leaflet-shadow-pane"),t.overlayPane=this._createPane("leaflet-overlay-pane"),t.markerPane=this._createPane("leaflet-marker-pane"),t.popupPane=this._createPane("leaflet-popup-pane");var e=" leaflet-zoom-hide";this.options.markerZoomAnimation||(s.DomUtil.addClass(t.markerPane,e),s.DomUtil.addClass(t.shadowPane,e),s.DomUtil.addClass(t.popupPane,e))},_createPane:function(t,e){return s.DomUtil.create("div",t,e||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(t){t=t?s.Util.isArray(t)?t:[t]:[];for(var e=0,i=t.length;i>e;e++)this.addLayer(t[e])},_resetView:function(t,e,i,n){var o=this._zoom!==e;n||(this.fire("movestart"),o&&this.fire("zoomstart")),this._zoom=e,this._initialCenter=t,this._initialTopLeftPoint=this._getNewTopLeftPoint(t),i?this._initialTopLeftPoint._add(this._getMapPanePos()):s.DomUtil.setPosition(this._mapPane,new s.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var a=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!i}),a&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("move"),(o||n)&&this.fire("zoomend"),this.fire("moveend",{hard:!i})},_rawPanBy:function(t){s.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var t,e=1/0,n=-1/0,s=this._getZoomSpan();for(t in this._zoomBoundLayers){var o=this._zoomBoundLayers[t];isNaN(o.options.minZoom)||(e=Math.min(e,o.options.minZoom)),isNaN(o.options.maxZoom)||(n=Math.max(n,o.options.maxZoom))}t===i?this._layersMaxZoom=this._layersMinZoom=i:(this._layersMaxZoom=n,this._layersMinZoom=e),s!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){if(s.DomEvent){e=e||"on",s.DomEvent[e](this._container,"click",this._onMouseClick,this);var i,n,o=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(i=0,n=o.length;n>i;i++)s.DomEvent[e](this._container,o[i],this._fireMouseEvent,this);this.options.trackResize&&s.DomEvent[e](t,"resize",this._onResize,this)}},_onResize:function(){s.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=s.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(t){!this._loaded||!t._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||s.DomEvent._skipped(t)||(this.fire("preclick"),this._fireMouseEvent(t))},_fireMouseEvent:function(t){if(this._loaded&&!s.DomEvent._skipped(t)){var e=t.type;if(e="mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,this.hasEventListeners(e)){"contextmenu"===e&&s.DomEvent.preventDefault(t);var i=this.mouseEventToContainerPoint(t),n=this.containerPointToLayerPoint(i),o=this.layerPointToLatLng(n);this.fire(e,{latlng:o,layerPoint:n,containerPoint:i,originalEvent:t})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var t=0,e=this._handlers.length;e>t;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,this):this.on("load",t,e),this},_layerAdd:function(t){t.onAdd(this),this.fire("layeradd",{layer:t})},_getMapPanePos:function(){return s.DomUtil.getPosition(this._mapPane)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewTopLeftPoint(i,e).add(this._getMapPanePos());return this.project(t,e)._subtract(n)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),o=this.getSize().divideBy(2),a=new s.Bounds(n.subtract(o),n.add(o)),r=this._getBoundsOffset(a,i,e);return this.unproject(n.add(r),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new s.Bounds(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=this.project(e.getNorthWest(),i).subtract(t.min),o=this.project(e.getSouthEast(),i).subtract(t.max),a=this._rebound(n.x,-o.x),r=this._rebound(n.y,-o.y);return new s.Point(a,r)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom();return Math.max(e,Math.min(i,t))}}),s.map=function(t,e){return new s.Map(t,e)},s.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(t){var e=s.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),o=this.R_MAJOR,a=this.R_MINOR,r=t.lng*e*o,l=n*e,c=a/o,h=Math.sqrt(1-c*c),d=h*Math.sin(l);d=Math.pow((1-d)/(1+d),.5*h);var u=Math.tan(.5*(.5*Math.PI-l))/d;return l=-o*Math.log(u),new s.Point(r,l)},unproject:function(t){for(var e,i=s.LatLng.RAD_TO_DEG,n=this.R_MAJOR,o=this.R_MINOR,a=t.x*i/n,r=o/n,l=Math.sqrt(1-r*r),c=Math.exp(-t.y/n),h=Math.PI/2-2*Math.atan(c),d=15,u=1e-7,p=d,m=.1;Math.abs(m)>u&&--p>0;)e=l*Math.sin(h),m=Math.PI/2-2*Math.atan(c*Math.pow((1-e)/(1+e),.5*l))-h,h+=m;return new s.LatLng(h*i,a)}},s.CRS.EPSG3395=s.extend({},s.CRS,{code:"EPSG:3395",projection:s.Projection.Mercator,transformation:function(){var t=s.Projection.Mercator,e=t.R_MAJOR,i=.5/(Math.PI*e);return new s.Transformation(i,.5,-i,.5)}()}),s.TileLayer=s.Class.extend({includes:s.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:s.Browser.mobile,updateWhenIdle:s.Browser.mobile},initialize:function(t,e){e=s.setOptions(this,e),e.detectRetina&&s.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomOffset++,e.minZoom>0&&e.minZoom--,this.options.maxZoom--),e.bounds&&(e.bounds=s.latLngBounds(e.bounds)),this._url=t;var i=this.options.subdomains;"string"==typeof i&&(this.options.subdomains=i.split(""))},onAdd:function(t){this._map=t,this._animated=t._zoomAnimated,this._initContainer(),t.on({viewreset:this._reset,moveend:this._update},this),this._animated&&t.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=s.Util.limitExecByInterval(this._update,150,this),t.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this._container.parentNode.removeChild(this._container),t.off({viewreset:this._reset,moveend:this._update},this),this._animated&&t.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||t.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var t=this._map._panes.tilePane;return this._container&&(t.appendChild(this._container),this._setAutoZIndex(t,Math.max)),this},bringToBack:function(){var t=this._map._panes.tilePane;return this._container&&(t.insertBefore(this._container,t.firstChild),this._setAutoZIndex(t,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==i&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t,e){var i,n,s,o=t.children,a=-e(1/0,-1/0);for(n=0,s=o.length;s>n;n++)o[n]!==this._container&&(i=parseInt(o[n].style.zIndex,10),isNaN(i)||(a=e(a,i)));this.options.zIndex=this._container.style.zIndex=(isFinite(a)?a:0)+e(1,-1)},_updateOpacity:function(){var t,e=this._tiles;if(s.Browser.ielt9)for(t in e)s.DomUtil.setOpacity(e[t],this.options.opacity);else s.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var t=this._map._panes.tilePane;if(!this._container){if(this._container=s.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var e="leaflet-tile-container";this._bgBuffer=s.DomUtil.create("div",e,this._container),this._tileContainer=s.DomUtil.create("div",e,this._container)}else this._tileContainer=this._container;t.appendChild(this._container),this.options.opacity<1&&this._updateOpacity()}},_reset:function(t){for(var e in this._tiles)this.fire("tileunload",{tile:this._tiles[e]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&t&&t.hard&&this._clearBgBuffer(),this._initContainer()},_getTileSize:function(){var t=this._map,e=t.getZoom()+this.options.zoomOffset,i=this.options.maxNativeZoom,n=this.options.tileSize;return i&&e>i&&(n=Math.round(t.getZoomScale(e)/t.getZoomScale(i)*n)),n},_update:function(){if(this._map){var t=this._map,e=t.getPixelBounds(),i=t.getZoom(),n=this._getTileSize();if(!(i>this.options.maxZoom||i<this.options.minZoom)){var o=s.bounds(e.min.divideBy(n)._floor(),e.max.divideBy(n)._floor());this._addTilesFromCenterOut(o),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(o)}}},_addTilesFromCenterOut:function(t){var i,n,o,a=[],r=t.getCenter();for(i=t.min.y;i<=t.max.y;i++)for(n=t.min.x;n<=t.max.x;n++)o=new s.Point(n,i),this._tileShouldBeLoaded(o)&&a.push(o);var l=a.length;if(0!==l){a.sort(function(t,e){return t.distanceTo(r)-e.distanceTo(r)});var c=e.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=l,n=0;l>n;n++)this._addTile(a[n],c);this._tileContainer.appendChild(c)}},_tileShouldBeLoaded:function(t){if(t.x+":"+t.y in this._tiles)return!1;var e=this.options;if(!e.continuousWorld){var i=this._getWrapTileNum();if(e.noWrap&&(t.x<0||t.x>=i.x)||t.y<0||t.y>=i.y)return!1}if(e.bounds){var n=e.tileSize,s=t.multiplyBy(n),o=s.add([n,n]),a=this._map.unproject(s),r=this._map.unproject(o);if(e.continuousWorld||e.noWrap||(a=a.wrap(),r=r.wrap()),!e.bounds.intersects([a,r]))return!1}return!0},_removeOtherTiles:function(t){var e,i,n,s;for(s in this._tiles)e=s.split(":"),i=parseInt(e[0],10),n=parseInt(e[1],10),(i<t.min.x||i>t.max.x||n<t.min.y||n>t.max.y)&&this._removeTile(s)},_removeTile:function(t){var e=this._tiles[t];this.fire("tileunload",{tile:e,url:e.src}),this.options.reuseTiles?(s.DomUtil.removeClass(e,"leaflet-tile-loaded"),this._unusedTiles.push(e)):e.parentNode===this._tileContainer&&this._tileContainer.removeChild(e),s.Browser.android||(e.onload=null,e.src=s.Util.emptyImageUrl),delete this._tiles[t]},_addTile:function(t,e){var i=this._getTilePos(t),n=this._getTile();s.DomUtil.setPosition(n,i,s.Browser.chrome),this._tiles[t.x+":"+t.y]=n,this._loadTile(n,t),n.parentNode!==this._tileContainer&&e.appendChild(n)},_getZoomForUrl:function(){var t=this.options,e=this._map.getZoom();return t.zoomReverse&&(e=t.maxZoom-e),e+=t.zoomOffset,t.maxNativeZoom?Math.min(e,t.maxNativeZoom):e},_getTilePos:function(t){var e=this._map.getPixelOrigin(),i=this._getTileSize();return t.multiplyBy(i).subtract(e)},getTileUrl:function(t){return s.Util.template(this._url,s.extend({s:this._getSubdomain(t),z:t.z,x:t.x,y:t.y},this.options))},_getWrapTileNum:function(){var t=this._map.options.crs,e=t.getSize(this._map.getZoom());return e.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(t){var e=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(t.x=(t.x%e.x+e.x)%e.x),this.options.tms&&(t.y=e.y-t.y-1),t.z=this._getZoomForUrl()},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var t=this._unusedTiles.pop();return this._resetTile(t),t}return this._createTile()},_resetTile:function(){},_createTile:function(){var t=s.DomUtil.create("img","leaflet-tile");return t.style.width=t.style.height=this._getTileSize()+"px",t.galleryimg="no",t.onselectstart=t.onmousemove=s.Util.falseFn,s.Browser.ielt9&&this.options.opacity!==i&&s.DomUtil.setOpacity(t,this.options.opacity),s.Browser.mobileWebkit3d&&(t.style.WebkitBackfaceVisibility="hidden"),t},_loadTile:function(t,e){t._layer=this,t.onload=this._tileOnLoad,t.onerror=this._tileOnError,this._adjustTilePoint(e),t.src=this.getTileUrl(e),this.fire("tileloadstart",{tile:t,url:t.src})},_tileLoaded:function(){this._tilesToLoad--,this._animated&&s.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(s.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var t=this._layer;this.src!==s.Util.emptyImageUrl&&(s.DomUtil.addClass(this,"leaflet-tile-loaded"),t.fire("tileload",{tile:this,url:this.src})),t._tileLoaded()},_tileOnError:function(){var t=this._layer;t.fire("tileerror",{tile:this,url:this.src});var e=t.options.errorTileUrl;e&&(this.src=e),t._tileLoaded()}}),s.tileLayer=function(t,e){return new s.TileLayer(t,e)},s.TileLayer.WMS=s.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(t,e){this._url=t;var i=s.extend({},this.defaultWmsParams),n=e.tileSize||this.options.tileSize;i.width=i.height=e.detectRetina&&s.Browser.retina?2*n:n;for(var o in e)this.options.hasOwnProperty(o)||"crs"===o||(i[o]=e[o]);this.wmsParams=i,s.setOptions(this,e)},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,s.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._map,i=this.options.tileSize,n=t.multiplyBy(i),o=n.add([i,i]),a=this._crs.project(e.unproject(n,t.z)),r=this._crs.project(e.unproject(o,t.z)),l=this._wmsVersion>=1.3&&this._crs===s.CRS.EPSG4326?[r.y,a.x,a.y,r.x].join(","):[a.x,r.y,r.x,a.y].join(","),c=s.Util.template(this._url,{s:this._getSubdomain(t)});return c+s.Util.getParamString(this.wmsParams,c,!0)+"&BBOX="+l},setParams:function(t,e){return s.extend(this.wmsParams,t),e||this.redraw(),this}}),s.tileLayer.wms=function(t,e){return new s.TileLayer.WMS(t,e)},s.TileLayer.Canvas=s.TileLayer.extend({options:{async:!1},initialize:function(t){s.setOptions(this,t)},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var t in this._tiles)this._redrawTile(this._tiles[t]);return this},_redrawTile:function(t){this.drawTile(t,t._tilePoint,this._map._zoom)},_createTile:function(){var t=s.DomUtil.create("canvas","leaflet-tile");return t.width=t.height=this.options.tileSize,t.onselectstart=t.onmousemove=s.Util.falseFn,t},_loadTile:function(t,e){t._layer=this,t._tilePoint=e,this._redrawTile(t),this.options.async||this.tileDrawn(t)},drawTile:function(){},tileDrawn:function(t){this._tileOnLoad.call(t)}}),s.tileLayer.canvas=function(t){return new s.TileLayer.Canvas(t)},s.ImageOverlay=s.Class.extend({includes:s.Mixin.Events,options:{opacity:1},initialize:function(t,e,i){this._url=t,this._bounds=s.latLngBounds(e),s.setOptions(this,i)},onAdd:function(t){this._map=t,this._image||this._initImage(),t._panes.overlayPane.appendChild(this._image),t.on("viewreset",this._reset,this),t.options.zoomAnimation&&s.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._image),t.off("viewreset",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var t=this._map._panes.overlayPane;return this._image&&t.insertBefore(this._image,t.firstChild),this},setUrl:function(t){this._url=t,this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=s.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&s.Browser.any3d?s.DomUtil.addClass(this._image,"leaflet-zoom-animated"):s.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),s.extend(this._image,{galleryimg:"no",onselectstart:s.Util.falseFn,onmousemove:s.Util.falseFn,onload:s.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(t){var e=this._map,i=this._image,n=e.getZoomScale(t.zoom),o=this._bounds.getNorthWest(),a=this._bounds.getSouthEast(),r=e._latLngToNewLayerPoint(o,t.zoom,t.center),l=e._latLngToNewLayerPoint(a,t.zoom,t.center)._subtract(r),c=r._add(l._multiplyBy(.5*(1-1/n)));i.style[s.DomUtil.TRANSFORM]=s.DomUtil.getTranslateString(c)+" scale("+n+") "},_reset:function(){var t=this._image,e=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),i=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(e);s.DomUtil.setPosition(t,e),t.style.width=i.x+"px",t.style.height=i.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){s.DomUtil.setOpacity(this._image,this.options.opacity)}}),s.imageOverlay=function(t,e,i){return new s.ImageOverlay(t,e,i)},s.Icon=s.Class.extend({options:{className:""},initialize:function(t){s.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n;return n=e&&"IMG"===e.tagName?this._createImg(i,e):this._createImg(i),this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i,n=this.options,o=s.point(n[e+"Size"]);i="shadow"===e?s.point(n.shadowAnchor||n.iconAnchor):s.point(n.iconAnchor),!i&&o&&(i=o.divideBy(2,!0)),t.className="leaflet-marker-"+e+" "+n.className,i&&(t.style.marginLeft=-i.x+"px",t.style.marginTop=-i.y+"px"),o&&(t.style.width=o.x+"px",t.style.height=o.y+"px")},_createImg:function(t,i){return i=i||e.createElement("img"),i.src=t,i},_getIconUrl:function(t){return s.Browser.retina&&this.options[t+"RetinaUrl"]?this.options[t+"RetinaUrl"]:this.options[t+"Url"]}}),s.icon=function(t){return new s.Icon(t)},s.Icon.Default=s.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(t){var e=t+"Url";if(this.options[e])return this.options[e];s.Browser.retina&&"icon"===t&&(t+="-2x");var i=s.Icon.Default.imagePath;if(!i)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return i+"/marker-"+t+".png"}}),s.Icon.Default.imagePath=function(){var t,i,n,s,o,a=e.getElementsByTagName("script"),r=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(t=0,i=a.length;i>t;t++)if(n=a[t].src,s=n.match(r))return o=n.split(r)[0],(o?o+"/":"")+"images"}(),s.Marker=s.Class.extend({includes:s.Mixin.Events,options:{icon:new s.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(t,e){s.setOptions(this,e),this._latlng=s.latLng(t)},onAdd:function(t){this._map=t,t.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),t.options.zoomAnimation&&t.options.markerZoomAnimation&&t.on("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),t.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=s.latLng(t),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update(),this},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){if(this._icon){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e=this._map,i=e.options.zoomAnimation&&e.options.markerZoomAnimation,n=i?"leaflet-zoom-animated":"leaflet-zoom-hide",o=t.icon.createIcon(this._icon),a=!1;o!==this._icon&&(this._icon&&this._removeIcon(),a=!0,t.title&&(o.title=t.title),t.alt&&(o.alt=t.alt)),s.DomUtil.addClass(o,n),t.keyboard&&(o.tabIndex="0"),this._icon=o,this._initInteraction(),t.riseOnHover&&s.DomEvent.on(o,"mouseover",this._bringToFront,this).on(o,"mouseout",this._resetZIndex,this);var r=t.icon.createShadow(this._shadow),l=!1;
r!==this._shadow&&(this._removeShadow(),l=!0),r&&s.DomUtil.addClass(r,n),this._shadow=r,t.opacity<1&&this._updateOpacity();var c=this._map._panes;a&&c.markerPane.appendChild(this._icon),r&&l&&c.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&s.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(t){s.DomUtil.setPosition(this._icon,t),this._shadow&&s.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu"];s.DomUtil.addClass(t,"leaflet-clickable"),s.DomEvent.on(t,"click",this._onMouseClick,this),s.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var i=0;i<e.length;i++)s.DomEvent.on(t,e[i],this._fireMouseEvent,this);s.Handler.MarkerDrag&&(this.dragging=new s.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(t){var e=this.dragging&&this.dragging.moved();(this.hasEventListeners(t.type)||e)&&s.DomEvent.stopPropagation(t),e||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(t.type,{originalEvent:t,latlng:this._latlng})},_onKeyPress:function(t){13===t.keyCode&&this.fire("click",{originalEvent:t,latlng:this._latlng})},_fireMouseEvent:function(t){this.fire(t.type,{originalEvent:t,latlng:this._latlng}),"contextmenu"===t.type&&this.hasEventListeners(t.type)&&s.DomEvent.preventDefault(t),"mousedown"!==t.type?s.DomEvent.stopPropagation(t):s.DomEvent.preventDefault(t)},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){s.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&s.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),s.marker=function(t,e){return new s.Marker(t,e)},s.DivIcon=s.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(t){var i=t&&"DIV"===t.tagName?t:e.createElement("div"),n=this.options;return i.innerHTML=n.html!==!1?n.html:"",n.bgPos&&(i.style.backgroundPosition=-n.bgPos.x+"px "+-n.bgPos.y+"px"),this._setIconStyles(i,"icon"),i},createShadow:function(){return null}}),s.divIcon=function(t){return new s.DivIcon(t)},s.Map.mergeOptions({closePopupOnClick:!0}),s.Popup=s.Class.extend({includes:s.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(t,e){s.setOptions(this,t),this._source=e,this._animated=s.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(t){this._map=t,this._container||this._initLayout();var e=t.options.fadeAnimation;e&&s.DomUtil.setOpacity(this._container,0),t._panes.popupPane.appendChild(this._container),t.on(this._getEvents(),this),this.update(),e&&s.DomUtil.setOpacity(this._container,1),this.fire("open"),t.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(t){return t.addLayer(this),this},openOn:function(t){return t.openPopup(this),this},onRemove:function(t){t._panes.popupPane.removeChild(this._container),s.Util.falseFn(this._container.offsetWidth),t.off(this._getEvents(),this),t.options.fadeAnimation&&s.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),t.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=s.latLng(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_getEvents:function(){var t={viewreset:this._updatePosition};return this._animated&&(t.zoomanim=this._zoomAnimation),("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t,e="leaflet-popup",i=e+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),n=this._container=s.DomUtil.create("div",i);this.options.closeButton&&(t=this._closeButton=s.DomUtil.create("a",e+"-close-button",n),t.href="#close",t.innerHTML="&#215;",s.DomEvent.disableClickPropagation(t),s.DomEvent.on(t,"click",this._onCloseButtonClick,this));var o=this._wrapper=s.DomUtil.create("div",e+"-content-wrapper",n);s.DomEvent.disableClickPropagation(o),this._contentNode=s.DomUtil.create("div",e+"-content",o),s.DomEvent.disableScrollPropagation(this._contentNode),s.DomEvent.on(o,"contextmenu",s.DomEvent.stopPropagation),this._tipContainer=s.DomUtil.create("div",e+"-tip-container",n),this._tip=s.DomUtil.create("div",e+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,o=this.options.maxHeight,a="leaflet-popup-scrolled";o&&n>o?(e.height=o+"px",s.DomUtil.addClass(t,a)):s.DomUtil.removeClass(t,a),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=this._animated,i=s.point(this.options.offset);e&&s.DomUtil.setPosition(this._container,t),this._containerBottom=-i.y-(e?0:t.y),this._containerLeft=-Math.round(this._containerWidth/2)+i.x+(e?0:t.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);s.DomUtil.setPosition(this._container,e)},_adjustPan:function(){if(this.options.autoPan){var t=this._map,e=this._container.offsetHeight,i=this._containerWidth,n=new s.Point(this._containerLeft,-e-this._containerBottom);this._animated&&n._add(s.DomUtil.getPosition(this._container));var o=t.layerPointToContainerPoint(n),a=s.point(this.options.autoPanPadding),r=s.point(this.options.autoPanPaddingTopLeft||a),l=s.point(this.options.autoPanPaddingBottomRight||a),c=t.getSize(),h=0,d=0;o.x+i+l.x>c.x&&(h=o.x+i-c.x+l.x),o.x-h-r.x<0&&(h=o.x-r.x),o.y+e+l.y>c.y&&(d=o.y+e-c.y+l.y),o.y-d-r.y<0&&(d=o.y-r.y),(h||d)&&t.fire("autopanstart").panBy([h,d])}},_onCloseButtonClick:function(t){this._close(),s.DomEvent.stop(t)}}),s.popup=function(t,e){return new s.Popup(t,e)},s.Map.include({openPopup:function(t,e,i){if(this.closePopup(),!(t instanceof s.Popup)){var n=t;t=new s.Popup(i).setLatLng(e).setContent(n)}return t._isOpen=!0,this._popup=t,this.addLayer(t)},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&(this.removeLayer(t),t._isOpen=!1),this}}),s.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(t,e){var i=s.point(this.options.icon.options.popupAnchor||[0,0]);return i=i.add(s.Popup.prototype.options.offset),e&&e.offset&&(i=i.add(e.offset)),e=s.extend({offset:i},e),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),t instanceof s.Popup?(s.setOptions(t,e),this._popup=t):this._popup=new s.Popup(e,this).setContent(t),this},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this},getPopup:function(){return this._popup},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),s.LayerGroup=s.Class.extend({initialize:function(t){this._layers={};var e,i;if(t)for(e=0,i=t.length;i>e;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return t?t in this._layers||this.getLayerId(t)in this._layers:!1},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)i=this._layers[e],i[t]&&i[t].apply(i,n);return this},onAdd:function(t){this._map=t,this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t),this._map=null},addTo:function(t){return t.addLayer(this),this},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return s.stamp(t)}}),s.layerGroup=function(t){return new s.LayerGroup(t)},s.FeatureGroup=s.LayerGroup.extend({includes:s.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(t){return this.hasLayer(t)?this:("on"in t&&t.on(s.FeatureGroup.EVENTS,this._propagateEvent,this),s.LayerGroup.prototype.addLayer.call(this,t),this._popupContent&&t.bindPopup&&t.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.off(s.FeatureGroup.EVENTS,this._propagateEvent,this),s.LayerGroup.prototype.removeLayer.call(this,t),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:t})):this},bindPopup:function(t,e){return this._popupContent=t,this._popupOptions=e,this.invoke("bindPopup",t,e)},openPopup:function(t){for(var e in this._layers){this._layers[e].openPopup(t);break}return this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new s.LatLngBounds;return this.eachLayer(function(e){t.extend(e instanceof s.Marker?e.getLatLng():e.getBounds())}),t},_propagateEvent:function(t){t=s.extend({layer:t.target,target:this},t),this.fire(t.type,t)}}),s.featureGroup=function(t){return new s.FeatureGroup(t)},s.Path=s.Class.extend({includes:[s.Mixin.Events],statics:{CLIP_PADDING:function(){var e=s.Browser.mobile?1280:2e3,i=(e/Math.max(t.outerWidth,t.outerHeight)-1)/2;return Math.max(0,Math.min(.5,i))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(t){s.setOptions(this,t)},onAdd:function(t){this._map=t,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),t.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,s.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),t.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(t){return s.setOptions(this,t),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),s.Map.include({_updatePathViewport:function(){var t=s.Path.CLIP_PADDING,e=this.getSize(),i=s.DomUtil.getPosition(this._mapPane),n=i.multiplyBy(-1)._subtract(e.multiplyBy(t)._round()),o=n.add(e.multiplyBy(1+2*t)._round());this._pathViewport=new s.Bounds(n,o)}}),s.Path.SVG_NS="http://www.w3.org/2000/svg",s.Browser.svg=!(!e.createElementNS||!e.createElementNS(s.Path.SVG_NS,"svg").createSVGRect),s.Path=s.Path.extend({statics:{SVG:s.Browser.svg},bringToFront:function(){var t=this._map._pathRoot,e=this._container;return e&&t.lastChild!==e&&t.appendChild(e),this},bringToBack:function(){var t=this._map._pathRoot,e=this._container,i=t.firstChild;return e&&i!==e&&t.insertBefore(e,i),this},getPathString:function(){},_createElement:function(t){return e.createElementNS(s.Path.SVG_NS,t)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&s.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var t=this.getPathString();t||(t="M0 0"),this._path.setAttribute("d",t)},_initEvents:function(){if(this.options.clickable){(s.Browser.svg||!s.Browser.vml)&&s.DomUtil.addClass(this._path,"leaflet-clickable"),s.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var t=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],e=0;e<t.length;e++)s.DomEvent.on(this._container,t[e],this._fireMouseEvent,this)}},_onMouseClick:function(t){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(t)},_fireMouseEvent:function(t){if(this.hasEventListeners(t.type)){var e=this._map,i=e.mouseEventToContainerPoint(t),n=e.containerPointToLayerPoint(i),o=e.layerPointToLatLng(n);this.fire(t.type,{latlng:o,layerPoint:n,containerPoint:i,originalEvent:t}),"contextmenu"===t.type&&s.DomEvent.preventDefault(t),"mousemove"!==t.type&&s.DomEvent.stopPropagation(t)}}}),s.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=s.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&s.Browser.any3d?(s.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):s.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(t){var e=this.getZoomScale(t.zoom),i=this._getCenterOffset(t.center)._multiplyBy(-e)._add(this._pathViewport.min);this._pathRoot.style[s.DomUtil.TRANSFORM]=s.DomUtil.getTranslateString(i)+" scale("+e+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max,n=i.x-e.x,o=i.y-e.y,a=this._pathRoot,r=this._panes.overlayPane;s.Browser.mobileWebkit&&r.removeChild(a),s.DomUtil.setPosition(a,e),a.setAttribute("width",n),a.setAttribute("height",o),a.setAttribute("viewBox",[e.x,e.y,n,o].join(" ")),s.Browser.mobileWebkit&&r.appendChild(a)}}}),s.Path.include({bindPopup:function(t,e){return t instanceof s.Popup?this._popup=t:((!this._popup||e)&&(this._popup=new s.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(t){return this._popup&&(t=t||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:t})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(t){this._popup.setLatLng(t.latlng),this._map.openPopup(this._popup)}}),s.Browser.vml=!s.Browser.svg&&function(){try{var t=e.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&"object"==typeof i.adj}catch(n){return!1}}(),s.Path=s.Browser.svg||!s.Browser.vml?s.Path:s.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return e.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return e.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var t=this._container=this._createElement("shape");s.DomUtil.addClass(t,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&s.DomUtil.addClass(t,"leaflet-clickable"),t.coordsize="1 1",this._path=this._createElement("path"),t.appendChild(this._path),this._map._pathRoot.appendChild(t)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var t=this._stroke,e=this._fill,i=this.options,n=this._container;n.stroked=i.stroke,n.filled=i.fill,i.stroke?(t||(t=this._stroke=this._createElement("stroke"),t.endcap="round",n.appendChild(t)),t.weight=i.weight+"px",t.color=i.color,t.opacity=i.opacity,t.dashStyle=i.dashArray?s.Util.isArray(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):"",i.lineCap&&(t.endcap=i.lineCap.replace("butt","flat")),i.lineJoin&&(t.joinstyle=i.lineJoin)):t&&(n.removeChild(t),this._stroke=null),i.fill?(e||(e=this._fill=this._createElement("fill"),n.appendChild(e)),e.color=i.fillColor||i.color,e.opacity=i.fillOpacity):e&&(n.removeChild(e),this._fill=null)},_updatePath:function(){var t=this._container.style;t.display="none",this._path.v=this.getPathString()+" ",t.display=""}}),s.Map.include(s.Browser.svg||!s.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var t=this._pathRoot=e.createElement("div");t.className="leaflet-vml-container",this._panes.overlayPane.appendChild(t),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),s.Browser.canvas=function(){return!!e.createElement("canvas").getContext}(),s.Path=s.Path.SVG&&!t.L_PREFER_CANVAS||!s.Browser.canvas?s.Path:s.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(t){return s.setOptions(this,t),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(t){t.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this.fire("remove"),this._map=null},_requestUpdate:function(){this._map&&!s.Path._updateRequest&&(s.Path._updateRequest=s.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){s.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var t=this.options;t.stroke&&(this._ctx.lineWidth=t.weight,this._ctx.strokeStyle=t.color),t.fill&&(this._ctx.fillStyle=t.fillColor||t.color)},_drawPath:function(){var t,e,i,n,o,a;for(this._ctx.beginPath(),t=0,i=this._parts.length;i>t;t++){for(e=0,n=this._parts[t].length;n>e;e++)o=this._parts[t][e],a=(0===e?"move":"line")+"To",this._ctx[a](o.x,o.y);this instanceof s.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var t=this._ctx,e=this.options;this._drawPath(),t.save(),this._updateStyle(),e.fill&&(t.globalAlpha=e.fillOpacity,t.fill()),e.stroke&&(t.globalAlpha=e.opacity,t.stroke()),t.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onClick,this))},_onClick:function(t){this._containsPoint(t.layerPoint)&&this.fire("click",t)},_onMouseMove:function(t){this._map&&!this._map._animatingZoom&&(this._containsPoint(t.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",t)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",t)))}}),s.Map.include(s.Path.SVG&&!t.L_PREFER_CANVAS||!s.Browser.canvas?{}:{_initPathRoot:function(){var t,i=this._pathRoot;i||(i=this._pathRoot=e.createElement("canvas"),i.style.position="absolute",t=this._canvasCtx=i.getContext("2d"),t.lineCap="round",t.lineJoin="round",this._panes.overlayPane.appendChild(i),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max.subtract(e),n=this._pathRoot;s.DomUtil.setPosition(n,e),n.width=i.x,n.height=i.y,n.getContext("2d").translate(-e.x,-e.y)}}}),s.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=this._reducePoints(t,i),t=this._simplifyDP(t,i)},pointToSegmentDistance:function(t,e,i){return Math.sqrt(this._sqClosestPointOnSegment(t,e,i,!0))},closestPointOnSegment:function(t,e,i){return this._sqClosestPointOnSegment(t,e,i)},_simplifyDP:function(t,e){var n=t.length,s=typeof Uint8Array!=i+""?Uint8Array:Array,o=new s(n);o[0]=o[n-1]=1,this._simplifyDPStep(t,o,e,0,n-1);var a,r=[];for(a=0;n>a;a++)o[a]&&r.push(t[a]);return r},_simplifyDPStep:function(t,e,i,n,s){var o,a,r,l=0;for(a=n+1;s-1>=a;a++)r=this._sqClosestPointOnSegment(t[a],t[n],t[s],!0),r>l&&(o=a,l=r);l>i&&(e[o]=1,this._simplifyDPStep(t,e,i,n,o),this._simplifyDPStep(t,e,i,o,s))},_reducePoints:function(t,e){for(var i=[t[0]],n=1,s=0,o=t.length;o>n;n++)this._sqDist(t[n],t[s])>e&&(i.push(t[n]),s=n);return o-1>s&&i.push(t[o-1]),i},clipSegment:function(t,e,i,n){var s,o,a,r=n?this._lastCode:this._getBitCode(t,i),l=this._getBitCode(e,i);for(this._lastCode=l;;){if(!(r|l))return[t,e];if(r&l)return!1;s=r||l,o=this._getEdgeIntersection(t,e,s,i),a=this._getBitCode(o,i),s===r?(t=o,r=a):(e=o,l=a)}},_getEdgeIntersection:function(t,e,i,n){var o=e.x-t.x,a=e.y-t.y,r=n.min,l=n.max;return 8&i?new s.Point(t.x+o*(l.y-t.y)/a,l.y):4&i?new s.Point(t.x+o*(r.y-t.y)/a,r.y):2&i?new s.Point(l.x,t.y+a*(l.x-t.x)/o):1&i?new s.Point(r.x,t.y+a*(r.x-t.x)/o):void 0},_getBitCode:function(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},_sqClosestPointOnSegment:function(t,e,i,n){var o,a=e.x,r=e.y,l=i.x-a,c=i.y-r,h=l*l+c*c;return h>0&&(o=((t.x-a)*l+(t.y-r)*c)/h,o>1?(a=i.x,r=i.y):o>0&&(a+=l*o,r+=c*o)),l=t.x-a,c=t.y-r,n?l*l+c*c:new s.Point(a,r)}},s.Polyline=s.Path.extend({initialize:function(t,e){s.Path.prototype.initialize.call(this,e),this._latlngs=this._convertLatLngs(t)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var t=0,e=this._latlngs.length;e>t;t++)this._originalPoints[t]=this._map.latLngToLayerPoint(this._latlngs[t])},getPathString:function(){for(var t=0,e=this._parts.length,i="";e>t;t++)i+=this._getPathPartStr(this._parts[t]);return i},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._latlngs=this._convertLatLngs(t),this.redraw()},addLatLng:function(t){return this._latlngs.push(s.latLng(t)),this.redraw()},spliceLatLngs:function(){var t=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),t},closestLayerPoint:function(t){for(var e,i,n=1/0,o=this._parts,a=null,r=0,l=o.length;l>r;r++)for(var c=o[r],h=1,d=c.length;d>h;h++){e=c[h-1],i=c[h];var u=s.LineUtil._sqClosestPointOnSegment(t,e,i,!0);n>u&&(n=u,a=s.LineUtil._sqClosestPointOnSegment(t,e,i))}return a&&(a.distance=Math.sqrt(n)),a},getBounds:function(){return new s.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(t,e){var i,n,o=e?t:[];for(i=0,n=t.length;n>i;i++){if(s.Util.isArray(t[i])&&"number"!=typeof t[i][0])return;o[i]=s.latLng(t[i])}return o},_initEvents:function(){s.Path.prototype._initEvents.call(this)},_getPathPartStr:function(t){for(var e,i=s.Path.VML,n=0,o=t.length,a="";o>n;n++)e=t[n],i&&e._round(),a+=(n?"L":"M")+e.x+" "+e.y;return a},_clipPoints:function(){var t,e,i,n=this._originalPoints,o=n.length;if(this.options.noClip)return this._parts=[n],void 0;this._parts=[];var a=this._parts,r=this._map._pathViewport,l=s.LineUtil;for(t=0,e=0;o-1>t;t++)i=l.clipSegment(n[t],n[t+1],r,t),i&&(a[e]=a[e]||[],a[e].push(i[0]),(i[1]!==n[t+1]||t===o-2)&&(a[e].push(i[1]),e++))},_simplifyPoints:function(){for(var t=this._parts,e=s.LineUtil,i=0,n=t.length;n>i;i++)t[i]=e.simplify(t[i],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),s.Path.prototype._updatePath.call(this))}}),s.polyline=function(t,e){return new s.Polyline(t,e)},s.PolyUtil={},s.PolyUtil.clipPolygon=function(t,e){var i,n,o,a,r,l,c,h,d,u=[1,4,2,8],p=s.LineUtil;for(n=0,c=t.length;c>n;n++)t[n]._code=p._getBitCode(t[n],e);for(a=0;4>a;a++){for(h=u[a],i=[],n=0,c=t.length,o=c-1;c>n;o=n++)r=t[n],l=t[o],r._code&h?l._code&h||(d=p._getEdgeIntersection(l,r,h,e),d._code=p._getBitCode(d,e),i.push(d)):(l._code&h&&(d=p._getEdgeIntersection(l,r,h,e),d._code=p._getBitCode(d,e),i.push(d)),i.push(r));t=i}return t},s.Polygon=s.Polyline.extend({options:{fill:!0},initialize:function(t,e){s.Polyline.prototype.initialize.call(this,t,e),this._initWithHoles(t)},_initWithHoles:function(t){var e,i,n;if(t&&s.Util.isArray(t[0])&&"number"!=typeof t[0][0])for(this._latlngs=this._convertLatLngs(t[0]),this._holes=t.slice(1),e=0,i=this._holes.length;i>e;e++)n=this._holes[e]=this._convertLatLngs(this._holes[e]),n[0].equals(n[n.length-1])&&n.pop();t=this._latlngs,t.length>=2&&t[0].equals(t[t.length-1])&&t.pop()},projectLatlngs:function(){if(s.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var t,e,i,n;for(t=0,i=this._holes.length;i>t;t++)for(this._holePoints[t]=[],e=0,n=this._holes[t].length;n>e;e++)this._holePoints[t][e]=this._map.latLngToLayerPoint(this._holes[t][e])}},setLatLngs:function(t){return t&&s.Util.isArray(t[0])&&"number"!=typeof t[0][0]?(this._initWithHoles(t),this.redraw()):s.Polyline.prototype.setLatLngs.call(this,t)},_clipPoints:function(){var t=this._originalPoints,e=[];if(this._parts=[t].concat(this._holePoints),!this.options.noClip){for(var i=0,n=this._parts.length;n>i;i++){var o=s.PolyUtil.clipPolygon(this._parts[i],this._map._pathViewport);o.length&&e.push(o)}this._parts=e}},_getPathPartStr:function(t){var e=s.Polyline.prototype._getPathPartStr.call(this,t);return e+(s.Browser.svg?"z":"x")}}),s.polygon=function(t,e){return new s.Polygon(t,e)},function(){function t(t){return s.FeatureGroup.extend({initialize:function(t,e){this._layers={},this._options=e,this.setLatLngs(t)},setLatLngs:function(e){var i=0,n=e.length;for(this.eachLayer(function(t){n>i?t.setLatLngs(e[i++]):this.removeLayer(t)},this);n>i;)this.addLayer(new t(e[i++],this._options));return this},getLatLngs:function(){var t=[];return this.eachLayer(function(e){t.push(e.getLatLngs())}),t}})}s.MultiPolyline=t(s.Polyline),s.MultiPolygon=t(s.Polygon),s.multiPolyline=function(t,e){return new s.MultiPolyline(t,e)},s.multiPolygon=function(t,e){return new s.MultiPolygon(t,e)}}(),s.Rectangle=s.Polygon.extend({initialize:function(t,e){s.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=s.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),s.rectangle=function(t,e){return new s.Rectangle(t,e)},s.Circle=s.Path.extend({initialize:function(t,e,i){s.Path.prototype.initialize.call(this,i),this._latlng=s.latLng(t),this._mRadius=e},options:{fill:!0},setLatLng:function(t){return this._latlng=s.latLng(t),this.redraw()},setRadius:function(t){return this._mRadius=t,this.redraw()},projectLatlngs:function(){var t=this._getLngRadius(),e=this._latlng,i=this._map.latLngToLayerPoint([e.lat,e.lng-t]);this._point=this._map.latLngToLayerPoint(e),this._radius=Math.max(this._point.x-i.x,1)},getBounds:function(){var t=this._getLngRadius(),e=360*(this._mRadius/40075017),i=this._latlng;return new s.LatLngBounds([i.lat-e,i.lng-t],[i.lat+e,i.lng+t])},getLatLng:function(){return this._latlng},getPathString:function(){var t=this._point,e=this._radius;return this._checkIfEmpty()?"":s.Browser.svg?"M"+t.x+","+(t.y-e)+"A"+e+","+e+",0,1,1,"+(t.x-.1)+","+(t.y-e)+" z":(t._round(),e=Math.round(e),"AL "+t.x+","+t.y+" "+e+","+e+" 0,"+23592600)},getRadius:function(){return this._mRadius},_getLatRadius:function(){return 360*(this._mRadius/40075017)},_getLngRadius:function(){return this._getLatRadius()/Math.cos(s.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var t=this._map._pathViewport,e=this._radius,i=this._point;return i.x-e>t.max.x||i.y-e>t.max.y||i.x+e<t.min.x||i.y+e<t.min.y}}),s.circle=function(t,e,i){return new s.Circle(t,e,i)},s.CircleMarker=s.Circle.extend({options:{radius:10,weight:2},initialize:function(t,e){s.Circle.prototype.initialize.call(this,t,null,e),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){s.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setLatLng:function(t){return s.Circle.prototype.setLatLng.call(this,t),this._popup&&this._popup._isOpen&&this._popup.setLatLng(t),this},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius}}),s.circleMarker=function(t,e){return new s.CircleMarker(t,e)},s.Polyline.include(s.Path.CANVAS?{_containsPoint:function(t,e){var i,n,o,a,r,l,c,h=this.options.weight/2;
for(s.Browser.touch&&(h+=10),i=0,a=this._parts.length;a>i;i++)for(c=this._parts[i],n=0,r=c.length,o=r-1;r>n;o=n++)if((e||0!==n)&&(l=s.LineUtil.pointToSegmentDistance(t,c[o],c[n]),h>=l))return!0;return!1}}:{}),s.Polygon.include(s.Path.CANVAS?{_containsPoint:function(t){var e,i,n,o,a,r,l,c,h=!1;if(s.Polyline.prototype._containsPoint.call(this,t,!0))return!0;for(o=0,l=this._parts.length;l>o;o++)for(e=this._parts[o],a=0,c=e.length,r=c-1;c>a;r=a++)i=e[a],n=e[r],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(h=!h);return h}}:{}),s.Circle.include(s.Path.CANVAS?{_drawPath:function(){var t=this._point;this._ctx.beginPath(),this._ctx.arc(t.x,t.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(t){var e=this._point,i=this.options.stroke?this.options.weight/2:0;return t.distanceTo(e)<=this._radius+i}}:{}),s.CircleMarker.include(s.Path.CANVAS?{_updateStyle:function(){s.Path.prototype._updateStyle.call(this)}}:{}),s.GeoJSON=s.FeatureGroup.extend({initialize:function(t,e){s.setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,o=s.Util.isArray(t)?t:t.features;if(o){for(e=0,i=o.length;i>e;e++)n=o[e],(n.geometries||n.geometry||n.features||n.coordinates)&&this.addData(o[e]);return this}var a=this.options;if(!a.filter||a.filter(t)){var r=s.GeoJSON.geometryToLayer(t,a.pointToLayer,a.coordsToLatLng,a);return r.feature=s.GeoJSON.asFeature(t),r.defaultOptions=r.options,this.resetStyle(r),a.onEachFeature&&a.onEachFeature(t,r),this.addLayer(r)}},resetStyle:function(t){var e=this.options.style;e&&(s.Util.extend(t.options,t.defaultOptions),this._setLayerStyle(t,e))},setStyle:function(t){this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),s.extend(s.GeoJSON,{geometryToLayer:function(t,e,i,n){var o,a,r,l,c="Feature"===t.type?t.geometry:t,h=c.coordinates,d=[];switch(i=i||this.coordsToLatLng,c.type){case"Point":return o=i(h),e?e(t,o):new s.Marker(o);case"MultiPoint":for(r=0,l=h.length;l>r;r++)o=i(h[r]),d.push(e?e(t,o):new s.Marker(o));return new s.FeatureGroup(d);case"LineString":return a=this.coordsToLatLngs(h,0,i),new s.Polyline(a,n);case"Polygon":if(2===h.length&&!h[1].length)throw new Error("Invalid GeoJSON object.");return a=this.coordsToLatLngs(h,1,i),new s.Polygon(a,n);case"MultiLineString":return a=this.coordsToLatLngs(h,1,i),new s.MultiPolyline(a,n);case"MultiPolygon":return a=this.coordsToLatLngs(h,2,i),new s.MultiPolygon(a,n);case"GeometryCollection":for(r=0,l=c.geometries.length;l>r;r++)d.push(this.geometryToLayer({geometry:c.geometries[r],type:"Feature",properties:t.properties},e,i,n));return new s.FeatureGroup(d);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t){return new s.LatLng(t[1],t[0],t[2])},coordsToLatLngs:function(t,e,i){var n,s,o,a=[];for(s=0,o=t.length;o>s;s++)n=e?this.coordsToLatLngs(t[s],e-1,i):(i||this.coordsToLatLng)(t[s]),a.push(n);return a},latLngToCoords:function(t){var e=[t.lng,t.lat];return t.alt!==i&&e.push(t.alt),e},latLngsToCoords:function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(s.GeoJSON.latLngToCoords(t[i]));return e},getFeature:function(t,e){return t.feature?s.extend({},t.feature,{geometry:e}):s.GeoJSON.asFeature(e)},asFeature:function(t){return"Feature"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var a={toGeoJSON:function(){return s.GeoJSON.getFeature(this,{type:"Point",coordinates:s.GeoJSON.latLngToCoords(this.getLatLng())})}};s.Marker.include(a),s.Circle.include(a),s.CircleMarker.include(a),s.Polyline.include({toGeoJSON:function(){return s.GeoJSON.getFeature(this,{type:"LineString",coordinates:s.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),s.Polygon.include({toGeoJSON:function(){var t,e,i,n=[s.GeoJSON.latLngsToCoords(this.getLatLngs())];if(n[0].push(n[0][0]),this._holes)for(t=0,e=this._holes.length;e>t;t++)i=s.GeoJSON.latLngsToCoords(this._holes[t]),i.push(i[0]),n.push(i);return s.GeoJSON.getFeature(this,{type:"Polygon",coordinates:n})}}),function(){function t(t){return function(){var e=[];return this.eachLayer(function(t){e.push(t.toGeoJSON().geometry.coordinates)}),s.GeoJSON.getFeature(this,{type:t,coordinates:e})}}s.MultiPolyline.include({toGeoJSON:t("MultiLineString")}),s.MultiPolygon.include({toGeoJSON:t("MultiPolygon")}),s.LayerGroup.include({toGeoJSON:function(){var e,i=this.feature&&this.feature.geometry,n=[];if(i&&"MultiPoint"===i.type)return t("MultiPoint").call(this);var o=i&&"GeometryCollection"===i.type;return this.eachLayer(function(t){t.toGeoJSON&&(e=t.toGeoJSON(),n.push(o?e.geometry:s.GeoJSON.asFeature(e)))}),o?s.GeoJSON.getFeature(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}})}(),s.geoJson=function(t,e){return new s.GeoJSON(t,e)},s.DomEvent={addListener:function(t,e,i,n){var o,a,r,l=s.stamp(i),c="_leaflet_"+e+l;return t[c]?this:(o=function(e){return i.call(n||t,e||s.DomEvent._getEvent())},s.Browser.pointer&&0===e.indexOf("touch")?this.addPointerListener(t,e,o,l):(s.Browser.touch&&"dblclick"===e&&this.addDoubleTapListener&&this.addDoubleTapListener(t,o,l),"addEventListener"in t?"mousewheel"===e?(t.addEventListener("DOMMouseScroll",o,!1),t.addEventListener(e,o,!1)):"mouseenter"===e||"mouseleave"===e?(a=o,r="mouseenter"===e?"mouseover":"mouseout",o=function(e){return s.DomEvent._checkMouse(t,e)?a(e):void 0},t.addEventListener(r,o,!1)):"click"===e&&s.Browser.android?(a=o,o=function(t){return s.DomEvent._filterClick(t,a)},t.addEventListener(e,o,!1)):t.addEventListener(e,o,!1):"attachEvent"in t&&t.attachEvent("on"+e,o),t[c]=o,this))},removeListener:function(t,e,i){var n=s.stamp(i),o="_leaflet_"+e+n,a=t[o];return a?(s.Browser.pointer&&0===e.indexOf("touch")?this.removePointerListener(t,e,n):s.Browser.touch&&"dblclick"===e&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,n):"removeEventListener"in t?"mousewheel"===e?(t.removeEventListener("DOMMouseScroll",a,!1),t.removeEventListener(e,a,!1)):"mouseenter"===e||"mouseleave"===e?t.removeEventListener("mouseenter"===e?"mouseover":"mouseout",a,!1):t.removeEventListener(e,a,!1):"detachEvent"in t&&t.detachEvent("on"+e,a),t[o]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,s.DomEvent._skipped(t),this},disableScrollPropagation:function(t){var e=s.DomEvent.stopPropagation;return s.DomEvent.on(t,"mousewheel",e).on(t,"MozMousePixelScroll",e)},disableClickPropagation:function(t){for(var e=s.DomEvent.stopPropagation,i=s.Draggable.START.length-1;i>=0;i--)s.DomEvent.on(t,s.Draggable.START[i],e);return s.DomEvent.on(t,"click",s.DomEvent._fakeStop).on(t,"dblclick",e)},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return s.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,e){if(!e)return new s.Point(t.clientX,t.clientY);var i=e.getBoundingClientRect();return new s.Point(t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop)},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e},_skipEvents:{},_fakeStop:function(t){s.DomEvent._skipEvents[t.type]=!0},_skipped:function(t){var e=this._skipEvents[t.type];return this._skipEvents[t.type]=!1,e},_checkMouse:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(n){return!1}return i!==t},_getEvent:function(){var e=t.event;if(!e)for(var i=arguments.callee.caller;i&&(e=i.arguments[0],!e||t.Event!==e.constructor);)i=i.caller;return e},_filterClick:function(t,e){var i=t.timeStamp||t.originalEvent.timeStamp,n=s.DomEvent._lastClick&&i-s.DomEvent._lastClick;return n&&n>100&&500>n||t.target._simulatedClick&&!t._simulated?(s.DomEvent.stop(t),void 0):(s.DomEvent._lastClick=i,e(t))}},s.DomEvent.on=s.DomEvent.addListener,s.DomEvent.off=s.DomEvent.removeListener,s.Draggable=s.Class.extend({includes:s.Mixin.Events,statics:{START:s.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,e){this._element=t,this._dragStartTarget=e||t},enable:function(){if(!this._enabled){for(var t=s.Draggable.START.length-1;t>=0;t--)s.DomEvent.on(this._dragStartTarget,s.Draggable.START[t],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var t=s.Draggable.START.length-1;t>=0;t--)s.DomEvent.off(this._dragStartTarget,s.Draggable.START[t],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(t){if(this._moved=!1,!(t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(s.DomEvent.stopPropagation(t),s.Draggable._disabled||(s.DomUtil.disableImageDrag(),s.DomUtil.disableTextSelection(),this._moving)))){var i=t.touches?t.touches[0]:t;this._startPoint=new s.Point(i.clientX,i.clientY),this._startPos=this._newPos=s.DomUtil.getPosition(this._element),s.DomEvent.on(e,s.Draggable.MOVE[t.type],this._onMove,this).on(e,s.Draggable.END[t.type],this._onUp,this)}},_onMove:function(t){if(t.touches&&t.touches.length>1)return this._moved=!0,void 0;var i=t.touches&&1===t.touches.length?t.touches[0]:t,n=new s.Point(i.clientX,i.clientY),o=n.subtract(this._startPoint);(o.x||o.y)&&(s.Browser.touch&&Math.abs(o.x)+Math.abs(o.y)<3||(s.DomEvent.preventDefault(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=s.DomUtil.getPosition(this._element).subtract(o),s.DomUtil.addClass(e.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,s.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(o),this._moving=!0,s.Util.cancelAnimFrame(this._animRequest),this._animRequest=s.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.fire("predrag"),s.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){s.DomUtil.removeClass(e.body,"leaflet-dragging"),this._lastTarget&&(s.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var t in s.Draggable.MOVE)s.DomEvent.off(e,s.Draggable.MOVE[t],this._onMove).off(e,s.Draggable.END[t],this._onUp);s.DomUtil.enableImageDrag(),s.DomUtil.enableTextSelection(),this._moved&&this._moving&&(s.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),s.Handler=s.Class.extend({initialize:function(t){this._map=t},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),s.Map.mergeOptions({dragging:!0,inertia:!s.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:s.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),s.Map.Drag=s.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new s.Draggable(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),t.on("viewreset",this._onViewReset,this),t.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var t=this._map;t._panAnim&&t._panAnim.stop(),t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var t=this._lastTime=+new Date,e=this._lastPos=this._draggable._newPos;this._positions.push(e),this._times.push(t),t-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var t=this._map.getSize()._divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,s=(n-e+i)%t+e-i,o=(n+e+i)%t-e-i,a=Math.abs(s+i)<Math.abs(o+i)?s:o;this._draggable._newPos.x=a},_onDragEnd:function(t){var e=this._map,i=e.options,n=+new Date-this._lastTime,o=!i.inertia||n>i.inertiaThreshold||!this._positions[0];if(e.fire("dragend",t),o)e.fire("moveend");else{var a=this._lastPos.subtract(this._positions[0]),r=(this._lastTime+n-this._times[0])/1e3,l=i.easeLinearity,c=a.multiplyBy(l/r),h=c.distanceTo([0,0]),d=Math.min(i.inertiaMaxSpeed,h),u=c.multiplyBy(d/h),p=d/(i.inertiaDeceleration*l),m=u.multiplyBy(-p/2).round();m.x&&m.y?(m=e._limitOffset(m,e.options.maxBounds),s.Util.requestAnimFrame(function(){e.panBy(m,{duration:p,easeLinearity:l,noMoveStart:!0})})):e.fire("moveend")}}}),s.Map.addInitHook("addHandler","dragging",s.Map.Drag),s.Map.mergeOptions({doubleClickZoom:!0}),s.Map.DoubleClickZoom=s.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom()+(t.originalEvent.shiftKey?-1:1);"center"===e.options.doubleClickZoom?e.setZoom(i):e.setZoomAround(t.containerPoint,i)}}),s.Map.addInitHook("addHandler","doubleClickZoom",s.Map.DoubleClickZoom),s.Map.mergeOptions({scrollWheelZoom:!0}),s.Map.ScrollWheelZoom=s.Handler.extend({addHooks:function(){s.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),s.DomEvent.on(this._map._container,"MozMousePixelScroll",s.DomEvent.preventDefault),this._delta=0},removeHooks:function(){s.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),s.DomEvent.off(this._map._container,"MozMousePixelScroll",s.DomEvent.preventDefault)},_onWheelScroll:function(t){var e=s.DomEvent.getWheelDelta(t);this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var i=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(s.bind(this._performZoom,this),i),s.DomEvent.preventDefault(t),s.DomEvent.stopPropagation(t)},_performZoom:function(){var t=this._map,e=this._delta,i=t.getZoom();e=e>0?Math.ceil(e):Math.floor(e),e=Math.max(Math.min(e,4),-4),e=t._limitZoom(i+e)-i,this._delta=0,this._startTime=null,e&&("center"===t.options.scrollWheelZoom?t.setZoom(i+e):t.setZoomAround(this._lastMousePos,i+e))}}),s.Map.addInitHook("addHandler","scrollWheelZoom",s.Map.ScrollWheelZoom),s.extend(s.DomEvent,{_touchstart:s.Browser.msPointer?"MSPointerDown":s.Browser.pointer?"pointerdown":"touchstart",_touchend:s.Browser.msPointer?"MSPointerUp":s.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(t,i,n){function o(t){var e;if(s.Browser.pointer?(m.push(t.pointerId),e=m.length):e=t.touches.length,!(e>1)){var i=Date.now(),n=i-(r||i);l=t.touches?t.touches[0]:t,c=n>0&&h>=n,r=i}}function a(t){if(s.Browser.pointer){var e=m.indexOf(t.pointerId);if(-1===e)return;m.splice(e,1)}if(c){if(s.Browser.pointer){var n,o={};for(var a in l)n=l[a],o[a]="function"==typeof n?n.bind(l):n;l=o}l.type="dblclick",i(l),r=null}}var r,l,c=!1,h=250,d="_leaflet_",u=this._touchstart,p=this._touchend,m=[];t[d+u+n]=o,t[d+p+n]=a;var f=s.Browser.pointer?e.documentElement:t;return t.addEventListener(u,o,!1),f.addEventListener(p,a,!1),s.Browser.pointer&&f.addEventListener(s.DomEvent.POINTER_CANCEL,a,!1),this},removeDoubleTapListener:function(t,i){var n="_leaflet_";return t.removeEventListener(this._touchstart,t[n+this._touchstart+i],!1),(s.Browser.pointer?e.documentElement:t).removeEventListener(this._touchend,t[n+this._touchend+i],!1),s.Browser.pointer&&e.documentElement.removeEventListener(s.DomEvent.POINTER_CANCEL,t[n+this._touchend+i],!1),this}}),s.extend(s.DomEvent,{POINTER_DOWN:s.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:s.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:s.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:s.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(t,e,i,n){switch(e){case"touchstart":return this.addPointerListenerStart(t,e,i,n);case"touchend":return this.addPointerListenerEnd(t,e,i,n);case"touchmove":return this.addPointerListenerMove(t,e,i,n);default:throw"Unknown touch event type"}},addPointerListenerStart:function(t,i,n,o){var a="_leaflet_",r=this._pointers,l=function(t){s.DomEvent.preventDefault(t);for(var e=!1,i=0;i<r.length;i++)if(r[i].pointerId===t.pointerId){e=!0;break}e||r.push(t),t.touches=r.slice(),t.changedTouches=[t],n(t)};if(t[a+"touchstart"+o]=l,t.addEventListener(this.POINTER_DOWN,l,!1),!this._pointerDocumentListener){var c=function(t){for(var e=0;e<r.length;e++)if(r[e].pointerId===t.pointerId){r.splice(e,1);break}};e.documentElement.addEventListener(this.POINTER_UP,c,!1),e.documentElement.addEventListener(this.POINTER_CANCEL,c,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(t,e,i,n){function s(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons){for(var e=0;e<a.length;e++)if(a[e].pointerId===t.pointerId){a[e]=t;break}t.touches=a.slice(),t.changedTouches=[t],i(t)}}var o="_leaflet_",a=this._pointers;return t[o+"touchmove"+n]=s,t.addEventListener(this.POINTER_MOVE,s,!1),this},addPointerListenerEnd:function(t,e,i,n){var s="_leaflet_",o=this._pointers,a=function(t){for(var e=0;e<o.length;e++)if(o[e].pointerId===t.pointerId){o.splice(e,1);break}t.touches=o.slice(),t.changedTouches=[t],i(t)};return t[s+"touchend"+n]=a,t.addEventListener(this.POINTER_UP,a,!1),t.addEventListener(this.POINTER_CANCEL,a,!1),this},removePointerListener:function(t,e,i){var n="_leaflet_",s=t[n+e+i];switch(e){case"touchstart":t.removeEventListener(this.POINTER_DOWN,s,!1);break;case"touchmove":t.removeEventListener(this.POINTER_MOVE,s,!1);break;case"touchend":t.removeEventListener(this.POINTER_UP,s,!1),t.removeEventListener(this.POINTER_CANCEL,s,!1)}return this}}),s.Map.mergeOptions({touchZoom:s.Browser.touch&&!s.Browser.android23,bounceAtZoomLimits:!0}),s.Map.TouchZoom=s.Handler.extend({addHooks:function(){s.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){s.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(t.touches&&2===t.touches.length&&!i._animatingZoom&&!this._zooming){var n=i.mouseEventToLayerPoint(t.touches[0]),o=i.mouseEventToLayerPoint(t.touches[1]),a=i._getCenterLayerPoint();this._startCenter=n.add(o)._divideBy(2),this._startDist=n.distanceTo(o),this._moved=!1,this._zooming=!0,this._centerOffset=a.subtract(this._startCenter),i._panAnim&&i._panAnim.stop(),s.DomEvent.on(e,"touchmove",this._onTouchMove,this).on(e,"touchend",this._onTouchEnd,this),s.DomEvent.preventDefault(t)}},_onTouchMove:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&this._zooming){var i=e.mouseEventToLayerPoint(t.touches[0]),n=e.mouseEventToLayerPoint(t.touches[1]);this._scale=i.distanceTo(n)/this._startDist,this._delta=i._add(n)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(e.options.bounceAtZoomLimits||!(e.getZoom()===e.getMinZoom()&&this._scale<1||e.getZoom()===e.getMaxZoom()&&this._scale>1))&&(this._moved||(s.DomUtil.addClass(e._mapPane,"leaflet-touching"),e.fire("movestart").fire("zoomstart"),this._moved=!0),s.Util.cancelAnimFrame(this._animRequest),this._animRequest=s.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),s.DomEvent.preventDefault(t))}},_updateOnMove:function(){var t=this._map,e=this._getScaleOrigin(),i=t.layerPointToLatLng(e),n=t.getScaleZoom(this._scale);t._animateZoom(i,n,this._startCenter,this._scale,this._delta,!1,!0)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return this._zooming=!1,void 0;var t=this._map;this._zooming=!1,s.DomUtil.removeClass(t._mapPane,"leaflet-touching"),s.Util.cancelAnimFrame(this._animRequest),s.DomEvent.off(e,"touchmove",this._onTouchMove).off(e,"touchend",this._onTouchEnd);var i=this._getScaleOrigin(),n=t.layerPointToLatLng(i),o=t.getZoom(),a=t.getScaleZoom(this._scale)-o,r=a>0?Math.ceil(a):Math.floor(a),l=t._limitZoom(o+r),c=t.getZoomScale(l)/this._scale;t._animateZoom(n,l,i,c)},_getScaleOrigin:function(){var t=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(t)}}),s.Map.addInitHook("addHandler","touchZoom",s.Map.TouchZoom),s.Map.mergeOptions({tap:!0,tapTolerance:15}),s.Map.Tap=s.Handler.extend({addHooks:function(){s.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){s.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(s.DomEvent.preventDefault(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,clearTimeout(this._holdTimeout),void 0;var i=t.touches[0],n=i.target;this._startPos=this._newPos=new s.Point(i.clientX,i.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&s.DomUtil.addClass(n,"leaflet-active"),this._holdTimeout=setTimeout(s.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",i))},this),1e3),s.DomEvent.on(e,"touchmove",this._onMove,this).on(e,"touchend",this._onUp,this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),s.DomEvent.off(e,"touchmove",this._onMove,this).off(e,"touchend",this._onUp,this),this._fireClick&&t&&t.changedTouches){var i=t.changedTouches[0],n=i.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&s.DomUtil.removeClass(n,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",i)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new s.Point(e.clientX,e.clientY)},_simulateEvent:function(i,n){var s=e.createEvent("MouseEvents");s._simulated=!0,n.target._simulatedClick=!0,s.initMouseEvent(i,!0,!0,t,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(s)}}),s.Browser.touch&&!s.Browser.pointer&&s.Map.addInitHook("addHandler","tap",s.Map.Tap),s.Map.mergeOptions({boxZoom:!0}),s.Map.BoxZoom=s.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._moved=!1},addHooks:function(){s.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){s.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1},moved:function(){return this._moved},_onMouseDown:function(t){return this._moved=!1,!t.shiftKey||1!==t.which&&1!==t.button?!1:(s.DomUtil.disableTextSelection(),s.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(t),s.DomEvent.on(e,"mousemove",this._onMouseMove,this).on(e,"mouseup",this._onMouseUp,this).on(e,"keydown",this._onKeyDown,this),void 0)},_onMouseMove:function(t){this._moved||(this._box=s.DomUtil.create("div","leaflet-zoom-box",this._pane),s.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var e=this._startLayerPoint,i=this._box,n=this._map.mouseEventToLayerPoint(t),o=n.subtract(e),a=new s.Point(Math.min(n.x,e.x),Math.min(n.y,e.y));s.DomUtil.setPosition(i,a),this._moved=!0,i.style.width=Math.max(0,Math.abs(o.x)-4)+"px",i.style.height=Math.max(0,Math.abs(o.y)-4)+"px"},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),s.DomUtil.enableTextSelection(),s.DomUtil.enableImageDrag(),s.DomEvent.off(e,"mousemove",this._onMouseMove).off(e,"mouseup",this._onMouseUp).off(e,"keydown",this._onKeyDown)},_onMouseUp:function(t){this._finish();var e=this._map,i=e.mouseEventToLayerPoint(t);if(!this._startLayerPoint.equals(i)){var n=new s.LatLngBounds(e.layerPointToLatLng(this._startLayerPoint),e.layerPointToLatLng(i));e.fitBounds(n),e.fire("boxzoomend",{boxZoomBounds:n})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),s.Map.addInitHook("addHandler","boxZoom",s.Map.BoxZoom),s.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),s.Map.Keyboard=s.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(t){this._map=t,this._setPanOffset(t.options.keyboardPanOffset),this._setZoomOffset(t.options.keyboardZoomOffset)},addHooks:function(){var t=this._map._container;-1===t.tabIndex&&(t.tabIndex="0"),s.DomEvent.on(t,"focus",this._onFocus,this).on(t,"blur",this._onBlur,this).on(t,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var t=this._map._container;s.DomEvent.off(t,"focus",this._onFocus,this).off(t,"blur",this._onBlur,this).off(t,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var i=e.body,n=e.documentElement,s=i.scrollTop||n.scrollTop,o=i.scrollLeft||n.scrollLeft;this._map._container.focus(),t.scrollTo(o,s)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(t){var e,i,n=this._panKeys={},s=this.keyCodes;for(e=0,i=s.left.length;i>e;e++)n[s.left[e]]=[-1*t,0];for(e=0,i=s.right.length;i>e;e++)n[s.right[e]]=[t,0];for(e=0,i=s.down.length;i>e;e++)n[s.down[e]]=[0,t];for(e=0,i=s.up.length;i>e;e++)n[s.up[e]]=[0,-1*t]},_setZoomOffset:function(t){var e,i,n=this._zoomKeys={},s=this.keyCodes;for(e=0,i=s.zoomIn.length;i>e;e++)n[s.zoomIn[e]]=t;for(e=0,i=s.zoomOut.length;i>e;e++)n[s.zoomOut[e]]=-t},_addHooks:function(){s.DomEvent.on(e,"keydown",this._onKeyDown,this)},_removeHooks:function(){s.DomEvent.off(e,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){var e=t.keyCode,i=this._map;if(e in this._panKeys){if(i._panAnim&&i._panAnim._inProgress)return;i.panBy(this._panKeys[e]),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds)}else{if(!(e in this._zoomKeys))return;i.setZoom(i.getZoom()+this._zoomKeys[e])}s.DomEvent.stop(t)}}),s.Map.addInitHook("addHandler","keyboard",s.Map.Keyboard),s.Handler.MarkerDrag=s.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new s.Draggable(t,t)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),s.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),s.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var t=this._marker,e=t._shadow,i=s.DomUtil.getPosition(t._icon),n=t._map.layerPointToLatLng(i);e&&s.DomUtil.setPosition(e,i),t._latlng=n,t.fire("move",{latlng:n}).fire("drag")},_onDragEnd:function(t){this._marker.fire("moveend").fire("dragend",t)}}),s.Control=s.Class.extend({options:{position:"topright"},initialize:function(t){s.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return s.DomUtil.addClass(e,"leaflet-control"),-1!==i.indexOf("bottom")?n.insertBefore(e,n.firstChild):n.appendChild(e),this},removeFrom:function(t){var e=this.getPosition(),i=t._controlCorners[e];return i.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(t),this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),s.control=function(t){return new s.Control(t)},s.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.removeFrom(this),this},_initControlPos:function(){function t(t,o){var a=i+t+" "+i+o;e[t+o]=s.DomUtil.create("div",a,n)}var e=this._controlCorners={},i="leaflet-",n=this._controlContainer=s.DomUtil.create("div",i+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),s.Control.Zoom=s.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=s.DomUtil.create("div",e+" leaflet-bar");return this._map=t,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,e+"-in",i,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,e+"-out",i,this._zoomOut,this),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(t){this._map.zoomIn(t.shiftKey?3:1)},_zoomOut:function(t){this._map.zoomOut(t.shiftKey?3:1)},_createButton:function(t,e,i,n,o,a){var r=s.DomUtil.create("a",i,n);r.innerHTML=t,r.href="#",r.title=e;var l=s.DomEvent.stopPropagation;return s.DomEvent.on(r,"click",l).on(r,"mousedown",l).on(r,"dblclick",l).on(r,"click",s.DomEvent.preventDefault).on(r,"click",o,a).on(r,"click",this._refocusOnMap,a),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";s.DomUtil.removeClass(this._zoomInButton,e),s.DomUtil.removeClass(this._zoomOutButton,e),t._zoom===t.getMinZoom()&&s.DomUtil.addClass(this._zoomOutButton,e),t._zoom===t.getMaxZoom()&&s.DomUtil.addClass(this._zoomInButton,e)}}),s.Map.mergeOptions({zoomControl:!0}),s.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new s.Control.Zoom,this.addControl(this.zoomControl))}),s.control.zoom=function(t){return new s.Control.Zoom(t)},s.Control.Attribution=s.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){s.setOptions(this,t),this._attributions={}},onAdd:function(t){this._container=s.DomUtil.create("div","leaflet-control-attribution"),s.DomEvent.disableClickPropagation(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return t.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(t){t.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):void 0},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):void 0},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}},_onLayerAdd:function(t){t.layer.getAttribution&&this.addAttribution(t.layer.getAttribution())},_onLayerRemove:function(t){t.layer.getAttribution&&this.removeAttribution(t.layer.getAttribution())}}),s.Map.mergeOptions({attributionControl:!0}),s.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new s.Control.Attribution).addTo(this))}),s.control.attribution=function(t){return new s.Control.Attribution(t)},s.Control.Scale=s.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(t){this._map=t;
var e="leaflet-control-scale",i=s.DomUtil.create("div",e),n=this.options;return this._addScales(n,e,i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=s.DomUtil.create("div",e+"-line",i)),t.imperial&&(this._iScale=s.DomUtil.create("div",e+"-line",i))},_update:function(){var t=this._map.getBounds(),e=t.getCenter().lat,i=6378137*Math.PI*Math.cos(e*Math.PI/180),n=i*(t.getNorthEast().lng-t.getSouthWest().lng)/180,s=this._map.getSize(),o=this.options,a=0;s.x>0&&(a=n*(o.maxWidth/s.x)),this._updateScales(o,a)},_updateScales:function(t,e){t.metric&&e&&this._updateMetric(e),t.imperial&&e&&this._updateImperial(e)},_updateMetric:function(t){var e=this._getRoundNum(t);this._mScale.style.width=this._getScaleWidth(e/t)+"px",this._mScale.innerHTML=1e3>e?e+" m":e/1e3+" km"},_updateImperial:function(t){var e,i,n,s=3.2808399*t,o=this._iScale;s>5280?(e=s/5280,i=this._getRoundNum(e),o.style.width=this._getScaleWidth(i/e)+"px",o.innerHTML=i+" mi"):(n=this._getRoundNum(s),o.style.width=this._getScaleWidth(n/s)+"px",o.innerHTML=n+" ft")},_getScaleWidth:function(t){return Math.round(this.options.maxWidth*t)-10},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),s.control.scale=function(t){return new s.Control.Scale(t)},s.Control.Layers=s.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(t,e,i){s.setOptions(this,i),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){return this._initLayout(),this._update(),t.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(t){t.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._update(),this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._update(),this},removeLayer:function(t){var e=s.stamp(t);return delete this._layers[e],this._update(),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=s.DomUtil.create("div",t);e.setAttribute("aria-haspopup",!0),s.Browser.touch?s.DomEvent.on(e,"click",s.DomEvent.stopPropagation):s.DomEvent.disableClickPropagation(e).disableScrollPropagation(e);var i=this._form=s.DomUtil.create("form",t+"-list");if(this.options.collapsed){s.Browser.android||s.DomEvent.on(e,"mouseover",this._expand,this).on(e,"mouseout",this._collapse,this);var n=this._layersLink=s.DomUtil.create("a",t+"-toggle",e);n.href="#",n.title="Layers",s.Browser.touch?s.DomEvent.on(n,"click",s.DomEvent.stop).on(n,"click",this._expand,this):s.DomEvent.on(n,"focus",this._expand,this),s.DomEvent.on(i,"click",function(){setTimeout(s.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=s.DomUtil.create("div",t+"-base",i),this._separator=s.DomUtil.create("div",t+"-separator",i),this._overlaysList=s.DomUtil.create("div",t+"-overlays",i),e.appendChild(i)},_addLayer:function(t,e,i){var n=s.stamp(t);this._layers[n]={layer:t,name:e,overlay:i},this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var t,e,i=!1,n=!1;for(t in this._layers)e=this._layers[t],this._addItem(e),n=n||e.overlay,i=i||!e.overlay;this._separator.style.display=n&&i?"":"none"}},_onLayerChange:function(t){var e=this._layers[s.stamp(t.layer)];if(e){this._handlingClick||this._update();var i=e.overlay?"layeradd"===t.type?"overlayadd":"overlayremove":"layeradd"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)}},_createRadioElement:function(t,i){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"';i&&(n+=' checked="checked"'),n+="/>";var s=e.createElement("div");return s.innerHTML=n,s.firstChild},_addItem:function(t){var i,n=e.createElement("label"),o=this._map.hasLayer(t.layer);t.overlay?(i=e.createElement("input"),i.type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked=o):i=this._createRadioElement("leaflet-base-layers",o),i.layerId=s.stamp(t.layer),s.DomEvent.on(i,"click",this._onInputClick,this);var a=e.createElement("span");a.innerHTML=" "+t.name,n.appendChild(i),n.appendChild(a);var r=t.overlay?this._overlaysList:this._baseLayersList;return r.appendChild(n),n},_onInputClick:function(){var t,e,i,n=this._form.getElementsByTagName("input"),s=n.length;for(this._handlingClick=!0,t=0;s>t;t++)e=n[t],i=this._layers[e.layerId],e.checked&&!this._map.hasLayer(i.layer)?this._map.addLayer(i.layer):!e.checked&&this._map.hasLayer(i.layer)&&this._map.removeLayer(i.layer);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){s.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),s.control.layers=function(t,e,i){return new s.Control.Layers(t,e,i)},s.PosAnimation=s.Class.extend({includes:s.Mixin.Events,run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._newPos=e,this.fire("start"),t.style[s.DomUtil.TRANSITION]="all "+(i||.25)+"s cubic-bezier(0,0,"+(n||.5)+",1)",s.DomEvent.on(t,s.DomUtil.TRANSITION_END,this._onTransitionEnd,this),s.DomUtil.setPosition(t,e),s.Util.falseFn(t.offsetWidth),this._stepTimer=setInterval(s.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(s.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),s.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var t=this._getPos();return t?(this._el._leaflet_pos=t,this.fire("step"),void 0):(this._onTransitionEnd(),void 0)},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var e,i,n,o=this._el,a=t.getComputedStyle(o);if(s.Browser.any3d){if(n=a[s.DomUtil.TRANSFORM].match(this._transformRe),!n)return;e=parseFloat(n[1]),i=parseFloat(n[2])}else e=parseFloat(a.left),i=parseFloat(a.top);return new s.Point(e,i,!0)},_onTransitionEnd:function(){s.DomEvent.off(this._el,s.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[s.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),s.Map.include({setView:function(t,e,n){if(e=e===i?this._zoom:this._limitZoom(e),t=this._limitCenter(s.latLng(t),e,this.options.maxBounds),n=n||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!n.reset&&n!==!0){n.animate!==i&&(n.zoom=s.extend({animate:n.animate},n.zoom),n.pan=s.extend({animate:n.animate},n.pan));var o=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan);if(o)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},panBy:function(t,e){if(t=s.point(t).round(),e=e||{},!t.x&&!t.y)return this;if(this._panAnim||(this._panAnim=new s.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){s.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t);this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){s.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._floor();return(e&&e.animate)===!0||this.getSize().contains(i)?(this.panBy(i,e),!0):!1}}),s.PosAnimation=s.DomUtil.TRANSITION?s.PosAnimation:s.PosAnimation.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=s.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=s.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var t=+new Date-this._startTime,e=1e3*this._duration;e>t?this._runFrame(this._easeOut(t/e)):(this._runFrame(1),this._complete())},_runFrame:function(t){var e=this._startPos.add(this._offset.multiplyBy(t));s.DomUtil.setPosition(this._el,e),this.fire("step")},_complete:function(){s.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),s.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),s.DomUtil.TRANSITION&&s.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&s.DomUtil.TRANSITION&&s.Browser.any3d&&!s.Browser.android23&&!s.Browser.mobileOpera,this._zoomAnimated&&s.DomEvent.on(this._mapPane,s.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),s.Map.include(s.DomUtil.TRANSITION?{_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),s=this._getCenterOffset(t)._divideBy(1-1/n),o=this._getCenterLayerPoint()._add(s);return i.animate===!0||this.getSize().contains(s)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(t,e,o,n,null,!0),!0):!1},_animateZoom:function(t,e,i,n,o,a,r){r||(this._animatingZoom=!0),s.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=t,this._animateToZoom=e,s.Draggable&&(s.Draggable._disabled=!0),s.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:t,zoom:e,origin:i,scale:n,delta:o,backwards:a})},this)},_onZoomTransitionEnd:function(){this._animatingZoom=!1,s.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),s.Draggable&&(s.Draggable._disabled=!1)}}:{}),s.TileLayer.include({_animateZoom:function(t){this._animating||(this._animating=!0,this._prepareBgBuffer());var e=this._bgBuffer,i=s.DomUtil.TRANSFORM,n=t.delta?s.DomUtil.getTranslateString(t.delta):e.style[i],o=s.DomUtil.getScaleString(t.scale,t.origin);e.style[i]=t.backwards?o+" "+n:n+" "+o},_endZoomAnim:function(){var t=this._tileContainer,e=this._bgBuffer;t.style.visibility="",t.parentNode.appendChild(t),s.Util.falseFn(e.offsetWidth),this._animating=!1},_clearBgBuffer:function(){var t=this._map;!t||t._animatingZoom||t.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[s.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var t=this._tileContainer,e=this._bgBuffer,i=this._getLoadedTilesPercentage(e),n=this._getLoadedTilesPercentage(t);return e&&i>.5&&.5>n?(t.style.visibility="hidden",this._stopLoadingImages(t),void 0):(e.style.visibility="hidden",e.style[s.DomUtil.TRANSFORM]="",this._tileContainer=e,e=this._bgBuffer=t,this._stopLoadingImages(e),clearTimeout(this._clearBgBufferTimer),void 0)},_getLoadedTilesPercentage:function(t){var e,i,n=t.getElementsByTagName("img"),s=0;for(e=0,i=n.length;i>e;e++)n[e].complete&&s++;return s/i},_stopLoadingImages:function(t){var e,i,n,o=Array.prototype.slice.call(t.getElementsByTagName("img"));for(e=0,i=o.length;i>e;e++)n=o[e],n.complete||(n.onload=s.Util.falseFn,n.onerror=s.Util.falseFn,n.src=s.Util.emptyImageUrl,n.parentNode.removeChild(n))}}),s.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(t){if(t=this._locateOptions=s.extend(this._defaultLocateOptions,t),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=s.bind(this._handleGeolocationResponse,this),i=s.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,i=t.coords.longitude,n=new s.LatLng(e,i),o=180*t.coords.accuracy/40075017,a=o/Math.cos(s.LatLng.DEG_TO_RAD*e),r=s.latLngBounds([e-o,i-a],[e+o,i+a]),l=this._locateOptions;if(l.setView){var c=Math.min(this.getBoundsZoom(r),l.maxZoom);this.setView(n,c)}var h={latlng:n,bounds:r,timestamp:t.timestamp};for(var d in t.coords)"number"==typeof t.coords[d]&&(h[d]=t.coords[d]);this.fire("locationfound",h)}})}(window,document),define("text!maps/tmpl/maps-leaflet.html",[],function(){return'<div class="maps-module">\n    <div class="box-header module-header clearfix">\n        <% if(search) {%>\n        <form class="form-search">\n            <% if(!_.isUndefined(searchTypes) && searchTypes && _.keys(searchTypes).length > 1) {%>\n            <input type="hidden" name="type" value="<%= _.isUndefined(defSearchType) ? searchTypes[0].key : defSearchType.key %>" />\n            <div class="input-prepend">\n\n                <a class="btn dropdown-toggle" data-toggle="dropdown">\n                    <span><%- _.isUndefined(defSearchType) ? searchTypes[0].name : defSearchType.name %></span>\n                    <span class="caret"></span>\n                </a>\n                <ul class="dropdown-menu">\n                    <% _.each(searchTypes, function(type){%>\n                    <li><a data-type="<%= type.key %>" href="javascript:;"><%- type.name %></a></li>\n                    <% }); %>\n                </ul>\n\n                <div class="input-append">\n                    <span class="add-on">\n                        <input type="text" name="q" />\n                        <i class="icon-clear svg-icon svg-icon-circle-remove"></i>\n                    </span>\n                    <button class="add-on btn"><i class="svg-icon svg-icon-search"></i></button>\n                </div>\n            </div>\n            <% } else { %>\n            <div class="input-prepend">\n                <% if(!_.isUndefined(searchTypes) && searchTypes) {%>\n                <input type="hidden" name="type" value="<%- searchTypes[0].key %>" />\n                <% } %>\n                <div class="input-append">\n                    <span class="add-on">\n                        <input type="text" name="q" />\n                        <i class="icon-clear svg-icon svg-icon-circle-remove"></i>\n                    </span>\n                    <button class="add-on btn"><i class="svg-icon svg-icon-search"></i></button>\n                </div>\n            </div>\n            <% } %>\n        </form>\n        <% } %>\n        <div class="pull-right">\n            <% if(typeSelect) {%>\n            <div class="map-type-select">\n                <select data-placeholder="<%= i18n.mapName.replace(\'#name#\', \'Yandex\')%>">\n                    <option value="YandexMap"><%= i18n.mapName.replace(\'#name#\', \'Yandex\')%></option>\n                    <option value="YandexMapSat"><%= i18n.satMapName.replace(\'#name#\', \'Yandex\')%></option>\n                    <option value="YandexMapHybrid"><%= i18n.hybridMapName.replace(\'#name#\', \'Yandex\')%></option>\n                    <option value="GoogleMap"><%= i18n.mapName.replace(\'#name#\', \'Google\')%></option>\n                    <option value="GoogleMapSat"><%= i18n.satMapName.replace(\'#name#\', \'Google\')%></option>\n                    <option value="GoogleMapHybrid"><%= i18n.hybridMapName.replace(\'#name#\', \'Google\')%></option>\n                    <option value="GoogleMapTerrain"><%= i18n.landMapName.replace(\'#name#\', \'Google\')%></option>\n                    <option value="OpenStreetMap"><%= i18n.mapName.replace(\'#name#\', \'OpenStreetMap\')%></option>\n                    <option value="OpenStreetMapTransport"><%= i18n.transMapName.replace(\'#name#\', \'OpenStreetMap\')%></option>\n                    <!--<option value="CloudMadeMap"><%= i18n.mapName.replace(\'#name#\', \'CloudMade\')%></option>-->\n                    <%var map; if(map = App.getServerSettings().specialMap) {%>\n                    <option value="SpecialMap"><%= map.name || i18n.specialMapName %></option>\n                    <% } %>\n                </select>\n            </div>\n            <% } %>\n        </div>\n    </div>\n    <div class="module-content">\n\n    </div>\n</div>'}),define("text!maps/tmpl/addr-marker-popup.html",[],function(){return'<h4 class="address selectable"><%- data.title %></h4>\n<% _.each(addressActions, function(action){%>\n<% if(!action.html) {%>\n    <a href="javascript:;" class="<%= action.class %>">\n    <%- action.text %>\n    </a>\n<% } else if(\'string\' == typeof action.html) { %>\n    <%= action.html %>\n<% } else if(_.isFunction(action.html)) {%>\n    <%= action.html() %>\n<% } %>\n<% }); %>\n\n<a href="<%= externalLink %>" target="_blank" class="external-link<% if(isYandex){%> ydx <% } %>"><i class="icon"></i> <%= i18n[isYandex ? \'showOnYandexMap\' : \'showOnGoogleMap\'] %></a>\n\n<div class="clearfix">\n    <a href="javascript:;" class="delete-it pull-left"><%= i18n.delete.ucFirst() %></a>\n    <% if(routingModule) {%><a href="javascript:;" class="route-to pull-right"><%= i18n.routeHere %></a><% } %><!--mapsViewLeaflet line 1353-->\n</div>'}),define("maps/views/MapsViewLeaflet",["jquery","underscore","util","abstracts/View","_libs/leaflet/leaflet-src","css!_libs/leaflet/leaflet.css","css!maps/css/maps.css","text!maps/tmpl/maps-leaflet.html","text!maps/tmpl/addr-marker-popup.html","i18n!_common/nls/common"],function(t,e,i,n,s,o,a,r,l,c){function h(){L.MarkerCluster&&L.MarkerCluster.include({isSpiderfied:function(){return null!==this._group._spiderfied}}),L.MarkerClusterGroup&&!L.MarkerClusterGroup.prototype.updateMarkerPos&&L.MarkerClusterGroup.include({getAllChildren:function(){return this._needsClustering.slice()},updateMarkerPos:function(t,e){if(t.__parent){var i=t.__parent._group._spiderfied,n=t._popup&&t._popup._map;return i||(n||this.removeLayer(t),e&&t.setLatLng(e),n||this.addLayer(t)),void 0}}}),L.Control.Zoomslider&&L.Control.Zoomslider.include({_createZoomBtn:function(t,e,i){var n=this.options.styleNS+"-"+t+" leaflet-bar-part"+" leaflet-bar-part-"+e,s=L.DomUtil.create("a",n,i);return s.href="#",s.title=c["zoom"+t.ucFirst()],L.DomEvent.on(s,"click",L.DomEvent.preventDefault),s}}),L.Control.Pan&&(L.Control.Pan.prototype._panButton,L.Control.Pan.include({_panButton:function(t,e,i,n,s){var o=L.DomUtil.create("div",e+"-wrap",i),a=L.DomUtil.create("a",e,o);return a.href="#",a.title=c["mapPan"+t],L.DomEvent.on(a,"click",L.DomEvent.stopPropagation).on(a,"click",L.DomEvent.preventDefault).on(a,"click",function(){n.panBy(s)},n).on(a,"dblclick",L.DomEvent.stopPropagation),a}}))}function d(){this.addressMarkers=[],this._LMap=null,this._map=null,this._tilesLayer=null,this._hybridLayer=null,this._trafficLayer=null,this._trafficUpdateInterval=null,this._errorTiles=0,this._brokenLevels=0,this._layerIsBroken=!1}LIBS_PATH="_libs/";var l=e.template(l),u={typeSelect:!0,compass:!1,ruler:!1,search:!1,searchTypes:!1,traffic:!1,routing:!1,print:!1,autozoom:!1,slider:!0,zoomButtons:!0,printer:!1,layersControl:!1,clearControl:!1,i18n:c};L_PREFER_CANVAS=!0;var p=.4,m=24e4,f=14;if(L.DomUtil.TRANSFORM)var g={transform:"transform",WebkitTransform:"-webkit-transform",OTransform:"-o-transform",MozTransform:"-moz-transform",msTransform:"-ms-transform"},v=g[L.DomUtil.TRANSFORM];L.Map.addInitHook(function(){var e=this;if(this.options.traffic&&this.addControl(new L.Control.Traffic({onToggle:function(){e.fire("toggletraffic")}})),this.options.ruler&&L.ruler(this,{control:{position:"topright",title:c.mapRuler},i18n:{m:c.m,km:c.km}}),this.options.clearControl&&this.addControl(new L.Control.Clear),this.options.layersControl&&this.addControl(new L.Control.MapSelect),this.options.panControl){var i=L.control.pan();this.addControl(i);var n=this,s=t('<div class="zoom-indicator">'+this.getZoom()+"</div>").appendTo(i.getContainer());this.on("zoomend",function(){s.text(n.getZoom())})}this.options.zoomsliderControl&&this.addControl(new L.Control.Zoomslider),this.options.autozoom&&this.addControl(new L.Control.Autozoom({title:c.autozoom})),this.options.print&&this.addControl(new L.Control.Print({title:c.printMap})),this.options.coordinateControl&&L.Control.Coordinates&&this.addControl(new L.Control.Coordinates({position:"bottomright"})),this.addControl(L.control.scale({position:"bottomright",imperial:!1})),this.on("draw:edited",function(t){var e=t.layers,i=0;e.eachLayer(function(){i++}),console.log("Edited "+i+" layers")})}),L.CRS.Yandex=L.extend({},L.CRS,{code:"ydx",D_EXT:.08181979099211441,transformation:new L.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),_lngToX:function(t,e){return e*(.5+t/360)},_latToY:function(t,e){t>90&&(t-=180),-90>t&&(t+=180);var i=Math.sin(t*Math.PI/180),n=e/(2*Math.PI),s=e/2-n*(Math.atanh(i)-this.D_EXT*Math.atanh(this.D_EXT*i));return s===-1/0?s=0:1/0===s&&(s=e),s},_yToLat:function(t,e){var i=1;t>e/2&&(t=e-t,i=-1);var n=(t-e/2)/-(e/(2*Math.PI)),s=2*Math.atan(Math.exp(n))/(2*Math.PI)-1/(2*Math.PI),o=t-e/2,a=0,r=1e-7;do a=s,s=Math.asin(1-(1+Math.sin(a))*Math.pow(1-this.D_EXT*Math.sin(a),this.D_EXT)/(Math.exp(2*o/-(e/(2*Math.PI)))*Math.pow(1+this.D_EXT*Math.sin(a),this.D_EXT)));while(Math.abs(a-s)>r&&!isNaN(s));return 180*i*(isNaN(s)?a:s)/Math.PI},latLngToPoint:function(t,e){var i=this.scale(e),n=this._lngToX(t.lng,i),s=this._latToY(t.lat,i);return new L.Point(n,s)},pointToLatLng:function(t,e){var i=this.scale(e),n=this._yToLat(t.y,i),s=this.transformation.untransform(t,i),o=s.x*L.LatLng.RAD_TO_DEG;return new L.LatLng(n,o)}}),L.TileLayer.prototype.getTileUrl=function(t){return"function"==typeof this._url?this._url(t,this._getSubdomain(t),this.options):L.Util.template(this._url,L.extend({s:this._getSubdomain(t),z:t.z,x:t.x,y:t.y},this.options))},L.Marker.include({_movePopup:function(t){this._popup&&this._popup.setLatLng(t.latlng)},getParentCluster:function(){return this.__parent||null},unspiderfy:function(){this.__parent&&this.__parent._group._noanimationUnspiderfy()},getLatLon:function(){var t=this.getLatLng();return[t.lat,t.lng]}}),L.Popup.include({getContainer:function(){return this._container},close:function(){this._close()},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else if("function"==typeof this._content){var e;(e=this._content.call(this))&&t(this._contentNode).html(e)}else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}}}),L.FeatureGroup.include({addLayers:function(t){if(t&&t.length)for(w=0,len=t.length;len>w;w++)this.addLayer(t[w])}}),L.Path.include({_infoLayer:null,_showInfo:function(){this._infoLayer&&(this._infoLayer.textContent="function"==typeof this.options.info.content?this.options.info.content.call(this):this.options.info.content)},_moveInfo:function(){if(this._infoLayer){var t="getRadius"in this;if(t||this.getLatLngs().length){var e=this.getCenterXY();this._infoLayer.setAttribute("x",e.x),this._infoLayer.setAttribute("y",e.y)}}}}),L.Path.addInitHook(function(){this.on("add",function(){var t=this,e=this._map;this.options.info&&this.getCenterXY&&(t._infoLayer=document.createElementNS(L.Path.SVG_NS,"text"),t._infoLayer.setAttribute("class","zone-info-layer leaflet-zoom-hide"+(this.options.info.addClass?" "+this.options.info.addClass:"")),t._infoLayer.setAttribute("dy","8"),t._infoLayer.setAttribute("x","0"),t._infoLayer.setAttribute("y","0"),t._infoLayer.setAttribute("fill","#cc0000"),t._path.parentNode.appendChild(t._infoLayer),this._showInfo(),this._moveInfo(),e.on("viewreset",this._moveInfo,this),e.on("zoomend",this._moveInfo,this),this.once("remove",function(){e.off("viewreset",t._moveInfo,t),e.off("zoomend",t._moveInfo,t),t._infoLayer&&t._path.parentNode.removeChild(t._infoLayer)}))})}),L.Polygon.include({getCenterXY:function(){for(var t=this.getLatLngs(),e=t.length,i=0,n=0,s=0;e>s;++s)i+=t[s].lat,n+=t[s].lng;return this._map.latLngToLayerPoint([i/e,n/e])}}),L.Circle.include({getCenterXY:function(){return this._map.latLngToLayerPoint(this.getLatLng())},latLngToLayerPoint:function(t){var e=this._map.project(L.latLng(t));return e._subtract(this._map.getPixelOrigin())}}),L.Circle.prototype.projectLatlngs=function(){var t=this._getLngRadius(),e=this._latlng,i=this.latLngToLayerPoint([e.lat,e.lng-t]);this._point=this.latLngToLayerPoint(e),this._radius=Math.max(this._point.x-i.x,1e-4)},L.Mixin.Events.trigger=L.Mixin.Events.fireEvent,L.Marker.prototype.trigger=L.Marker.prototype.fireEvent,L.FeatureGroup.prototype.trigger=L.FeatureGroup.prototype.fireEvent,L.Path.prototype.trigger=L.Mixin.Events.fireEvent,L.Handler.prototype.trigger=L.Mixin.Events.fireEvent,L.SVGIcon=L.DivIcon.extend({options:{iconSize:null,el:"div",className:"leaflet-svg-icon",addClassName:"",attributes:null,style:null},createIcon:function(e){var i=this.options,n=e&&e.tagName===i.el.toUpperCase()?e:document.createElement(i.el);i.addClassName&&(i.className+=" "+i.addClassName),n.innerHTML=i.html!==!1?i.html:"";var s=t(n);if(i.style&&s.css(i.style),i.attributes)for(var o in i.attributes)s.attr(o,i.attributes[o]);return this._setIconStyles(n,"icon"),n},createShadow:function(){return null}}),L.PinIcon=L.SVGIcon.extend({options:{html:'<svg class="svg" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="36" viewBox="0 0 24 36"><path class="svg-path svg-pin" d="M12,0C5.366,0,0,5.634,0,12.6C0,22.05,12,36,12,36s12-13.95,12-23.4C24,5.634,18.634,0,12,0z M12,17.1 c-2.484,0-4.5-2.016-4.5-4.5S9.516,8.1,12,8.1s4.5,2.016,4.5,4.5S14.484,17.1,12,17.1z"/></svg>'}}),L.ComplexIcon=L.DivIcon.extend({options:{iconSize:null,el:"div",className:"leaflet-div-icon complex-icon",html:!1,attributes:null,style:null},createIcon:function(e){var i=this.options,n=e&&e.tagName===i.el.toUpperCase()?e:document.createElement(i.el);n.innerHTML=i.html!==!1?i.html:"";var s=t(n);if(i.title&&(n.title=i.title),i.dataId&&s.attr("data-id",i.dataId),i.href&&(n.href=i.href),i.style&&s.css(i.style),i.attributes)for(var o in i.attributes)s.attr(o,i.attributes[o]);return this._setIconStyles(n,"icon"),n},createShadow:function(){return null}}),L.AnimatedMarker=L.Marker.extend({options:{distance:200,animated:!0,interval:1e3,autoStart:!0,normalizeSpeed:!1,onEnd:function(){}},initialize:function(t,i){this._latlngs=[],this._tid=null,this._bakIconTrans=!1,this._bakShadowTrans=!1,this._bakPopupTrans=!1;var n=null;t instanceof L.polyline||t[0]instanceof L.LatLng||e.isArray(t[0])?(this._prepare(t),n=t[0]):(this.options.autoStart=!1,n=t);var s=i.onEnd||null,o=this;this.options.onEnd=function(){o._tid=null,o._removeTransitions(),o._map&&o._map.off({zoomstart:o.stop},o),s&&s.apply(o,arguments)},L.Marker.prototype.initialize.call(this,n,i)},setLatLngs:function(t){t.length&&(this.stop(),this._prepare(t),this.setLatLng(t[0]),this._i=1,this.start())},_prepare:function(t){t instanceof L.polyline?t=t.getLatLngs():t[0]instanceof L.LatLng||(t=L.polyline(t).getLatLngs()),L.DomUtil.TRANSITION?this._latlngs=t:(this._latlngs=this._chunk(t),this.options.distance=10,this.options.interval=this.options.normalizeSpeed?30:this.options.interval/this._latlngs.length)},_chunk:function(t){var e,i=t.length,n=[];for(e=1;i>e;e++){var s=t[e-1],o=t[e],a=s.distanceTo(o),r=this.options.distance/a,l=r*(o.lat-s.lat),c=r*(o.lng-s.lng);if(a>this.options.distance)for(;a>this.options.distance;)s=new L.LatLng(s.lat+l,s.lng+c),a=s.distanceTo(o),n.push(s);else n.push(s)}return n},onAdd:function(t){L.Marker.prototype.onAdd.call(this,t),this.options.autoStart&&this.start()},animate:function(){if(this._latlngs){var t=this,e=this.options,i=this._latlngs.length,n=e.interval;if(this._i<i&&e.normalizeSpeed&&(n=this._latlngs[this._i-1].distanceTo(this._latlngs[this._i])/e.distance*e.interval),L.DomUtil.TRANSITION){var s="";if(n>0&&(s=v+" "+n+"ms linear"),this._icon&&(this._icon.style[L.DomUtil.TRANSITION]=s),this._shadow&&(this._shadow.style[L.DomUtil.TRANSITION]=s),this._popup){var o=this._popup.getContainer();o&&(o.style[L.DomUtil.TRANSITION]=s)}}this.setLatLng(this._latlngs[this._i]),this._i++,this._tid=setTimeout(function(){t._repeat()},n)}},start:function(){if(this._i||(this._i=1),L.DomUtil.TRANSITION&&(this._icon&&this._icon.style[L.DomUtil.TRANSITION]&&(this._bakIconTrans=this._icon.style[L.DomUtil.TRANSITION]),this._shadow&&this._shadow.style[L.DomUtil.TRANSITION]&&(this._bakShadowTrans=this._shadow.style[L.DomUtil.TRANSITION]),this._popup)){var t=this._popup.getContainer();t&&t.style[L.DomUtil.TRANSITION]&&(this._bakPopupTrans=t.style[L.DomUtil.TRANSITION])}this._map&&this._map.once("zoomstart",L.bind(this.stop,this),this),this.on("stop",L.bind(this.stop,this),this),this.animate()},stop:function(){this._icon&&(this._tid&&clearTimeout(this._tid),this._icon&&this._icon.style[L.DomUtil.TRANSITION]&&this._removeTransitions(),this._i<=this._latlngs.length&&this.setLatLng(e.last(this._latlngs)))},_repeat:function(){this._i===this._latlngs.length?this.options.onEnd.call(this):this.animate()},_removeTransitions:function(){if(L.DomUtil.TRANSITION&&(this._icon&&(this._icon.style[L.DomUtil.TRANSITION]=this._bakIconTrans||""),this._shadow&&(this._shadow.style[L.DomUtil.TRANSITION]=this._bakShadowTrans||""),this._popup)){var t=this._popup.getContainer();t&&(t.style[L.DomUtil.TRANSITION]=this._bakPopupTrans||"")}}}),L.animatedMarker=function(t,e){return new L.AnimatedMarker(t,e)},L.Control.MapSelect=L.Control.extend({options:{position:"topright"},onAdd:function(t){return this._map=t,this._ui=this._createUI(),t.whenReady(this._initEvents,this),this._ui.button[0]},_createUI:function(){var e,i={},n='<div class="btn dropdown pull-right leaflet-control-map-select"><a href="#"class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu nav nav-list" role="menu"><li data-map="YandexMap"><a href="#">'+c.mapName.replace("#name#","Yandex")+"</a></li>"+'<li data-map="GoogleMap"><a href="#">'+c.mapName.replace("#name#","Google")+"</a></li>"+'<li data-map="YandexMapSat"><a href="#">'+c.satMapName.replace("#name#","Yandex")+"</a></li>"+'<li data-map="YandexMapHybrid"><a href="#">'+c.hybridMapName.replace("#name#","Yandex")+"</a></li>"+'<li data-map="GoogleMapSat"><a href="#">'+c.satMapName.replace("#name#","Google")+"</a></li>"+'<li data-map="GoogleMapHybrid"><a href="#">'+c.hybridMapName.replace("#name#","Google")+"</a></li>"+'<li data-map="GoogleMapTerrain"><a href="#">'+c.landMapName.replace("#name#","Google")+"</a></li>"+'<li data-map="OpenStreetMap"><a href="#">'+c.mapName.replace("#name#","OpenStreetMap")+"</a></li>"+'<li data-map="OpenStreetMapTransport"><a href="#">'+c.transMapName.replace("#name#","OpenStreetMap")+"</a></li>";return(e=App.getServerSettings().specialMap)&&(n+='<li data-map="SpecialMap"><a href="#">'+(e.name||c.specialMapName)+"</a></li>"),n+="</ul></div>",i.button=t(n),L.DomEvent.disableClickPropagation(i.button[0]),i},_initEvents:function(){}}),L.Control.Traffic=L.Control.extend({options:{position:"topright",onToggle:null},onAdd:function(t){return this._map=t,this._ui=this._createUI(),t.whenReady(this._initEvents,this),this._ui.button[0]
},_createUI:function(){var e={};return e.button=t('<button class="btn leaflet-control-traffic'+(this._map.options.showTraffic?" active":"")+'">'+'<i class="icon-traffic"></i> '+c.traffic+"</button>"),L.DomEvent.disableClickPropagation(e.button[0]),e},_initEvents:function(){var t=this;this._ui.button.on("click",function(){var e=t._map.options.showTraffic?"removeClass":"addClass";t._ui.button[e]("active"),t._map.options.showTraffic=!t._map.options.showTraffic,t.options.onToggle&&t.options.onToggle()})}}),L.Control.Print=L.Control.extend({options:{position:"topleft",title:"Print map"},onAdd:function(t){return this._map=t,this._ui=this._createUI(),t.whenReady(this._initEvents,this),this._ui.button[0]},_createUI:function(){var e={};return e.button=t('<button title="'+this.options.title+'" class="btn leaflet-control-print">'+'<i class="svg-icon svg-icon-print"></i></button>'),L.DomEvent.disableClickPropagation(e.button[0]),e},_initEvents:function(){this._ui.button.on("click",function(){App.publish("printmainmap")})}}),L.Control.Autozoom=L.Control.extend({options:{position:"topleft",title:"Auto zoom"},onAdd:function(t){return this._map=t,this._ui=this._createUI(),t.whenReady(this._initEvents,this),this._ui.button[0]},_createUI:function(){var e={};return e.button=t('<button title="'+this.options.title+'" class="btn leaflet-control-autozoom">'+'<i class="icon-autozoom"></i></button>'),L.DomEvent.disableClickPropagation(e.button[0]),e},_initEvents:function(){var t=this;this._ui.button.on("click",function(){var e=this.className,i=-1!=e.indexOf(" fit"),n=-1!=e.indexOf(" active");i||n?n?(this.className=e.replace(" active",""),App.set("autozoomActive",!1)):(this.className+=" active",App.set("autozoomActive",!0)):t._map.fitBounds(App.get("commonBounds"),{maxZoom:App.get("commonBoundsMaxZoom"),padding:App.get("commonBoundsPadding")})})}}),L.Control.Clear=L.Control.extend({options:{position:"topright",title:c.clearMap},onAdd:function(t){return this._map=t,this._ui=this._createUI(),t.whenReady(this._initEvents,this),this._ui.button[0]},_createUI:function(){var e={};return e.button=t('<button title="'+this.options.title+'" class="btn leaflet-control-clear">'+'<i class="svg-icon svg-icon-brush"></i></button>'),L.DomEvent.disableClickPropagation(e.button[0]),e},_initEvents:function(){}});var _=L.Point,b=L.Point.prototype;L.Point=function(){_.apply(this,arguments),this._original=null},L.Point.prototype=b,e.extend(L.Point.prototype,{setOriginal:function(t){this._original=t},getOriginal:function(){return this._original}}),L.ComplexLatLng=function(){L.LatLng.apply(this,arguments),this.speed=0,this.date=null},L.complexLatLng=function(t){if(t instanceof L.ComplexLatLng)return t;if(void 0===t||null===t)return t;if(L.Util.isArray(t))var i=new L.ComplexLatLng(t[0],t[1]);else{if(!("object"==typeof t&&"lat"in t))return null;var i=new L.ComplexLatLng(t.lat,"lng"in t?t.lng:t.lon)}return e.each(["speed","date","alt","rid"],function(e){e in t&&(i[e]=t[e])}),i},L.MyPolyline=L.Polyline.extend({initialize:function(t,e){L.Polyline.prototype.initialize.call(this,t,e),this._decor=null,this._points=null,this._pointsOptions=null,this._originalLatLngs=[]},_convertLatLngs:function(t,e){var i,n,s=e?t:[];for(i=0,n=t.length;n>i;i++){if(L.Util.isArray(t[i])&&"number"!=typeof t[i][0])return;s[i]=L.complexLatLng(t[i])}return s},projectLatlngs:function(){this._originalPoints=[];for(var t=null,e=0,i=this._latlngs.length;i>e;e++)t=this._map.latLngToLayerPoint(this._latlngs[e]),t.setOriginal(this._latlngs[e]),this._originalPoints[e]=t},onAdd:function(t){L.Polyline.prototype.onAdd.call(this,t),e.isObject(this.options.weightArray)&&(this.options.defaultWeight=this.options.weight,this._setWeight(),t.on("zoomend",this._setWeight,this)),this.options.decor&&(t.on("zoomend moveend",this._drawDecor,this),this._drawDecor()),this._pointsOptions&&this.drawPoints()},onRemove:function(t){L.Polyline.prototype.onRemove.call(this,t),e.isObject(this.options.weightArray)&&t.off("zoomend",this._setWeight,this),this.options.decor&&(t.off("zoomend moveend",this._drawDecor,this),this._decor&&(this._container.removeChild(this._decor),this._decor=null))},getParts:function(){return this._parts},getOriginalProjectedPoints:function(){for(var t,e=this._originalPoints.length,i=new Array(e),n=this._map.getPixelOrigin(),s=0;e>s;++s)t=this._originalPoints[s],i[s]=t.add(n),i[s]._original=t._original||null;return i},drawPoints:function(t){if(!this._map)return t&&!t.target&&(this._pointsOptions=t,this._pointsOptions._eventsListened=!1),void 0;if(this._points)this._container.removeChild(this._points),this._points=null;else if(t&&!t.target)this._pointsOptions=t,this._pointsOptions._eventsListened=!1;else if(!this._pointsOptions)return this._map.off("zoomend moveend",this.drawPoints,this),void 0;var e=this._pointsOptions;if(e._eventsListened||(this._map.on("zoomend moveend",this.drawPoints,this),this._pointsOptions._eventsListened=!0),!(e.minZoom&&this._map.getZoom()<e.minZoom)){this._points=this._createElement("g"),this._container.appendChild(this._points);var i=this._map,n=this.options.weight/2-1,s=L.LineUtil._reducePoints(this._originalPoints,n*n+4),o=this._map._pathViewport,a=null,r={};0>=n&&(n=1);for(var l=0,c=s.length;c>l;l++)r=s[l],r.x<o.min.x||r.x>o.max.x||r.y<o.min.y||r.y>o.max.y||(a=this._createElement("circle"),a.setAttribute("r",n),a.setAttribute("cx",r.x),a.setAttribute("cy",r.y),a.setAttribute("fill-opacity",.6),a.setAttribute("stroke","rgba(0,0,0,0.1)"),a.setAttribute("stroke-width",2),e.onMouseOver&&!function(t){a.addEventListener("mouseover",function(n){i.isDragging()||e.onMouseOver(n,t.getOriginal())},!1)}(r),e.onMouseOut&&!function(t){a.addEventListener("mouseout",function(n){i.isDragging()||(e.onMouseOut(n,t.getOriginal()),t.getOriginal())},!1)}(r),this._points.appendChild(a));return s}},removePoints:function(){this._points&&(this._map&&this._map.off("zoomend moveend",this.drawPoints,this),this._container.removeChild(this._points),this._points=null,this._pointsOptions=null)},_drawDecor:function(){if(this._decor&&(this._container.removeChild(this._decor),this._decor=null),!(this.options.decorMinZoom&&this._map.getZoom()<this.options.decorMinZoom)){this._decor=this._createElement("g"),this._container.appendChild(this._decor);for(var t=this.getParts(),e=t.length,n=[],s=this._decor,o=null,a=5.657,r=90,l=new i.Transform,c=null,h="0,0 12,4 0,8",e=0,d=t.length;d>e;e++)if(n=t[e],n&&!(n.length<2))for(var u=0,p=1,m=n.length-1,d=0,f=p*r,g=0,v=0,_=0,b=0;m>u;){if(g=n[u+1].x-n[u].x,v=n[u].y-n[u+1].y,b=Math.sqrt(g*g+v*v),d+b>f)for(l.reset(),_=Math.atan(Math.abs(v)/Math.abs(g)),g>=0&&v>=0?_=2*Math.PI-_:0>g&&0>v?_=Math.PI-_:0>g?_=Math.PI+_:0>v&&(_=_),l.rotate(_),c=l.getMatrix(),g=a*Math.cos(_+Math.PI/4),v=a*Math.sin(_+Math.PI/4);d+b>f;)c[4]=n[u].x+(f-d)*Math.cos(_)-g,c[5]=n[u].y+(f-d)*Math.sin(_)-v,o=this._createElement("polygon"),o.setAttribute("stroke-width",0),o.setAttribute("fill","white"),o.setAttribute("points",h),o.setAttribute("transform","matrix("+c.join(",")+")"),s.appendChild(o),f=++p*r;d+=b,++u}}},_setWeight:function(){var t=this._map,e=t.getZoom(),i=!1;for(var n in this.options.weightArray)if(n=parseInt(n),e>=n)i=n;else if(i!==!1)break;var s=this.options.defaultWeight;i!==!1&&(s=this.options.weightArray[i]),this.options.weight=s,this._path&&this._path.setAttribute("stroke-width",s)}}),L.ComplexPolyline=L.FeatureGroup.extend({initialize:function(){this._layers={},this._showPoints=!1,this._originalLatLngs=[]},setLatLngs:function(){return this},getLatLngs:function(){var t=[];return this.eachLayer(function(e){t=t.concat(e.getLatLngs())}),t},getOriginalProjectedPoints:function(){var t=[];return this.eachLayer(function(e){t=t.concat(e.getOriginalProjectedPoints())}),t},addSegment:function(t){return this.addLayer(t),this},showPoints:function(t){this._showPoints||(this._showPoints=!0,this.eachLayer(function(e){e.drawPoints(t)}))},removePoints:function(){this._showPoints&&(this._showPoints=!1,this.eachLayer(function(t){t.removePoints()}))}}),L.Control.Scale.prototype._updateMetric=function(t){var e=this._getRoundNum(t);this._mScale.style.width=this._getScaleWidth(e/t)+"px",this._mScale.innerHTML=1e3>e?e+" "+c.m:e/1e3+" "+c.km},L.Map.include({isDragging:function(){return this.dragging._draggable._moving}}),L.Map.mergeOptions({traffic:!1,showTraffic:!1}),e.extend(d.prototype,{reset:function(){this._LMap&&this._LMap._onResize()},getMap:function(){return this._LMap},setMap:function(t,i){var n=this._map,s=this;this._map=t.map,i&&(this._LMap=L.map(i,{attributionControl:!1,keyboardPanOffset:150,ruler:t.ruler||!1,traffic:t.traffic||!1,showTraffic:t.showTraffic||!1,routing:t.routing||!1,coordinateControl:t.coords||!1,miniMapControl:t.minimap||!1,print:t.print||!1,autozoom:t.autozoom||!1,layersControl:t.layersControl||!1,clearControl:t.clearControl||!1}),this._LMap.on("zoomstart",function(){s._errorTiles=0})),this._tilesLayer&&this._LMap.removeLayer(this._tilesLayer),this._hybridLayer&&(this._LMap.removeLayer(this._hybridLayer),this._hybridLayer=null);var o=L.CRS.EPSG3857;"yandex"==this._map.getProjectionType()&&(o=L.CRS.Yandex);var a=this._map.getSourceData(),r={reuseTiles:!0,subdomains:a.sub||null,errorTileUrl:a.errorTileUrl||"",zIndex:1,minZoom:this._map.getMinZoom(),maxZoom:this._map.getMaxZoom(),continuousWorld:!1,noWrap:!0,onBreak:a.onBreak||null};if(this._tilesLayer=L.tileLayer(a.url,r).addTo(this._LMap),e.extend(this._LMap.options,{crs:o}),this._LMap.setView(t.center,t.zoom,{reset:!0}),!r.errorTileUrl&&this._tilesLayer.on("tileerror",function(t){if(++s._errorTiles/e.size(s._tilesLayer._tiles)>p){if(s._layerIsBroken)return;r.onBreak&&(++s._brokenLevels>3||s._LMap.getZoom()<=s._LMap.getMinZoom())?(s._layerIsBroken=!0,r.onBreak(t)):(s._errorTiles=0,s._LMap.setView(s._LMap.getCenter(),s._LMap.getZoom()-1,{zoom:{animate:!1}}))}}),this._tilesLayer.once("load",function(){s._LMap.fire("tilesbuilt")}).on("load",function(){s._layerIsBroken&&s._errorTiles/e.size(s._tilesLayer._tiles)<=p&&(s._layerIsBroken=!1,s._brokenLevels=0)}),this._map.isHybrid()){var l=this._map.getExtraLayer(this),a=l.getSourceData();r.subdomains=a.sub||null,r.zIndex=2,r.minZoom=this._LMap.getMinZoom(),r.maxZoom=this._LMap.getMaxZoom(),this._hybridLayer=L.tileLayer(a.url,r).addTo(this._LMap)}if(this._LMap.options.showTraffic){var c=this._map.getTrafficLayerClass(),h="",s=this;n&&(h=n.getTrafficLayerClass()),h!=c&&(this._trafficLayer&&this._LMap.removeLayer(this._trafficLayer),this.showTrafficLayer())}else this._trafficLayer&&this.removeTrafficLayer();return this._LMap},showTrafficLayer:function(){var t=this,e=this._map.getTrafficLayerClass(),i={};e&&requirejs(["maps/"+e],function(e){var n=new e(t._map,t);n.getSourceData().done(function(e){i.subdomains=e.sub||null,i.zIndex=3,i.minZoom=t._LMap.getMinZoom(),i.maxZoom=t._LMap.getMaxZoom(),t._trafficLayer=L.tileLayer(e.url,i).addTo(t._LMap),t._trafficUpdateInterval=setInterval(function(){t.updateTrafficLayer()},m)})})},removeTrafficLayer:function(){this._LMap.removeLayer(this._trafficLayer),this._trafficLayer=null,this._trafficUpdateInterval&&(clearInterval(this._trafficUpdateInterval),this._trafficUpdateInterval=null)},updateTrafficLayer:function(){this._trafficLayer&&(this.removeTrafficLayer(),this.showTrafficLayer())},addAddressMarker:function(i,n){var s=this,o=null,a=null;if(n=e.extend({zoom:this._map.getMaxZoom()-2,marker:{draggable:!0,bounceOnAdd:!1,icon:new L.PinIcon({addClassName:"address-marker"})},popup:{closeOnClick:!1}},n||{}),this._LMap.setView([i.lat,i.lon],n.zoom||this._LMap.getZoom()),o=L.marker([i.lat,i.lon],n.marker||{}),o.addTo(this._LMap),a=n.routingModule||null,n.popup){var r=l({i18n:c,data:i,addressActions:n.addressActions||[],routingModule:a,isYandex:n.isYandex,externalLink:n.externalLink}),h=n.openPopup!==!1;o.bindPopup(r,n.popup),h&&o.openPopup();var d=o._popup,u=t(d.getContainer());u.addClass("marker-info").data("marker",o).one("click","a.delete-it",function(){s._LMap.removeLayer(o)}).find(".positive").numeric({decimal:".",negative:!1}),a&&u.on("click","a.route-to",function(){var t=o.getLatLng();return a.openRouting([null,{type:"address",text:u.find(".address").text(),lat:t.lat,lon:t.lng}],u),o.closePopup(),!1}),o.on("dragend",function(){var t=o.getLatLng();s._map.geocode({lat:t.lat,lon:t.lng,success:function(t){t.address&&(i.title=t.address,r=l({i18n:c,data:i,addressActions:n.addressActions||[],routingModule:a}),d.setContent(r),o.trigger("change",i))}})}).on("popreset",function(){d.setContent(l({i18n:c,data:i,addressActions:n.addressActions||[],routingModule:a}))})}return o.on("destroy dblclick",function(){s._LMap.removeLayer(o),s.addressMarkers=e.without(s.addressMarkers,o)}),this.addressMarkers.push(o),o},clearAddressMarkers:function(){for(var t=this.addressMarkers,e=t.length;e--;)this._LMap.removeLayer(t[e]);this.addressMarkers=[]},buildMarker:function(t){var e=L.marker([t.lat,t.lon],{icon:t.icon||new L.ComplexIcon(t),data:t.data||null}),i=this;return e.on("destroy hide",function(){i._LMap.removeLayer(e)}).on("show",function(){i._LMap.addLayer(e)}),e},putMarker:function(t){var e=this.buildMarker(t);return this._LMap.addLayer(e),e},findLayer:function(t){var i=null;return this._LMap?i=e.find(this._LMap._layers,t):null},buildComplexMarker:function(i){if(i.animated)var n=L.animatedMarker([i.lat,i.lon],{autoStart:!1,interval:"interval"in i?i.interval:1e3,icon:new L.ComplexIcon(i),model:i.model||null});else var n=L.marker([i.lat,i.lon],{icon:new L.ComplexIcon(i),model:i.model||null,draggable:i.draggable===!0});var s=this;return n.on("place",function(t){if(t.to){var i=[t.to.lat,e.isUndefined(t.to.lon)?t.to.lng:t.to.lon];if(t.animate&&n.setLatLngs)t.cluster&&!n._icon?t.cluster.updateMarkerPos(n,new L.LatLng(i[0],i[1])):("interval"in t&&(n.options.interval=t.interval),n.setLatLngs(t.animate));else if(t.cluster)try{t.cluster.updateMarkerPos(n,new L.LatLng(i[0],i[1]))}catch(s){}else n.setLatLng(i)}}).on("rotate",function(i){if(!e.isUndefined(i.angle)&&L.DomUtil.TRANSFORM){var s;if(n._icon)s=n._icon.getElementsByTagName("I")[0],s.style[L.DomUtil.TRANSFORM]="rotate("+i.angle+"deg)",s=t(n._icon).html();else{var o=t(n.options.icon.options.html);o[0].style[L.DomUtil.TRANSFORM]="rotate("+i.angle+"deg)",s="",o.each(function(){s+=this.outerHTML})}n.options.icon.options.html=s}}).on("iconchange",function(i){e.isUndefined(i.html)||(n.options.icon.options.html=i.html,n._icon&&t(n._icon).html(i.html))}).on("destroy",function(){s._LMap.removeLayer(n)}).on("settitle",function(e){n._icon&&t(n._icon).find(".name").text(e.title)}).on("toggleclass",function(t){var e=n.options.icon.options,i=e.className;if("name"in t)for(var s,o,a=t.name.split(" "),r=a.length;r--;)s=a[r],o=new RegExp("(^|\\s)"+s+"(\\s|$)"),i.length>0&&o.test(i)?i=L.Util.trim((" "+i+" ").replace(" "+s+" "," ")):i+=(i?" ":"")+s;else"off"in t&&i.length>0&&new RegExp("(^|\\s)"+t.off+"(\\s|$)").test(i)&&(i=L.Util.trim((" "+i+" ").replace(" "+t.off+" "," "))),"on"in t&&(i+=(i?" ":"")+t.on);e.className=i,n.setIcon(new L.ComplexIcon(e))}).on("zoomchange",function(t){t.cluster&&n.unspiderfy(),t&&t.center&&(t.zoom=t.zoom||s._LMap.getMaxZoom(),s.zoom(t))}).on("follow",function(t){t.cluster&&n.unspiderfy(),t&&t.center&&s._LMap.panTo(t.center)}),n},buildLayersGroup:function(i){if(this._LMap){var n=[],s=this,o=t(this._LMap.getPanes().objectsPane);i.layers&&(n=i.layers),i.groupCssClass&&o.addClass(i.groupCssClass);var a=null;if(i.clusters&&L.MarkerClusterGroup){var r=e.extend({maxClusterRadius:50,showCoverageOnHover:!1,zoomToBoundsOnClick:!1,animateAddingMarkers:!1,spiderfyDistanceMultiplier:2},i.clusters);if(i.clusters.icon){var l=i.clusters.icon,c=l.html||"<div>#count#</div>";r.iconCreateFunction=function(t){var e=t.getChildCount();return new L.ComplexIcon({html:c.replace("#count#",e),className:"marker-cluster"+(l.className?" "+l.className:""),style:l.style||null,iconSize:null})}}a=L.markerClusterGroup(r).addLayers(n),a.on("clusterclick",function(t){var e=t.layer;e.getChildCount()<=10||s._LMap.getMaxZoom()===s._LMap.getZoom()?e.spiderfy():e.zoomToBounds()}).on("update",function(){})}else a=L.featureGroup(n,i);if(a.on("destroy",function(){a.clearLayers(),s._LMap.removeLayer(a)}).on("hide",function(){s._LMap.removeLayer(a)}).on("show",function(){s._LMap.addLayer(a)}).on("toggleclass",function(t){t.name&&o.toggleClass(t.name)}),i.events)for(var h in i.events)a.on("click",function(t){i.events[h].call(t.layer,t.originalEvent,{lat:t.latlng.lat,lon:t.latlng.lng},t.layer.options.model||t.layer.options.data||null)});return a}},addLayersGroup:function(t){var e=this.buildLayersGroup(t);return this._LMap.addLayer(e),e},addLayerToGroup:function(t,e){var i=null;switch(e.type){case"path":break;default:i=L.marker(e.point,e)}t.addLayer(i)},zoom:function(t,i){var n=0,s=t.to||t.zoom||this._LMap.getZoom()+1;e.isNumber(s)?n=s:"max"==s&&(n=this._LMap.getMaxZoom()),this._LMap.setView(t.center||this._LMap.getCenter(),n),i&&i()},addPopup:function(e){var i={maxWidth:e.maxWidth||300},n=L.popup(i).setContent(e.content);n.addTo(this._LMap);var s=t(n.getContainer());e.addClass&&s.addClass(e.addClass),e.id&&s.attr("id",e.id),e.model&&s.data("model",e.model)},addHtmlLayer:function(){this._LMap&&new L.LayerGroup},getBoundsZoom:function(t){return this._LMap.getBoundsZoom(t)},removeLayer:function(t){this._LMap.hasLayer(t)&&this._LMap.removeLayer(t)},buildPolyline:function(t,e){var i=this,n=new L.MyPolyline(t,e);return n.on("destroy",function(){i._LMap.removeLayer(n),n=null}).on("hide",function(){i._LMap.removeLayer(n)}).on("show",function(){i._LMap.addLayer(n)}),n},buildComplexPolyline:function(){var t=this,e=new L.ComplexPolyline;return e.on("destroy",function(){e.eachLayer(function(e){t._LMap.removeLayer(e),e=null},e),e=null}).on("hide",function(){e.eachLayer(function(e){t._LMap.removeLayer(e)},e)}).on("show",function(){e.eachLayer(function(e){t._LMap.addLayer(e)},e)}),e},buildPolygon:function(t){for(var i=[],n=0,s=t.latlng.length;s>n;++n){var o=t.latlng[n];o instanceof L.LatLng?i.push(o):i.push(new L.LatLng(o.lat,o.lon))}return new L.Polygon(i,e.extend({stroke:!1,color:"red",weight:5,clickable:!1},t))},buildRadial:function(t){if(e.isArray(t.center))var i=new L.LatLng(t.center[0],t.center[1]);else var i=new L.LatLng(t.center.lat,t.center.lon);return new L.Circle(i,t.radius,e.extend({stroke:!1,color:"red",weight:5,clickable:!1},t))},addLayer:function(t){this._LMap.addLayer(t)},fitPolygon:function(t){this._LMap.fitBounds(t.getBounds())},fitBounds:function(t){return this._LMap.fitBounds(t,arguments[1]||{})},buildEditablePolygon:function(t){var t=t||{};return new L.Edit.Polygon(t)},buildEditableRadial:function(t){var t=t||{};return new L.Edit.Circle(t)},buildEditablePoint:function(t){var t=t||{};return new L.Edit.Point(t)},getCenter:function(){var t=this._LMap.getCenter();return{lat:t.lat,lon:t.lng}},getBounds:function(){var t=this._LMap.getBounds();return[[t.getSouth(),t.getWest()],[t.getNorth(),t.getEast()]]},getBoundsWithPadding:function(t){var e=this._LMap.getPixelBounds(),i=e.min.x+t[0],n=e.min.y+t[1],s=e.max.x-t[0],o=e.max.y-t[1],a=this.unproject([i,o]),r=this.unproject([s,n]);return[[a.lat,a.lng],[r.lat,r.lng]]},setBounds:function(t){if(this._LMap&&t){if(t.minLat)t=[[t.maxLat,t.minLon],[t.minLat,t.maxLon]];else if(e.isArray(t)&&(!t.length||null===t[0][0]))return;this._LMap.fitBounds(t,arguments[1]||{})}},unproject:function(t){return this._LMap.unproject(t)},destroy:function(){this._LMap&&this._LMap.remove()}});for(var y=["setZoom","getZoom","setCenter"],w=y.length;w--;)!function(t){d.prototype[t]=function(){return this._LMap[t].apply(this._LMap,arguments)}}(y[w]);var x={initWidget:function(e,i){if(!i.map||!i.map.getSourceData)return!1;var n=this,s=this.widget.setMap(i,e),o=n.model;return s.off("dblclick").on("dblclick",function(t){return s.setView(t.latlng,s.getZoom()+1),!1}).on("tilesbuilt viewreset",function(){o.publish("tilesbuilt")}).on("zoomstart",function(){o.trigger("zoomstart")}).on("zoomend",function(){var t=n.widget.getZoom();o.setUserData("zoom",t),i.autozoom&&x.autozoom.call(n),x.checkZoom.call(n)}).on("movestart",function(){o.publish("start")}).on("moveend",function(){o.publish("stop"),o.setUserData("center",n.widget.getCenter()),i.autozoom&&x.autozoom.call(n)}),i.traffic&&s.on("toggletraffic",function(){n.model.setUserData("showTraffic",s.options.showTraffic),s.options.showTraffic?n.widget.showTrafficLayer():n.widget.removeTrafficLayer()}),this.model.get("layersControl")&&(this.$el.find("[data-map="+this.model.get("usedMap")+"]").addClass("active"),this.$el.on("click","[data-map]",function(){var e=t(this);n.model.setMap(e.data("map")),e.addClass("active").siblings(".active").removeClass("active")})),this.$el.on("click",".leaflet-control-clear",function(){App.trigger("clearmap",n.model),n.$el.find(".leaflet-control-ruler.active").trigger("click"),n.widget.clearAddressMarkers()}),i.autozoom&&this.listenTo(App,"change:commonBounds",function(){x.autozoom.call(n)}).listenTo(App,"change:autozoomActive",function(t,e){e||(n._autozoomTimeout&&clearTimeout(n._autozoomTimeout),n.setAutozoomState())}),this.listenTo(App,"objectsGroupingChange",function(){x.checkZoom.call(n)}),x.checkZoom.call(n),s},checkZoom:function(){var e=this.widget.getMap(),i=t(e.getPanes().objectsPane),n=App.getUserData("objectsGrouping");n&&n.changeSize&&this.widget.getZoom()<f?i.addClass("leaflet-objects-pane__icon-mini"):i.removeClass("leaflet-objects-pane__icon-mini")},search:function(t){var e=this.searchForm.addClass("active").serializeObject();e.center=this.widget.getCenter(),e.bounds=this.widget.getBounds(),this.model.publish("needsearch",e,this,t||null)},autozoom:function(){if(App.get("autozoomActive")){var t=App.get("commonBounds");if(t&&t[0][0]){var e=this.containsCommonBounds(t);e||x.setAutozoomTimeout.call(this)}}else this.setAutozoomState()},setAutozoomTimeout:function(){var t=this;this._autozoomTimeout&&clearTimeout(this._autozoomTimeout),this._autozoomTimeout=setTimeout(function(){t.widget.getMap().fitBounds(App.get("commonBounds"),{maxZoom:App.get("commonBoundsMaxZoom"),padding:App.get("commonBoundsPadding")}),t._autozoomTimeout=null},5e3)}},C=n.extend({constructor:function(){this._autozoomTimeout=null,n.apply(this,arguments)},initialize:function(){this.select=null,this.cont=null,this.block=null,this.searchForm=null,this.searchInput=null,this.widget=new d;var t=this;this.listenTo(App,"layoutchange",function(){t.widget&&t.widget.reset()}).listenTo(App,"blockmap",function(){t.$el.addClass("blocked")}).listenTo(App,"unblockmap",function(){t.$el.removeClass("blocked")}),this.listenTo(this.model,"mapchanged",function(e){t.widget&&t.widget.setMap({map:e,center:t.widget.getCenter(),zoom:t.widget.getZoom()})}).listenTo(this.model,"layoutchange",function(){t.widget&&t.widget.reset()}),this.on("searchstart",function(){}).on("searchcomplete",function(){}).on("searchsuccess",function(e,i){return e.length?(i.putMarker?t.addAddressMarker(e[0],i):i.zoom&&t.widget.zoom({to:"max",center:e[0]}),i.onsuccess&&i.onsuccess(e),void 0):alert(c.nothingFoundByYourRequest)}).on("searcherror",function(){alert(c.commonSearchError)}).on("suggestsuccess",function(t,e){e&&e(t)}).on("suggesterror",function(){t.searchInput.removeClass("ui-autocomplete-loading")})},render:function(){var i=this,n=e.template(r,e.extend({},u,this.model.attributes));if(this.$el.append(n),this.cont=this.$el,this.setElement(this.$el.find(".maps-module")),this.$el.removeClass("loading"),this.select=this.$el.find(".map-type-select select"),this.select.on("change",function(){i.model.setMap(this.value)}),this.model.get("search")){if(this.searchForm=this.$el.find(".form-search").on("submit",function(){return x.search.call(i),!1}),this.searchInput=this.searchForm.find("input[name=q]"),this.searchForm.on("click",".icon-clear",function(){i.searchForm.removeClass("active"),i.searchInput.val("").focus()}),t.fn.autocomplete){var s=this.searchForm.find("input[name=type]");this.searchInput.autocomplete({minLength:2,source:function(t,e){var n={q:t.term,type:s.val(),center:i.widget.getCenter(),bounds:i.widget.getBounds()};i.model.publish("needsuggest",n,e,i)},select:function(t,e){if(e.item){var n=e.item;i.searchInput.val(n.value);var s=null;if("original"in n)s=n.original;else if(n.lat&&n.lon){var o=Number(n.lat),a=Number(n.lon);0!==o&&0!==a&&(s={lat:o,lon:a,title:n.label})}x.search.call(i,s)}return window.setTimeout(function(){i.searchInput.blur()},0),!1},open:function(){t(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){t(this).removeClass("ui-corner-top").addClass("ui-corner-all")}})}this.model.get("searchTypes")&&this.searchForm.on("click","a[data-type]",function(){var e=t(this),n=e.data("type");i.searchForm.find("input[name=q]").val("").focus().end().find("input[name=type]").val(n).end().find(".dropdown-toggle span").first().text(e.text()),i.model.setUserData("defSearchType",n)})}},activate:function(i){var n=this;this.model;var s=e.extend({},u,this.model.attributes),o=[];s.compass&&(o.push(LIBS_PATH+"leaflet/plugins/pancontrol/src/L.Control.Pan"),o.push("css!"+LIBS_PATH+"leaflet/plugins/pancontrol/src/L.Control.Pan.css")),s.slider&&(o.push(LIBS_PATH+"leaflet/plugins/zoomslider/src/L.Control.Zoomslider"),o.push("css!"+LIBS_PATH+"leaflet/plugins/zoomslider/src/L.Control.Zoomslider.css")),s.coords&&!t.support.touch&&(o.push(LIBS_PATH+"leaflet/plugins/coordinates/dist/Leaflet.Coordinates-0.1.3.src"),o.push("css!"+LIBS_PATH+"leaflet/plugins/coordinates/dist/Leaflet.Coordinates-0.1.3.css")),s.minimap&&(o.push(LIBS_PATH+"leaflet/plugins/minimap/src/Control.MiniMap"),o.push("css!"+LIBS_PATH+"leaflet/plugins/minimap/src/Control.MiniMap.css")),s.ruler&&(o.push("css!"+LIBS_PATH+"leaflet/plugins/draw/leaflet.draw.css"),o.push(LIBS_PATH+"leaflet/plugins/draw/leaflet.draw")),s.ruler&&o.push(LIBS_PATH+"leaflet/plugins/ruler/leaflet.ruler"),o.push(LIBS_PATH+"leaflet/plugins/markercluster/dist/leaflet.markercluster-src"),o.push("css!"+LIBS_PATH+"leaflet/plugins/markercluster/dist/MarkerCluster.Default.css"),o.push("css!"+LIBS_PATH+"leaflet/plugins/markercluster/dist/MarkerCluster.css");var a=new t.Deferred;return requirejs(o,function(){h(),x.initWidget.call(n,n.$(".module-content")[0],e.extend(s,i||{})),a.resolve()}),this.select.find("[value="+this.model.getMap().getClass()+"]").attr("selected","selected"),t.fn.chosen&&this.select.chosen({disable_search:!0}),a},getWidget:function(){return this.widget},setAutozoomState:function(){var t=this.$el.find("button.leaflet-control-autozoom")[0],e=t.className,i=-1!=e.indexOf(" fit"),n=App.get("commonBounds");if(n&&n[0][0]){var s=this.containsCommonBounds(n);s?i||(t.className+=" fit"):i&&(t.className=e.replace(" fit",""))}else t.className=e.replace(/( fit| active)/,"")},containsCommonBounds:function(t){var e=L.latLngBounds(this.widget.getBoundsWithPadding(App.get("commonBoundsPadding")));return t=L.latLngBounds(t[0],t[1]),e.contains(t)},addAddressMarker:function(t,i){var n=-1!=this.model.get("usedMap").indexOf("andex"),s=t.lat,o=t.lon,a="https://www.google.com/maps/place/"+s+"+"+o+"/@"+s+","+o+",17z";return i=i||{},n&&(a="https://maps.yandex.ru/?text="+t.title+"&ll="+o+","+s+"&z=17"),this.widget.addAddressMarker(t,e.extend({addressActions:i.extraActions||[],routingModule:this.model.get("routing")?this.model:null,isYandex:n,externalLink:a},i))},destroy:function(){this._autozoomTimeout&&clearTimeout(this._autozoomTimeout),App.unsubscribe(this),this.widget.destroy()}});return C}),define("_libs/simpleheat/simpleheat",[],function(){function t(e){return this instanceof t?(this._canvas=e="string"==typeof e?document.getElementById(e):e,this._ctx=e.getContext("2d"),this._width=e.width,this._height=e.height,this._max=1,this._data=[],void 0):new t(e)}return t.prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(t){return this._data=t,this},max:function(t){return this._max=t,this},add:function(t){return this._data.push(t),this},clear:function(){return this._data=[],this},radius:function(t,e){e=void 0===e?15:e;var i=this._circle=this._createCanvas(),n=i.getContext("2d"),s=this._r=t+e;return i.width=i.height=2*s,n.shadowOffsetX=n.shadowOffsetY=2*s,n.shadowBlur=e,n.shadowColor="rgba(0, 0, 0, 0.9)",n.beginPath(),n.arc(-s,-s,t,0,2*Math.PI,!0),n.closePath(),n.fill(),this},resize:function(){this._width=this._canvas.width,this._height=this._canvas.height},gradient:function(t){var e=this._createCanvas(),i=e.getContext("2d"),n=i.createLinearGradient(0,0,0,256);e.width=1,e.height=256;for(var s in t)n.addColorStop(+s,t[s]);return i.fillStyle=n,i.fillRect(0,0,1,256),this._grad=i.getImageData(0,0,1,256).data,this},draw:function(t){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var e=this._ctx;e.clearRect(0,0,this._width,this._height);for(var i,n=0,s=this._data.length;s>n;n++)i=this._data[n],e.globalAlpha=Math.min(Math.max(i[2]/this._max,void 0===t?.05:t),1),e.drawImage(this._circle,i[0]-this._r,i[1]-this._r);var o=e.getImageData(0,0,this._width,this._height);return this._colorize(o.data,this._grad),e.putImageData(o,0,0),this},_colorize:function(t,e){for(var i,n=0,s=t.length;s>n;n+=4)i=4*t[n+3],i&&(t[n]=e[i],t[n+1]=e[i+1],t[n+2]=e[i+2])},_createCanvas:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}},t}),define("maps/SimpleHeatLayer",["_libs/leaflet/leaflet-src","_libs/simpleheat/simpleheat"],function(t,e){return t.SimpleHeatLayer=(t.Layer?t.Layer:t.Class).extend({initialize:function(e,i){this._latlngs=e,t.setOptions(this,i)},setLatLngs:function(t){return this._latlngs=t,this.redraw()},addLatLng:function(t){return this._latlngs.push(t),this.redraw()},setOptions:function(e){return t.setOptions(this,e),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return this._heat&&!this._frame&&this._map&&!this._map._animating&&(this._frame=t.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(e){this._map=e,this._canvas||this._initCanvas(),this.options.pane?this.getPane().appendChild(this._canvas):e._panes.overlayPane.appendChild(this._canvas),e.on("moveend",this._reset,this),e.options.zoomAnimation&&t.Browser.any3d&&e.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){this.options.pane?this.getPane().removeChild(this._canvas):t.getPanes().overlayPane.removeChild(this._canvas),t.off("moveend",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},_initCanvas:function(){var i=this._canvas=t.DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer"),n=t.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);i.style[n]="50% 50%";var s=this._map.getSize();i.width=s.x,i.height=s.y;var o=this._map.options.zoomAnimation&&t.Browser.any3d;t.DomUtil.addClass(i,"leaflet-zoom-"+(o?"animated":"hide")),this._heat=e(i),this._updateOptions()},_updateOptions:function(){this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max)},_reset:function(){var e=this._map.containerPointToLayerPoint([0,0]);t.DomUtil.setPosition(this._canvas,e);var i=this._map.getSize();this._heat._width!==i.x&&(this._canvas.width=this._heat._width=i.x),this._heat._height!==i.y&&(this._canvas.height=this._heat._height=i.y),this._redraw()},_redraw:function(){if(this._map){var e,i,n,s,o,a,r,l,c,h=[],d=this._heat._r,u=this._map.getSize(),p=new t.Bounds(t.point([-d,-d]),u.add([d,d])),m=void 0===this.options.max?1:this.options.max,f=void 0===this.options.maxZoom?this._map.getMaxZoom():this.options.maxZoom,g=1/Math.pow(2,Math.max(0,Math.min(f-this._map.getZoom(),12))),v=d/2,_=[],b=this._map._getMapPanePos(),y=b.x%v,w=b.y%v;for(e=0,i=this._latlngs.length;i>e;e++)if(n=this._map.latLngToContainerPoint(this._latlngs[e]),p.contains(n)){o=Math.floor((n.x-y)/v)+2,a=Math.floor((n.y-w)/v)+2;var x=void 0!==this._latlngs[e].alt?this._latlngs[e].alt:void 0!==this._latlngs[e][2]?+this._latlngs[e][2]:1;
c=x*g,_[a]=_[a]||[],s=_[a][o],s?(s[0]=(s[0]*s[2]+n.x*c)/(s[2]+c),s[1]=(s[1]*s[2]+n.y*c)/(s[2]+c),s[2]+=c):_[a][o]=[n.x,n.y,c]}for(e=0,i=_.length;i>e;e++)if(_[e])for(r=0,l=_[e].length;l>r;r++)s=_[e][r],s&&h.push([Math.round(s[0]),Math.round(s[1]),Math.min(s[2],m)]);this._heat.data(h).draw(this.options.minOpacity),this._frame=null}},_animateZoom:function(e){var i=this._map.getZoomScale(e.zoom),n=this._map._getCenterOffset(e.center)._multiplyBy(-i).subtract(this._map._getMapPanePos());t.DomUtil.setTransform?t.DomUtil.setTransform(this._canvas,n,i):this._canvas.style[t.DomUtil.TRANSFORM]=t.DomUtil.getTranslateString(n)+" scale("+i+")"}}),t.simpleheatLayer=function(e,i){return new t.SimpleHeatLayer(e,i)},t.SimpleHeatLayer}),function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define("_libs/heatmap/heatmap.min",i):e[t]=i()}("h337",this,function(){var t={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},e=function(){var e=function(t){this._coordinator={},this._data=[],this._radi=[],this._min=10,this._max=1,this._xField=t.xField||t.defaultXField,this._yField=t.yField||t.defaultYField,this._valueField=t.valueField||t.defaultValueField,t.radius&&(this._cfgRadius=t.radius)},i=t.defaultRadius;return e.prototype={_organiseData:function(t,e){var n=t[this._xField],s=t[this._yField],o=this._radi,a=this._data,r=this._max,l=this._min,c=t[this._valueField]||1,h=t.radius||this._cfgRadius||i;a[n]||(a[n]=[],o[n]=[]),a[n][s]?a[n][s]+=c:(a[n][s]=c,o[n][s]=h);var d=a[n][s];return d>r?(e?this.setDataMax(d):this._max=d,!1):l>d?(e?this.setDataMin(d):this._min=d,!1):{x:n,y:s,value:c,radius:h,min:l,max:r}},_unOrganizeData:function(){var t=[],e=this._data,i=this._radi;for(var n in e)for(var s in e[n])t.push({x:n,y:s,radius:i[n][s],value:e[n][s]});return{min:this._min,max:this._max,data:t}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var t=arguments[0],e=t.length;e--;)this.addData.call(this,t[e]);else{var i=this._organiseData(arguments[0],!0);i&&(0===this._data.length&&(this._min=this._max=i.value),this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[i]}))}return this},setData:function(t){var e=t.data,i=e.length;this._data=[],this._radi=[];for(var n=0;i>n;n++)this._organiseData(e[n],!1);return this._max=t.max,this._min=t.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(t){return this._max=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(t){return this._min=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(t){this._coordinator=t},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},e}(),i=function(){function t(t){var i=t.container,n=this.shadowCanvas=document.createElement("canvas"),s=this.canvas=t.canvas||document.createElement("canvas");this._renderBoundaries=[1e4,1e4,0,0];var o=getComputedStyle(t.container)||{};s.className="heatmap-canvas",this._width=s.width=n.width=t.width||+o.width.replace(/px/,""),this._height=s.height=n.height=t.height||+o.height.replace(/px/,""),this.shadowCtx=n.getContext("2d"),this.ctx=s.getContext("2d"),s.style.cssText=n.style.cssText="position:absolute;left:0;top:0;",i.style.position="relative",i.appendChild(s),this._palette=e(t),this._templates={},this._setStyles(t)}var e=function(t){var e=t.gradient||t.defaultGradient,i=document.createElement("canvas"),n=i.getContext("2d");i.width=256,i.height=1;var s=n.createLinearGradient(0,0,256,1);for(var o in e)s.addColorStop(o,e[o]);return n.fillStyle=s,n.fillRect(0,0,256,1),n.getImageData(0,0,256,1).data},i=function(t,e){var i=document.createElement("canvas"),n=i.getContext("2d"),s=t,o=t;if(i.width=i.height=2*t,1==e)n.beginPath(),n.arc(s,o,t,0,2*Math.PI,!1),n.fillStyle="rgba(0,0,0,1)",n.fill();else{var a=n.createRadialGradient(s,o,t*e,s,o,t);a.addColorStop(0,"rgba(0,0,0,1)"),a.addColorStop(1,"rgba(0,0,0,0)"),n.fillStyle=a,n.fillRect(0,0,2*t,2*t)}return i},n=function(t){for(var e=[],i=t.min,n=t.max,s=t.radi,t=t.data,o=Object.keys(t),a=o.length;a--;)for(var r=o[a],l=Object.keys(t[r]),c=l.length;c--;){var h=l[c],d=t[r][h],u=s[r][h];e.push({x:r,y:h,value:d,radius:u})}return{min:i,max:n,data:e}};return t.prototype={renderPartial:function(t){t.data.length>0&&(this._drawAlpha(t),this._colorize())},renderAll:function(t){this._clear(),t.data.length>0&&(this._drawAlpha(n(t)),this._colorize())},_updateGradient:function(t){this._palette=e(t)},updateConfig:function(t){t.gradient&&this._updateGradient(t),this._setStyles(t)},setDimensions:function(t,e){this._width=t,this._height=e,this.canvas.width=this.shadowCanvas.width=t,this.canvas.height=this.shadowCanvas.height=e},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(t){this._blur=0==t.blur?0:t.blur||t.defaultBlur,t.backgroundColor&&(this.canvas.style.backgroundColor=t.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=t.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=t.height||this._height,this._opacity=255*(t.opacity||0),this._maxOpacity=255*(t.maxOpacity||t.defaultMaxOpacity),this._minOpacity=255*(t.minOpacity||t.defaultMinOpacity),this._useGradientOpacity=!!t.useGradientOpacity},_drawAlpha:function(t){for(var e=this._min=t.min,n=this._max=t.max,t=t.data||[],s=t.length,o=1-this._blur;s--;){var a,r=t[s],l=r.x,c=r.y,h=r.radius,d=Math.min(r.value,n),u=l-h,p=c-h,m=this.shadowCtx;this._templates[h]?a=this._templates[h]:this._templates[h]=a=i(h,o);var f=(d-e)/(n-e);m.globalAlpha=.01>f?.01:f,m.drawImage(a,u,p),u<this._renderBoundaries[0]&&(this._renderBoundaries[0]=u),p<this._renderBoundaries[1]&&(this._renderBoundaries[1]=p),u+2*h>this._renderBoundaries[2]&&(this._renderBoundaries[2]=u+2*h),p+2*h>this._renderBoundaries[3]&&(this._renderBoundaries[3]=p+2*h)}},_colorize:function(){var t=this._renderBoundaries[0],e=this._renderBoundaries[1],i=this._renderBoundaries[2]-t,n=this._renderBoundaries[3]-e,s=this._width,o=this._height,a=this._opacity,r=this._maxOpacity,l=this._minOpacity,c=this._useGradientOpacity;0>t&&(t=0),0>e&&(e=0),t+i>s&&(i=s-t),e+n>o&&(n=o-e);for(var h=this.shadowCtx.getImageData(t,e,i,n),d=h.data,u=d.length,p=this._palette,m=3;u>m;m+=4){var f=d[m],g=4*f;if(g){var v;v=a>0?a:r>f?l>f?l:f:r,d[m-3]=p[g],d[m-2]=p[g+1],d[m-1]=p[g+2],d[m]=c?p[g+3]:v}}h.data=d,this.ctx.putImageData(h,t,e),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(t){var e,i=this.shadowCtx,n=i.getImageData(t.x,t.y,1,1),s=n.data[3],o=this._max,a=this._min;return e=Math.abs(o-a)*(s/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}},t}(),n=function(){var e=!1;return"canvas2d"===t.defaultRenderer&&(e=i),e}(),s={merge:function(){for(var t={},e=arguments.length,i=0;e>i;i++){var n=arguments[i];for(var s in n)t[s]=n[s]}return t}},o=function(){function i(){var i=this._config=s.merge(t,arguments[0]||{});if(this._coordinator=new o,i.plugin){var r=i.plugin;if(!t.plugins[r])throw new Error("Plugin '"+r+"' not found. Maybe it was not registered.");var l=t.plugins[r];this._renderer=new l.renderer(i),this._store=new l.store(i)}else this._renderer=new n(i),this._store=new e(i);a(this)}var o=function(){function t(){this.cStore={}}return t.prototype={on:function(t,e,i){var n=this.cStore;n[t]||(n[t]=[]),n[t].push(function(t){return e.call(i,t)})},emit:function(t,e){var i=this.cStore;if(i[t])for(var n=i[t].length,s=0;n>s;s++){var o=i[t][s];o(e)}}},t}(),a=function(t){var e=t._renderer,i=t._coordinator,n=t._store;i.on("renderpartial",e.renderPartial,e),i.on("renderall",e.renderAll,e),i.on("extremachange",function(e){t._config.onExtremaChange&&t._config.onExtremaChange({min:e.min,max:e.max,gradient:t._config.gradient||t._config.defaultGradient})}),n.setCoordinator(i)};return i.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(t){return this._config=s.merge(this._config,t),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(t){return this._store.getValueAt?this._store.getValueAt(t):this._renderer.getValueAt?this._renderer.getValueAt(t):null}},i}(),a={create:function(t){return new o(t)},register:function(e,i){t.plugins[e]=i}};return a}),define("maps/HeatMapLayer",["_libs/leaflet/leaflet-src","_libs/heatmap/heatmap.min"],function(t,e){"undefined"==typeof t.Layer&&(t.Layer=t.Class);var i=t.Layer.extend({initialize:function(e){this.cfg=e,this._el=t.DomUtil.create("div","leaflet-zoom-hide"),this._data=[],this._max=1,this._min=0,this.cfg.container=this._el},onAdd:function(i){var n=i.getSize();this._map=i,this._width=n.x,this._height=n.y,this._el.style.width=n.x+"px",this._el.style.height=n.y+"px",this._el.style.position="absolute",this._origin=this._map.layerPointToLatLng(new t.Point(0,0)),i.getPanes().overlayPane.appendChild(this._el),this._heatmap||(this._heatmap=e.create(this.cfg)),i.on("moveend",this._reset,this),this._draw()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._el),t.off("moveend",this._reset,this)},_draw:function(){if(this._map){var t=this._map.getPanes().mapPane,e=t._leaflet_pos;this._el.style[i.CSS_TRANSFORM]="translate("+-Math.round(e.x)+"px,"+-Math.round(e.y)+"px)",this._update()}},_update:function(){var t,e,i,n={max:this._max,min:this._min,data:[]};if(t=this._map.getBounds(),e=this._map.getZoom(),i=Math.pow(2,e),0==this._data.length)return this._heatmap&&this._heatmap.setData(n),void 0;for(var s=[],o=this.cfg.scaleRadius?i:1,a=0,r=0,l=this.cfg.valueField,c=this._data.length;c--;){var h=this._data[c],d=h[l],u=h.latlng;if(t.contains(u)){a=Math.max(d,a),r=Math.min(d,r);var p=this._map.latLngToContainerPoint(u),m={x:Math.round(p.x),y:Math.round(p.y)};m[l]=d;var f;f=h.radius?h.radius*o:(this.cfg.radius||2)*o,m.radius=f,s.push(m)}}this.cfg.useLocalExtrema&&(n.max=a,n.min=r),n.data=s,this._heatmap.setData(n)},setData:function(e){this._max=e.max||this._max,this._min=e.min||this._min;for(var i=this.cfg.latField||"lat",n=this.cfg.lngField||"lng",s=this.cfg.valueField||"value",e=e.data,o=e.length,a=[];o--;){var r=e[o],l=new t.LatLng(r[i],r[n]),c={latlng:l};c[s]=r[s],r.radius&&(c.radius=r.radius),a.push(c)}this._data=a,this._draw()},addData:function(e){if(e.length>0)for(var i=e.length;i--;)this.addData(e[i]);else{var n=this.cfg.latField||"lat",s=this.cfg.lngField||"lng",o=this.cfg.valueField||"value",a=e,r=new t.LatLng(a[n],a[s]),l={latlng:r};l[o]=a[o],this._max=Math.max(this._max,l[o]),this._min=Math.min(this._min,l[o]),a.radius&&(l.radius=a.radius),this._data.push(l),this._draw()}},_reset:function(){this._origin=this._map.layerPointToLatLng(new t.Point(0,0));var e=this._map.getSize();(this._width!==e.x||this._height!==e.y)&&(this._width=e.x,this._height=e.y,this._el.style.width=this._width+"px",this._el.style.height=this._height+"px",this._heatmap._renderer.setDimensions(this._width,this._height)),this._draw()}});return i.CSS_TRANSFORM=function(){for(var t=document.createElement("div"),e=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],i=0;i<e.length;i++){var n=e[i];if(void 0!==t.style[n])return n}return e[0]}(),i}),define("maps/MapsModule",["underscore","jquery","abstracts/Module","util","geo","maps/GeoMap","maps/routing/RoutingModule","maps/views/MapsViewLeaflet","i18n!_common/nls/common","./SimpleHeatLayer","./HeatMapLayer"],function(t,e,i,n,s,o,a,r,l,c,h){function d(){_=[]}var u="GoogleMap",p=12,m=[59.9,30.46],f={},g=i.extend({constructor:function(){this._map=null,this._widget=null,this._suggestCache={},i.apply(this,arguments)},defaults:{usedMap:null,center:null,container:null,parent:null,searchTypes:null},initialize:function(){if(this.get("container")){this.has("searchTypes")&&this.set("defSearchType",t.findWhere(this.get("searchTypes"),{key:this.getUserData("defSearchType")||"address"})),this.on("zoomstart",function(){d()}),this.has("usedMap")||this.set("usedMap",this.getUserData("usedMap")||u),this.has("center")||this.set("center",this.getUserData("center")||m),this._view=new r({el:this.get("container"),model:this}),this._view.render(),v.initMapEngine.call(this,{map:this.get("usedMap"),zoom:this.getUserData("zoom")||p,center:this.get("center"),showTraffic:this.getUserData("showTraffic")||!1}),v.initSearch.call(this),App.subscribe(this.get("parent").getEventsPrefix()+".zoom",t.bind(this.setBounds,this));var e;if(e=this.get("routing")){var i={id:this.id+"/routing",parent:this,pointsEdit:!0};t.isObject(e)&&t.extend(i,e),this.modules.routing=new a(i)}}},buildHeatMap:function(t){var e=function(t){return[t.lat,t.lon]};return this._addHeat1(t.map(e))},_addHeat1:function(t){var e=t,i=this._widget.getMap(),n=new c(e,{minOpacity:.2,gradient:{.3:"blue",.45:"cyan",.6:"lime",.75:"yellow",.95:"red"},blur:12});return n.addTo(i),function(){i.removeLayer(n)}},_addHeat2:function(t){var e={max:1,data:t?t:[{lat:46.0122,lon:39.6716,value:1},{lat:46.0122,lon:39.6716,value:1},{lat:46.0122,lon:39.6716,value:1},{lat:46.0122,lon:39.6716,value:1}]},i=this._widget.getMap(),n={maxOpacity:.8,useLocalExtrema:!0,latField:"lat",lngField:"lon"},s=new h(n);return s.setData(e),s.addTo(i),function(){i.removeLayer(s)}},setBounds:function(){this._widget&&this._widget.setBounds.apply(this._widget,arguments)},getZoom:function(){return this._widget.getZoom()},zoomTo:function(e,i){(t.isArray(e)||!(t.isUndefined(e.lat)||t.isUndefined(e.lon)||t.isNull(e.lat)||t.isNull(e.lon)))&&this._widget&&this._widget.zoom({to:i&&i.maxZoom||"max",center:t.isArray(e)?e:[e.lat,e.lon]})},buildPolyline:function(e,i){i=i||{};var n={clickable:!1,weight:4,opacity:1};return i.weightArray?this._view.getWidget().buildPolyline(e,t.extend(n,i||{})):void 0},getMetersInPx:function(t){t>89&&(t=89),-89>t&&(t=-89);var e=Math.round(Math.abs(t));return _[e]?_[e]:v.calcMetersInPx.call(this,e)},getBoundsZoom:function(t){return this._widget.getBoundsZoom(t)},pointToLatLon:function(e){return t.isArray(e)?this._widget.unproject(e):this._widget.unproject([e.x,e.y])},destroy:function(){this._view.destroy()},openRouting:function(t){if(this.modules.routing){var e=this.getMap(),i=this.modules.routing;return e.routing()?(e.routingReady()?i.set("active",!0).buildRoute(t):(showCursor(),e.loadRouting().always(hideCursor).fail(function(t){alert(t||l.errNoRoutingOnMap,l.error)}).done(function(){i.set("active",!0).buildRoute(t)})),void 0):alert(l.errNoRoutingOnMap,l.error)}},buildRoute:function(t,i){var n=new e.Deferred;if(!this.modules.routing)return n.reject("No routing module");var s=this,o=this.getMap(),a=this.modules.routing;return o.routing()?(o.loadRouting().done(function(){var e=a.set("active",!0).buildRoute(t,i||{});s.listenToOnce(e,"sync",function(){n.resolve(e)}).listenToOnce(e,"error",function(t){n.reject(t)})}).fail(function(t){n.reject(t)}),n):n.reject(l.errNoRoutingOnMap)},isAutozoomWidgetOn:function(){return this.get("autozoom")}}),v={initMapEngine:function(e){var i=this,e=e||{};if(e.map&&e.map instanceof o)this._map=e.map;else{var n=e.map||u,s=f[n]||null;if(!s)return requirejs(["maps/"+n],function(s){f[n]=s,v.initMapEngine.call(i,t.extend(e,{map:new s}))}),void 0;this._map=e.map=new s}this._map.setZoom(e.zoom||this._map.getMaxZoom()-3),e.center?this._map.setCenter(e.center):this._map.setCenter(m);var i=this;this._view.activate(e||{}).done(function(){i.publish("ready"),i.trigger("ready")}),i._widget=i._view.getWidget()},initSearch:function(){var i=this;App.subscribe(this.getEventsPrefix()+".needsearch",function(e,n,s){n.trigger("searchstart");var o=i._map,a=i.get("parent"),r={putMarker:!0};return"address"!=e.type?(o=null,a.getSearchProcessor&&(o=a.getSearchProcessor(e.type))):a.getFoundAddressActions&&(r.extraActions=a.getFoundAddressActions()),o&&o.search?(e.limit=e.limit||1,o.getSearchOptions&&t.extend(r,o.getSearchOptions(e.type)),e.options&&(r.options=e.options),e.mapSearch=!0,o.search(e,s||null).done(function(t){n.trigger("searchsuccess",t,r)}).fail(function(){n.trigger("searcherror")}).always(function(){n.trigger("searchcomplete")}),void 0):(n.trigger("searcherror",{msg:'No search processor found for chosen type + "'+e.type+'"'}),void 0)}),App.subscribe(this.getEventsPrefix()+".needsuggest",function(t,e,n){n.trigger("suggeststart");var s=i._map;return"address"!=t.type&&(s=null,i.get("parent").getSearchProcessor&&(s=i.get("parent").getSearchProcessor(t.type))),s&&s.suggest?(i._suggestCache[t.type]=i._suggestCache[t.type]||{},t.q in i._suggestCache[t.type]?(e(i._suggestCache[t.type][t.q]),n.trigger("suggestsuccess"),void 0):(t.mapSearch=!0,s.suggest(t).always(function(){n.trigger("suggestcomplete")}).done(function(s){n.trigger("suggestsuccess",s,e),i._suggestCache[t.type][t.q]=s}).fail(function(){n.trigger("suggesterror")}),void 0)):(n.trigger("suggesterror",{msg:'No search processor found for chosen type + "'+t.type+'"'}),void 0)}),this.on("needgeoinfo",function(n,s){var o={};return t.isUndefined(n.lat)?n.length&&n.length>=2&&(o.lat=n[0],o.lon=n[1]):(o.lat=n.lat,o.lon=t.isUndefined(n.lon)?n.lng:n.lon),t.isUndefined(n.options)||(o.options=n.options),!t.isUndefined(n.geoId)&&n.geoId>0&&(o.geoId=n.geoId),o.lat&&o.lon?(s.trigger("searchstart"),o.success=function(t){t.address&&o.geoId&&!t.scode&&e.ajax({url:App.getBaseUrl()+"address/save/",data:{geoId:o.geoId,scode:i._map.scode,address:t.address}}),t.address=null==t.address?l.addressNotFound+" ["+Math._round(o.lat,6)+","+Math._round(o.lon,6)+"]":t.address,s.trigger("searchsuccess",t,o)},o.error=function(t){s.trigger("searcherror",t,o)},o.complete=function(){s.trigger("searchcomplete",o)},i._map.geocode(o),void 0):(n.address=l.addressNotFound+("undefined"!=typeof o.lat&&"undefined"!=typeof o.lon?" ["+o.lat+","+o.lon+"]":""),s.trigger("searchsuccess",n,o),void 0)})},calcMetersInPx:function(t){var e=this._widget.getZoom();return this._map.setZoom(e),_[t]=this._map.getKDistByLat(t),_[t]}};t.extend(g.prototype,{addLayer:function(t){return this._widget.addLayer(t)},removeLayer:function(t){return this._widget.removeLayer(t)},addLayersGroup:function(t){return this._widget.addLayersGroup(t)},buildMarker:function(t){return this._widget.buildMarker(t)},putMarker:function(t){return this._widget.putMarker(t)},fitPolygon:function(t){return this._widget.fitPolygon(t)},fitBounds:function(){return this._widget.fitBounds.apply(this._widget,arguments)},getBounds:function(){return this._widget.getBounds.apply(this._widget,arguments)},addHtmlLayer:function(t){return this._widget?this._widget.addHtmlLayer(t):void 0},addPopupLayer:function(){return this._widget?(this._widget.addPopupLayer&&this._widget.addPopupLayer.apply(this._widget,arguments),this.addHtmlLayer.apply(this,arguments)):void 0},setMap:function(){if(arguments[0]instanceof o){if(this._map.getClass()==arguments[0].getClass())return this._map;this._map=arguments[0](this._map)}else{if("string"!=typeof arguments[0])throw"Invalid arguments to set new map";var t=f[arguments[0]]||null;if(!t){var e=arguments[0],i=this;return requirejs(["maps/"+e],function(t){f[e]=t,i.setMap(e)},function(){i.setMap(u)}),void 0}if(this._map.getClass()==t.__CLASS__)return this._map;this._map=new t(this._map),this.set("usedMap",this._map.getClass()),this.setUserData("usedMap",this._map.getClass()),this.trigger("mapchanged",this._map)}this._suggestCache={}},getMap:function(){return this._map},getWidget:function(){return this._widget}});var _=[];return g}),define("_common/RitmVideo",["jquery","underscore"],function(t){var e=t("#ritmVideo"),i=function(){e.removeClass("hidden");var i=t("#jface");i.addClass("ritmVideo")},n=function(){return i(),function(){el.addClass("hidden")}};return n}),define("text!_common/tmpl/app.html",[],function(){return'<div class="pane-left<% if(leftClosed) {%> closed<% } %><% if(leftWidth < 450) {%> narrow<% } %>" style="width:<%= leftWidth %>px">\n    <div class="tabs-hor-cont">\n        <ul class="tabs-hor">\n            <!--<li data-placeholder="1"></li>-->\n\n            <li id="objects-tree" class="items-tree">\n                <div class="tab-toggle-container hint hint-right" data-hint="<%= i18n[objType == \'stat\' ? \'stationary\' : \'vehicles\'] %>">\n                    <a class="tab-toggle" href="#<%= objType %>">\n                        <svg class="svg-icon">\n                            <use xlink:href="#smb-<%= objType == \'stat\' ? \'home\' : \'car\' %>"></use>\n                        </svg>\n                        <span><%= i18n[objType == \'stat\' ? \'stationary\' : \'vehicles\'].ucFirst() %></span>\n                    </a>\n                    <% if(App.hasModule(\'mobile\') && App.hasModule(\'stat\')) {%>\n                    <div class="dropdown">\n                        <a data-toggle="dropdown"><i class="caret"></i></a>\n                        <ul class="dropdown-menu nav nav-list">\n                            <li>\n                                <a href="#mobile"><svg class="svg-icon">\n                                    <use xlink:href="#smb-car"></use>\n                                </svg> <%= i18n.vehicles %></a>\n                            </li>\n                            <li>\n                                <a href="#stat"><svg class="svg-icon">\n                                    <use xlink:href="#smb-home"></use>\n                                </svg> <%= i18n.stationary %></a>\n                            </li>\n                        </ul>\n                    </div>\n                    <% } %>\n                </div>\n                <div data-placeholder="1"></div>\n                <div data-placeholder="6"></div>\n            </li>\n\n            <li data-placeholder="7"></li><!-- guards -->\n            <li data-placeholder="2"></li>\n            <li data-placeholder="3"></li>\n            <li data-placeholder="4"></li>\n            <li data-placeholder="5"></li>\n        </ul>\n    </div>\n    <a href="javascript:;" class="toggle-pane">\n        <i class="svg-icon svg-icon-chevron-left"></i>\n        <i class="svg-icon svg-icon-chevron-right"></i>\n    </a>\n</div><!--/.pane-left-->\n\n<div class="pane-right" style="left:<%= leftClosed ? 0 : leftWidth %>px">\n    <div class="pane-right-bottom<% if(rightBottomClosed) {%> closed<% } %><% if(rightBottomHidden) {%> hidden<% } %>"\n         style="height:<%= rightBottomHeight %>px">\n        <a href="javascript:;" class="toggle-pane">\n            <i class="svg-icon svg-icon-chevron-up"></i>\n            <i class="svg-icon svg-icon-chevron-down"></i>\n        </a>\n    </div>\n    <div class="pane-right-top" style="bottom:<%= rightBottomHidden || rightBottomClosed ? 0 : rightBottomHeight %>px"></div>\n</div><!--/.pane-right-->\n\n<% if(dashboard) {%>\n<div id="dashboard" class="<% if(!showDashboard) {%>invisible<% } %>">\n<% } %>'}),define("text!_common/tmpl/audioPlaybackChrome.html",[],function(){return'<div \n    class="jf-window modal ui-draggable jw-visible jw-active check-sound-modal" \n    id="audio-playback-chrome"\n    style="z-index: 999; position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%)"\n>    \n    <div class="jw-extra-l">\n        <div class="jw-hdr modal-header">\n            <h3><%= i18n.audioPlTitle %></h3>\n            <div class="jw-controls"><a href="#" class="jw-close svg-icon svg-icon-circle-remove  check-sound-modal-close"></a></div>\n        </div>\n        <div class="jw-content modal-body">\n            <p>\n                <%= i18n.audioPlTitle2 %>\n                <a href="https://developers.google.com/web/updates/2017/09/autoplay-policy-changes" class="">\n                    <%= i18n.readMore %>\n                </a>\n            </p>\n            <ol>\n                <li><%= i18n.audioPlChrome1 %></li>\n                <li><%= i18n.audioPlChrome2 %></li>\n                <li><%= i18n.audioPlChrome3 %></li>\n                <li><%= i18n.audioPlChrome4 %></li>\n            </ol>\n        </div>\n        <div class="jw-footer modal-footer">\n            <div class="demo-close">\n                <button class="btn jw-close check-sound-modal-close"><%= i18n.close %></button>\n            </div>\n        </div>\n    </div>\n</div>'}),define("text!_common/tmpl/audioPlaybackFirefox.html",[],function(){return'<div class="jf-window modal ui-draggable jw-visible jw-active check-sound-modal" \n    id="audio-playback-firefox" \n    style="z-index: 999; position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%)"\n>\n    <div class="jw-extra-l">\n        <div class="jw-hdr modal-header">\n            <h3><%= i18n.audioPlTitle %></h3>\n            <div class="jw-controls"><a href="#" class="jw-close svg-icon svg-icon-circle-remove  check-sound-modal-close"></a></div>\n        </div>\n        <div class="jw-content modal-body">\n            <ol>\n                <li><%= i18n.audioPlFirefox1 %></li>\n                <li><%= i18n.audioPlFirefox2 %></li>\n            </ol>\n        </div>\n        <div class="jw-footer modal-footer">\n            <div class="demo-close">\n                <button class="btn jw-close check-sound-modal-close"><%= i18n.close %></button>\n            </div>\n        </div>\n    </div>\n</div>'}),define("text!_common/tmpl/printHeader.html",[],function(){return'<div id="print-hdr" class="clearfix">\n    <button class="btn btn-cancel" onclick="$(body).removeClass(\'print-preview\');App.trigger(\'layoutchange\')"><i class="icon-arrow-left"></i> <%= i18n.cancel.ucFirst() %></button>\n    <h1 class="brand"></h1>\n    <div class="actions">\n        <button class="btn btn-print" onclick="window.print()"><i class="icon-print"></i> <%= i18n.print %></button>\n    </div>\n</div>'}),define("_common/views/AppView",["jquery","jqueryui","underscore","jface","abstracts/View","text!_common/tmpl/app.html","text!_common/tmpl/audioPlaybackChrome.html","text!_common/tmpl/audioPlaybackFirefox.html","text!_common/tmpl/printHeader.html","i18n!_common/nls/common"],function(t,e,i,n,s,o,a,r,l,c){function h(){t.datepicker.setDefaults({showOtherMonths:!0,selectOtherMonths:!0,changeMonth:!0,changeYear:!0,altFormat:c.DateTime.inputDateFormat,closeText:c.close.ucFirst(),currentText:c.DateTime.today,nextText:c.nextShort.ucFirst(),prevText:c.prevShort.ucFirst(),dayNames:c.DateTime.dayNames,dayNamesMin:c.DateTime.dayNamesMin,dayNamesShort:c.DateTime.dayNamesMin,firstDay:c.DateTime.firstDay,monthNames:c.DateTime.monthNames,monthNamesShort:c.DateTime.monthNamesShort})}var d=null,u=null,p=!1,m=400,f=200,g=null,v=null,_=null,b=null,y=200,w=300,x=150,C=!1,S=!0,T=0,A="app",L=450,M=450,k=500,D=s.extend({el:t("#page"),constructor:function(){this.isLeftWide=!1,s.apply(this,arguments)},initialize:function(){var e=this;"documentElement"in document&&(document.documentElement.lang=App.getLocale().substr(0,2).toLowerCase()),n.init(),n.addWindows(),n.addDialogs(),n.addGrowls(),setTimeout(function(){e.checkSound()},0),n.dialog.defaults.header=c.defaultDialogHeader,n.dialog.defaults.btnNames={ok:"Ok",cancel:c.cancel.ucFirst(),submit:c.submit.ucFirst()},t.support.touch&&t("body").addClass("mobile-device"),this.on("needleftwide",function(t){if(t){if(e.isLeftWide)return;p&&e.leftPaneEnable();var i=e.model.getUserData("leftWidthX")||600;e.isLeftWide=!0,i&&e.setLeftPaneWidth(i)}else{if(!e.isLeftWide)return;var i=e.model.getUserData("leftWidth");e.isLeftWide=!1,i&&m!=i&&e.setLeftPaneWidth(i)}}),this.listenTo(this.model,"change:objType",function(t,i){var n=e.$el.find("#objects-tree .tab-toggle");if(n.length){var s="stat"==i?c.stationary:c.vehicles,o='<svg class="svg-icon"><use xlink:href="#smb-'+("stat"==i?"home":"car")+'"></use>'+"</svg>";o+=" <span>"+s+"</span>",n.html(o),n[0].href="#"+i,n.parent().attr("data-hint",s)}}),this.listenTo(App,"change:globalAlerts",I.renderGlobalAlerts),App.subscribe("printmainmap",function(){var n=t("body").addClass("print-preview");!n.find("#print-hdr").length&&n.find("#outer").prepend(i.template(l,{i18n:e.model.getTexts()})),App.trigger("layoutchange")}),t("body").on("keypress.mainsearch",function(e){if(32==e.keyCode){var i=/INPUT|SELECT|TEXTAREA/i,n=!0;if(i.test(e.target.tagName)&&(n=!1),t("#jface-overlay, #dashboard, #settings").each(function(){"none"==this.style.display||/hidden|invisible/i.test(this.className)||(n=!1)}),g){var s=g.find(">.pane-right-top>.maps-module");if(s.hasClass("blocked")&&(n=!1),n)return s.find(">.module-header input[name=q]").focus(),!1}}}),t.datepicker&&h()},render:function(){if(t("#main-hdr").on("click.locale","[data-locale]",function(){var e=t(this).data("locale");App.publish("localechange",e)}),!App.isAlarmOperator()){m=this.model.getUserData("leftWidth")||m,p=this.model.getUserData("leftClosed"),y=this.model.getUserData("rightBottomHeight")||y,C=this.model.getUserData("rightBottomClosed")===!0,S=!this.model.get("showAlertsLog");var e=this.model.get("objType");this.$el.append(i.template(o,{objType:e,leftWidth:m,leftClosed:p,rightBottomHeight:y,rightBottomClosed:C,rightBottomHidden:S,dashboard:!0,showDashboard:this.model.get("startWithDashboard"),i18n:c})),d=this.$el.find(">.pane-left"),u=d.find(".toggle-pane"),g=this.$el.find(">.pane-right"),v=g.find(">.pane-right-top"),_=g.find(">.pane-right-bottom"),b=_.find(".toggle-pane"),T=this.$el.width();var n=App.getServerSettings();if(n.companyInfo){var s=n.companyInfo,a="";if("string"==typeof s)a=s;else if("object"==typeof s){var r=App.getLocale().substr(0,2);"undefined"!=typeof s[r]?a=s[r]:"undefined"!=typeof s.en&&(a=s.en)}a&&v.append('<div id="company-info">'+a+"</div>")}var l=this,h=t("#main-hdr .brand"),f=this.model.getUserData("dashShown"),w=c.showDashboard,x=this.model.get("startWithDashboard");if(!App.isVisitor()){if(!f&&!x){h.addClass("hint-hl"),w=c.showDashboardInfo;var L,M=setTimeout(function(){h.addClass("hint-always"),L=setTimeout(function(){h.removeClass("hint-always")},2e4)},1e4)}h.on("click",function(){if(l.model.modules.dashboard){var t=l.model.modules.dashboard,e=!t.get("active");t.set("active",e),e&&l.model.modules.system.hideSettings(),M&&clearTimeout(M),L&&clearTimeout(L),-1!=h[0].className.indexOf("hint-always")&&(h[0].className=h[0].className.replace(" hint-always","")),-1!=h[0].className.indexOf("hint-hl")&&(h[0].className=h[0].className.replace(" hint-hl",""),l.model.setUserData("dashShown",!0))}}).addClass("hint hint-right").attr("data-hint",x?c.map.ucFirst():w),t(window).on("resizestop."+A,function(t){var e=t.srcElement||t.currentTarget;(e=window)&&I.onWindowResizeStop.call(l,t)}),I.initPanes.call(this)}I.renderGlobalAlerts.call(this,App,App.get("globalAlerts"))}},leftPaneEnable:function(){d.removeClass("closed").resizable("enable")},leftPaneDisable:function(){d.addClass("closed").resizable("disable")},getPageWidth:function(){return T},getLeftPaneWidth:function(){return parseInt(d[0].style.width)},setLeftPaneWidth:function(t){return f>t||t>.7*T?!1:(g[0].style.left=d[0].style.width=t+"px",g.trigger("resizestop"),m=t,I.toggleNarrowClass(d,t,L),I.toggleNarrowClass(g,g.width(),M),this.model.setUserData("leftWidth"+(this.isLeftWide?"X":""),m),App.trigger("layoutchange",{leftWidth:m}),void 0)
},getMapsContainer:function(){return v},getLeftPane:function(){return d},getTypeBrowser:function(){var t,e=navigator.userAgent,i=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(i[1]))return t=/\brv[ :]+(\d+)/g.exec(e)||[],"IE "+(t[1]||"");if("Chrome"===i[1]){if(t=e.match(/\b(OPR|Edge)\/(\d+)/),null!==t)return t.slice(1).join(" ").replace("OPR","Opera");if(t=e.match(/\b(Edg)\/(\d+)/),null!==t)return t.slice(1).join(" ").replace("Edg","Edge (Chromium)")}return i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],t=e.match(/version\/(\d+)/i),null!==t&&i.splice(1,1,t[1]),i},showAudioPLayback:function(){var t,e,n,s,o=this.getTypeBrowser(),l=navigator.userAgent.toLowerCase(),h=/firefox/.test(l),d=/yabrowser/.test(l),u=/safari/i.test(o[0]),p=new Audio("_common/alerts/audio/alarm.mp3");d||u||(t=i.template(h?r:a,{i18n:c}),e=document.querySelector("#jface-windows"),e.insertAdjacentHTML("afterbegin",t),n=document.querySelectorAll(".check-sound-modal-close"),s=document.querySelector(".check-sound-modal"),h||s.addEventListener("click",function(t){n[0]!==t.target&&n[1]!==t.target&&p.play()}),n.forEach(function(t){t.addEventListener("click",function(){return s.parentNode.removeChild(s)})}))},checkSound:function(){var t=this,e=new Audio("_common/alerts/audio/silence.mp3"),i=e.play();i&&i.then(function(){e.pause()}).catch(function(){t.showAudioPLayback()})}}),I={initPanes:function(){I.initLeftPane.call(this),I.initRightPane.call(this)},initLeftPane:function(){var t=this;d.resizable({handles:"e",minWidth:f,maxWidth:.7*T,stop:function(e,i){d[0].style.height="100%",g[0].style.left=d[0].style.width,g.trigger("resizestop"),m=i.size.width,t.model.setUserData("leftWidth"+(t.isLeftWide?"X":""),m),App.trigger("layoutchange",{leftWidth:m})},resize:function(t,e){I.onLeftResize(e.size)}}),p&&d.resizable("disable"),u.on("click",function(){return p?t.leftPaneEnable():t.leftPaneDisable(),I.onLeftResize({width:d.width()}),p=!p,t.model.setUserData("leftClosed",p),g.trigger("resizestop"),App.trigger("layoutchange"),!1})},initRightPane:function(){var t=this,e=g.height(),i=e-w;this.listenTo(App,"change:showAlertsLog",function(e,i){_[i?"removeClass":"addClass"]("hidden"),I.toggleRightBottom.call(t,i,!1)}),_.resizable({handles:"n",minHeight:x,maxHeight:i,resize:function(e,i){I.onRightBottomResize.call(t,i.size,!0)},stop:function(e,i){t.model.setUserData("rightBottomHeight",i.size.height),App.trigger("layoutchange",{})}}),(C||S)&&_.resizable("disable"),S||I.setMaxRightBottomHeight.call(this,g.height()-w,!1),I.toggleRightTopSmallClass.call(this),b.on("click",function(){return I.toggleRightBottom.call(t,C),!1})},onLeftResize:function(t){App.trigger("leftpaneresize",t),g[0].style.left=t.width+"px",I.toggleNarrowClass(d,t.width,L),I.toggleNarrowClass(g,g.width(),M)},toggleNarrowClass:function(t,e,i){i>e?-1==t[0].className.indexOf("narrow")&&t.addClass("narrow"):-1!=t[0].className.indexOf("narrow")&&t.removeClass("narrow")},toggleRightBottom:function(t,e){C=!t,e=e===!0,_[C?"addClass":"removeClass"]("closed").resizable(C?"disable":"enable"),C||I.setMaxRightBottomHeight.call(this,g.height()-w,!0),this.model.setUserData("rightBottomClosed",C),e||(I.onRightBottomResize.call(this,{height:C?0:y},!1),App.trigger("layoutchange"),_.trigger("toggle",C))},onRightBottomResize:function(t,e){e&&(y=t.height),v[0].style.bottom=t.height+"px",I.toggleRightTopSmallClass.call(this)},setMaxRightBottomHeight:function(t,e){if(x>t)I.toggleRightBottom.call(this,!1,e),t=x;else if(C);else{var i=_.height();i>t&&(_[0].style.height=t+"px",I.onRightBottomResize({height:t},!0))}_.resizable("option","maxHeight",t)},onWindowResizeStop:function(){T=this.$el.width();var t=.7*T,e=d.width(),i=d.height();e>t?(d[0].style.width=t+"px",I.onLeftResize({width:e,height:i})):App.trigger("leftpaneresize",{width:e,height:i}),d.resizable("option","maxWidth",.7*T),I.setMaxRightBottomHeight.call(this,i-w,!1),I.toggleRightTopSmallClass.call(this)},toggleRightTopSmallClass:function(){var t=v.height();k>t?-1==v[0].className.indexOf("small")&&v.addClass("small"):-1!=v[0].className.indexOf("small")&&v.removeClass("small")},renderGlobalAlerts:function(e,n){t("#global-alerts").html(i.map(n,function(t){return'<div class="global-alert" data-id="'+t.id+'">'+t.html+'<i class="dismiss"><svg class="svg-icon"><use xlink:href="#smb-remove"></use></svg></i></div>'}).join("")).find(".dismiss").on("click",function(){var e=t(this).closest(".global-alert").data("id");App.removeGlobalAlert(e)})}};return D}),define("text!_common/tmpl/modelTag.html",[],function(){return'<div data-model="<%= id %>" class="btn btn-small tag" title="<%- name %> #<%= id %>">\n    <span class="name"><%- name %></span>\n    <i data-model="<%= id %>" class="svg-icon svg-icon-remove del-link"></i>\n</div>\n'}),define("text!_common/tmpl/processor.html",[],function(){return'<form action="" method="post" class="no-margin">\n    <div class="box-header"<% if(!objectsDefined) {%> style="padding-right:120px"<% } %>>\n        <h2><%= header %></h2>\n        <% if(!objectsDefined) {%>\n        <div class="switch-toggle switch-objtype" onclick="">\n            <input id="radio-mobile-objects" name="objType" type="radio" value="mobile"<% if(objType == \'mobile\') {%> checked<% } %>>\n            <label for="radio-mobile-objects" onclick="">\n                <svg class="svg-icon">\n                    <use xlink:href="#smb-car"></use>\n                </svg>\n                <!--<i class="icon-active svg-icon svg-icon-car-w"></i>-->\n            </label>\n\n            <input id="radio-stat-objects" name="objType" type="radio" value="stat"<% if(objType == \'stat\') {%> checked<% } %>>\n            <label for="radio-stat-objects" onclick="">\n                <svg class="svg-icon">\n                    <use xlink:href="#smb-home"></use>\n                </svg>\n                <!--<i class="icon svg-icon svg-icon-home"></i>-->\n                <!--<i class="icon-active svg-icon svg-icon-home-w"></i>-->\n            </label>\n            <a class="btn btn-primary"></a>\n        </div>\n        <% } %>\n        <a class="close btn-cancel">&times;</a>\n    </div>\n    <div class="box-content clearfix">\n        <div class="left">\n            <% if(report) {%>\n            <select class="no-margin" name="type"></select>\n            <% } %>\n\n            <% if(!item) { %>\n            <div class="selected-models"></div>\n            <% } %>\n\n            <% if(chooseTime || daterange) {%>\n            <div class="time-range">\n\n                <div class="row">\n                    <div class="date from hidden">\n                        <div class="clearfix">\n                            <h5 class="pull-left"><%= i18n.date.ucFirst() %> <%= i18n.fromDate %>:</h5>\n                        </div>\n                        <div class="datepicker date-from"></div>\n                        <input type="hidden" name="dateFrom" value="">\n                        <div class="control-group">\n                            <label class="inline"><strong><%=i18n.time.ucFirst() + \' \' + i18n.fromDate %>:</strong></label>\n                            <div class="input-append bootstrap-timepicker no-margin">\n                                <input type="text" name="timeFrom" value="00:00" class="input-time" >\n                                <span class="add-on">\n                                    <i class="icon-time"></i>\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="date to hidden">\n                        <div class="clearfix">\n                            <h5 class="pull-left"><%= i18n.date.ucFirst() %> <%= i18n.to %>:</h5>\n                        </div>\n                        <div class="datepicker date-to"></div>\n                        <input type="hidden" name="dateTo" value="" class="input-date input-small" >\n                        <div class="control-group">\n                            <label class="inline"><strong><%=i18n.time.ucFirst() + \' \' + i18n.to %>:</strong></label>\n                            <div class="input-append bootstrap-timepicker no-margin">\n                                <input type="text" name="timeTo" value="23:59" class="input-time" >\n                            <span class="add-on">\n                                <i class="icon-time"></i>\n                            </span>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="date single hidden">\n                        <div class="clearfix">\n                            <h5 class="pull-left"><%= i18n.date.ucFirst() %>:</h5>\n                        </div>\n                        <div class="datepicker date-single"></div>\n                        <input type="hidden" name="date" value="">\n                        <div class="control-group">\n                            <label class="inline"><strong><%=i18n.time.ucFirst() %>:</strong></label>\n                            <div class="input-append bootstrap-timepicker no-margin">\n                                <input type="text" name="time" value="00:00" class="input-time" >\n                                <span class="add-on">\n                                    <i class="icon-time"></i>\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n\n                </div><!--/row-->\n\n                <div class="btn-group autoselect">\n                    <a data-value="curDay" class="btn"><%= i18n.DateTime.today %></a>\n                    <a data-value="prevDay" class="btn"><%= i18n.DateTime.yesturday %></a>\n                    <% if(report) {%>\n                    <a data-value="curMonth" class="btn"><%= i18n.current.ucFirst() %> <%= i18n.month %></a>\n                    <a data-value="prevMonth" class="btn"><%= i18n.prev.ucFirst() %> <%= i18n.month %></a>\n                    <% } else if(track) {%>\n                    <a data-value="curWeek" class="btn"><%= i18n.curWeek %></a>\n                    <a data-value="prevWeek" class="btn"><%= i18n.prevWeek %></a>\n                    <% } %>\n                </div>\n\n            </div><!--/time-range-->\n\n            <div class="timezone">\n                <select name="tzId" class="no-margin">\n                    <% var sel = false; _.each(App.getTimezonesList(), function(tz){\n                    var selected = !sel\n                    && (\n                    ( \'undefined\' != typeof tzId && tzId == tz.id )\n                    || ( \'undefined\' != typeof tzMin && tzMin == tz.offset )\n                    || ( \'undefined\' != typeof tz && tz * 60 == tz.offset )\n                    )\n                    %>\n                    <option value="<%= tz.id %>"\n                    <% if(selected) { sel = true;%> selected<% } %>>\n                    <%= App.getFullTimezoneName(tz) %>\n                    </option>\n                    <% }) %>\n                </select>\n            </div>\n\n            <% } %>\n\n            <% if(daterange && report) {%>\n\n            <div class="time-range-filters<% if(!showTimeRangeFilters) {%> hidden<% } %>">\n                <div class="control-group">\n                    <div class="dropdown">\n                        <a class="btn btn-block dropdown-toggle text-left" data-toggle="dropdown">\n                            <span class="btn-text">&nbsp;</span>\n                            <span class="caret"></span>\n                        </a>\n                        <ul class="dropdown-menu nav nav-list">\n                            <% _.each(_.range(1,7), function(i) {%>\n                            <li>\n                                <label class="checkbox">\n                                    <input name="filterDays" type="checkbox" value="<%= i %>"<% if(!showTimeRangeFilters) {%> disabled<% } %>\n                                    <% if(!daysFilterData || daysFilterData.indexOf(i) != -1) {%> checked<% } %>>\n                                    <%= i18n.DateTime.dayNames[i] %>\n                                </label>\n                            </li>\n                            <% }) %>\n                            <li>\n                                <label class="checkbox">\n                                    <input name="filterDays" type="checkbox" value="7"<% if(!showTimeRangeFilters) {%> disabled<% } %>\n                                    <% if(!daysFilterData || daysFilterData.indexOf(7) != -1) {%> checked<% } %>>\n                                    <%= i18n.DateTime.dayNames[0] %>\n                                </label>\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n                <div class="control-group no-margin">\n                    <label class="checkbox">\n                        <input type="checkbox" name="rangesFilter"<% if(useTimeFilterData) {%> checked<% } %>>\n                        <%= i18n.dataOnlyInsideRange %>\n                    </label>\n                    <label class="control-label"><%= i18n.fromDate %>:</label>\n                    <div class="input-append bootstrap-timepicker no-margin">\n                        <input type="text" name="filterTimeFrom"  class="input-time"\n                               value="<%= timeFilterData ? timeFilterData[0] : \'00:00\' %>"\n                               <% if(!useTimeFilterData) {%> disabled<% } %>>\n                        <span class="add-on">\n                            <i class="icon-time"></i>\n                        </span>\n                    </div>\n                    <label class="control-label"><%= i18n.till %>:</label>\n                    <div class="input-append bootstrap-timepicker no-margin">\n                        <input type="text" name="filterTimeTo" class="input-time"\n                               value="<%= timeFilterData ? timeFilterData[1] : \'00:00\' %>"\n                               <% if(!useTimeFilterData) {%> disabled<% } %>>\n                        <span class="add-on">\n                            <i class="icon-time"></i>\n                        </span>\n                    </div>\n                </div>\n            </div>\n\n            <% } %>\n\n        </div><!--/left-->\n\n        <% if(report && reportTypes) {%>\n        <div class="report-params">\n            <!--<h4><%= i18n.reportParams %></h4>-->\n            <div class="content"></div>\n        </div>\n        <% } %>\n\n    </div><!--/box-content-->\n    <div class="box-footer clearfix">\n\n        <% if(daterange && report) {%>\n        <a class="toggle-time-range-filters pull-left" href="#">\n            <% if(!showTimeRangeFilters) {%>\n            <%= i18n.optionalTimeSettings %>\n            <% } else { %>\n            <%= i18n.hideOptionalTimeSettings %>\n            <% } %>\n        </a>\n        <% } %>\n\n        <% if(track) {%>\n            <a class="btn btn-primary" data-target="tracks" href="javascript:;"><%= i18n.build.ucFirst() %></a>\n        <% } else if(report) {%>\n            <a class="btn btn-primary" data-target="reports" href="javascript:;"><%= i18n.build.ucFirst() %></a>\n        <% } %>\n\n        <a class="btn btn-cancel" href="javascript:;"><%= i18n.cancel.ucFirst() %></a>\n    </div>\n</form>'}),define("timepicker",["jquery"],function(t){var e=function(e,i){this.widget="",this.$element=t(e),this.defaultTime=i.defaultTime,this.disableFocus=i.disableFocus,this.disableMousewheel=i.disableMousewheel,this.isOpen=i.isOpen,this.minuteStep=i.minuteStep,this.modalBackdrop=i.modalBackdrop,this.orientation=i.orientation,this.secondStep=i.secondStep,this.showInputs=i.showInputs,this.showMeridian=i.showMeridian,this.showSeconds=i.showSeconds,this.template=i.template,this.appendWidgetTo=i.appendWidgetTo,this.showWidgetOnAddonClick=i.showWidgetOnAddonClick,this._init()};e.prototype={constructor:e,_init:function(){var e=this;this.showWidgetOnAddonClick&&(this.$element.parent().hasClass("input-append")||this.$element.parent().hasClass("input-prepend"))?(this.$element.parent(".input-append, .input-prepend").find(".add-on").on({"click.timepicker":t.proxy(this.showWidget,this)}),this.$element.on({"focus.timepicker":t.proxy(this.highlightUnit,this),"click.timepicker":t.proxy(this.highlightUnit,this),"keydown.timepicker":t.proxy(this.elementKeydown,this),"blur.timepicker":t.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":t.proxy(this.mousewheel,this)})):this.template?this.$element.on({"focus.timepicker":t.proxy(this.showWidget,this),"click.timepicker":t.proxy(this.showWidget,this),"blur.timepicker":t.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":t.proxy(this.mousewheel,this)}):this.$element.on({"focus.timepicker":t.proxy(this.highlightUnit,this),"click.timepicker":t.proxy(this.highlightUnit,this),"keydown.timepicker":t.proxy(this.elementKeydown,this),"blur.timepicker":t.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":t.proxy(this.mousewheel,this)}),this.$widget=this.template!==!1?t(this.getTemplate()).on("click",t.proxy(this.widgetClick,this)):!1,this.showInputs&&this.$widget!==!1&&this.$widget.find("input").each(function(){t(this).on({"click.timepicker":function(){t(this).select()},"keydown.timepicker":t.proxy(e.widgetKeydown,e),"keyup.timepicker":t.proxy(e.widgetKeyup,e)})}),this.setDefaultTime(this.defaultTime)},blurElement:function(){this.highlightedUnit=null,this.updateFromElementVal()},clear:function(){this.hour="",this.minute="",this.second="",this.meridian="",this.$element.val("")},decrementHour:function(){if(this.showMeridian)if(1===this.hour)this.hour=12;else{if(12===this.hour)return this.hour--,this.toggleMeridian();if(0===this.hour)return this.hour=11,this.toggleMeridian();this.hour--}else this.hour<=0?this.hour=23:this.hour--},decrementMinute:function(t){var e;e=t?this.minute-t:this.minute-this.minuteStep,0>e?(this.decrementHour(),this.minute=e+60):this.minute=e},decrementSecond:function(){var t=this.second-this.secondStep;0>t?(this.decrementMinute(!0),this.second=t+60):this.second=t},elementKeydown:function(t){switch(t.keyCode){case 9:case 27:this.updateFromElementVal();break;case 37:t.preventDefault(),this.highlightPrevUnit();break;case 38:switch(t.preventDefault(),this.highlightedUnit){case"hour":this.incrementHour(),this.highlightHour();break;case"minute":this.incrementMinute(),this.highlightMinute();break;case"second":this.incrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian()}this.update();break;case 39:t.preventDefault(),this.highlightNextUnit();break;case 40:switch(t.preventDefault(),this.highlightedUnit){case"hour":this.decrementHour(),this.highlightHour();break;case"minute":this.decrementMinute(),this.highlightMinute();break;case"second":this.decrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian()}this.update()}},getCursorPosition:function(){var t=this.$element.get(0);if("selectionStart"in t)return t.selectionStart;if(document.selection){t.focus();var e=document.selection.createRange(),i=document.selection.createRange().text.length;return e.moveStart("character",-t.value.length),e.text.length-i}},getTemplate:function(){var t,e,i,n,s,o;switch(this.showInputs?(e='<input type="text" class="bootstrap-timepicker-hour" maxlength="2"/>',i='<input type="text" class="bootstrap-timepicker-minute" maxlength="2"/>',n='<input type="text" class="bootstrap-timepicker-second" maxlength="2"/>',s='<input type="text" class="bootstrap-timepicker-meridian" maxlength="2"/>'):(e='<span class="bootstrap-timepicker-hour"></span>',i='<span class="bootstrap-timepicker-minute"></span>',n='<span class="bootstrap-timepicker-second"></span>',s='<span class="bootstrap-timepicker-meridian"></span>'),o='<table><tr><td><a href="#" data-action="incrementHour"><i class="icon-chevron-up"></i></a></td><td class="separator">&nbsp;</td><td><a href="#" data-action="incrementMinute"><i class="icon-chevron-up"></i></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="incrementSecond"><i class="icon-chevron-up"></i></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td class="meridian-column"><a href="#" data-action="toggleMeridian"><i class="icon-chevron-up"></i></a></td>':"")+"</tr>"+"<tr>"+"<td>"+e+"</td> "+'<td class="separator">:</td>'+"<td>"+i+"</td> "+(this.showSeconds?'<td class="separator">:</td><td>'+n+"</td>":"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td>'+s+"</td>":"")+"</tr>"+"<tr>"+'<td><a href="#" data-action="decrementHour"><i class="icon-chevron-down"></i></a></td>'+'<td class="separator"></td>'+'<td><a href="#" data-action="decrementMinute"><i class="icon-chevron-down"></i></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="decrementSecond"><i class="icon-chevron-down"></i></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td><a href="#" data-action="toggleMeridian"><i class="icon-chevron-down"></i></a></td>':"")+"</tr>"+"</table>",this.template){case"modal":t='<div class="bootstrap-timepicker-widget modal hide fade in" data-backdrop="'+(this.modalBackdrop?"true":"false")+'">'+'<div class="modal-header">'+'<a href="#" class="close" data-dismiss="modal">×</a>'+"<h3>Pick a Time</h3>"+"</div>"+'<div class="modal-content">'+o+"</div>"+'<div class="modal-footer">'+'<a href="#" class="btn btn-primary" data-dismiss="modal">OK</a>'+"</div>"+"</div>";break;case"dropdown":t='<div class="bootstrap-timepicker-widget dropdown-menu">'+o+"</div>"}return t},getTime:function(){return""===this.hour?"":this.hour.padLeft(2,"0")+":"+(1===this.minute.toString().length?"0"+this.minute:this.minute)+(this.showSeconds?":"+(1===this.second.toString().length?"0"+this.second:this.second):"")+(this.showMeridian?" "+this.meridian:"")},hideWidget:function(){this.isOpen!==!1&&(this.$element.trigger("hide.timepicker",{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}),"modal"===this.template&&this.$widget.modal?this.$widget.modal("hide"):this.$widget.removeClass("open"),t(document).off("mousedown.timepicker, touchend.timepicker"),this.isOpen=!1,this.$widget.detach())},highlightUnit:function(){this.position=this.getCursorPosition(),this.position>=0&&this.position<=2?this.highlightHour():this.position>=3&&this.position<=5?this.highlightMinute():this.position>=6&&this.position<=8?this.showSeconds?this.highlightSecond():this.highlightMeridian():this.position>=9&&this.position<=11&&this.highlightMeridian()},highlightNextUnit:function(){switch(this.highlightedUnit){case"hour":this.highlightMinute();break;case"minute":this.showSeconds?this.highlightSecond():this.showMeridian?this.highlightMeridian():this.highlightHour();break;case"second":this.showMeridian?this.highlightMeridian():this.highlightHour();break;case"meridian":this.highlightHour()}},highlightPrevUnit:function(){switch(this.highlightedUnit){case"hour":this.showMeridian?this.highlightMeridian():this.showSeconds?this.highlightSecond():this.highlightMinute();break;case"minute":this.highlightHour();break;case"second":this.highlightMinute();break;case"meridian":this.showSeconds?this.highlightSecond():this.highlightMinute()}},highlightHour:function(){var t=this.$element.get(0);this.highlightedUnit="hour",t.setSelectionRange&&setTimeout(function(){t.setSelectionRange(0,2)},0)},highlightMinute:function(){var t=this.$element.get(0);this.highlightedUnit="minute",t.setSelectionRange&&setTimeout(function(){t.setSelectionRange(3,5)},0)},highlightSecond:function(){var t=this.$element.get(0);this.highlightedUnit="second",t.setSelectionRange&&setTimeout(function(){t.setSelectionRange(6,8)},0)},highlightMeridian:function(){var t=this.$element.get(0);this.highlightedUnit="meridian",t.setSelectionRange&&(this.showSeconds?setTimeout(function(){t.setSelectionRange(9,11)},0):setTimeout(function(){t.setSelectionRange(6,8)},0))},incrementHour:function(){if(this.showMeridian){if(11===this.hour)return this.hour++,this.toggleMeridian();12===this.hour&&(this.hour=0)}return 23===this.hour?(this.hour=0,void 0):(this.hour++,void 0)},incrementMinute:function(t){var e;e=t?this.minute+t:this.minute+this.minuteStep-this.minute%this.minuteStep,e>59?(this.incrementHour(),this.minute=e-60):this.minute=e},incrementSecond:function(){var t=this.second+this.secondStep-this.second%this.secondStep;t>59?(this.incrementMinute(!0),this.second=t-60):this.second=t},mousewheel:function(e){if(!this.disableMousewheel){e.preventDefault(),e.stopPropagation();var i=e.originalEvent.wheelDelta||-e.originalEvent.detail,n=null;switch("mousewheel"===e.type?n=-1*e.originalEvent.wheelDelta:"DOMMouseScroll"===e.type&&(n=40*e.originalEvent.detail),n&&(e.preventDefault(),t(this).scrollTop(n+t(this).scrollTop())),this.highlightedUnit){case"minute":i>0?this.incrementMinute():this.decrementMinute(),this.highlightMinute();break;case"second":i>0?this.incrementSecond():this.decrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian();break;default:i>0?this.incrementHour():this.decrementHour(),this.highlightHour()}return!1}},place:function(){if(!this.isInline){var e=this.$widget.outerWidth(),i=this.$widget.outerHeight(),n=10,s=t(window).width(),o=t(window).height(),a=t(window).scrollTop(),r=parseInt(this.$element.parents().filter(function(){}).first().css("z-index"),10)+10,l=this.component?this.component.parent().offset():this.$element.offset(),c=this.component?this.component.outerHeight(!0):this.$element.outerHeight(!1),h=this.component?this.component.outerWidth(!0):this.$element.outerWidth(!1),d=l.left,u=l.top;this.$widget.removeClass("timepicker-orient-top timepicker-orient-bottom timepicker-orient-right timepicker-orient-left"),"auto"!==this.orientation.x?(this.$widget.addClass("timepicker-orient-"+this.orientation.x),"right"===this.orientation.x&&(d-=e-h)):(this.$widget.addClass("timepicker-orient-left"),l.left<0?d-=l.left-n:l.left+e>s&&(d=s-e-n));var p,m,f=this.orientation.y;"auto"===f&&(p=-a+l.top-i,m=a+o-(l.top+c+i),f=Math.max(p,m)===m?"top":"bottom"),this.$widget.addClass("timepicker-orient-"+f),"top"===f?u+=c:u-=i+parseInt(this.$widget.css("padding-top"),10),this.$widget.css({top:u,left:d,zIndex:r})}},remove:function(){t("document").off(".timepicker"),this.$widget&&this.$widget.remove(),delete this.$element.data().timepicker},setDefaultTime:function(t){if(this.$element.val())this.updateFromElementVal();else if("current"===t){var e=new Date,i=e.getHours(),n=e.getMinutes(),s=e.getSeconds(),o="AM";0!==s&&(s=Math.ceil(e.getSeconds()/this.secondStep)*this.secondStep,60===s&&(n+=1,s=0)),0!==n&&(n=Math.ceil(e.getMinutes()/this.minuteStep)*this.minuteStep,60===n&&(i+=1,n=0)),this.showMeridian&&(0===i?i=12:i>=12?(i>12&&(i-=12),o="PM"):o="AM"),this.hour=i,this.minute=n,this.second=s,this.meridian=o,this.update()}else t===!1?(this.hour=0,this.minute=0,this.second=0,this.meridian="AM"):this.setTime(t)},setTime:function(t,e){if(!t)return this.clear(),void 0;var i,n,s,o,a;"object"==typeof t&&t.getMonth?(n=t.getHours(),s=t.getMinutes(),o=t.getSeconds(),this.showMeridian&&(a="AM",n>12&&(a="PM",n%=12),12===n&&(a="PM"))):(a=null!==t.match(/p/i)?"PM":"AM",t=t.replace(/[^0-9\:]/g,""),i=t.split(":"),n=i[0]?i[0].toString():i.toString(),s=i[1]?i[1].toString():"",o=i[2]?i[2].toString():"",n.length>4&&(o=n.substr(4,2)),n.length>2&&(s=n.substr(2,2),n=n.substr(0,2)),s.length>2&&(o=s.substr(2,2),s=s.substr(0,2)),o.length>2&&(o=o.substr(2,2)),n=parseInt(n,10),s=parseInt(s,10),o=parseInt(o,10),isNaN(n)&&(n=0),isNaN(s)&&(s=0),isNaN(o)&&(o=0),this.showMeridian?1>n?n=1:n>12&&(n=12):(n>=24?n=23:0>n&&(n=0),13>n&&"PM"===a&&(n+=12)),0>s?s=0:s>=60&&(s=59),this.showSeconds&&(isNaN(o)?o=0:0>o?o=0:o>=60&&(o=59))),this.hour=n,this.minute=s,this.second=o,this.meridian=a,this.update(e)},showWidget:function(){if(!this.isOpen&&!this.$element.is(":disabled")){this.$widget.appendTo(this.appendWidgetTo);var e=this;t(document).on("mousedown.timepicker, touchend.timepicker",function(t){e.$element.parent().find(t.target).length||e.$widget.is(t.target)||e.$widget.find(t.target).length||e.hideWidget()}),this.$element.trigger("show.timepicker",{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}),this.place(),this.disableFocus&&this.$element.blur(),""===this.hour&&(this.defaultTime?this.setDefaultTime(this.defaultTime):this.setTime("0:0:0")),"modal"===this.template&&this.$widget.modal?this.$widget.modal("show").on("hidden",t.proxy(this.hideWidget,this)):this.isOpen===!1&&this.$widget.addClass("open"),this.isOpen=!0}},toggleMeridian:function(){this.meridian="AM"===this.meridian?"PM":"AM"},update:function(t){this.updateElement();var t=t||{};t.ignoreWidget||this.updateWidget(),this.$element.trigger("changeTime.timepicker",{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian,options:t})},updateElement:function(){this.$element.val(this.getTime()).change()},updateFromElementVal:function(){this.setTime(this.$element.val())},updateWidget:function(){if(this.$widget!==!1){var t=this.hour,e=1===this.minute.toString().length?"0"+this.minute:this.minute,i=1===this.second.toString().length?"0"+this.second:this.second;this.showInputs?(this.$widget.find("input.bootstrap-timepicker-hour").val(t.padLeft(2,"0")),this.$widget.find("input.bootstrap-timepicker-minute").val(e),this.showSeconds&&this.$widget.find("input.bootstrap-timepicker-second").val(i),this.showMeridian&&this.$widget.find("input.bootstrap-timepicker-meridian").val(this.meridian)):(this.$widget.find("span.bootstrap-timepicker-hour").text(t.padLeft(2,"0")),this.$widget.find("span.bootstrap-timepicker-minute").text(e),this.showSeconds&&this.$widget.find("span.bootstrap-timepicker-second").text(i),this.showMeridian&&this.$widget.find("span.bootstrap-timepicker-meridian").text(this.meridian))}},updateFromWidgetInputs:function(){if(this.$widget!==!1){var t=this.$widget.find("input.bootstrap-timepicker-hour").val()+":"+this.$widget.find("input.bootstrap-timepicker-minute").val()+(this.showSeconds?":"+this.$widget.find("input.bootstrap-timepicker-second").val():"")+(this.showMeridian?this.$widget.find("input.bootstrap-timepicker-meridian").val():"");this.setTime(t,{ignoreWidget:!0})}},widgetClick:function(e){e.stopPropagation(),e.preventDefault();var i=t(e.target),n=i.closest("a").data("action");n&&this[n](),this.update(),i.is("input")&&i.get(0).setSelectionRange(0,2)},widgetKeydown:function(e){var i=t(e.target),n=i.attr("class").replace("bootstrap-timepicker-","");switch(e.keyCode){case 9:if(this.showMeridian&&"meridian"===n||this.showSeconds&&"second"===n||!this.showMeridian&&!this.showSeconds&&"minute"===n)return this.hideWidget();break;case 27:this.hideWidget();break;case 38:switch(e.preventDefault(),n){case"hour":this.incrementHour();break;case"minute":this.incrementMinute();break;case"second":this.incrementSecond();break;case"meridian":this.toggleMeridian()}this.setTime(this.getTime()),i.get(0).setSelectionRange(0,2);break;case 40:switch(e.preventDefault(),n){case"hour":this.decrementHour();break;case"minute":this.decrementMinute();break;case"second":this.decrementSecond();break;case"meridian":this.toggleMeridian()}this.setTime(this.getTime()),i.get(0).setSelectionRange(0,2)}},widgetKeyup:function(t){(65===t.keyCode||77===t.keyCode||80===t.keyCode||46===t.keyCode||8===t.keyCode||t.keyCode>=46&&t.keyCode<=57)&&this.updateFromWidgetInputs()}},t.fn.timepicker=function(i){var n=Array.apply(null,arguments);return n.shift(),this.each(function(){var s=t(this),o=s.data("timepicker"),a="object"==typeof i&&i;o||s.data("timepicker",o=new e(this,t.extend({},t.fn.timepicker.defaults,a,t(this).data()))),"string"==typeof i&&o[i].apply(o,n)
})},t.fn.timepicker.defaults={defaultTime:"current",disableFocus:!1,disableMousewheel:!1,isOpen:!1,minuteStep:15,modalBackdrop:!1,orientation:{x:"auto",y:"auto"},secondStep:15,showSeconds:!1,showInputs:!0,showMeridian:!0,template:"dropdown",appendWidgetTo:"body",showWidgetOnAddonClick:!0},t.fn.timepicker.Constructor=e}),define("_common/views/ProcessorView",["jquery","jqueryui","underscore","moment","abstracts/View","text!_common/tmpl/modelTag.html","text!_common/tmpl/processor.html","timepicker","css!_libs/bootstrap/timepicker/css/bootstrap-timepicker.css"],function(t,e,i,n,s,o,a){a=i.template(a);var r=s.extend({className:"processor",constructor:function(){this.options={header:"Selected objects",objType:App.get("objType"),choosedType:"",objectsDefined:!1,chooseTime:!0,daterange:!0,showTimeRangeFilters:!1,daysFilterData:null,useTimeFilterData:!1,timeFilterData:null,track:!1,report:!1,watch:!1,item:!1,adding:!0,tmplItem:o,items:null},this._tpInited=!1,this.itemsList=null,this._content=null,this._heightGap=0,s.apply(this,arguments)},initialize:function(e){var n=this,s=this.options;if(i.extend(s,e||{}),!s.i18n&&(s.i18n=this.model.getTexts()),s.objectsDefined||this.listenTo(App,"toggleobjects",function(t){t.length||n.close(),s.item=null,s.items=t,n.$el.find("h2").html(l.getHeader.call(n))}),s.header=l.getHeader.call(this),s.tzId=this.model.getUserData("tzId")||null,!s.tzId){var o;s.tzId=(o=App.getTimezone({offset:60*App.getUserTimezone()}))?o.id:null}s.showTimeRangeFilters=this.model.getUserData("showTimeRangeFilters")===!0,s.useTimeFilterData=this.model.getUserData("useTimeFilterData")===!0,s.daysFilterData=this.model.getUserData("daysFilterData"),s.timeFilterData=this.model.getUserData("timeFilterData"),this.$el.on("click",".btn-cancel",function(){n.model.trigger("processorcancel")}).on("click",".btn-clear",function(){n.trigger("clear"),n.close()}).on("click","input[name=objType]",function(){n.setObjectsType(this.value)}).on("click",".btn[data-target]",function(){l.onSubmit.call(n,this)}).on("contentchange",function(){l.fitSize.call(n)}),this.on("cancel",function(){n.close()}),this.listenTo(App,"change:objType",function(t,e){n.setObjectsType(e)}),t(window).on("resizestop",function(){l.fitSize.call(n)})},render:function(e){var e=e||App.getView().$el,i=this,n=a(this.options),s=new Date;e.append(this.$el.html(n)),this.renderReportsList(),this.form=this.$el.find("form"),t.fn.draggable&&this.$el.draggable({handle:".box-header",containment:"parent"}),this.$el.find(".datepicker").datepicker({minDate:new Date(2005,0,1),maxDate:s,altFormat:"dd.mm.yy",onChangeMonthYear:function(e,i,n){var s=new Date(e,i,0);s.setDate(Math.min(n.selectedDay,s.getDate())),t(this).datepicker("setDate",s).datepicker("option","onSelect")()}}),this.$el.find("select[name=tzId]").on("change",function(){i.model.setUserData("tzId",t(this).val())}),this._tpInited=!1,l.initDateRangeInputs.call(this),l.initSingleDateInput.call(this),this.$el.find(".datepicker a.ui-state-hover").removeClass("ui-state-hover"),this._content=this.$el.find(">form>.box-content"),this._heightGap=this.$el.find(">form>.box-header").height()+this.$el.find(">form>.box-footer").height()+60,l.initTimeRangeFilters.call(this),this.options.report?l.initReportsParams.call(this):l.fitSize.call(this)},close:function(){App.trigger("unblockmap"),this.remove()},renderReportsList:function(){if(this.options.report){var t=this.options.objType,e=this.options.choosedType,n=i.filter(App.modules.reports.getUserReportsTypes(),function(e){return-1!=e.objType.indexOf(t)}),s="";if(!n.length)return this.close(),void 0;var o=this.model.getTexts(),a=i.groupBy(n,"group");i.each(a,function(t,n){s+='<optgroup label="'+o.reportGroupNames[n]+'">',i.each(t,function(t){s+='<option data-objectstype="'+t.objType+'"'+(e&&e==t.key?" selected":"")+' value="'+t.key+'">'+t.name+"</option>"}),s+="</optgroup>"}),this.$el.find("select[name=type]").html(s)}},setObjectsType:function(t){if(!this.options.objectsDefined&&t!=this.options.objType){App.modules.reports&&App.modules.reports.setUserData("choosedType",this.$el.find("select[name=type]").val());var e=this.options.report?"needreport":"needtrack";this.close(),this.model.trigger(e,t)}},validateDatesRange:function(t,e){var i=[],n=this.model.getTexts(),s=new Date;return t&&e||i.push(n.errors.startOrEndTimeIsAbsent),t>=s?i.push(n.errors.startMoreTnanNow):t>=e&&i.push(n.errors.startMoreTnanEndTime),i.length?i:null}}),l={getHeader:function(){var t=this.options.i18n,e=this.options.items,i="";return this.options.track?i=1==e.length?t.track.ucFirst()+" "+t.byObject+": "+(e.at&&e.at(0)||e[0]).get("name"):t.tracks.ucFirst()+" "+t.byNSelectedObjects.replace("#n#",e.length).replace("#type#",t.byVehiclesLabels[1]):(i=t.report.ucFirst()+" ",i+=1==e.length?t.byObject+": "+(e.at&&e.at(0)||e[0]).get("name"):t.byNSelectedObjects.replace("#n#",e.length).replace("#type#",t["stat"==this.options.objType?"byStationaryLabels":"byVehiclesLabels"][1])),i},fitSize:function(){var e=this._content.find(".report-params"),i=t(window).height(),n=this.$el.offset().top,s=parseInt(this.el.style.top||0),o=this._content[0].scrollHeight;e.length&&(o=Math.max(o,e[0].scrollHeight)),o>i-(n-s)-this._heightGap?(this.el.style.top="0",o=i-n-this._heightGap,e.length?(o-=60,e.height(o)):this._content.addClass("scrolled").height(o)):(e.length&&e.height("auto"),this._content.height("auto"))},initSingleDateInput:function(){var t=this,e=this.$el.find(".date-single"),i=e.siblings("input[name=date]"),n=this.$el.find("input[name=time]"),s=new Date;e.datepicker("option","onSelect",function(i,s){var o=e.datepicker("getDate"),a=new Date,r=o.getYear()==a.getYear()&&o.getMonth()==a.getMonth()&&o.getDate()==a.getDate();t._tpInited||l.initTimepickers.call(t),r?n.timepicker("setTime",a.getHours().padLeft(2)+":"+a.getMinutes().padLeft(2),{ignoreButtons:!0}):n.timepicker("setTime","00:00",{ignoreButtons:!0}),s&&s.drawMonth!=s.selectedMonth&&e.datepicker("setDate",o),t.model.setUserData("singleDate",o.getTime())}).datepicker("option","altField",i);var o,a;(o=t.model.getUserData("singleDate"))&&e.datepicker("setDate",new Date(o)),(a=t.model.getUserData("singleTime"))||(a=s.getHours().padLeft(2)+":"+s.getMinutes().padLeft(2)),t._tpInited?n.timepicker("setTime",a,{ignoreButtons:!0}):n.val(a),t._tpInited||l.initTimepickers.call(t),n.on("change",function(){var e=this.value.split(":");if(!(2!=e.length||e[0]<0||e[0]>23||e[1]<0||e[1]>59)){var i=new Date;return i.getHours()==parseInt(e[0])&&i.getMinutes()==parseInt(e[1])?(t.model.setUserData(this.name,null),void 0):(t.model.setUserData("singleTime",this.value),void 0)}})},initTimepickers:function(){var e=this;t.fn.timepicker&&this.$el.find(".input-time").timepicker({minuteStep:1,showMeridian:!1,showInputs:!1}).on("changeTime.timepicker",function(i,n){t(this).closest(".control-group").removeClass("error"),!n.options.ignoreButtons&&l.setButtonsState.call(e)}),this._tpInited=!0},initDateRangeInputs:function(){var e=this,i=this.$el.find(".date-from"),n=i.siblings("input[name=dateFrom]"),s=this.$el.find(".date-to"),o=s.siblings("input[name=dateTo]"),a=this.$el.find("input[name=timeFrom]"),r=this.$el.find("input[name=timeTo]"),c=new Date;this.$el.find(".date.from, .date.to").removeClass("hidden"),i.datepicker("option","onSelect",function(t,n){var o=i.datepicker("getDate"),c=s.datepicker("getDate"),h=c-o;if(e._tpInited||l.initTimepickers.call(e),a.timepicker("setTime","00:00",{ignoreButtons:!1}),n&&n.drawMonth!=n.selectedMonth&&i.datepicker("setDate",o),0>=h){var d=o.getTime(),u=(new Date).getTime(),p=new Date(d);d>u&&(p=new Date(u),r.timepicker("setTime",p.getHours().padLeft(2)+":"+p.getMinutes().padLeft(2),{ignoreButtons:!1})),s.datepicker("setDate",p),e.model.setUserData("dateTo",p.getTime())}t&&n&&l.setButtonsState.call(e),s.find("a.ui-state-hover").removeClass("ui-state-hover"),r.add(a).closest(".control-group").removeClass("error"),e.model.setUserData("dateFrom",o.getTime())}).datepicker("option","altField",n),s.datepicker("option","onSelect",function(t,n){var o=s.datepicker("getDate"),c=i.datepicker("getDate"),h=new Date,d=o-c,u=o.getYear()==h.getYear()&&o.getMonth()==h.getMonth()&&o.getDate()==h.getDate();if(e._tpInited||l.initTimepickers.call(e),u?r.timepicker("setTime",h.getHours().padLeft(2)+":"+h.getMinutes().padLeft(2),{ignoreButtons:!1}):r.timepicker("setTime","00:00",{ignoreButtons:!1}),n&&n.drawMonth!=n.selectedMonth&&s.datepicker("setDate",o),0>=d){var p=new Date(o.getTime());i.datepicker("setDate",p),e.model.setUserData("dateFrom",p.getTime())}t&&n&&l.setButtonsState.call(e),i.find("a.ui-state-hover").removeClass("ui-state-hover"),r.add(a).closest(".control-group").removeClass("error"),e.model.setUserData("dateTo",o.getTime())}).datepicker("option","altField",o);var h,d;(h=e.model.getUserData("dateFrom"))&&i.datepicker("setDate",new Date(h)),(h=e.model.getUserData("dateTo"))&&s.datepicker("setDate",new Date(h)),(d=e.model.getUserData("timeFrom"))&&(e._tpInited?a.timepicker("setTime",d,{ignoreButtons:!1}):a.val(d)),(d=e.model.getUserData("timeTo"))||(d=c.getHours().padLeft(2)+":"+c.getMinutes().padLeft(2)),e._tpInited?r.timepicker("setTime",d,{ignoreButtons:!1}):r.val(d),e._tpInited||l.initTimepickers.call(e),a.add(r).on("change",function(){var t=this.value.split(":");if(!(2!=t.length||t[0]<0||t[0]>23||t[1]<0||t[1]>59)){if(this==r[0]){var i=new Date;if(i.getHours()==parseInt(t[0])&&i.getMinutes()==parseInt(t[1]))return e.model.setUserData(this.name,null),void 0}e.model.setUserData(this.name,this.value)}});var u=this.$el.find(".autoselect");u.on("click","[data-value]",function(){var n=t(this),o=new Date,l=n.data("value"),c=o.getFullYear(),h=o.getMonth(),d=o.getDate(),p=o.getHours().padLeft(2,"0")+":"+o.getMinutes().padLeft(2,"0"),m="00:00",f=o,g=null;switch(u.find(".active").removeClass("active"),n.addClass("active"),l){case"curDay":g=new Date(c,h,d),m=p;break;case"prevDay":g=new Date(c,h,d-1),f=new Date(c,h,d,0,0);break;case"curWeek":var v=o.getDay();g=new Date(c,h,d-(0==v?6:v-1)),m=p;break;case"prevWeek":var v=o.getDay(),_=d-(0==v?6:v-1);f=new Date(c,h,_,0,0),g=new Date(c,h,_-7);break;case"curMonth":g=new Date(c,h,1),m=p;break;case"prevMonth":g=new Date(c,h-1,1),f=new Date(c,h,1,0,0)}s.datepicker("setDate",f,{ignoreButtons:!0}),i.datepicker("setDate",g,{ignoreButtons:!0}),r.timepicker("setTime",m,{ignoreButtons:!0}),e.model.setUserData("dateTo",s.datepicker("getDate").getTime()),e.model.setUserData("dateFrom",i.datepicker("getDate").getTime()),a.timepicker("setTime","00:00",{ignoreButtons:!0}),s.add(i).find("a.ui-state-hover").removeClass("ui-state-hover")}),l.setButtonsState.call(e)},initReportsParams:function(){var t=this.$el.find("select[name=type]"),e=this,i=t.val();l.buildReportParams.call(this,i),l.checkDatepickers.call(this,i),t.on("change",function(){var i=t.val();e.options.choosedType=i,e.$el.find(".report-params .content").empty(),l.buildReportParams.call(e,i),l.checkDatepickers.call(e,i)})},buildReportParams:function(t){var e=this.$el.find(".report-params"),i=this;showCursor(),this.model.getReportExtraFields(t,this.options.objType,this.options.item?[this.options.item]:this.options.items.models?this.options.items.models:this.options.items).done(function(t,n){i.$el.addClass("wide");var s=e.removeClass("hidden").find(".content");s.html(t),n&&n(e);var o=i.$el.parent().width(),a=i.$el.position().left,r=i.$el.width(),l=30;a+r+l>=o&&i.$el.css("left",o-r-l)}).fail(function(){i.$el.removeClass("wide"),e.addClass("hidden")}).always(function(){hideCursor(),l.fitSize.call(i)})},checkDatepickers:function(t){this.model.reportDatesRangeNeeded(t)?(this.$el.find(".time-range").removeClass("disabled"),this.$el.find(".time-range-filters").removeClass("disabled"),this.$el.find(".date.from, .date.to").removeClass("hidden"),this.$el.find(".date.single").addClass("hidden"),this.$el.find(".autoselect").removeClass("disabled")):(this.$el.find(".time-range").addClass("disabled"),this.$el.find(".time-range-filters").addClass("disabled"),this.model.reportDateNeeded(t)?(this.$el.find(".date.from, .date.to").addClass("hidden"),this.$el.find(".date.single").removeClass("hidden"),this.$el.find(".autoselect").addClass("disabled")):this.$el.find(".autoselect").removeClass("disabled"))},setButtonsState:function(){var t=this.options.i18n.DateTime;if(this.options.daterange){this.$el.find(".autoselect .active").removeClass("active");var e=this.$el.find("input[name=dateFrom]"),i=t.prepareDateField(e.val()),n=i.split("-"),s=this.$el.find("input[name=timeFrom]"),o=s.val();if(o.split){var a=o.split(":");if(2==a.length){var r=new Date(n[0],n[1]-1,n[2],a[0],a[1]);if(e=this.$el.find("input[name=dateTo]"),i=t.prepareDateField(e.val()),n=i.split("-"),s=this.$el.find("input[name=timeTo]"),o=s.val(),o.split&&(a=o.split(":"),2==a.length)){var l=new Date(n[0],n[1]-1,n[2],a[0],a[1]),c=this.validateDatesRange(r,l);if(!c)for(var h=new Date,d=h.getFullYear(),u=h.getMonth(),p=h.getDate(),m=["curDay","prevDay","curWeek","prevWeek","curMonth","prevMonth"],f=0,g=m.length;g>f;f++){var v=m[f],_=this.$el.find(".autoselect [data-value="+v+"]");if("curDay"==v)var b=new Date(d,u,p);else if("prevDay"==v)var b=new Date(d,u,p-1),y=new Date(d,u,p,0,0);else if("curWeek"==v)var w=h.getDay(),b=new Date(d,u,p-(0==w?6:w-1));else if("prevWeek"==v)var w=h.getDay(),x=p-(0==w?6:w-1),b=new Date(d,u,x-7),y=new Date(d,u,x,0,0);else if("curMonth"==v)var b=new Date(d,u,1);else if("prevMonth"==v)var b=new Date(d,u-1,1),y=new Date(d,u,1,0,0);if(-1!=v.indexOf("cur")){if(b.getTime()==r.getTime()&&l.getTime()-h.getTime()<6e4){_.addClass("active");break}}else if(b.getTime()==r.getTime()&&l.getTime()==y.getTime()){_.addClass("active");break}}}}}}},initTimeRangeFilters:function(){var t=this,e=this.model,i=this.options.i18n,n=this.$el.find(".time-range-filters"),s=this.$el.find(".toggle-time-range-filters"),o=n.find(".dropdown-toggle"),a=n.find(".dropdown-menu .checkbox"),r=n.find('input[name="filterDays"]'),c=n.find('input[name="rangesFilter"]'),h=n.find(".input-time");l.setDaysFilterText.call(this,o,r),s.on("click",function(){var t=n.hasClass("hidden");n[t?"removeClass":"addClass"]("hidden"),r.prop("disabled",!t),s.text(t?i.hideOptionalTimeSettings:i.optionalTimeSettings),e.setUserData("showTimeRangeFilters",t)}),a.on("click",function(t){t.stopPropagation()}),r.on("click",function(){o.removeClass("error"),l.setDaysFilterText.call(t,o,r)}),c.on("click",function(){c.closest(".control-group").removeClass("error"),h.prop("disabled",!this.checked)})},setDaysFilterText:function(t,e){var i=this.options.i18n,n=i.DateTime.dayNames,s=t.find(".btn-text"),o=e.filter(":checked"),a=[];7!=o.length&&o.length?o.each(function(){a.push(n[7==this.value?0:this.value])}):a[0]=i.allDaysOfTheWeek,s.text(a.join(", "))},onSubmit:function(e){var s,o=this.model,a=this.options,r=t(e).data("target"),c=a.i18n,h=this.form.serializeObject(),d=c.error.ucFirst();if(o.reportDatesRangeNeeded(a.choosedType)){if(h.startTime=l.getTsFromInputsData.call(this,h.dateFrom,h.timeFrom),h.endTime=l.getTsFromInputsData.call(this,h.dateTo,h.timeTo),s=this.validateDatesRange(h.startTime,h.endTime))return this.$el.find(".time-range .input-time").closest(".control-group").addClass("error"),alert(s.join("<br />"),d);if(!a.report||!o.getUserData("showTimeRangeFilters")||"filterDays"in h||(h.filterDays=i.range(1,8)),"filterDays"in h){var u=h.filterDays,p=[];i.isArray(u)||(u=[u]);var m,f,g,v,_,b="YYYY-MM-DD HH:mm:ss",y=!1,w=l.getDaysPeriods.call(this,h.startTime,h.endTime),x=i.filter(w,function(t){return-1!=u.indexOf(t.dayOfWeek)});if(!x.length)return this.$el.find(".time-range-filters .dropdown-toggle").addClass("error"),alert(c.errors.selectedDaysOutOfRange,d);if(o.setUserData("useTimeFilterData",!!h.rangesFilter),h.rangesFilter){var C=h.filterTimeFrom.split(":"),S=Number(C[0]||0),T=Number(C[1]||0),A=h.filterTimeTo.split(":"),L=Number(A[0]||0),M=Number(A[1]||0);0==L&&0==M&&(L=24),o.setUserData("timeFilterData",[h.filterTimeFrom,h.filterTimeTo]),x.forEach(function(t){if(m=n(t.ts).add(S,"hours").add(T,"minutes"),f=m.valueOf(),g=n(t.ts).add(L,"hours").add(M,"minutes"),v=g.valueOf(),f>=v){if(y)f=m.startOf("day").valueOf();else{if(f>=h.endTime)return;v+=864e5}v<h.endTime&&(g=n(v),_=Number(g.format("E")),u.indexOf(_)<0?(v=g.startOf("day").valueOf(),y=!0):y=!1)}else if(f>=h.endTime)return;f=Math.max(f,h.startTime),v=Math.min(v,h.endTime),p.push({from:n(f).format(b),to:n(v).format(b)})})}else x.forEach(function(t){g=n(t.ts).add(1,"days"),p.push({from:n(Math.max(t.ts,h.startTime)).format(b),to:(g.valueOf()>h.endTime?n(h.endTime):g).format(b)})});o.setUserData("daysFilterData",u),h.timeRanges=p,i.each(["filterTimeFrom","filterTimeTo","rangesFilter"],function(t){delete h[t]})}}else o.reportDateNeeded(a.choosedType)&&(h.time=l.getTsFromInputsData.call(this,h.date,h.time),i.each(["dateFrom","dateTo","timeFrom","timeTo","date"],function(t){delete h[t]}));o.trigger("processorsubmit",r,a,h)},getTsFromInputsData:function(t,e){t=this.options.i18n.DateTime.prepareDateField(t);var i=t.split("-"),n=e.split(":");return new Date(i[0],i[1]-1,i[2],n[0],n[1]).getTime()},getDaysPeriods:function(t,e){for(var i=[],s=n(t),o=s.startOf("day");o.valueOf()<e;)i.push({ts:o.valueOf(),dayOfWeek:Number(o.format("E"))}),o.add(1,"days");return i}};return r}),define("_common/ObjectsUpdateProviderWS",["jquery","underscore","abstracts/Model"],function(t,e,i){var n=500,s=1e3,o=4002,a=4003,r=4010,l=1,c=i.extend({constructor:function(){this._ws=null,this._wsTimeout=null,this._isWaiting=!1,this._objectIds=[],i.apply(this,arguments)},initialize:function(){h.makeSocket.call(this),this.listenTo(App,"logout",function(){this._ws&&this._ws.close(s)}.bind(this))},addObjectIds:function(t){return this._objectIds=e.union(this._objectIds,t),h.onObjectIdsChange.call(this),this},deleteObjectIds:function(t){return this._objectIds=e.difference(this._objectIds,t),h.onObjectIdsChange.call(this),this},setObjectIds:function(t){return this._objectIds=t,h.onObjectIdsChange.call(this),this},isConnected:function(){return this._ws&&this._ws.readyState==l}}),h={makeSocket:function(){var t=this,i="ws",n=App.getBaseUrl().replace(/http:\/\/|https:\/\//,"")+"socket/tracking?authorization="+encodeURIComponent(App.getBasic());App.isHttpsServer()&&(i="wss"),this._ws=new WebSocket(i+"://"+n),h.initSocket.call(t).done(function(){e.each(["onmessage","onerror","onclose"],function(e){t._ws[e]=function(i){h[e]&&h[e].call(t,i)}})})},initSocket:function(){var e=new t.Deferred,i=this,n=this._ws;return n.onopen=function(){i._wsTimeout&&clearTimeout(i._wsTimeout),this._isWaiting&&(this._isWaiting=!1,h.onObjectIdsChange.call(this)),e.resolve()},e},onmessage:function(e){var i,n=e.data;(i=t.parseJSON(n))&&App.trigger("updateobject",i)},onclose:function(t){this._ws=null,t.code===s||t.code===r||t.code!==o&&t.code!==a&&h.onerror.call(this)},onerror:function(){this._wsTimeout&&clearTimeout(this._wsTimeout),App.trigger("serverlost")},setReopenTimeout:function(){this._wsTimeout=setTimeout(function(){h.makeSocket.call(this)}.bind(this),n)},onObjectIdsChange:function(){this.isConnected()?this._ws.send(JSON.stringify(this._objectIds)):this._isWaiting=!0}};return c}),define("_common/guards/GuardsContextSource",["jquery","underscore"],function(t,e){function i(t){var i=e.groupBy(t,function(t){return t.company}),n=e.sortBy(e.keys(i)),s=n.map(function(t){var n=e.sortBy(i[t],function(t){return-t.timestamp});return{company:t,guards:n[0].guards}});return s}function n(t){for(var e=new ArrayBuffer(16),i=new Uint16Array(e),n=0,s=8;s>n;n++)i[n]=t.charCodeAt(n);return 1e4*i[0]}function s(t){this._cacheMaxTime=t,this._cache={},this._requests={}}return e.extend(s.prototype,{_fetchContextData:function(){var i=new t.Deferred,n=this._requests;return n.root=t.ajax({url:App.getBaseUrl()+"context/",data:{}}).done(function(t){t=e.filter(t,function(t){return"guards"in t&&"company"in t}),this._cache.root={value:t,ts:Date.now()},i.resolve(t)}.bind(this)).fail(i.reject).always(function(){n.root=null}),i},_findContextDataInCache:function(){var t="root";if(t in this._cache){var e=this._cache[t].ts;return Date.now()-e>=this._cacheMaxTime?null:this._cache[t].value}return null},_getContextData:function(){var e=this._findContextDataInCache();return null===e?this._requests.root?this._requests.root:this._fetchContextData():(new t.Deferred).resolve(e)},fetchLatest:function(){var e=new t.Deferred;return this._getContextData().done(function(t){var s=i(t),o=0;s.forEach(function(t){t.id=++o,t.name=t.company;var e=n(t.name);t.guards=t.guards.map(function(i){return Object.assign({},i,{id:e+i.id,extId:i.id,name:i.name||t.company+" #"+i.id})})}),e.resolve(s)}).fail(e.reject),e},fetchList:function(){var e=new t.Deferred;return this.fetchLatest().done(function(t){var i=[];t.forEach(function(t){i=i.concat(t.guards)}),e.resolve(i)}).fail(e.reject),e}}),s}),define("_common/nls/tz",{root:{names:[{offset:-720,name:"Date line",index:"000",id:"Etc/GMT-12"},{offset:-660,name:"Samoa",index:"001",id:"Pacific/Midway"},{offset:-600,name:"Hawaii",index:"002",id:"Pacific/Honolulu"},{offset:-480,name:"Alaska",index:"003",id:"America/Anchorage"},{offset:-420,name:"Pacific Time (USA and Canada)",index:"004",id:"PST8PDT"},{offset:-420,name:"La Paz, Mazatlan, Chihuahua",index:"013",id:"America/Chihuahua"},{offset:-420,name:"Arizona",index:"015",id:"America/Chihuahua"},{offset:-360,name:"Mountain Standard Time (USA and Canada)",index:"010",id:"MST7MDT"},{offset:-360,name:"Central Standard Time (USA and Canada)",index:"020",id:"CST6CDT"},{offset:-360,name:"Saskatchewan",index:"025",id:"America/Regina"},{offset:-360,name:"Guadalajara, Mexico City, Monterrey",index:"030",id:"America/Mexico_City"},{offset:-360,name:"Central America",index:"033",id:"America/Costa_Rica"},{offset:-300,name:"Eastern Standard Time (USA and Canada)",index:"035",id:"EST5EDT"},{offset:-300,name:"Indiana (east)",index:"040",id:"America/Indiana/Petersburg"},{offset:-300,name:"Bogota, Quito, Lima",index:"045",id:"America/Bogota"},{offset:-270,name:"Caracas",index:"055",id:"America/Caracas"},{offset:-240,name:"Atlantic Standard Time (Canada)",index:"050",id:"America/Glace_Bay"},{offset:-240,name:"Georgetown, La Paz, Manaus, San Juan",index:"051",id:"America/La_Paz"},{offset:-240,name:"Santiago",index:"056",id:"America/Santiago"},{offset:-240,name:"Cuiaba",index:"057",id:"America/Cuiaba"},{offset:-210,name:"Newfoundland and Labrador",index:"060",id:"America/St_Johns"},{offset:-180,name:"Brasilia",index:"065",id:"America/Sao_Paulo"},{offset:-180,name:"Buenos Aires",index:"070",id:"America/Argentina/Buenos_Aires"},{offset:-180,name:"Greenland",index:"073",id:"America/Godthab"},{offset:-180,name:"Cayenne, Fortaleza",index:"074",id:"America/Cayenne"},{offset:-180,name:"Montevideo",index:"072",id:"America/Montevideo"},{offset:-120,name:"Mid-Atlantic Standard Time",index:"075",id:"Atlantic/South_Georgia"},{offset:-60,name:"Azores",index:"080",id:"Atlantic/Azores"},{offset:-60,name:"Cape Verde Islands",index:"083",id:"Atlantic/Cape_Verde"},{offset:0,name:"UTC time",index:"085",id:"Etc/UTC"},{offset:0,name:"Monrovia, Reykjavik",index:"091",id:"Atlantic/Reykjavik"},{offset:60,name:"Dublin, Edinburgh, London, Lisbon",index:"086",id:"Europe/Belfast"},{offset:60,name:"Casablanca",index:"090",id:"Africa/Casablanca"},{offset:60,name:"Windhoek",index:"112",id:"Africa/Windhoek"},{offset:60,name:"Sub-Saharan Africa",index:"113",id:"Africa/Algiers"},{offset:120,name:"Kaliningrad",index:"114",id:"Europe/Kaliningrad"},{offset:120,name:"Belgrade, Bratislava, Budapest, Ljubljana, Prague",index:"095",id:"Europe/Budapest"},{offset:120,name:"Warsaw, Zagreb, Sarajevo, Skopje",index:"100",id:"Europe/Warsaw"},{offset:120,name:"Brussels, Copenhagen, Madrid, Paris",index:"105",id:"Europe/Paris"},{offset:120,name:"Amsterdam, Berlin, Berne, Vienna, Rome, Stockholm",index:"110",id:"Europe/Berlin"},{offset:120,name:"Harare, Pretoria",index:"140",id:"Africa/Harare"},{offset:120,name:"Cairo",index:"120",id:"Africa/Cairo"},{offset:180,name:"Moscow, St. Petersburg, Volgograd",index:"145",id:"Europe/Moscow"},{offset:180,name:"Jerusalem",index:"135",id:"Asia/Jerusalem"},{offset:180,name:"Athens, Bucharest",index:"130",id:"Europe/Athens"},{offset:180,name:"Beirut",index:"115",id:"Asia/Beirut"},{offset:180,name:"Vilnyus, Kyiv, Riga, Sofia, Tallin, Helsinki",index:"125",id:"Europe/Helsinki"},{offset:180,name:"Minsk",index:"146",id:"Europe/Minsk"},{offset:180,name:"Kuwait, Riyadh",index:"150",id:"Asia/Kuwait"},{offset:180,name:"Nairobi",index:"155",id:"Africa/Nairobi"},{offset:180,name:"Baghdad",index:"158",id:"Asia/Baghdad"},{offset:240,name:"Samara, Izhevsk",index:"161",id:"Europe/Samara"},{offset:240,name:"Abu Dhabi, Muscat",index:"165",id:"Asia/Muscat"},{offset:240,name:"Baku, Tbilisi, Yerevan",index:"170",id:"Asia/Tbilisi"},{offset:270,name:"Tehran",index:"160",id:"Asia/Tehran"},{offset:270,name:"Kabul",index:"175",id:"Asia/Kabul"},{offset:300,name:"Yekaterinburg, Ufa, Tyumen, Perm",index:"196",id:"Asia/Yekaterinburg"},{offset:300,name:"Islamabad, Karachi",index:"185",id:"Asia/Karachi"},{offset:300,name:"Tashkent",index:"186",id:"Asia/Tashkent"},{offset:330,name:"Calcutta, Mumbai, New Delhi, Chennai",index:"190",id:"Asia/Calcutta"},{offset:330,name:"Sri Jayawardenapura Kotte",index:"200",id:"Asia/Colombo"},{offset:345,name:"Kathmandu",index:"193",id:"Asia/Kathmandu"},{offset:360,name:"Omsk",index:"194",id:"Asia/Omsk"},{offset:360,name:"Astana",index:"195",id:"Asia/Almaty"},{offset:390,name:"Rangoon",index:"203",id:"Asia/Rangoon"},{offset:420,name:"Novosibirsk, Tomsk",index:"206",id:"Asia/Krasnoyarsk"},{offset:420,name:"Krasnoyarsk, Kemerovo, Barnaul, Abakan",index:"207",id:"Asia/Krasnoyarsk"},{offset:420,name:"Bangkok, Djakarta, Hanoi",index:"205",id:"Asia/Bangkok"},{offset:480,name:"Ulan-Ude, Irkutsk",index:"208",id:"Asia/Irkutsk"},{offset:480,name:"Hong Kong, Beijing, Urumqi, Chongqing ",index:"210",id:"Asia/Hong_Kong"},{offset:480,name:"Kuala Lumpur, Singapore",index:"215",id:"Asia/Kuala_Lumpur"},{offset:480,name:"Taipei",index:"220",id:"Asia/Taipei"},{offset:480,name:"Perth",index:"225",id:"Australia/Perth"},{offset:480,name:"Ulaanbaatar",index:"227",id:"Asia/Ulaanbaatar"},{offset:540,name:"Yakutsk, Blagoveshchensk, Chita",index:"240",id:"Asia/Yakutsk"},{offset:540,name:"Seoul",index:"230",id:"Asia/Seoul"},{offset:540,name:"Osaka, Sapporo, Tokyo",index:"235",id:"Asia/Tokyo"},{offset:570,name:"Adelaide",index:"250",id:"Australia/Adelaide"},{offset:600,name:"Khabarovsk, Vladivostok, Magadan",index:"270",id:"Asia/Vladivostok"},{offset:600,name:"Canberra, Melbourne, Sydney",index:"255",id:"Australia/Canberra"},{offset:600,name:"Hobart",index:"265",id:"Australia/Hobart"},{offset:600,name:"Guam, Port Moresby",index:"275",id:"Pacific/Guam"},{offset:660,name:"Yuzhno-Sakhalinsk, Druzhina",index:"291",id:"Asia/Srednekolymsk"},{offset:660,name:"Solomon Islands, New Caledonia",index:"280",id:"Pacific/Guadalcanal"},{offset:720,name:"Petropavlovsk-Kamchatsky",index:"291",id:"Asia/Kamchatka"},{offset:720,name:"Fiji",index:"285",id:"Pacific/Fiji"},{offset:720,name:"Wellington, Auckland",index:"290",id:"Pacific/Auckland"},{offset:780,name:"Nukualofa",index:"300",id:"Etc/GMT+13"}]},"ru-ru":!0,"it-it":!0}),define("_common/nls/ru-ru/tz",{names:[{offset:-720,name:"Линия перемены дат",index:"000",id:"Etc/GMT-12"},{offset:-660,name:"Самоа",index:"001",id:"Pacific/Midway"},{offset:-600,name:"Гавайи",index:"002",id:"Pacific/Honolulu"},{offset:-480,name:"Аляска",index:"003",id:"America/Anchorage"},{offset:-420,name:"Тихоокеанское время (США и Канада)",index:"004",id:"PST8PDT"},{offset:-420,name:"Ла-Пас, Мазатлан, Чихуахуа",index:"013",id:"America/Chihuahua"},{offset:-420,name:"Аризона",index:"015",id:"America/Chihuahua"},{offset:-360,name:"Горное время (США и Канада)",index:"010",id:"MST7MDT"},{offset:-360,name:"Центральное время (США и Канада)",index:"020",id:"CST6CDT"},{offset:-360,name:"Саскачеван",index:"025",id:"America/Regina"},{offset:-360,name:"Гвадалахара, Мехико, Монтеррей",index:"030",id:"America/Mexico_City"},{offset:-360,name:"Центральная Америка",index:"033",id:"America/Costa_Rica"},{offset:-300,name:"Восточное время (США и Канада)",index:"035",id:"EST5EDT"},{offset:-300,name:"Индиана (восток)",index:"040",id:"America/Indiana/Petersburg"},{offset:-300,name:"Богота, Кито, Лима",index:"045",id:"America/Bogota"},{offset:-270,name:"Каракас",index:"055",id:"America/Caracas"},{offset:-240,name:"Атлантическое время (Канада)",index:"050",id:"America/Glace_Bay"},{offset:-240,name:"Джорджтаун, Ла-Пас, Манаус, Сан-Хуан",index:"051",id:"America/La_Paz"},{offset:-240,name:"Сантьяго",index:"056",id:"America/Santiago"},{offset:-240,name:"Куяба",index:"057",id:"America/Cuiaba"},{offset:-210,name:"Ньюфаундленд и Лабрадор",index:"060",id:"America/St_Johns"},{offset:-180,name:"Бразилиа",index:"065",id:"America/Sao_Paulo"},{offset:-180,name:"Буэнос-Айрес",index:"070",id:"America/Argentina/Buenos_Aires"},{offset:-180,name:"Гренландия",index:"073",id:"America/Godthab"},{offset:-180,name:"Кайенна, Форталеза",index:"074",id:"America/Cayenne"},{offset:-180,name:"Монтевидео",index:"072",id:"America/Montevideo"},{offset:-120,name:"Среднеатлантическое время",index:"075",id:"Atlantic/South_Georgia"},{offset:-60,name:"Азорские о-ва",index:"080",id:"Atlantic/Azores"},{offset:-60,name:"О-ва Зеленого Мыса",index:"083",id:"Atlantic/Cape_Verde"},{offset:0,name:"Время в формате UTC",index:"085",id:"Etc/UTC"},{offset:0,name:"Монровия, Рейкьявик",index:"091",id:"Atlantic/Reykjavik"},{offset:60,name:"Дублин, Эдинбург, Лондон, Лиссабон",index:"086",id:"Europe/Belfast"},{offset:60,name:"Касабланка",index:"090",id:"Africa/Casablanca"},{offset:60,name:"Виндхук",index:"112",id:"Africa/Windhoek"},{offset:60,name:"Западная Центральная Африка",index:"113",id:"Africa/Algiers"},{offset:120,name:"Калининград",index:"114",id:"Europe/Kaliningrad"},{offset:120,name:"Белград, Братислава, Будапешт, Любляна, Прага",index:"095",id:"Europe/Budapest"},{offset:120,name:"Варшава, Загреб, Сараево, Скопье",index:"100",id:"Europe/Warsaw"},{offset:120,name:"Брюссель, Копенгаген, Мадрид, Париж",index:"105",id:"Europe/Paris"},{offset:120,name:"Амстердам, Берлин, Берн, Вена, Рим, Стокгольм",index:"110",id:"Europe/Berlin"},{offset:120,name:"Каир",index:"120",id:"Africa/Cairo"},{offset:120,name:"Хараре, Претория",index:"140",id:"Africa/Harare"},{offset:180,name:"Москва, Санкт-Петербург, Волгоград",index:"145",id:"Europe/Moscow"},{offset:180,name:"Афины, Бухарест",index:"130",id:"Europe/Athens"},{offset:180,name:"Бейрут",index:"115",id:"Asia/Beirut"},{offset:180,name:"Вильнюс, Киев, Рига, София, Таллин, Хельсинки",index:"125",id:"Europe/Helsinki"},{offset:180,name:"Иерусалим",index:"135",id:"Asia/Jerusalem"},{offset:180,name:"Минск",index:"146",id:"Europe/Minsk"},{offset:180,name:"Кувейт, Эр-Рияд",index:"150",id:"Asia/Kuwait"},{offset:180,name:"Найроби",index:"155",id:"Africa/Nairobi"},{offset:180,name:"Багдад",index:"158",id:"Asia/Baghdad"},{offset:240,name:"Самара, Ижевск",index:"161",id:"Europe/Samara"},{offset:240,name:"Абу-Даби, Мускат",index:"165",id:"Asia/Muscat"},{offset:240,name:"Баку, Тбилиси, Ереван",index:"170",id:"Asia/Tbilisi"},{offset:270,name:"Тегеран",index:"160",id:"Asia/Tehran"},{offset:270,name:"Кабул",index:"175",id:"Asia/Kabul"},{offset:300,name:"Екатеринбург, Уфа, Тюмень, Пермь",index:"196",id:"Asia/Yekaterinburg"},{offset:300,name:"Исламабад, Карачи",index:"185",id:"Asia/Karachi"},{offset:300,name:"Ташкент",index:"186",id:"Asia/Tashkent"},{offset:330,name:"Колката, Мумбаи, Нью-Дели, Ченнай",index:"190",id:"Asia/Calcutta"},{offset:330,name:"Шри-Джаявардене-пура-Котте",index:"200",id:"Asia/Colombo"},{offset:345,name:"Катманду",index:"193",id:"Asia/Kathmandu"},{offset:360,name:"Омск",index:"194",id:"Asia/Omsk"},{offset:360,name:"Астана",index:"195",id:"Asia/Almaty"},{offset:390,name:"Янгон",index:"203",id:"Asia/Rangoon"},{offset:420,name:"Новосибирск, Томск",index:"206",id:"Asia/Krasnoyarsk"},{offset:420,name:"Красноярск, Кемерово, Барнаул, Абакан",index:"207",id:"Asia/Krasnoyarsk"},{offset:420,name:"Бангкок, Джакарта, Ханой",index:"205",id:"Asia/Bangkok"},{offset:480,name:"Улан-Удэ, Иркутск",index:"208",id:"Asia/Irkutsk"},{offset:480,name:"Гонконг, Пекин, Урумчи, Чунцин",index:"210",id:"Asia/Hong_Kong"},{offset:480,name:"Куала-Лумпур, Сингапур",index:"215",id:"Asia/Kuala_Lumpur"},{offset:480,name:"Тайбэй",index:"220",id:"Asia/Taipei"},{offset:480,name:"Перт",index:"225",id:"Australia/Perth"},{offset:480,name:"Улан-Батор",index:"227",id:"Asia/Ulaanbaatar"},{offset:540,name:"Якутск, Благовещенск, Чита",index:"240",id:"Asia/Yakutsk"},{offset:540,name:"Сеул",index:"230",id:"Asia/Seoul"},{offset:540,name:"Осака, Саппоро, Токио",index:"235",id:"Asia/Tokyo"},{offset:570,name:"Аделаида",index:"250",id:"Australia/Adelaide"},{offset:600,name:"Хабаровск, Владивосток, Магадан",index:"270",id:"Asia/Vladivostok"},{offset:600,name:"Канберра, Мельбурн, Сидней",index:"255",id:"Australia/Canberra"},{offset:600,name:"Хобарт",index:"265",id:"Australia/Hobart"},{offset:600,name:"Гуам, Порт-Морсби",index:"275",id:"Pacific/Guam"},{offset:660,name:"Южно-Сахалинск, Дружина",index:"291",id:"Asia/Srednekolymsk"},{offset:660,name:"Соломоновы о-ва, Нов. Каледония",index:"280",id:"Pacific/Guadalcanal"},{offset:720,name:"Петропавловск-Камчатский",index:"291",id:"Asia/Kamchatka"},{offset:720,name:"Фиджи",index:"285",id:"Pacific/Fiji"},{offset:720,name:"Веллингтон, Окленд",index:"290",id:"Pacific/Auckland"},{offset:780,name:"Нукуалофа",index:"300",id:"Etc/GMT+13"}]}),define("_common/AppModule",["jquery","jquerytiny","underscore","jface","abstracts/Module","util","router","storage","./RitmVideo","_common/views/AppView","_common/views/ProcessorView","_common/ObjectsUpdateProviderWS","_common/guards/GuardsContextSource","i18n!_common/nls/common","i18n!_common/nls/tz"],function(t,e,i,n,s,o,a,r,l,c,h,d,u,p,m){function f(t,e,i){var n=new Date;
n.setDate(n.getDate()+i);var s=encodeURIComponent(e)+(null==i?"":";expires="+n.toUTCString());document.cookie=t+"="+s}function g(t){document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function v(){this._el=null,this._showCalls=0}var _={mobile:"mobile/MobileModule",stat:"stat/StatModule",guards:"guards/GuardsModule",geozones:"_common/geozones/GeozonesModule",tracks:"_common/tracks/TracksModule",reports:"_common/reports/ReportsModule",alarms:"_common/alerts/AlertsModule",poi:"_common/poi/PoiModule",setup:"_common/setup/SetupModule"},b=12e4,y=15e3,w=3,x=60,C="";if("hidden"in document)C="hidden";else for(var S=["webkit","moz","ms","o"],T=0;T<S.length;T++)S[T]+"Hidden"in document&&(C=S[T]+"Hidden");var A=null,L=null;t.ajaxSetup({crossDomain:!0,method:"POST",type:"POST",dataType:"json",processData:!1,contentType:"application/json",traditional:!0,xhrFields:{},beforeSend:function(t,e){e.data=JSON.stringify(e.data),t.setRequestHeader("Accept-Language",LOCALE),"GET"==e.type&&(e.type="POST")}}),"undefined"!=typeof IE_BROWSER&&(t.browser=t.browser||{},t.browser.ie=!0),navigator.userAgent.match(/Trident\/7\./)&&(t.browser=t.browser||{},t.browser.ie=!0,t.browser.ie11=!0);var M=a,k=r,D={},I=null,P="",R={},E=-(new Date).getTimezoneOffset()/60,O=s.extend({constructor:function(t,e){window[t]=this,this.serverUp=!1,this.serverWait=!1,this._activeModule=null,this._hasModules=[],this._pingTmt=null,this._reconnectTries=0,this._reconnectMsgShown=!1,this._processor=null,this._objectsUpdateProvider=null,this._globalAlertId=0,s.call(this,e)},MS:1e3,TYPE_STAT:1,TYPE_MOBILE:0,POSITION_CODE_TECH:"technician",defaults:{visible:!document[C],totalAlarms:null,startWithDashboard:!1,objType:null,reportsInBuild:null,availableReports:null,allowedReports:null,commonBounds:null,commonBoundsMaxZoom:15,commonBoundsPadding:[80,50],autozoomActive:!1,ivSessions:{},showAlertsLog:!1,grGuardsAvailable:!1,extGuardsAvailable:!1,alarmDelegationAllowed:!1,isCsdScanAllowed:!1,isSmsFromDevicesAllowed:!1,parametersFromGET:{},globalAlerts:[],zones:[],geozones:[]},initialize:function(){var t=this;if(M.init(),j.bindEvents.apply(this),this._view=new c({model:this}),!k.currentBackend()){var e=p.errors.localStorageUnavailable,i=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);return i&&(e+="<br />"+p.errors.iosPrivateMode),alert(e,p.error)}requirejs(["system/SystemModule"],function(e){t.modules.system=new e({id:"system"})})},setGlobalAlerts:function(t){this.set("globalAlerts",i.map(t,function(t){return{id:++this._globalAlertId,html:t}}.bind(this)))},pushGlobalAlert:function(t){var e=++this._globalAlertId;return this.set("globalAlerts",this.get("globalAlerts").concat([{id:e,html:t}])),e},removeGlobalAlert:function(t){this.set("globalAlerts",i.filter(this.get("globalAlerts"),function(e){return e.id!==t}))},getVersion:function(){return this.modules.system&&this.modules.system.getVersion()},subscribe:function(t,e){for(var n=t.split(" "),s=n.length;s--;){var o=n[s];D[o]||(D[o]=[]),i.isFunction(e)?e={callback:e,context:this,once:!1}:i.isArray(e)?e={callback:e[0],context:e[1]||this,once:!1}:e.context=e.context||this,R[o]?(j._publishOnce.call(this,o,e,R[o]),e.once||D[o].push(e)):D[o].push(e)}return!1},unsubscribe:function(){if(2==arguments.length){for(var t,e=arguments[0],n=arguments[1],s=e.split(" "),o=s.length;o--;)if(D[s[o]])for(var a,t=D[s[o]].slice(0),r=t.length;r--;)a=t[r],(a==n||a.context&&a.callback&&a.context==n.context&&a.callback==n.callback)&&D[s[o]].splice(r,1)}else if(1==arguments.length){var l=arguments[0],o=D.length,r=0;i.each(D,function(t,e){for(o=t.length;o--;)t[o].context&&t[o].context==l&&(D[e]=i.without(D[e],t[o]))})}},publish:function(){j._publishAll.apply(this,arguments)},receive:function(t,e){R[t]=e,e(j._publishAll.apply(this,arguments))},allowed:function(t){var e=I.can(t);return"alerts"===t&&(e&=this.isHistoryAllowed()),e},getAllowedReports:function(){if(this.has("allowedReports"))return this.get("allowedReports");var t=this.hasMobile(),e=this.hasStationary(),n={},s=(i.filter(I.get("allowedActions"),function(t){return-1!=t.indexOf("reports")?(n[t]=1,!0):!1}),this.get("availableReports")),o={};return i.each(s,function(a,r){var l=!0;("mobile"===a.objType&&!t||"stat"===a.objType&&!e)&&(l=!1);var c=a.action||r.toUpperCase();if("string"==typeof c)l="reports."+c in n;else{var h=i.filter(c,function(t){return"reports."+t in n});l=h.length>0}l&&("speeding"===r&&(o.speeding1b=s.speeding1b),"pass"===r&&(o.passmatrix=s.passmatrix),o[r]=a)}),this.set("allowedReports",o),o},reportsAllowed:function(t,e){if(!this.hasModule(t))return!1;e=e||this.getAllowedReports();var i=!1;for(var n in e)if(e[n].objType.indexOf(t)>-1){i=!0;break}return i},reportAllowedByType:function(t){var e=t in App.get("reportsInBuild");return e&&("DRIVESAFETYSUM"==t?e=this.allowed("reports.DRIVESAFETY"):"SPEEDING1B"==t?e=this.allowed("reports.SPEEDING"):("RUNMINI"==t?t="RUN":"ALERTSUM"==t&&(t="ALERTS"),e=this.allowed("reports."+t))),e},policeCallAllowed:function(){return this.userHasRole("vzorgibdd")},hasModule:function(t){return-1!==i.indexOf(this._hasModules,t)},getUserTimezone:function(){return E},getUsername:function(){return I.get("username")},getCredentials:function(){return{login:I.get("username"),pass:I.get("password")}},getBasic:function(){return I.get("basic")},hasMobile:function(){return I&&I.get("hasMobile")},hasStationary:function(){return I&&I.get("hasStationary")},hasGuards:function(){return I&&I.get("hasGuards")},isRememberMeAllowed:function(){var t=this.getServerSettings();return!("disableRememberMe"in t)},isSmsAllowed:function(){return I&&I.get("isSmsAllowed")},isCsdScanAllowed:function(){return this.get("isCsdScanAllowed")},isSmsFromDevicesAllowed:function(){return this.get("isSmsFromDevicesAllowed")},isMapMatchingPossible:function(){return I&&I.has("matching.service")},isMapMatchingAllowed:function(){return I&&this.isMapMatchingPossible()&&I.has("canUseMapMatching")},getWebRtcVideoData:function(){if(I){var t=I.get("ru.ritm.webrtc.signaling.server.host"),e=I.get("ru.ritm.webrtc.signaling.server.port");if(t&&e)return{host:t,port:e,protocol:this.isHttpsClient()?"wss:":"ws:"}}return null},hasMediaServerUrl:function(){return I?I.has("ru.ritm.has.mediaservers"):!1},getMinImportTs:function(){return I?I.get("importTs")||0:0},getSettingsView:function(){return this.modules.system?this.modules.system.getSettingsView():null},getObjectsUpdateProvider:function(){return this._objectsUpdateProvider},getRouter:function(){return M},getStorage:function(){return k},getChannels:function(){return D},getLocale:function(){return LOCALE},getLocaleName:function(){var t={"ru-RU":"Русский","ru-ru":"Русский","en-US":"English","en-en":"English","it-IT":"Italiano"};return t[LOCALE]},getTimezonesList:function(){return m.names},getTimezone:function(t){return i.findWhere(m.names,t)},getFullTimezoneName:function(t){var e=Date.offsetToString(t.offset);return"(UTC"+(e?" "+e:"")+") "+t.name},getRMCookieName:function(){return"rm"},buildBaseUrl:function(t){return(t.protocol||"http")+"://"+t.host+(t.port?":"+t.port:"")+(t.connector?"/"+t.connector:"")+"/"},setBaseUrl:function(t){P=t},getBaseUrl:function(){return P},getResourceBaseUrl:function(t){var e=this.getBaseUrl(),i=this.getServerSettings();return t in i?e=this.buildBaseUrl(i[t]):"guards"===t&&(e=e.replace(i.connector,"guards-web")),e},isHttpsClient:function(){return"https"===window.location.protocol.substr(0,5)},isHttpsServer:function(){return"https"===this.getServerSettings().protocol},getServerSettings:function(){return this.getSettings()},getSettings:function(){return this.modules.system.getServerSettings()},getPlaceholder:function(t){var e={mobile:1,geozones:2,poi:3,tracks:4,reports:5,stat:6,guards:7};return e[t]||null},getSearchProcessor:function(t){return"mobile"==t||"stat"==t?this.modules[t]||null:"guards"==t&&this.hasModule("guards")?this.modules.guards:"objects"==t?this:null},search:function(e){return"objects"==e.type?j.searchObjects.apply(this,arguments):(new t.Deferred).reject("impossible search type")},searchObjectsAndGroups:function(e,i){var n=this.getTexts(),s=new t.Deferred;e=e.toLowerCase();var o={q:e};return"undefined"!=typeof i&&null!==i&&(o.objType=i,o.groupType=i),t.when(t.ajax({url:App.getBaseUrl()+"objects/obj-search/",data:o}),t.ajax({url:App.getBaseUrl()+"objs-groups/search/",data:o})).done(function(t,e){for(var i=t[0],o=i.length,a=e[0],r=a.length,l=new Array(o+r),c=n.objects.ucFirst(),h=n.groups.ucFirst(),d=0,u=0;o>d;++d,++u){var p={category:c,model:i[d],label:i[d].name+" (#"+i[d].extId+")"};l[u]=p}for(d=0;r>d;++d,++u){a[d].isGroup=!0;var p={category:h,model:a[d],label:a[d].name};l[u]=p}s.resolve(l)}).fail(function(){s.reject()}),s},getSearchOptions:function(){var t=this,e={zoom:!0,putMarker:!1,onsuccess:function(e){for(var n=e.length,s=[],o=[],a=t.modules.mobile||null,r=t.modules.stat||null;n--;)(e[n].objType==t.TYPE_STAT?s:o).push(e[n]);if(t.getUserData("mapSearchMode")){if(a&&o.length&&a.modules.watched){var l=a.modules.watched.items.pluck("id");a.trigger("toggleitems",l.concat(i.pluck(o,"id")),[],t)}if(r&&s.length&&r.modules.watched){var l=r.modules.watched.items.pluck("id");r.trigger("toggleitems",l.concat(i.pluck(s,"id")),[],t)}if(1==o.length+s.length){var c,h;o[0]?(c=o[0],h=a.modules.watched.getEventsPrefix()):(c=s[0],h=r.modules.watched.getEventsPrefix()),t.publish(h+".itemzoom",c)}}else a&&a.modules.watched&&a.modules.watched.setItems(o),r&&r.modules.watched&&r.modules.watched.setItems(s)}};return e},suggest:function(e){return"objects"==e.type?j.suggestObjects.apply(this,arguments):(new t.Deferred).reject("impossible search type")},getPolylineForZone:function(){if(!this.modules.tracks)return null;if(!this.modules.tracks.items.length)return alert(p.pleaseBuildOneTrack,p.attention.ucFirst()),null;var t;return(t=this.modules.tracks.getSinglePolyline())?t.length?t:null:(alert(p.severalTracksShownLeaveOneForZone,p.attention.ucFirst()),null)},getWatchedZonesIds:function(){return this.modules.geozones?this.modules.geozones.getWatchedItemsIds():[]},isAdmin:function(){return I&&I.get("isAdmin")},getAdminUrl:function(t){var e=this.modules.system.getServerSettings(),i=e.adminHost||e.host;return this.getCredentials(),(e.protocol?e.protocol+":":"")+"//"+i+(e.port?":"+e.port:"")+"/adminconnector/relogin?j_token="+t+"&lang="+App.getLocale().replace("-","_")},loginAsAdmin:function(){showCursor(),t.ajax({url:this.getBaseUrl()+"users/generate-token/",data:{}}).done(function(t){var e=this.getAdminUrl(t.token);window.open(e)}.bind(this)).always(hideCursor)},isVisitor:function(){if(!I)return!1;var t=i.findWhere(I.get("roles"),{code:"visitor"});return"undefined"!=typeof t&&null!==t},isAlarmOperator:function(){if(!I)return null;var t=I.get("allowedActions");return this.allowed("alerts")&&0===i.difference(i.difference(t,["reports.LOSTFIX","reports.RUNMINI"]),["alerts","alerts.edit","alerts.close","alarm.create","control.followed","control","alerts.closeall","objects.arm","objects.disarm","objects.status.edit","objects.clearfaults","users.edit.himself"]).length},isExternalAlarmOperator:function(){var t=I.get("roles");return t.findIndex(function(t){return 0===t.code.indexOf("guards.")})>-1},isHistoryAllowed:function(){var t=I.get("allowedAlertGroupIds"),e=I.get("allowedAlertLogTypeIds"),n=i.isArray(t)&&i.isArray(e)&&!t.length&&!e.length;return"WebSocket"in window&&!this.isVisitor()&&!n},isDemo:function(){return I&&I.isDemo()},userHasRole:function(t){return I&&I.has("roles")&&i.findWhere(I.get("roles"),{code:t})},getTexts:function(){return p},getMapsModule:function(){return this.modules.maps},setActiveModule:function(t){if("string"==typeof t)var t=this.modules[t];else var t=t;return!t||this._activeModule&&t.id==this._activeModule.id?!1:(this._activeModule&&this._activeModule.deactivate(),t.activate(),("mobile"==t.id||"stat"==t.id)&&this.set("objType",t.id),this._activeModule=t,void 0)},getActiveModule:function(){return this._activeModule},getFoundAddressActions:function(){return this.hasModule("mobile")?this.modules.mobile.getFoundAddressActions():[]},getSpeedLimits:function(){return k.get("tracks.speedLimits")||this.modules.mobile&&this.modules.mobile.getUserData("speedLimits")||[60,90]},setProcessor:function(t){this._processor&&(this.stopListening(this._processor),this._processor.trigger("cancel")),this._processor=t,this._processor.render(),this.trigger("blockmap");var e=this.getView(),i=e.getPageWidth(),n=e.getLeftPaneWidth(),s=this._processor.$el,o=s.width(),a=30;i>=n+o+a?s.css("left",n+a):s.css("left",i-o-a)},getReportsAndTracksProcessor:function(){return this._processor},closeProcessor:function(){this._processor&&(this._processor.remove(),this._processor=null,this.trigger("unblockmap"))},getReportExtraFields:function(t,e,i){return this.modules.reports.getReportExtraFields(t,e,i)},reportDatesRangeNeeded:function(t){return this.modules.reports.datesRangeNeeded(t)},reportDateNeeded:function(t){return this.modules.reports.dateNeeded(t)},loading:function(t,e){return A||(A=new v),t in A?A[t](e||{}):void 0},buildObjTitle:function(t,e){var n=t.has?t.attributes:t;if(!("objType"in n))return t.name||"";e="undefined"==typeof e?" ":e;var s=this.getUserData("objectsTitle")||{name:!0},o=n.objType==App.TYPE_MOBILE?["licenseNumber","model"]:["addressShort"],a=[],r="";return"name"in s&&"undefined"!=typeof n.name&&n.name&&a.push(n.name),i.each(o,function(t){t in s&&"undefined"!=typeof n[t]&&n[t]&&a.push(n[t])}),r=a.join(e)},getDevicesData:function(e){return t.ajax({url:App.getBaseUrl()+"objects/obj/",data:{objectId:e,tz:App.getUserTimezone()}})},getDevice:function(t){var e,n=this.modules;return i.each(["mobile","stat"],function(i){!e&&n[i]&&n[i].modules.tree&&(e=n[i].modules.tree.items.get(t)||null)}),e},getAllDevicesGroups:function(t){var e=this.modules[t==App.TYPE_STAT?"stat":"mobile"]||null;return e?e.modules.tree.groups:null},getDevicesGroup:function(t){var e,n=this.modules;return i.each(["mobile","stat"],function(i){!e&&n[i]&&n[i].modules.tree&&(e=n[i].modules.tree.groups.get(t)||null)}),e},getAllDevices:function(e,i){var n=new t.Deferred,s=this.modules[e==App.TYPE_STAT?"stat":"mobile"]||null;if(!s||!s.modules.tree)return n.reject("No module");var o=s.modules.tree;return i?o.loadTree().done(function(){n.resolve(o.items)}):n.resolve(o.items),n},getAllDeviceIdsInGroup:function(t){var e=this.getDevicesGroup(t);if(!e||!e.get("nbItems"))return[];var n=[],s=e.get("objsGroups"),o=e.get("objs");return s.length&&i.each(s,i.bind(function(t){n=n.concat(this.getAllDeviceIdsInGroup(this.getDevicesGroup(t.id)))},this)),o.length&&(n=n.concat(i.pluck(o,"id"))),n=i.uniq(n)},getTechnicians:function(){return t.ajax({url:this.getBaseUrl()+"staff/list/",data:{positionCode:this.POSITION_CODE_TECH}})}}),j={bindEvents:function(){var e=this;if(C){var i=C.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(i,function(){e.set("visible",!document[C])})}this.on("logout",function(){showCursor(),t.ajax({url:this.getBaseUrl()+"users/logout/"}).always(function(t){hideCursor(),200!=t.status&&console&&console.log("Error: Logout on server failed"),j.logout.call(e)})}),this.subscribe("authsuccess",function(t){e.getStorage().rootSet("user",t)}),this.subscribe("localechange",function(t){f("locale",t,180),window.location.reload()}),this.subscribe("system.account.ready",function(t){k.setAccountKey(o.Base64.encode(t.getUserId())),I=t.getAccount(),j.loadServerFeatures.call(e).always(function(){j.onAccountReady.call(e)})}),this.on("appready",function(){j.initBoundsWatching.call(e),k.rootGet("openWizard")&&(k.rootRemove("openWizard"),e.trigger("devicecreate",{objType:e.TYPE_MOBILE}))}).on("serverlost",function(){e.serverUp&&!e.serverWait&&j.onConnectionLost.call(e)}).on("change:objType",function(t,i){e.setUserData("objType",i)}).on("change:ivSessions",function(t,e){k.rootSet("ivSessions",e)})},loadServerFeatures:function(){var e=this,i=new t.Deferred,n=new t.Deferred,s=new t.Deferred,o=new t.Deferred;if(t.ajax({url:this.getBaseUrl()+"objects/get-csd-scan-allowed/",data:{}}).done(function(t){var i=t.modemUseMode,n=t.modemPhone||!1;e.set({isCsdScanAllowed:1===i||3===i,isSmsFromDevicesAllowed:(2===i||3===i)&&n})}).always(function(){n.resolve()}),t.ajax({url:this.getBaseUrl()+"reports/",data:{}}).done(function(t){j.setAvailableReports.call(e,t),s.resolve()}).fail(function(){e.set("availableReports",{}),s.resolve()}),t.ajax({url:this.getBaseUrl()+"zones-groups/zones-tree/",data:{order:"name"}}).done(function(t){j.setZones.call(e,t)}).fail(function(){j.setZones.call(e,[])}),this.allowed("alerts.edit")){var a=I.get("ru.ritm.use.external.rrt"),r=I.get("ru.ritm.allow.delegate");a="0"!==a&&!!a,r="0"!==r&&!!r,this.set({extGuardsAvailable:a,alarmDelegationAllowed:r}),a?o.resolve():this.hasGuards()?t.ajax({url:this.getResourceBaseUrl("guards")+"guards/ping/",data:{}}).done(function(){e.set("grGuardsAvailable",!0),o.resolve()}).fail(function(){o.resolve()}):o.resolve()}else o.resolve();return t.when(n,s,o).done(function(){i.resolve()}),i},onAccountReady:function(){var t=this,e=[],n=k.rootGet("ivSessions");n&&t.set("ivSessions",n,{silent:!0}),t._hasModules=e;var s=App.getUserData("objectsGrouping");if(s||(App.setUserData("objectsGrouping",{usedGrouping:!0,changeSize:!1}),App.trigger("objectsGroupingChange")),t.isAlarmOperator())e.push("alarms");else{t.hasMobile()&&(e.push("mobile"),this._objectsUpdateProvider=new d),t.hasStationary()&&e.push("stat"),e.length||(e=["mobile","stat"],this._objectsUpdateProvider=new d),(this.get("grGuardsAvailable")||this.get("extGuardsAvailable"))&&e.push("guards"),(t.isDemo()||t.allowed("zones.create")||t.allowed("zones.edit")||t.allowed("zones.delete"))&&e.push("geozones"),(t.reportsAllowed("mobile")||t.reportsAllowed("stat"))&&e.push("reports"),t.hasMobile()&&e.push("tracks"),(t.isDemo()||t.allowed("poi.create")||t.allowed("poi.edit")||t.allowed("poi.delete"))&&e.push("poi"),e.push("alarms"),t.allowed("objects.create")&&t.on("devicecreate",i.bind(j.openDeviceWizard,t)),t.on("needdevicevideo",function(e,i){"webrtc"===i||"ritmrtp"===i?j.openRitmVideo.call(t,e,i):"ivideon"===i?j.openIvideonVideo.call(t,e):"direct"===i&&j.openDirectVideo.call(t,e)}),t.allowed("objects.shell")&&e.push("setup");var o=t.getUserData("startWithDashboard");i.isBoolean(o)&&t.set("startWithDashboard",o),t.set("showAlertsLog",t.getUserData("showAlertsLog")===!0),t.on("change:startWithDashboard",function(e,i){t.setUserData("startWithDashboard",i)}).on("change:showAlertsLog",function(e,i){t.setUserData("showAlertsLog",i),i&&!t.modules.log?j.openAlertsLog.call(t):!i&&t.modules.log&&t.modules.log.destroy()});var a=t.getUserData("objType")||"mobile";t.hasModule(a)||(a="mobile"==a?"stat":"mobile"),t.set("objType",a)}t._hasModules=e,t._view.render(),j.addRoutes.call(t),j.processGETParams.call(t),j.buildModules.call(t),t.listenTo(I,"change:basic",function(t,e){var i=k.rootGet("user");i.basic=e,k.rootSet("user",i)}),j.setPingTimeout.call(t),(t.hasModule("reports")||t.hasModule("tracks"))&&(t.on("processorsubmit",function(e,i,n){t.once("buildstartsuccess",function(){t.closeProcessor()}),"tracks"==e?t.trigger("buildtrack",i.items||i.item&&[i.item],n):"reports"==e&&t.publish("needreport",i.objType,i.items||i.item&&[i.item],n)}).on("processorcancel",function(){t.closeProcessor()}),t.hasModule("tracks")&&t.on("needtrack",function(){j.onTrackRequested.apply(t,arguments)}),t.hasModule("reports")&&(t.on("needreport",function(){j.onReportRequested.apply(t,arguments)}),t.subscribe("reports.hiddenreportschange",function(){t._processor&&t._processor.renderReportsList()}),t.on("view:report",function(){t.getView().trigger("needleftwide",!0)}),t.subscribe("reports.viewlist",function(){t.getView().trigger("needleftwide",!1)}),t.subscribe("reports.ready",function(){t.on("tracksoptionchange",function(e,i){var n=t.modules.reports,s=n.get("options")||{};s.tracksSettings=s.tracksSettings||{},s.tracksSettings[e]=i,n.set("options",s),n.trigger("change:options",n,s)})})),t.subscribe("reports.needgeoinfo",function(e,i){t.modules.maps&&t.modules.maps.trigger("needgeoinfo",e,i)})),"/ritmVideo.html"===window.location.pathname&&t.setActiveModule("ritmVideo")},addRoutes:function(){var t=this;this.routes={},i.each(["mobile","stat","guards","geozones","poi","tracks","reports"],function(e){!function(e){var i={callback:function(){t.setActiveModule(e),t._view.trigger("needleftwide",!1)},context:t};t.routes[e]=i}(e)}),t.routes.ritmVideo={callback:function(){t.setActiveModule("ritmVideo")},context:t},M.addRoutes(this.routes)},processGETParams:function(){var t=this.getRouter(),e=t.getGETParams();this.set("paremetersFromGET",e),i.keys(e).length&&"replaceState"in window.history&&window.history.replaceState(null,null,t.getFullOrigin())},buildModules:function(){var t=this;if(this.isAlarmOperator()){var e=i.map(t._hasModules,function(t){return _[t]});return requirejs(e,function(){var e=0;i.each(arguments,function(i){j.buildModule.call(t,t._hasModules[e++],i)}),t.trigger("appready")}),void 0}var n=[{key:"address",name:p.address.ucFirst()},{key:"objects",name:p.objects.ucFirst()}];this.allowed("alerts.edit")&&n.push({key:"guards",name:p.rrTeamShort});var s;requirejs(["maps/MapsModule"],function(e){s=t.modules.maps=new e({id:"maps",container:t._view.getMapsContainer(),parent:t,compass:!0,ruler:!0,search:!0,searchTypes:n,routing:!0,traffic:!0,coords:!0,scale:!0,minimap:!1,print:!0,autozoom:!0,clearControl:!0})}),this.isVisitor()||requirejs(["dashboard/DashboardModule"],function(e){var i=t.modules.dashboard=new e({id:"dashboard",parent:t,active:t.get("startWithDashboard"),loading:!0,mobile:!0});t.listenTo(i,"change:active",function(e,i){t.modules.mobile&&(i?t.modules.mobile.trigger("stopwatching"):t.modules.mobile.trigger("startwatching"))})}),t.modules.ritmVideo={id:"ritmVideo",activate:function(){this.ritmVideo=l()},deactivate:function(){console.log("reactui deactivate")}},App.subscribe("maps.ready",{context:t,callback:function(){var e=t._hasModules;if(!e.length)return t.interceptCurrentRoute(),void 0;var n=i.map(e,function(t){return _[t]});requirejs(n,function(){var n=0;if(i.each(arguments,function(i){j.buildModule.call(t,e[n++],i)}),t.interceptCurrentRoute(),!t.getActiveModule()){var s=t.get("objType");t.modules[s]?t.setActiveModule(s):t.subscribe(s+".ready",function(){t.setActiveModule(s)})}t.trigger("appready")})}}),this.get("showAlertsLog")&&j.openAlertsLog.call(this)},buildModule:function(t,e){this.modules[t]=new e({id:t,container:"alarms"!=t&&"setup"!=t?this._view.getLeftPane():null,placeholder:this.getPlaceholder(t),parent:this,options:j.getModuleOptions.call(this,t)})},getModuleOptions:function(t){var e={},n={showPoints:k.get("tracks.showPoints")||0,colorTracks:k.get("tracks.colorTracks")||0,speedColors:k.get("tracks.speedColors")||["#0000ff","#00ff00","#ff0000"]},s=this.get("extGuardsAvailable"),o=this.get("alarmDelegationAllowed"),a=3e3;if(s)var r=new u(a);if("mobile"===t||"stat"===t||"guards"===t){var l,c=this.getSettings();e={mapsModule:this.modules.maps},"mobile"===t&&"mobileObjectsUpdatePeriod"in c&&(l=parseInt(c.mobileObjectsUpdatePeriod),e.updatePeriod=Math.min(Math.max(l,1e3),12e4)),"stat"===t&&"statObjectsUpdatePeriod"in c&&(l=parseInt(c.statObjectsUpdatePeriod),e.updatePeriod=Math.min(Math.max(l,5e3),3e5)),"guards"===t&&(e.updatePeriod=a,e.useExternalGuards=s,e.extGuardsDataSource=r)}else"geozones"===t?e={buildByPolyline:this.hasModule("tracks")}:"tracks"===t?e=i.extend({},n,{mapsModule:this.modules.maps,list:!0,addFromList:!0}):"reports"===t?e={mapsModule:this.modules.maps,addFromList:!0,scheduler:!this.isDemo(),tracksSettings:n}:"alarms"===t&&(e.alarmDelegationAllowed=o,e.useExternalGuards=s,e.extGuardsUpdatePeriod=a,e.extGuardsDataSource=r);return e},setPingTimeout:function(){var t=this;this._pingTmt=setTimeout(function(){j.pingServer.call(t)},b)},pingServer:function(){var t=this;this.modules.system.ping().done(function(){t._reconnectMsgShown&&(n.dialog.stack=[],n.dialog.close(),t._reconnectMsgShown=!1,t.trigger("serverup")),t._pingTmt&&clearTimeout(t._pingTmt),t._reconnectTries=0,t.serverUp=!0,t.serverWait&&(t.trigger("startall"),t.serverWait=!1),j.setPingTimeout.call(t)}).fail(function(){j.onConnectionLost.call(t)})},onConnectionLost:function(){var t=this;return this.serverUp&&(this.trigger("stopall"),this.serverUp=!1,this.serverWait=!0),++t._reconnectTries>w?(j.onReconnectFail.call(t),void 0):(t._pingTmt&&clearTimeout(t._pingTmt),t._pingTmt=setTimeout(function(){j.pingServer.call(t)},y),void 0)},onReconnectFail:function(){var t=this;return this._reconnectMsgShown?(this._pingTmt=setTimeout(function(){j.pingServer.call(t)},b),void 0):(this._reconnectMsgShown=!0,n.dialog.close(),n.dialog.stack=[],alert('<i class="svg-icon svg-icon-spinner icon-spin"></i> '+p.msgReconnecting,p.msgConnectionLost,{addClass:"no-controls",okCallback:function(){t._reconnectMsgShown=!1}}),this._pingTmt=setTimeout(function(){j.pingServer.call(t)},b),void 0)},setZones:function(t){this.set("zones",t);var e=[];t.forEach(function(t){t.items.forEach(function(t){e.push(t)})}),this.set("geozones",e)},setAvailableReports:function(t){var e={objst:{name:p.reportsNames.objst,objType:"mobilestat",group:"tech"},objservice:{name:p.reportsNames.objservice,action:"OBJSERVICE",objType:"mobilestat",group:"tech"},timeseries:{name:p.reportsNames.timeseries,objType:"mobile",group:"tech",singleObject:!0,maxDays:31},accesscard:{name:p.reportsNames.accesscard,objType:"mobile",group:"tech"},alertssummary:{name:p.reportsNames.alertssummary,action:"ALERTS",objType:"mobilestat",group:"history"},alerts:{name:p.reportsNames.alerts,objType:"mobilestat",singleObject:!0,group:"history"},alertjournal:{name:p.reportsNames.alertjournal,action:"FULLALERTJOURNAL",objType:"mobilestat",group:"history",maxDays:31},guardscallcount:{name:p.reportsNames.guardscallcount,action:"GUARDSCALLCOUNT",objType:"mobilestat",group:"history"},objjournal:{name:p.reportsNames.objjournal,action:"OBJJOURNAL",objType:"mobilestat",group:"history"},run:{name:p.reportsNames.run,objType:"mobile",group:"location"},runshort:{name:p.reportsNames.runShort,action:"RUN",objType:"mobile",group:"location"},movepark:{name:p.reportsNames.movepark,objType:"mobile",group:"location"},distance:{name:p.reportsNames.distance,action:"DISTANCETOOBJECT",objType:"mobile",group:"location"},speeding1b:{name:p.reportsNames.speeding,objType:"mobile",group:"safety"},speeding:{name:p.reportsNames.speeding2b,objType:"mobile",group:"safety"},acceleration:{name:p.reportsNames.acceleration,objType:"mobile",group:"safety"},drivesafety:{name:p.reportsNames.drivesafety,action:"DRIVESAFETY",objType:"mobile",group:"safety"},flow:{name:p.reportsNames.flow,objType:"mobile",group:"fuel"},fuelsum:{name:p.reportsNames.fuelsum,objType:"mobile",group:"fuel",action:"FUEL"},fuel:{name:p.reportsNames.fuel,objType:"mobile",group:"fuel"},fuel2:{name:p.reportsNames.fuel2,objType:"mobile",group:"fuel"},device:{name:p.reportsNames.device,objType:"mobile",group:"sensors"},device2:{name:p.reportsNames.device2,action:"DEVICERUN",objType:"mobile",group:"sensors"},can:{name:p.reportsNames.can,action:"CANDEVICERUN",objType:"mobile",group:"sensors"},discretes:{name:p.reportsNames.discretes,action:"DISCRETEPARAMETERS",objType:"mobile",group:"sensors"},temperature:{name:p.reportsNames.temperature,action:["OUTTEMP","COOLTEMP","DEVTEMP"],objType:"mobile",group:"sensors"},objtemp:{name:p.reportsNames.objtemp,action:"OBJTEMP",objType:"stat",group:"sensors"},voltage:{name:p.reportsNames.voltage,action:["CARPOWER","ACC"],objType:"mobile",group:"sensors"},engspeed:{name:p.reportsNames.engspeed,objType:"mobile",group:"sensors"},zoneviz:{name:p.reportsNames.zoneviz,objType:"mobile",group:"geozones"},zoneex:{name:p.reportsNames.zoneex,objType:"mobile",group:"geozones"},zonevizcount:{name:p.reportsNames.zonevizcount,objType:"mobile",group:"geozones"},pass:{name:p.reportsNames.pass,objType:"mobile",group:"special"},passmatrix:{name:p.reportsNames.passmatrix,objType:"mobile",group:"special"}};i.each(e,function(t,e){t.key=e});var n=i.indexBy(t),s={};n.FULLALERTJOURNAL="ALERTJOURNAL",this.set("reportsInBuild",n),i.each(e,function(t,e){var o=!0,a=t.action||e.toUpperCase();if("string"==typeof a)o=a in n;else{var r=i.filter(a,function(t){return t in n});t.action=r,o=r.length>0}o&&(s[e]=t)}),this.set("availableReports",s)},mergeBounds:function(t,e){if(!t||!t[0][0])return e&&e[0][0]?e:null;if(!e||!e[0][0])return t;var i=Math.min(t[0][0],e[0][0]),n=Math.min(t[0][1],e[0][1]),s=Math.max(t[1][0],e[1][0]),o=Math.max(t[1][1],e[1][1]);return[[i,o],[s,n]]},initBoundsWatching:function(){var t=this,e={};i.each(["stat","mobile"],function(i){t.hasModule(i)&&(e[i]=!1,function(i){t.listenTo(t.modules[i],"change:bounds",function(n,s,o){var a="mobile"==i?"stat":"mobile";if(e[i]=s,"undefined"==typeof e[a]||e[a]!==!1){var r=j.mergeBounds(s,e[a]);t.set("commonBounds",r),o&&o.zoom&&t.modules.maps.setBounds(r,{maxZoom:t.get("commonBoundsMaxZoom"),padding:t.get("commonBoundsPadding")})}})}(i))})},logout:function(){k.rootRemove("user"),g(this.getRMCookieName()),window.location.href=this.getRouter().getFullOrigin()},_publishOnce:function(t,e,i){e.callback.apply(e.context||this,i)},_publishAll:function(t){for(var e,i=Array.prototype.slice.call(arguments,1),n=[],s=(D[t]||[]).slice(0),o=0,a=s.length;a>o;o++)e=s[o],e&&n.push(e.callback.apply(e.context||this,i));return n},openDeviceWizard:function(t){if(!L){var e=this;requirejs(["_common/wizards/ObjAddWizard"],function(n){L=new n(i.extend({id:"objAddWizard"},t||{})),e.listenToOnce(L,"objectadded",function(t){var i="",n=null;if(t.objType==e.TYPE_MOBILE?e.hasModule("mobile")?n=e.modules.mobile:i="mobile":e.hasModule("stat")?n=e.modules.stat:i="stationary",i){var s=k.rootGet("user");s["has"+i.ucFirst()]=!0,k.rootSet("user",s),window.location.href=e.getRouter().getFullOrigin()}else n.trigger("itemadded",t)}).listenToOnce(L,"destroy",function(t){var i=L.pick("addAndSetup","addToAccount","objType","email");L=null,t&&j.openDeviceWizard.call(e,i)})})}},openDirectVideo:function(t){if(!this.modules.deviceVideo){var e=this;requirejs(["_common/deviceVideo/DirectVideoController"],function(i){var n=e.modules.deviceVideo=new i({id:"deviceVideo",device:t.clone()});e.listenToOnce(n,"destroy",function(){e.modules.deviceVideo=null})})}},openRitmVideo:function(t,e){if(!this.modules.deviceVideo){var i,n=this;return"ritmrtp"===e&&(i="RtpVideoController"),i?(requirejs(["_common/deviceVideo/"+i],function(e){var i=n.modules.deviceVideo=new e({id:"deviceVideo",device:t.clone()});n.listenToOnce(i,"deviceVideoDestroy",function(){n.modules.deviceVideo=null})}),void 0):console.error("No controller for video of type "+e)}},openIvideonVideo:function(t){if(!this.modules.deviceVideo){var e=this;requirejs(["_common/deviceVideo/IvideonVideoController"],function(i){var n=e.modules.deviceVideo=new i({id:"deviceVideo",device:t.clone()});e.listenToOnce(n,"destroy",function(){e.modules.deviceVideo=null})})}},openAlertsLog:function(){if(!this.modules.log&&this.isHistoryAllowed()){var t=this;requirejs(["_common/log/LogController"],function(e){var i=t.modules.log=new e({id:"log"});t.listenToOnce(i,"destroy",function(){t.modules.log=null})})}},onReportRequested:function(t){if(this.modules.reports&&(t||(t=this.get("objType")),this.modules[t])){var e,n;if(1==arguments.length?(e=null,n=null):2==arguments.length?i.isArray(arguments[1])?(e=arguments[1],n=null):(e=null,n=arguments[1]):(e=arguments[1],n=arguments[2]),this._processor||this.getActiveModule()==this.modules.reports||M.go("#reports"),e&&n||n&&n.objectId)return this.publish("needreport",t,e,n),void 0;var s=this.modules.reports,o=s.getUserReportsTypes(),a={},r=!0;if(i.keys(o).length){if(!e){this.reportsAllowed("mobile")&&this.reportsAllowed("stat")&&(r=!1),this.reportsAllowed(t)||(t="mobile"==t?"stat":"mobile");var l=this.modules[t];if(e=l.getWatchedObjects(),!e||!e.length)return this.trigger("unblockmap"),alert(p["stat"==t?"noWatchedStationaryMsg":"noWatchedVehiclesMsg"])}var c=s.getUserData("choosedType")||!1,d=s.getHiddenReports();
-1!=i.indexOf(d,c)&&(c=!1),e.length>1?i.each(o,function(t,e){t.singleObject||(a[e]=t)}):a=o,n={model:this,report:!0,reportTypes:a,choosedType:c,objType:t,objectsDefined:r,adding:!1,items:e},this._processor&&this._processor.close(),this.setProcessor(new h(n))}}},onTrackRequested:function(){if(this.modules.tracks){this._processor||this.getActiveModule()==this.modules.tracks||M.go("#tracks");var t,e;if(arguments.length?1==arguments.length?i.isArray(arguments[0])?(t=arguments[0],e=null):(t=null,e=arguments[0]):(t=arguments[0],e=arguments[1]):(t=null,e=null),t&&e||e&&e.objectId){var n=x;return t&&t.length>n||e&&e.objectId&&e.objectId.length>n?alert(p.tooManyObjectsForTracks.replace("#max#",n),p.attention+"!"):(this.trigger("buildtrack",t,e),void 0)}if(!t){var s=(this.get("objType"),this.modules.mobile);if(t=s.getWatchedObjects(),!t||!t.length)return this.trigger("unblockmap"),alert(p.noWatchedObjectsMsg)}if(t.length>x)return alert(p.tooManyObjectsForTracks.replace("#max#",x),p.attention+"!");e={model:this,track:!0,adding:!1,items:t,objType:"mobile",objectsDefined:!0},this._processor&&this._processor.close(),this.setProcessor(new h(e))}},searchObjects:function(e,i){var n=this,s=t.Deferred();return i&&i.id?(s.resolve([i]),s):(t.ajax({url:this.getBaseUrl()+"objects/obj-search/",timeout:5e3,data:{q:""+e.q,limit:parseInt(e.limit)},success:function(t){try{s.resolve(j.parseObjectsSearchJSON.call(n,t,e))}catch(i){s.reject({msg:i})}},error:function(t,e,i){s.reject({msg:e+": "+i})}}),s)},parseObjectsSearchJSON:function(t,e){if(!e.mapSearch)return t;for(var i=[],n=0,s=t.length;s>n;++n)t[n].lat&&t[n].lon&&i.push(t[n]);return i},suggestObjects:function(){var e=this,i=t.Deferred(),n=j.searchObjects.apply(this,arguments);return n.done(function(t){try{var n=j.parseObjectsSuggestJSON.call(e,t);i.resolve(n)}catch(s){i.reject({msg:s})}}).fail(function(){i.reject.apply(i,arguments)}),i},parseObjectsSuggestJSON:function(e){return t.map(e,function(t){var e="#"+t.extId+" "+t.name;return{label:e,value:t.name,original:t}})}};return v.defaults={textVisible:!0,textOnly:!1,html:"<div class='loader'><span class='indicator icon-spin svg-icon svg-icon-spinner'></span><strong>"+p.pleaseWait+"</strong>"+"</div>",text:""},i.extend(v.prototype,{_createHtml:function(){this._el=t(v.defaults.html).appendTo("#page")},show:function(e){var i=t.extend({},v.defaults,e||{});++this._showCalls,this._el?this._el.removeClass("hidden"):this._createHtml(),i.textVisible?i.textOnly&&this._el.addClass("text-only"):this._el.find("strong").remove(),i.text&&this.element.find("strong").text(i.text),t("#page").addClass("overlay")},hide:function(){--this._showCalls<=0&&(this._el&&this._el.addClass("hidden"),t("#page").removeClass("overlay"),this._showCalls<0&&(this._showCalls=0))}}),O}),define("system/nls/system",{root:{pleaseCheckFile:"Please check if the #filename# file is in the config folder",canNotLoadServerSettings:"Failed to establish a connection. Please try again later.",pleaseSetHost:'Please fill in the "host" setting in',about:"About the system",version:"Version",thanksForUsing:"Thank you for choosing the GeoRITM system!",resetPassword:"Password recovery",resetPasswordCmd:"Recover",resetPasswordHelpText:"You can restore your password yourself if your email was used as a login. Otherwise contact the person who provided you the login and the password for the system.",resetPasswordSuccessText:"An email with the data for password restore was sent to your email address.",passForEnter:"Login password",repeatPassForEnter:"Repeat password",changePassword:"Change password",oldPassword:"Old password",newPassword:"New password",repeatNewPassword:"Repeat new password",errPass:"Enter password",errNewPass:"Enter new password",errPassLength:"Maximum password length is #max# characters",errPassCyr:"The password can not contain cyrillic letters",errPassColon:"The password can not contain colon",pleaseFillAllFields:"Please fill in all fields",oldPasswordIsWrong:"Invalid old password",errPassRepeat:"Please repeat the password correctly",pleaseRepeatCorrectly:"Please repeat new password",passChangeFailed:"Failed to change the password (server error)",adminConsole:"Administration",tipsOfTheDay:"Insight into the system"},"ru-ru":!0,"it-it":!0}),define("system/nls/ru-ru/system",{pleaseCheckFile:"Пожалуйста, проверьте наличие файла #filename# в папке config",canNotLoadServerSettings:"Не удалось установить соединение. Пожалуйста повторите попытку позже.",pleaseSetHost:'Пожалуйста, заполните настройку "host" в',about:"О системе",version:"Версия",thanksForUsing:"Благодарим Вас за использование системы GeoRITM.",resetPassword:"Восстановление пароля",resetPasswordCmd:"Восстановить",resetPasswordHelpText:"Восстановить пароль самостоятельно можно, если в качестве логина Вы используете свой e-mail. Если это не так, обратитесь за помощью к тому, кто выдал Вам логин и пароль для доступа к системе.",resetPasswordSuccessText:"На&nbsp;Ваш&nbsp;адрес электронной&nbsp;почты отправлено&nbsp;письмо с&nbsp;данными для&nbsp;восстановления пароля.",passForEnter:"Пароль для входа",repeatPassForEnter:"Повторите пароль",changePassword:"Сменить пароль",oldPassword:"Старый пароль",newPassword:"Новый пароль",repeatNewPassword:"Повторите новый пароль",errPass:"Введите пароль",errNewPass:"Введите новый пароль",errPassLength:"Максимальная длина пароля - #max# символов",errPassCyr:"Пароль не может содержать кириллицу",errPassColon:"Пароль не может содержать двоеточие",pleaseFillAllFields:"Пожалуйста, заполните все поля",oldPasswordIsWrong:"Старый пароль введен неверно",errPassRepeat:"Повторите пароль правильно",pleaseRepeatCorrectly:"Пожалуйста, повторите новый пароль правильно",passChangeFailed:"Сменить пароль не удалось (ошибка сервера)",adminConsole:"Администрирование",tipsOfTheDay:"Знакомство с системой"}),define("system/SystemModule",["underscore","jquery","jface","abstracts/Module","i18n!_common/nls/common","i18n!system/nls/system"],function(t,e,i,n,s,o){var a="server.json",r="skin.json",l="version.json",c={server:null,ui:null},h=null,d="",u=n.extend({constructor:function(){this._settingsView=null,n.apply(this,arguments)},initialize:function(){var i=this;this._i18n=e.extend({},s,o),p.loadServerSettings().done(function(e){var n=e;App.setBaseUrl(App.buildBaseUrl(e)),App.loading("show"),p.loadUIVersion.call(i).done(function(t){c.ui=t}),p.validateServer.call(i,e).done(function(e){d=e.version,c.server=n,App.serverUp=!0,p.loadServerSkin().done(function(e){t.extend(c.server,e),p.onSkinResolve.call(i)}).fail(function(){p.onSkinResolve.call(i)})}).fail(function(t){alert(t,i._i18n.error.ucFirst(),{addClass:"no-controls",okCallback:function(){i.initialize()}})}).always(function(){App.loading("hide")})}).fail(function(){alert(i._i18n.canNotLoadServerSettings,i._i18n.error.ucFirst())})},ping:function(t){return t||c.server?(t=t||c.server,e.ajax({method:"post",timeout:5e3,url:(t.protocol||"http")+"://"+t.host+(t.port?":"+t.port:"")+(t.connector?"/"+t.connector:"")+"/ping/"})):(new e.Deferred).reject("No server settings")},showSettings:function(){if(!this._settingsView){var t=this;return requirejs(["system/views/SettingsView"],function(e){t._settingsView=new e({model:t}),t._settingsView.show()}),void 0}this._settingsView.show()},hideSettings:function(){this._settingsView&&this._settingsView.hide()},flushSettings:function(){App.getStorage().flush(),window.location.href=App.getRouter().getFullOrigin()},getVersion:function(){return d},getSettingsView:function(){return this._settingsView},getServerSettings:function(){return c.server},getUISettings:function(){return c.ui},getTexts:function(){return this._i18n}}),p={loadServerSettings:function(){return e.ajax({url:"./config/"+a,method:"GET",type:"GET",cache:!1,crossDomain:!1,processData:!0})},validateServer:function(t){var i=new e.Deferred;if(!t.host)return i.reject(this._i18n.pleaseSetHost+" config/"+a),i;var n=this;return this.ping(t).done(function(t){i.resolve(t)}).fail(function(t,e){switch(e){case"timeout":i.reject(n._i18n.errors.serverConnectionTimeout);break;default:i.reject(n._i18n.errors.serverConnection)}}),i},loadServerSkin:function(){return e.ajax({url:"./config/"+r,method:"GET",type:"GET",cache:!1,crossDomain:!1,processData:!0})},onSkinResolve:function(){var t=this,e=c.server,i=["system/auth/AuthModule"];e.skinUrl&&i.push("css!"+e.skinUrl),App.subscribe("authsuccess",function(e,i){!i||i.login!=e.extId&&i.login!=e.username||(e.isDemo=1),p.start.call(t,e)}),requirejs(i,function(e){e.set("parent",t)}),t.publish("ready")},loadUIVersion:function(){return e.ajax({url:"./"+l,method:"GET",type:"GET",cache:!1,crossDomain:!1,processData:!0})},start:function(t){var i=this;h=t,e.ajaxSetup({statusCode:{401:function(){App.trigger("logout")}},beforeSend:function(t,e){"undefined"!=typeof e.data&&null!==e.data&&(e.data=JSON.stringify(e.data)),"GET"==e.type&&(e.type="POST"),t.setRequestHeader("Accept-Language",LOCALE),t.setRequestHeader("Authorization","Basic "+h.basic)}}),requirejs(["system/account/AccountModule","system/demo/DemoModule"],function(t,e){i.modules.account=new t({id:"system/account",parent:i,user:h,isDemo:h.isDemo||!1}),i.listenTo(i.modules.account.getAccount(),"change:basic",function(t,e){p.setBasic(e)}),new e({id:"system/demo",parent:i,isDemo:h.isDemo||!1})})},setBasic:function(t){h.basic=t}};return u}),define("text!system/auth/tmpl/authForm.html",[],function(){return'<form class="auth-form login-form" method="post" action="">\n    <div class="box-header">\n        <h2><%= i18n.authorization.ucFirst() %></h2>\n    </div>\n    <div class="box-content">\n        <div class="control-group">\n            <label class="control-label"><%= i18n.username.ucFirst() %></label>\n            <input type="text" class="input-block-level" name="login" value="">\n        </div>\n        <div class="control-group">\n            <label class="control-label"><%= i18n.password.ucFirst() %></label>\n            <input type="password" class="input-block-level" name="password" value="">\n        </div>\n        <% if(isRememberMeAllowed) {%>\n        <label class="checkbox"><input type="checkbox" name="remember" value="1"> <%= i18n.rememberMe.ucFirst()\n            %></label>\n        <% } %>\n    </div>\n    <div class="box-footer">\n        <% if(demo) {%>\n        <div class="row-fluid">\n            <button class="btn btn-primary span9" type="submit"><%= i18n.signIn %></button>\n            <a href="javascript:;" id="btn-demo-login" class="btn span3"><%= i18n.demo %></a>\n        </div>\n        <% } else {%>\n        <button class="btn btn-block btn-primary" type="submit"><%= i18n.signIn %></button>\n        <% } %>\n    </div>\n    <a class="extra-action reset-link hidden" href="#"><%= i18n.resetPassword %></a>\n    <a class="extra-action reg-link hidden" href="#"><%= i18n.registration %></a>\n</form>\n'}),define("text!_common/tmpl/lang.html",[],function(){return'<li class="dropdown">\n    <a href="#" class="dropdown-toggle" data-toggle="dropdown">\n        <svg class="svg-icon">\n            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#smb-lang"></use>\n        </svg>\n        <%= !compact ? curLang : \'\' %><b class="caret"></b>\n    </a>\n    <ul class="dropdown-menu nav nav-list">\n        <li<% if(locale==\'ru-RU\') {%> class="active"<% } %>><a data-locale="ru-RU" href="javascript:;">Русский</a></li>\n        <li<% if(locale==\'en-US\') {%> class="active"<% } %>><a data-locale="en-US" href="javascript:;">English</a></li>\n        <li<% if(locale==\'it-IT\') {%> class="active"<% } %>><a data-locale="it-IT" href="javascript:;">Italiano</a></li>\n    </ul>\n</li>'}),define("text!system/auth/tmpl/nav.html",[],function(){return'<ul id="lang-nav" class="nav pull-right">\n    <%= langDropdown %>\n</ul>\n<div id="data-host" class="pull-right">\n    ip/host: <strong class="value"><%= dataHost %></strong>, v: <strong class="value"><%= version %></strong>\n</div>\n'}),define("text!system/auth/tmpl/autoreg.html",[],function(){return'<div class="auth-container reg-container hidden">\n    <form class="auth-form reg-form" method="post" action="">\n        <div class="box-header">\n            <h2><%= i18n.registration %></h2>\n        </div>\n        <div class="box-content">\n            <div class="control-group">\n                <label class="control-label"><%= i18n.firstName %></label>\n                <input type="text" class="input-block-level" name="fname" value="" maxlength="50">\n            </div>\n            <div class="control-group">\n                <label class="control-label"><%= i18n.surname %></label>\n                <input type="text" class="input-block-level" name="sname" value="" maxlength="50">\n            </div><div class="control-group">\n                <label class="control-label">E-Mail (<%= i18n.login %>)</label>\n                <input type="text" class="input-block-level" name="email" value="" maxlength="50">\n            </div><div class="control-group">\n                <label class="control-label"><%= i18n.phoneNumber %></label>\n                <input type="text" class="input-block-level" name="phone" value="" maxlength="20">\n            </div><div class="control-group">\n                <label class="control-label"><%= i18n.company %></label>\n                <input type="text" class="input-block-level" name="company" value="" maxlength="255">\n            </div><div class="control-group">\n                <label class="control-label"><%= i18n.passForEnter %></label>\n                <input type="password" class="input-block-level" name="password" value="" maxlength="50">\n            </div><div class="control-group">\n                <label class="control-label"><%= i18n.repeatPassForEnter %></label>\n                <input type="password" class="input-block-level" name="passwordRepeat" value="" maxlength="50">\n            </div><div class="control-group">\n                <label class="control-label"><%= i18n.secretWord %></label>\n                <input type="text" class="input-block-level" name="secret" value="" autocomplete="off" maxlength="100">\n            </div>\n            <div class="control-group captcha"></div>\n            <div class="control-group ua">\n                <label class="checkbox control-label">\n                    <input type="checkbox" name="acceptUA" value="1">\n                    <%= i18n.iAcceptUserAgreement.replace(\'#t#\', \'<a target="_blank" href="http://www.ritm.ru/agreement/">\'+i18n.ofUsersAgreement+\'</a>\') %>\n                </label>\n            </div>\n        </div>\n        <div class="box-footer">\n            <button class="btn btn-block btn-primary" type="submit" disabled><%= i18n.registerMe %></button>\n        </div>\n        <a class="extra-action login-link" href="#"><%= i18n.enterWithPass %></a>\n    </form>\n</div>\n'}),define("text!system/auth/tmpl/resetPassword.html",[],function(){return'<div class="auth-container reset-container hidden">\n    <form class="auth-form reset-form" method="post" action="">\n        <div class="box-header">\n            <h2><%= i18n.resetPassword %></h2>\n        </div>\n        <div class="box-content">\n            <div class="control-group no-margin">\n                <label class="control-label">\n                    E-Mail (<%= i18n.login %>)\n                    <i class="svg-icon svg-icon-circle-info hint hint-top" data-hint="<%= i18n.resetPasswordHelpText %>"></i>\n                </label>\n                <input type="text" class="input-block-level" name="email" value="" maxlength="50" autocomplete="off">\n            </div>\n        </div>\n        <div class="box-footer">\n            <button class="btn btn-block btn-primary" type="submit" disabled><%= i18n.resetPasswordCmd %></button>\n        </div>\n        <a class="extra-action login-link" href="#"><%= i18n.enterWithPass %></a>\n    </form>\n</div>'}),define("text!system/auth/tmpl/captcha.html",[],function(){return'<label class="control-label"><%= i18n.captcha %></label>\n<i class="captcha-reload svg-icon svg-icon-reload" title="<%= i18n.captchaReload %>"></i>\n<img src="<%= captcha %>" alt="" />\n<input type="text" class="input-small no-margin" name="captcha-answer" value="" autocomplete="off" maxlength="10">\n'}),define("text!system/auth/tmpl/ua.html",[],function(){return"<p>Условия бесплатного использования сервиса geo.ritm.ru</p>\n<ol>\n    <li>Общие положения\n        <ol>\n            <li>Бесплатная регистрация на сервисе geo.ritm.ru (далее Сервис) дает возможность подключения и мониторинга одним Пользователем трех мобильных объектов, оборудованных системой мониторинга Voyager.</li>\n            <li>Для того чтобы воспользоваться Сервисом или некоторыми отдельными функциями Сервиса, Пользователю необходимо принять данное Соглашение.</li>\n        </ol>\n    </li>\n	<li>Регистрация\n        <ol>\n            <li>Для регистрации Пользователь обязуется предоставить достоверную и полную информацию о себе по вопросам, предлагаемым в форме регистрации.</li>\n            <li>Сервис оставляет за собой право в любой момент потребовать от Пользователя подтверждения данных, указанных при регистрации (в частности адрес электронной почты и номер телефона), не предоставление которых, по усмотрению сервиса, может быть приравнено к предоставлению недостоверной информации и повлечь блокирование учетной записи или удаление данных пользователя.</li>\n            <li>Пользователь не вправе воспроизводить, повторять и копировать, продавать и перепродавать, а также использовать для каких-либо коммерческих целей какие-либо части Сервиса (включая контент, доступный Пользователю посредством Сервиса), или доступ к нему. </li>\n        </ol>\n    </li>\n	<li>Данные Пользователя\n        <ol>\n            <li>Сервис собирает два типа данных Пользователя\n                <ol>\n                    <li>Информацию, которую Пользователь сознательно предоставил Администрации Сервиса при регистрации, подключении и настройке объекта.</li>\n                    <li>Техническую информацию от мобильного объекта, собираемую программным обеспечением в автоматическом режиме о его местоположении и состоянии подключенного оборудования.</li>\n                </ol>\n            </li>\n            <li>Пользователь самостоятельно несет ответственность за корректность данных, вводимых им в процесс использования Сервиса, а также за соответствие вводимых данных требованиям действующего законодательства, включая ответственность перед третьим лицами в случаях, когда Пользователь вводит данные, не имеющие к нему прямого отношения (например, данные третьих лиц), или нарушает права и законные интересы третьих лиц.</li>\n            <li>Пользователь признает и соглашается с тем, что Сервис не обязан проверять вводимые Пользователем данные на предмет их корректности.</li>\n            <li>Пользователь осознает и соглашается с тем, что Сервис использует вводимые Пользователем данные для подготовки запрошенных Пользователем отчетов и оповещения Пользователя.</li>\n            <li>Пользователь осознает и соглашается с тем, что Сервис может сохранять и использовать обезличенную техническую информацию, полученную в результате работы объекта для исследований в целях улучшения качества Сервиса и предоставления дополнительных услуг.</li>\n        </ol>\n    </li>\n	<li>Условия использования сервиса\n        <ol>\n            <li>Сервис оставляет за собой право ограничивать срок хранения данных Пользователя, ограничивать доступ к функциям, отчетам и другим возможностям Сервиса.</li>\n            <li>Пользователь самостоятельно несет ответственность перед третьими лицами за свои действия, связанные с использованием Сервиса, в том числе, если такие действия приведут к нарушению прав и законных интересов третьих лиц, а также за соблюдение законодательства при использовании Сервиса.</li>\n            <li>При использовании сервиса Пользователь не вправе:\n                <ol>\n                    <li>Выдавать себя за другого человека или представителя организации и/или сообщества без достаточных на то прав;</li>\n                    <li>Несанкционированно собирать и хранить персональные данные других лиц;</li>\n                    <li>Нарушать нормальную работу Сервиса;</li>\n                    <li>Содействовать действиям, направленным на нарушение ограничений и запретов, налагаемых Соглашением;</li>\n                    <li>Другим образом нарушать нормы законодательства, в том числе нормы международного права. </li>\n                </ol>\n            </li>\n        </ol>\n    </li>\n	<li>Исключительные права на содержание сервисов и контент\n        <ol>\n            <li>Все объекты, доступные при помощи Сервиса, в том числе элементы дизайна, текст, графические изображения, базы данных, готовые документы в форматах XLS, XLSX, DOC, DOCX, PDF и другие объекты, а также любой контент, размещенный в Сервисе, являются объектами исключительных прав Сервиса и других правообладателей.</li>\n            <li>Использование Сервиса, а также каких-либо иных элементов Сервиса возможно только в рамках функционала Сервиса. Никакие элементы содержания Сервиса, а также любой контент, размещенный на сервисах, не могут быть использованы иным образом без предварительного разрешения. Исключение составляют случаи, прямо предусмотренные законодательством РФ или условиями использования Сервиса.</li>\n            <li>Использование Пользователем элементов содержания Сервиса, а также любого контента для личного некоммерческого использования допускается при условии сохранения всех знаков охраны авторского права, смежных прав, товарных знаков, других уведомлений об авторстве, сохранения имени (или псевдонима) автора/наименования правообладателя в неизменном виде, сохранении соответствующего объекта в неизменном виде.</li>\n        </ol>\n    </li>\n	<li>Ограничение ответственности\n        <ol>\n            <li>Пользователь использует сервис на свой собственный риск. Сервис предоставляется «как есть». Сервис не принимает на себя никакой ответственности, в том числе за соответствие Сервиса целям Пользователя.</li>\n            <li>Сервис не гарантирует, что он соответствует/будет соответствовать требованиям Пользователя, что Сервис будет предоставляться непрерывно, быстро, надежно и без ошибок.</li>\n            <li>Любые информацию и/или материалы (в том числе загружаемые документы, письма, какие-либо инструкции и руководства к действию и т.д.), доступ к которым Пользователь получает с использованием Сервиса, Пользователь может использовать на свой собственный страх и риск и самостоятельно несет ответственность за возможные последствия использования указанных информации и/или материалов, в том числе за ущерб, который это может причинить Пользователю или третьим лицам, за потерю данных, времени, денежных средств или любой другой вред.</li>\n            <li>Сервис не несет ответственности за любые виды убытков, произошедшие вследствие использования Пользователем Сервиса или отдельных частей/функций Сервиса.</li>\n        </ol>\n    </li>\n	<li>Иные положения\n        <ol>\n            <li>Ввиду безвозмездности услуг, оказываемых в рамках настоящего Соглашения, нормы о защите прав потребителей, предусмотренные законодательством Российской Федерации, не могут быть применимы к отношениям между Пользователем и Сервисом.</li>\n            <li>Если по тем или иным причинам одно или несколько положений настоящего Соглашения будут признаны недействительными или не имеющими юридической силы, это не оказывает влияния на действительность или применимость остальных положений Соглашения.</li>\n            <li>Администрация сервиса оставляет за собой право вносить изменения в вышеуказанные правила без предварительного уведомления.</li>\n            <li>Правила вступают в силу автоматически после регистрации Пользователя в системе.</li>\n        </ol>\n    </li>\n\n</ol>"}),define("text!system/auth/tmpl/regSuccess.html",[],function(){return'<div class="auth-container" id="reg-success">\n    <h3><%= i18n.thankYou %>!</h3>\n    <p><%= i18n.regSuccess.replace(\'#t#\', t) %></p>\n    <a href="javascript:;" class="btn login-link btn-primary"><%= i18n.authorization %></a>\n</div>'}),define("system/auth/views/AuthView",["jquery","underscore","util","jface","bootstrap","abstracts/View","text!system/auth/tmpl/authForm.html","text!_common/tmpl/lang.html","text!system/auth/tmpl/nav.html","text!system/auth/tmpl/autoreg.html","text!system/auth/tmpl/resetPassword.html","text!system/auth/tmpl/captcha.html","text!system/auth/tmpl/ua.html","text!system/auth/tmpl/regSuccess.html","css!system/auth/css/login.css"],function(t,e,i,n,s,o,a,r,l,c,h,d,u,p){a=e.template(a),r=e.template(r),d=e.template(d);var m=!1,f=o.extend({constructor:function(){this.$loginContainer=null,this.$regContainer=null,this.$resetContainer=null,this.$resetPasswordLink=null,this._captchaKey="",o.apply(this,arguments)},render:function(){var i=this.model.i18n(),n=this.model.getDemoData(),s=App.getServerSettings(),o=s.techInfoHtml||"",c="authTmpl"in s?s.authTmpl:"system/auth/tmpl/auth.html";e.isArray(o)&&(o=o.join("<br />")),requirejs(["text!"+c],function(t){var s=e.template(t,{i18n:i,techInfoHtml:o,formHtml:a({i18n:i,demo:n,isRememberMeAllowed:App.isRememberMeAllowed()})});this.$el.html(s).appendTo("#page"),g.onAfterRender.call(this)}.bind(this));var h=e.template(l,{langDropdown:r({compact:!1,curLang:App.getLocaleName(),locale:App.getLocale()}),dataHost:s.host,version:App.getVersion()});t("#main-hdr .navbar-inner").append(h),t(document).on("click.locale","[data-locale]",function(){var e=t(this).data("locale");App.publish("localechange",e)})}}),g={login:function(e,i){var n=this,s=this.model.i18n();n.$el.addClass("loading"),n.model.authorize(e,i).done(function(e){if(e.id){n.$el.remove(),t("#lang-nav, #data-host").remove(),t(document).off("click.locale");var i=n.model.getDemoData(),o=!1;App.isRememberMeAllowed()&&(o=n.$el.find("input[name=remember]").prop("checked")),App.publish("authsuccess",e,i,o)}else alert("No user data in response",s.error.ucFirst())}).fail(function(e,i,n){if("timeout"==i)var o=s.error.ucFirst(),n=s.errors.serverConnectionTimeout;else{var o=e.status?e.status+": ":"";try{var a=t.parseJSON(e.responseText),n=a.msg;a.data&&a.data.logout&&App.trigger("logout"),o+=a.hdr}catch(r){var n=n||s.errors.callServerFailed;404==e.status&&(n=authUrl+"<br />"+n),o+=s.error.ucFirst()}}alert(n,o)}).always(function(){n.$el.removeClass("loading")})},onAfterRender:function(){var e=this,i=this.model.i18n(),n=this.model.getDemoData(),s=App.getServerSettings();this.$el.find("input[name=login]").focus();var o=this.$loginContainer=this.$el.find(".login-container"),a=o.find("form");("undefined"==typeof s.registration||1==s.registration)&&t.ajax({url:this.model.getCMBaseUrl()+"ping/"}).done(function(){m=!0,g.initRegistration.call(e),g.initResetPassword.call(e)}),a.on("submit",function(){var t=a.find("input[name=login]").val(),n=a.find("input[name=password]").val();return t&&n?(g.login.call(e,t,n),!1):alert(i.enterLoginAndPass,i.error.ucFirst(),{okCallback:function(){e.$loginContainer.find("input[name="+(t?"password":"login")+"]").focus()}})}),n&&t("#btn-demo-login").on("click",function(){return g.login.call(e,n.login,n.password),!1})},initRegistration:function(){var t=this;this.$el.find(".reg-link").removeClass("hidden").on("click",function(){t.$regContainer||g.buildRegistration.call(t),t.$loginContainer.addClass("hidden"),t.$regContainer.removeClass("hidden").find("input:first").focus()}),this.$el.on("click",".login-link",function(){t.$regContainer&&t.$regContainer.addClass("hidden"),t.$resetContainer&&t.$resetContainer.addClass("hidden"),t.$loginContainer.removeClass("hidden").find("input:first").focus()})},buildRegistration:function(){var i=this,n=this.model.i18n(),s=e.template(c,{i18n:n});this.$el.append(s);var o=this.$regContainer=this.$el.find(".reg-container"),a=o.find("form"),r=a.find("[type=submit]");g.renderCaptcha.call(this,a),this.$el.on("click",".captcha-reload",function(){showCursor(),g.getCaptcha.call(i).done(function(t){i._captchaKey=t.key||"",i.$el.find("img")[0].src=t.img}).always(hideCursor)}).on("click","[name=acceptUA]",function(){r.prop("disabled",!this.checked)}),a.on("submit",function(){a.addClass("loading").find(".error").removeClass("error");var n=i.model.i18n(),s=a.serializeObject(!0);return s["captcha-key"]=i._captchaKey,i.model.register(s).done(function(s){a[0].reset(),i.$el.find(".reg-link").remove(),i.$regContainer.addClass("hidden"),t(e.template(p,{i18n:n,t:Date.format(n.DateTime.longFormat,s.confirmTill)})).appendTo(i.$el),t("#reg-success").on("click",".login-link",function(){t("#reg-success").remove(),i.$loginContainer.removeClass("hidden").find("input:first").focus()})}).fail(function(t){g.showErrors.call(i,t,a)}).always(function(){a.removeClass("loading")}),!1})},initResetPassword:function(){var t=this;this.$resetPasswordLink=this.$el.find(".reset-link"),this.$resetPasswordLink.removeClass("hidden").on("click",function(){t.$resetContainer||g.buildResetPassword.call(t),t.$loginContainer.addClass("hidden"),t.$regContainer&&t.$regContainer.addClass("hidden"),t.$resetContainer.removeClass("hidden").find("input:first").focus()})},buildResetPassword:function(){var t=this,i=this.model.i18n(),n=e.template(h,{i18n:i});this.$el.append(n);var s=this.$resetContainer=this.$el.find(".reset-container"),o=s.find("form"),a=o.find("input[name=email]"),r=o.find("button[type=submit]");a.on("keyup",function(){var e=t.model.validateEmail(this.value);null===e?r.prop("disabled",!1):r.prop("disabled",!0)}),o.on("submit",function(){o.addClass("loading").find(".error").removeClass("error");var e=t.model.i18n(),i=o.serializeObject();return t.model.startResetPassword(i).done(function(){o.addClass("hidden")[0].reset(),r.prop("disabled",!0),t.$loginContainer.removeClass("hidden").find("input:first").focus(),alert(e.resetPasswordSuccessText,e.thankYou)}).fail(function(e){g.showErrors.call(t,e,o)}).always(function(){o.removeClass("loading")}),!1})},showErrors:function(i,n){var s=this.model.i18n();if(e.isArray(i)){var o=[];e.each(i,function(t){n.find("[name="+t.key+"]").closest(".control-group").addClass("error"),t.msg&&o.push(t.msg+".")}),alert(o.join("<br />"),s.error,{closeCallback:function(){n.find(".control-group.error:first input").focus()}})}else if(i.responseText){var a;(a=t.parseJSON(i.responseText))?alert(a.msg,a.hdr||s.error):alert(s.errors.callServerFailed,s.error)}else alert(s.errors.callServerFailed,s.error)},renderCaptcha:function(t){var e=this,i=this.model.i18n();g.getCaptcha.call(this).done(function(n){e._captchaKey=n.key||"",t.find(".captcha").html(d({captcha:n.img,i18n:i}))})},getCaptcha:function(){return t.ajax({url:this.model.getCMBaseUrl()+"clients/new-captcha/"})}};return f}),define("system/auth/nls/auth",{root:{authorization:"Authorization",rememberMe:"Remember me",signIn:"Sign in",registration:"Registration",firstName:"First name",surname:"Last name",login:"username",phoneNumber:"Phone number",company:"Company (optional)",secretWord:"Code word for phone identification",captcha:"Type the characters you see in the picture",captchaReload:"Reload characters",registerMe:"Registration",enterWithPass:"Authorization",thankYou:"Thank you",enterLoginAndPass:"Please enter username and password",regSuccess:"<p>A registration verification email was sent to your email address.</p><p>For successful registration verify till: <strong class='nobr'>#t#</strong>.</p><p>Without verification your data will be removed from the system.</p>",errFirstName:"Enter a first name",errSurname:"Enter a last name",errEmail:"Enter a valid email",errPhone:"Enter a phone number",errSecretWord:"Enter code word",errCaptcha:"Type the characters you see in the picture",accept:"Accept",decline:"Decline",iAcceptUserAgreement:"I accept the terms of #t#",usersAgreement:"User agreement",ofUsersAgreement:"the user agreement",errUA:"You must accept the terms of the user agreement"},"ru-ru":!0,"it-it":!0}),define("system/auth/nls/ru-ru/auth",{authorization:"Авторизация",rememberMe:"Запомнить меня",signIn:"Войти",registration:"Регистрация",firstName:"Имя",surname:"Фамилия",login:"логин",phoneNumber:"Телефон",company:"Компания (необязательно)",secretWord:"Кодовое слово для идентификации по телефону",captcha:"Введите символы с картинки",captchaReload:"Показать другие символы",registerMe:"Регистрация",enterWithPass:"Авторизация",thankYou:"Спасибо",enterLoginAndPass:"Пожалуйста, введите имя пользователя и пароль",regSuccess:"<p>На Ваш адрес электронной почты отправлено письмо с данными для подтверждения регистрации.</p><p>Для успешной регистрации необходимо подтверждение до: <strong class='nobr'>#t#</strong>.</p><p>При отсутствии подтверждения Ваши данные будут удалены из системы.</p>",errFirstName:"Введите Имя",errSurname:"Введите Фамилию",errEmail:"Введите правильный E-Mail",errPhone:"Введите номер Телефона",errSecretWord:"Введите Кодовое слово",errCaptcha:"Введите символы с картинки",accept:"Принять",decline:"Отклонить",iAcceptUserAgreement:"Я принимаю условия #t#",usersAgreement:"Пользовательское соглашение",ofUsersAgreement:"пользовательского соглашения",errUA:"Вы должны принять условия пользовательского соглашения"}),define("system/auth/AuthModule",["jquery","underscore","util","abstracts/Module","system/auth/views/AuthView","i18n!_common/nls/common","i18n!system/nls/system","i18n!./nls/auth"],function(t,e,i,n,s,o,a,r){function l(){var t=document.cookie,e=App.getRMCookieName(),i=t.indexOf(" "+e+"=");
if(-1==i&&(i=t.indexOf(e+"=")),-1==i)t=null;else{i=t.indexOf("=",i)+1;var n=t.indexOf(";",i);-1==n&&(n=t.length),t=decodeURIComponent(t.substring(i,n))}return t}function c(t,e){if(e){var i=new Date;i.setDate(i.getDate()+e)}var n=encodeURIComponent(t)+(i?";expires="+i.toUTCString():"");document.cookie=App.getRMCookieName()+"="+n}function h(){document.cookie=App.getRMCookieName()+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function d(t,e){for(var i,n=new Array(2),s=new Array(4),o="",i=0;4>i;i++)s[i]=f(e.slice(4*i,4*(i+1)));for(i=0;i<t.length;i+=8)n[0]=f(t.slice(i,i+4)),n[1]=f(t.slice(i+4,i+8)),p(n,s),o+=g(n[0])+g(n[1]);return v(o)}function u(t,e){for(var i,n=new Array(2),s=new Array(4),o="",i=0;4>i;i++)s[i]=f(e.slice(4*i,4*(i+1)));for(t=_(t),i=0;i<t.length;i+=8)n[0]=f(t.slice(i,i+4)),n[1]=f(t.slice(i+4,i+8)),m(n,s),o+=g(n[0])+g(n[1]);return o=o.replace(/\0+$/,""),unescape(o)}function p(t,e){for(var i=t[0],n=t[1],s=2654435769,o=32*s,a=0;a!=o;)i+=(n<<4^n>>>5)+n^a+e[3&a],a+=s,n+=(i<<4^i>>>5)+i^a+e[3&a>>>11];t[0]=i,t[1]=n}function m(t,e){for(var i=t[0],n=t[1],s=2654435769,o=32*s;0!=o;)n-=(i<<4^i>>>5)+i^o+e[3&o>>>11],o-=s,i-=(n<<4^n>>>5)+n^o+e[3&o];t[0]=i,t[1]=n}function f(t){for(var e=0,i=0;4>i;i++)e|=t.charCodeAt(i)<<8*i;return isNaN(e)?0:e}function g(t){var e=String.fromCharCode(255&t,255&t>>8,255&t>>16,255&t>>24);return e}function v(t){return t.replace(/[\0\t\n\v\f\r\xa0'"!]/g,function(t){return"!"+t.charCodeAt(0)+"!"})}function _(t){return t.replace(/!\d\d?\d?!/g,function(t){return String.fromCharCode(t.slice(1,-1))})}var b="_crypT$Key",y=14,w=":::",x=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,C=n.extend({initialize:function(){this._i18n=t.extend({},o,a,r);var e=this,i=App.getStorage(),n=i.rootGet("user"),c=e.getDemoData(),h=l(),d=App.getRouter().getGETParams();if(this._view=new s({id:"auth",model:this}),App.subscribe("authsuccess",function(t,i,n){n&&(!i||i.login!=t.extId&&i.login!=t.username)?S.remember.call(e,t,y):S.remember.call(e,t)}),n)d.confirmed?(App.publish("authsuccess",n,c,App.isRememberMeAllowed()),S.remember.call(this,n),window.location.href=window.location.origin+window.location.pathname):h?d.login&&d.pass||d.token?S.authByGET.call(e,d).fail(function(){App.publish("authsuccess",n,c,App.isRememberMeAllowed()),"pushState"in window.history&&window.history.pushState(null,null,App.getRouter().getFullOrigin())}):this.authorize(n.username,n.password).done(function(t){App.publish("authsuccess",t,c,App.isRememberMeAllowed())}).fail(function(){i.rootRemove("user"),e._view.render()}):(i.rootRemove("user"),d.login&&d.pass||d.token?S.authByGET.call(e,d).fail(function(){e._view.render()}):this._view.render());else if(h){var u=this.decrypt(h),p=u.split(w);d.login&&d.pass||d.token?d.login&&d.login!==p[0]?S.authByGET.call(e,d).fail(function(){S.authByCookie.call(e,p[0],p[1])}):S.authByCookie.call(e,p[0],p[1]):S.authByCookie.call(this,p[0],p[1])}else d.login&&d.pass||d.token?S.authByGET.call(e,d).fail(function(){e._view.render()}):this._view.render()},authorize:function(){var e;return 2===arguments.length?e={login:arguments[0],password:arguments[1]}:1===arguments.length&&(e={token:arguments[0]}),t.ajax({url:App.getBaseUrl()+"users/login/",timeout:1e4,data:e})},getCMBaseUrl:function(){var t=App.getServerSettings();return(t.protocol||"http")+"://"+t.host+(t.port?":"+t.port:"")+"/clientmanager-rest/"},validateEmail:function(e){var i=null;return x.test(t.trim(e))||(i=this.i18n().errEmail),i},register:function(e){var i,n=new t.Deferred;return(i=S.validateRegData.call(this,e))?n.reject(i):(delete e.passwordRepeat,t.ajax({url:this.getCMBaseUrl()+"clients/self-reg/",data:e,success:function(t){n.resolve(t)},error:function(t){n.reject(t)}})),n},startResetPassword:function(e){var i,n=new t.Deferred;return(i=S.validateResetPasswordData.call(this,e))?n.reject(i):t.ajax({url:this.getCMBaseUrl()+"clients/forgot-password/",data:e,success:function(t){n.resolve(t)},error:function(t){n.reject(t)}}),n},encrypt:function(t,e){return d(i.Base64.encode(unescape(encodeURIComponent(t))),e||b)},decrypt:function(t,e){return decodeURIComponent(escape(i.Base64.decode(u(t,e||b))))},getDemoData:function(){var t=App.getServerSettings().demo||null;return t&&t.login&&t.password||(t=null),t}}),S={remember:function(t,e){var i=this.encrypt(t.username+w+t.password);c(i,e||0)},authByCookie:function(t,e){function i(){h(),window.location.href=s}var n=this,s=App.getRouter().getFullOrigin();this.authorize(t,e).done(function(t){t.id?App.publish("authsuccess",t,n.getDemoData()):i()}).fail(function(){i()})},authByGET:function(t,e){var i=this,n=[];t.login&&t.pass?n=[t.login,t.pass]:t.token&&(n=[t.token]),this.authorize.apply(this,n).done(function(t){t.id?(App.publish("authsuccess",t,i.getDemoData()),"pushState"in window.history&&window.history.pushState(null,null,App.getRouter().getFullOrigin())):e()}).fail(function(){e()})},validateRegData:function(i){var n,s=[],o=this.i18n(),a=50;if(e.each(i,function(e,n){i[n]=t.trim(e)}),i.fname||s.push({key:"fname",msg:o.errFirstName}),i.sname||s.push({key:"sname",msg:o.errSurname}),(n=this.validateEmail(i.email))&&s.push({key:"email",msg:n}),i.phone||s.push({key:"phone",msg:o.errPhone}),i.password){var r=!1;i.password.length>a&&(s.push({key:"password",msg:o.errPassLength.replace("#max#",a)}),r=!0);var l=/[а-яё]/i;l.test(i.password)&&(s.push({key:"password",msg:o.errPassCyr}),r=!0),-1!=i.password.indexOf(":")&&(s.push({key:"password",msg:o.errPassColon}),r=!0),r||i.passwordRepeat==i.password||s.push({key:"passwordRepeat",msg:i.password&&i.passwordRepeat!=i.password?o.errPassRepeat:""})}else s.push({key:"password",msg:o.errPass});return i.secret||s.push({key:"secret",msg:o.errSecretWord}),i["captcha-answer"]||s.push({key:"captcha-answer",msg:o.errCaptcha}),i.acceptUA||s.push({key:"acceptUA",msg:o.errUA}),s.length?s:null},validateResetPasswordData:function(t){var e,i=[];return(e=this.validateEmail(t.email))&&i.push({key:"email",msg:e}),i.length?i:null}};return new C}),define("text!system/account/tmpl/accountNav.html",[],function(){return'<ul id="account-nav" class="nav pull-right">\n	<%= langDropdown %>\n	<li>\n		<a href="javascript:;" class="settings-link">\n			<svg class="svg-icon">\n				<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#smb-wrench"></use>\n			</svg>\n            <span class="hidden-xs"><%= i18n.settings.ucFirst() %></span>\n		</a>\n	</li>\n	<!-- start: User Dropdown -->\n	<li class="dropdown">\n		<a class="dropdown-toggle" data-toggle="dropdown" href="#">\n			<i class="svg-icon svg-icon-user-w"></i>\n            <span class="hidden-xs"><%- account.username %></span>\n			<span class="caret"></span>\n		</a>\n		<ul class="dropdown-menu nav nav-list">\n            <% if(hasAdminAccess) {%>\n            <li><a class=\'admin-login-link\' href="<%= adminUrl %>"><i class="svg-icon svg-icon-user"></i> <%=\n                i18n.adminConsole %></a></li>\n            <% } %>\n            <% if(changePass) {%>\n			<li><a href="javascript:;" class="change-pass-link">\n				<svg class="svg-icon">\n					<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#smb-lock"></use>\n				</svg> <%= i18n.changePassword %></a>\n			</li>\n            <% } %>\n            <li><a href="javascript:;" class="system-about"><i class="svg-icon svg-icon-circle-info"></i> <%= i18n.about %></a></li>\n			<li><a href="javascript:;" onclick="App.trigger(\'logout\')"><i class="svg-icon svg-icon-power"></i> <%= i18n.logout.ucFirst() %></a></li>\n		</ul>\n	</li><!-- end: User Dropdown -->\n\n</ul>'}),define("system/account/views/AccountNavView",["jquery","underscore","abstracts/View","bootstrap","i18n!_common/nls/common","i18n!system/nls/system","text!system/account/tmpl/accountNav.html","text!_common/tmpl/lang.html"],function(t,e,i,n,s,o,a,r){var l=null,c=i.extend({el:t("#main-hdr"),constructor:function(){this._module=null,i.apply(this,arguments)},initialize:function(t){this._module=t.module||null},render:function(){var i=this,n=this.model.get("allowedActions"),l=e.intersection(["objects.create","objects.edit","objects.delete","objectgroups.create","objectgroups.edit","objectgroups.delete","staff.create","staff.edit","staff.delete","schedule.create","schedule.edit","schedule.delete","users.create","users.edit","users.delete","roles.create","roles.edit","roles.bind","roles.delete"],n).length,c=e.template(a,{account:this.model.attributes,hasAdminAccess:l,adminUrl:"javascript:;",i18n:e.extend(s,o),changePass:this.model.can("users.edit.himself"),langDropdown:e.template(r,{curLang:App.getLocaleName(),compact:!0,locale:App.getLocale()})});t("#main-hdr .navbar-inner").append(c),this.setElement(t("#account-nav")),this.$(".dropdown-toggle").dropdown(),this.$el.on("click",".change-pass-link",function(){i.showChangePassword.call(i)}).on("click",".system-about",function(){App.trigger("showAboutDialog")}).on("click",".settings-link",function(){i._module&&i._module.get("parent").showSettings()}).on("click",".admin-login-link",function(){return App.loginAsAdmin(),!1})},showChangePassword:function(){if(!l){var t=this;return requirejs(["system/account/views/AccountChangePassView"],function(e){l=new e({model:t.model}),t.showChangePassword(t)}),void 0}l.show()}});return c}),define("system/account/AccountModule",["underscore","abstracts/Model","abstracts/Module","util","system/account/views/AccountNavView"],function(t,e,i,n,s){var o=!1,a=e.extend({constructor:function(){e.apply(this,arguments)},can:function(t){return this.has("allowedActions")&&-1!=this.get("allowedActions").indexOf(t)},changePassword:function(t){var e=this,i=new $.Deferred;for(var s in t)t[s]=new String(t[s]);return t.id=t.id||this.id,$.ajax({url:App.getBaseUrl()+"users/user-change-password/",data:t,complete:function(s){s.status>=200&&s.status<300?(e.set("password",t.password),e.set("basic",n.Base64.encode(e.get("username")+":"+t.password)),i.resolve()):i.reject(s)}}),i},isDemo:function(){return o}}),r=i.extend({modules:{},constructor:function(t){this._account=new a(t.user),i.apply(this,arguments)},initialize:function(){this.get("isDemo")&&this.setDemo(),this._navView=new s({model:this._account,module:this}),l.bindEvents.call(this),this.publish("ready",this),this._navView.render()},getAccount:function(){return this._account},getUserId:function(){return this._account.get("id")},getUsername:function(){return this._account.get("username")},setDemo:function(){o=!0}}),l={bindEvents:function(){}};return r}),define("text!system/demo/tmpl/demo.html",[],function(){return'<div id="demo-content">\n    \n    <div class="demo-step-container">\n        <div class="demo-step">\n            <div class="demo-image">\n                <img src="system/demo/img/01.jpg" alt="" />\n            </div>\n            <div class="demo-text">\n                <h1>Geo<strong>RITM</strong> 2.4</h1>\n                <p>Новый облачный сервис для&nbsp;мониторинга мобильных и&nbsp;стационарных объектов.</p>\n                <p>Единый, удобный&nbsp;интерфейс для&nbsp;контроля состояния объектов\n                    и&nbsp;обработки тревог.</p>\n                <!--<div class="buttons">\n                    <button data-action="forward" class="btn btn-primary">Далее</button>\n                </div>-->\n            </div>\n        </div>\n        <div class="demo-step">\n            <div class="demo-image">\n                <img src="system/demo/img/02.jpg" alt="" />\n            </div>\n            <div class="demo-text">\n                <h1>Выбор типа объектов</h1>\n                <p>В&nbsp;главном&nbsp;меню можно переключить режим&nbsp;отображения списка\n                    мобильных или&nbsp;стационарных объектов.</p>\n                <p>Все выбранные мобильные и&nbsp;стационарные объекты\n                    будут одновременно отображаться на&nbsp;карте.</p>\n                <!--<div class="buttons">\n                    <button data-action="back" class="btn">Назад</button>\n                    <button data-action="forward" class="btn btn-primary">Далее</button>\n                </div>-->\n            </div>\n        </div>\n        <div class="demo-step">\n            <div class="demo-image">\n                <img src="system/demo/img/03.jpg" alt="" />\n            </div>\n            <div class="demo-text">\n                <h1>Объекты на карте</h1>\n                <p>Цвет иконки объекта сообщает о&nbsp;его&nbsp;состоянии.</p>\n                <p>Зеленый - снят с охраны<br />\n                    Синий - в охране<br />\n                    Желтый - есть неисправность<br />\n                    Серый - не на связи<br />\n                    Красный - не сброшенная тревога</p>\n                <!--<div class="buttons">\n                    <button data-action="back" class="btn">Назад</button>\n                    <button data-action="forward" class="btn btn-primary">Далее</button>\n                </div>-->\n            </div>\n        </div>\n        <div class="demo-step">\n            <div class="demo-image">\n                <img src="system/demo/img/04.jpg" alt="" />\n            </div>\n            <div class="demo-text">\n                <h1>Настройка приборов</h1>\n                <p>Удобная и&nbsp;быстрая настройка новых&nbsp;приборов\n                    непосредственно из&nbsp;интерфейса системы мониторинга.</p>\n                <p>Для настройки Contakt&nbsp;GSM-14, Voyager&nbsp;2N-ГЛОНАСС и&nbsp;Voyager&nbsp;4N\n                    теперь не&nbsp;обязательно пользоваться кабелем настройки или&nbsp;подключаться\n                    дистанционно с&nbsp;помощью модема.</p>\n                <!--<div class="buttons">\n                    <button data-action="back" class="btn">Назад</button>\n                    <button data-action="forward" class="btn btn-primary">Далее</button>\n                </div>-->\n            </div>\n        </div>\n        <div class="demo-step">\n            <div class="demo-image">\n                <img src="system/demo/img/05.jpg" alt="" />\n            </div>\n            <div class="demo-text">\n                <h1>Мастер настройки</h1>\n                <p>Мастер настройки поможет&nbsp;Вам подключить новый&nbsp;прибор.</p>\n                <p>Для Voyager&nbsp;2N, 4N и&nbsp;Contakt-14\n                    доступно автоматическое&nbsp;добавление включенного&nbsp;прибора\n                    в&nbsp;Вашу учетную&nbsp;запись по&nbsp;его&nbsp;IMEI-коду.</p>\n            </div>\n        </div>\n        <div class="demo-step">\n            <div class="demo-image">\n                <img src="system/demo/img/06.jpg" alt="" />\n            </div>\n            <div class="demo-text">\n                <h1>Сводная информация</h1>\n                <p>Страница с настраиваемыми индикаторами для&nbsp;отображения состояния системы.</p>\n                <p>При клике на&nbsp;индикатор будут выбраны соответствующие ему объекты.</p>\n                <!--<div class="buttons">\n                    <button data-action="back" class="btn">Назад</button>\n                    <button data-action="forward" class="btn btn-primary">Далее</button>\n                </div>-->\n            </div>\n        </div>\n        <div class="demo-step">\n            <div class="demo-image">\n                <img src="system/demo/img/07.jpg" alt="" />\n            </div>\n            <div class="demo-text">\n                <h1>Мобильное приложение</h1>\n                <p>Мобильное приложение для&nbsp;смартфонов на&nbsp;Android и&nbsp;мобильная\n                    версия сайта для&nbsp;любых мобильных&nbsp;устройств.</p>\n                <!--<div class="buttons">\n                    <button data-action="back" class="btn">Назад</button>\n                    <button data-action="forward" class="btn btn-primary">Далее</button>\n                </div>-->\n            </div>\n        </div>\n        <div class="demo-step">\n            <div class="demo-image">\n                <img src="system/demo/img/08.jpg" alt="" />\n            </div>\n            <div class="demo-text">\n                <h1>Изображение объекта</h1>\n                <p>В карточке объекта добавлена возможность\n                    загрузки&nbsp;изображений в&nbsp;форматах jpg&nbsp;и&nbsp;png.</p>\n                <p>Загружайте фото объекта и&nbsp;схемы установки оборудования\n                    для&nbsp;мобильных и&nbsp;стационарных объектов.</p>\n                <!--<div class="buttons">\n                    <button data-action="back" class="btn">Назад</button>\n                    <button data-action="forward" class="btn btn-primary">Далее</button>\n                </div>-->\n            </div>\n        </div>\n        <div class="demo-step">\n            <div class="demo-image">\n                <img src="system/demo/img/09.jpg" alt="" />\n            </div>\n            <div class="demo-text">\n                <h1>Поиск ГБР</h1>\n                <p>При обработке тревоги оператором охранного предприятия система сама&nbsp;найдет\n                    ближайшие группы быстрого реагирования и&nbsp;предложит кратчайшие маршруты&nbsp;движения.</p>\n                <!--<div class="buttons">\n                    <button data-action="back" class="btn">Назад</button>\n                    <button data-action="forward" class="btn btn-primary">Далее</button>\n                </div>-->\n            </div>\n        </div>\n    </div>\n    <div class="demo-bullets">\n        <i class="demo-bullet active"></i>\n        <i class="demo-bullet"></i>\n        <i class="demo-bullet"></i>\n        <i class="demo-bullet"></i>\n        <i class="demo-bullet"></i>\n        <i class="demo-bullet"></i>\n        <i class="demo-bullet"></i>\n        <i class="demo-bullet"></i>\n        <i class="demo-bullet"></i>\n    </div>\n</div>\n<a href="#" data-action="forward" class="control forward"><i class="svg-icon svg-icon-chevron-right"></i></a>\n<a href="#" data-action="back" class="control back hidden"><i class="svg-icon svg-icon-chevron-left"></i></a>'}),define("text!system/demo/tmpl/footer.html",[],function(){return'<div class="demo-footer">\n    <div class="demo-close"><button class="btn jw-close" data-action="close">Закрыть</button></div>\n    <% if(displayDontShow) { %>\n    <label class="checkbox">\n        <input data-action="show-again" type="checkbox"<% if(donotshow) { %> checked="checked"<% } %> /> Не показывать эту информацию при следующем входе в систему\n    </label>\n    <% } %>\n</div>'}),define("system/demo/views/DemoView",["jquery","jface","bootstrap","abstracts/View","text!../tmpl/demo.html","text!../tmpl/footer.html","css!../css/demo.css"],function(t,e,i,n,s,o){var a=n.extend({events:{"click [data-action=forward]":"next","click [data-action=back]":"prev","click [data-action=close]":"close","click [data-action=show-again]":"showAgainClick"},constructor:function(){this.current=1,this._controlForward=null,this._controlBack=null,this._bullets=null,n.apply(this,arguments)},render:function(i){var n=960,a=600,r=20;if(!(t(window).width()<n-r||t(window).height()<a-r)){i=_.extend({displayDontShow:!0,donotshow:this.model.getUserData("donotshow")},i||{}),e.showOverlay();var l=this,c={winId:"demo-window",centered:!0,width:n,height:a,headerHtml:"Знакомство с системой",contentHtml:_.template(s,this.model.toJSON()),footerHtml:_.template(o,i),dieAfter:28800,activateCallback:function(){App.trigger("demoopen")},closeCallback:function(){e.hideOverlay()}};e.window.open(c),this.setElement("#"+c.winId),this._controlForward=this.$el.find(".control.forward"),this._controlBack=this.$el.find(".control.back");var h=this._bullets=this.$el.find(".demo-bullets i");this._bullets.on("click",function(){var t=h.index(this);l.setPage(t+1)}),this.listenTo(App,"openalarms",function(){l.$el.trigger("jw.close")})}},next:function(){++this.current,this.animate()},prev:function(){--this.current,this.animate()},setPage:function(t){this.current=t,this.animate()},animate:function(){var e=this.$el.find(".demo-step:eq("+(this.current-1)+")"),i=this._bullets.length;this._bullets.removeClass("active"),t(this._bullets.get(this.current-1)).addClass("active"),e.parent().css("left",-e.get(0).offsetLeft+"px"),1==this.current?(this._controlBack.addClass("hidden"),this._controlForward.removeClass("hidden")):this.current==i?(this._controlForward.addClass("hidden"),this._controlBack.removeClass("hidden")):(this._controlForward.removeClass("hidden"),this._controlBack.removeClass("hidden"))},showAgainClick:function(e){this.model.trigger("showDemoToggle",t(e.target).prop("checked"))}});return a}),define("text!system/demo/tmpl/about.html",[],function(){return"<h1>Geo<strong>RITM</strong> <%= majorVersion %></h1>\n<p class=\"selectable\"><%= i18n.version %>: <%= version %><% if(ui && ui.version != version) {%> / <%= ui.version %><% } %></p>\n<p><%= i18n.thanksForUsing %></p>\n<%= Array.isArray(aboutInfo) ? aboutInfo.join('') : ( aboutInfo || '' ) %>\n"}),define("text!system/demo/tmpl/aboutFooter.html",[],function(){return'<div class="about-footer">\n    <div class="demo-close"><button class="btn jw-close" data-action="close"><%= i18n.close.ucFirst() %></button></div>\n    <% if(presentation) {%>\n    <a class="tips-of-day" href="#">Знакомство с системой</a>\n    <% } %>\n</div>'}),define("system/demo/views/DemoAboutView",["jquery","jface","bootstrap","abstracts/View","text!../tmpl/about.html","text!../tmpl/aboutFooter.html","css!../css/demo.css"],function(t,e,i,n,s,o){var a=n.extend({events:{"click .tips-of-day":"tipsClick"},constructor:function(){n.apply(this,arguments)},render:function(){e.showOverlay();var t=this.model.getTexts(),i=this.model.toJSON(),n=App.getVersion(),a=/(\d+\.\d+)\.\d+/.exec(n),r={winId:"demo-about",centered:!0,width:440,height:400,headerHtml:t.about,contentHtml:_.template(s,_.extend(i,{version:n,majorVersion:a.length>1?a[1]:"",ui:this.model.get("parent").getUISettings(),i18n:t})),footerHtml:_.template(o,_.extend(i,{i18n:t})),dieAfter:28800,openCallback:function(){},activateCallback:function(){},closeCallback:function(){e.hideOverlay()}};e.window.open(r),this.setElement("#"+r.winId)},tipsClick:function(t){t.preventDefault(),e.hideOverlay(),e.window.close(),App.trigger("showPresentation")}});return a}),define("system/demo/DemoModule",["underscore","abstracts/Module","./views/DemoView","./views/DemoAboutView","./views/DemoAboutView","i18n!_common/nls/common"],function(t,e,i,n){var s="latestVersion",o="donotshow",a=e.extend({defaults:{presentation:!1,aboutInfo:""},constructor:function(){e.apply(this,arguments)},initialize:function(t){var e=App.getServerSettings(),a=App.getVersion(),l=e.aboutInfo||"";if("undefined"==typeof e.presentation||e.presentation||this.set("presentation",!1),l&&"object"==typeof l){var c=App.getLocale().substr(0,2);l=l[c]||l.en||""}this.set("aboutInfo",l||""),r.bindEvents.call(this),this._aboutView=new n({model:this}),this.get("presentation")&&(this._view=new i({model:this}),t.isDemo?this._view.render({displayDontShow:!1}):(r.isNewVersion.call(this,a)&&(this.toggleShowDemo(!1),this.setUserData(s,r.getVersionCode(a))),this.getUserData(o)||this._view.render()))},toggleShowDemo:function(t){this.setUserData(o,t?"1":"")},getTexts:function(){return this.get("parent").getTexts()}}),r={bindEvents:function(){this.on("showDemoToggle",t.bind(this.toggleShowDemo,this)),this.get("presentation")&&this.listenTo(App,"showPresentation",t.bind(function(){this._view.render()},this)),this.listenTo(App,"showAboutDialog",t.bind(function(){this._aboutView.render()},this))},getVersionCode:function(e){var i="";return t.isString(e)&&""!=e&&(i=e.match(/^(\d*\.\d*)[\s\S]*$/)[1].replace(/\./,"")),i},isNewVersion:function(t){var e=this.getUserData(s);return t=r.getVersionCode(t),e||this.setUserData(s,t),t!==e}};return a}),define("text!system/tmpl/simNumbers.html",[],function(){return'<h3><%= i18n.simCardNumbersDetection %></h3>\n\n<div class="params-group">\n    <h4><%= i18n.objectsToDetectSimCardNumbers %></h4>\n    <div class="control-group">\n        <label class="radio">\n            <input type="radio" value="0" name="useSelectedObjects"<% if(!useSelectedObjects) {%> checked<% } %>>\n            <%= i18n.allObjectsWithNoSimCardNumbers %>\n        </label>\n        <label class="radio">\n            <input type="radio" value="1" name="useSelectedObjects"<% if(useSelectedObjects) {%> checked<% } %>>\n            <%= i18n.selectedObjectsOnly %>\n        </label>\n    </div>\n</div>\n\n<div class="params-group objects-selection">\n    <div class="field">\n        <label><%= i18n.searchingObjectsAndGroups %></label>\n        <input type="text" class="itext ignore" name="q" value="" />\n    </div><div class="field">\n        <label class="nb-objs" style="line-height:25px">\n            <%= i18n.selectedObjects %>:\n            <input type="text" class="offscreen" name="nbobjs" value="0">\n            <span class="nb-objs-value">0</span>\n        </label>\n        <div class="selected-objects">\n            <!--<div class="list"></div>-->\n        </div><!-- /selected-objects -->\n    </div>\n</div>\n\n<div class="params-group">\n    <h4><%= i18n.requestLiveTimeout %></h4>\n    <div class="field">\n        <input type="hidden" name="liveTimeout" value="0"><!-- for validation -->\n        <label><%= i18n.requestLiveTimeoutLabel %></label>\n        <div class="form-horizontal duration-fields-group">\n            <label class="duration-field">\n                <input class="duration-input" type="text" name="days" value="1" maxlength="2" autocomplete="off">\n                <%= i18n.DateTime.labels2[7] %>\n            </label>\n            <label class="duration-field">\n                <input class="duration-input" type="text" name="hours" value="0" maxlength="2" autocomplete="off">\n                <%= i18n.DateTime.labels2[4] %>\n            </label>\n            <label class="duration-field">\n                <input class="duration-input" type="text" name="minutes" value="0" maxlength="2" autocomplete="off">\n                <%= i18n.DateTime.labels2[5] %>\n            </label>\n        </div>\n    </div>\n</div>\n\n<div class="params-group">\n    <%= i18n.simCardNumbersDetectionExplain %>\n\n</div>\n\n<div class="params-group actions-group btn-row">\n    <button type="submit" class="btn btn-primary btn-run"><%= i18n.detect %></button>\n</div>'}),define("text!_common/tmpl/objectsSearchTag.html",[],function(){return'<div data-id="<%= id %>" class="btn btn-small tag<%= isGroup ? \' group\': \'\' %>" title="<%- title %>">\n    <input type="hidden" name="<%= isGroup ? \'groupId\' : \'objectId\' %>" value="<%= id %>">\n    <span class="name"><%- title %></span>\n    <i data-id="<%= id %>" class="svg-icon svg-icon-remove del-link"></i>\n</div>'}),function(t){"function"==typeof define&&define.amd?define("validation",["jquery"],t):t(jQuery)}(function(t){t.extend(t.fn,{validate:function(e){if(!this.length)return e&&e.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing."),void 0;var i=t.data(this[0],"validator");return i?i:(this.attr("novalidate","novalidate"),i=new t.validator(e,this[0]),t.data(this[0],"validator",i),i.settings.onsubmit&&(this.validateDelegate(":submit","click",function(e){i.settings.submitHandler&&(i.submitButton=e.target),t(e.target).hasClass("cancel")&&(i.cancelSubmit=!0),void 0!==t(e.target).attr("formnovalidate")&&(i.cancelSubmit=!0)}),this.submit(function(e){function n(){var n,s;return i.settings.submitHandler?(i.submitButton&&(n=t("<input type='hidden'/>").attr("name",i.submitButton.name).val(t(i.submitButton).val()).appendTo(i.currentForm)),s=i.settings.submitHandler.call(i,i.currentForm,e),i.submitButton&&n.remove(),void 0!==s?s:!1):!0}return i.settings.debug&&e.preventDefault(),i.cancelSubmit?(i.cancelSubmit=!1,n()):i.form()?i.pendingRequest?(i.formSubmitted=!0,!1):n():(i.focusInvalid(),!1)})),i)},valid:function(){var e,i;return t(this[0]).is("form")?e=this.validate().form():(e=!0,i=t(this[0].form).validate(),this.each(function(){e=i.element(this)&&e})),e},removeAttrs:function(e){var i={},n=this;return t.each(e.split(/\s/),function(t,e){i[e]=n.attr(e),n.removeAttr(e)}),i},rules:function(e,i){var n,s,o,a,r,l,c=this[0];if(e)switch(n=t.data(c.form,"validator").settings,s=n.rules,o=t.validator.staticRules(c),e){case"add":t.extend(o,t.validator.normalizeRule(i)),delete o.messages,s[c.name]=o,i.messages&&(n.messages[c.name]=t.extend(n.messages[c.name],i.messages));break;case"remove":return i?(l={},t.each(i.split(/\s/),function(e,i){l[i]=o[i],delete o[i],"required"===i&&t(c).removeAttr("aria-required")}),l):(delete s[c.name],o)}return a=t.validator.normalizeRules(t.extend({},t.validator.classRules(c),t.validator.attributeRules(c),t.validator.dataRules(c),t.validator.staticRules(c)),c),a.required&&(r=a.required,delete a.required,a=t.extend({required:r},a),t(c).attr("aria-required","true")),a.remote&&(r=a.remote,delete a.remote,a=t.extend(a,{remote:r})),a}}),t.extend(t.expr[":"],{blank:function(e){return!t.trim(""+t(e).val())},filled:function(e){return!!t.trim(""+t(e).val())},unchecked:function(e){return!t(e).prop("checked")}}),t.validator=function(e,i){this.settings=t.extend(!0,{},t.validator.defaults,e),this.currentForm=i,this.init()},t.validator.format=function(e,i){return 1===arguments.length?function(){var i=t.makeArray(arguments);return i.unshift(e),t.validator.format.apply(this,i)}:(arguments.length>2&&i.constructor!==Array&&(i=t.makeArray(arguments).slice(1)),i.constructor!==Array&&(i=[i]),t.each(i,function(t,i){e=e.replace(new RegExp("\\{"+t+"\\}","g"),function(){return i})}),e)},t.extend(t.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusCleanup:!1,focusInvalid:!0,errorContainer:t([]),errorLabelContainer:t([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(t){this.lastActive=t,this.settings.focusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,t,this.settings.errorClass,this.settings.validClass),this.hideThese(this.errorsFor(t)))},onfocusout:function(t){this.checkable(t)||!(t.name in this.submitted)&&this.optional(t)||this.element(t)},onkeyup:function(t,e){(9!==e.which||""!==this.elementValue(t))&&(t.name in this.submitted||t===this.lastElement)&&this.element(t)},onclick:function(t){t.name in this.submitted?this.element(t):t.parentNode.name in this.submitted&&this.element(t.parentNode)},highlight:function(e,i,n){"radio"===e.type?this.findByName(e.name).addClass(i).removeClass(n):t(e).addClass(i).removeClass(n)},unhighlight:function(e,i,n){"radio"===e.type?this.findByName(e.name).removeClass(i).addClass(n):t(e).removeClass(i).addClass(n)}},setDefaults:function(e){t.extend(t.validator.defaults,e)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date ( ISO ).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:t.validator.format("Please enter no more than {0} characters."),minlength:t.validator.format("Please enter at least {0} characters."),rangelength:t.validator.format("Please enter a value between {0} and {1} characters long."),range:t.validator.format("Please enter a value between {0} and {1}."),max:t.validator.format("Please enter a value less than or equal to {0}."),min:t.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function(){function e(e){var i=t.data(this[0].form,"validator"),n="on"+e.type.replace(/^validate/,""),s=i.settings;
s[n]&&!this.is(s.ignore)&&s[n].call(i,this[0],e)}this.labelContainer=t(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||t(this.currentForm),this.containers=t(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var i,n=this.groups={};t.each(this.settings.groups,function(e,i){"string"==typeof i&&(i=i.split(/\s/)),t.each(i,function(t,i){n[i]=e})}),i=this.settings.rules,t.each(i,function(e,n){i[e]=t.validator.normalizeRule(n)}),t(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'], [type='radio'], [type='checkbox']","focusin focusout keyup",e).validateDelegate("select, option, [type='radio'], [type='checkbox']","click",e),this.settings.invalidHandler&&t(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler),t(this.currentForm).find("[required], [data-rule-required], .required").attr("aria-required","true")},form:function(){return this.checkForm(),t.extend(this.submitted,this.errorMap),this.invalid=t.extend({},this.errorMap),this.valid()||t(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var t=0,e=this.currentElements=this.elements();e[t];t++)this.check(e[t]);return this.valid()},element:function(e){var i=this.clean(e),n=this.validationTargetFor(i),s=!0;return this.lastElement=n,void 0===n?delete this.invalid[i.name]:(this.prepareElement(n),this.currentElements=t(n),s=this.check(n)!==!1,s?delete this.invalid[n.name]:this.invalid[n.name]=!0),t(e).attr("aria-invalid",!s),this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),s},showErrors:function(e){if(e){t.extend(this.errorMap,e),this.errorList=[];for(var i in e)this.errorList.push({message:e[i],element:this.findByName(i)[0]});this.successList=t.grep(this.successList,function(t){return!(t.name in e)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){t.fn.resetForm&&t(this.currentForm).resetForm(),this.submitted={},this.lastElement=null,this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass).removeData("previousValue").removeAttr("aria-invalid")},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(t){var e,i=0;for(e in t)i++;return i},hideErrors:function(){this.hideThese(this.toHide)},hideThese:function(t){t.not(this.containers).text(""),this.addWrapper(t).hide()},valid:function(){return 0===this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{t(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(e){}},findLastActive:function(){var e=this.lastActive;return e&&1===t.grep(this.errorList,function(t){return t.element.name===e.name}).length&&e},elements:function(){var e=this,i={};return t(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled], [readonly]").not(this.settings.ignore).filter(function(){return!this.name&&e.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in i||!e.objectLength(t(this).rules())?!1:(i[this.name]=!0,!0)})},clean:function(e){return t(e)[0]},errors:function(){var e=this.settings.errorClass.split(" ").join(".");return t(this.settings.errorElement+"."+e,this.errorContext)},reset:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=t([]),this.toHide=t([]),this.currentElements=t([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(t){this.reset(),this.toHide=this.errorsFor(t)},elementValue:function(e){var i,n=t(e),s=e.type;return"radio"===s||"checkbox"===s?t("input[name='"+e.name+"']:checked").val():"number"===s&&"undefined"!=typeof e.validity?e.validity.badInput?!1:n.val():(i=n.val(),"string"==typeof i?i.replace(/\r/g,""):i)},check:function(e){e=this.validationTargetFor(this.clean(e));var i,n,s,o=t(e).rules(),a=t.map(o,function(t,e){return e}).length,r=!1,l=this.elementValue(e);for(n in o){s={method:n,parameters:o[n]};try{if(i=t.validator.methods[n].call(this,l,e,s.parameters),"dependency-mismatch"===i&&1===a){r=!0;continue}if(r=!1,"pending"===i)return this.toHide=this.toHide.not(this.errorsFor(e)),void 0;if(!i)return this.formatAndAdd(e,s),!1}catch(c){throw this.settings.debug&&window.console&&console.log("Exception occurred when checking element "+e.id+", check the '"+s.method+"' method.",c),c}}if(!r)return this.objectLength(o)&&this.successList.push(e),!0},customDataMessage:function(e,i){return t(e).data("msg"+i.charAt(0).toUpperCase()+i.substring(1).toLowerCase())||t(e).data("msg")},customMessage:function(t,e){var i=this.settings.messages[t];return i&&(i.constructor===String?i:i[e])},findDefined:function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t];return void 0},defaultMessage:function(e,i){return this.findDefined(this.customMessage(e.name,i),this.customDataMessage(e,i),!this.settings.ignoreTitle&&e.title||void 0,t.validator.messages[i],"<strong>Warning: No message defined for "+e.name+"</strong>")},formatAndAdd:function(e,i){var n=this.defaultMessage(e,i.method),s=/\$?\{(\d+)\}/g;"function"==typeof n?n=n.call(this,i.parameters,e):s.test(n)&&(n=t.validator.format(n.replace(s,"{$1}"),i.parameters)),this.errorList.push({message:n,element:e,method:i.method}),this.errorMap[e.name]=n,this.submitted[e.name]=n},addWrapper:function(t){return this.settings.wrapper&&(t=t.add(t.parent(this.settings.wrapper))),t},defaultShowErrors:function(){var t,e,i;for(t=0;this.errorList[t];t++)i=this.errorList[t],this.settings.highlight&&this.settings.highlight.call(this,i.element,this.settings.errorClass,this.settings.validClass),this.showLabel(i.element,i.message);if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(t=0;this.successList[t];t++)this.showLabel(this.successList[t]);if(this.settings.unhighlight)for(t=0,e=this.validElements();e[t];t++)this.settings.unhighlight.call(this,e[t],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return t(this.errorList).map(function(){return this.element})},showLabel:function(e,i){var n,s,o,a=this.errorsFor(e),r=this.idOrName(e),l=t(e).attr("aria-describedby");a.length?(a.removeClass(this.settings.validClass).addClass(this.settings.errorClass),a.html(i)):(a=t("<"+this.settings.errorElement+">").attr("id",r+"-error").addClass(this.settings.errorClass).html(i||""),n=a,this.settings.wrapper&&(n=a.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.length?this.labelContainer.append(n):this.settings.errorPlacement?this.settings.errorPlacement(n,t(e)):n.insertAfter(e),a.is("label")?a.attr("for",r):0===a.parents("label[for='"+r+"']").length&&(o=a.attr("id").replace(/(:|\.|\[|\])/g,"\\$1"),l?l.match(new RegExp("\\b"+o+"\\b"))||(l+=" "+o):l=o,t(e).attr("aria-describedby",l),s=this.groups[e.name],s&&t.each(this.groups,function(e,i){i===s&&t("[name='"+e+"']",this.currentForm).attr("aria-describedby",a.attr("id"))}))),!i&&this.settings.success&&(a.text(""),"string"==typeof this.settings.success?a.addClass(this.settings.success):this.settings.success(a,e)),this.toShow=this.toShow.add(a)},errorsFor:function(e){var i=this.idOrName(e),n=t(e).attr("aria-describedby"),s="label[for='"+i+"'], label[for='"+i+"'] *";return n&&(s=s+", #"+n.replace(/\s+/g,", #")),this.errors().filter(s)},idOrName:function(t){return this.groups[t.name]||(this.checkable(t)?t.name:t.id||t.name)},validationTargetFor:function(e){return this.checkable(e)&&(e=this.findByName(e.name)),t(e).not(this.settings.ignore)[0]},checkable:function(t){return/radio|checkbox/i.test(t.type)},findByName:function(e){return t(this.currentForm).find("[name='"+e+"']")},getLength:function(e,i){switch(i.nodeName.toLowerCase()){case"select":return t("option:selected",i).length;case"input":if(this.checkable(i))return this.findByName(i.name).filter(":checked").length}return e.length},depend:function(t,e){return this.dependTypes[typeof t]?this.dependTypes[typeof t](t,e):!0},dependTypes:{"boolean":function(t){return t},string:function(e,i){return!!t(e,i.form).length},"function":function(t,e){return t(e)}},optional:function(e){var i=this.elementValue(e);return!t.validator.methods.required.call(this,i,e)&&"dependency-mismatch"},startRequest:function(t){this.pending[t.name]||(this.pendingRequest++,this.pending[t.name]=!0)},stopRequest:function(e,i){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[e.name],i&&0===this.pendingRequest&&this.formSubmitted&&this.form()?(t(this.currentForm).submit(),this.formSubmitted=!1):!i&&0===this.pendingRequest&&this.formSubmitted&&(t(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(e){return t.data(e,"previousValue")||t.data(e,"previousValue",{old:null,valid:!0,message:this.defaultMessage(e,"remote")})}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(e,i){e.constructor===String?this.classRuleSettings[e]=i:t.extend(this.classRuleSettings,e)},classRules:function(e){var i={},n=t(e).attr("class");return n&&t.each(n.split(" "),function(){this in t.validator.classRuleSettings&&t.extend(i,t.validator.classRuleSettings[this])}),i},attributeRules:function(e){var i,n,s={},o=t(e),a=e.getAttribute("type");for(i in t.validator.methods)"required"===i?(n=e.getAttribute(i),""===n&&(n=!0),n=!!n):n=o.attr(i),/min|max/.test(i)&&(null===a||/number|range|text/.test(a))&&(n=Number(n)),n||0===n?s[i]=n:a===i&&"range"!==a&&(s[i]=!0);return s.maxlength&&/-1|2147483647|524288/.test(s.maxlength)&&delete s.maxlength,s},dataRules:function(e){var i,n,s={},o=t(e);for(i in t.validator.methods)n=o.data("rule"+i.charAt(0).toUpperCase()+i.substring(1).toLowerCase()),void 0!==n&&(s[i]=n);return s},staticRules:function(e){var i={},n=t.data(e.form,"validator");return n.settings.rules&&(i=t.validator.normalizeRule(n.settings.rules[e.name])||{}),i},normalizeRules:function(e,i){return t.each(e,function(n,s){if(s===!1)return delete e[n],void 0;if(s.param||s.depends){var o=!0;switch(typeof s.depends){case"string":o=!!t(s.depends,i.form).length;break;case"function":o=s.depends.call(i,i)}o?e[n]=void 0!==s.param?s.param:!0:delete e[n]}}),t.each(e,function(n,s){e[n]=t.isFunction(s)?s(i):s}),t.each(["minlength","maxlength"],function(){e[this]&&(e[this]=Number(e[this]))}),t.each(["rangelength","range"],function(){var i;e[this]&&(t.isArray(e[this])?e[this]=[Number(e[this][0]),Number(e[this][1])]:"string"==typeof e[this]&&(i=e[this].replace(/[\[\]]/g,"").split(/[\s,]+/),e[this]=[Number(i[0]),Number(i[1])]))}),t.validator.autoCreateRanges&&(null!=e.min&&null!=e.max&&(e.range=[e.min,e.max],delete e.min,delete e.max),null!=e.minlength&&null!=e.maxlength&&(e.rangelength=[e.minlength,e.maxlength],delete e.minlength,delete e.maxlength)),e},normalizeRule:function(e){if("string"==typeof e){var i={};t.each(e.split(/\s/),function(){i[this]=!0}),e=i}return e},addMethod:function(e,i,n){t.validator.methods[e]=i,t.validator.messages[e]=void 0!==n?n:t.validator.messages[e],i.length<3&&t.validator.addClassRules(e,t.validator.normalizeRule(e))},methods:{required:function(e,i,n){if(!this.depend(n,i))return"dependency-mismatch";if("select"===i.nodeName.toLowerCase()){var s=t(i).val();return s&&s.length>0}return this.checkable(i)?this.getLength(e,i)>0:t.trim(e).length>0},email:function(t,e){return this.optional(e)||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)},url:function(t,e){return this.optional(e)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t)},date:function(t,e){return this.optional(e)||!/Invalid|NaN/.test(new Date(t).toString())},dateISO:function(t,e){return this.optional(e)||/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(t)},number:function(t,e){return this.optional(e)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t)},digits:function(t,e){return this.optional(e)||/^\d+$/.test(t)},creditcard:function(t,e){if(this.optional(e))return"dependency-mismatch";if(/[^0-9 \-]+/.test(t))return!1;var i,n,s=0,o=0,a=!1;if(t=t.replace(/\D/g,""),t.length<13||t.length>19)return!1;for(i=t.length-1;i>=0;i--)n=t.charAt(i),o=parseInt(n,10),a&&(o*=2)>9&&(o-=9),s+=o,a=!a;return 0===s%10},minlength:function(e,i,n){var s=t.isArray(e)?e.length:this.getLength(e,i);return this.optional(i)||s>=n},maxlength:function(e,i,n){var s=t.isArray(e)?e.length:this.getLength(e,i);return this.optional(i)||n>=s},rangelength:function(e,i,n){var s=t.isArray(e)?e.length:this.getLength(e,i);return this.optional(i)||s>=n[0]&&s<=n[1]},min:function(t,e,i){return this.optional(e)||t>=i},max:function(t,e,i){return this.optional(e)||i>=t},range:function(t,e,i){return this.optional(e)||t>=i[0]&&t<=i[1]},equalTo:function(e,i,n){var s=t(n);return this.settings.onfocusout&&s.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){t(i).valid()}),e===s.val()},remote:function(e,i,n){if(this.optional(i))return"dependency-mismatch";var s,o,a=this.previousValue(i);return this.settings.messages[i.name]||(this.settings.messages[i.name]={}),a.originalMessage=this.settings.messages[i.name].remote,this.settings.messages[i.name].remote=a.message,n="string"==typeof n&&{url:n}||n,a.old===e?a.valid:(a.old=e,s=this,this.startRequest(i),o={},o[i.name]=e,t.ajax(t.extend(!0,{url:n,mode:"abort",port:"validate"+i.name,dataType:"json",data:o,context:s.currentForm,success:function(n){var o,r,l,c=n===!0||"true"===n;s.settings.messages[i.name].remote=a.originalMessage,c?(l=s.formSubmitted,s.prepareElement(i),s.formSubmitted=l,s.successList.push(i),delete s.invalid[i.name],s.showErrors()):(o={},r=n||s.defaultMessage(i,"remote"),o[i.name]=a.message=t.isFunction(r)?r(e):r,s.invalid[i.name]=!0,s.showErrors(o)),a.valid=c,s.stopRequest(i,c)}},n)),"pending")}}}),t.format=function(){throw"$.format has been deprecated. Please use $.validator.format instead."};var e,i={};t.ajaxPrefilter?t.ajaxPrefilter(function(t,e,n){var s=t.port;"abort"===t.mode&&(i[s]&&i[s].abort(),i[s]=n)}):(e=t.ajax,t.ajax=function(n){var s=("mode"in n?n:t.ajaxSettings).mode,o=("port"in n?n:t.ajaxSettings).port;return"abort"===s?(i[o]&&i[o].abort(),i[o]=e.apply(this,arguments),i[o]):e.apply(this,arguments)}),t.extend(t.fn,{validateDelegate:function(e,i,n){return this.bind(i,function(i){var s=t(i.target);return s.is(e)?n.apply(s,arguments):void 0})}})}),define("system/views/SimNumbersView",["jquery","underscore","jface","abstracts/View","text!../tmpl/simNumbers.html","text!_common/tmpl/objectsSearchTag.html","validation"],function(t,e,i,n,s,o){s=e.template(s),o=e.template(o),t.validator.addMethod("taskTimeToLiveMinutes",function(e,i,n){var s=t(n.selector,i.form),o=s.eq(0),a=o.data("valid_req_grp")?o.data("valid_req_grp"):t.extend({},this),r=[1440*parseInt(o.val()),60*parseInt(s.eq(1).val()),parseInt(s.eq(2).val())],l=r.reduce(function(t,e){return t+(isNaN(e)?0:e)},0),c=l>=n.min;return o.data("valid_req_grp",a),t(i).data("being_validated")||(s.data("being_validated",!0),s.each(function(){a.element(this)}),s.data("being_validated",!1)),c},"");var a=n.extend({constructor:function(t){this.i18n=t.i18n,this.useSelectedObjects=!0,this.objectId=[],this.groupId=[],this.$selectedObjects=null,this.$objectsQty=null,this._searchCache={},n.apply(this,arguments)},initialize:function(){this.render(),r.bindEvents.call(this),r.initSearch.call(this,this.$el.find("input[name=q]")),r.initValidation.call(this,this.$el)},render:function(){this.$el.html(s({i18n:this.i18n,useSelectedObjects:this.useSelectedObjects})),this.$selectedObjects=this.$el.find(".selected-objects"),this.$objectsQty=this.$el.find(".nb-objs-value"),r.toggleObjectsSelection.call(this,this.useSelectedObjects)}}),r={bindEvents:function(){var e=this;this.$el.find('input[name="useSelectedObjects"]').on("click",function(){this.checked&&(e.useSelectedObjects=1===parseInt(this.value),r.toggleObjectsSelection.call(e,e.useSelectedObjects))}),this.$el.on("click",".tag i",function(){var i=t(this).parent(),n=parseInt(i.data("id")),s=i[0].className.indexOf("group")>=0;r.deleteObject.call(e,n,s),i.remove()}),this.$el.find(".duration-input").numeric({decimal:!1,negative:!1})},toggleObjectsSelection:function(t){var e=this.$el.find(".objects-selection");e.toggleClass("hidden",!t)},initValidation:function(e){var i=this.i18n,n=this;e.validate({submitHandler:function(){r.onSubmit.call(n,e)},debug:!1,ignore:".no-validation",rules:{nbobjs:{min:function(){return n.useSelectedObjects?1:0}},hours:{max:23},minutes:{max:59},liveTimeout:{taskTimeToLiveMinutes:{min:1,selector:".duration-input"}}},errorElement:"p",messages:{nbobjs:{min:i.errors.selectAtLeastOneObject},hours:{max:i.errors.validateMaxValue},minutes:{max:i.errors.validateMaxValue},liveTimeout:{taskTimeToLiveMinutes:function(e){return t.validator.format(i.errors.validateTimeToLive,e.min,i.minutesLabels[i.whichLabels(e.min)])}}},errorPlacement:function(t,e){var i=e[0].name,n=e.parent();"nbobjs"===i?t.insertBefore(n):/^days|hours|minutes$/.test(i)?t.appendTo(e.closest(".duration-fields-group")):n.append(t)}})},initSearch:function(e){var i=this;e.catcomplete({delay:0,appendTo:this.$el,minLength:2,source:function(t,e){return r.search.call(i,t.term).done(function(t){e(t)}).fail(function(){e([])})},select:function(e,n){return t(e.target).val(""),r.addObject.call(i,n.item.model),!1}})},search:function(e){var i=this,n=new t.Deferred;return e=e.toLowerCase(),e in this._searchCache?n.resolve(this._searchCache[e]):App.searchObjectsAndGroups(e,null).done(function(t){i._searchCache[e]=t,n.resolve(t)}).fail(function(){n.reject()}),n},addObject:function(t){var e=parseInt(t.id),i=this.i18n,n=!1;return t.isGroup&&0===t.nbItems?(alert(i.emptyObjGroupAddWarning.replace("#name#",t.name),i.attention),!1):(t.isGroup?-1===this.groupId.indexOf(e)&&(this.groupId.push(e),this.$selectedObjects.append(o({id:e,title:t.name,isGroup:!0})),n=!0):-1===this.objectId.indexOf(e)&&(this.objectId.push(t.id),this.$selectedObjects.append(o({id:e,extId:t.extId,title:t.name+" (#"+t.extId+")",isGroup:!1})),n=!0),n&&r.onChangeObjectsCount.call(this),n)},deleteObject:function(t,i){i?this.groupId=e.without(this.groupId,t):this.objectId=e.without(this.objectId,t),r.onChangeObjectsCount.call(this)},onChangeObjectsCount:function(){var t=r.collectAllObjectId.call(this),e=this.$objectsQty.siblings("input"),i=t.length;this.$objectsQty.text(i),e.val(i),e.hasClass("error")&&i>0&&e.parent().siblings(".error").remove()},collectAllObjectId:function(){var t=this.objectId.slice(0);return e.each(this.groupId,function(e){t=t.concat(App.getAllDeviceIdsInGroup(e))}),e.uniq(t)},onSubmit:function(t){var e=this,n=r.collectAllObjectId.call(this),s=this.i18n.simCardNumbersDetectionConfirm,o=[86400*parseInt(t.find("input[name=days]").val()),3600*parseInt(t.find("input[name=hours]").val()),60*parseInt(t.find("input[name=minutes]").val())],a=o.reduce(function(t,e){return t+(isNaN(e)?0:e)},0);i.confirm(s.msg.replace("#ttl#",Date.formatSeconds(a,!1,"24hm")),s.hdr,{okCallback:function(){r.run.call(e,n,a)}})},run:function(e,n){var s=this.$el.addClass("loading");t.ajax({url:App.getBaseUrl()+"phone/get-over-sms/",data:{objectIds:e,ttl:n}}).done(function(){i.growl.open(this.i18n.commandSent)}.bind(this)).fail(this.showErrors.bind(this)).always(function(){s.removeClass("loading")})}};return a}),define("system/nls/settings",{root:{uiElements:"External view",reportsSettings:"Report options",scheduler:"Report scheduler",reportsList:"Report list",clickToChange:"Click to change",zonesSettings:"Geofences settings",alarmsAndAlerts:"Alarm window",historyWindowSettings:"Event window",alertsDirectory:"Event reference",objectsOnMap:"Objects at the map",objectsViewType:"Objects View",mapGroupingSizeObjects:"Group and object size on the map",mapGroupingSizeObjectsUsedGrouping:"Use group nearby objects",mapGroupingSizeObjectsChangeSize:"Change icon size based on the map scale",mapObjSearchMode:"Show the search result",mapObjSearchMode1:"The found object becomes the only monitored object",mapObjSearchMode2:"The found object is added to the selected ones",objectTitleComponents:"Object label components",infoInBaloon:"Object baloon content",devicesGeozonesBindings:"Binding objects to geofences",userSettingsCleaning:"Settings reset",clearUserSettings:"Clear all settings",clearUserSettingsConfirm:"All local settings will be cleared.<br />Then the page will be automatically reloaded."},"ru-ru":!0,"it-it":!0}),define("system/nls/ru-ru/settings",{uiElements:"Внешний вид",reportsSettings:"Параметры отчетов",scheduler:"Планировщик отчетов",reportsList:"Список отчетов",clickToChange:"Кликните для изменения",zonesSettings:"Настройки зон",alarmsAndAlerts:"Окно тревоги",historyWindowSettings:"Окно событий",alertsDirectory:"Справочник событий",objectsOnMap:"Объекты на карте",objectsViewType:"Вид объектов",mapGroupingSizeObjects:"Группировка и размер объектов на карте",mapGroupingSizeObjectsUsedGrouping:"Использовать группировку близкорасположенных объектов",mapGroupingSizeObjectsChangeSize:"Менять размер иконок в зависимости от масштаба карты",mapObjSearchMode:"Показ результата поиска",mapObjSearchMode1:"Найденный объект становится единственным выбранным",mapObjSearchMode2:"Найденный объект добавляется к выбранным",objectTitleComponents:"Состав наименования объекта",infoInBaloon:"Состав информации в выноске объекта",devicesGeozonesBindings:"Привязка объектов к геозонам",userSettingsCleaning:"Сброс настроек",clearUserSettings:"Сбросить все настройки",clearUserSettingsConfirm:"Все локальные настройки будут очищены.<br />После очистки страница перезагрузится автоматически."}),define("text!system/tmpl/settings.html",[],function(){return'<div id="settings">\n    <div class="nav">\n        <h3><%= i18n.settings.ucFirst() %></h3>\n        <ul>\n            <% if(!alarmsOnly) {%>\n            <li class="active"><a href="javascript:;" data-target="#ui-settings"><%= i18n.uiElements %></a></li>\n            <% } %>\n\n            <% if(reports) {%>\n            <li><a href="javascript:;" data-target="#reports-settings"><%= i18n.reportsSettings %></a></li>\n            <% } %>\n\n            <% if(scheduler) {%>\n            <li><a href="javascript:;" data-target="#reports-schedule"><%= i18n.scheduler %></a></li>\n            <% } %>\n\n            <% if(App.isHistoryAllowed()) {%>\n                <li<% if(alarmsOnly) {%> class="active"<% } %>>\n                    <a href="javascript:;" data-target="#alerts-settings">\n                    <%= i18n[alarms ? \'alarmsAndAlerts\' : \'historyWindowSettings\'] %>\n                    </a>\n                </li>\n\n                <% if(!alarmsOnly) {%>\n                <li>\n                    <a href="javascript:;" data-target="#alerts-log-settings">\n                    <%= i18n.alertsLog %>\n                    </a>\n                </li>\n                <% } %>\n            <% } %>\n\n            <% if(App.isAdmin()) {%>\n            <li><a href="javascript:;" data-target="#alerts-directory"><%= i18n.alertsDirectory %></a></li>\n            <li><a href="javascript:;" data-target="#staff"><%= i18n.technicians %></a></li>\n            <% } %>\n\n            <% if(App.allowed(\'geozones.assign\')) {%>\n            <li><a href="javascript:;" data-target="#devices-geozones"><%= i18n.devicesGeozonesBindings %></a></li>\n            <% } %>\n\n            <!--<li><a href="javascript:;" data-target="#maps-settings">Карты</a></li>-->\n            <li><a href="javascript:;" data-target="#section-service"><%= i18n.service %></a></li>\n        </ul>\n    </div>\n    <a class="close"><i class="svg-icon svg-icon-circle-remove"></i></a>\n\n    <% if(!alarmsOnly) {%>\n    <div id="ui-settings" class="section">\n        <h3><%= i18n.uiElements %></h3>\n\n        <div class="params-group objects-watched" style="max-width:65em">\n\n            <h4><%= i18n.objectsOnMap %></h4>\n\n            <div class="control-group">\n                <div class="mobile-view-type hidden">\n                    <!--placeholder-->\n                </div>\n                <div class="stat-view-type hidden">\n                    <!--placeholder-->\n                </div>\n            </div>\n\n        </div><!--/objects-watched-->\n\n        <div class="params-group objects-grouping">\n            <h4><%= i18n.mapGroupingSizeObjects %></h4>\n            <div class="control-group">\n                    <li><label class="checkbox"><input\n                        type="checkbox" name="usedGrouping"\n                        <% if(objectsGrouping.usedGrouping) {%>checked<% } %>\n                        /> <%= i18n.mapGroupingSizeObjectsUsedGrouping %>\n                    </label></li>\n                    <li><label class="checkbox"><input\n                        type="checkbox" name="changeSize"\n                        <% if(objectsGrouping.changeSize) {%>checked<% } %>\n                        /> <%= i18n.mapGroupingSizeObjectsChangeSize %>\n                    </label></li>\n            </div>\n        </div>\n\n        <div class="params-group">\n            <h4><%= i18n.mapObjSearchMode %></h4>\n            <div class="wsm">\n                <ul>\n                    <li><label class="radio"><input<% if(searchMode == 0) { %> checked<% } %>\n                        type="radio" name="mapSearchMode" value="0" /> <%= i18n.mapObjSearchMode1 %></label></li>\n                    <li><label class="radio"><input<% if(searchMode == 1) { %> checked<% } %>\n                        type="radio" name="mapSearchMode" value="1" /> <%= i18n.mapObjSearchMode2 %></label></li>\n                </ul>\n            </div>\n        </div>\n\n        <% if(App.hasMobile() || App.hasStationary()) {%>\n            <div class="params-group objects-title">\n\n                <h4><%= i18n.objectTitleComponents %></h4>\n                <div class="control-group">\n                    <!--<li><label class="checkbox">\n                        <input type="checkbox" name="extId"\n                        <% if(\'extId\' in objectsTitle) {%>checked<% } %>><%= i18n.objIdNumber %>\n                    </label></li>-->\n                    <li><label class="checkbox">\n                        <input type="checkbox" name="name"\n                        <% if(\'name\' in objectsTitle) {%>checked<% } %>><%= i18n.objName %>\n                    </label></li>\n\n                    <% if(App.hasMobile()) {%>\n                    <li><label class="checkbox">\n                        <input type="checkbox" name="licenseNumber"\n                        <% if(\'licenseNumber\' in objectsTitle) {%>checked<% } %>>\n                        <%= i18n.licenseNumber %><% if(App.hasModule(\'stat\')) {%> (<%= i18n.forVehicles %>)<% } %>\n                    </label></li>\n                    <li><label class="checkbox">\n                        <input type="checkbox" name="model"\n                        <% if(\'model\' in objectsTitle) {%>checked<% } %>>\n                        <%= i18n.objModel %><% if(App.hasModule(\'stat\')) {%> (<%= i18n.forVehicles %>)<% } %>\n                    </label></li>\n                    <% } %>\n\n                    <% if(App.hasStationary()) {%>\n                    <!--<li><label class="checkbox">\n                        <input type="checkbox" name="city"\n                        <% if(\'city\' in objectsTitle) {%>checked<% } %>>\n                        <%= i18n.city %> (<%= i18n.forStationary %>)\n                    </label></li>-->\n                    <li><label class="checkbox">\n                        <input type="checkbox" name="addressShort"\n                        <% if(\'addressShort\' in objectsTitle) {%>checked<% } %>>\n                        <%= i18n.address.ucFirst() %><% if(App.hasModule(\'mobile\')) {%> (<%= i18n.forStationary %>)<% } %>\n                    </label></li>\n                    <% } %>\n                </div>\n            </div>\n\n            <div class="params-group objects-baloon">\n                <h4><%= i18n.infoInBaloon %></h4>\n                <div class="control-group whoip ">\n                    <li><label class="checkbox">\n                        <input type="checkbox" name="extId"\n                        <% if(!(\'extId\' in hiddenObjInfoProps)) {%>checked<% } %>><%= i18n.objIdNumber %>\n                    </label></li>\n                    <li><label class="checkbox">\n                        <input type="checkbox" name="deviceTypeName"\n                        <% if(!(\'deviceTypeName\' in hiddenObjInfoProps)) {%>checked<% } %>><%= i18n.objHardwareType %>\n                    </label></li>\n                    <li><label class="checkbox">\n                        <input type="checkbox" name="address"\n                        <% if(!(\'address\' in hiddenObjInfoProps)) {%>checked<% } %>><%= i18n.address.ucFirst() %>\n                    </label></li>\n\n                    <% if(App.hasModule(\'mobile\')) {%>\n                    <li><label class="checkbox">\n                        <input type="checkbox" name="licenseNumber"\n                        <% if(!(\'licenseNumber\' in hiddenObjInfoProps)) {%>checked<% } %>>\n                        <%= i18n.licenseNumber %><% if(App.hasModule(\'stat\')) {%> (<%= i18n.forVehicles %>)<% } %>\n                    </label></li>\n                    <% } %>\n                </div>\n\n                <div class="control-group">\n                    <div class="span6 mwhoip hidden">\n                        <!--placeholder-->\n                    </div><div class="span6 swhoip hidden">\n                        <!--placeholder-->\n                    </div>\n                </div>\n            </div>\n\n        <% } %>\n\n\n        <div class="params-group tracks hidden">\n            <!--placeholder-->\n        </div><!--/tracks-->\n\n        <div class="params-group geozones-watched hidden">\n            <!--placeholder-->\n        </div><!--/geozones-watched-->\n\n        <div class="params-group poi-watched hidden">\n            <!--placeholder-->\n        </div><!--/poi-watched-->\n\n    </div><!--/ui-settings-->\n    <% } %>\n\n    <% if(reports) {%>\n    <div id="reports-settings" class="section hidden">\n        <!--placeholder-->\n    </div>\n    <% } %>\n\n    <% if(scheduler) {%>\n    <div id="reports-schedule" class="section hidden"></div><!--/schedule-->\n    <% } %>\n\n    <% if(App.isHistoryAllowed()) {%>\n        <div id="alerts-settings" class="section<% if(!alarmsOnly) {%> hidden<% } %>">\n            <!--placeholder-->\n        </div>\n        <div id="alerts-log-settings" class="section hidden">\n            <h3><%= i18n.alertsLog %></h3>\n\n            <!--<a href=="#" class="btn btn-alerts-log" data-state="">Toggle alerts log</a>-->\n            <div class="control-group">\n                <label class="checkbox">\n                    <input type="checkbox" name="alertsLog" <%= App.get(\'showAlertsLog\') ? \'checked\' : \'\' %>>\n                    <%= i18n.turnOnAlertsLog %>\n                </label>\n            </div>\n\n            <h4><%= i18n.alertsLogDepth %></h4>\n            <div class="control-group">\n                <input name="alertsLogDepth" type="number" value="<%= alertsLogDepth || 500 %>"\n                       max="1000" min="10" step="5" maxlength="4">\n            </div>\n        </div>\n    <% } %>\n\n    <% if(App.isAdmin()) {%>\n    <div id="alerts-directory" class="section section-grid hidden">\n        <!--placeholder-->\n    </div><div id="staff" class="section section-grid hidden">\n        <!--placeholder-->\n    </div>\n    <% } %>\n\n    <% if(App.allowed(\'geozones.assign\')) {%>\n    <div id="devices-geozones" class="section hidden">\n        <h3><%= i18n.devicesGeozonesBindings %></h3>\n        <div class="section-content row-fluid"></div>\n    </div>\n    <% } %>\n\n    <div class="section hidden" id="section-service">\n        <!--placeholder-->\n    </div>\n\n</div><!--/settings-->\n<!--\n<ul class="accordion">\n    <li data-module="mobile.watched">\n        <h3 class="accordion-heading">\n            Objects on map\n        </h3>\n        <div class="accordion-body active">\n            <ul class="accordion-inner">\n                <li>\n                    <a href="javascript:;" data-key="objViewType">Objects view type</a>\n                </li>\n            </ul>\n        </div>\n    </li>\n    <li class="reports empty"></li>\n    <li>\n        <h3 class="accordion-heading">\n            For Developers\n        </h3>\n        <div class="accordion-body active">\n            <ul class="accordion-inner">\n                <li>\n                    <a href="javascript:;" class="cls">Clear local storage</a>\n                </li>\n            </ul>\n        </div>\n    </li>\n</ul>-->\n'
}),define("text!system/tmpl/service.html",[],function(){return'<% if(allowSimNumbersRequest) {%>\n\n<div class="nav">\n    <h3><%= i18n.service %></h3>\n    <ul>\n        <li>\n            <a data-section="sim" class="active" href="#"><%= i18n.simCardNumbersDetection %></a>\n            <a data-section="ui" href="#"><%= i18n.userSettingsCleaning %></a>\n        </li>\n    </ul>\n</div>\n<form data-section="sim" class="section active" action="">\n    <!-- placeholder -->\n</form>\n<div data-section="ui" class="section">\n    <h3><%= i18n.userSettingsCleaning %></h3>\n    <a href="javascript:" class="cls" style="text-decoration:underline"><%= i18n.clearUserSettings %></a>\n</div>\n\n<% } else { %>\n<h3><%= i18n.userSettingsCleaning %></h3>\n<a href="javascript:" class="cls" style="text-decoration:underline"><%= i18n.clearUserSettings %></a>\n<% } %>\n\n'}),define("system/views/SettingsView",["jquery","jqueryui","underscore","abstracts/View","jqueryui","jface","./SimNumbersView","i18n!_common/nls/common","i18n!../nls/settings","i18n!../auth/nls/auth","text!../tmpl/settings.html","text!../tmpl/service.html","css!../css/settings.css"],function(t,e,i,n,s,o,a,r,l,c,h,d){d=i.template(d);var u=i.extend(c,r,l),p=n.extend({constructor:function(){i.isUndefined(arguments[1])||(this.module=arguments[1]),n.apply(this,arguments)},render:function(){return this.show()},show:function(){if(this.$el.is("#settings"))this.$el.removeClass("hidden");else{var e=App.getStorage(),n={mobile:e.get("mobile")},s=App.getUserData("objectsGrouping")||{usedGrouping:!0,changeSize:!1},o=App.getUserData("objectsTitle")||{name:!0},a=App.getUserData("hiddenObjInfoProps")||{};(App.TYPE_MOBILE in o||App.TYPE_STAT in o)&&(o={name:!0,extId:!0});var r=i.template(h,{i18n:u,searchMode:App.getUserData("mapSearchMode")||0,objectsGrouping:s,objectsTitle:o,hiddenObjInfoProps:a,reports:App.hasModule("reports"),scheduler:App.hasModule("reports")&&!App.isDemo(),alarms:App.allowed("alerts"),alarmsOnly:App.isAlarmOperator(),alertsLogDepth:App.getStorage().get("log.depth"),values:n});t(r).appendTo(t("#page")),this.setElement(t("#settings")),m.activate.call(this),App.trigger("settingsready")}App.trigger("settingsopen")},hide:function(){this.$el.addClass("hidden"),App.trigger("settingsclose"),App.trigger("startall")}}),m={activate:function(){var e=this;this.$el.on("click",".close",function(){e.hide()}).find(".nav").on("click","a[data-target]",function(){var i=t(this),n=i.data("target");e.$el.find(">.section").not(".hidden").addClass("hidden").trigger("hidesection"),t(n).removeClass("hidden").trigger("showsection"),e.$el.find(">.nav .active").removeClass("active"),i.parent().addClass("active")}),this.$el.find(".wsm").on("click","input",function(){this.checked&&App.setUserData("mapSearchMode",parseInt(this.value))}),m.initAlertsLogSettings.call(this);var i=this.$el.find(".objects-grouping");i.on("click","input",function(){m.setObjectsGrouping.call(e)});var n=this.$el.find(".objects-title");n.on("click","input",function(){m.setObjectsTitle.call(e)});var s=this.$el.find(".objects-baloon");if(s.on("click","input",function(){m.setObjectsBaloonHiddenProperties.call(e)}),this.$el.find("#section-service").one("showsection",function(){m.renderServiceSection.call(e,t(this))}),App.isAdmin()&&(this.$el.find("#alerts-directory").one("showsection",function(){requirejs(["_common/alerts/views/AlarmsDirectoryView"],function(t){new t({i18n:u}).render()})}),this.$el.find("#staff").one("showsection",function(){requirejs(["system/views/StaffGridView"],function(t){new t({i18n:u}).render()})})),App.allowed("geozones.assign")){var o=this.$el.find("#devices-geozones");o.on("showsection",function(){o.data("controller")||requirejs(["_common/alerts/devicesGeozones/DevicesGeozonesController"],function(t){var e=new t({id:"alerts/devicesGeozones",container:o.find(".section-content")});o.data("controller",e)})})}},setObjectsGrouping:function(){var t=this.$el.find(".objects-grouping input"),e={};t.each(function(){e[this.name]=this.checked}),App.setUserData("objectsGrouping",e),App.trigger("objectsGroupingChange")},setObjectsTitle:function(){var t=this.$el.find(".objects-title input"),e={},i=!1;t.each(function(){this.checked&&(i=!0,e[this.name]=!0)}),i||(e={name:!0}),App.setUserData("objectsTitle",e),App.trigger("objectsTitleChange")},setObjectsBaloonHiddenProperties:function(){var t=this.$el.find(".objects-baloon input"),e={};t.each(function(){this.checked||(e[this.name]=!0)}),App.setUserData("hiddenObjInfoProps",e),App.trigger("hiddenObjInfoPropsChange")},initAlertsLogSettings:function(){this.$el.find("input[name=alertsLog]").on("click",function(){App.set("showAlertsLog",this.checked)}),this.$el.find("input[name=alertsLogDepth]").on("blur",function(){var e=t(this),n=parseInt(e.val());n=Math.min(Math.max(n,10),1e3),i.isNaN(n)&&(n=500),e.val(n),App.getStorage().set("log.depth",n),App.modules.log&&App.modules.log.set("depth",n)})},renderServiceSection:function(t){var e=this;t.html(d({allowSimNumbersRequest:App.isAdmin()&&App.isSmsFromDevicesAllowed(),i18n:u})),App.isAdmin()&&(m.renderSimNumbersView.call(this,t.find('.section[data-section="sim"]')),m.initPageWithNav(t)),this.$el.find("a.cls").on("click",function(){return o.confirm(u.clearUserSettingsConfirm,u.areYouSure,{okCallback:function(){return e.model.flushSettings()}})})},renderSimNumbersView:function(t){new a({el:t,i18n:u})},initPageWithNav:function(e){e.find(">.nav").on("click","[data-section]",function(){m.setActiveSection(e,t(this).data("section"))})},setActiveSection:function(t,e){t.find(">.section.active").removeClass("active").trigger("hide"),t.find(">.nav .active").removeClass("active"),t.find('>.section[data-section="'+e+'"]').addClass("active").trigger("show"),t.find('>.nav [data-section="'+e+'"]').addClass("active")}};return p}),define("system/views/SettingsGridView",["jquery","underscore","jface","abstracts/View","datatables","css!_libs/grids/DataTables/css/jquery.dataTables.cropped.css"],function(t,e,i,n){var s=n.prototype,o=n.extend({constructor:function(){this.loading=!1,this._gridDestroyTmt=null,this._grid=null,this._popup=null,this._i18n=null,n.apply(this,arguments)},_ns:"",_data:null,_hasContext:!1,initialize:function(){var e=this;t("#settings").length?this._initSettings():this.listenTo(App,"settingsready",function(){e._initSettings()}),this.listenTo(App,"settingsclose",function(){e._setDestroyTimeout(),e._popup&&e._popup.trigger("jw.close"),t(window).off("resizestop"+e._ns)}).listenTo(App,"settingsopen",function(){e.$el.hasClass("hidden")||(e._clearDestroyTimeout(),e._grid||e.render()),e._grid&&t(window).on("resizestop"+e._ns,function(){e._grid&&(e._grid.fnSettings().oScroll.sY=e.$el.find(".grid").height()-41,e._grid.fnDraw())})})},render:function(){var t=this;t.$el.addClass("loading"),t._loadData().done(function(){t._buildGrid()}).always(function(){t.$el.removeClass("loading")})},showErrors:function(t){if(t){var i=this,n=[];e.isArray(t)?t.length&&(e.each(t,function(t){i._popup&&i._popup.find("[name="+t.key+"]").closest(".control-group").addClass("error"),n.push(t.msg+".")}),alert(n.join("<br />"),this._i18n.error)):s.showErrors.call(this,t)}},_initSettings:function(){var t=this;this._renderLayout(),this.$el.on("showsection",function(){t._clearDestroyTimeout(),t._grid||t.render()}).on("hidesection",function(){t._setDestroyTimeout(),t._popup&&t._popup.trigger("jw.close")}),t._initEditor()},_loadData:function(){},_renderLayout:function(){},_buildGrid:function(){var e=this,i=this.$el.find(".grid"),n=i.find("table"),s=this._getGridOptions();this._grid=n.dataTable(s),t(window).on("resizestop"+this._ns,function(){e._grid&&(e._grid.fnSettings().oScroll.sY=i.height()-41,e._grid.fnDraw())}),this._initSearch()},_getGridOptions:function(){var t=this.$el.find(".grid");return{data:[],columns:[],orderClasses:!1,paging:!1,info:!1,deferRender:!0,scrollY:t.height()-41,scrollCollapse:!0,language:{search:this._i18n.search+":",zeroRecords:this._i18n.nothingFoundByYourRequest}}},_formatRowEdit:function(t){return'<svg class="svg-icon icon-edit" data-id="'+t+'">'+'<use xlink:href="#smb-edit"></use>'+"</svg>"},_formatRowDelete:function(t){return'<i data-id="'+t+'" class="icon-delete svg-icon svg-icon-remove"></i>'},_formatRowCheck:function(t){return t?'<i class="svg-icon svg-icon-checkmark"></i>':""},_initSearch:function(){var e=this,i=this.$el.find(".dataTables_filter").addClass("form-search");i.append('<i class="icon-clear svg-icon svg-icon-circle-remove"></i>'),this._grid.on("search.dt",function(){if(e._grid){var n=t.trim(e._grid.DataTable().search());n.length?i.addClass("active"):i.removeClass("active")}}),i.on("click",".icon-clear",function(){i.find("input").val(""),e._grid.DataTable().search("").draw()})},_initEditor:function(){var e=this;this.on("rowedit",e._startEdit),this.on("rowdelete",function(){showCursor(),e.loading=!0,e._delete.apply(e,arguments).done(function(){e._onDeleteSuccess.apply(e,arguments)}).fail(function(t){e.showErrors(t)}).always(function(){hideCursor(),e.loading=!1})}),this.$el.on("click",".add-row-link",function(){e.trigger("rowedit",null)}),this._hasContext?(this.$el.on("click",".icon-edit",function(t){t.stopPropagation(),e.$el.contextmenu("open",t)}),this._initContextMenu()):this.$el.on("click",".icon-edit",function(){e.trigger("rowedit",t(this).data("id"))})},_initContextMenu:function(){},_startEdit:function(){},_validate:function(){return null},_save:function(){},_addRow:function(e){var i=this._grid.DataTable(),n=i.row.add(e).draw().node();t(i.table().node().parentNode).scrollTo(n)},_getRow:function(t){return this._grid.DataTable().row(this.$el.find("tr[data-id="+t+"]"))},_updateRow:function(){},_delete:function(){},_onDeleteSuccess:function(t){this._deleteFromData(t),this._deleteFromGrid(t)},_deleteFromData:function(t){if(e.isArray(this._data))for(var i=this._data,n=i.length;n--;)if(i[n].id==t){i.splice(n,1);break}},_deleteFromGrid:function(e){var i=this._getRow(e),n=t(i.node()),s=n.next();s.length||(s=n.prev()),i.remove().draw(),s.length&&t(this._grid.DataTable().table().node().parentNode).scrollTo(s)},_clearDestroyTimeout:function(){this._gridDestroyTmt&&clearTimeout(this._gridDestroyTmt),this._gridDestroyTmt=null},_setDestroyTimeout:function(){var t=this;this._clearDestroyTimeout(),this._gridDestroyTmt=setTimeout(function(){t._destroyGrid()},3e4)},_destroyGrid:function(){this._grid&&(this._grid.DataTable().destroy(),this._grid=null,t(window).off("resizestop"+this._ns))}});return o}),define("maps/MapLayer",[],function(){function t(t,e){this._map=t,this._widget=e,this._protocol="http"+(App.isHttpsClient()?"s":"")+"://",this._cont=null,this._canvas=null,this._context=null,this.enabled=!1}return $.extend(t.prototype,{destroy:function(){this.disable()},setTrigger:function(t){this._trigger=$(t)},getTrigger:function(){return this._trigger},getMapClass:function(){return this._map.getClass()},setMap:function(t){this._map=t},setWidget:function(t){this._widget=t}}),t}),define("maps/TilesMapLayer",["util","maps/GeoMap","maps/MapLayer"],function(e,i,n){function s(){n.apply(this,arguments),this._tiles=null,this._trigger=null}return e.extend(s,n),function(){for(var t=["getClass","getEmptySrc","_getSourceUrl","_buildImgParams"],e=t.length;e--;)!function(e){var i=t[e];s.prototype[i]=function(){return this._map[i].apply(this,arguments)}}(e);for(t=["getZoom","getMinZoom","getMaxZoom","checkZoomAvailable","getMaxTileNumber"],e=t.length;e--;)!function(e){var i=t[e];s.prototype[i]=function(){return this._map[i].apply(this._map,arguments)}}(e)}(),$.extend(s.prototype,{enable:function(){if(null===this._cont){var t=this;return this._init(function(){t.enable()}),void 0}this._trigger&&this._trigger.addClass("active"),this._cont.removeClass("hidden"),this._buildTiles(),this.enabled=!0},disable:function(){this._cont&&this._cont.addClass("hidden"),this._tiles&&this._tiles.remove(),this._tiles=null,this._trigger&&this._trigger.removeClass("active"),this.enabled=!1},_buildTiles:function(){for(var e=(this._widget.position,this._widget.getDimensions()),n="",s=this._map.getZoom(),o=this._widget.firstTile,a=j=0,r=t=0,l=null,c=[];a<e.rows;++a)for(j=0;j<e.cols;++j)l=null,r=j*i.TILE_SIZE,t=a*i.TILE_SIZE,n=this.getImgSrc(o.x+j,o.y+a,s),l=this._getReusableTile(n),l||(l=new Image,l.src=n,l.className="tile load"),l.style.left=r+"px",l.style.top=t+"px",c.push(l);this._cont.html(c);for(var h=this,a=c.length;a--;)$(c[a]).on("error",function(){this.src=h.getEmptySrc(),$(this).remove()}).on("load",function(){this.className=this.className.replace(/\s+load/gi,"")});this._tiles=this._cont.find("img:not[.error]")},onbuild:function(){this._buildTiles()},onzoomstart:function(){this._tiles&&this._tiles.remove(),this._tiles=null},onstart:function(){},onstop:function(){this._buildTiles()},getImgSrc:function(t,e,i){var n=this.getMaxTileNumber();return 0>e||e>n?this.getEmptySrc():(0>t?t=0:t>=n+1&&(t%=n+1),i<this.getMinZoom()||i>this.getMaxZoom()?this.getEmptySrc():this._getSourceUrl()+this._buildImgParams(t,e,i))},_getReusableTile:function(t){if(!this._tiles||!this._tiles.length)return null;var e=new RegExp("x=\\d+&y=\\d+&z?=\\d+"),i=e.exec(t),n=null;return i=i?i[0]||"":null,i&&(n=this._tiles.filter('[src*="'+i+'"]')[0]),n},_init:function(){}}),s}),define("maps/TrafficMapLayer",["util","maps/TilesMapLayer","module"],function(t,e){function i(){e.apply(this,arguments),this._trigger=null}return i.__CLASS__="TrafficMapLayer",i.HOST=null,i.DEFAULT_PARAMS="",t.extend(i,e),$.extend(i.prototype,{_init:function(t){this._cont&&this._cont.length||(this._widget.getDimensions(),this._widget.addLayer('<div id="traffic-cont" class="map-layer hidden"></div>'),this._cont=$("#traffic-cont"),t&&t())},setMap:function(t){t.getTrafficLayerClass&&t.getTrafficLayerClass()==this.getClass()&&(this._map=t)},toggle:function(){this.enabled?this.disable():this.enable()}}),i}),define("maps/YandexMap",["jquery","underscore","util","geo","maps/GeoMap"],function(t,e,i,n,s){var o=null,a="21.06.08-0-b210520094930",r="map",l=function(){this._loadingRoutingAPI=!1,this._waitInterval=null,this._waitDfds=[],s.apply(this,arguments)};return i.extend(l,s,["getName","getCode"]),l.__CLASS__="YandexMap",l.code="yandex",l.mapName="Карта Yandex",l.HOST=["core-renderer-tiles"],l.DEFAULT_PARAMS="/tiles?l=map&v="+a,l.MAX_ZOOM=18,l.detectVersion=function(i){if(!i)return a;if(!e.isNull(a))return i();var n=this;t.ajax({dataType:"text",url:this._protocol+"api-maps.yandex.ru/1.1.1/xml/data.xml?v=1.45.0",success:function(t){var e=new RegExp(r+"s*:s*[\"']([0-9.]+)[\"']"),s=e.exec(t);s.length&&(a=s[1]),n.DEFAULT_PARAMS+=a,i()}})},t.extend(l.prototype,{getProjectionType:function(){return"yandex"},_buildImgParams:function(t,e,i){return"&x="+t+"&y="+e+"&z="+i+"&lang="+this.getLocale()},getSourceData:function(){return{url:"https://{s}.maps.yandex.net"+l.DEFAULT_PARAMS+"&x={x}&y={y}&z={z}&scale=1&lang="+this.getLocale(),sub:["core-renderer-tiles"]}},latToY:function(t){t>90&&(t-=180),-90>t&&(t+=180);var e=Math.sin(t*Math.PI/180),i=this._size/(2*Math.PI),s=Math.round(this._size/2-i*(Math.atanh(e)-n.D_EXT*Math.atanh(n.D_EXT*e)));return s===-1/0?s=0:1/0===s&&(s=this._size),s},yToLat:function(t){var e=1;t>this._size/2&&(t=this._size-t,e=-1);var i=(t-this._size/2)/-(this._size/Math.PI2),s=2*Math.atan(Math.exp(i))/Math.PI2-1/(2*Math.PI),o=t-this._size/2,a=0;do a=s,s=Math.asin(1-(1+Math.sin(a))*Math.pow(1-n.D_EXT*Math.sin(a),n.D_EXT)/(Math.exp(2*o/-(this._size/Math.PI2))*Math.pow(1+n.D_EXT*Math.sin(a),n.D_EXT)));while(Math.abs(a-s)>n.MerkElipsK&&!isNaN(s));return 180*e*(isNaN(s)?a:s)/Math.PI},getTrafficLayerClass:function(){return"YandexTrafficMapLayer"},routingTraffic:function(){return!0},loadRouting:function(){var e=this,i=new t.Deferred;if(this.routingReady())i.resolve();else if(o)e._routingService=o,i.resolve();else if(this._loadingRoutingAPI)if(this._waitInterval)this._waitDfds.push(i);else{var n=0;this._waitDfds.push(i),this._waitInterval=setInterval(function(){++n>=20&&e._clearWaiting(!1)},200)}else{this._loadingRoutingAPI=!0;var s=App.getServerSettings(),a="",r="api-maps.yandex.ru";"yandexApiKey"in s&&(r="enterprise."+r,a="&apikey="+s.yandexApiKey),t.getScript("https://"+r+"/2.1/?load=package.route&lang="+this.getLocale()+a).done(function(){ymaps.ready(function(){e._loadingRoutingAPI=!1,o=e._routingService=ymaps,e._clearWaiting(!0),i.resolve()})}).fail(function(){e._clearWaiting(!1),i.reject()})}return i},_clearWaiting:function(t){this._waitInterval&&(clearInterval(this._waitInterval),this._waitInterval=null,e.each(this._waitDfds,function(e){e[t?"resolve":"reject"]()}),this._waitDfds=[])},_calcRoute:function(e){for(var i=this,n=new t.Deferred,s=[],o=0,a=e.length;a>o;o++)s.push(e[o].lat&&e[o].lon?e[o].lat+","+e[o].lon:e[o].text);return this._routingService.route(s,{avoidTrafficJams:!0}).then(function(t){n.resolve(i._parseRouteData(t))},function(t){n.reject(t||null)}),n},_parseRouteData:function(t){var i,n,o,a,r,l,c,h,d,u,p,m=new s.RouteData,f={},g=[],v="";f.source="Yandex",f.bounds=t.properties.get("boundedBy"),f.length=t.getLength(),f.roundLength=0,f.time=t.getTime(),f.trafficTime=t.getJamsTime(),f.roundTime=0,m.meta=f;for(var _=0,b=t.getPaths().getLength();b>_;_++){r=t.getPaths().get(_),l=r.getSegments();for(var y=0;y<l.length;y++)c=l[y],v=c.getStreet(),h=c.getLength(),d=m.roundLength(h),f.roundLength+=d,u=c.getTime(),p=m.roundTime(c.getJamsTime()),f.roundTime+=p,i={index:y,bounds:c.properties.get("boundedBy"),length:h,roundLength:d,roundLengthS:m.formatLength(d),angle:c.getAngle(),time:u,trafficTime:c.getJamsTime(),roundTime:p,roundTimeS:m.formatTime(p),road:v,action:this._prepareActionCode(c.getAction()),actionText:c.getHumanAction().ucFirst()+(v?", "+v:""),actionHtml:"<b>"+c.getHumanAction().ucFirst()+"</b>"+(v?", "+v:""),points:c.getCoordinates()},n&&(a=e.last(n.points),i.points.length<2?i.points.unshift(e.clone(a)):(o=e.first(i.points),(o[0]!=a[0]||o[1]!=a[1])&&i.points.unshift(e.clone(a)))),g.push(i),n=i}return f.roundTimeS=m.formatTime(f.roundTime),f.roundLengthS=m.formatLength(f.roundLength),m.steps=g,m},_prepareActionCode:function(t){var e=t;return(-1!=t.indexOf("leave roundabout")||"enter roundabout"==t)&&(e=e.replace(/ /g,"-")),/^(slight|hard|exit|fork) /.test(t)&&(e=e.replace(/ /g,"-").replace("hard","sharp")),e}}),l}),define("maps/YandexMapSat",["underscore","util","maps/YandexMap"],function(t,e,i){function n(){i.apply(this,arguments)}var s="3.745.0";return e.extend(n,i,["getName","getCode","detectVersion"]),n.__CLASS__="YandexMapSat",n.code="yandexsat",n.mapName="Спутник Yandex",n.HOST=["sat01.maps.yandex.net","sat02.maps.yandex.net","sat03.maps.yandex.net","sat04.maps.yandex.net"],n.DEFAULT_PARAMS="/tiles?l=sat&v="+s,n.MAX_ZOOM=18,$.extend(n.prototype,{_buildImgParams:function(t,e,i){return"&x="+t+"&y="+e+"&z="+i},getSourceData:function(){return{url:this._protocol+"{s}.maps.yandex.net"+n.DEFAULT_PARAMS+"&lang=ru_RU&x={x}&y={y}&z={z}",sub:["sat01","sat02","sat03","sat04"]}},getHybridLayerClass:function(){return"YandexHybridMapLayer"}}),n}),define("maps/HybridMapLayer",["jquery","underscore","util","maps/TilesMapLayer"],function(t,e,i,n){function s(){s.superclass.constructor.apply(this,arguments),this._trigger=null}return s.__CLASS__="HybridMapLayer",s.HOST=null,s.DEFAULT_PARAMS="",i.extend(s,n),t.extend(s.prototype,{_init:function(e){this._cont&&this._cont.length||(this._widget.addLayer('<div id="hybrid-cont" class="map-layer hidden"></div>'),this._cont=t("#hybrid-cont"),e&&e())},setMap:function(t){this._map=t},toggle:function(){this.enabled?this.disable():this.enable()}}),s}),define("maps/YandexMapHybrid",["underscore","util","maps/YandexMap","maps/YandexMapSat","maps/HybridMapLayer"],function(t,e,i,n,s){function o(){n.apply(this,arguments)}function a(){s.apply(this,arguments)}var r="21.02.19-0-b210127150800",l=null;return e.extend(o,n,["getName","getCode"]),o.__CLASS__="YandexMapHybrid",o.code="yandexhybrid",o.mapName="Гибрид Yandex",o.HOST=n.HOST,o.DEFAULT_PARAMS=n.DEFAULT_PARAMS,o.MAX_ZOOM=n.MAX_ZOOM,$.extend(o.prototype,{isHybrid:function(){return!0},getExtraLayer:function(t){return l?l:l=new a(this,t)},destroyExtraLayer:function(){l&&l.destroy(),l=null}}),e.extend(a,s),a.__CLASS__="YandexHybridMapLayer",a.HOST=["vec01.maps.yandex.net","vec02.maps.yandex.net","vec03.maps.yandex.net","vec04.maps.yandex.net"],a.DEFAULT_PARAMS="/tiles?l=skl&v="+r,$.extend(a.prototype,{_buildImgParams:function(){return n.prototype._buildImgParams.apply(this,arguments)},getSourceData:function(){return{url:this._protocol+"{s}.maps.yandex.net"+a.DEFAULT_PARAMS+"&lang="+this.getLocale()+"&x={x}&y={y}&z={z}",sub:["vec01","vec02","vec03","vec04"]}},getLocale:function(){return App.getLocale().replace("-","_")}}),o}),define("maps/YandexTrafficMapLayer",["jquery","util","maps/YandexMap","maps/TrafficMapLayer","module"],function(t,e,i,n){function s(){n.apply(this,arguments)}return e.extend(s,n),s.__CLASS__="YandexTrafficMapLayer",s.HOST=["jgo.maps.yandex.net"],s.DEFAULT_PARAMS="/1.1/tiles?trf&l=trf,trfe&lang=ru_RU&scale=1",s._lastUpdateTS=null,s._getLastUpdateTSOld=function(){var t=new Date;if(null===this._lastUpdateTS||t.getTime()/1e3-240>this._lastUpdateTS){var e=t.getFullYear(),i=t.getMonth(),n=t.getDate(),s=t.getHours(),o=t.getMinutes();o-=0===o%4?4:o%4,o-=4;var a=new Date(e,i,n,s,o,0);this._lastUpdateTS=a.getTime()/1e3}return this._lastUpdateTS},s._getLastUpdateTS=function(){var e=new t.Deferred,i=new Date;return null===this._lastUpdateTS||i.getTime()/1e3-240>this._lastUpdateTS?t.ajax({url:"https://api-maps.yandex.ru/services/coverage/v2/layers_stamps?lang=ru_RU&l=trf",cache:!1,type:"GET",method:"GET",dataType:"jsonp",beforeSend:function(){},success:function(t){t.data&&t.data.trf&&t.data.trf.version?(this._lastUpdateTS=Number(t.data.trf.version),e.resolve(this._lastUpdateTS)):e.reject()}.bind(this),error:function(){e.reject()}}):e.resolve(this._lastUpdateTS),e},t.extend(s.prototype,{_buildImgParams:function(){var t=i.prototype._buildImgParams.apply(this,arguments);return t+="&tm="+s._getLastUpdateTS()},getSourceData:function(){var e=new t.Deferred;return s._getLastUpdateTS().done(function(t){e.resolve({url:"https://{s}.maps.yandex.net"+s.DEFAULT_PARAMS+"&tm="+t+"&x={x}&y={y}&z={z}",sub:["core-jams-rdr"]})}).fail(function(){e.reject()}),e},_getReusableTile:function(t){if(!this._tiles||!this._tiles.length)return null;var e=new RegExp("x=\\d+&y=\\d+&z?=\\d+&tm="+s._getLastUpdateTS()),i=e.exec(t),n=null;return i=i?i[0]||"":null,i&&(n=this._tiles.filter('[src*="'+i+'"]')[0]),n}}),s}),define("maps/GoogleHybridMapLayer",["jquery","underscore","util","./HybridMapLayer"],function(t,e,i,n){function s(){n.apply(this,arguments)}i.extend(s,n),s.__CLASS__="GoogleHybridMapLayer";var o="!3i366039226",a="/maps/vt/pb=!1m5!1m4!1i";return t.extend(s.prototype,{getSourceData:function(){var t=App.getLocale().substr(0,2);return{url:this._protocol+"{s}.google.com/"+a+"{z}!2i{x}!3i{y}"+"!4i256!2m2!1e"+"0"+o+"!3m7!2s"+t+"!3s"+t+"!5e1105!12m1!1e4!12m1!1e47!12m1!1e3!4e0",sub:["www"]}}}),s}),define("async",[],function(){function t(t){var e,i;e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src=t,i=document.getElementsByTagName("script")[0],i.parentNode.insertBefore(e,i)}function e(t,e){var i=/!(.+)/,s=t.replace(i,""),o=i.test(t)?t.replace(/.+!/,""):n;return s+=s.indexOf("?")<0?"?":"&",s+o+"="+e}function i(){return s+=1,"__async_req_"+s+"__"}var n="callback",s=0;return{load:function(n,s,o,a){if(a.isBuild)o(null);else{var r=i();window[r]=o,t(e(n,r))}}}}),define("maps/GoogleMap",["underscore","util","./GeoMap","./GoogleHybridMapLayer","async"],function(t,e,i,n){var s=null,o="!3i543268322",a=function(){i.apply(this,arguments),this.scode="GGL",this._extraLayer=null};return e.extend(a,i,["getName","getCode"]),a.__CLASS__="GoogleMap",a.code="google",a.mapName="Карта Google",a.HOST=["www.google.ru"],a.DEFAULT_PARAMS="maps/vt/pb=!1m5!1m4!1i",a.MAX_ZOOM=18,t.extend(a.prototype,{SEARCH_DATA_TYPE:"json",getSourceData:function(){var t=this.getLocale();return{url:this._protocol+"{s}.google.com/"+a.DEFAULT_PARAMS+"{z}!2i{x}!3i{y}"+"!4i256!2m2!1e"+"0"+this.getVersion()+"!3m2"+"!2s"+t+"!3s"+t+"!5e1105!12m1!1e4!12m1!1e47!12m1!1e3!4e0",sub:["www"]}},getLocale:function(){return App.getLocale().substr(0,2)},getVersion:function(){return o},isHybrid:function(){return!1},getExtraLayer:function(t){return this._extraLayer?this._extraLayer:(this._extraLayer=new n(this,t),this._extraLayer)},destroyExtraLayer:function(){this._extraLayer&&this._extraLayer.destroy(),this._extraLayer=null},getTrafficLayerClass:function(){return"GoogleTrafficMapLayer"},getSearchUrl:function(t){var e="";t.bounds&&(e="&bounds="+t.bounds[1][0]+","+t.bounds[0][1]+"|"+t.bounds[0][0]+","+t.bounds[1][1]);var i=App.getServerSettings(),n="";"googleApiKey"in i&&(n="&key="+i.googleApiKey);var s="https://maps.googleapis.com/maps/api/geocode/json?&"+encodeURI("address="+t.q)+e+"&language="+this.getLocale()+n;return s},parseSearchJSON:function(t){for(var e=[],i=t.results,n=null,s=0;s<i.length;s++)n=i[s],e.push({lat:n.geometry.location.lat,lon:n.geometry.location.lng,title:n.formatted_address,original:n});return e},getGeocodeUrl:function(t){var e=App.getServerSettings(),i="";return"googleApiKey"in e&&(i="&key="+e.googleApiKey),"https://maps.googleapis.com/maps/api/geocode/json?latlng="+t.lat+","+t.lon+"&language="+this.getLocale()+i},parseGeocodeJSON:function(t){if(t.scode)return t;if("OK"!==t.status)throw new Error(t.error_message||"No addresses found");try{return{address:t.results[0].formatted_address}}catch(e){throw console&&console.error("Seems to be response structure changed"),e}},loadRouting:function(){var t=this,e=new $.Deferred;if(this.routingReady())e.resolve();else if(s)t._routingService=s,e.resolve();else{var i=App.getServerSettings(),n="";"googleApiKey"in i&&(n="&key="+i.googleApiKey),requirejs(["async!//maps.googleapis.com/maps/api/js?v=3.exp&language="+this.getLocale()+n],function(){s=t._routingService=new google.maps.DirectionsService,e.resolve()},function(){e.reject("Can not load Google routing API")})}return e},_calcRoute:function(t){for(var e=this,i=new $.Deferred,n=[],s=0,o=t.length;o>s;s++)n.push(t[s].lat&&t[s].lon?t[s].lat+","+t[s].lon:t[s].text);var a={origin:n[0],destination:n[n.length-1],travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC};return n.length>2&&(a.waypoints=n.slice(1,-1).join("|")),this._routingService.route(a,function(t,n){if(n==google.maps.DirectionsStatus.OK){var s=t.routes[0];i.resolve(e._parseRouteData(s))}else i.reject()}),i},_parseRouteData:function(t){var e,n,s,o,a,r,l,c,h,d,u,p,m,f,g=new i.RouteData,v=t.bounds.getNorthEast(),_=t.bounds.getSouthWest(),b=0,y=0,w={},x=[];w.source="Google",w.roundTime=0,w.roundLength=0,w.bounds=[[_.lat(),_.lng()],[v.lat(),v.lng()]];for(var C=0,S=t.legs.length;S>C;C++){n=t.legs[C],s=n.steps,b+=n.duration.value,y+=n.distance.value;for(var T=0;T<s.length;T++){o=s[T],u=o.distance.value,p=g.roundLength(u),w.roundLength+=p,m=o.duration.value,f=g.roundTime(m),w.roundTime+=f,e={index:T,length:u,roundLength:p,roundLengthS:g.formatLength(p),time:m,roundTime:f,roundTimeS:g.formatTime(f),action:this._prepareActionCode(o.maneuver),actionHtml:o.instructions,road:""},r=o.lat_lngs.length,a=[[null,null],[null,null]],c=new Array(r);for(var A=0;r>A;A++)l=o.lat_lngs[A],h=l.lat(),d=l.lng(),c[A]=[h,d],(null===a[0][0]||a[0][0]>h)&&(a[0][0]=h),(null===a[0][1]||a[0][1]>d)&&(a[0][1]=d),(null===a[1][0]||a[1][0]<h)&&(a[1][0]=h),(null===a[1][1]||a[1][1]<d)&&(a[1][1]=d);e.points=c,e.bounds=a,x.push(e)}}return w.length=y,w.roundLengthS=g.formatLength(w.roundLength),w.time=b,w.roundTimeS=g.formatTime(w.roundTime),g.meta=w,g.steps=x,g},_prepareActionCode:function(t){return""==t||"straight"==t?"none":"turn-right"==t||"turn-left"==t?t.replace("turn-",""):/(slight|exit|ramp|fork|sharp)/.test(t)?t.replace(/ /g,"-").replace("turn-","").replace("ramp","exit"):"roundabout-right"==t?"leave-roundabout":"merge"==t?t:"unknown"}}),a}),define("maps/nls/google",{root:{errBreak:'Try to open <a href="#url#" target="_blank">this link</a>. If the opened page asks you to determine whether or not you are human, enter the code, and then reload the monitoring page.<br />The selected scale can be unavailable for the current zone. Try to change the map type, or go to another zone, or scale down',errBreakHdr:"The map is not available"},"ru-ru":!0,"it-it":!0}),define("maps/nls/ru-ru/google",{errBreak:'Попробуйте открыть <a href="#url#" target="_blank">эту ссылку</a>. Если на полученной странице Вас попросят подтвердить, что Вы не робот, введите код, a затем перезагрузите страницу мониторинга.<br />Также возможно, что выбранный масштаб недоступен для данной области. Попробуйте сменить тип карты или перейти к другой области, или уменьшить масштаб',errBreakHdr:"Карта недоступна"}),define("maps/GoogleMapSat",["underscore","util","./GoogleMap","i18n!./nls/google"],function(t,e,i,n){function s(){i.apply(this,arguments)}var o="!3i894";return e.extend(s,i,["getName","getCode"]),s.__CLASS__="GoogleMapSat",s.code="googlesat",s.mapName="Спутник Google",s.MAX_ZOOM=19,t.extend(s.prototype,{getSourceData:function(){var t=this.getLocale();return{url:this._protocol+"{s}.google.com/"+i.DEFAULT_PARAMS+"{z}!2i{x}!3i{y}"+"!4i256!2m2!1e"+"1"+o+"!3m9!2s"+t+"!3s"+t+"!5e1105!12m1!1e4!12m1!1e47!12m1!1e3!4e0",sub:["www"],onBreak:function(t){alert(n.errBreak.replace("#url#",t.url),n.errBreakHdr)}}},getHybridLayerClass:function(){return"GoogleHybridMapLayer"}}),s}),define("maps/GoogleMapHybrid",["underscore","util","./GoogleMap","./GoogleMapSat"],function(t,e,i,n){function s(){n.apply(this,arguments)}return e.extend(s,n,["getName","getCode"]),s.__CLASS__="GoogleMapHybrid",s.code="googlehybrid",s.mapName="Гибрид Google",s.HOST=n.HOST,s.DEFAULT_PARAMS=n.DEFAULT_PARAMS,s.MAX_ZOOM=n.MAX_ZOOM,$.extend(s.prototype,{isHybrid:function(){return!0}}),s}),define("maps/GoogleMapTerrain",["underscore","util","./GoogleMap","i18n!./nls/google"],function(t,e,i,n){function s(){i.apply(this,arguments)}var o="t@132,r@296348011";return e.extend(s,i,["getName","getCode"]),s.__CLASS__="GoogleMapTerrain",s.code="googleter",s.mapName="Рельеф Google",s.HOST=["mts0.google.ru","mts1.google.ru","mts2.google.ru","mts3.google.ru"],s.DEFAULT_PARAMS="/vt/lyrs="+o+"&src=app&s=Galile",s.MAX_ZOOM=15,t.extend(s.prototype,{getSourceData:function(){return{url:this._protocol+"{s}.google.com"+s.DEFAULT_PARAMS+"&hl="+this.getLocale()+"&x={x}&y={y}&z={z}",sub:["mts0","mts1","mts2","mts3"],onBreak:function(t){alert(n.errBreak.replace("#url#",t.url),n.errBreakHdr)}}}}),s}),define("maps/GoogleTrafficMapLayer",["jquery","util","maps/GoogleMap","maps/TrafficMapLayer","module"],function(t,e,i,n){function s(){n.apply(this,arguments)}return e.extend(s,n),s.__CLASS__="GoogleTrafficMapLayer",s.HOST=["mts0.google.com","mts1.google.com"],s.DEFAULT_PARAMS="/vt/src=app&style=15&lyrs=m@209000000,traffic",t.extend(s.prototype,{_buildImgParams:function(){return params="|seconds_into_week:-1"+i.prototype._buildImgParams.apply(this,arguments)},getSourceData:function(){return(new t.Deferred).resolve({url:this._protocol+"{s}.google.com"+"/vt/src=app&style=15&lyrs=m@209000000,traffic|seconds_into_week:-1&hl=ru&x={x}&y={y}&z={z}",sub:["mts0","mts1","mts2"]})}}),s}),define("maps/OpenStreetMap",["underscore","util","maps/GeoMap"],function(t,e,i){function n(){i.apply(this,arguments),this._protocol="http://",this.scode="OSM"}return e.extend(n,i,["getName","getCode"]),n.__CLASS__="OpenStreetMap",n.code="omap",n.mapName="Карта OpenStreetMap",n.DEFAULT_PARAMS="/",n.MAX_ZOOM=18,t.extend(n.prototype,{_buildImgParams:function(t,e,i){return i+"/"+t+"/"+e+".png"},getSourceData:function(){return this._useCache?function(){var t=x/1024,e=y/1024;return t=t>1?parseInt(t):0,e=e>1?parseInt(e):0,{url:"cache/"+n.code+"/{z}/"+t+"/{x}/"+e+"/{y}.png"}}:{url:this._protocol+"{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",sub:"abc"}},getTrafficLayerClass:function(){return"GoogleTrafficMapLayer"},getSearchUrl:function(t){var e="";return t.bounds&&(e="&viewbox="+t.bounds[0][1]+","+t.bounds[0][0]+","+t.bounds[1][1]+","+t.bounds[1][0]),this._protocol+"nominatim.openstreetmap.org/search?q="+t.q+e+"&format=json"
},parseSearchJSON:function(t){for(var e=[],i=t,n=null,s=0;s<i.length;s++)n=i[s],e.push({lat:n.lat,lon:n.lon,title:n.display_name,original:n});return e},suggest:function(t){var e=this,i=$.Deferred(),n=this.getSuggestUrl(t);return $.ajax({url:n,type:"GET",method:"GET",beforeSend:function(){},success:function(t){try{i.resolve(e.parseSuggestJSON(t))}catch(n){i.reject({msg:n})}}}),i},getSuggestUrl:function(t){return this.getSearchUrl(t)},parseSuggestJSON:function(t){return $.map(t,function(t){return{label:t.display_name,value:t.display_name,lat:t.lat,lon:t.lon}})},getGeocodeUrl:function(t){return"//nominatim.openstreetmap.org/reverse?format=json&lat="+t.lat+"&lon="+t.lon+"&zoom=18"+"&addressdetails=0"+"&email=info@ritm.ru"+"&accept-language="+this.getLocale()},parseGeocodeJSON:function(t){if(t.scode)return t;if(t.error)throw new Error(t.error);try{return{address:t.display_name}}catch(e){throw console&&console.error("Seems to be response structure changed"),e}},routing:function(){return!1}}),n}),define("maps/OpenStreetMapTransport",["underscore","util","maps/OpenStreetMap"],function(t,e,i){function n(){i.apply(this,arguments)}return e.extend(n,i,["getName","getCode"]),n.__CLASS__="OpenStreetMapTransport",n.code="omaptr",n.mapName="Транспорт OpenStreetMap",n.HOST=["a.tile2.opencyclemap.org","b.tile2.opencyclemap.org","c.tile2.opencyclemap.org"],n.DEFAULT_PARAMS=i.DEFAULT_PARAMS,n.MAX_ZOOM=i.MAX_ZOOM,t.extend(n.prototype,{getSourceData:function(){return this._useCache?function(){var t=x/1024,e=y/1024;return t=t>1?parseInt(t):0,e=e>1?parseInt(e):0,{url:"cache/"+n.code+"/{z}/"+t+"/{x}/"+e+"/{y}.png"}}:{url:this._protocol+"{s}.tile2.opencyclemap.org/transport/{z}/{x}/{y}.png",sub:"abc"}}}),n}),define("maps/CloudMadeMap",["underscore","util","maps/GeoMap"],function(t,e,i){function n(){i.apply(this,arguments)}return e.extend(n,i,["getName","getCode"]),n.__CLASS__="CloudMadeMap",n.code="cmmap",n.mapName="Карта CloudMadeMap",n.HOST=["a.tile.cloudmade.com","b.tile.cloudmade.com","c.tile.cloudmade.com"],n.DEFAULT_PARAMS="/BC9A493B41014CAABB98F0471D759707/997/256",n.MAX_ZOOM=18,t.extend(n.prototype,{_buildImgParams:function(t,e,i){return i+"/"+t+"/"+e+".png"},getSourceData:function(){return{url:this._protocol+"{s}.tile.cloudmade.com"+n.DEFAULT_PARAMS+"/{z}/{x}/{y}.png",sub:"abc"}},getTrafficLayerClass:function(){return"GoogleTrafficMapLayer"},routing:function(){return!1}}),n}),define("maps/SpecialMap",["jquery","underscore","util","maps/YandexMap","maps/GoogleMap"],function(t,e,i,n,s){var o={type:"yandex",sas:!1,online:!0,name:"Special map",host:"",path:"",ext:"png",sub:[],minZoom:2,maxZoom:18,errorUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},a=App.getServerSettings().specialMap||{},r="g"==(a.type||o.type).substr(0,1).toLowerCase()?s:n,l=r.prototype,c=function(){this._options=t.extend(!0,{},o,App.getServerSettings().specialMap||{}),r.apply(this,arguments)};i.extend(c,r),c.__CLASS__="SpecialMap",t.extend(c.prototype,{getFilenamePattern:function(){return"tile-{x}-{y}"},getName:function(){return this._options.name},getMinZoom:function(){return this._options.minZoom>0?this._options.minZoom:o.minZoom},getMaxZoom:function(){return this._options.maxZoom>0?this._options.maxZoom:o.maxZoom},getSourceData:function(){var t=h.getUrl.call(this);return{url:t,sub:this._options.sub,errorTileUrl:this._options.errorUrl||o.errorTileUrl}},getTrafficLayerClass:function(){var t="";return this._options.online&&(t=l.getTrafficLayerClass.call(this)),t},getSearchUrl:function(t){var e=l.getSearchUrl.call(this,t);return this._options.online||(e=App.getBaseUrl()+"address/find/"),e},search:function(t){return this._options.online?l.search.call(this,t):h.offlineSearch.call(this,t)},suggest:function(e){return this._options.online?l.suggest.call(this,e):(new t.Deferred).reject()},geocode:function(t){this._options.online?l.geocode.call(this,t):(!t.scode&&(t.scode=this.scode),this._onExternalGeocodingFailed(t))},routing:function(){return this._options.online?l.routing.call(this):!1}});var h={getUrl:function(){var t="",e="url"in this._options?this._options.url:(this._options.host?this._protocol+this._options.host+"/":"")+this._options.path;if(this._options.sas){var i=this._options.ext;t=function(t){var n=t.x,s=t.y,o=t.z,a=Math.floor(n/1024),r=Math.floor(s/1024);return e+"/z"+(o+1)+"/"+a+"/x"+n+"/"+r+"/y"+s+"."+i}}else t=e+"/{z}/"+this.getFilenamePattern()+"."+this._options.ext;return t},offlineSearch:function(e){var i=t.Deferred(),n=this.getSearchUrl(e);return t.ajax({url:n,data:{address:[e.q],scode:this.scode,lat:e.center.lat,lon:e.center.lon},success:function(t){var e,n=[];for(var s in t)e=t[s],n.push({lat:e.lat,lon:e.lon,title:e.address,original:e});i.resolve(n)},error:function(){i.reject()}}),i}};return c}),function(){L.Draw={},L.Draw.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,this._infoLayer=null,this._shape=null,this._modified=!1,this.options=this.options||{},e&&e.shape&&(e.shape=L.Util.extend({},this.options.shape||{},e.shape||{})),this.options=L.Util.extend({},this.options,e),this.on("destroy",this.destroy,this)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this.fire("disabled",{handler:this.type}),this._map.fire("draw:drawstop",{layerType:this.type}))},addHooks:function(){this._map&&(L.DomUtil.disableTextSelection(),this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._createShape(),this.options.info&&(this._makeInfoLayer(),this._map.on("viewreset",this._moveInfo,this)),this.options.latlng.length&&this._initMarkers(),this.options.addPoints&&this._initMouseMarker())},removeHooks:function(){this._map&&L.DomUtil.enableTextSelection()},setOptions:function(t){L.setOptions(this,t)},destroy:function(){this.disable(),this._cleanUpShape(),this._mouseMarker&&(this._map.removeLayer(this._mouseMarker),this._mouseMarker=null),this._markers=[],this._shape=null,this._infoLayer&&(this._map.off("viewreset",this._moveInfo,this),this._infoLayer.parentNode.removeChild(this._infoLayer),this._infoLayer=null)},toGeoJSON:function(){return this._shape.toGeoJSON()},getBounds:function(){return this._shape&&this._shape.getBounds()},isModified:function(){return this._modified},_initMouseMarker:function(){this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._addMarker,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this)},_createShape:function(){this._shape=new this.Shape([],this.options.shape)},_initMarkers:function(){for(var t=this.options.latlng,e=0,i=t.length;i>e;++e)this._addMarker(t[e])},_onMouseMove:function(t){var e=t.latlng;this._currentLatLng=e,this._mouseMarker&&this._mouseMarker.setLatLng(e),L.DomEvent.preventDefault(t.originalEvent)},_makeInfoLayer:function(){if(!this._infoLayer){var t="poly-info-layer leaflet-zoom-hide"+(this.options.info.addClass?" "+this.options.info.addClass:"");this._infoLayer=L.DomUtil.create("div",t),this._map.getPanes().overlayPane.appendChild(this._infoLayer)}},_showInfo:function(){this.options.info.content&&(this._infoLayer.innerHTML="function"==typeof this.options.info.content?this.options.info.content.call(this):this.options.info.content),this._moveInfo()},_moveInfo:function(){if(this._infoLayer&&this._markers[0]){var t=this.getCenter();L.DomUtil.setPosition(this._infoLayer,t),this._infoLayer.setAttribute("x",t.x),this._infoLayer.setAttribute("y",t.y)}},_getDistance:function(t,e){return t.distanceTo(e)},_finishShape:function(){this._map.removeLayer(this._mouseMarker),this._fireCreatedEvent()},_fireCreatedEvent:function(t){this._map.fire("draw:created",{layer:t,layerType:this.type})}}),L.Draw.Point=L.Draw.Feature.extend({statics:{TYPE:"point"},options:{addPoints:!0,latlng:null,shape:null,zIndexOffset:2e3},initialize:function(t,e){L.Draw.Feature.prototype.initialize.call(this,t,e),this.type=L.Draw.Point.TYPE;var i=this.options.latlng;this.options.addPoints=i?!1:!0},addHooks:function(){this._map&&(L.DomUtil.disableTextSelection(),this._marker=null,this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this.options.latlng&&this._addMarker(),this.options.addPoints&&this._initMouseMarker())},removeHooks:function(){this.destroy()},setLatLng:function(t){var t=L.latLng(t);this._map.setView(t,this._map.getMaxZoom()-1,{animate:!1}),this._marker?this._marker.setLatLng(t):this._addMarker(t)},isValid:function(){return null!==this.options.latlng},toGeoJSON:function(){return this._marker.toGeoJSON()},getPoint:function(){return this.options.latlng},getBounds:function(){var t=this._marker.getLatLng();return[[t.lat,t.lng],[t.lat,t.lng]]},destroy:function(){this.disable(),this._mouseMarker&&this._map.removeLayer(this._mouseMarker),this._mouseMarker=null,this._marker&&this._map.removeLayer(this._marker),this._marker=null},_addMarker:function(t){if(!this._marker){var e=t.target?t.target.getLatLng():t;this.options.latlng=[e.lat,e.lng];var i=this._createMarker(e);this._marker=i,this._mouseMarker&&this._map.removeLayer(this._mouseMarker),this._fireEdit()}},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,draggable:!0,zIndexOffset:2*this.options.zIndexOffset});return e._index=0,e.on("drag",this._move,this).on("dragend",this._fireEdit,this),this._markerGroup.addLayer(e),e},_move:function(){var t=this._marker.getLatLng();this.options.latlng=[t.lat,t.lng],this.fire("drag",{position:this.options.latlng}),this._modified=!0},_fireEdit:function(){this.fire("dragend",{position:this.options.latlng})},_createShape:function(){},_cleanUpShape:function(){}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Shape:L.Polyline,options:{showIndexes:!1,addPoints:!0,latlng:[],shape:{stroke:!0,color:"#f06eaa",weight:4,opacity:.8,fill:!1,clickable:!1},zIndexOffset:2e3},initialize:function(t,e){L.Draw.Feature.prototype.initialize.call(this,t,e),this.type=L.Draw.Polyline.TYPE},getMarkers:function(){return this._markers},getPoints:function(){if(!this._shape)return[];for(var t=this._shape.getLatLngs(),e=t.length,i=new Array(e),n=0;e>n;++n)i[n]=[t[n].lat,t[n].lng];return i},getLastMarker:function(){return this._markers[this._markers.length-1]||null},getFirstMarker:function(){return this._markers[0]||null},removeMarkerByIndex:function(t){this._markers[t]&&this._removeMarker(this._markers[t])},_addMarker:function(t){var e=t.target?t.target.getLatLng():t,i=this._createMarker(e,this._markers.length);this._markers.push(i),this._shape.addLatLng(e),2===this._markers.length&&this._map.addLayer(this._shape),this.fire("nodeadd",{poly:this._shape,marker:i}),t.target&&(this._modified=!0)},_createMarker:function(t,e){var i=new L.Marker(t,{icon:this.options.icon,draggable:!0,zIndexOffset:2*this.options.zIndexOffset});"undefined"!=typeof e&&(i._index=e);var n=this;return i.on("drag",this._onMarkerDrag,this).on("dblclick destroy",function(){n._markers.length>1&&n._removeMarker(i)},this),this._markerGroup.addLayer(i),this.options.showIndexes&&(i._icon.innerHTML=e),i},_removeMarker:function(t){var e=t,i=t._index;if(this._markers.splice(i,1),this._markerGroup.removeLayer(t),this._shape.spliceLatLngs(i,1),i<this._markers.length)for(var n=i,s=this._markers.length;s>n;n++)this._markers[n]._index=n,this.options.showIndexes&&(this._markers[n]._icon.innerHTML=n),this.fire("nodeindexchange",{marker:this._markers[n]});this.fire("noderemove",{poly:this._shape,marker:e}),e=null},_onMarkerDrag:function(t){var e=t.target;e.setLatLng(this._currentLatLng),this._shape.spliceLatLngs(e._index,1,this._currentLatLng),this.fire("nodechange",{poly:this._shape,marker:e}),this._modified=!0},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this),this._markerGroup&&this._map.removeLayer(this._markerGroup),this._shape&&this._map.removeLayer(this._shape),this.options.addPoints&&this._map.off("mousemove",this._onMouseMove,this)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Shape:L.Polygon,initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type=L.Draw.Polygon.TYPE},removeHooks:function(){this.destroy()},getArea:function(){var t,e,i=0,n=this._markers,s=[],o=[],a=1/0,r=1/0;if(!n)return!1;var l=n.length;for(e=0;l>e;e++){var c=n[e].getLatLng();c.lat<a&&(a=c.lat),c.lng<r&&(r=c.lng)}for(e=0;l>e;e++){var c=n[e].getLatLng();s[e]=this._getDistance(new L.LatLng(a,r),new L.LatLng(a,c.lng)),o[e]=this._getDistance(new L.LatLng(a,r),new L.LatLng(c.lat,r))}for(e=0;l>e;e++)0==e?(t=s[e]*(o[l-1]-o[e+1]),i+=t):e==l-1?(t=s[e]*(o[e-1]-o[0]),i+=t):(t=s[e]*(o[e-1]-o[e+1]),i+=t);return Math.abs(i/2)},getPerimeter:function(){var t=this._markers,e=0;if("undefined"==typeof t||t.length<3)return 0;for(var i=0;i<t.length-1;i++){var n=t[i].getLatLng(),s=t[i+1].getLatLng();e+=this._getDistance(n,s)}return e+=this._getDistance(s,t[0].getLatLng())},getCenter:function(){for(var t=this._shape._latlngs,e=t.length,i=0,n=0,s=0;e>s;++s)i+=t[s].lat,n+=t[s].lng;return this._map.latLngToLayerPoint([i/e,n/e])},setLatLngs:function(t){this._markerGroup&&this._map.removeLayer(this._markerGroup),this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._markers=[],this.options.latlng=t,this._shape.setLatLngs([]),this._initMarkers(),this._showInfo(),this._modified=!0},isValid:function(){return this._markers.length>=3},_addMarker:function(t){var e=t.target?t.target.getLatLng():t,i=this._createMarker(e,this._markers.length);this._markers.push(i),this._shape.addLatLng(e);var n=this._markers.length;if(n>=2){2===n?this._map.addLayer(this._shape):3===n&&this.options.info&&this._showInfo();var s=this._markers[n-2];s._middleRight&&this._markerGroup.removeLayer(s._middleRight),this._createMiddleMarker(s,i),this._updatePrevNext(s,i),n>2&&(this._createMiddleMarker(i,this._markers[0]),this._updatePrevNext(i,this._markers[0]),this.options.info&&this._showInfo())}t.target&&(this._modified=!0)},_createMarker:function(t,e){var i=new L.Marker(t,{draggable:!0,icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return i._origLatLng=t,i._index=e,i.on("dblclick",this._onMarkerDoubleClick,this),i.on("drag",this._onMarkerDrag,this),this._markerGroup.addLayer(i),i},_createMiddleMarker:function(t,e){var i,n,s,o=this._getMiddleLatLng(t,e),a=this._createMarker(o);a.setIcon(new L.DivIcon({iconSize:null,className:"leaflet-editing-icon leaflet-middle-icon"})),t._middleRight=e._middleLeft=a,n=function(){var n=e._index;a._index=n,a.off("click",i,this).on("dblclick",this._onMarkerDoubleClick,this),o.lat=a.getLatLng().lat,o.lng=a.getLatLng().lng,this._shape.spliceLatLngs(n,0,o),this._markers.splice(n,0,a),a.setIcon(new L.DivIcon({iconSize:null,className:"leaflet-editing-icon"})),this._updateIndexes(n,1),e._index++,this._updatePrevNext(t,a),this._updatePrevNext(a,e)},s=function(){a.off("dragstart",n,this),a.off("dragend",s,this),this._createMiddleMarker(t,a),this._createMiddleMarker(a,e),3==this._markers.length&&(this._createMiddleMarker(e,t),this.options.info&&this._showInfo()),this._modified=!0},i=function(){n.call(this),s.call(this)},a.on("click",i,this).on("dragstart",n,this).on("dragend",s,this),this._markerGroup.addLayer(a)},_onMarkerDrag:function(t){var e=t.target;L.extend(e._origLatLng,e._latlng),e._middleLeft&&e._middleLeft.setLatLng(this._getMiddleLatLng(e._prev,e)),e._middleRight&&e._middleRight.setLatLng(this._getMiddleLatLng(e,e._next)),this._shape.spliceLatLngs(e._index,1,e._latlng),this._shape.redraw(),this.options.info&&this._showInfo(),this._modified=!0},_onMarkerDoubleClick:function(t){var e=L.Polygon&&this._shape instanceof L.Polygon?4:3,i=t.target;this._shape._latlngs.length<e||(this._removeMarker(i),this._updatePrevNext(i._prev,i._next),i._middleLeft&&this._markerGroup.removeLayer(i._middleLeft),i._middleRight&&this._markerGroup.removeLayer(i._middleRight),i._prev&&i._next?this._createMiddleMarker(i._prev,i._next):i._prev?i._next||(i._prev._middleRight=null):i._next._middleLeft=null)},_removeMarker:function(t){var e=t._index;this._markerGroup.removeLayer(t),this._markers.splice(e,1),this._shape.spliceLatLngs(e,1),this._updateIndexes(e,-1),t.off("drag",this._onMarkerDrag,this).off("dblclick",this._onMarkerDoubleClick,this),this.options.info&&this._showInfo(),this._modified=!0},_getMiddleLatLng:function(t,e){var i=this._shape._map,n=i.latLngToLayerPoint(t.getLatLng()),s=i.latLngToLayerPoint(e.getLatLng());return i.layerPointToLatLng(n._add(s)._divideBy(2))},_updateIndexes:function(t,e){this._markerGroup.eachLayer(function(i){i._index>t&&(i._index+=e)})},_updatePrevNext:function(t,e){t&&(t._next=e),e&&(e._prev=t)}}),L.Draw.Circle=L.Draw.Feature.extend({statics:{DEFAULT_RADIUS:{1:4e5,5:2e5,6:1e5,7:5e4,8:3e4,9:1e4,11:3e3,12:2e3,13:1e3,14:500,15:200,17:100,18:50},TYPE:"circle"},Shape:L.Circle,initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type=L.Draw.Circle.TYPE,this.options.latlng||(this.options.latlng=[]);var i=this.options.latlng;this.options.addPoints=i.length?!1:!0,2==i.length&&(this.options.radius=L.latLng(i[0]).distanceTo(i[1]))},removeHooks:function(){this.destroy()},getRadius:function(){return this._shape&&this._shape.getRadius()||0},setRadius:function(t,e){if(this.options.radius=t,this._shape){if(this._shape.setRadius(t,this._map),!e){var i=this._getResizeMarkerPoint();this.options.latlng[1]=[i.lat,i.lng],this._markers[1].setLatLng(i),this.options.info&&this._showInfo()}this._modified=!0}},setCenter:function(t){var e=L.Util.isArray(t)?t:[t.lat,t.lng];if(2==this._markers.length)this._markers[0].setLatLng(e),this._move(),this._map.fitBounds(this.getBounds());else{var t=L.latLng(e);this._map.setView(t,this._map.getMaxZoom()-1,{animate:!1}),this._addMarker(t)}this._modified=!0},getArea:function(){var t=this.getRadius();return Math.PI*t*t},getCenter:function(){return this.options.latlng[0]?this._map.latLngToLayerPoint(this.options.latlng[0]):null},getPoints:function(){return 2==this.options.latlng.length?this.options.latlng:[]},isValid:function(){return 2==this.options.latlng.length},_createShape:function(){if(this.options.latlng[0]){if(!this.options.radius||this.options.radius<0){var t=this._map.getZoom(),e=L.Draw.Circle.DEFAULT_RADIUS,i=null;for(var n in e){if(t==n){i=n;break}if(!(t>n))break;i=n}this.options.radius=e[i],this._modified=!0}this._shape=new this.Shape(this.options.latlng[0],this.options.radius,this.options.shape),this.fire("resize",{radius:this.options.radius})}},_addMarker:function(t){if(!(this._markers.length>=2)){var e=t.target?t.target.getLatLng():t;if(this.options.latlng.length<2){0==this.options.latlng.length&&(this.options.latlng[0]=[e.lat,e.lng],this._createShape(),this._map.addLayer(this._shape));var i=this._createMoveMarker(e);this._markers.push(i),i=this._createResizeMarker(),this._markers.push(i),e=i.getLatLng(),this.options.latlng[1]=[e.lat,e.lng],this.options.addPoints=!1,this._finishShape(),this.options.info&&this._showInfo()}else{if(0==this._markers.length)var i=this._createMoveMarker(e);else{var i=this._createResizeMarker();this._map.addLayer(this._shape),this.options.info&&this._showInfo()}this._markers.push(i)}}},_createMoveMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,draggable:!0,zIndexOffset:2*this.options.zIndexOffset});return e._index=0,e.on("drag",this._move,this),this._markerGroup.addLayer(e),e},_createResizeMarker:function(){var t=this.options.latlng[1]||this._getResizeMarkerPoint(),e=new L.Marker(t,{icon:this.options.icon,draggable:!0,zIndexOffset:2*this.options.zIndexOffset});return e._index=1,e.on("drag",this._resize,this),this._markerGroup.addLayer(e),e},_getResizeMarkerPoint:function(){var t=this._markers[0].getLatLng(),e=this._shape._radius,i=this._map.project(t);return this._map.unproject([i.x+e,i.y])},_move:function(t){var e=t&&t.target||this._markers[0],i=e.getLatLng(),n=this.options.latlng[0].slice(0),s=this._markers[1].getLatLng(),o=[s.lat-n[0]+i.lat,s.lng-n[1]+i.lng];this.options.latlng[0]=[i.lat,i.lng],this.options.latlng[1]=o,this._shape.setLatLng(i),this._markers[1].setLatLng(o),this._shape.redraw(),this.options.info&&this._moveInfo(),this._modified=!0},_resize:function(t){var e=t.target,i=e.getLatLng();this.options.latlng[1]=[i.lat,i.lng];var n=this._calcRadius();this._shape.setRadius(n,!0),this._shape.redraw(),this.options.info&&this._showInfo(),this.fire("resize",{radius:n}),this._modified=!0},_calcRadius:function(){return this._markers[0].getLatLng().distanceTo(this._markers[1].getLatLng())},_cleanUpShape:function(){this._markerGroup&&this._map.removeLayer(this._markerGroup),this._shape&&this._map.removeLayer(this._shape),this.options.addPoints&&this._map.off("mousemove",this._onMouseMove,this)}}),L.Edit={},L.Edit.Shape=L.Handler.extend({options:{addPoints:!1,icon:new L.DivIcon({iconSize:null,className:"leaflet-editing-icon"}),shape:{stroke:!0,color:"rgba(0, 228, 0, 1)",weight:3,fill:!0,clickable:!1},info:{addClass:"",content:function(){return""}},zIndexOffset:1999},DrawShape:null,includes:L.Mixin.Events,initialize:function(t){this._drawObject=null,L.setOptions(this,t);var e=this;this.on("destroy",function(){e._drawObject&&e._drawObject.destroy()})},addHooks:function(){this._map&&!this._drawObject&&(this._drawObject=new this.DrawShape(this._map,this.options||{}))},removeHooks:function(){this._map.removeLayer(this._drawObject)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this._drawObject&&this._drawObject.enable())},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._drawObject&&this._drawObject.disable())},getBounds:function(){return this._drawObject.getBounds()},toGeoJSON:function(){return this._drawObject.toGeoJSON()},onAdd:function(t){this._map=t,this.enable()},onRemove:function(){this.disable()},getPoints:function(){return this._drawObject.getPoints()},isValid:function(){return this._drawObject.isValid()},isModified:function(){return this._drawObject.isModified()}}),L.Edit.Point=L.Edit.Shape.extend({DrawShape:L.Draw.Point,options:{addPoints:!1,icon:new L.DivIcon({iconSize:null,className:"leaflet-point-editing-icon"}),shape:null,info:null,zIndexOffset:1999},addHooks:function(){L.Edit.Shape.prototype.addHooks.call(this,arguments),this._drawObject&&this._drawObject.on("drag dragend",this._onDrag,this)},getPosition:function(){return this._drawObject.getPoint()},setPosition:function(t){return this._drawObject.setLatLng(t)},_onDrag:function(t){this.fire(t.type,{position:t.position})}}),L.Edit.Circle=L.Edit.Shape.extend({DrawShape:L.Draw.Circle,addHooks:function(){L.Edit.Shape.prototype.addHooks.call(this,arguments),this._drawObject&&this._drawObject.on("resize",this._onResize,this)},removeHooks:function(){this._drawObject&&this._drawObject.off("resize",this._onResize,this),L.Edit.Shape.prototype.removeHooks.call(this,arguments)},getRadius:function(){return this._drawObject?this._drawObject.getRadius():0},setRadius:function(t){return this._drawObject.setRadius(t)},getCenter:function(){return this._drawObject?this._drawObject.getCenter():null},setCenter:function(t){return this._drawObject.setCenter(t)},_onResize:function(t){this.fire(t.type,{radius:t.radius})}}),L.Edit.Polygon=L.Edit.Shape.extend({DrawShape:L.Draw.Polygon,setLatLngs:function(t){return this._drawObject.setLatLngs(t)},getArea:function(){return this._drawObject.getArea()},getPerimeter:function(){return this._drawObject.getPerimeter()}})}(this,document),define("_libs/leaflet/plugins/draw/leaflet.draw",function(){}),define("abstracts/ObjectsCollection",["underscore","abstracts/Collection"],function(t,e){var i=e.extend({constructor:function(){e.apply(this,arguments)},idProp:"objectId",parse:function(t){return t.items||t.group&&t.group.items||t}});return i}),define("abstracts/BaseModule",["jquery","underscore","abstracts/Module","util","i18n!_common/nls/common"],function(t,e,i,n,s){var o=i.extend({_maps:null,constructor:function(){this._modules=(this._modules||[]).concat(["update","watched","tree"]),this._zoomItem=null,i.apply(this,arguments)},defaults:e.extend({},i.prototype.defaults,{ready:!1}),initialize:function(){this._i18n=s},buildModules:function(){var t=this,i=e.map(this._modules,function(e){return t._getPathes()[e]});requirejs(i,function(){var i=0;e.each(arguments,function(e){var n=t._modules[i],s=t.id+"/"+n;t.modules[n]=new e({id:s,container:"itemcard"!=n?t._view.getContainer(n):null,placeholder:App.getPlaceholder(s),parent:t,options:t._getModuleOptions(n)}),i++}),t._addRoutes(),t._bindEvents(),t.set("ready",!0)})},suggest:function(){var e=this,i=t.Deferred(),n=this.search.apply(this,arguments);return n.done(function(t){try{var n=e.parseSuggestJSON(t);i.resolve(n)}catch(s){i.reject({msg:s})}}).fail(function(){i.reject.apply(i,arguments)}),i},parseSuggestJSON:function(i){return t.map(i,function(t){var i=e.escape(t.name);return{label:i,value:i,original:t}})},_prepareSearchParams:function(t){return{q:""+t.q,limit:parseInt(t.limit)}},search:function(e,i){var n=this,s=t.Deferred();return i&&i.id?s.resolve([i]):this.URL_SEARCH?(t.ajax({url:this.URL_SEARCH,timeout:5e3,data:this._prepareSearchParams(e),success:function(t){try{s.resolve(n.parseSearchJSON(t,e))}catch(i){s.reject({msg:i})}},error:function(t,e,i){s.reject({msg:e+": "+i})}}),s):s.reject("No url for search")},getSearchOptions:function(){var t=this,i={zoom:!0,putMarker:!1,onsuccess:function(i){if(t.modules.watched){var n=App.getUserData("mapSearchMode")||0;0==n?t.modules.watched.setItems(i):t.trigger("toggleitems",e.pluck(i,"id"),[],t)}}};return i},parseSearchJSON:function(t,e){if(!e.mapSearch)return t;for(var i=[],n=0,s=t.length;s>n;++n)t[n].lat&&t[n].lon&&i.push(t[n]);return i},setMapsModule:function(t){return this._maps=this.modules.maps=t,this},getSelectedItemsIds:function(){return this.modules.watched?this.modules.watched.getWatchedItemsIds():[]},getWatchedObjects:function(){return this.modules.watched&&this.modules.watched.items.models},getMapsModule:function(){return this._maps},getBounds:function(){return this._view.getBounds()},setZoomItem:function(t){this._zoomItem=t},getZoomItem:function(){return this._zoomItem},getItemIdsForUpdate:function(){var e;if(this.get("ready"))e=this._collectWatchedItemIds();else{var i=this;e=new t.Deferred,this.once("change:ready",function(){i._collectWatchedItemIds().done(function(t){e.resolve(t)})})}return e},_getPathes:function(){return{}},getTexts:function(){return this._i18n},_getModuleOptions:function(){return null},_addRoutes:function(){var t=this;this.routes={},this.routes[t.id]={callback:function(e){App.setActiveModule(t.id+"/"+e),App.getView().trigger("needleftwide",!1)},context:this,params:":m(/*extra)"},App.getRouter().addRoutes(this.routes),this.interceptCurrentRoute()},_bindEvents:function(){var t=this,e=this.modules.watched;this.listenTo(App,"stopall",function(){t.trigger("stopwatching"),t.listenToOnce(App,"startall",function(){t.trigger("startwatching")})}).listenTo(App,"change:visible",function(e,i){var n=t.modules.update;i&&t.get("active")&&n&&(n.stopUpdate(),n.startUpdate(0))}),this.listenTo(App,"clearmap",function(i){i&&i==t._maps&&e.setItems([])}).listenTo(e,"needgeoinfo",function(e,i){t._maps&&t._maps.trigger("needgeoinfo",e,i)}),this.on("filtertree",function(e){t.modules.tree.set("q",e)}).on("needitemzoom",function(t){e.trigger("itemzoom",t)}),this.has("updatePeriod")&&this.on("change:active",function(e,i){var n=t.modules.update;i&&n&&(n.stopUpdate(),n.startUpdate(0))})},_collectWatchedItemIds:function(){var i=new t.Deferred,n=this.modules.watched,s=this.modules.tree;return t.when(n.getItemIdsForUpdate(),s.getItemIdsForUpdate()).done(function(t,n){i.resolve(e.unique(t.concat(n)))}),i}});return o}),define("abstracts/ObjectsTypeModule",["jquery","underscore","abstracts/BaseModule"],function(t,e,i){var n=i.prototype,s=i.extend({URL_SEARCH:App.getBaseUrl()+"objects/obj-search/",constructor:function(){this._modules=(this._modules||[]).concat(["itemcard"]),(App.allowed("objects.create")||App.allowed("objects.edit")||App.allowed("objectgroups.create")||App.allowed("objectgroups.edit"))&&this._modules.push("editor"),i.apply(this,arguments)},defaults:e.extend({},n.defaults,{objType:"",updatePeriod:7e3}),initialize:function(){this._setI18n(),this._makeView();var t=this.get("options");"updatePeriod"in t&&this.set("updatePeriod",t.updatePeriod),"mapsModule"in t&&(this.setMapsModule(this.get("options").mapsModule),this.buildModules())},_setI18n:function(){},_makeView:function(){},_prepareSearchParams:function(t){var e=n._prepareSearchParams.call(this,t);return e.objType="stat"==this.get("objType")?App.TYPE_STAT:App.TYPE_MOBILE,e},parseSuggestJSON:function(e){return t.map(e,function(t){var e="#"+t.extId+" "+t.name;return{label:e,value:t.name,original:t}})},_bindEvents:function(){var t=this,i=this.modules.watched;n._bindEvents.call(this),App.allowed("objects.create")&&this.on("itemedit",function(e){if(!(e&&e.id||!App.allowed("objects.create"))){if(!(e&&e.groupId||!t.modules.tree||t.modules.tree.groups.length||App.allowed("objectgroups.create"))){var i=t.getTexts();return alert(i.errAddGroupBefore,i.error)}e=e||{},e.objType="mobile"==t.get("objType")?App.TYPE_MOBILE:App.TYPE_STAT,App.trigger("devicecreate",e)}}),this.modules.editor&&this.on("groupedit",function(i,n){var s=t.GroupsClass;n=n||{},i?i instanceof s||e.isNumber(i)&&(i=null):i=new s({parentId:n.parentId||null}),i&&t.modules.editor.set("model",i)}).listenTo(this.modules.editor,"toggleform",function(e){t.modules.tree.setTop(e||0)}),App.hasModule("tracks")&&this.listenTo(i,"needtrack",function(t){App.trigger("needtrack",t)}),this.on("itemcardopen",function(e){t.modules.itemcard&&t.modules.itemcard.open(e)})},_getModuleOptions:function(t){return"itemcard"==t?{editable:App.allowed("objects.edit")||App.allowed("objects.create")}:"editor"==t?{mapsModule:this.modules.maps,container:this._view.getModuleContent()||null}:null}});return s}),define("abstracts/update/UpdateModule",["jquery","underscore","abstracts/Module"],function(t,e,i){var n=i.extend({defaults:{updatePeriod:null,url:App.getBaseUrl()+"objects/obj/",idParam:"objectId",options:null},constructor:function(){this._xhr=null,this._updateTimeout=null,i.apply(this,arguments)},initialize:function(){this.has("options")&&this.set(this.get("options")),this.set("updatePeriod",this.get("parent").get("updatePeriod")||7e3),this._bindEvents(),this.startUpdate()},stopUpdate:function(){this._xhr&&this._xhr.abort()&&(this._xhr=null),this._updateTimeout&&clearTimeout(this._updateTimeout)},startUpdate:function(t){clearTimeout(this._updateTimeout),t="undefined"==typeof t?this.get("updatePeriod"):t,this._updateTimeout=setTimeout(e.bind(function(){App.get("visible")?this._update():this.startUpdate()},this),t)},_bindEvents:function(){var t=this.get("parent"),e=this;this.listenTo(t,"stopwatching",function(){e.stopUpdate(),this.listenToOnce(t,"startwatching",function(){e.startUpdate()})})},_update:function(){var t=this;this.getParent().getItemIdsForUpdate().done(function(e){t._requestData(e).done(function(e){e.length&&t.getParent().trigger("updateitems",e),t.startUpdate()}).fail(function(){App.trigger("serverlost")})}).fail(function(){t.startUpdate()})},_requestData:function(i){var n=new t.Deferred;if(i.length){var s=this,o=(new Date,{});o[this.get("idParam")]=i;var a=this.get("url");e.isFunction(a)&&(a=a()),this._xhr=t.ajax({url:a,data:o,statusCode:{401:function(){s.getParent().trigger("401"),setTimeout(function(){App.trigger("logout")},50)}},success:function(t){n.resolve(t)},error:function(t){n.reject(t)}})}else n.resolve([]);return n}});return n}),define("text!_common/abstracts/tree/tmpl/settings.html",[],function(){return'<li>\n    <h5 class="nav-header"><%= i18n.listType %></h5>\n    <ul class="options-list">\n        <li>\n            <label>\n                <input type="radio"<% if(titleType == \'title\') {%> checked<% } %>\n                       name="objectTitle<%= objType.ucFirst() %>Tree" value="title">\n                <%= i18n.name %> \n            </label>\n        </li><li>\n            <label>\n                <input type="radio"<% if(titleType == \'extId\') {%> checked<% } %>\n                       name="objectTitle<%= objType.ucFirst() %>Tree" value="extId">\n                <%= i18n.objIdNumberShort %> \n            </label>\n        </li><li>\n            <label>\n                <input type="radio"<% if(titleType == \'both\') {%> checked<% } %>\n                       name="objectTitle<%= objType.ucFirst() %>Tree" value="both"> \n                <%= i18n.name %>  + <%= i18n.objIdNumberShort %> \n            </label>\n        </li>\n    </ul>\n    <h5 class="nav-header"><%= i18n.sort %></h5>\n    <ul class="options-list">\n        <li>\n            <label<% if(titleType == \'extId\') {%> class="disabled"<% } %>>\n                <input type="radio" name="sortBy<%= objType.ucFirst() %>" value="name"\n                <% if(titleType != \'extId\') {%><% if(sortType == \'name\') {%> checked<% } %><% } else { %> disabled<% } %>>\n                <%= i18n.sortByName %>\n            </label>\n        </li><li>\n            <label<% if(titleType == \'title\') {%> class="disabled"<% } %>>\n                <input type="radio" name="sortBy<%= objType.ucFirst() %>" value="extId"\n                       <% if(titleType != \'title\') {%><% if(sortType == \'extId\') {%> checked<% } %><% } else { %> disabled<% } %>>\n                <%= i18n.sortByObjectExtId %>\n            </label>\n        </li>\n    </ul>\n</li>'
}),define("abstracts/tree/views/TreeView",["jquery","underscore","jface","abstracts/View","jqueryui","text!_common/abstracts/tree/tmpl/settings.html","_libs/grids/SlickGrid-master/slick.grid"],function(t,e,i,n,s,o,a){o=e.template(o);var r=n.extend({constructor:function(){this.grid=null,this._contextMenu=null,n.apply(this,arguments)},initialize:function(t){var e=this;this.model.getEventsPrefix(),this.listenTo(this.model,"change:loading",function(t,i,n){e.toggleLoading(i),i||!n.success||n.hasItems||e._showNoData()}).listenTo(this.model,"change:active",function(t,i){e.$el[i?"addClass":"removeClass"]("active"),e.$el.closest(".tab-hor-content")[i?"addClass":"removeClass"]("active")}).listenTo(this.model,"alert",function(t,e){e?i.confirm(t,"",{okCallback:e}):alert(t)}),this.render(t)},render:function(){return this._buildSettingsMenu(),this._bindEvents(),this.$el},drawTree:function(){var i=this.model.dataView,n=this,s=this._getColumns(),o={enableCellNavigation:!0,asyncEditorLoading:!1,fullWidthRows:!0,forceFitColumns:!1,rowHeight:26};i.getItemMetadata=e.bind(function(t){var n=i.getItem(t),s=[];return"undefined"!=typeof n&&(s=this._getItemCSSClasses(n)),{cssClasses:e.uniq(s).join(" ")}},this),this.grid=new a.Grid(this.$el,i,s,o),this.grid.onClick.subscribe(e.bind(e.throttle(function(e,s){if(t(e.currentTarget).hasClass("grid-canvas")){var o=t(e.target),a=(o.get(0).tagName.toLowerCase(),"noaction"),r=o.data("action"),l=i.getItem(s.row);if(o.hasClass("toggle")?a="toggle":o.hasClass("icon-edit")?a="edit":o.hasClass("item-title")?a="show":("check"==r||o.hasClass("cell-icon"))&&(a="check"),l)switch(a){case"edit":"0"!==l.id&&n.$el.contextmenu("open",e);break;case"toggle":l.closed=!l.closed;var c=n.model.get("propertyId");l.closed?this.model.trigger("group.collapse",l):this.model.trigger("group.expand",l),i.updateItem(l[c],l);break;case"show":this.model.trigger("action","item_show",l);break;case"check":this.model.trigger("toggleselect",l)}e.preventDefault()}},300),this)),this.grid.onMouseEnter.subscribe(e.bind(function(e){t(e.currentTarget).closest(".slick-row").addClass("hover")},!0)),this.grid.onScroll.subscribe(e.bind(function(){n._contextMenu&&n.$el.contextmenu("close")},!0)),this.grid.onMouseLeave.subscribe(e.bind(function(e){t(e.currentTarget).closest(".slick-row").removeClass("hover")},!0)),!this._contextMenu&&this._initContextMenu()},_getColumns:function(){return[{id:"name",name:"Name",field:"name",minWidth:10,maxWidth:2e3,width:300,cssClass:"cell-title",formatter:e.bind(this.titleFormatter,this)},{id:"nbItems",name:"",field:"nbItems",minWidth:50,width:70,maxWidth:70,cssClass:"cell-icon",formatter:e.bind(this.statusFormatter,this)}]},clear:function(){this.trigger("clear")},getVisibleItemsIds:function(){for(var e=this.$el.find("[data-grid-itemid]"),i=e.length,n=[];i--;)n.push(parseInt(t(e.get(i)).attr("data-grid-itemid")));return n},refreshGrid:function(){this.grid&&this.grid.invalidate()},toggleLoading:function(t){this.$el[t?"addClass":"removeClass"]("loading")},refresh:function(){this.grid&&this.grid.render()},remove:function(){this.stopListening(App),App.unsubscribe(this),n.prototype.remove.apply(this,arguments)},_buildSettingsMenu:function(){var t=this.model.getTexts();this.$el.closest(".tab-hor-content").find(".module-settings .dropdown-menu").append(o({objType:this.model.get("objType")||"",sortType:this.model.get("sortType")||"name",titleType:this.model.get("titleType"),i18n:t}))},_bindEvents:function(){var e=this,i=this.model;this.$el.closest(".tab-hor-content").on("click",".module-settings input[name^=sortBy]",function(){this.checked&&e.model.set("sortType",this.value)}).on("click",".module-settings input[name^=objectTitle]",function(){if(this.checked){var i=this.value,n=t(this).closest(".dropdown-menu"),s=n.find("input[name^=sortBy]"),o=null;e.model.set("titleType",i),s.prop("disabled",!1).parent().removeClass("disabled"),"extId"==i?o=s.filter("[value=name]"):"title"==i&&(o=s.filter("[value=extId]")),o&&(o.prop("disabled",!0).parent().addClass("disabled"),s.filter("[value="+("extId"==i?"extId":"name")+"]").prop("checked",!0))}}).on("click",".module-settings label.disabled",function(){return!1}),this.listenTo(i,"change:expired",function(t,i){e.$el[i?"addClass":"removeClass"]("tree-expired loading")}),this.listenTo(App,"layoutchange",function(t){t&&e.grid&&e.grid.resizeCanvas()}).listenTo(App,"leftpaneresize",function(){e.grid&&e.grid.resizeCanvas()})},_getItemCSSClasses:function(t){var e=[];return t.isgroup&&e.push("group"),"undefined"!=typeof t.hwStatus&&e.push("status-"+t.hwStatus),1===t.checked&&e.push("selected"),e},_initContextMenu:function(){var i=this,n=null;this._contextMenu=t(this._buildContextMenu()).appendTo("body"),t.fn.contextmenu&&this._contextMenu.length&&this.$el.contextmenu({selector:".slick-row",menu:this._contextMenu,position:{my:"left top"},before:e.bind(function(s){var o=this.grid.getCellFromEvent(s.originalEvent),a="undefined"!=typeof o.row?o.row:null;n=this.grid.getData().getItem(a),this._contextAllowed(n)?(i._contextMenu.html(this._buildContextMenuItems(n)),i._contextMenu.off("click","").on("click","[data-action]",e.bind(function(e,i){var n=t(i.target).attr("data-action");this.model.trigger("action",n,e)},this,n))):s.preventDefault()},this)})},_contextAllowed:function(t){return t.id>0},_buildContextMenu:function(){return'<ul class="context-menu dropdown-menu nav nav-list" role="menu"></ul>'},_buildContextMenuItems:function(){return""},_getTitleTypes:function(){return{}},_showNoData:function(){this.$el.html('<p class="no-data">'+this.model.getTexts().emptyTreeMsg+"</p>")},titleFormatter:function(){return""},statusFormatter:function(){return""}});return r}),define("abstracts/tree/TreeModule",["jquery","underscore","abstracts/Module","util","abstracts/tree/views/TreeView","_libs/grids/SlickGrid-master/slick.dataview"],function(t,e,i,n,s,o){var a=0,r=1,l=2,c=i.extend({searchCollection:null,treeData:[],_hasTopGroup:!0,constructor:function(){this.dataView=null,this._updateXhr=null,this._updateTimeout=null,this._updateTsById={},this._expireTimeout=null,i.apply(this,arguments)},defaults:{container:null,parent:null,q:"",active:!1,loading:!1,propertyId:"uid",checkedOnly:!1,sortType:"name",titleType:"both",sortParam:"sort",updating:!0,expired:!1,lastUpdateTs:0,hasItems:null},initialize:function(){this._bindEvents(),this.loadTree()},_sortCondition:function(){return!1},_clearTree:function(){},loadTree:function(){var i={},n=new t.Deferred;return this.set({hasItems:null,loading:!0}),this._clearTree(),this.has("objType")&&(i.groupType="stat"==this.get("objType")?App.TYPE_STAT:App.TYPE_MOBILE),this.has("sortType")&&(i[this.get("sortParam")]=this.get("sortType")),this.fetch({data:i,success:e.bind(function(t,e){e.length&&this._initTree(),this.set({loading:!1,hasItems:e.length>0},{success:!0,hasItems:e.length>0}),n.resolve()},this),error:e.bind(function(e,i){try{var s=t.parseJSON(i.responseText);alert(s.msg,s.hdr)}catch(o){}this.set("loading",!1,{success:!1}),n.reject()},this)}),n},parse:function(t){var i=this.get("propertyId"),n=this._sortCondition();if(this._hasTopGroup&&(this._hasTopGroup=e.isArray(t)?t.length>1:e.keys(t).length>1),this._each(t,e.bind(function(t){n&&this.sort(t),this.treeData.push(this.prepareTreeObject.apply(this,arguments))},this)),this._hasTopGroup){var s={id:"0",name:this.getTopGroupName(),nbItems:this.items.length,indent:0,checked:a,isgroup:!0,parent:null,groups:[],items:[],closed:!1};s[i]="_0",e.each(this.treeData,function(t){0===t.indent&&(t.isgroup?s.groups.push(t.id+""):s.items.push(t.id+""),t.parent=s)}),this.treeData.unshift(s)}},sort:function(t){if(t.objs&&t.objs.length){var e="",i="";t.objs.sort(function(t,n){return e=App.buildObjTitle(t),i=App.buildObjTitle(n),e?e.localeCompare(i):void 0})}},prepareTreeObject:function(t,i,n,s,o){var r=this.get("propertyId");return t.indent=n,t.parent=s,t.checked="undefined"==typeof o?a:o,t.isgroup=i,i?(t.parentId=s&&s.id||null,t[r]=null==s?t.id.toString():s[r]+"_"+t.id,t.groups=this._itemsKeys(t[r],this.extractGroups(t)),t.items=this._itemsKeys(t[r],this.extractItems(t)),t.closed=-1==e.indexOf(this._openedGroups,t.id),this.groups.add(t)):(t[r]=null==s?"_"+t.id:s[r]+"_"+t.id,this.items.add(t,{parse:!0}),this._copyParams(this.items.get(t.id).attributes,t)),t},getSelectedItems:function(){return this.items.where({checked:r})},getSelectedItemsIds:function(){return this.getParent().getSelectedItemsIds()},isGroupData:function(t){return"undefined"!=typeof t.objs},extractGroups:function(t){return t.objsGroups},extractItems:function(t){return t.objs},getTreeGroupById:function(t){var i=e.filter(this.dataView.getItems(),function(e){return e.isgroup&&e.id==t});return i[0]||null},getTopGroupName:function(){return this.getTexts().allObjects},buildItemTitle:function(t){if(t.isgroup)return t.name;var e=this.get("titleType"),i="extId"!=e?App.buildObjTitle(t,", "):"";if("title"!=e){var n=i.length>0,s="#"+t.extId;i+=(n?" (":"")+s+(n?")":"")}return i},getItemIdsForUpdate:function(){var e,i=new t.Deferred,n=this.get("hasItems");if(!this.get("parent").get("active"))return this._setExpireTimeout(3e3),i.resolve([]);if(null!==n)e=this.getSelectedAndVisibleItemIds(),e.length||(this._clearExpireTimeout(),this.set({lastUpdateTs:+new Date,expired:!1})),i.resolve(e);else{var s=this;this.once("change:hasItems",function(){i.resolve(s.getSelectedAndVisibleItemIds())})}return i},getSelectedAndVisibleItemIds:function(){var t=[];return e.each(this.getSelectedItemsIds(),function(e){t.push(e)}),e.union(t,this._view.getVisibleItemsIds())},getTexts:function(){return this.get("parent").getTexts()},setTop:function(t){this._view.el.style.top=t+"px"},destroy:function(){this.stopListening(),App.unsubscribe(this)},_initTree:function(){this._createTree(),this._view.drawTree();var t;if((t=this.getSelectedItemsIds())&&(this._setObjectsCheckedStatus(t),this._view.refreshGrid()),!this.getUserData("notFirst")&&1==this.groups.length){this.setUserData("notFirst",!0);var e=this.groups.at(0),i=this.getTreeGroupById(e.id);e.set("closed",!1),i.closed=!1,this.trigger("group.expand",e),this.dataView.updateItem(i[this.get("propertyId")],i)}},_onToggleSelect:function(t){var i=this.getSelectedItems(),n=[],s=[],o=t.checked==a?r:a;if(t.isgroup){this._setGroupsCheckedStatus(t.id,o);var l=this.getSelectedItems();o?n=e.pluck(e.difference(l,i),"id"):s=e.pluck(e.difference(i,l),"id")}else this._setObjectsCheckedStatus(o?t.id:[],o?[]:t.id),o?n[0]=t.id:s[0]=t.id;this._view.refreshGrid(),this.getParent().trigger("toggleitems",n,s,this)},_bindEvents:function(){var t=this,i=this.get("parent");this.on("action",function(t,e){if("number"==typeof e){var i=this.items.get(e);if(!i)return;e=i.attributes}this._processAction(t,e)}).on("change:sortType",function(){t.setUserData("sortType",t.get("sortType")),t.loadTree()}).on("change:titleType",function(e,i){var n=t.get("sortType");t.setUserData("titleType",t.get("titleType")),"both"!=i?"extId"==i&&"name"==n||"title"==i&&"extId"==n?t.set("sortType","extId"==i?"extId":"name"):t._view.refreshGrid():t._view.refreshGrid()}).on("change:checkedOnly",function(){t.dataView.refresh()}).on("change:q",function(){t._onStartSearch()}).on("group.expand",function(n){n&&-1==e.indexOf(t._openedGroups,n.id)&&(t._openedGroups.push(n.id),t.setUserData("openedGroups",t._openedGroups),t.get("updating")&&App.get("visible")&&i.get("active")&&t._updateGroup(n))}).on("group.collapse",function(i){i&&(t._openedGroups=e.without(t._openedGroups,i.id),t.setUserData("openedGroups",t._openedGroups))}).on("toggleselect",function(e){t._onToggleSelect(e)}),this.listenTo(i,"toggleitems",e.bind(function(t,e,i){i!=this&&(this._setObjectsCheckedStatus(t,e),this._view.refreshGrid())},this)).listenTo(i,"groupadded",this.loadTree,this).listenTo(i,"itemchanged",this._onItemChange,this).listenTo(i,"groupchanged",this._onGroupChange,this).listenTo(i,"updateitems",this._updateItems),this.get("updating")&&this.listenTo(App,"change:visible",function(e,n){n||t._setExpireTimeout(i.get("updatePeriod"))}),this.listenTo(App,"objectsTitleChange",function(){t.loadTree()})},_processAction:function(t,e){var i,n=this.getTexts(),s=this.get("parent");switch(t){case"group_report":i=h.getAllItemOnGroup.call(this,e.id),i.length?App.trigger("needreport",this.get("objType"),i):this.trigger("alert",n.alertCantbBuildReportWithEmpty);break;case"group_edit":s.trigger("groupedit",this.groups.get(e.id));break;case"group_add_object":var o=this.groups.get(e.id);s.trigger("itemedit",{groupId:o.id,groupName:o.get("name")});break;case"group_add_group":var o=this.groups.get(e.id);s.trigger("groupedit",null,{parentId:o.id});break;case"item_show":e.checked?s.trigger("needitemzoom",e.id):(s.setZoomItem(e.id),this.trigger("toggleselect",e,!0));break;case"obj_report":App.trigger("needreport",this.get("objType"),[this.items.get(e.id)]);break;case"obj_card":s.trigger("itemcardopen",this.items.get(e.id));break;case"obj_editpos":this.trigger("action","item_show",e),s.trigger("itemedit",this.items.get(e.id));break;case"obj_history":App.trigger("needdevicehistory",this.items.get(e.id))}},_getTitleType:function(){},_onStartSearch:function(){var t=this.get("q");if(t.length>=2){var i={q:t};this.has("objType")&&(i.objType="stat"==this.get("objType")?App.TYPE_STAT:App.TYPE_MOBILE),this.searchCollection.fetch({data:i,success:e.bind(function(){var t=this.get("propertyId"),i=[];this.searchCollection.each(e.bind(function(n){var s=n.get("id"),o=this._getObjectItemsByIDs(s);e.each(o,e.bind(function(e){i.push(e[t]);for(var n=e.parent;n;)i.push(n[t].toString()),n.closed&&(n.closed=!1,this.trigger("group.expand",n)),n=n.parent},this))},this)),this.searchResult=e.uniq(i),this.dataView.refresh()},this)})}else t.length=0,this.searchResult=[],this.dataView.refresh()},_copyParams:function(t,e){e.name=t.name},_onItemChange:function(){},_onGroupChange:function(t){var i=t.attributes,n=i.id,t=e.findWhere(this.dataView.getItems(),{isgroup:!0,id:n});t&&(t.name=i.name,t.nbItems=i.nbItems,this.groups.get(n).set({name:i.name,nbItems:i.nbItems}),this._view.refreshGrid())},_updateObjectModel:function(t){var e=this.items.get(t.id);return e&&e.set(t),e},_getObjectItemsByIDs:function(t){if(!this.dataView)return[];t=e.isArray(t)?t:[t];var i=[];return t.length>0&&e.isString(t[0])?e.each(t,function(t){i.push(parseInt(t.replace(/[\d]*_/g,"")))}):i=t,e.filter(this.dataView.getItems(),function(t){return!t.isgroup&&e.indexOf(i,t.id)>-1})},_createTree:function(){var t=this,i=this.treeData,n=this.get("propertyId");this.dataView=new o.Data.DataView({idProperty:this.get("propertyId")}),this.dataView.beginUpdate(),this.dataView.setItems(i),this.dataView.setFilter(e.bind(function(t){if("0"===t.id)return!0;if(this.get("q").length>1&&-1==e.indexOf(this.searchResult,t[n]))return!1;if(this.get("checkedOnly")&&!t.checked)return!1;if(null!=t.parent)for(var i=t.parent;i;){if(i.closed)return!1;i=i.parent}return!0},this)),this.dataView.endUpdate(),this.dataView.onRowCountChanged.subscribe(function(){t._view.grid.updateRowCount(),t._view.grid.render()}),this.dataView.onRowsChanged.subscribe(function(e,i){t._view.grid.invalidateRows(i.rows),t._view.grid.render()}),this.get("updating")&&!App.get("visible")&&this._setExpireTimeout(this.get("parent").get("updatePeriod"))},_each:function(t,e,i,n){i="undefined"!=typeof i?i:0,n=0===i?null:n;for(var s in t)if(t.hasOwnProperty(s)){var o=t[s],a=this.isGroupData(o);e(o,a,i,n),a&&(this._each(o.objsGroups,e,i+1,o),delete o.objsGroups,this._each(o.objs,e,i+1,o),delete o.objs)}},_setObjectsCheckedStatus:function(t,i){t=h.convertIdsToArray(t),i=h.convertIdsToArray(i);var n=this._getObjectItemsByIDs(t),s=this._getObjectItemsByIDs(i);e.each(n,e.bind(function(t){this.items.get(t.id).set("checked",r),t.checked=r},this)),e.each(s,e.bind(function(t){this.items.get(t.id).set("checked",a),t.checked=a},this));for(var o=this._getGroupListByObjItems(e.union(n,s)),l=o.length;l--;)e.each(o[l],e.bind(this._setGroupStatus,this));this._hasTopGroup&&h.setTopGroupStatus.call(this)},_setGroupStatus:function(t){var i=this.groups.get(t);if(i){var n=this.get("propertyId"),s=e.union(i.get("groups"),i.get("items")),o=this.dataView,a=[0,0,0];e.each(e.filter(o.getItems(),function(t){return-1!=e.indexOf(s,t[n])}),function(t){("undefined"==typeof t.nbItems||0!==t.nbItems)&&a[t.checked]++}),i.set("checked",h.defineChecked(a)),o.getItemById(i.get(n)).checked=i.get("checked")}},_updateGroup:function(t){var i=this.getVisibleItemIdsByGroupId(t.id);if(i.length){var n=e.indexBy(this.getSelectedItemsIds()),s=+new Date,o=this._updateTsById,a=this.get("parent").get("updatePeriod");if(i=e.filter(i,function(t){return!(t in n||t in o&&!(s-o[t]>a))}),i.length){var r=this;this._loadItemsData(i).done(function(t){r._updateItems(t)})}}},_loadItemsData:function(t){return App.getDevicesData(t)},_updateItems:function(t){if(t&&this.dataView){this._clearExpireTimeout();var i,n=e.indexBy(t,"id"),s=this.get("propertyId"),o=this,a=null,r=!1,l={},c=this._updateTsById,h=+new Date;e.each(this.dataView.getItems(),function(t){!t.isgroup&&t.id in n&&(a=n[t.id],o._copyParams(a,t),i=o._updateObjectModel(t),c[t.id]=h,i&&(r=e.keys(i.changed).length,(r||l[i.id])&&(o.dataView.updateItem(t[s],t),r&&(l[i.id]=r))))}),this.set({lastUpdateTs:+new Date,expired:!1})}},_clearExpireTimeout:function(){this._expireTimeout&&(clearTimeout(this._expireTimeout),this._expireTimeout=null)},_setExpireTimeout:function(t){if(!this.get("expired")&&!this._expireTimeout){var e=this;this._expireTimeout=setTimeout(function(){e.set("expired",!0)},t)}},getVisibleItemIdsByGroupId:function(t){var i=this.getTreeGroupById(t);if(!i||i.closed)return[];var n,s,o=[],a=this.get("propertyId"),r=i[a]+"_",l=i.groups,c=i.items;return l.length&&e.each(l,e.bind(function(t){n=parseInt(t.replace(r,"")),o=o.concat(this.getVisibleItemIdsByGroupId(n))},this)),c.length&&e.each(c,function(t){s=parseInt(t.replace(r,"")),o.push(s)}),o=e.uniq(o)},_itemsKeys:function(t,e){var i=[];for(var n in e)e.hasOwnProperty(n)&&i.push(t+"_"+e[n].id);return i},_getGroupListByObjItems:function(t){var i=[],n=[],s=this.get("propertyId");return e.each(t,e.bind(function(t){n=t[s].split("_"),n.pop(),e.each(n,e.bind(function(t,n){t=parseInt(t),i[n]="undefined"!=typeof i[n]?i[n]:[],-1==e.indexOf(i[n],t)&&i[n].push(t)},this))},this)),i},_setGroupsCheckedStatus:function(t,i){t=e.isNumber(t)?[t]:e.isString(t)?[parseInt(t)]:t;var n=[];e.each(t,e.bind(function(t){n=n.concat(this._getObjectItemsInGroup(t))},this)),this._setObjectsCheckedStatus(i?n:[],i?[]:n)},_getObjectItemsInGroup:function(t){var i=[],n=this.dataView,s=0===t?n.getItemByIdx(0):this.groups.get(t).attributes;return s.nbItems&&(i=s.items,e.each(s.groups,e.bind(function(t){i=i.concat(this._getObjectItemsInGroup(parseInt(t.replace(/[\d]*_/g,""))))},this))),i}}),h={getAllItemOnGroup:function(t){var i=[],n=this.getTreeGroupById(t);if(!n)return[];var s=this.get("propertyId"),o=n[s]+"_",a=n.groups,r=n.items;return a.length&&e.each(a,e.bind(function(t){var e=t.replace(o,"");i=i.concat(h.getAllItemOnGroup.call(this,e))},this)),r.length&&e.each(r,e.bind(function(t){var e=t.replace(o,"");i.push(this.items.get(e))},this)),i=e.uniq(i)},defineChecked:function(t){var e=!1;return e=t[l]?l:0==t[r]&&t[a]>0?a:t[r]>0&&0==t[a]||0==t[r]&&0==t[a]&&0==t[l]?r:l},convertIdsToArray:function(t){return t=e.isArray(t)&&t.length>0&&e.isObject(t[0])?e.pluck(t,"id"):t?e.isNumber(t)?[t]:e.isString(t)?[parseInt(t)]:t:[]},setTopGroupStatus:function(){if(this.dataView){var t=this.get("propertyId"),i=this.dataView,n=i.getItemByIdx(0),s=e.union(n.groups,n.items),o=[0,0,0];e.each(e.filter(i.getItems(),function(i){return-1!=e.indexOf(s,i[t])}),function(t){("undefined"==typeof t.nbItems||0!==t.nbItems)&&o[t.checked]++}),n.checked=h.defineChecked(o)}}};return c}),define("abstracts/watched/views/WatchedView",["jquery","jqueryui","underscore","abstracts/View"],function(t,e,i,n){var s=89,o=-89,a=180,r=-180,l=n.extend({constructor:function(){this._maps=null,this._clustersLayer=null,this._singlesLayer=null,this._infoView=null,this._popup=null,this._viewsMap={},n.apply(this,arguments)},_useClusters:!0,initialize:function(){return this._maps=this.model.get("parent").getMapsModule(),this._maps?(this._bindEvents(),void 0):console&&console.error("WatchedView: No Maps module for objects watching")},reset:function(){this.clear(),this._onModuleReady()},clear:function(){this._clustersLayer&&this._clustersLayer.trigger("destroy"),this._singlesLayer&&this._singlesLayer.trigger("destroy"),this._viewsMap={},this.model.set("bounds",null)},addWatchedMulti:function(){},getMapsModule:function(){return this._maps},_stopListeningModel:function(t){this.stopListening(t)},removeWatchedMulti:function(t,e){for(var i=t.length;i--;)this._removeViewById(t[i]);"undefined"==typeof e&&(e=this.model.zoomOnRemove),this._calculateBounds(e)},ensureCoords:function(t){var e=t.get("lat"),i=t.get("lon");return e&&i?!0:(t.set({lat:0,lon:0}),!1)},getBounds:function(){return this._bounds},updateBounds:function(t,e){var i=t.get("lat"),n=t.get("lon");if(i&&n){var l=this._cloneCurrentBounds();if(e)l=this._extendBounds(l,i,n),this.model.set("bounds",l,{zoom:!0});else{var c=!1;i>o&&s>i&&(i>=l[1][0]||i<=l[0][0])&&(c=!0),n>r&&a>n&&(n>=l[1][1]||n<=l[0][1])&&(c=!0),c?this._calculateBounds(this.model.zoomOnRemove):this.model.zoomOnRemove&&this.model.trigger("change:bounds",this.model,l,{zoom:!0})}}},zoomToItem:function(t){var e;if(t&&(i.isNumber(t)||t.id)){var e,n;n=i.isNumber(t)?this.model.items.get(t):t,n&&(e=this._viewsMap[n.id])?e.trigger("zoomchange",{center:[n.get("lat"),n.get("lon")],zoom:15,cluster:this._clustersLayer}):t.lat&&t.lon&&this._maps.setBounds([[t.lat,t.lon],[t.lat,t.lon]],{maxZoom:15})}},_bindEvents:function(){var t=this.model,e=this.model.items;this.listenToOnce(this.model,"change:ready",this._onModuleReady),this.listenTo(App,"objectsGroupingChange",this.rerenderLayer),this.listenTo(t,"itemzoom",this.zoomToItem).listenTo(e,"add",this._bindModelEvents).listenTo(t,"addmulti",this.addWatchedMulti).listenTo(e,"remove",this._stopListeningModel).listenTo(t,"removemulti",this.removeWatchedMulti)},_calculateBounds:function(t){var e=this,i=this._getNullBounds();this.model.items.each(function(t){var n=t.get("lat"),s=t.get("lon");n&&s&&(i=e._extendBounds(i,n,s))}),this.model.set("bounds",i,{zoom:t})},_extendBounds:function(t,e,i){return e>o&&s>e&&((e>t[1][0]||null===t[1][0])&&(t[1][0]=e),(e<t[0][0]||null===t[0][0])&&(t[0][0]=e)),i>r&&a>i&&((i>t[1][1]||null===t[1][1])&&(t[1][1]=i),(i<t[0][1]||null===t[0][1])&&(t[0][1]=i)),t},_getNullBounds:function(){return[[null,null],[null,null]]},_cloneCurrentBounds:function(){var t=this.model.get("bounds");return t=t&&t.length?[t[0].slice(0),t[1].slice(0)]:this._getNullBounds()},_onModuleReady:function(){var t=this.model.items;if(t.length){var e,i=this,n=[],s=[],o=this._getNullBounds();t.each(function(t){var a=t.get("lat"),r=t.get("lon");a&&r||t.set({lat:0,lon:0}),i._bindModelEvents(t),(e=i._buildMapElement(t))&&(t.get("hasAlarm")?s.push(e):n.push(e)),a&&r&&(o=i._extendBounds(o,a,r))}),t.length&&this.model.set("bounds",o,{zoom:!0}),this._createClustersLayer(n),this._createSinglesLayer(s)}},_checkLayersAndAddView:function(t){var e=this._useClusters?this._clustersLayer:this._singlesLayer;null===e?this[this._useClusters?"_createClustersLayer":"_createSinglesLayer"]([t]):e.addLayer(t)},_createClustersLayer:function(t){var e=App.getUserData("objectsGrouping"),i=this.model.get("objType")+"-"+this.model.get("objViewType");this._clustersLayer=this._maps.addLayersGroup({layers:t||[],groupCssClass:i,clusters:e.usedGrouping&&{icon:{html:"<div><span>#count#</span></div>",className:"marker-cluster-small "+this.model.get("objType")+"-cluster"}}})},_createSinglesLayer:function(t){var e="";this.model.has("objType")&&this.model.has("objViewType")&&(e=this.model.get("objType")+"-"+this.model.get("objViewType")),this._singlesLayer=this._maps.addLayersGroup({layers:t||[],groupCssClass:e,clusters:!1})},_buildMapElement:function(){return null},_buildMarkerHtml:function(t){return'<i class="i"></i><span class="name">'+i.escape(t.get("name"))+"</span>"},_bindModelEvents:function(t){var e=this,i=this.model;this.listenTo(t,"change:name",function(t){var n;(n=e._viewsMap[t.id])&&n.trigger("settitle",{title:i.buildItemTitle(t)})}).listenTo(t,"change:coords",function(t,i){if(e._viewsMap[t.id])e._placeOnMap(t),e.updateBounds(t,!1);else if(i[0]&&i[1]){var n;(n=e._buildMapElement(t))&&(e._checkLayersAndAddView(n,t),e._placeOnMap(t),e.updateBounds(t,!0))}}).listenTo(t,"change:hwStatus",function(t,i){var n;if(n=e._viewsMap[t.id]){var s=t.previous("hwStatus");n.trigger("toggleclass",{off:s,on:i})}})},_placeOnMap:function(t){if(t.has("lat")&&t.has("lon")){var e=this._viewsMap[t.id],i=t.get("lat"),n=t.get("lon"),s={model:t,to:{lat:i,lon:n},animate:!1};t.get("hasAlarm")||(s.cluster=this._clustersLayer),e.trigger("place",s)}},_afterViewsBuilt:function(t){var e=this.model.get("parent"),i=e.getZoomItem();this.model.set("bounds",t,{silent:!0}).trigger("change:bounds",this.model,t,{zoom:!i}),i&&(this.zoomToItem(i),e.setZoomItem(null))},rerenderLayer:function(){this._clustersLayer&&this._clustersLayer.trigger("destroy"),this._singlesLayer&&this._singlesLayer.trigger("destroy"),this._onModuleReady()},_switchViewLayer:function(t,e){var i,n;(i=this._viewsMap[t.id])&&(e?this._clustersLayer&&this._clustersLayer.removeLayer(i):this._singlesLayer&&this._singlesLayer.removeLayer(i)),(n=this._buildMapElement(t))&&(e?this._singlesLayer?this._singlesLayer.addLayer(n):this._singlesLayer=this._createSinglesLayer([n]):this._clustersLayer?this._clustersLayer.addLayer(n):this._clustersLayer=this._createClustersLayer([n]))},_bindPopup:function(e,i){var n=this;this.model.get("objType"),e.bindPopup(function(){var s=t(this.getContainer());return n._popup=this,s.addClass("obj-info selectable").data("marker",e).on("contentchange",function(){n._popup&&n._popup._map&&n._popup._adjustPan()}),n._popup.once("open",function(){n._buildInfoView(i,s[0]),n._infoView&&n.listenToOnce(n._infoView,"close",function(){n._closePopup(),n.stopListening(n._infoView),n._infoView=null}).listenToOnce(i,"remove",function(){n._infoView&&n._infoView.trigger("close")})}).once("close",function(){n._infoView&&n._infoView.remove(),n._popup.off("open close"),n._popup=null}),'<div class="info-placeholder"></div>'},{autoPan:!0,autoPanPadding:[80,60]})},_closePopup:function(){this._popup&&this._popup.close()},_buildInfoView:function(){return null},_removeViewById:function(t){var e=this._viewsMap[t];if(e){var i=!this._useClusters;i?this._singlesLayer.removeLayer(e):this._clustersLayer.removeLayer(e),this._viewsMap[t]=null}}});return l}),define("abstracts/watched/WatchedModule",["jquery","underscore","abstracts/Module","abstracts/watched/views/WatchedView"],function(t,e,i){var n=i.extend({constructor:function(){this._xhr=null,this._updateTimeout=null,i.apply(this,arguments)},zoomOnRemove:!1,_viewClass:null,items:null,defaults:e.extend({},i.prototype.defaults,{bounds:null,showBaloon:!0,updating:!0}),initialize:function(){var t=this;this._view=new this._viewClass({model:this}),this._bindEvents(),this.startLongProcess(),this.loadItems().always(function(){t.stopLongProcess()})},loadItems:function(e){var i=new t.Deferred,n="undefined"==typeof e;if(n)if(e=this.getUserData("items")||[],e.length){var s=this;this.items.fetch(e,{silent:!0,statusCode:{401:function(){s.getParent().trigger("401"),setTimeout(function(){App.trigger("logout")},50)}}}).done(function(){s.set("ready",!0),i.resolve()}).fail(function(){i.reject()})}else this.set("ready",!0),i.resolve();else e.length?this.items.fetch(e,{silent:!0,merge:!0}).done(function(){i.resolve()}).fail(function(){i.reject()}):i.resolve();return i},setItems:function(t){if(e.isArray(t)||(t=[t]),1!=t.length||1!=this.items.length||t[0].id!=this.items.at(0).id){var i=e.pluck(t,"id"),n=this.getUserData("items")||[],s=e.difference(i,n),o=e.difference(n,i);o.length&&(this.items.remove(this.items.models,{multi:!0}),this.trigger("removemulti",o,!1)),this.items.set(t,{parse:!0,silent:!0}),this.setUserData("items",this.items.pluck("id")),s.length&&this.trigger("addmulti",s),this.get("parent").trigger("toggleitems",s,o,this)}},unwatchItem:function(t){this.items.get(t)&&this.get("parent").trigger("toggleitems",[],[t],this)},toggleItems:function(t,e,i){if(e.length&&this.removeItems(e),t.length&&i!=this){var n=this;this.startLongProcess(),this.loadItems(t).done(function(){n._onItemsLoaded(t)}).always(function(){n.stopLongProcess()})}},removeItems:function(t){for(var e=t.length,i=this.items;e--;)i.remove(t[e],{multi:!0});this.setUserData("items",i.pluck("id")),this.trigger("removemulti",t)},updateItems:function(t){for(var e,i=t.length,n=this.items;i--;)e=n.get(t[i].id),e&&e.set(e.parse(t[i]))},getTexts:function(){return this.get("parent").getTexts()},getBounds:function(){return this.items.length?this.get("bounds"):null},buildItemTitle:function(t){var e=App.buildObjTitle.apply(App,arguments);return e.length||(e=t.has("extId")?"#"+t.get("extId"):t.get("name")),e},_bindEvents:function(){var t=this,e=this.get("parent");this.on("change:objViewType",function(){t.setUserData("objViewType",t.get("objViewType"))}).on("change:bounds",function(t,i,n){e.trigger("change:bounds",e,i,n)}),this.listenTo(e,"toggleitems",this.toggleItems).listenTo(e,"itemchanged",this._onItemChanged).listenTo(e,"updateitems",this.updateItems).listenTo(e,"401",function(){t.setUserData("items",null)})},getWatchedItemsIds:function(){var t=this.getUserData("items");return t||[]},getItemIdsForUpdate:function(){return(new t.Deferred).resolve(this.getWatchedItemsIds())},_onItemsLoaded:function(t){this.setUserData("items",this.items.pluck("id")),this.trigger("addmulti",t)},_onItemChanged:function(t){for(var e,i=t.length;i--;)if(t[i].id&&(e=this.items.get(t[i].id)))for(var n in t[i])"undefined"!=typeof e.attributes[n]&&e.get(n)!=t[i][n]&&e.set(n,t[i][n])}});return n}),define("abstracts/watched/views/ObjectsWatchedView",["jquery","underscore","./WatchedView"],function(t,e,i){var n=i.prototype,s=i.extend({constructor:function(){i.apply(this,arguments)},isIconsView:function(){return"icons"==this.model.get("objViewType")},addWatchedMulti:function(t){if(t&&t.length){for(var e,i,n=t.length,s=this.model.items,o=[],a=[],r=this._cloneCurrentBounds();n--;)if(i=s.get(t[n])){var l=this.ensureCoords(i);this._bindModelEvents(i),(e=this._buildMapElement(i))&&(i.get("hasAlarm")?a.push(e):o.push(e)),l&&(r=this._extendBounds(r,i.get("lat"),i.get("lon")))}this._afterViewsBuilt(r),this._addViewsToMap(a,o)}},_addViewsToMap:function(t,e){e.length&&(null===this._clustersLayer?this._createClustersLayer(e):this._clustersLayer.addLayers(e)),t.length&&(null===this._singlesLayer?this._createSinglesLayer(t):this._singlesLayer.addLayers(t))},_bindEvents:function(){var t=this;n._bindEvents.apply(this,arguments),this.listenTo(App,"hiddenObjInfoPropsChange",function(){t._infoView&&t._infoView.trigger("propschange")}),this.listenTo(this.model,"change:objViewType",function(e,i){var n=t.model.get("objType"),s=n+"-",o=s+t.model.previous("objViewType");t._clustersLayer&&t._clustersLayer.trigger("toggleclass",{name:s+i+" "+o}),t.reset()})},_bindModelEvents:function(t){var e=this;this.model,n._bindModelEvents.call(this,t),this.listenTo(t,"change:status",function(t,i){var n;if(n=e._viewsMap[t.id]){var s=t.previous("status");n.trigger("toggleclass",{off:s,on:i})}}).listenTo(t,"change:imgPath",function(t){var i;e.isIconsView()&&(i=e._viewsMap[t.id])&&i.trigger("iconchange",{html:'<i class="i" style="background-image:url('+t.getImgPath(!0)+');"></i>'+'<span class="name">'+t.get("name")+"</span>"})}).listenTo(t,"change:hasAlarm",function(t,i){var n;(n=e._viewsMap[t.id])&&n.trigger("toggleclass",{on:"alarm"}),t.get("isFollowed")||e._switchViewLayer(t,i)})},_buildMapElement:function(t){if(t.get("lat")&&t.get("lon")){var e=this.model.get("objType"),i=" obj-"+e+" "+t.get("status");t.get("hasAlarm")&&(i+=" alarm"),t.has("hwStatus")&&(i+=" "+t.get("hwStatus"));
var n=this._buildMarkerHtml(t),s=this._viewsMap[t.id]=this._maps.getWidget().buildComplexMarker({lat:t.get("lat"),lon:t.get("lon"),html:n,className:"complex-icon obj"+i,dataId:t.id,animated:!1,model:t});return this.model.get("showBaloon")&&this._bindPopup(s,t),s}},_buildMarkerHtml:function(t){var e="";return this.isIconsView()&&(e=' style="background-image:url('+t.getImgPath(!0)+');"'),'<i class="i"'+e+'></i><span class="name">'+this.model.buildItemTitle(t)+"</span>"},_checkLayersAndAddView:function(t,e){var i=e.get("hasAlarm")||e.get("isFollowed");i?null===this._singlesLayer?this._createSinglesLayer([t]):this._singlesLayer.addLayer(t):null===this._clustersLayer?this._createClustersLayer([t]):this._clustersLayer.addLayer(t)}});return s}),define("abstracts/watched/ObjectsWatchedModule",["jquery","underscore","./WatchedModule","./views/ObjectsWatchedView"],function(t,e,i){var n=i.prototype,s=i.extend({constructor:function(){i.apply(this,arguments)},defaults:e.extend({},i.prototype.defaults,{stateLoading:!1,startObjId:0}),removeItems:function(t){n.removeItems.call(this,t),App.trigger("toggleobjects",this.items.models)},loadItems:function(t){var e=this,i="undefined"==typeof t;return n.loadItems.apply(this,arguments).done(function(){i&&!e.items.length&&e.trigger("change:bounds",e,null)})},getHiddenProperties:function(){return App.getUserData("hiddenObjInfoProps")||{}},_onItemsLoaded:function(t){n._onItemsLoaded.call(this,t),App.trigger("toggleobjects",this.items.models)},_setItemsFromGET:function(){var t=App.get("paremetersFromGET"),e=this.get("objType");if("objType"in t&&"objId"in t){if(t.objType!=e)return this.setUserData("items",[]),void 0;var i=t.objId.split(":"),n=i.length;if(n){for(;n--;)i[n]=parseInt(i[n]);this.setUserData("items",i),1==i.length&&this.set("startObjId",i[0])}}}});return s}),define("abstracts/itemcard/CardModel",["underscore","jquery","abstracts/Model","abstracts/GrObject"],function(t,e,i,n){var s=i.extend({constructor:function(){this._object=null,this._newImage=null,i.apply(this,arguments)},ALERT_CONTROL_KEY:"objControl",FIRMWARE_UPDATE_STATUS_UNKNOWN:0,FIRMWARE_UPDATE_STATUS_TRUE:1,FIRMWARE_UPDATE_STATUS_FALSE:2,FIRMWARE_UPDATE_STATUS_PROGRESS:3,defaults:{canSetup:0,item:null,settings:null,objsGroups:[],objStatus:n.STATUS_NOTSERVED,objType:null,tech:null,device:null},parse:function(t){var e=t,i=e.item;return"devices"in i&&i.devices.length?(e.device=i.devices[0],delete i.devices):e.device={imei:"",shortName:"Unknown",firmware:""},e},setObject:function(t){this._object||(this._object=t)},getImgDir:function(){return this._object.IMG_DIR},getImgExt:function(){return this._object.IMG_EXT},getImagePath:function(){return this.getImgDir()+(this.get("settings").IMAGE_PATH||this._object.defaults.imgPath)+this.getImgExt()},setNewImage:function(t){this._newImage=t,this.trigger("imagechange",{img:t})},getNewImage:function(){return this._newImage},loadStatus:function(){var i=this,n=new e.Deferred;return this._object.loadStatus().done(function(e){i.set("objStatus",e.objStatus),e.objStatus==i._object.STATUS_SERVICE?i._object.getStaff().done(function(e){var s=t.findWhere(e,{positionCode:App.POSITION_CODE_TECH});s&&i.set("tech",s),n.resolve()}).fail(function(){n.reject()}):n.resolve()}).fail(function(){n.reject()}),n},startStopUpdate:function(t){return e.ajax({url:App.getBaseUrl()+"objects/set-updating/",data:{objectId:this._object.id,set:t?1:0}})},saveStatus:function(t){return this._object.saveStatus(t)},update:function(){},clearDataHistory:function(){return(new e.Deferred).reject("abstract method can not be used")}});return s}),define("text!_common/pictures/tmpl/pictures.html",[],function(){return'<div class="pictures">\n    <div class="content carousel slide">\n        <div class="carousel-inner"></div>\n\n        <a class="carousel-control svg-icon svg-icon-chevron-circle-left left hidden" href="#"></a>\n        <a class="carousel-control svg-icon svg-icon-chevron-circle-right right hidden" href="#"></a>\n    </div>\n    <div class="controls">\n        <p class="caption"><span></span></p>\n        <% if(editCaption) {%>\n        <div class="caption-form">\n            <input type="text" name="pictureCaption" value="" maxlength="255" class="ignore">\n            <a href="#" class="btn btn-primary save-caption">\n                <i class="svg-icon svg-icon-checkmark-w"></i>\n            </a>\n            <a href="#" class="btn btn-default cancel-caption">\n                <i class="svg-icon svg-icon-remove"></i>\n            </a>\n        </div>\n        <% } %>\n        <ol class="carousel-bullets"></ol>\n    </div>\n</div>\n<div class="no-data hidden"><%= emptyMsg %></div>'}),define("jcolorbox",["jquery"],function(t){!function(t,e,i){function n(i,n,s){var o=e.createElement(i);return n&&(o.id=Q+n),s&&(o.style.cssText=s),t(o)}function s(){return i.innerHeight?i.innerHeight:t(i).height()}function o(e,i){i!==Object(i)&&(i={}),this.cache={},this.el=e,this.value=function(e){var n;return void 0===this.cache[e]&&(n=t(this.el).attr("data-cbox-"+e),void 0!==n?this.cache[e]=n:void 0!==i[e]?this.cache[e]=i[e]:void 0!==K[e]&&(this.cache[e]=K[e])),this.cache[e]},this.get=function(e){var i=this.value(e);return t.isFunction(i)?i.call(this.el,this):i}}function a(t){var e=A.length,i=(H+t)%e;return 0>i?e+i:i}function r(t,e){return Math.round((/%/.test(t)?("x"===e?L.width():s())/100:1)*parseInt(t,10))}function l(t,e){return t.get("photo")||t.get("photoRegex").test(e)}function c(t,e){return t.get("retinaUrl")&&i.devicePixelRatio>1?e.replace(t.get("photoRegex"),t.get("retinaSuffix")):e}function h(t){"contains"in b[0]&&!b[0].contains(t.target)&&t.target!==_[0]&&(t.stopPropagation(),b.focus())}function d(t){d.str!==t&&(b.add(_).removeClass(d.str).addClass(t),d.str=t)}function u(e){H=0,e&&e!==!1&&"nofollow"!==e?(A=t("."+te).filter(function(){var i=t.data(this,J),n=new o(this,i);return n.get("rel")===e}),H=A.index(F.el),-1===H&&(A=A.add(F.el),H=A.length-1)):A=t(F.el)}function p(i){t(e).trigger(i),re.triggerHandler(i)}function m(i){var s;if(!q){if(s=t(i).data(J),F=new o(i,s),u(F.get("rel")),!W){W=G=!0,d(F.get("className")),b.css({visibility:"hidden",display:"block",opacity:""}),M=n(le,"LoadedContent","width:0; height:0; overflow:hidden; visibility:hidden"),w.css({width:"",height:""}).append(M),B=x.height()+T.height()+w.outerHeight(!0)-w.height(),U=C.width()+S.width()+w.outerWidth(!0)-w.width(),z=M.outerHeight(!0),V=M.outerWidth(!0);var a=r(F.get("initialWidth"),"x"),l=r(F.get("initialHeight"),"y"),c=F.get("maxWidth"),m=F.get("maxHeight");F.w=(c!==!1?Math.min(a,r(c,"x")):a)-V-U,F.h=(m!==!1?Math.min(l,r(m,"y")):l)-z-B,M.css({width:"",height:F.h}),Z.position(),p(ee),F.get("onOpen"),N.add(I).hide(),b.focus(),F.get("trapFocus")&&e.addEventListener&&(e.addEventListener("focus",h,!0),re.one(oe,function(){e.removeEventListener("focus",h,!0)})),F.get("returnFocus")&&re.one(oe,function(){t(F.el).focus()})}var f=parseFloat(F.get("opacity"));_.css({opacity:f===f?f:"",cursor:F.get("overlayClose")?"pointer":"",visibility:"visible"}).show(),F.get("closeButton")?j.html(F.get("close")).appendTo(w):j.appendTo("<div/>"),v()}}function f(){b||(X=!1,L=t(i),b=n(le).attr({id:J,"class":t.support.opacity===!1?Q+"IE":"",role:"dialog",tabindex:"-1"}).hide(),_=n(le,"Overlay").hide(),D=t([n(le,"LoadingOverlay")[0],n(le,"LoadingGraphic")[0]]),y=n(le,"Wrapper"),w=n(le,"Content").append(I=n(le,"Title"),P=n(le,"Current"),O=t('<button type="button"/>').attr({id:Q+"Previous"}),E=t('<button type="button"/>').attr({id:Q+"Next"}),R=n("button","Slideshow"),D),j=t('<button type="button"/>').attr({id:Q+"Close"}),y.append(n(le).append(n(le,"TopLeft"),x=n(le,"TopCenter"),n(le,"TopRight")),n(le,!1,"clear:left").append(C=n(le,"MiddleLeft"),w,S=n(le,"MiddleRight")),n(le,!1,"clear:left").append(n(le,"BottomLeft"),T=n(le,"BottomCenter"),n(le,"BottomRight"))).find("div div").css({"float":"left"}),k=n(le,!1,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"),N=E.add(O).add(P).add(R)),e.body&&!b.parent().length&&t(e.body).append(_,b.append(y,k))}function g(){function i(t){t.which>1||t.shiftKey||t.altKey||t.metaKey||t.ctrlKey||(t.preventDefault(),m(this))}return b?(X||(X=!0,E.click(function(){Z.next()}),O.click(function(){Z.prev()}),j.click(function(){Z.close()}),_.click(function(){F.get("overlayClose")&&Z.close()}),t(e).bind("keydown."+Q,function(t){var e=t.keyCode;W&&F.get("escKey")&&27===e&&(t.preventDefault(),Z.close()),W&&F.get("arrowKey")&&A[1]&&!t.altKey&&(37===e?(t.preventDefault(),O.click()):39===e&&(t.preventDefault(),E.click()))}),t.isFunction(t.fn.on)?t(e).on("click."+Q,"."+te,i):t("."+te).live("click."+Q,i)),!0):!1}function v(){var e,s,o,a=Z.prep,h=++ce;if(G=!0,$=!1,p(ae),p(ie),F.get("onLoad"),F.h=F.get("height")?r(F.get("height"),"y")-z-B:F.get("innerHeight")&&r(F.get("innerHeight"),"y"),F.w=F.get("width")?r(F.get("width"),"x")-V-U:F.get("innerWidth")&&r(F.get("innerWidth"),"x"),F.mw=F.w,F.mh=F.h,F.get("maxWidth")&&(F.mw=r(F.get("maxWidth"),"x")-V-U,F.mw=F.w&&F.w<F.mw?F.w:F.mw),F.get("maxHeight")&&(F.mh=r(F.get("maxHeight"),"y")-z-B,F.mh=F.h&&F.h<F.mh?F.h:F.mh),e=F.get("href"),Y=setTimeout(function(){D.show()},100),F.get("inline")){var d=t(e);o=t("<div>").hide().insertBefore(d),re.one(ae,function(){o.replaceWith(d)}),a(d)}else F.get("iframe")?a(" "):F.get("html")?a(F.get("html")):l(F,e)?(e=c(F,e),$=new Image,t($).addClass(Q+"Photo").bind("error",function(){a(n(le,"Error").html(F.get("imgError")))}).one("load",function(){h===ce&&setTimeout(function(){var e;t.each(["alt","longdesc","aria-describedby"],function(e,i){var n=t(F.el).attr(i)||t(F.el).attr("data-"+i);n&&$.setAttribute(i,n)}),F.get("retinaImage")&&i.devicePixelRatio>1&&($.height=$.height/i.devicePixelRatio,$.width=$.width/i.devicePixelRatio),F.get("scalePhotos")&&(s=function(){$.height-=$.height*e,$.width-=$.width*e},F.mw&&$.width>F.mw&&(e=($.width-F.mw)/$.width,s()),F.mh&&$.height>F.mh&&(e=($.height-F.mh)/$.height,s())),F.h&&($.style.marginTop=Math.max(F.mh-$.height,0)/2+"px"),A[1]&&(F.get("loop")||A[H+1])&&($.style.cursor="pointer",$.onclick=function(){Z.next()}),$.style.width=$.width+"px",$.style.height=$.height+"px",a($)},1)}),$.src=e):e&&k.load(e,F.get("data"),function(e,i){h===ce&&a("error"===i?n(le,"Error").html(F.get("xhrError")):t(this).contents())})}var _,b,y,w,x,C,S,T,A,L,M,k,D,I,P,R,E,O,j,N,F,B,U,z,V,H,$,W,G,q,Y,Z,X,K={html:!1,photo:!1,iframe:!1,inline:!1,transition:"elastic",speed:300,fadeOut:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!0,opacity:.9,preloading:!0,className:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:void 0,closeButton:!0,fastIframe:!0,open:!1,reposition:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp|jxr|svg)((#|\?).*)?$/i,retinaImage:!1,retinaUrl:!1,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:!0,trapFocus:!0,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1,rel:function(){return this.rel},href:function(){return t(this).attr("href")},title:function(){return this.title}},J="colorbox",Q="cbox",te=Q+"Element",ee=Q+"_open",ie=Q+"_load",ne=Q+"_complete",se=Q+"_cleanup",oe=Q+"_closed",ae=Q+"_purge",re=t("<a/>"),le="div",ce=0,he={},de=function(){function t(){clearTimeout(a)}function e(){(F.get("loop")||A[H+1])&&(t(),a=setTimeout(Z.next,F.get("slideshowSpeed")))}function i(){R.html(F.get("slideshowStop")).unbind(l).one(l,n),re.bind(ne,e).bind(ie,t),b.removeClass(r+"off").addClass(r+"on")}function n(){t(),re.unbind(ne,e).unbind(ie,t),R.html(F.get("slideshowStart")).unbind(l).one(l,function(){Z.next(),i()}),b.removeClass(r+"on").addClass(r+"off")}function s(){o=!1,R.hide(),t(),re.unbind(ne,e).unbind(ie,t),b.removeClass(r+"off "+r+"on")}var o,a,r=Q+"Slideshow_",l="click."+Q;return function(){o?F.get("slideshow")||(re.unbind(se,s),s()):F.get("slideshow")&&A[1]&&(o=!0,re.one(se,s),F.get("slideshowAuto")?i():n(),R.show())}}();t[J]||(t(f),Z=t.fn[J]=t[J]=function(e,i){var n,s=this;if(e=e||{},t.isFunction(s))s=t("<a/>"),e.open=!0;else if(!s[0])return s;return s[0]?(f(),g()&&(i&&(e.onComplete=i),s.each(function(){var i=t.data(this,J)||{};t.data(this,J,t.extend(i,e))}).addClass(te),n=new o(s[0],e),n.get("open")&&m(s[0])),s):s},Z.position=function(e,i){function n(){x[0].style.width=T[0].style.width=w[0].style.width=parseInt(b[0].style.width,10)-U+"px",w[0].style.height=C[0].style.height=S[0].style.height=parseInt(b[0].style.height,10)-B+"px"}var o,a,l,c=0,h=0,d=b.offset();if(L.unbind("resize."+Q),b.css({top:-9e4,left:-9e4}),a=L.scrollTop(),l=L.scrollLeft(),F.get("fixed")?(d.top-=a,d.left-=l,b.css({position:"fixed"})):(c=a,h=l,b.css({position:"absolute"})),h+=F.get("right")!==!1?Math.max(L.width()-F.w-V-U-r(F.get("right"),"x"),0):F.get("left")!==!1?r(F.get("left"),"x"):Math.round(Math.max(L.width()-F.w-V-U,0)/2),c+=F.get("bottom")!==!1?Math.max(s()-F.h-z-B-r(F.get("bottom"),"y"),0):F.get("top")!==!1?r(F.get("top"),"y"):Math.round(Math.max(s()-F.h-z-B,0)/2),b.css({top:d.top,left:d.left,visibility:"visible"}),y[0].style.width=y[0].style.height="9999px",o={width:F.w+V+U,height:F.h+z+B,top:c,left:h},e){var u=0;t.each(o,function(t){return o[t]!==he[t]?(u=e,void 0):void 0}),e=u}he=o,e||b.css(o),b.dequeue().animate(o,{duration:e||0,complete:function(){n(),G=!1,y[0].style.width=F.w+V+U+"px",y[0].style.height=F.h+z+B+"px",F.get("reposition")&&setTimeout(function(){L.bind("resize."+Q,Z.position)},1),t.isFunction(i)&&i()},step:n})},Z.resize=function(t){var e;W&&(t=t||{},t.width&&(F.w=r(t.width,"x")-V-U),t.innerWidth&&(F.w=r(t.innerWidth,"x")),M.css({width:F.w}),t.height&&(F.h=r(t.height,"y")-z-B),t.innerHeight&&(F.h=r(t.innerHeight,"y")),t.innerHeight||t.height||(e=M.scrollTop(),M.css({height:"auto"}),F.h=M.height()),M.css({height:F.h}),e&&M.scrollTop(e),Z.position("none"===F.get("transition")?0:F.get("speed")))},Z.prep=function(i){function s(){return F.w=F.w||M.width(),F.w=F.mw&&F.mw<F.w?F.mw:F.w,F.w}function r(){return F.h=F.h||M.height(),F.h=F.mh&&F.mh<F.h?F.mh:F.h,F.h}if(W){var h,u="none"===F.get("transition")?0:F.get("speed");M.remove(),M=n(le,"LoadedContent").append(i),M.hide().appendTo(k.show()).css({width:s(),overflow:F.get("scrolling")?"auto":"hidden"}).css({height:r()}).prependTo(w),k.hide(),t($).css({"float":"none"}),d(F.get("className")),h=function(){function i(){t.support.opacity===!1&&b[0].style.removeAttribute("filter")}var n,s,r=A.length;W&&(s=function(){clearTimeout(Y),D.hide(),p(ne),F.get("onComplete")},I.html(F.get("title")).show(),M.show(),r>1?("string"==typeof F.get("current")&&P.html(F.get("current").replace("{current}",H+1).replace("{total}",r)).show(),E[F.get("loop")||r-1>H?"show":"hide"]().html(F.get("next")),O[F.get("loop")||H?"show":"hide"]().html(F.get("previous")),de(),F.get("preloading")&&t.each([a(-1),a(1)],function(){var i,n=A[this],s=new o(n,t.data(n,J)),a=s.get("href");a&&l(s,a)&&(a=c(s,a),i=e.createElement("img"),i.src=a)})):N.hide(),F.get("iframe")?(n=e.createElement("iframe"),"frameBorder"in n&&(n.frameBorder=0),"allowTransparency"in n&&(n.allowTransparency="true"),F.get("scrolling")||(n.scrolling="no"),t(n).attr({src:F.get("href"),name:(new Date).getTime(),"class":Q+"Iframe",allowFullScreen:!0}).one("load",s).appendTo(M),re.one(ae,function(){n.src="//about:blank"}),F.get("fastIframe")&&t(n).trigger("load")):s(),"fade"===F.get("transition")?b.fadeTo(u,1,i):i())},"fade"===F.get("transition")?b.fadeTo(u,0,function(){Z.position(0,h)}):Z.position(u,h)}},Z.next=function(){!G&&A[1]&&(F.get("loop")||A[H+1])&&(H=a(1),m(A[H]))},Z.prev=function(){!G&&A[1]&&(F.get("loop")||H)&&(H=a(-1),m(A[H]))},Z.close=function(){W&&!q&&(q=!0,W=!1,p(se),F.get("onCleanup"),L.unbind("."+Q),_.fadeTo(F.get("fadeOut")||0,0),b.stop().fadeTo(F.get("fadeOut")||0,0,function(){b.hide(),_.hide(),p(ae),M.remove(),setTimeout(function(){q=!1,p(oe),F.get("onClosed")},1)}))},Z.remove=function(){b&&(b.stop(),t[J].close(),b.stop(!1,!0).remove(),_.remove(),q=!1,b=null,t("."+te).removeData(J).removeClass(te),t(e).unbind("click."+Q).unbind("keydown."+Q))},Z.element=function(){return t(F.el)},Z.settings=K)}(t,document,window)}),define("_common/pictures/views/PicturesView",["jquery","underscore","abstracts/View","text!_common/pictures/tmpl/pictures.html","jcolorbox","css!_libs/colorbox/colorbox.css","css!_common/pictures/css/pictures.css"],function(t,e,i,n){function s(){t(this).data("loaded",!0).parent().removeClass("loading")}n=e.template(n);var o=i.extend({constructor:function(){this._pictures=null,this._carouselContent=null,this._bullets=null,this._controls=null,this._caption=null,this._captionText=null,this._captionForm=null,this._captionInput=null,this._noData=null,i.apply(this,arguments)},initialize:function(){var t=this;this.render(),a.bindEvents.call(this),this.model.loadList().done(function(e){t.$el.removeClass("loading"),a.buildCarousel.call(t),e.length&&a.displayPicture.call(t,t.model.getList()[0],!0)})},render:function(){this.$el.addClass("loading").html(n(e.extend({},this.model.attributes,{emptyMsg:this.model.getTexts().noPictures}))),this._pictures=this.$el.find(".pictures"),this._carouselContent=this.$el.find(".carousel-inner"),this._bullets=this.$el.find(".carousel-bullets"),this._noData=this.$el.find(".no-data"),this._controls=this.$el.find(".carousel-control"),this._caption=this.$el.find(".caption"),this._captionText=this._caption.find("span"),this.model.get("editCaption")&&(this._captionForm=this.$el.find(".caption-form"),this._captionInput=this._captionForm.find("input"))}}),a={bindEvents:function(){var i=this;this.$el.on("click",".carousel-bullets li",function(){i.model.set("current",t(this).data("index"))}).on("click",".carousel-control",function(){var t=-1!=this.className.indexOf("left")?-1:1;a.stepBy.call(i,t)}).on("click","img",function(){var n=i.model.getList()[t(this).parent().data("index")];t.colorbox({html:'<img src="'+this.src+'">',title:e.escape(n.caption),maxWidth:.9*window.innerWidth,maxHeight:.9*window.innerHeight})});var n="";"onwheel"in document?n="wheel":"onmousewheel"in document&&(n="mousewheel"),n&&this.$el.find(".carousel-inner").on(n,function(t){var e=a.getWheelDelta(t.originalEvent);a.stepBy.call(i,e>0?-1:1)}),this.model.get("editCaption")&&(i._captionText.on("click",function(){var t=i._captionText.text();i._caption.addClass("hidden"),i._captionForm.removeClass("hidden"),t!=i.model.getTexts().noCaption?i._captionInput.val(t):i._captionInput.val(""),i._captionInput.focus()}),this._captionInput.on("keypress",function(t){return t.stopPropagation(),13==t.keyCode||10==t.keyCode?(a.saveCaption.call(i),!1):void 0}).on("keyup",function(t){t.stopPropagation(),27==t.keyCode&&a.cancelEditCaption.call(i)}),i._captionForm.on("click",".cancel-caption",function(){a.cancelEditCaption.call(i)}).on("click",".save-caption",function(){a.saveCaption.call(i)})),this.listenTo(this.model,"change:current",function(t,e){a.displayPicture.call(i,i.model.getList()[e],e>t.previous("current"))}).listenTo(this.model,"pictureadded",function(e){var n=i.model.getList().length;1==n&&a.showCarousel.call(i);var o=t(a.getCarouselItem(e,n-1)).appendTo(i._carouselContent);i._bullets.append(a.getBullet(e,n-1)),o.find("img").one("load",s)}).listenTo(this.model,"picturedeleted",function(e,n){i.model.getList().length||a.hideCarousel.call(i);var s=i.$el.find("[data-index]");s.each(function(){var e=t(this),i=e.data("index");i>n&&e.data("index",i-1).attr("data-index",i-1)}),i.$el.find("[data-id="+e+"]").remove()})},stepBy:function(t){var e=this.model.get("current"),i=this.model.getList().length-1,n=e+t;this.model.set("current",Math.max(0,Math.min(i,n)))},buildCarousel:function(){var t=this.model.getList();if(t.length){var i="",n="",o=0;e.each(t,function(t){n+=a.getBullet(t,o),i+=a.getCarouselItem(t,o),o++}),this._bullets.html(n),this._carouselContent.html(i),this._controls.removeClass("hidden"),this.$el.find("img").one("load",s)}else a.hideCarousel.call(this)},showCarousel:function(){this._pictures.removeClass("hidden"),this._controls.removeClass("hidden"),this._noData.addClass("hidden")},hideCarousel:function(){this._pictures.addClass("hidden"),this._controls.addClass("hidden"),this._noData.removeClass("hidden")},getBullet:function(t,e){return'<li data-index="'+e+'" data-id="'+t.id+'"></li>'},getCarouselItem:function(t,e){return'<div data-index="'+e+'" data-id="'+t.id+'" class="item">'+'<img src="#" alt="" />'+"</div>"},displayPicture:function(t,i){var n=this,s=t.id,o=this.model.get("current"),r=this.$el.find(".carousel-inner"),l=r.find(".item[data-id="+s+"]"),c=-1!=l[0].className.indexOf("deleted"),h=r.find(".active"),d=this.$el.find(".carousel-control.left").removeClass("disabled"),u=this.$el.find(".carousel-control.right").removeClass("disabled");0==o&&d.addClass("disabled"),o==this.model.getList().length-1&&u.addClass("disabled"),h.length&&(l.addClass(i?"next":"prev"),h.addClass(i?"prev":"next")),setTimeout(function(){if(h.removeClass("active"),l.removeClass("prev next").addClass("active"),n.$el.find(".carousel-bullets .active").removeClass("active").end().find('.carousel-bullets [data-index="'+o+'"]').addClass("active"),!c){l.addClass("loading");var i=n.model.getTexts().noCaption,r=l.find("img");a.cancelEditCaption.call(n),n._captionText.text(e.escape(t.caption||i)),n.model.loadPicture(s).done(function(e){r[0].src="data:"+t.mimeType+";base64,"+e,r.data("loaded")&&l.removeClass("loading"),setTimeout(function(){h.removeClass("prev next")},500)}).fail(function(t){l.removeClass("loading"),(401==t||"Unauthorized"==t)&&l.addClass("deleted").html(n.model.getTexts().pictureHadBeenDeleted)})}},10)},saveCaption:function(){var i=this,n=this.model.getTexts();this.$el.addClass("loading");var s=e.escape(t.trim(i._captionInput.val()));this.model.saveCaption(s).done(function(){i._captionText.text(s||n.noCaption),a.cancelEditCaption.call(i)}).fail(function(){alert(n.canNotSave,n.error)}).always(function(){i.$el.removeClass("loading")})},cancelEditCaption:function(){this._captionForm&&-1==this._captionForm[0].className.indexOf("hidden")&&(this._captionForm.addClass("hidden"),this._caption.removeClass("hidden"))},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e}};return o}),define("_common/pictures/PicturesModule",["underscore","jquery","abstracts/Module","_common/pictures/views/PicturesView","i18n!_common/nls/common"],function(t,e,i,n,s){var o=i.extend({constructor:function(){this._list=null,this._loaded={},i.apply(this,arguments)},defaults:{container:null,objectId:0,current:0,editCaption:!1},initialize:function(){this._view=new n({el:this.get("container"),model:this})},getTexts:function(){return s},getList:function(){return this._list},loadList:function(){if(null==this._list){var t=this;return e.ajax({url:App.getBaseUrl()+"pictures/find-for-object/",data:{objectId:this.get("objectId")},statusCode:{401:function(){}},success:function(e){t._list=e}})}return(new e.Deferred).resolve(this._list)},loadPicture:function(i){var n=this,s=new e.Deferred;if("undefined"==typeof this._loaded[i]){var o=t.findWhere(this._list,{id:i});e.ajax({url:App.getBaseUrl()+"pictures/data/?pictureId="+i,dataType:"text",contentType:o.mimeType,data:{pictureId:o.id},processData:!0,mimeType:o.mimeType,statusCode:{401:function(){delete n._loaded[i]}},success:function(t){n._loaded[i]=t,s.resolve(t)},error:function(t){s.reject(t.statusText)}})}else s.resolve(n._loaded[i]);return s},addPicture:function(t){this._list.push(t),this.trigger("pictureadded",t),this.set("current",this._list.length-1)},deletePicture:function(i){var n=this,s=t.findWhere(this._list,{id:i});if(s){var o=t.indexOf(this._list,s),a=this.get("current");e.ajax({url:App.getBaseUrl()+"pictures/delete/",data:[i],complete:function(t){t.status>=200&&t.status<300&&(i in n._loaded&&(n._loaded[i]=null),n._list.splice(o,1),n.trigger("picturedeleted",i,o),a==o&&(n.set("current",null,{silent:!0}),n._list.length&&(o<n._list.length?n.set("current",o):n.set("current",0))))}})}},saveCaption:function(t){var i=this._list[this.get("current")],n=new e.Deferred;return e.ajax({url:App.getBaseUrl()+"pictures/set-caption/",data:{pictureId:i.id,caption:t},complete:function(e){e.status>=200&&e.status<300?(i.caption=t,n.resolve()):n.reject()}}),n},destroy:function(){this._loaded=null,this._list=null,this._view.remove()}});return o}),define("text!abstracts/itemcard/tmpl/export.html",[],function(){return'<input type="hidden" name="objectId" value="<%= objectId %>" />\n<input type="hidden" name="tzId" value="<%= tzId %>" />\n<% _.each(parts, function(name, key) {%>\n<label class="checkbox">\n    <input type="checkbox" name="parts" value="<%= key %>" <% if(key === \'objectinfo\') {%>checked<% } %>>\n    <%= name %>\n</label>\n<% }) %>'}),define("abstracts/itemcard/views/ExportView",["jquery","jface","underscore","abstracts/View","text!../tmpl/export.html","fileDownload"],function(t,e,i,n,s){s=i.template(s);var o=n.prototype,a=n.extend({constructor:function(){n.apply(this,arguments),this.options={}},initialize:function(t){this.options=t,this.render()},render:function(){var t=this,i=this.options.i18n,n=this.options.objType,o=App.getTimezone({offset:60*App.getUserTimezone()}),a={objectinfo:i.object.ucFirst(),hardware:i.hardware};n===App.TYPE_STAT?Object.assign(a,{areas:i.objAreas,zones:i.objZones,outputs:i.deviceOuts,schedules:i.armSchedulesShort,control:i.alertsControl}):Object.assign(a,{connections:i.sensorsAndDevices,fuel:i.fuel.ucFirst(),filters:i.filters}),Object.assign(a,{photo:i.objPhoto,video:i.video,responsible:i.responsible.header,notifications:i.notifications}),e.window.open({winId:"win-export-card",headerHtml:i.saveObjectCardToFile,contentHtml:s({objectId:this.options.objectId,tzId:o.id,parts:a}),footerHtml:'<button type="submit" class="btn btn-primary">'+i.save.ucFirst()+"</button>"+'<a href="javascript:;" class="btn jw-close">'+i.cancel.ucFirst()+"</a>",addForm:'<form method="post" action="'+App.getBaseUrl()+'obj-card/exportForm" target="_blank"></form>',width:400,resizable:!1,centered:!0,openCallback:function(){t.setElement(this),t.$el.find("form").on("submit",r.onSubmit.bind(t))}})},remove:function(){this.$el.trigger("jw.close"),o.remove.apply(this,arguments)}}),r={onSubmit:function(e){var i=t(e.target).serializeObject();return"parts"in i&&(r.export.call(this,i),this.$el.trigger("jw.close")),!1},"export":function(e){var i=new t.Deferred;return e.authorization=App.getBasic(),e.locale=App.getLocale(),"string"==typeof e.parts&&(e.parts=[e.parts]),t.fileDownload(App.getBaseUrl()+"obj-card/exportForm",{httpMethod:"POST",data:t.param(e)}).done(function(){i.resolve()}).fail(function(){i.reject.apply(null,arguments)}),i}};return a}),define("text!abstracts/itemcard/tmpl/import.html",[],function(){return'<div class="card-extra-action picture-form form-horizontal">\n    <span>XLS, XLSX <%= i18n.upto %> 10Mb</span>\n    <div class="file-upload-input">\n\n        <a data-placeholder="<%= i18n.chooseFile %>..." class="btn btn-file text-left" style="padding-left:10px">\n            <%= i18n.chooseFile %>...\n        </a>\n        <input class="file-import" type="file" name="file" accept=".xls,.xlsx" >\n    </div>\n\n    <button type="submit" class="btn btn-primary btn-submit"><%= i18n.upload.ucFirst() %></button>\n    <a class="btn btn-cancel"><%= i18n.cancel %></a>\n\n</div>'}),define("abstracts/itemcard/views/ImportView",["jquery","jface","underscore","abstracts/View","text!../tmpl/import.html","fileDownload"],function(t,e,i,n,s){s=i.template(s),n.prototype;var o=/.(xls|xlsx)$/i,a=10485760,r=n.extend({constructor:function(){this.props={},this.fileData=null,this.$el=null,this.$btn=null,this.bindEvents.bind(this),this.clearFileInput.bind(this),n.apply(this,arguments)},initialize:function(t){this.options=t,this.fileData=null,this.render()},render:function(){this.$el&&this.remove(),this.$el=t(s({objectId:this.options.objectId,i18n:this.options.i18n})).appendTo(this.options.$el),this.bindEvents()},clearFileInput:function(){var t=this.$el.find("[name=file]")[0],e=this.$el.find(".btn-file"),i=this.options.i18n;t.value=null,e.text(i.chooseFile+"...")},bindEvents:function(){this.$el.find(".btn-submit").on("click",this.onSubmit.bind(this)),this.$el.find(".btn-cancel").on("click",this.remove.bind(this)),this.$el.find(".file-import").on("change",this.onChangeFile.bind(this))},remove:function(){this.$el.remove()},onChangeFile:function(t){t.preventDefault();var e=this,i=t.target.files[0],n=new FileReader;if(!i.name.match(o)){var s=this.options.i18n;return e.clearFileInput(),alert(s.pleaseSelectFile,s.error),void 0}if(i.size>a){var s=this.options.i18n;return e.clearFileInput(),alert(s.errorFileSize.replace("#s#","10Mb"),s.error),void 0}n.onloadend=function(){var t=e.$el.find(".btn-file");e.fileData=n.result.replace(/^data:.+;base64,/,""),t.text(i.name)},n.readAsDataURL(i)},onSubmit:function(e){e.preventDefault();var i=this;if(!this.fileData){var n=this.options.i18n;return alert(n.pleaseSelectFile,n.error),void 0}this.$el.addClass("loading"),t.ajax({url:App.getBaseUrl()+"obj-card/import/",data:{objectId:+this.options.objectId,scode:App.modules.maps.getMap().scode,fileData:this.fileData},success:function(){t("#pop-obj-card").trigger("jw.close")},error:function(e){var n=i.options.i18n,s=t.parseJSON(e.responseText);s.msg&&alert(s.msg,s.hdr||n.error)},complete:function(){i.$el&&i.$el.removeClass("loading")}})}});return r}),define("text!abstracts/itemcard/tmpl/copySettingsForm.html",[],function(){return'<form class="card-extra-action copy-settings-form form-horizontal" method="post">\n    <span class="card-extra-action-note"><%= formLabel %></span>\n    <input placeholder="" type="text" name="" />\n    <button type="submit" class="btn btn-primary"><%= i18n.copy %></button>\n    <a class="btn btn-cancel"><%= i18n.cancel %></a>\n</form>'}),define("abstracts/itemcard/views/CopySettingsView",["jquery","underscore","abstracts/View","text!../tmpl/copySettingsForm.html"],function(t,e,i,n){n=e.template(n),i.prototype;var s=i.extend({constructor:function(){this.controller=null,this.parent=null,this.$form=null,this._settingsProvider=null,this._searchCache={},this._objectIds=[],i.apply(this,arguments)},initialize:function(t){this.controller=t.controller,this.parent=t.parent,"settingsProvider"in t&&(this._settingsProvider=t.settingsProvider),this.render()},render:function(){if(this._settingsProvider){var e=this.controller.getTexts(),i=this._settingsProvider.getCopySettingsFormLabel();this.$form=t(n({formLabel:i,i18n:e})).appendTo(this.$el),o.init.call(this)}}}),o={init:function(){var t=this,e=this.$form,i=e.find("input"),n=e.find("button[type=submit]"),s=this._objectIds=[],a=this._settingsProvider,r=a.getCopySettingsObjectsType();e.on("submit",function(){return t._objectIds.length&&a.onCopySettingsFormSubmit(e,o.onSubmitConfirmed.bind(t)),!1}).on("click",".btn-cancel",function(){a.onCopySettingsCancelled()}),i.catcomplete({delay:0,appendTo:e,minLength:2,source:function(e,i){var n=e.term.toLowerCase();n in t._searchCache?i(t._searchCache[n]):App.searchObjectsAndGroups(n,r).done(function(e){t._searchCache[n]=e,i(e)}).fail(function(){i([])})},select:function(e,i){var o=i.item.model;s=o.isGroup?App.getAllDeviceIdsInGroup(o.id):[o.id],n.prop("disabled",!s.length),t._objectIds=s}}),i.on("change",function(){this.value||(t._objectIds=[],n.prop("disabled",!0))})},onSubmitConfirmed:function(){var t=this,e=this._settingsProvider,i=e.getSettingsToCopy();this.$form.addClass("loading"),o.copySettingToObjects.call(this,i,t._objectIds).done(function(){e.onCopySettingsDone()}).fail(function(t){e.onCopySettingsFail(t)}).always(function(){t.$form.removeClass("loading")})},copySettingToObjects:function(e,i){var n=App.getBaseUrl()+"objects/obj-settings-copy/";return i.length?t.ajax({url:n,data:{fromObjectId:this.model.id,toObjectId:i,settings:e,merge:this._settingsProvider.mergeSettingsBeingCopied()}}):(new t.Deferred).resolve()
}};return s}),define("abstracts/itemcard/Notification",["underscore","abstracts/Model"],function(t,e){var i={devices:"notificationObjectCollection",deviceGroups:"notificationGroupCollection",areas:"notificationAreaCollection",zones:"notificationZoneCollection",alertGroups:"notificationAlertGroupCollection",alerts:"notificationAlertCollection",addresses:"notificationAddressCollection"},n="EML",s="SMS",o=e.extend({constructor:function(){e.apply(this,arguments)},defaults:t.extend({},e.defaults,{id:0,name:"",isActive:!0,devices:[],deviceGroups:[],alertGroups:[],alerts:[],addresses:[]}),parse:function(e){var n=e,s=t.invert(i);return a.translate(n,s),n},serialize:function(){var t=JSON.parse(JSON.stringify(this.attributes));return a.translate(t,i),t.id||delete t.id,t},getAddressCode:function(t){return-1!=t.indexOf("email")?n:-1!=t.indexOf("phone")?s:""},getEmails:function(){return a.getAddresses.call(this,{addressType:n})},getPhones:function(){return a.getAddresses.call(this,{addressType:s})}}),a={translate:function(e,i){return t.each(e,function(n,s){t.isObject(n)&&a.translate(n,i),s in i&&(e[i[s]]=n,delete e[s])}),e},getAddresses:function(e){var i=t.where(this.get("addresses"),e);return t.pluck(i,"address")},setAddresses:function(e,i){var n=t.filter(this.get("addresses"),function(t){return t.addressType!=e});t.each(i,function(t){n.push({address:t,addressType:e})}),this.set("addresses",n)}};return o}),define("abstracts/itemcard/NotificationsCollection",["abstracts/Collection","./Notification"],function(t,e){var i=t.extend({constructor:function(){t.apply(this,arguments)},model:e,url:App.getBaseUrl()+"notifications/"});return i}),define("text!abstracts/itemcard/tmpl/notificationsEditable.html",[],function(){return'<table class="table table-condensed notifications <% if (!items.length) { %> hidden<% } %>">\n    <thead>\n    <tr>\n        <!--<th>#</th>-->\n        <th><%= i18n.name.ucFirst() %></th>\n        <th><%= i18n.switchState %></th>\n        <th><%= i18n.addresses.ucFirst() %></th>\n        <th></th>\n        <th></th>\n    </tr>\n    </thead>\n    <tbody>\n    <% _.each(items, function(n, index){\n        print( tmplRow(_.extend({\n            isActiveS: n.isActive ? i18n.notificationSwitchedOn : i18n.notificationSwitchedOff\n        }, n)) );\n    }) %>\n    </tbody>\n</table>\n\n<p class="no-data<% if (items.length) { %> hidden<% } %>">\n    <%= i18n.tableNoRecords %>\n</p>'}),define("text!abstracts/itemcard/tmpl/notificationForm.html",[],function(){return'<div class="control-group">\n    <label class="control-label"><%= i18n.notificationName %></label>\n    <div class="controls">\n        <input name="name" class="input-block-level" type="text" value="<%- name %>" maxlength="255">\n    </div>\n</div>\n\n<div class="control-group form-inline">\n    <label class="checkbox">\n        <input type="checkbox" name="isActive" value="true"<%= isActive ? \' checked\' : \'\'%>>\n        <%= i18n.notificationSwitchedOn %>\n    </label>\n</div>\n\n<!--<h4>TODO addresses header</h4>-->\n<div class="row-fluid">\n    <div class="control-group span<%= App.isSmsAllowed() ? \'6\' : \'12\' %> no-bottom-margin">\n        <label class="control-label">E-Mail</label>\n        <div class="controls">\n            <textarea name="emails" class="input-block-level"><% print(emails.join("\\r\\n")) %></textarea>\n        </div>\n    </div>\n    <% if(App.isSmsAllowed()) {%>\n    <div class="control-group span6 no-bottom-margin">\n        <label class="control-label">SMS</label>\n        <div class="controls">\n            <textarea name="phones" class="input-block-level"><% print(phones.join("\\r\\n")) %></textarea>\n        </div>\n    </div>\n    <% } %>\n\n</div>\n<p class="help-block">\n    <%= i18n.notificationAddressesHelp %>\n    <% if(App.isSmsAllowed()) { print(i18n.notificationPhonesHelp) } %>\n</p>\n\n<!--<h4><%= i18n.alerts.ucFirst() %></h4>-->\n<label><%= i18n.alerts.ucFirst() %></label>\n<div class="row-fluid row-alerts">\n    <div class="alert-groups control-group span6">\n        <select name="alertGroups"\n                data-placeholder="<%= i18n.allAlertsGroups %>"\n                class="input-block-level"\n                multiple>\n        </select>\n    </div><div class="alerts control-group span6">\n        <select name="alerts"\n                data-placeholder="<%= i18n.allAlertsOffSelectedGroups %>"\n                class="input-block-level"\n                multiple>\n        </select>\n    </div>\n</div>\n\n<% if(objType == App.TYPE_STAT) {%>\n\n<!--<h4>TODO areas and zones</h4>-->\n<div class="row-fluid">\n    <div class="areas-list control-group span6">\n        <select name="areas" class="input-block-level" data-placeholder="<%= i18n.allObjAreas %>" multiple>\n            <option value="0"><%= i18n.zeroAreaName %></option>\n            <% _.each(areas, function(a) {%>\n            <option value="<%= a.num %>"<%= _.indexOf(areaNums, a.num) != -1 ? \' selected\' : \'\' %>>\n                <%= a.name || i18n.objArea + \' \' + a.num %>\n            </option>\n            <% }) %>\n        </select>\n    </div>\n    <div class="zones-list control-group span6">\n        <select name="zones"\n                class="input-block-level"\n                data-placeholder="<%= i18n.allZonesOfSelectedAreas %>"\n                multiple>\n        </select>\n    </div>\n</div>\n\n<% } %>\n\n'}),define("text!abstracts/itemcard/tmpl/notificationRow.html",[],function(){return'<tr data-id="<%= id %>">\n    <!--<td class="col-num">\n        <%- id %>\n    </td>-->\n    <td class="col-name">\n        <%- name %>\n    </td>\n    <td class="col-state<%= isActive ? \'\' : \' off\' %>">\n        <%= isActiveS %>\n    </td>\n    <td>\n        <%- _.pluck(addresses, \'address\').join(\', \') %>\n    </td>\n    <td class="col-icon">\n        <i class="svg-icon svg-icon-cog row-edit" data-id="<%= id %>"></i>\n    </td><td class="col-icon">\n        <i class="svg-icon svg-icon-remove row-remove" data-id="<%= id %>"></i>\n    </td>\n</tr>'}),define("abstracts/itemcard/views/NotificationsView",["jquery","jqueryui","jface","underscore","abstracts/View","../NotificationsCollection","../Notification","text!../tmpl/notificationsEditable.html","text!../tmpl/notificationForm.html","text!../tmpl/notificationRow.html"],function(t,e,i,n,s,o,a,r,l,c){r=n.template(r),l=n.template(l),c=n.template(c);var h=100,d=100,u=s.extend({constructor:function(){this.controller=null,this.parent=null,this.collection=new o,this._isStationary=!1,this._notification=null,this._popup=null,this._selects={alertGroups:null,alerts:null,areas:null,zones:null},this._alertGroups=null,this._alerts=null,this._xhr=null,s.apply(this,arguments)},initialize:function(t){this.controller=t.controller,this.parent=t.parent,this.collection.url=App.getBaseUrl()+"notifications/by-object-id/",p.bindEvents.call(this);var e=this;this.collection.fetch({data:{id:this.model.id}}).done(function(){e.render()})},render:function(){this.$el.html(r({i18n:this.controller.getTexts(),items:this.collection.toJSON(),tmplRow:c}))},remove:function(){this.stopListening(),this._popup.trigger("jw.close"),this._popup=null}}),p={bindEvents:function(){var e=this;this.listenTo(this.collection,"request",function(){e.$el.addClass("loading")}).listenTo(this.collection,"sync",function(){e.$el.removeClass("loading")}).listenTo(this.collection,"add",function(t){p.addRow.call(e,t)}).listenTo(this.collection,"remove",function(t){var i=e.$el.find("table"),n=i.find("tr[data-id="+t.id+"]");n.remove(),e.collection.length||i.addClass("hidden").siblings(".no-data").removeClass("hidden")}),this.parent.on("addrow",function(t){"notification"==t&&p.edit.call(e,0)}),this.$el.on("click",".row-edit",function(){p.edit.call(e,t(this).data("id"))}).off("click",".row-remove").on("click",".row-remove",function(){return p.openDeleteConfirm.call(e,t(this).data("id")),!1})},edit:function(e){if(!this._notification||this._notification.id!==e){var s=this.controller.getTexts();if(!e&&this.collection.length>=d)return alert(s.notificationLimitReached,s.attention);var o=this,r=null,c=Number(this.model.get("settings").ObjType),h=e?this.collection.get(e):new a({name:s.notification+" "+(this.collection.length+1)}),u=n.extend({},h.attributes,{objType:c,emails:h.getEmails(),phones:h.getPhones(),i18n:s}),m=this.$el.offset();this._isStationary=c==App.TYPE_STAT,t("#win-notification").trigger("jw.close"),this._notification=h,e?(r=n.findWhere(h.get("devices"),{objectId:this.model.id}),this._isStationary&&(u.areaNums=p.getAreaNums.call(this))):(r={id:this.model.id},this._isStationary&&(u.areaNums=[])),u.device=r,this._isStationary&&(u.areas=this.model.get("areas")),i.window.open({winId:"win-notification",addForm:'<form method="post" action=""></form>',addClass:"loading",headerHtml:e?n.escape(h.get("name")):s.newNotification,contentHtml:l(u),footerHtml:'<button type="submit" class="btn btn-primary">'+s.save+"</button>"+'<a href="javascript:;" class="btn jw-close">'+s.cancel.ucFirst()+"</a>",dieAfter:0,initX:Math.max(m.left-20,10),initY:50,width:600,resizable:!1,openCallback:function(){o._popup=this},showCallback:function(){var t=this;p.initForm.call(o,t.find("form")).always(function(){t.removeClass("loading"),p.initMultiSelects.call(o),t.find("textarea").each(function(){this.style.height=this.scrollHeight+2+"px"}),t.find("input[type=text]").first().focus()})},closeCallback:function(){o._notification=null,n.each(o._selects,function(t,e){o._selects[e]=null}),o._xhr&&(o._xhr.abort(),o._xhr=null)}})}},initForm:function(e){var i=this,n=new t.Deferred,s=e.find("textarea");return e.find("input[type=text]").first().focus(),e.on("submit",function(){return p.onSubmit.call(i,e),!1}),t.autoResize(s),this._alertGroups&&this._alerts?n.resolve():(this.controller.loadAlertTemplatesAndGroups().done(function(t,e){i._alertGroups=t,i._alerts=e,n.resolve()}).fail(function(){n.reject()}),n)},initMultiSelects:function(){var t=this,e=this.controller.getTexts();n.each(this._selects,function(e,i){t._selects[i]=t._popup.find("select[name="+i+"]")}),p.buildAlertGroups.call(this),p.buildAlerts.call(this,this._alerts,n.pluck(this._notification.get("alerts"),"alertTemplateId")),this._isStationary&&p.buildZones.call(this,p.filterZones.call(t,p.getAreaNums.call(this)),p.getZoneIds.call(this)),this._popup.find("select").chosen({disable_search:!1,disable_search_threshold:10,no_results_text:e.searchNoResults});var i=this._selects.alertGroups,s=this._selects.alerts;if(i.on("change",function(){var e=p.getSelectValues(i);p.buildAlerts.call(t,p.filterAlerts.call(t,e)),s.trigger("chosen:updated")}),this._isStationary){var o=this._selects.areas,a=this._selects.zones;o.on("change",function(){var e=p.getSelectValues(o);p.buildZones.call(t,p.filterZones.call(t,e)),a.trigger("chosen:updated")})}},buildAlertGroups:function(){var t=this._popup.find("select[name=alertGroups]"),e="",i=n.pluck(this._notification.get("alertGroups"),"alertGroupId");n.each(this._alertGroups,function(t){e+='<option value="'+t.id+'"'+(-1!=n.indexOf(i,t.id)?" selected":"")+">"+t.name+"</option>"}),t.html(e)},buildAlerts:function(t,e){var i=this._selects.alerts,s="",e=e||p.getSelectValues(i);n.each(t,function(t){s+='<option value="'+t.id+'"'+(-1!=n.indexOf(e,t.id)?" selected":"")+">"+p.formatCode(t.code)+" "+t.message+"</option>"}),i.html(s)},getAreaNums:function(){if(!this._isStationary||!this._notification.id)return[];var t=n.indexBy(this.model.get("areas"),"num"),e=null,i=[],s=n.findWhere(this._notification.get("devices"),{objectId:this.model.id});return n.each(s.areas,function(n){e=t[n.num],e&&i.push(e.num)}),i},getZoneIds:function(){if(!this._isStationary||!this._notification.id)return[];var t=n.indexBy(this.model.get("areas"),"num"),e=this.model.get("zones"),i=null,s=null,o=[],a=n.findWhere(this._notification.get("devices"),{objectId:this.model.id});return n.each(a.areas,function(a){i=t[a.num],i&&n.each(a.zones,function(t){s=n.find(e,function(e){return e.areaId==i.id&&e.num==t.num}),s&&o.push(s.id)})}),o},buildZones:function(t,e){var i,s=this._selects.zones,o=this.controller.getTexts(),a="",e=e||p.getSelectValues(s),r="",l=n.indexBy(this.model.get("areas"),"id");n.each(t,function(t){r=t.name?n.escape(t.name):o.objZone+" "+t.num,i=l[t.areaId],r+=" ("+(i.name?n.escape(i.name):o.objArea+" "+i.num)+")",a+='<option value="'+t.id+'"'+(-1!=n.indexOf(e,t.id)?" selected":"")+">"+r+"</option>"}),s.html(a)},getSelectValues:function(t){var e=t.val()||[];return n.map(e,function(t){return Number(t)})},filterAlerts:function(t){if(!t.length)return this._alerts;var e=n.filter(this._alerts,function(e){return-1!=n.indexOf(t,e.groupId)});return e},filterZones:function(t){var e=this.model.get("zones");if(!t.length)return[];var i=n.indexBy(this.model.get("areas"),"id");return n.filter(e,function(e){return-1!=n.indexOf(t,i[e.areaId].num)})},onSubmit:function(t){var e,i=this,n=p.serializeForm.call(this,t),s=this._notification.id;return(e=p.validate.call(this,n))?(p.showErrors.call(this,e),void 0):(this._popup.addClass("loading"),p[s?"update":"create"].call(this,n).done(function(t){i._notification.set("id",t.id),s?i.$el.find("tr[data-id="+s+"]").replaceWith(p.renderRow.call(i,i._notification)):i.collection.add(i._notification),i._popup.trigger("jw.close")}).fail(function(){p.showErrors.call(i,arguments[0])}).always(function(){i._popup.removeClass("loading")}),void 0)},serializeForm:function(e){var i=this,s={},o={objectId:this.model.id};s.name=t.trim(e.find("input[name=name]").val()),s.isActive=e.find("input[name=isActive]").is(":checked"),s.addresses=[],s.alertGroups=[],s.alerts=[],n.each(["emails","phones"],function(o){var a=e.find("[name="+o+"]"),r=i._notification.getAddressCode(o);if(a.length&&r){var l=a.val().split(/[\,,;,\n]/);l=n.filter(l,function(e){return t.trim(e).length}),"phones"==o&&(l=n.map(l,function(t){return t.replace(/[+,\-,\(,\)]/gi,"")})),l=n.map(l,function(e){return t.trim(e)});for(var c=0,h=l.length;h>c;++c)s.addresses.push({address:l[c],addressType:r})}});for(var a=p.getSelectValues(i._selects.alertGroups),r=0,l=a.length;l>r;++r)s.alertGroups.push({alertGroupId:a[r]});a=p.getSelectValues(i._selects.alerts);for(var r=0,l=a.length;l>r;++r)s.alerts.push({alertTemplateId:a[r]});var c,h,d=p.getSelectValues(this._selects.areas),u=n.indexBy(this.model.get("areas"),"id"),m=p.getSelectValues(this._selects.zones),f=n.filter(this.model.get("zones"),function(t){return-1!=n.indexOf(m,t.id)});if(f=n.groupBy(f,function(t){return u[t.areaId].num}),o.areas=[],d.length)for(var r=0,l=d.length;l>r;++r){if(c={num:d[r],zones:[]},d[r]in f){h=n.pluck(f[d[r]],"num");for(var g=0,v=h.length;v>g;++g)c.zones.push({num:h[g]})}o.areas.push(c)}return s.devices=[o],s},validate:function(t){var e=[],i=this.controller.getTexts();if(t.name||e.push({key:"name",msg:i.errNotificationName}),t.addresses.length)if(t.addresses.length>h)e.push({key:["emails","phones"],msg:i.errNotificationMaxAddresses.replace("#max#",h)});else{var s=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,o=this._notification.getAddressCode("emails"),a=p.validateAddresses(n.filter(t.addresses,function(t){return t.addressType==o}),s);s=/^\d{9,15}$/i,o=this._notification.getAddressCode("phones");var r=p.validateAddresses(n.filter(t.addresses,function(t){return t.addressType==o}),s);if(a.length||r.length){var l=[];a.length&&l.push("emails"),r.length&&l.push("phones"),e.push({key:l,msg:i.errNotificationAddressesIncorrect})}}else e.push({key:["emails","phones"],msg:i.errNotificationAddresses});return e.length?e:null},validateAddresses:function(t,e){for(var i=[],n=0,s=t.length;s>n;++n)e.test(t[n].address)||i.push(t[n]);return i},update:function(e){var i=this,n=this._notification.id,s=new t.Deferred;return p.remove.call(this,n).done(function(){i._notification.set("id",0),p.create.call(i,e).done(function(t){s.resolve(t)}).fail(function(){s.reject(arguments[0])})}).fail(function(){s.reject(arguments[0])}),s},create:function(e){this._notification.set(e);var i=App.getBaseUrl()+"notifications/create/",n=this._notification.serialize();return this._xhr=t.ajax({url:i,data:n}),this._xhr},addRow:function(t){var e=p.renderRow.call(this,t);1==this.collection.length&&(this.$el.find("table").removeClass("hidden"),this.$el.find(".no-data").addClass("hidden")),this.$el.find("tbody").append(e)},renderRow:function(t){var e=this.controller.getTexts(),i=t.attributes;return c(n.extend({isActiveS:i.isActive?e.notificationSwitchedOn:e.notificationSwitchedOff},i))},remove:function(e){return t.ajax({url:App.getBaseUrl()+"notifications/delete/",data:{id:e}})},openDeleteConfirm:function(t){var e=this,s=this.collection.get(t),o=this.controller.getTexts().notificationDeleteConfirm;s&&i.confirm(o.msg.replace("#name#","<strong>"+n.escape(s.get("name"))+"</strong>"),o.hdr,{okCallback:function(){e.$el.addClass("loading"),p.remove.call(e,t).done(function(){e.collection.remove(t)}).fail(function(t){p.showErrors.call(e,t)}).always(function(){e.$el.removeClass("loading")})}})},showErrors:function(e){var i=this.controller.getTexts(),s=[];if(n.isArray(arguments[0])){var o=this._popup;n.each(e,function(t){n.isArray(t.key)||(t.key=[t.key]),n.each(t.key,function(t){o.find('[name="'+t+'"]').closest(".control-group").addClass("error")}),s.push(t.msg)});var a=o.find(".error").first()}else if("string"==typeof arguments[0])s.push(arguments[0]);else if(arguments[0].responseText)try{var r=t.parseJSON(arguments[0].responseText);s.push(r.msg)}catch(l){s.push(i.errors.callServerFailed)}s.length&&alert(s.join("<br />"),i.error,{closeCallback:function(){a&&a.find("input, select, textarea").focus()}})},formatCode:function(t){var e=String(t);return 4==e.length&&(e=e.substr(0,3)+"."+e.substr(3)),e}};return u}),define("text!abstracts/itemcard/tmpl/alertControl.html",[],function(){return'<% var keyIndex = 0; %>\n<div class="control-group">\n    <h5 class="control-group-header">\n        <%= i18n.alertControlConnection %>\n        <a class="advanced-settings" href="#" data-key="<%= keys[keyIndex] %>"><%= i18n.alertControlExtraSettings %></a>\n    </h5>\n    <table class="l table-fields">\n        <tr class="field">\n            <td class="field-label">\n                <%= i18n.alertControlConnectionTip %>\n            </td>\n            <td class="field-controls">\n                <div class="itext">\n                    <input type="text"\n                           class="timeout" name="<%= keys[keyIndex] %>"\n                           value="<%= timeouts[keyIndex] > 0 ? timeoutStrings[keyIndex] : \'\' %>"\n                           placeholder="<%= i18n.no.ucFirst() %>" maxlength="5" autocomplete="off">\n                </div>\n            </td>\n        </tr>\n    </table>\n</div>\n\n<% if(isStationary) {%>\n<% keyIndex++; %>\n<div class="control-group">\n    <h5 class="control-group-header">\n        <%= i18n.alertControlAutotest %>\n        <a class="advanced-settings" href="#" data-key="<%= keys[keyIndex] %>"><%= i18n.alertControlExtraSettings %></a>\n    </h5>\n    <table class="l table-fields">\n        <tr class="field">\n            <td class="field-label">\n                <%= i18n.alertControlAutotestTip %>\n            </td>\n            <td class="field-controls">\n                <div class="itext">\n                    <input type="text"\n                           class="timeout" name="<%= keys[keyIndex] %>"\n                           value="<%= timeouts[keyIndex] > 0 ? timeoutStrings[keyIndex] : \'\' %>"\n                           placeholder="<%= i18n.no.ucFirst() %>" maxlength="5" autocomplete="off">\n                </div>\n            </td>\n        </tr>\n    </table>\n</div>\n\n<% keyIndex++; %>\n<div class="control-group">\n    <h5 class="control-group-header">\n        <%= i18n.alertControlActivity %>\n        <a class="advanced-settings" href="#" data-key="<%= keys[keyIndex] %>"><%= i18n.alertControlExtraSettings %></a>\n    </h5>\n    <table class="l table-fields">\n        <tr class="field">\n            <td class="field-label">\n                <%= i18n.alertControlActivityTip %>\n            </td>\n            <td class="field-controls">\n                <div class="itext">\n                    <input type="text"\n                           class="timeout" name="<%= keys[keyIndex] %>"\n                           value="<%= timeouts[keyIndex] > 0 ? timeoutStrings[keyIndex] : \'\' %>"\n                           placeholder="<%= i18n.no.ucFirst() %>" maxlength="5" autocomplete="off">\n                </div>\n            </td>\n        </tr>\n    </table>\n</div>\n\n<% keyIndex++; %>\n<div class="control-group">\n    <h5 class="control-group-header">\n        <%= i18n.alertControlVoltage %>\n    </h5>\n    <table class="l table-fields">\n        <tr class="field">\n            <td class="field-label">\n                <%= i18n.alertControlVoltageTip %>\n            </td>\n            <td class="field-controls">\n                <div class="itext">\n                    <input type="text"\n                           class="timeout" name="<%= keys[keyIndex] %>"\n                           value="<%= timeouts[keyIndex] > 0 ? timeoutStrings[keyIndex] : \'\' %>"\n                           placeholder="<%= i18n.no.ucFirst() %>" maxlength="5" autocomplete="off">\n                </div>\n            </td>\n        </tr>\n    </table>\n</div>\n\n<% keyIndex++; %>\n<div class="control-group">\n    <h5 class="control-group-header">\n        <%= i18n.alertControlEnterDelay %>\n        <a class="advanced-settings" href="#" data-key="<%= keys[keyIndex] %>"><%= i18n.alertControlExtraSettings %></a>\n    </h5>\n    <table class="l table-fields">\n        <tr class="field">\n            <td class="field-label">\n                <%= i18n.alertControlEnterDelayTip %>\n            </td>\n            <td class="field-controls">\n                <div class="itext">\n                    <input type="text"\n                           class="timeout-sec" name="<%= keys[keyIndex] %>"\n                           value="<%= timeouts[keyIndex] > 0 ? timeoutStrings[keyIndex] : \'\' %>"\n                           placeholder="<%= i18n.no.ucFirst() %>" maxlength="3" autocomplete="off">\n                </div>\n            </td>\n        </tr>\n        <tr class="field">\n            <td class="field-label">\n                <%= i18n.alertControlEnterDelayZonesLabel %>\n            </td>\n            <td class="field-controls">\n                <div class="chosen-wrapper">\n                    <select data-name="controlledZones"\n                            data-placeholder="<%= i18n.chooseObjZones %>"\n                            class="input-block-level"\n                            multiple>\n                    </select>\n                </div>\n            </td>\n        </tr>\n    </table>\n</div>\n\n<% keyIndex++; %>\n<div class="control-group">\n    <h5 class="control-group-header">\n        <%= i18n.alertControlPanicButton %>\n        <a class="advanced-settings" href="#" data-key="<%= keys[keyIndex] %>"><%= i18n.alertControlExtraSettings %></a>\n    </h5>\n    <table class="l table-fields">\n        <tr class="field">\n            <td class="field-label">\n                <%= i18n.alertControlPanicButtonTip %>\n            </td>\n            <td class="field-controls">\n                <div class="itext">\n                    <input type="text"\n                           class="timeout-sec" name="<%= keys[keyIndex] %>"\n                           value="<%= timeouts[keyIndex] > 0 ? timeoutStrings[keyIndex] : \'\' %>"\n                           placeholder="<%= i18n.no.ucFirst() %>" maxlength="3" autocomplete="off">\n                </div>\n            </td>\n        </tr>\n    </table>\n</div>\n\n<% if(showChannelsControl) {%>\n<% keyIndex++; %>\n<div class="control-group">\n    <h5 class="control-group-header">\n        <%= i18n.streamChannelsControl %>\n        <a class="advanced-settings" href="#" data-key="<%= keys[keyIndex] %>"><%= i18n.alertControlExtraSettings %></a>\n    </h5>\n    <table class="l table-fields">\n        <tr class="field">\n            <td class="field-label">\n                <%= i18n.alertControlChannelsTip %>\n            </td>\n            <td class="field-controls">\n                <div class="itext">\n                    <input type="text"\n                           class="timeout" name="<%= keys[keyIndex] %>"\n                           value="<%= timeouts[keyIndex] > 0 ? timeoutStrings[keyIndex] : \'\' %>"\n                           placeholder="<%= i18n.no.ucFirst() %>" maxlength="5" autocomplete="off">\n                </div>\n            </td>\n        </tr>\n    </table>\n</div>\n<% } %>\n<% } %>\n\n<% if(showAlertsListControl) {%>\n<% keyIndex++; %>\n<div class="control-group">\n    <h5 class="control-group-header">\n        <%= i18n.alertsListControl %>\n        <a class="advanced-settings" href="#" data-key="<%= keys[keyIndex] %>"><%= i18n.alertControlExtraSettings %></a>\n    </h5>\n    <table class="l table-fields">\n        <tr class="field">\n            <td class="field-label">\n                <%= i18n.alertsListControlTip %>\n            </td>\n            <td class="field-controls">\n                <div class="itext">\n                    <input type="text"\n                           class="timeout" name="<%= keys[keyIndex] %>"\n                           value="<%= timeouts[keyIndex] > 0 ? timeoutStrings[keyIndex] : \'\' %>"\n                           placeholder="<%= i18n.no.ucFirst() %>" maxlength="5" autocomplete="off">\n                </div>\n            </td>\n        </tr>\n    </table>\n</div>\n<% } %>\n\n<% if(!isStationary) {%>\n<% keyIndex++; %>\n<div class="control-group">\n    <h5 class="control-group-header">\n        <%= i18n.alertControlMovement %>\n        <a class="advanced-settings" href="#" data-key="<%= keys[keyIndex] %>"><%= i18n.alertControlExtraSettings %></a>\n    </h5>\n    <table class="l table-fields">\n        <tr class="field">\n            <td class="field-label">\n                <%= i18n.alertControlMovementTip %>\n            </td>\n            <td class="field-controls">\n                <div class="itext">\n                    <input type="text"\n                           class="timeout" name="<%= keys[keyIndex] %>"\n                           value="<%= timeouts[keyIndex] > 0 ? timeoutStrings[keyIndex] : \'\' %>"\n                           placeholder="<%= i18n.no.ucFirst() %>" maxlength="5" autocomplete="off">\n                </div>\n            </td>\n        </tr>\n    </table>\n</div>\n\n<% keyIndex++; %>\n<div class="control-group">\n    <h5 class="control-group-header">\n        <%= i18n.alertControlLostCoord %>\n        <a class="advanced-settings" href="#" data-key="<%= keys[keyIndex] %>"><%= i18n.alertControlExtraSettings %></a>\n    </h5>\n    <table class="l table-fields">\n        <tr class="field">\n            <td class="field-label">\n                <%= i18n.alertControlLostCoordTip %>\n            </td>\n            <td class="field-controls">\n                <div class="itext">\n                    <input type="text"\n                           class="timeout" name="<%= keys[keyIndex] %>"\n                           value="<%= timeouts[keyIndex] > 0 ? timeoutStrings[keyIndex] : \'\' %>"\n                           placeholder="<%= i18n.no.ucFirst() %>" maxlength="5" autocomplete="off">\n                </div>\n            </td>\n        </tr>\n    </table>\n</div>\n<% } %>'}),define("text!abstracts/itemcard/tmpl/alertControlActivitySettings.html",[],function(){return'<div class="alert-groups control-group control-group-above">\n    <label class="control-label"><%= i18n.alertsGroups %></label>\n    <select name="<%= names[0] %>"\n            data-placeholder="<%= i18n.allAlertsGroups %>"\n            class="input-block-level"\n            multiple>\n    </select>\n</div>\n\n<div class="alerts control-group">\n    <label class="control-label"><%= i18n.alerts.ucFirst() %></label>\n    <select name="<%= names[1] %>"\n            data-placeholder="<%= i18n.allAlertsOffSelectedGroups %>"\n            class="input-block-level"\n            multiple>\n    </select>\n</div>\n'}),define("text!abstracts/itemcard/tmpl/alertControlExpectedAndReceived.html",[],function(){return'<div class="alerts control-group control-group-above">\n    <label class="control-label"><%= i18n.alertControlReceivedAlerts %></label>\n    <select name="<%= names[0] %>"\n            data-placeholder="<%= i18n.chooseAlerts %>"\n            class="input-block-level"\n            multiple>\n    </select>\n</div>\n\n<div class="alerts control-group">\n    <label class="control-label"><%= i18n.alertControlExpectedAlerts %></label>\n    <select name="<%= names[1] %>"\n            data-placeholder="<%= i18n.chooseAlerts %>"\n            class="input-block-level"\n            multiple>\n    </select>\n</div>\n'}),define("text!abstracts/itemcard/tmpl/alertControlMovement.html",[],function(){return'<div class="channels control-group">\n    <label class="control-label"><%= i18n.alertControlMovementIgnore %></label>\n    <select name="<%= names[0] %>"\n            data-placeholder="<%= i18n.chooseObjZones %>"\n            class="input-block-level"\n            multiple>\n    </select>\n</div>'}),define("text!abstracts/itemcard/tmpl/alertControlLostCoords.html",[],function(){return'<div class="channels control-group">\n    <label class="control-label"><%= i18n.alertControlLostCoordIgnore %></label>\n    <select name="<%= names[0] %>"\n            data-placeholder="<%= i18n.chooseObjZones %>"\n            class="input-block-level"\n            multiple>\n    </select>\n</div>'}),define("text!abstracts/itemcard/tmpl/alertControlAutotests.html",[],function(){return'<div class="control-group no-margin">\n    <label class="checkbox">\n        <input type="checkbox" name="<%= names[0] %>" />\n        <%= i18n.alertControlSaveAutotestsLabel %>\n    </label>\n</div>'}),define("text!abstracts/itemcard/tmpl/alertControlChannels.html",[],function(){return'<div class="alerts control-group control-group-above">\n    <label class="control-label"><%= i18n.alertControlControlledAlerts %></label>\n    <select name="<%= names[0] %>"\n            data-placeholder="<%= i18n.chooseAlerts %>"\n            class="input-block-level"\n            multiple>\n    </select>\n</div>\n\n<div class="channels control-group">\n    <label class="control-label"><%= i18n.streamChannels %></label>\n    <select name="<%= names[1] %>"\n            data-placeholder="<%= i18n.selectStreamChannels %>"\n            class="input-block-level"\n            multiple>\n    </select>\n</div>'}),define("text!abstracts/itemcard/tmpl/alertControlAlertsList.html",[],function(){return'<div class="control-group" data-name="<%= names[0] %>" style="z-index: 5">\n    <label class="control-label"><%= i18n.alertsListReceivedAlert %></label>\n    <div class="control-row">\n        <select name="alert"\n                data-placeholder="<%= i18n.chooseAlert %>"\n                class="input-block-level">\n        </select>\n        <select name="channels"\n                data-placeholder="<%= i18n.anyInputStream %>"\n                class="input-block-level"\n                multiple>\n        </select>\n    </div>\n</div>\n\n<div class="control-group" data-name="<%= names[1] %>" style="z-index: 4">\n    <label class="control-label"><%= i18n.alertsListExpectedAlerts %></label>\n    <div class="control-rows"></div>\n</div>\n\n<div class="control-group" data-name="<%= names[2] %>" style="z-index: 3">\n    <label class="control-label"><%= i18n.createAlert %></label>\n    <select name="alert"\n            data-placeholder="<%= i18n.chooseAlert %>"\n            class="input-block-level">\n    </select>\n</div>\n\n<div class="control-group" data-name="<%= names[3] %>">\n    <div class="control-label"><%= i18n.alertsListCondition %></div>\n    <label class="radio">\n        <input name="<%= names[3] %>" type="radio" value="false"/>\n        <%= i18n.alertsListConditionFalse %>\n    </label>\n    <label class="radio">\n        <input name="<%= names[3] %>" type="radio" value="true"/>\n        <%= i18n.alertsListConditionTrue %>\n    </label>\n</div>'
}),define("text!abstracts/itemcard/tmpl/alertControlAlertsListRow.html",[],function(){return'<div class="control-row" style="z-index: <%=(100 - index)%>">\n    <select name="alert"\n            data-index="<%= index %>"\n            data-placeholder="<%= i18n.chooseAlert %>"\n            class="input-block-level">\n    </select>\n    <select name="channels"\n            data-index="<%= index %>"\n            data-placeholder="<%= i18n.anyInputStream %>"\n            class="input-block-level"\n            multiple>\n    </select>\n</div>\n\n'}),define("abstracts/itemcard/views/ItemCardAlertControlView",["jquery","underscore","jface","abstracts/View","text!../tmpl/alertControl.html","text!../tmpl/alertControlActivitySettings.html","text!../tmpl/alertControlExpectedAndReceived.html","text!../tmpl/alertControlMovement.html","text!../tmpl/alertControlLostCoords.html","text!../tmpl/alertControlAutotests.html","text!../tmpl/alertControlChannels.html","text!../tmpl/alertControlAlertsList.html","text!../tmpl/alertControlAlertsListRow.html"],function(t,e,i,n,s,o,a,r,l,c,h,d,u){var p=e.template('<a href="#" class="set-defaults"><%= btns[0] %></a><a class="btn btn-primary jw-close" href="#"><%= btns[1] %></a>');s=e.template(s),o=e.template(o),a=e.template(a),r=e.template(r),l=e.template(l),c=e.template(c),h=e.template(h),d=e.template(d),u=e.template(u);var m=n.prototype,f=n.extend({constructor:function(){this.controller=null,this.parent=null,this._alertGroups=null,this._alerts=null,this._defaults=null,this._data=null,this._extraParameters={},this._geozones=App.get("geozones"),this._activeExtraParametersKey="",this._popup=null,n.apply(this,arguments)},KEY_ACTIVITY_CONTROL:"activityControl",KEY_CONNECTION_CONTROL:"connectionControl",KEY_AUTO_TEST_CONTROL:"autoTestControl",KEY_VOLTAGE_CONTROL:"repair220Control",KEY_ENTER_DELAY_CONTROL:"enteringDelayControl",KEY_PANIC_BUTTON_CONTROL:"panicButtonControl",KEY_CHANNELS_CONTROL:"channelControl",KEY_ALERTS_LIST_CONTROL:"alertsListControl",KEY_MOVEMENT_CONTROL:"movementControl",KEY_LOST_COORDS_CONTROL:"lostCoordsControl",PARAM_TIMEOUT:"timeout",PARAM_ACTIVITY_GROUPS:"groups",PARAM_ACTIVITY_ALERTS:"alerts",PARAM_RECEIVED_ALERTS:"receivedAlerts",PARAM_EXPECTED_ALERTS:"expectedAlerts",PARAM_ENTER_DELAY_ZONES:"controlledZones",PARAM_GEO_ZONES:"geoZones",PARAM_SAVE_AUTOTEST:"saveAutoTest",PARAM_CHANNELS_ALERTS:"alerts",PARAM_CHANNELS_CHANNELS:"channels",PARAM_ALERTS_LIST_INITIAL_ALERT:"initialAlert",PARAM_ALERTS_LIST_EXPECTED_ALERTS:"expectedAlerts",PARAM_ALERTS_LIST_ACCEPT_EXPECTED:"acceptExpected",PARAM_ALERTS_LIST_GENERATED_ALERT:"generatedAlert",initialize:function(t){var e=this;this.controller=t.controller,this.parent=t.parent,this.$el.addClass("loading");var i={};i[this.PARAM_SAVE_AUTOTEST]=null,this._extraParameters[this.KEY_AUTO_TEST_CONTROL]=i,i={},i[this.PARAM_ENTER_DELAY_ZONES]=null,i[this.PARAM_RECEIVED_ALERTS]=null,i[this.PARAM_EXPECTED_ALERTS]=null,this._extraParameters[this.KEY_ENTER_DELAY_CONTROL]=i,i={},i[this.PARAM_ACTIVITY_ALERTS]=null,i[this.PARAM_ACTIVITY_GROUPS]=null,this._extraParameters[this.KEY_ACTIVITY_CONTROL]=i,i={},i[this.PARAM_CHANNELS_ALERTS]=null,i[this.PARAM_CHANNELS_CHANNELS]=null,this._extraParameters[this.KEY_CHANNELS_CONTROL]=i,i={},i[this.PARAM_GEO_ZONES]=null,this._extraParameters[this.KEY_MOVEMENT_CONTROL]=i,i={},i[this.PARAM_GEO_ZONES]=null,this._extraParameters[this.KEY_LOST_COORDS_CONTROL]=i,i={},["INITIAL_ALERT","EXPECTED_ALERTS","ACCEPT_EXPECTED","GENERATED_ALERT"].forEach(function(t){i[e["PARAM_ALERTS_LIST_"+t]]=null}),this._extraParameters[this.KEY_ALERTS_LIST_CONTROL]=i,[this.KEY_PANIC_BUTTON_CONTROL,this.KEY_CONNECTION_CONTROL].forEach(function(t){var e={};e[this.PARAM_RECEIVED_ALERTS]=null,e[this.PARAM_EXPECTED_ALERTS]=null,this._extraParameters[t]=e}.bind(this)),g.load.call(e).done(function(){e.render(),g.bindEvents.call(e)}).fail(function(t){e.showErrors(t)}).always(function(){e.$el.removeClass("loading")})},render:function(){var i=this,n=this.getKeys(),o=this._data,a=[],r=[],l=this.model.get("objType")==App.TYPE_STAT;if(e.each(n,function(t){var e=t in o&&null!==o[t]?o[t][this.PARAM_TIMEOUT]:0;a.push(e),r.push(g.formatTimeout.call(this,t,e))}.bind(this)),this.$el.html(s({i18n:this.controller.getTexts(),keys:n,timeouts:a,timeoutStrings:r,data:this._data,isStationary:l,showChannelsControl:n.indexOf(this.KEY_CHANNELS_CONTROL)>-1,showAlertsListControl:n.indexOf(this.KEY_ALERTS_LIST_CONTROL)>-1})),l){var c=g.renderZones.call(this);g.initZonesMultiselect.call(this,c)}t.mask.definitions.h="[0-9]",t.mask.definitions.M="[0-5]",t.mask.definitions.m="[0-9]",this.$el.find(".timeout").mask("hh:Mm",{blur:function(){var e=t(this),n=e.val();n.indexOf("_")>-1&&e.val(n.replace(/_/g,"0"));var s=g.processTimeoutString.call(i,this.name,n);(isNaN(s)||0>=s)&&e.val("")}}),this.$el.find(".timeout-sec").numeric({decimal:!1,negative:!1}).on("blur",function(){var t=parseInt(this.value);(isNaN(t)||0>=t)&&(this.value="")})},closePopup:function(){this._popup&&this._popup.trigger("jw.close")},remove:function(){this.closePopup(),m.remove.apply(this,arguments)},getKeys:function(){var t=g.getChannels.call(this),e=[this.KEY_CONNECTION_CONTROL],i=this.model.get("objType")===App.TYPE_STAT;return i&&(e=e.concat([this.KEY_AUTO_TEST_CONTROL,this.KEY_ACTIVITY_CONTROL,this.KEY_VOLTAGE_CONTROL,this.KEY_ENTER_DELAY_CONTROL,this.KEY_PANIC_BUTTON_CONTROL]),t.length>1&&(e=e.concat([this.KEY_CHANNELS_CONTROL]))),t.length>0&&(e=e.concat([this.KEY_ALERTS_LIST_CONTROL])),i||(e=e.concat([this.KEY_MOVEMENT_CONTROL,this.KEY_LOST_COORDS_CONTROL])),e},getCopySettingsFormLabel:function(){return this.controller.getTexts().alertControlCopyFormLabel},getCopySettingsObjectsType:function(){return this.model.get("objType")},getSettingsToCopy:function(){return[this.model.ALERT_CONTROL_KEY]},mergeSettingsBeingCopied:function(){return!1},onCopySettingsFormSubmit:function(t,e){var n=this.controller.getTexts();i.confirm(n.alertControlCopyConfirm,n.copy+"?",{okCallback:e})},onCopySettingsCancelled:function(){this.parent._removeCopySettingsView()},onCopySettingsDone:function(){this.parent._removeCopySettingsView()},onCopySettingsFail:function(t){this.showErrors(t)},addSerializedData:function(i){var n,s=this,o=this.getKeys(),a=this.model.ALERT_CONTROL_KEY,r=!1,l={};return e.each(o,function(e){if(i[e]&&(n=g.processTimeoutString.call(s,e,i[e]),n>0)){var o=g.getExtraParameters.call(s,e);null!==o&&Object.keys(o).length?(l[e]=t.extend({timeout:n},o),r=!0):e===s.KEY_VOLTAGE_CONTROL||e===s.KEY_ACTIVITY_CONTROL?(l[e]={timeout:n},r=!0):(e===s.KEY_MOVEMENT_CONTROL||e===s.KEY_LOST_COORDS_CONTROL)&&(l[e]={timeout:n},r=!0)}delete i[e]}),r?i[a]=JSON.stringify(l):this._data&&(i[a]=""),i}}),g={load:function(){var e=this,i=new t.Deferred,n=this.model.get("settings"),s=this.model.ALERT_CONTROL_KEY;return t.when(this.controller.loadAlertTemplatesAndGroups(),t.ajax({url:App.getBaseUrl()+"objects/control-defaults/"})).done(function(t,o){e._alertGroups=t[0],e._alerts=t[1],e._defaults=o[0],e._data={},s in n&&(e._data=g.unserialize.call(e,n[s])),i.resolve()}).fail(function(){i.reject.apply(i,arguments)}),i},unserialize:function(i){try{var n=t.parseJSON(i);return e.each(n,function(){}),n}catch(s){return{}}},formatTimeout:function(t,e){if(t===this.KEY_ENTER_DELAY_CONTROL||t===this.KEY_PANIC_BUTTON_CONTROL)return e;var i=parseInt(e/3600),n=parseInt(e/60)%60;return i.padLeft(2)+":"+n.padLeft(2)},renderZones:function(){var t,i,n=this.PARAM_ENTER_DELAY_ZONES,s=this.$el.find('[data-name="'+n+'"]'),o=this.KEY_ENTER_DELAY_CONTROL,a=g.getCurrentParameterValue.call(this,o,n),r=(a.length,e.indexBy(this.model.get("areas"),"id")),l=this.model.get("zones"),c=e.indexBy(l,"id"),h="",d="",u=this.controller.getTexts();return t=e.filter(a,function(t){return t in c}),t.length<a.length&&(a=t,this._extraParameters[o][n]=t),e.each(l,function(t){h=t.name?e.escape(t.name):u.objZone+" "+t.num,i=r[t.areaId],h+=" ("+(i.name?e.escape(i.name):u.objArea+" "+i.num)+")",d+='<option value="'+t.id+'"'+(e.indexOf(a,t.id)>-1?" selected":"")+">"+h+"</option>"}),s.html(d),s},initZonesMultiselect:function(t){var e=this.PARAM_ENTER_DELAY_ZONES,i=this._extraParameters[this.KEY_ENTER_DELAY_CONTROL];t.chosen(g.getChosenOptions.call(this)),t.on("change",function(){i[e]=g.getSelectValues(t)})},getHeaderPopup:function(t,e){switch(e){case this.KEY_CONNECTION_CONTROL:return t.alertControlConnection;case this.KEY_ACTIVITY_CONTROL:return t.alertControlActivity;case this.KEY_ENTER_DELAY_CONTROL:return t.alertControlEnterDelay;case this.KEY_PANIC_BUTTON_CONTROL:return t.alertControlPanicButton;case this.KEY_AUTO_TEST_CONTROL:return t.alertControlAutotest;case this.KEY_CHANNELS_CONTROL:return t.streamChannelsControl;case this.KEY_ALERTS_LIST_CONTROL:return t.alertsListControl;case this.KEY_MOVEMENT_CONTROL:return t.alertControlMovement;case this.KEY_LOST_COORDS_CONTROL:return t.alertControlLostCoords}},openExtraSettingsPopup:function(e){var n=this,s=this.controller.getTexts();return e===this._activeExtraParametersKey?(this._popup.trigger("jw.activate"),void 0):(this._activeExtraParametersKey=e,this.closePopup(),i.window.open({addClass:"win-alert-control",headerHtml:g.getHeaderPopup.call(this,s,e),contentHtml:g.renderExtraSettings.call(this,e),footerHtml:p({btns:[e===this.KEY_ALERTS_LIST_CONTROL?s.clear.ucFirst():s.setDefaults.ucFirst(),s.done]}),dieAfter:0,centered:!0,width:500,openCallback:function(){n._popup=this},showCallback:function(){var i=n._popup,s=n._extraParameters;e===n.KEY_ACTIVITY_CONTROL?g.initActivityMultiSelects.call(n,i):e===n.KEY_ENTER_DELAY_CONTROL||e===n.KEY_PANIC_BUTTON_CONTROL||e===n.KEY_CONNECTION_CONTROL?g.initReceivedAndExpectedMultiSelects.call(n,i,e):e===n.KEY_AUTO_TEST_CONTROL?g.initAutotestExtraParams.call(n,i):e===n.KEY_CHANNELS_CONTROL?g.initChannelsExtraParams.call(n,i):e===n.KEY_ALERTS_LIST_CONTROL?g.initAlertsListExtraParams.call(n,i):(e===n.KEY_MOVEMENT_CONTROL||e===n.KEY_LOST_COORDS_CONTROL)&&g.initMovementMultiSelects.call(n,i,e),i.on("click",".set-defaults",function(){if(e===n.KEY_AUTO_TEST_CONTROL){var o=n.PARAM_SAVE_AUTOTEST,a=g.getDefaultValues.call(n,e,o);i.find("input[name="+o+"]").prop("checked",a)}else e===n.KEY_ALERTS_LIST_CONTROL?(i.find(".control-group[data-name]").each(function(){var o=t(this),a=o.data("name"),r=g.getDefaultValues.call(n,e,a),l=[null].concat(n._alerts);if(a===n.PARAM_ALERTS_LIST_ACCEPT_EXPECTED)o.find('input[value="'+r+'"]').prop("checked",!0);else if(a===n.PARAM_ALERTS_LIST_GENERATED_ALERT)g.renderAlerts.call(n,o.find("select"),l,[r]);else{var c,h;a===n.PARAM_ALERTS_LIST_EXPECTED_ALERTS?(i.find(".control-row").not(":first-of-type").remove(),c=i.find('select[name="alert"]'),h=i.find('select[name="channels"]')):(c=i.find('select[name="alert"]'),h=i.find('select[name="channels"]'));var d=null===r?null:r.alert,u=g.getChannels.call(n),p=null===r?[]:r.channels;g.renderAlerts.call(n,c,l,[d]),g.renderChannels.call(n,h,u,p)}s[e][a]=r}),i.find("select").trigger("chosen:updated")):e===n.KEY_MOVEMENT_CONTROL||e===n.KEY_LOST_COORDS_CONTROL?i.find("select").each(function(){var i=t(this),o=this.name,a=[];g.renderGeozones.call(n,i,n._geozones,a),i.trigger("chosen:updated"),s[e][o]=a}):i.find("select").each(function(){var i=t(this),o=this.name,a=g.getDefaultValues.call(n,e,o);o===n.PARAM_CHANNELS_CHANNELS?g.renderChannels.call(n,i,a,a):o===n.PARAM_ACTIVITY_GROUPS?g.renderAlertGroups.call(n,i,a):g.renderAlerts.call(n,i,n._alerts,a),i.trigger("chosen:updated"),s[e][o]=a});return!1})},closeCallback:function(){n._popup=null,n._activeExtraParametersKey=""}}),void 0)},renderExtraSettings:function(t){var e,i=null,n=this.controller.getTexts();return t===this.KEY_ACTIVITY_CONTROL?(i=o,e=[this.PARAM_ACTIVITY_GROUPS,this.PARAM_ACTIVITY_ALERTS]):t===this.KEY_ENTER_DELAY_CONTROL||t===this.KEY_PANIC_BUTTON_CONTROL||t===this.KEY_CONNECTION_CONTROL?(i=a,e=[this.PARAM_RECEIVED_ALERTS,this.PARAM_EXPECTED_ALERTS]):t===this.KEY_AUTO_TEST_CONTROL?(i=c,e=[this.PARAM_SAVE_AUTOTEST]):t===this.KEY_CHANNELS_CONTROL?(i=h,e=[this.PARAM_CHANNELS_ALERTS,this.PARAM_CHANNELS_CHANNELS]):t===this.KEY_ALERTS_LIST_CONTROL?(i=d,e=[this.PARAM_ALERTS_LIST_INITIAL_ALERT,this.PARAM_ALERTS_LIST_EXPECTED_ALERTS,this.PARAM_ALERTS_LIST_GENERATED_ALERT,this.PARAM_ALERTS_LIST_ACCEPT_EXPECTED]):t===this.KEY_MOVEMENT_CONTROL?(i=r,e=[this.PARAM_GEO_ZONES]):t===this.KEY_LOST_COORDS_CONTROL&&(i=l,e=[this.PARAM_GEO_ZONES]),i?i({i18n:n,names:e}):void 0},getChosenOptions:function(){return{disable_search:!1,disable_search_threshold:10,no_results_text:this.controller.getTexts().searchNoResults}},initActivityMultiSelects:function(t){var e=this,i=this._extraParameters,n=this.KEY_ACTIVITY_CONTROL,s=this.PARAM_ACTIVITY_GROUPS,o=this.PARAM_ACTIVITY_ALERTS,a=t.find("select[name="+s+"]"),r=t.find("select[name="+o+"]"),l=g.getCurrentParameterValue.call(this,n,s),c=g.getCurrentParameterValue.call(this,n,o);g.renderAlertGroups.call(this,a,l),g.renderAlerts.call(this,r,this._alerts,c),a.add(r).chosen(g.getChosenOptions.call(this)),a.on("change",function(){var t=g.getSelectValues(a);g.renderAlerts.call(e,r,g.filterAlerts.call(e,t)),r.trigger("chosen:updated"),i[n][s]=t.length?t:[]}),r.on("change",function(){var t=g.getSelectValues(r);i[n][o]=t.length?t:[]})},initChannelsExtraParams:function(t){function e(t){var e=r.val()||[];n[s][o]=e.length?e:null,t!==!1&&i(!1)}function i(t){var i=g.getSelectValues(l);n[s][a]=i.length?i:null,t!==!1&&e(!1)}var n=this._extraParameters,s=this.KEY_CHANNELS_CONTROL,o=this.PARAM_CHANNELS_CHANNELS,a=this.PARAM_CHANNELS_ALERTS,r=t.find("select[name="+o+"]"),l=t.find("select[name="+a+"]"),c=g.getCurrentParameterValue.call(this,s,o),h=g.getCurrentParameterValue.call(this,s,a),d=g.getChannels.call(this);g.renderAlerts.call(this,l,this._alerts,h),g.renderChannels.call(this,r,d,c),r.add(l).chosen(g.getChosenOptions.call(this)),r.on("change",e),l.on("change",i)},initAlertsListExtraParams:function(e){function i(t){if(b)return c[p][t];var e=p in h._data?h._data[p]:{};return t in e?e[t]:null}function n(t,e){g.renderAlerts.call(h,t,[null].concat(h._alerts),[e])}function s(t,e){g.renderChannels.call(h,t,w,e)}function o(){var t=Number(A.val());c[p][m]=t>0?{alert:t,channels:L.val()||[]}:null,e.trigger("jw.contentchange")}function a(){var i=D.find(".control-row"),n=[];i.each(function(){var e=t(this),i=Number(e.find('[name="alert"]').val());n.push({alert:i>0?i:null,channels:e.find('[name="channels"]').val()||[]})}),e.trigger("jw.contentchange"),c[p][f]=n,n[n.length-1];var s=n.filter(function(t){return t.alert>0});s.length===n.length&&r(y)}function r(i){var o=D.find(".control-row").length;if(!(o>=M)){var r=t(u({i18n:d,index:o})).appendTo(D.find(".control-rows")),l=r.find('[name="alert"]'),c=r.find('[name="channels"]');n(l,i.alert),s(c,i.channels),l.chosen(C),c.chosen(x),l.on("change",a),c.on("change",a),e.trigger("jw.contentchange")}}function l(t){t.map(r)}var c=this._extraParameters,h=this,d=this.controller.getTexts(),p=this.KEY_ALERTS_LIST_CONTROL,m=this.PARAM_ALERTS_LIST_INITIAL_ALERT,f=this.PARAM_ALERTS_LIST_EXPECTED_ALERTS,v=this.PARAM_ALERTS_LIST_GENERATED_ALERT,_=this.PARAM_ALERTS_LIST_ACCEPT_EXPECTED,b=Object.values(c[p]).some(function(t){return null!==t}),y={alert:null,channels:[]};e.on("jw.contentchange",function(){var t=e.find(".modal-body");t.css("overflow",t[0].scrollHeight>t.height()?"auto":"visible")});var w=g.getChannels.call(this),x=g.getChosenOptions.call(this),C=t.extend({},x,{allow_single_deselect:!0}),S=i(m)||y,T=e.find('.control-group[data-name="'+m+'"]'),A=T.find('[name="alert"]'),L=T.find('[name="channels"]');n(A,S.alert),s(L,S.channels),A.chosen(C),L.chosen(x),A.on("change",o),L.on("change",o),o();var M=8,k=i(f)||[y],D=e.find('.control-group[data-name="'+f+'"]');l(k),a();var I=i(v),P=e.find('.control-group[data-name="'+v+'"] select');n(P,I),c[p][v]=I,P.on("change",function(){var t=Number(this.value);c[p][v]=t>0?t:null}),P.chosen(C);var R=i(_)===!0,E=e.find('.control-group[data-name="'+_+'"] input');E.filter('[value="'+R+'"]').prop("checked",!0),E.on("click",function(){c[p][_]=this.checked}),c[p][_]=R},initAutotestExtraParams:function(t){var e=this,i=this.KEY_AUTO_TEST_CONTROL,n=this.PARAM_SAVE_AUTOTEST,s=g.getCurrentParameterValue.call(this,i,n);t.find("input[name="+n+"]").prop("checked",s).on("click",function(){e._extraParameters[i][n]=this.checked})},initReceivedAndExpectedMultiSelects:function(t,e){var i=this._extraParameters,n=this.PARAM_RECEIVED_ALERTS,s=this.PARAM_EXPECTED_ALERTS,o=t.find("select[name="+n+"]"),a=t.find("select[name="+s+"]"),r=g.getCurrentParameterValue.call(this,e,n),l=g.getCurrentParameterValue.call(this,e,s);g.renderAlerts.call(this,o,this._alerts,r),g.renderAlerts.call(this,a,this._alerts,l),o.add(a).chosen(g.getChosenOptions.call(this)),o.on("change",function(){i[e][n]=g.getSelectValues(o)}),a.on("change",function(){i[e][s]=g.getSelectValues(a)})},initMovementMultiSelects:function(t,e){var i=this._extraParameters,n=this.PARAM_GEO_ZONES,s=t.find("select[name="+n+"]"),o=g.getCurrentParameterValue.call(this,e,n);g.renderGeozones.call(this,s,this._geozones,o),s.chosen(g.getChosenOptions.call(this)),s.on("change",function(){i[e][n]=g.getSelectValues(s)})},getCurrentParameterValue:function(t,e){var i=this._extraParameters,n=this._data,s=t in i?i[t]:{},o=t in n&&null!==n[t]?n[t]:{},a=e in s&&null!==s[e]?s[e]:e in o?o[e]:g.getDefaultValues.call(this,t,e);return a},getDefaultValues:function(t,e){var i=null,n=this._defaults;return t in n?i=n[t][e]||[]:t===this.KEY_ALERTS_LIST_CONTROL&&e===this.PARAM_ALERTS_LIST_ACCEPT_EXPECTED&&(i=!1),i},getChannels:function(){var t=g.getDefaultValues.call(this,this.KEY_CHANNELS_CONTROL,this.PARAM_CHANNELS_CHANNELS);return null===t?[]:t},renderChannels:function(t,i,n){var s="";e.each(i,function(t){s+='<option value="'+t+'"'+(e.indexOf(n,t)>-1?" selected":"")+">"+t+"</option>"}),t.html(s)},renderAlertGroups:function(t,i){var n="";e.each(this._alertGroups,function(t){n+='<option value="'+t.id+'"'+(e.indexOf(i,t.id)>-1?" selected":"")+">"+t.name+"</option>"}),t.html(n)},renderGeozones:function(t,i,n){var s="";n=n||g.getSelectValues(t),e.each(i,function(t){s+=null===t?"<option></option>":'<option value="'+t.id+'"'+(e.indexOf(n,t.id)>-1?" selected":"")+">"+t.name+"</option>"}),t.html(s)},renderAlerts:function(t,i,n){var s="";n=n||g.getSelectValues(t),e.each(i,function(t){s+=null===t?"<option></option>":'<option value="'+t.code+'"'+(e.indexOf(n,t.code)>-1?" selected":"")+">"+g.formatCode(t.code)+" "+t.message+"</option>"}),t.html(s)},filterAlerts:function(t){return t.length?e.filter(this._alerts,function(i){return e.indexOf(t,i.groupId)>-1}):this._alerts},getSelectValues:function(t){var i=t.val()||[];return e.map(i,function(t){return Number(t)})},bindEvents:function(){var e=this;this.$el.on("remove",function(){this.$el.off("remove"),this.remove()}.bind(this)),this.$el.on("click",".advanced-settings",function(){return g.openExtraSettingsPopup.call(e,t(this).data("key")),!1}),this.listenTo(this.model,"change:zones",function(){g.renderZones.call(e),e.$el.find('[data-name="'+e.PARAM_ENTER_DELAY_ZONES+'"]').trigger("chosen:updated")})},processTimeoutString:function(t,i){var n=0;if(t===this.KEY_ENTER_DELAY_CONTROL||t===this.KEY_PANIC_BUTTON_CONTROL)n=parseInt(i),n=e.isNaN(n)||0>n?0:Math.max(Math.min(999,n),0);else{var s=0,o=0,a=i.split(":");2===a.length&&(s=parseInt(a[0]),o=parseInt(a[1]),e.isNaN(s)||e.isNaN(o)||(s=Math.max(Math.min(99,s),0),o=Math.max(Math.min(59,o),0),n=3600*s+60*o))}return n},getExtraParameters:function(t){var i,n=this._data,s=this._defaults,o={};if(t===this.KEY_AUTO_TEST_CONTROL||t===this.KEY_ENTER_DELAY_CONTROL||t===this.KEY_ACTIVITY_CONTROL||t===this.KEY_PANIC_BUTTON_CONTROL||t===this.KEY_CONNECTION_CONTROL||t===this.KEY_CHANNELS_CONTROL||t===this.KEY_ALERTS_LIST_CONTROL||t===this.KEY_MOVEMENT_CONTROL||t===this.KEY_LOST_COORDS_CONTROL){i=this._extraParameters[t];var a=Object.values(i).some(function(t){return null!==t});e.each(i,function(e,i){a?null!==e&&(o[i]=e):t in n&&i in n[t]?o[i]=n[t][i]:t in s&&i in s[t]&&(o[i]=s[t][i])})}if(t===this.KEY_ALERTS_LIST_CONTROL){var r=Object.keys(o);if(r.length<4)o={};else{var l=o[this.PARAM_ALERTS_LIST_EXPECTED_ALERTS].filter(function(t){return t.alert>0});l.length?o[this.PARAM_ALERTS_LIST_EXPECTED_ALERTS]=l:o={}}}return o},formatCode:function(t){var e=String(t);return 4==e.length&&(e=e.substr(0,3)+"."+e.substr(3)),e}};return f}),define("text!abstracts/itemcard/tmpl/cameras.html",[],function(){return'<table class="l">\n    <tr>\n        <td class="col">\n            <div class="field">\n                <label><%= i18n.login.ucFirst() %> Ivideon</label>\n                <div class="itext">\n                    <input class="auth-input login-input" type="text" name="ivlogin" value="<%- settings.ivlogin %>" autocomplete="off">\n                </div>\n            </div><div class="field">\n                <label><%= i18n.password.ucFirst() %> Ivideon</label>\n                <div class="itext">\n                    <input class="auth-input password-input" type="password" name="ivpassword" value="<%- settings.ivpassword %>">\n                </div>\n            </div><div class="field add-camera<% if(!settings.ivlogin || !settings.ivpassword) {%> hidden<% } %>">\n                <label><%= i18n.camera %></label>\n                <div class="select">\n                    <select name="ivcamid"></select>\n                </div>\n                <% if(0) {%>\n                <div class="itext">\n                    <input type="hidden" name="ivcamid"\n                           value="<%- settings.ivcamid %>"<% if(!(\'ivcamid\' in settings) || !settings.ivlogin || !settings.ivpassword) {%> disabled<% } %>>\n                    <input class="ignore" type="text" name="cameraName" value="" placeholder="<%= i18n.cameraNameIvideon %>"\n                        <% if(!settings.ivlogin || !settings.ivpassword) {%>disabled<% } %> >\n                </div>\n                <% } %>\n            </div>\n\n            <a class="btn btn-small btn-primary\n                btn-connect<% if(!settings.ivlogin || !settings.ivpassword || ( settings.ivlogin && settings.ivpassword )) {%> hidden<% } %>" href="#">\n                <%= i18n.connect %>\n            </a>\n\n            <div class="cameras-list"></div>\n\n            <p class="no-data<% if(!settings.ivlogin || !settings.ivpassword || (\'ivcamid\' in settings)) {%> hidden<% } %>">\n                <%= i18n.noCamerasAdded %>\n            </p>\n        </td>\n        <td class="col col-info">\n            <div class="ivideon-text">\n                <%= i18n.ivideonInfo %>\n            </div>\n        </td>\n    </tr>\n</table>'}),define("text!abstracts/itemcard/tmpl/cameraPreview.html",[],function(){return'<div data-id="<%= id %>" class="camera-preview loading">\n    <div class="camera-image">\n        <img src="<%= src %>">\n    </div>\n    <div class="camera-actions">\n        <i class="remove-camera svg-icon svg-icon-circle-remove"></i>\n    </div>\n    <div class="camera-error">\n        <%= errorTxt %>\n    </div>\n</div>'}),define("text!abstracts/itemcard/tmpl/camerasAdd.html",[],function(){return'<form class="card-extra-action camera-form form-horizontal" method="post" action="">\n    <!--<div class="file-upload-input">-->\n\n        <input class="" type="text" name="cameraId">\n        <input class="" type="text" name="cameraName" placeholder="<%= i18n.cameraNameIvideon %>">\n\n    <!--</div>-->\n\n    <button type="submit" class="btn btn-primary"><%= i18n.add.ucFirst() %></button>\n    <a class="btn btn-cancel"><%= i18n.cancel %></a>\n\n</form>'}),define("abstracts/itemcard/views/IvideonVideoView",["jquery","jqueryui","jface","underscore","abstracts/View","text!../tmpl/cameras.html","text!../tmpl/cameraPreview.html","text!../tmpl/camerasAdd.html"],function(t,e,i,n,s,o,a,r){o=n.template(o),a=n.template(a),r=n.template(r);var l=s.prototype,c="https://streaming.ivideon.com/preview/live",h=s.extend({constructor:function(){this.controller=null,this.loading=!1,this.connected=!1,this._login="",this._password="",this._selectedIds=[],this._cameras=null,this._camerasById=null,this._xhr=null,this._sessionId="",this.$login=null,this.$password=null,this.$addBlock=null,this.$form=null,this.$list=null,this.$select=null,this.$noCameras=null,this.$btnConnect=null,s.apply(this,arguments)},initialize:function(t){this.controller=t.controller,this.render(),d.bindEvents.call(this);var e=this.model.get("settings");if(this.$addBlock.find("input[name=ivcamid]"),e.ivlogin&&e.ivpassword&&t.autoConnect!==!1){var i=this,s=e.ivlogin,o=App.get("ivSessions");s in o&&(this._sessionId=o[s]),this._login=s,this._password=e.ivpassword,this._selectedIds=[],"ivcamid"in e&&(this._selectedIds[0]=e.ivcamid),d.load.call(this).done(function(){var t="ivcamid"in e?String(e.ivcamid):"";if(t.length>0){var s;if(t in i._camerasById?s=i._camerasById[t]:-1==t.indexOf("/")&&(s=n.find(i._camerasById,function(e){return e.id==t})),s)d.onSelect.call(i,s);else{var o=i.controller.getTexts();alert(o.errCameraNotAvailable,o.error),i._selectedIds=[],i.$noCameras.removeClass("hidden")}}}).fail(function(){d.toggleAddBlock.call(i,!1),i.$btnConnect.removeClass("hidden")})}},render:function(){this.model.get("settings"),this.$el.html(o(n.extend({},this.model.attributes,{i18n:this.controller.getTexts()}))),this.$login=this.$el.find(".login-input"),this.$password=this.$el.find(".password-input"),this.$addBlock=this.$el.find(".add-camera"),this.$select=this.$addBlock.find("select"),this.$list=this.$el.find(".cameras-list"),this.$noCameras=this.$el.find(".no-data"),this.$btnConnect=this.$el.find(".btn-connect")},remove:function(){this._xhr&&(this._xhr.abort(),this._xhr=null),l.remove.apply(this,arguments)}}),d={bindEvents:function(){var e=this;this.$login.add(this.$password).on("blur",function(){var i=e._login,n=e._password;e._login=t.trim(e.$login.val()),e._password=t.trim(e.$password.val()),(e._login!=i||e._password!=n)&&(e.connected=!1,e.$noCameras.addClass("hidden"),d.toggleAddBlock.call(e,!1),d.clearSelected.call(e),e._login&&e._password?e.$btnConnect.removeClass("hidden"):e.$btnConnect.addClass("hidden"))}),this.$btnConnect.on("click",function(){return d.connect.call(e),!1}),this.$select.on("change",function(){var i=t(this).val();"-1"!=i?d.onSelect.call(e,e._camerasById[i]):d.clearSelected.call(e)}),this.$el.on("click",".remove-camera",function(){d.clearSelected.call(e)})},connect:function(){var t=this;this._sessionId="",this._cameras=null,this._camerasById=null,this._login&&this._password&&d.load.call(t).done(function(){t.$btnConnect.addClass("hidden"),d.toggleAddBlock.call(t,!0),1==t._cameras.length&&d.onSelect.call(t,t._cameras[0])})},load:function(){var e=this,i=e.controller.getTexts(),s={login:this._login,password:this._password},o=new t.Deferred;return this._sessionId&&(s.sessionId=this._sessionId),this.loading=!0,this.$el.addClass("loading"),this._xhr=t.ajax({url:App.getBaseUrl()+"ivideon/list-cameras/",data:s,success:function(t){e.connected=!0,e._sessionId=t.sessionId,e._cameras=t.cameras,e._camerasById=n.indexBy(e._cameras,function(t){return t.server.id+"/"+t.id});var s=App.get("ivSessions");s[e._login]=e._sessionId,App.set("ivSessions",n.clone(s)),e._cameras.length?(e.$select.prop("disabled",!1),d.buildSelect.call(e),o.resolve(e._cameras)):(o.reject(),alert(i.errCamerasListEmpty,i.error))},error:function(t){o.reject(),d.showAjaxError.call(e,t,i.errCamerasListLoad)},complete:function(){e.loading=!1,e.$el.removeClass("loading")}}),o},showAjaxError:function(e,i){var n=this.controller.getTexts(),s=n.error,o=i;try{var a=t.parseJSON(e.responseText);o=a.msg}catch(r){}alert(o,s)},clearSelected:function(){this.$el.find(".camera-preview").remove(),this._selectedIds=[],this.$select.find('option[value="-1"]').prop("selected",!0),this.connected?this.$noCameras.removeClass("hidden"):this.$select.prop("disabled",!0)},toggleAddBlock:function(t){this.$addBlock[t?"removeClass":"addClass"]("hidden").find("input").prop("disabled",!t)},buildSelect:function(){for(var t,e,i=this._cameras,n=this.controller.getTexts(),s='<option value="-1">'+n.cameraNotSelected+"</option>",o=0,a=i.length;a>o;o++)e=i[o],t=e.name,s+='<option value="'+e.server.id+"/"+e.id+'">'+t+"</option>";this.$select.html(s)},renderList:function(){for(var t="",e=this._selectedIds,i="",s=null,o=0,a=e;a>o;++o)s=null,i=e[o],s=-1==i.indexOf("/")?n.find(this._camerasById,function(t){t.id==i}):this._camerasById[i],s&&(t+=d.renderPreview.call(this,s));this.$list.html(t)},onSelect:function(e){this.$list.find(".camera-preview").remove();var i=t(d.renderPreview.call(this,e)).appendTo(this.$list);i.find("img").one("error",function(){i.addClass("preview-error")}),this._selectedIds=[e.server.id+"/"+e.id],this.$select.prop("disabled",!1).find('option[value="'+e.server.id+"/"+e.id+'"]').prop("selected",!0),this.$noCameras.addClass("hidden")},renderPreview:function(t){return a(n.extend({},t,{src:c+"?server="+t.server.id+"&camera="+t.id+"&sessionId="+this._sessionId,errorTxt:this.controller.getTexts().errCameraPreview}))}};return h}),define("text!abstracts/itemcard/tmpl/rtpVideo.html",[],function(){return'<% if($.browser.ie) {%>\n<div class="alert-danger" style="padding: 10px">\n    <div><strong><%= i18n.attention %></strong></div>\n    <%= i18n.errNoRtspVideoInIe %>\n</div>\n<% } %>\n<%= htmlCameras %>'}),define("text!abstracts/itemcard/tmpl/ritmCameras.html",[],function(){return'<p class="no-data"><%= i18n.noCamerasAdded %></p>\n<table class="table table-condensed hidden">\n    <thead>\n        <th><%= i18n.cameraName %></th>\n        <th><%= i18n.source %></th>\n        <th>UUID</th>\n        <% if(videoType === \'ritmrtp\') {%>\n            <th><%= i18n.rtspStreamUrl %></th>\n        <% } %>\n        <th><%= i18n.eventsForDeviceVideoArchiveRequesting %></th>\n        <th><%= i18n.note %></th>\n        <th>&nbsp;</th>\n        <th>&nbsp;</th>\n        <th>&nbsp;</th>\n    </thead>\n    <tbody></tbody>\n</table>'}),define("text!abstracts/itemcard/tmpl/ritmCameraRow.html",[],function(){return'<tr data-index="<%= index %>">\n    <td class="col-camera-name">\n        <div class="itext">\n            <input type="text" name="cameraName" value="<%- camera.name %>"  autocomplete="off" maxlength="40" />\n        </div>\n    </td>\n    <td class="col-camera-source">\n        <select name="cameraSource" >\n            <% _.each(optionsSource, function(option, i) {%>\n            <option value="<%= option.value %>"<% if(option.value === camera.source) {%> selected<% } %>><%= option.title %></option>\n            <% }) %>\n        </select>\n    </td>\n    <% if(videoType === \'ritmrtp\') {%>\n        <td class="col-camera-uuid">\n            <div class="itext">\n                <input type="text" name="cameraUuid" value="<%= camera.uuid %>"  maxlength="36"/>\n            </div>\n        </td>\n        <td class="col-camera-url">\n            <div class="itext">\n                <% if(camera.showUrl) { %>\n                    <input type="text" name="cameraUrl" value="<%- camera.url %>"  autocomplete="off" maxlength="255"/>\n                <% } else { %>\n                    <input type="text" name="cameraUrl" value="-"  readonly/>\n                <% } %>\n            </div>\n        </td>\n    <% } %>\n\n    <td class="col-camera-events">\n        <select \n            name="cameraRequestAlerts"\n            data-placeholder="<%= i18n.chooseAlerts %>" \n            multiple\n        ></select>\n    </td>\n\n    <td>\n        <div class="itext">\n            <input type="text" name="cameraNote" value="<%- camera.note %>"  autocomplete="off" maxlength="255" />\n        </div>\n    </td>\n\n    <td class="col-icon">\n        <svg  class="svg-icon more-action-up">\n            <use xlink:href="#smb-chevron-right"></use>\n        </svg>\n    </td>\n    <td class="col-icon">\n        <svg  class="svg-icon more-action-down">\n            <use xlink:href="#smb-chevron-right"></use>\n        </svg>\n    </td>\n    <td class="col-icon">\n        <i  class="svg-icon svg-icon-remove icon-remove"></i>\n    </td>\n</tr>'
}),define("abstracts/itemcard/views/RitmVideoView",["jquery","jqueryui","jface","underscore","abstracts/View","text!../tmpl/rtpVideo.html","text!../tmpl/ritmCameras.html","text!../tmpl/ritmCameraRow.html"],function(t,e,i,n,s,o,a,r){function l(){var t=(new Date).getTime();"undefined"!=typeof performance&&"function"==typeof performance.now&&(t+=performance.now());var e="xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx";return e.replace(/[xy]/g,function(e){var i=0|(t+16*Math.random())%16;return t=Math.floor(t/16),("x"===e?i:8|3&i).toString(16)})}a=n.template(a),r=n.template(r);var c=12,h="DEVICE",d="RTSP",u=s.prototype,p=s.extend({constructor:function(){this.controller=null,this._cameras=null,this._hasErrors=!1,s.apply(this,arguments)},tmpl:n.template(o),videoType:"ritmrtp",initialize:function(t){var e=this;this.controller=t.controller;var i=this.controller.getTexts();this.optionsSource=[{value:h,title:i.currentDevice},{value:d,title:i.RTSPCamera}],m.load.call(e).done(function(){e.render(),e._bindEvents()}).fail(function(t){e.showErrors(t)}).always(function(){e.$el.removeClass("loading")})},remove:function(){u.remove.apply(this,arguments)},getMappedCameras:function(t){if(!Array.isArray(t))return[];var e=t.map(function(t,e){return t.num=e,t.source=t.source?t.source.toUpperCase():"",t.showUrl=t.source===d,t});try{e=JSON.parse(JSON.stringify(e))}catch(i){console.error("getMappedCameras",i)}return e},getCameras:function(){var e=this.model.get("settings");try{var i=t.parseJSON(e.VIDEO_STORAGE_CAMERAS);if(Array.isArray(i))return this.getMappedCameras(i);if("videoType"in i&&i.videoType===this.videoType)return this.getMappedCameras(i.cameras)}catch(n){}return[]},render:function(){var t=this.model.get("settings"),e=this.controller.getTexts();this._cameras=this.getCameras();var i=a(n.extend({},{i18n:e,videoType:this.videoType}));this.$el.html(this.tmpl(n.extend({},{i18n:e,settings:t,htmlCameras:i}))),this.$noData=this.$el.find(".no-data"),this.$table=this.$el.find("table"),this.$tbody=this.$el.find("tbody"),this.renderTable()},renderTable:function(){this._renderRows(this._cameras),this._cameras.length>0&&(m.initAllmultiSelects.call(this,this.$tbody,this._cameras),this.$tbody.find('select[name="cameraSource"]').one("change",this._handleChangeCameraSource.bind(this)),this.$tbody.find("input").one("change",this._handleChangeCameraInput.bind(this)))},addRow:function(){if(this._cameras.length<c){var e=this.controller.getTexts(),i=this._findVacantNumber(this._cameras),n={num:i,name:e.videoCamera+" "+(i+1),source:h,requestAlerts:[],note:"",uuid:""};this._cameras.push(n),this._toggleTable();var s=t(this._renderRow(this._cameras.length-1,n)).appendTo(this.$tbody);s.find('select[name="cameraSource"]').on("change",this._handleChangeCameraSource.bind(this)),s.find("input").one("change",this._handleChangeCameraInput.bind(this)),m.initRequestAlertsMultiSelect.call(this,s.find('select[name="cameraRequestAlerts"]'),n),this.validate()}},validate:function(){},addSerializedData:function(){return this._cameras.map(function(t){return t.source===h&&(t.url="none"),t})},_bindEvents:function(){var e=this;this.$el.on("remove",function(){e.$el.off("remove"),e.remove()}).on("click",".icon-remove",function(){var i=t(this),n=i.closest("tr"),s=n.data("index");e._cameras.splice(s,1),e.renderTable(),e.validate()}).on("click",".more-action-up",function(){var i=t(this),n=i.closest("tr"),s=n.data("index");e._handleChangeCameraNumber(s,-1)}).on("click",".more-action-down",function(){var i=t(this),n=i.closest("tr"),s=n.data("index");e._handleChangeCameraNumber(s,1)})},_toggleTable:function(){var t=this._cameras.length>0;this.$noData.toggleClass("hidden",t),this.$table.toggleClass("hidden",!t)},_renderRows:function(t){var e=t.length,i="";this._toggleTable();for(var n=0;e>n;++n)i+=this._renderRow(n,t[n]);this.$tbody.html(i)},_renderRow:function(t,e){var i=this.controller.getTexts();return"ritmrtp"!==this.videoType||e.uuid||(e.uuid=e.source===d?this._getUuid():""),r({index:t,camera:e,optionsSource:this.optionsSource,options:n.map(n.range(0,c),function(t){return i.videoCamera+" "+(t+1)}),videoType:this.videoType,i18n:i})},_toggleAddBlock:function(t){this.$addBlock[t?"removeClass":"addClass"]("hidden").find("input").prop("disabled",!t)},_handleChangeCameraNumber:function(t,e){var i=t+e;if(!(0>i||i>this._cameras.length-1)){var n=this._cameras[t];this._cameras.splice(t,1),this._cameras.splice(i,0,n),this.renderTable()}},_handleChangeCameraInput:function(e){e.stopPropagation();var i=t(e.target),n=i.closest("tr"),s=n.data("index"),o=i.attr("name"),a=i.val(),r=o.replace("camera","").toLowerCase(),l=this._cameras[s];l[r]=a},_handleChangeCameraSource:function(e){var i=t(e.target),n=i.closest("tr"),s=n.data("index"),o=i.val(),a=this._cameras[s];a.source=o,a.showUrl=o===d,a.uuid=a.source===d?this._getUuid():"",this.renderTable()},_handleChangeCameraRequestAlerts:function(e){var i=t(e.target),n=i.closest("tr"),s=n.data("index");this._cameras[s].requestAlerts=m.getSelectValues(i),this.validate()},_findVacantNumber:function(t){for(var e=0;c>e;e++)if(!n.findWhere(t,{num:e}))return e;return 0},_getUuid:function(){return l()},_showErrors:function(t){var e=this.controller.getTexts(),i=[];if(n.isArray(arguments[0])){var s=this._popup;n.each(t,function(t){n.isArray(t.key)||(t.key=[t.key]),n.each(t.key,function(t){s.find('[name="'+t+'"]').closest(".control-group").addClass("error")}),i.push(t.msg)});var o=s.find(".error").first()}i.length&&alert(i.join("<br />"),e.error,{closeCallback:function(){o&&o.find("input, select, textarea").focus()}})}}),m={load:function(){var e=this,i=new t.Deferred;return e.$el.addClass("loading"),t.when(this.controller.loadAlertTemplatesAndGroups()).done(function(t,n){e._alertGroups=t,e._alerts=n,i.resolve()}).fail(function(){i.reject.apply(i,arguments)}).always(function(){e.$el.removeClass("loading")}),i},initAllmultiSelects:function(e,i){for(var n=e.find('select[name="cameraRequestAlerts"]'),s=0;s<n.length;s++)m.initRequestAlertsMultiSelect.call(this,t(n[s]),i[s])},initRequestAlertsMultiSelect:function(t,e){if(t&&e){var i=e&&e.requestAlerts;m.renderRequestAlerts.call(this,t,this._alerts,i||[]),t.chosen(m.getChosenOptions.call(this)),t.on("change",this._handleChangeCameraRequestAlerts.bind(this))}},renderRequestAlerts:function(t,e,i){var s="";i=i||m.getSelectValues(t),n.each(e,function(t){s+=null===t?"<option></option>":'<option value="'+t.code+'"'+(n.indexOf(i,t.code)>-1?" selected":"")+">"+m.formatCode(t.code)+" "+t.message+"</option>"}),t.html(s)},getSelectValues:function(t){var e=t.val()||[];return n.map(e,function(t){return Number(t)})},getChosenOptions:function(){return{disable_search:!1,disable_search_threshold:10,no_results_text:this.controller.getTexts().searchNoResults}},formatCode:function(t){var e=String(t);return 4==e.length&&(e=e.substr(0,3)+"."+e.substr(3)),e}};return p}),define("text!abstracts/itemcard/tmpl/video.html",[],function(){return'<% if(App.hasMediaServerUrl()) {%>\n<div class="field no-bottom-margin">\n    <label class="radio">\n        <input type="radio" name="videoType" value="ritmrtp" <% if(videoType === \'ritmrtp\') { %>checked<% } %> /> RTSP\n    </label>\n</div>\n<% } %>\n<!--<div class="field no-bottom-margin">\n    <label class="radio">\n        <input type="radio" name="videoType" value="webrtc" <% if(videoType === \'webrtc\') { %>checked<% } %> /> WebRTC\n    </label>\n</div>-->\n<div class="field">\n    <label class="radio">\n        <input type="radio" name="videoType" value="ivideon" <% if(videoType === \'ivideon\') { %>checked<% } %> /> IVideon\n    </label>\n</div>\n\n<div data-type="ritmrtp" class="<% if(videoType !== \'ritmrtp\') { %>hidden<% } %>"></div>\n<!--<div data-type="webrtc" class="<% if(videoType !== \'webrtc\') { %>hidden<% } %>"></div>-->\n<div data-type="ivideon" class="<% if(videoType !== \'ivideon\') { %>hidden<% } %>"></div>\n<div class="video-settings"></div>\n'}),define("abstracts/itemcard/views/VideoView",["jquery","jface","underscore","abstracts/View","./IvideonVideoView","./RitmVideoView","text!../tmpl/video.html"],function(t,e,i,n,s,o,a){var r=n.prototype;a=i.template(a);var l=n.extend({constructor:function(){this.controller=null,this.parent=null,this._children={},this._videoType="",n.apply(this,arguments)},initialize:function(t){this.controller=t.controller,this.parent=t.parent;var e=this.model.get("settings");this._videoType="videoType"in e?e.videoType:"webRtcUsed"in e?"true"===e.webRtcUsed?"webrtc":"ivideon":"ivlogin"in e?"ivideon":"ritmrtp","ritmrtp"!==this._videoType||App.hasMediaServerUrl()||(this._videoType="ivideon"),this.render(),c.bindEvents.call(this)},render:function(){this.$el.html(a(i.extend({},this.model.attributes,{i18n:this.controller.getTexts(),videoType:this._videoType}))),this.$el.trigger("videoTypeChange",this._videoType),c.renderChild.call(this,this._videoType)},remove:function(){c.removeChild.call(this),r.remove.apply(this,arguments)}}),c={bindEvents:function(){var t=this,e=this.$el;e.find('input[name="videoType"]').on("click",function(){if(this.checked){var e=this.value;t._videoType=e,t.$el.trigger("videoTypeChange",e),c.renderChild.call(t,e)}}),t.parent.on("remove",function(){t.parent.off("remove"),t.parent.off("addrow")}).on("addrow",function(e){t._videoType===e&&t._children.settings.addRow()})},renderChild:function(e){var i;c.removeChild.call(this),"ritmrtp"===e?i=o:"ivideon"===e&&(i=s),i?this._children.settings=new i({controller:this.controller,model:this.model,el:t("<div />").appendTo(this.$el.find(".video-settings"))}):console.error("Unknown videoType: "+e)},removeChild:function(){this._children.settings&&this._children.settings.remove()}};return l}),define("text!abstracts/itemcard/tmpl/changesHistory.html",[],function(){return'<div class="grid-container">\n    <div class="grid-content" style="overflow: hidden">\n        <table>\n            <thead>\n                <th>\n                    <div class="th">№</div>\n                </th><th>\n                    <div class="th"><%= i18n.date.ucFirst() %></div>\n                </th><th>\n                    <div class="th"><%= i18n.settingsField %></div>\n                </th><th>\n                    <div class="th"><%= i18n.settingOldValue %></div>\n                </th><th>\n                    <div class="th"><%= i18n.settingNewValue %></div>\n                </th><th>\n                    <div class="th"><%= i18n.user.ucFirst() %></div>\n                </th><th>\n                    <div class="th">IP</div>\n                </th>\n            </thead>\n            <tbody></tbody>\n        </table>\n    </div>\n</div>'}),define("abstracts/itemcard/views/ChangesHistoryView",["jquery","jqueryui","jface","underscore","abstracts/View","datatables","text!../tmpl/changesHistory.html","css!_libs/grids/DataTables/css/jquery.dataTables.cropped.css","colresize"],function(t,e,i,n,s,o,a){a=n.template(a);var r=s.extend({constructor:function(){this.controller=null,this.parent=null,this.isVisible=!0,this.$table=null,this._grid=null,this._data=[],this._names={},s.apply(this,arguments)},initialize:function(t){this.controller=t.controller,this.parent=t.parent,l.setNames.call(this),this.reload()},reload:function(){var t=this;l.load.call(t).done(function(e){l.prepareData.call(t,e),t.render(),l.bindEvents.call(t)}).fail(function(){})},render:function(){this.$el.html(a({i18n:this.controller.getTexts()})),this.$table=this.$el.find("table"),l.buildGrid.call(this)},formatValue:function(t,e){var i=e,n=this.controller.getTexts(),s=150;if("STATE"==t){var o=this.controller.getPossibleStates();i=o[e]||e}else"IS_FOLLOWED"===t||"USE_MANUAL_FILTERS"===t?i=1==e?n.switchedOnShort:n.switchedOffShort:"FILTER_MASK"==t?i=i.replace(/,/gi,", "):/^AN_TYPE\d$/.test(t)&&(i=n.fuelLevelSensor,1==e?i=n.flowSensorOnInput:-1==e&&(i=n.flowSensorOnOutput));return i.length>s&&(i=i.substr(0,s)+'<span class="full-value hidden">'+i.substr(s)+"</span>"+' <a href="#" class="more">...'+n.show+"</a>"),i}}),l={bindEvents:function(){var e=this;this.$table.DataTable().settings()[0],this.$el.on("hidden shown",function(){e.isVisible=-1!=e.el.className.indexOf("active"),e.isVisible&&l.adjustGridSize.call(e)}).on("click",".more",function(){return t(this).addClass("hidden").siblings(".full-value").removeClass("hidden"),!1}),this.listenTo(this.parent,"resize:stop",function(){l.adjustGridSize.call(e)})},setNames:function(){var t=this.controller.getTexts(),e=this.model.get("settings").ObjType==App.TYPE_MOBILE,i={name:t.objName,DESCRIPTION:t.comments.ucFirst(),VRC_OWNER:t.objOwner,PHONE1:t.phone.ucFirst()+" 1",PHONE2:t.phone.ucFirst()+" 2",OwnerPassword:t.objOwnerPass,ContractNumber:t.objContract,ContractDate:t.objContractDate,IMAGE_PATH:t.objImage,imei:"IMEI",SIM:t.simCard+" 1",SIM2:t.simCard+" 2",sim1Provider:t.gsmProvider+" 1",sim2Provider:t.gsmProvider+" 2",PASS:t.password.ucFirst(),InstallPlace:t.placeInstall,InstallDate:t.dateInstall,Installer:t.installer,ExtraHardware:t.objExtraHardware,status:t.objStatus,STATE:t.objState,Country:t.country,Region:t.region,City:t.city,Street:t.street,House:t.house,Building:t.building,GateCode:t.gateCode,IntercomCode:t.intercomCode,AppNumber:t.appartment,equipmentIds:t.objEquipmentIds,Lat:t.lat,Lon:t.lon,ivlogin:t.login.ucFirst()+" Ivideon",ivpassword:t.password.ucFirst()+" Ivideon",RESPONSIVE_PERSONS:t.responsible.header,pass1:t.responsible.pass1,pass2:t.responsible.pass2,deviceControlOuts:t.deviceOuts};e&&(n.extend(i,{CAR_ID:t.licenseNumber,MODEL:t.objModel.ucFirst(),VRC_TYPE:t.vehicleType,YEAR:t.objYear,VIN:"VIN",COLOR:t.color.ucFirst(),RouteNumber:t.objRouteNumber,IS_FOLLOWED:t.followedMode,TRACKED_DSENSOR_INDEX:t.indicateTrackedSensorState,AN_TYPE1:t.fuel.ucFirst()+". "+t.analogueSensor+" 1",AN_COEFF1:t.fuel.ucFirst()+". "+t.impulsesByLiter+" 1",FCONSUM_SUMMER1:t.fuelConsumptionNormForSummer+" 1,"+t.l100km,FCONSUMH_SUMMER1:t.fuelConsumptionNormForSummer+" 1, "+t.l1h,FCONSUM_WINTER1:t.fuelConsumptionNormForWinter+" 1, "+t.l100km,FCONSUMH_WINTER1:t.fuelConsumptionNormForWinter+" 1, "+t.l1h,AN_TYPE2:t.fuel.ucFirst()+". "+t.analogueSensor+" 2",AN_COEFF2:t.fuel.ucFirst()+". "+t.impulsesByLiter+" 2",FCONSUM_SUMMER2:t.fuelConsumptionNormForSummer+" 2,"+t.l100km,FCONSUMH_SUMMER2:t.fuelConsumptionNormForSummer+" 2, "+t.l1h,FCONSUM_WINTER2:t.fuelConsumptionNormForWinter+" 2, "+t.l100km,FCONSUMH_WINTER2:t.fuelConsumptionNormForWinter+" 2, "+t.l1h,TankVolume:t.tankVolume,MinFill:t.minFilling,MinPlum:t.minDischarge,SmoothMedianStep:t.stepOfMedianFilter,RemoveAcpOverflowMax:t.maxUsedSensorValues,RemoveAcpOverflowMin:t.minUsedSensorValues,OBJECT_MIN_SPEED:t.minObjectSpeed,OBJECT_MAX_SPEED:t.maxObjectSpeed,FILTER_MASK:t.filters,USE_MANUAL_FILTERS:t.useManualTrackFilters,OBJECT_MIN_PARK_TIME:t.detectParksIfContinueMoreThan,OBJECT_MIN_PARK_MERGE_TIME:t.detectMovementBetweenParksIfContinuesMoreThan,MAP_MATCHING_VEHICLE:t.gpsTrackMapMatchingLabel}),n.each([1,2,3,4,5,6],function(e){i["D"+e+"Name"]=t.discretSensor+" "+e+" ("+t.discret+")"}),n.each([1,2],function(e){i["AN_NAME"+e]=t.analogueSensor+" "+e+" ("+t.analogue+")",i["C"+e+"Name"]=t.deviceOut+" "+e})),this._names=i},load:function(){var e=this;return this.$el.addClass("loading"),t.ajax({url:App.getBaseUrl()+"objects/card-edits/",data:{objectId:this.model.id}}).always(function(){e.$el.removeClass("loading")})},prepareData:function(t){for(var e,i,s,o,a=this,r=[],c=this._names,h=0,d=/ \((([0-9]{1,3}\.){3}[0-9]{1,3})\)$/,u=0,p=t.length;p>u;++u)e=t[u],i=e.changes.new,s=e.changes.old||{},n.each(i,function(t,i){if("objType"!=i)if(i in s||(s[i]=null),o={user:e.user,time:e.ts,key:i,ip:""},d.test(o.user)&&(o.ip=d.exec(o.user)[1]||"",o.user=o.user.replace(d,"")),"RESPONSIVE_PERSONS"==i){var u=l.findRespPersonsChanges.call(a,t,s[i]);n.each(u,function(t){r.push(n.extend(o,{index:++h,setting:t.name,oldValue:t.oldValue,newValue:t.newValue}))})}else r.push(n.extend(o,{index:++h,setting:c[i]||i,oldValue:"null"!=String(s[i])?s[i]:"",newValue:"null"!=String(t)?t:""}))});this._data=r},findRespPersonsChanges:function(e,i){var s=[],o={pass1:"",pass2:"",persons:[]},a={o:o,n:o},r=this.controller.getTexts();if(e.length&&(a.n=t.parseJSON(e)),i.length&&(a.o=t.parseJSON(i)),JSON.stringify(a.o.persons)!=JSON.stringify(a.n.persons)){var l=[],c="";n.each([a.o.persons,a.n.persons],function(t,e){l[e]=[],n.each(t,function(t){c='"'+n.filter(n.values(t),function(t){return t.length>0}).join('", "')+'"',l[e].push(c)}),l[e]=l[e].join(";<br />")}),s.push({name:r.responsible.header,oldValue:l[0],newValue:l[1]})}return s},buildGrid:function(){var t=this,e=this.controller.getTexts(),i=this.$table,s={};s.data=this._data,s.columns=[{key:"index",data:"index",width:"4%",className:"text-center",orderable:!1,searchable:!1},{key:"time",type:"string",data:function(e,i){return"sort"==i?e.time:t.formatDateTime(e.time)},width:"12%",className:"time"},{key:"setting",data:"setting",width:"14%"},{key:"oldValue",data:function(e){return t.formatValue(e.key,e.oldValue)},width:"24%"},{key:"newValue",data:function(e){return t.formatValue(e.key,e.newValue)},width:"24%"},{key:"user",data:"user",width:"12%"},{key:"ip",data:"ip",width:"10%"}],n.extend(s,{order:[[1,"desc"]],paging:!1,info:!1,deferRender:!0,dom:"rt",scrollY:this.$el.find(".grid-content").height()-this.$el.find("thead").outerHeight(),scrollCollapse:!0,autoWidth:!0,language:{zeroRecords:e.tableNoRecords}}),this._grid=i.dataTable(s)},adjustGridSize:function(){this._grid&&this.isVisible&&(this._grid.fnSettings().oScroll.sY=l.getGridScrollHeight.call(this),this._grid.fnAdjustColumnSizing())},getGridScrollHeight:function(){return this.$el.find(".grid-content").height()-this.$el.find(".dataTables_scrollHead").outerHeight()-2}};return r}),define("_common/stat/Control",[],function(){var t={};return t.TYPE_OPEN_COLLECTOR=1,t.TYPE_RELAY=2,t.TYPE_RADIO_RELAY=3,t.TYPE_ADDRESS_RELAY=4,t.TYPE_1_WIRE=5,t.sortControls=function(t){return t.sort(function(t,e){return t.order<e.order?-1:t.order>e.order?1:0})},t}),define("text!abstracts/itemcard/tmpl/controlsEditable.html",[],function(){return'<table class="table table-condensed controls <% if (!hasControls) { %> hidden<% } %>">\n    <thead>\n    <tr>\n        <th><%= i18n.deviceOut %></th>\n        <th><%= i18n.deviceOutNumShort %></th>\n        <th><%= i18n.deviceOutName %></th>\n        <th><%= i18n.note %></th>\n        <th></th>\n        <th></th>\n        <th></th>\n    </tr>\n    </thead>\n    <tbody>\n    </tbody>\n</table>\n\n<p class="no-data<% if (hasControls) { %> hidden<% } %>">\n    <%= i18n.noDeviceOuts %>\n</p>'}),define("text!abstracts/itemcard/tmpl/controlRow.html",[],function(){return'<tr>\n    <td>\n        <input type="hidden" name="controlCanControl"\n               value="<%= control.canControl === null ? \'\' : control.canControl %>">\n\n        <input type="hidden" name="controlType"\n               value="<%= control.type || \'\'  %>">\n\n        <input type="hidden" name="controlTypeInner"\n               value="<%= control.typeInner || \'\'  %>">\n\n        <% if(!control.type) {%>\n\n        <select>\n            <% if(available.length > 1) {%>\n            <option value="0"><%= i18n.notSelected %></option>\n            <% } %>\n            <% _.each(available, function(ac) {%>\n            <option value="<%= ac.num %>">\n                <%= ac.name %>\n            </option>\n            <% }) %>\n        </select>\n\n        <% } else { %>\n\n        <div class="itext">\n            <input type="text" readonly value="<%- control.fullName %>">\n        </div>\n\n        <% } %>\n\n    </td>\n    <td class="col-num">\n        <div class="itext">\n            <input name="controlNum" type="text" value="<%- control.num || \'\' %>" readonly>\n        </div>\n    </td>\n    <td>\n        <div class="itext">\n            <input name="controlName" type="text" value="<%- control.name %>" maxlength="100">\n        </div>\n    </td>\n    <td>\n        <div class="itext">\n            <input name="controlComment" type="text" value="<%- control.comment %>" maxlength="100">\n        </div>\n    </td>\n    <td class="col-icon">\n        <i class="svg-icon svg-icon-chevron-up" data-sort="up"></i>\n    </td>\n    <td class="col-icon">\n        <i class="svg-icon svg-icon-chevron-down" data-sort="down"></i>\n    </td>\n    <td class="col-icon">\n        <i class="svg-icon svg-icon-remove control-row-remove"></i>\n    </td>\n</tr>'}),define("abstracts/itemcard/views/ControlsView",["jquery","jface","underscore","abstracts/View","_common/stat/Control","text!../tmpl/controlsEditable.html","text!../tmpl/controlRow.html"],function(t,e,i,n,s,o,a){o=i.template(o),a=i.template(a);var r=n.extend({constructor:function(){this.controller=null,this.parent=null,this.$table=null,this.$noData=null,this.$tbody=null,this._availableControls=null,this._xhr=null,this._controls=[],n.apply(this,arguments)},initialize:function(t){this.controller=t.controller,this.parent=t.parent,this.render(),l.bindEvents.call(this)},render:function(){var t=this.getStoredControls();this.$el.html(o({i18n:this.controller.getTexts(),hasControls:t.length>0})),this.$table=this.$el.find("table"),this.$noData=this.$el.find(".no-data"),this.$tbody=this.$el.find("tbody"),t.length&&l.renderRows.call(this,t)},getStoredControls:function(){var t=this.model.get("settings").deviceControlOuts;return t?JSON.parse(t):[]},addSerializedData:function(t){if(l.validateRows.call(this),this.$tbody.find(".error").length)delete t.deviceControlOuts,t.errors=[{msg:this.controller.getTexts().errorInvalidDeviceOuts}];else{var e=l.serialize.call(this);t.deviceControlOuts=JSON.stringify(e)}return["controlNum","controlType","controlTypeInner","controlCanControl","controlName","controlComment"].forEach(function(e){delete t[e]}),t},getControlFullName:function(t){var e=t.type,i=this.controller.getTexts(),n={},o=1===t.canControl?" ("+i.deviceOutControlManual+")":" ("+i.deviceOutControlAuto+")";return n[s.TYPE_OPEN_COLLECTOR]=i.deviceOutTypeOpenCollector,n[s.TYPE_RELAY]=i.deviceOutTypeRelay,n[s.TYPE_RADIO_RELAY]=i.deviceOutTypeRadioRelay,n[s.TYPE_ADDRESS_RELAY]=i.deviceOutTypeAddressRelay,n[s.TYPE_1_WIRE]=i.deviceOutType1Wire,e in n?n[e]+" "+t.typeInner+o:""}}),l={renderRows:function(t){var e="",n=this.$tbody,o=this.controller.getTexts();t=s.sortControls(t),i.each(t,function(t){t.fullName=this.getControlFullName(t),e+=a({control:t,i18n:o})}.bind(this)),n.html(e),l.initRows.call(this,n.find("tr"))},bindEvents:function(){var e=this,i=this.$tbody;this.parent.on("addrow",function(t){"control"===t&&l.add.call(e)}),i.on("click",".control-row-remove",function(){l.onRowRemove.call(e,this)}).on("click","i[data-sort]",function(){var e=t(this),n=e.data("sort"),s=i.find("tr"),o=e.closest("tr"),a=s.index(o);("up"===n&&a>0||"down"===n&&a<s.length-1)&&("up"===n?o.insertBefore(o.prev()):o.insertAfter(o.next()))})},add:function(){var e=this.$tbody,i=e.find("tr").length;l.loadAvailable.call(this,this.model.id).done(function(){var n=this.controller.getTexts();if(this._availableControls.length)if(i<this._availableControls.length){var s=e.find('input[name="controlNum"]'),o=this._availableControls.filter(function(t){return!s.filter("[value="+t.num+"]").length});i||(this.$table.removeClass("hidden"),this.$noData.addClass("hidden"));var r=t(a({control:{num:1===o.length?o[0].num:0,type:0,canControl:null,name:"",comment:""},available:o,i18n:this.controller.getTexts()})).appendTo(e);l.initRows.call(this,r)}else alert(n.deviceControlOutsAllAdded,n.attention);else alert(n.deviceControlOutsNoAvailable,n.attention)}.bind(this))},onRowRemove:function(t){this.parent._onRowRemove(t),l.validateRows.call(this)},loadAvailable:function(e){if(null===this._availableControls){var i=this,n=this.$el;return n.addClass("loading"),t.ajax({url:App.getBaseUrl()+"objects/out-attr/",data:{objectId:e},timeout:12e4}).done(function(t){var e,n=[];for(var s in t)e=t[s],Object.assign(e,{num:parseInt(s),typeInner:e.inner}),Object.assign(e,{name:i.getControlFullName(e)}),n.push(e);this._availableControls=n.sort(function(t,e){var i,n;return t.type===e.type?(i=t.inner,n=e.inner):(i=t.type,n=e.type),n>i?-1:i>n?1:0})}.bind(this)).fail(function(t){this.showErrors(t)}.bind(this)).always(function(){n.removeClass("loading")})}return(new t.Deferred).resolve()},initRows:function(e){var i=this;e.find("select").on("change",function(){var e=t(this),n=e.closest("tr"),s="",o="",a="",r="";if("0"!==this.value){r=parseInt(this.value);var l=i._availableControls.find(function(t){return t.num===r});o=l.type,a=l.inner,s=l.canControl}n.find('input[name="controlNum"]').val(r),n.find('input[name="controlType"]').val(o),n.find('input[name="controlTypeInner"]').val(a),n.find('input[name="controlCanControl"]').val(s)}),e.find('select, input[name="controlName"]').on("change",function(){l.validateRows.call(i)})},validateRows:function(){var e={},n=this.$tbody.find("tr");this.$tbody.find(".error").removeClass("error"),n.each(function(){var i=t(this),n=i.find('input[name="controlNum"]'),s=i.find('input[name="controlName"]'),o=parseInt(n.val()),a=String(s.val()).trim();isNaN(o)&&(o=0),e[o]=e[o]||[],e[o].push(n),a.length||s.parent().addClass("error")}),i.each(e,function(t,e){e=parseInt(e),(0===e||isNaN(e)||t.length>1)&&t.forEach(function(t){t.parent().addClass("error")})})},serialize:function(){var e=[],i=this.$tbody.find("tr");return i.each(function(){var n=t(this),s={},o=parseInt(n.find('input[name="controlNum"]').val());isNaN(o)||0>=o||(s.num=parseInt(n.find('input[name="controlNum"]').val()),s.type=parseInt(n.find('input[name="controlType"]').val()),s.typeInner=parseInt(n.find('input[name="controlTypeInner"]').val()),s.canControl=parseInt(n.find('input[name="controlCanControl"]').val()),s.order=i.index(n),s.name=n.find('input[name="controlName"]').val().trim(),s.comment=n.find('input[name="controlComment"]').val().trim(),e.push(s))}),e}};return r}),define("text!abstracts/itemcard/tmpl/icons.html",[],function(){return'<ul>\n<% _.each(totalBySprites, function(num, key){ %>\n<% for(var i = 0; i < num; ++i){ %>\n    <li data-index="<%= i %>" data-key="<%= key %>"\n    <% if(isActive(i, key)) {%> class="active" <% } %> style="background:<%= getBgr(i, key) %>"></li>\n<% }}) %>\n</ul>'}),define("text!abstracts/itemcard/tmpl/pictureForm.html",[],function(){return'<form class="card-extra-action picture-form form-horizontal" method="post" action="<%= App.getBaseUrl() %>pictures/upload/" enctype="multipart/form-data">\n    <span>JPG, PNG <%= i18n.upto %> 1Mb</span>\n    <div class="file-upload-input">\n\n        <a data-placeholder="<%= i18n.chooseFile %>..." class="btn btn-file text-left" style="padding-left:10px">\n            <%= i18n.chooseFile %>...\n        </a>\n        <input class="file-upload" type="file" name="file" accept="image/gif|image/jpeg|image/pjpeg|image/png">\n        <input type="hidden" name="objectId" value="<%= objectId %>">\n\n    </div>\n    <input placeholder="<%= i18n.enterComment %>" type="text" name="caption" />\n    <button type="submit" class="btn btn-primary"><%= i18n.upload.ucFirst() %></button>\n    <a class="btn btn-cancel"><%= i18n.cancel %></a>\n\n</form>'}),define("text!abstracts/itemcard/tmpl/status.html",[],function(){return'<% if(App.allowed(\'objects.status.edit\')) {%>\n    <div class="field no-label">\n        <div class="select">\n            <select name="objStatus"<% if(!App.allowed(\'objects.status.edit\')) {%> disabled<% } %>>\n            <% _.each(statuses, function(status, id){%>\n            <option value="<%= id %>"<% if(id == selected) {%> selected<% } %>><%= status %></option>\n            <% }) %>\n            </select>\n        </div>\n    </div>\n    <div class="tech-staff hidden"></div>\n<% } else { %>\n    <div class="text-center"><strong>\n    <% _.each(statuses, function(status, id) {\n        if(id == selected) { print(status) }\n    }) %>\n    </strong></div>\n<% } %>\n'}),define("text!abstracts/itemcard/tmpl/addNewPerson.html",[],function(){return'<tr class="AddNewPersonRow" data-index="<%= index %>">\n    <td class="col-num">\n        <div class="itext"><input class="_key text-center" name="_key" type="text" value="" maxlength="20"></div>\n    </td>\n    <td><div class="itext"><input class="_name" name="_name" type="text" value="" maxlength="70"></div></td>\n    <td><div class="itext"><input class="_phone1" name="_phone1" type="text" value="" maxlength="17"></div></td>\n    <td><div class="itext"><input class="_phone2" name="_phone2" type="text" value="" maxlength="17"></div></td>\n    <td><div class="itext"><input class="_comment" name="_comment" type="text" value="" maxlength="95"></div></td>\n    <td class="col-icon">\n        <i class="svg-icon svg-icon-chevron-up personUp"></i>\n    </td>\n    <td class="col-icon">\n        <i class="svg-icon svg-icon-chevron-down personDown"></i>\n    </td>\n    <td class="col-icon">\n        <i class="svg-icon svg-icon-remove personRemove"></i>\n    </td>\n</tr>\n'}),define("text!abstracts/itemcard/tmpl/techSelect.html",[],function(){return'<div class="field no-label">\n    <div class="select obj-status-period">\n        <select name="servicePeriod">\n            <option value="-1"><%= i18n.setServiceStatusNoLimit %></option>\n            <% _.each(periods, function(p){%>\n            <option value="<%= p.value %>"><%= p.label %></option>\n            <% }) %>\n            <option value="0"><%= i18n.setServiceStatusTillDate %></option>\n        </select>\n    </div>\n</div>\n<div class="field field-date no-label hidden">\n    <div class="itext itext-date">\n        <input type="text" name="serviceDate">\n    </div>\n    <div class="itext itext-time">\n        <input type="text" name="serviceTime">\n    </div>\n</div>\n<div class="field field-tech no-label hidden">\n    <div class="select">\n        <select name="techId">\n            <option value="0"><%= i18n.technicianNotSelected %></option>\n            <% _.each(technicians, function(p){%>\n            <option value="<%= p.id %>"><%= p.fullname %></option>\n            <% }) %>\n        </select>\n    </div>\n</div>\n\n'}),define("text!abstracts/itemcard/tmpl/tech.html",[],function(){return'<div class="field no-margin">\n    <label class="width-auto"><%= i18n.technician %></label>\n    <strong><%= technician.fullname %></strong>\n</div><div class="field no-margin">\n    <label class="width-auto"><%= i18n.fromDate %></label>\n    <strong><%= from %></strong>\n</div><div class="field no-margin">\n    <label class="width-auto"><%= i18n.till %></label>\n    <strong><%= to %></strong>\n</div>'}),function(t){"function"==typeof define&&define.amd?define("_libs/jquery/jquery.form",["jquery"],t):t("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(t){function e(e){var i=e.data;e.isDefaultPrevented()||(e.preventDefault(),t(e.target).ajaxSubmit(i))}function i(e){var i=e.target,n=t(i);if(!n.is("[type=submit],[type=image]")){var s=n.closest("[type=submit]");if(0===s.length)return;i=s[0]}var o=this;if(o.clk=i,"image"==i.type)if(void 0!==e.offsetX)o.clk_x=e.offsetX,o.clk_y=e.offsetY;else if("function"==typeof t.fn.offset){var a=n.offset();o.clk_x=e.pageX-a.left,o.clk_y=e.pageY-a.top}else o.clk_x=e.pageX-i.offsetLeft,o.clk_y=e.pageY-i.offsetTop;setTimeout(function(){o.clk=o.clk_x=o.clk_y=null},100)}function n(){if(t.fn.ajaxSubmit.debug){var e="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(e):window.opera&&window.opera.postError&&window.opera.postError(e)}}var s={};s.fileapi=void 0!==t("<input type='file'/>").get(0).files,s.formdata=void 0!==window.FormData;var o=!!t.fn.prop;t.fn.attr2=function(){if(!o)return this.attr.apply(this,arguments);var t=this.prop.apply(this,arguments);return t&&t.jquery||"string"==typeof t?t:this.attr.apply(this,arguments)},t.fn.ajaxSubmit=function(e){function i(i){var n,s,o=t.param(i,e.traditional).split("&"),a=o.length,r=[];for(n=0;a>n;n++)o[n]=o[n].replace(/\+/g," "),s=o[n].split("="),r.push([decodeURIComponent(s[0]),decodeURIComponent(s[1])]);return r}function a(n){for(var s=new FormData,o=0;o<n.length;o++)s.append(n[o].name,n[o].value);
if(e.extraData){var a=i(e.extraData);for(o=0;o<a.length;o++)a[o]&&s.append(a[o][0],a[o][1])}e.data=null;var r=t.extend(!0,{},t.ajaxSettings,e,{contentType:!1,processData:!1,cache:!1,type:l||"POST"});e.uploadProgress&&(r.xhr=function(){var i=t.ajaxSettings.xhr();return i.upload&&i.upload.addEventListener("progress",function(t){var i=0,n=t.loaded||t.position,s=t.total;t.lengthComputable&&(i=Math.ceil(100*(n/s))),e.uploadProgress(t,n,s,i)},!1),i}),r.data=null;var c=r.beforeSend;return r.beforeSend=function(t,i){i.data=e.formData?e.formData:s,c&&c.call(this,t,i)},t.ajax(r)}function r(i){function s(t){var e=null;try{t.contentWindow&&(e=t.contentWindow.document)}catch(i){n("cannot get iframe.contentWindow document: "+i)}if(e)return e;try{e=t.contentDocument?t.contentDocument:t.document}catch(i){n("cannot get iframe.contentDocument: "+i),e=t.document}return e}function a(){function e(){try{var t=s(v).readyState;n("state = "+t),t&&"uninitialized"==t.toLowerCase()&&setTimeout(e,50)}catch(i){n("Server abort: ",i," (",i.name,")"),r(A),x&&clearTimeout(x),x=void 0}}var i=d.attr2("target"),o=d.attr2("action"),a="multipart/form-data",c=d.attr("enctype")||d.attr("encoding")||a;C.setAttribute("target",m),(!l||/post/i.test(l))&&C.setAttribute("method","POST"),o!=u.url&&C.setAttribute("action",u.url),u.skipEncodingOverride||l&&!/post/i.test(l)||d.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),u.timeout&&(x=setTimeout(function(){w=!0,r(T)},u.timeout));var h=[];try{if(u.extraData)for(var p in u.extraData)u.extraData.hasOwnProperty(p)&&(t.isPlainObject(u.extraData[p])&&u.extraData[p].hasOwnProperty("name")&&u.extraData[p].hasOwnProperty("value")?h.push(t('<input type="hidden" name="'+u.extraData[p].name+'">').val(u.extraData[p].value).appendTo(C)[0]):h.push(t('<input type="hidden" name="'+p+'">').val(u.extraData[p]).appendTo(C)[0]));u.iframeTarget||g.appendTo("body"),v.attachEvent?v.attachEvent("onload",r):v.addEventListener("load",r,!1),setTimeout(e,15);try{C.submit()}catch(f){var _=document.createElement("form").submit;_.apply(C)}}finally{C.setAttribute("action",o),C.setAttribute("enctype",c),i?C.setAttribute("target",i):d.removeAttr("target"),t(h).remove()}}function r(e){if(!_.aborted&&!I){if(D=s(v),D||(n("cannot access response document"),e=A),e===T&&_)return _.abort("timeout"),S.reject(_,"timeout"),void 0;if(e==A&&_)return _.abort("server abort"),S.reject(_,"error","server abort"),void 0;if(D&&D.location.href!=u.iframeSrc||w){v.detachEvent?v.detachEvent("onload",r):v.removeEventListener("load",r,!1);var i,o="success";try{if(w)throw"timeout";var a="xml"==u.dataType||D.XMLDocument||t.isXMLDoc(D);if(n("isXml="+a),!a&&window.opera&&(null===D.body||!D.body.innerHTML)&&--P)return n("requeing onLoad callback, DOM not available"),setTimeout(r,250),void 0;var l=D.body?D.body:D.documentElement;_.responseText=l?l.innerHTML:null,_.responseXML=D.XMLDocument?D.XMLDocument:D,a&&(u.dataType="xml"),_.getResponseHeader=function(t){var e={"content-type":u.dataType};return e[t.toLowerCase()]},l&&(_.status=Number(l.getAttribute("status"))||_.status,_.statusText=l.getAttribute("statusText")||_.statusText);var c=(u.dataType||"").toLowerCase(),h=/(json|script|text)/.test(c);if(h||u.textarea){var d=D.getElementsByTagName("textarea")[0];if(d)_.responseText=d.value,_.status=Number(d.getAttribute("status"))||_.status,_.statusText=d.getAttribute("statusText")||_.statusText;else if(h){var m=D.getElementsByTagName("pre")[0],f=D.getElementsByTagName("body")[0];m?_.responseText=m.textContent?m.textContent:m.innerText:f&&(_.responseText=f.textContent?f.textContent:f.innerText)}}else"xml"==c&&!_.responseXML&&_.responseText&&(_.responseXML=R(_.responseText));try{k=O(_,c,u)}catch(b){o="parsererror",_.error=i=b||o}}catch(b){n("error caught: ",b),o="error",_.error=i=b||o}_.aborted&&(n("upload aborted"),o=null),_.status&&(o=_.status>=200&&_.status<300||304===_.status?"success":"error"),"success"===o?(u.success&&u.success.call(u.context,k,"success",_),S.resolve(_.responseText,"success",_),p&&t.event.trigger("ajaxSuccess",[_,u])):o&&(void 0===i&&(i=_.statusText),u.error&&u.error.call(u.context,_,o,i),S.reject(_,"error",i),p&&t.event.trigger("ajaxError",[_,u,i])),p&&t.event.trigger("ajaxComplete",[_,u]),p&&!--t.active&&t.event.trigger("ajaxStop"),u.complete&&u.complete.call(u.context,_,o),I=!0,u.timeout&&clearTimeout(x),setTimeout(function(){u.iframeTarget?g.attr("src",u.iframeSrc):g.remove(),_.responseXML=null},100)}}}var c,h,u,p,m,g,v,_,b,y,w,x,C=d[0],S=t.Deferred();if(S.abort=function(t){_.abort(t)},i)for(h=0;h<f.length;h++)c=t(f[h]),o?c.prop("disabled",!1):c.removeAttr("disabled");if(u=t.extend(!0,{},t.ajaxSettings,e),u.context=u.context||u,m="jqFormIO"+(new Date).getTime(),u.iframeTarget?(g=t(u.iframeTarget),y=g.attr2("name"),y?m=y:g.attr2("name",m)):(g=t('<iframe name="'+m+'" src="'+u.iframeSrc+'" />'),g.css({position:"absolute",top:"-1000px",left:"-1000px"})),v=g[0],_={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(e){var i="timeout"===e?"timeout":"aborted";n("aborting upload... "+i),this.aborted=1;try{v.contentWindow.document.execCommand&&v.contentWindow.document.execCommand("Stop")}catch(s){}g.attr("src",u.iframeSrc),_.error=i,u.error&&u.error.call(u.context,_,i,e),p&&t.event.trigger("ajaxError",[_,u,i]),u.complete&&u.complete.call(u.context,_,i)}},p=u.global,p&&0===t.active++&&t.event.trigger("ajaxStart"),p&&t.event.trigger("ajaxSend",[_,u]),u.beforeSend&&u.beforeSend.call(u.context,_,u)===!1)return u.global&&t.active--,S.reject(),S;if(_.aborted)return S.reject(),S;b=C.clk,b&&(y=b.name,y&&!b.disabled&&(u.extraData=u.extraData||{},u.extraData[y]=b.value,"image"==b.type&&(u.extraData[y+".x"]=C.clk_x,u.extraData[y+".y"]=C.clk_y)));var T=1,A=2,L=t("meta[name=csrf-token]").attr("content"),M=t("meta[name=csrf-param]").attr("content");M&&L&&(u.extraData=u.extraData||{},u.extraData[M]=L),u.forceSync?a():setTimeout(a,10);var k,D,I,P=50,R=t.parseXML||function(t,e){return window.ActiveXObject?(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t)):e=(new DOMParser).parseFromString(t,"text/xml"),e&&e.documentElement&&"parsererror"!=e.documentElement.nodeName?e:null},E=t.parseJSON||function(t){return window.eval("("+t+")")},O=function(e,i,n){var s=e.getResponseHeader("content-type")||"",o="xml"===i||!i&&s.indexOf("xml")>=0,a=o?e.responseXML:e.responseText;return o&&"parsererror"===a.documentElement.nodeName&&t.error&&t.error("parsererror"),n&&n.dataFilter&&(a=n.dataFilter(a,i)),"string"==typeof a&&("json"===i||!i&&s.indexOf("json")>=0?a=E(a):("script"===i||!i&&s.indexOf("javascript")>=0)&&t.globalEval(a)),a};return S}if(!this.length)return n("ajaxSubmit: skipping submit process - no element selected"),this;var l,c,h,d=this;"function"==typeof e?e={success:e}:void 0===e&&(e={}),l=e.type||this.attr2("method"),c=e.url||this.attr2("action"),h="string"==typeof c?t.trim(c):"",h=h||window.location.href||"",h&&(h=(h.match(/^([^#]+)/)||[])[1]),e=t.extend(!0,{url:h,success:t.ajaxSettings.success,type:l||t.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},e);var u={};if(this.trigger("form-pre-serialize",[this,e,u]),u.veto)return n("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(e.beforeSerialize&&e.beforeSerialize(this,e)===!1)return n("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var p=e.traditional;void 0===p&&(p=t.ajaxSettings.traditional);var m,f=[],g=this.formToArray(e.semantic,f);if(e.data&&(e.extraData=e.data,m=t.param(e.data,p)),e.beforeSubmit&&e.beforeSubmit(g,this,e)===!1)return n("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[g,this,e,u]),u.veto)return n("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var v=t.param(g,p);m&&(v=v?v+"&"+m:m),"GET"==e.type.toUpperCase()?(e.url+=(e.url.indexOf("?")>=0?"&":"?")+v,e.data=null):e.data=v;var _=[];if(e.resetForm&&_.push(function(){d.resetForm()}),e.clearForm&&_.push(function(){d.clearForm(e.includeHidden)}),!e.dataType&&e.target){var b=e.success||function(){};_.push(function(i){var n=e.replaceTarget?"replaceWith":"html";t(e.target)[n](i).each(b,arguments)})}else e.success&&_.push(e.success);if(e.success=function(t,i,n){for(var s=e.context||this,o=0,a=_.length;a>o;o++)_[o].apply(s,[t,i,n||d,d])},e.error){var y=e.error;e.error=function(t,i,n){var s=e.context||this;y.apply(s,[t,i,n,d])}}if(e.complete){var w=e.complete;e.complete=function(t,i){var n=e.context||this;w.apply(n,[t,i,d])}}var x=t("input[type=file]:enabled",this).filter(function(){return""!==t(this).val()}),C=x.length>0,S="multipart/form-data",T=d.attr("enctype")==S||d.attr("encoding")==S,A=s.fileapi&&s.formdata;n("fileAPI :"+A);var L,M=(C||T)&&!A;e.iframe!==!1&&(e.iframe||M)?e.closeKeepAlive?t.get(e.closeKeepAlive,function(){L=r(g)}):L=r(g):L=(C||T)&&A?a(g):t.ajax(e),d.removeData("jqxhr").data("jqxhr",L);for(var k=0;k<f.length;k++)f[k]=null;return this.trigger("form-submit-notify",[this,e]),this},t.fn.ajaxForm=function(s){if(s=s||{},s.delegation=s.delegation&&t.isFunction(t.fn.on),!s.delegation&&0===this.length){var o={s:this.selector,c:this.context};return!t.isReady&&o.s?(n("DOM not ready, queuing ajaxForm"),t(function(){t(o.s,o.c).ajaxForm(s)}),this):(n("terminating; zero elements found by selector"+(t.isReady?"":" (DOM not ready)")),this)}return s.delegation?(t(document).off("submit.form-plugin",this.selector,e).off("click.form-plugin",this.selector,i).on("submit.form-plugin",this.selector,s,e).on("click.form-plugin",this.selector,s,i),this):this.ajaxFormUnbind().bind("submit.form-plugin",s,e).bind("click.form-plugin",s,i)},t.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},t.fn.formToArray=function(e,i){var n=[];if(0===this.length)return n;var o,a=this[0],r=this.attr("id"),l=e?a.getElementsByTagName("*"):a.elements;if(l&&!/MSIE [678]/.test(navigator.userAgent)&&(l=t(l).get()),r&&(o=t(":input[form="+r+"]").get(),o.length&&(l=(l||[]).concat(o))),!l||!l.length)return n;var c,h,d,u,p,m,f;for(c=0,m=l.length;m>c;c++)if(p=l[c],d=p.name,d&&!p.disabled)if(e&&a.clk&&"image"==p.type)a.clk==p&&(n.push({name:d,value:t(p).val(),type:p.type}),n.push({name:d+".x",value:a.clk_x},{name:d+".y",value:a.clk_y}));else if(u=t.fieldValue(p,!0),u&&u.constructor==Array)for(i&&i.push(p),h=0,f=u.length;f>h;h++)n.push({name:d,value:u[h]});else if(s.fileapi&&"file"==p.type){i&&i.push(p);var g=p.files;if(g.length)for(h=0;h<g.length;h++)n.push({name:d,value:g[h],type:p.type});else n.push({name:d,value:"",type:p.type})}else null!==u&&"undefined"!=typeof u&&(i&&i.push(p),n.push({name:d,value:u,type:p.type,required:p.required}));if(!e&&a.clk){var v=t(a.clk),_=v[0];d=_.name,d&&!_.disabled&&"image"==_.type&&(n.push({name:d,value:v.val()}),n.push({name:d+".x",value:a.clk_x},{name:d+".y",value:a.clk_y}))}return n},t.fn.formSerialize=function(e){return t.param(this.formToArray(e))},t.fn.fieldSerialize=function(e){var i=[];return this.each(function(){var n=this.name;if(n){var s=t.fieldValue(this,e);if(s&&s.constructor==Array)for(var o=0,a=s.length;a>o;o++)i.push({name:n,value:s[o]});else null!==s&&"undefined"!=typeof s&&i.push({name:this.name,value:s})}}),t.param(i)},t.fn.fieldValue=function(e){for(var i=[],n=0,s=this.length;s>n;n++){var o=this[n],a=t.fieldValue(o,e);null===a||"undefined"==typeof a||a.constructor==Array&&!a.length||(a.constructor==Array?t.merge(i,a):i.push(a))}return i},t.fieldValue=function(e,i){var n=e.name,s=e.type,o=e.tagName.toLowerCase();if(void 0===i&&(i=!0),i&&(!n||e.disabled||"reset"==s||"button"==s||("checkbox"==s||"radio"==s)&&!e.checked||("submit"==s||"image"==s)&&e.form&&e.form.clk!=e||"select"==o&&-1==e.selectedIndex))return null;if("select"==o){var a=e.selectedIndex;if(0>a)return null;for(var r=[],l=e.options,c="select-one"==s,h=c?a+1:l.length,d=c?a:0;h>d;d++){var u=l[d];if(u.selected){var p=u.value;if(p||(p=u.attributes&&u.attributes.value&&!u.attributes.value.specified?u.text:u.value),c)return p;r.push(p)}}return r}return t(e).val()},t.fn.clearForm=function(e){return this.each(function(){t("input,select,textarea",this).clearFields(e)})},t.fn.clearFields=t.fn.clearInputs=function(e){var i=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var n=this.type,s=this.tagName.toLowerCase();i.test(n)||"textarea"==s?this.value="":"checkbox"==n||"radio"==n?this.checked=!1:"select"==s?this.selectedIndex=-1:"file"==n?/MSIE/.test(navigator.userAgent)?t(this).replaceWith(t(this).clone(!0)):t(this).val(""):e&&(e===!0&&/hidden/.test(n)||"string"==typeof e&&t(this).is(e))&&(this.value="")})},t.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},t.fn.enable=function(t){return void 0===t&&(t=!0),this.each(function(){this.disabled=!t})},t.fn.selected=function(e){return void 0===e&&(e=!0),this.each(function(){var i=this.type;if("checkbox"==i||"radio"==i)this.checked=e;else if("option"==this.tagName.toLowerCase()){var n=t(this).parent("select");e&&n[0]&&"select-one"==n[0].type&&n.find("option").selected(!1),this.selected=e}})},t.fn.ajaxSubmit.debug=!1}),define("abstracts/itemcard/views/ItemCardView",["jquery","underscore","jqueryui","jface","abstracts/View","abstracts/GrObject","_common/pictures/PicturesModule","./ExportView","./ImportView","./CopySettingsView","./NotificationsView","./ItemCardAlertControlView","./VideoView","./ChangesHistoryView","./ControlsView","text!_common/tmpl/modelTag.html","text!../tmpl/icons.html","text!../tmpl/pictureForm.html","text!../tmpl/status.html","text!../tmpl/addNewPerson.html","text!../tmpl/techSelect.html","text!../tmpl/tech.html","_libs/jquery/jquery.form","css!../css/card.css"],function(t,e,i,n,s,o,a,r,l,c,h,d,u,p,m,f,g,v,_,b,y,w){g=e.template(g),f=e.template(f),v=e.template(v),_=e.template(_),b=e.template(b),y=e.template(y),w=e.template(w);var x=6,C={V1:"voyager2",V2:"voyager2",V3:"voyager3",V3P:"V3P",V4:"voyager4",VL:"voyagerlight",VLN:"VLN",VL1N:"VLN",VL2N:"VLN",VL3N:"VLN",VC:"voyager2",V2N:"voyager2n",V3N:"voyager4n",V4N:"voyager4n",V5N:"V5N",V15N:"voyager15",V2T:"V2-T",V2TN:"V2-T",V6N:"V6-N",K1:"K1",K2:"K2",K5:"kontakt5",K52:"kontakt5",K9:"K9",K95:"K9",K10:"K9",K10A:"K10A",KL:"KL",KLAN:"KL",KL11:"K9",K14:"kontakt14",K14W:"kontakt14",K15:"voyager15",K16:"K16",K5RT1:"K5RT1",K5RT2:"K5RT2",K5RT3:"K5RT3",VMN:"android",Unknown:"unknown"},S=null,T={};T[App.TYPE_MOBILE]={},T[App.TYPE_STAT]={};var A={initPictureUpload:function(){if(!this._pictureForm){var e=this,i=this.module.getTexts();this._pictureForm=t(v({objectId:this.model.get("item").id,i18n:i})).appendTo(this.$el);var n=this._pictureForm,s=n.find(".file-upload");n.ajaxForm({beforeSend:function(t){t.setRequestHeader("Authorization","Basic "+App.getBasic())},beforeSubmit:function(){return e.uploading?!1:0==s.length||0==s.get(0).files.length?(alert(e.module.getTexts().pleaseSelectFile),!1):(e.uploading=!0,n.addClass("loading"),void 0)},success:function(t){e._pictureForm.remove(),e._pictureForm=null,e._picturesModule.addPicture(t)},error:function(){var t=e.module.getTexts();alert(t.uploadFailed,t.error)},complete:function(){n.removeClass("loading"),e.uploading=!1}})}},initCarousel:function(){var t=this.$el.find(".pictures-section");this._picturesModule=new a({objectId:this.model.id,container:t,editCaption:!0}),t.data("init",!0)},onPictureDelete:function(){var t=this,e=this.$el.find(".carousel-inner .active");if(e.length){var i=this.module.getTexts();n.confirm(i.confirmDeletePicture,{okCallback:function(){var e=t._picturesModule,i=e.getList()[e.get("current")].id;e.deletePicture(i)}})}},onFileChange:function(){var t=this.$el.find("[name=file]"),e=t[0].files,i=t.prevAll(".btn-file");if(e&&e.length)if(e[0].size>1048576){var n=this.module.getTexts();alert(n.errorFileSize.replace("#s#","1Mb"),n.error),t[0].value=null}else i.text(e[0].name);else i.text(this.module.getTexts().chooseFile+"...")},onClickPersonAdd:function(){var t=this.$el.find("table.persons"),e=t.find(".AddNewPersonRow").length,i=this.module.getTexts(),n=999;if(e||(t.removeClass("hidden"),t.siblings(".no-data").addClass("hidden")),t.length&&n>e){var s=b({i18n:i,index:e});t.append(s)}},onClickPersonUp:function(i){var n=this.$el.find("table.persons"),s=n.find(".AddNewPersonRow"),o=t(i).parent().parent(),a=s.length;if(s.length&&a>0){var r=o.prev(),l=[];r.hasClass("AddNewPersonRow")&&(e.each(s,function(e){var i=t(e),n=i.attr("data-index");n==r.attr("data-index")?l.push(o.clone()):n==o.attr("data-index")?l.push(r.clone()):l.push(i.clone()),i.remove()}),e.each(l,function(t){n.append(t)}))}},onClickPersonDown:function(i){var n=this.$el.find("table.persons"),s=n.find(".AddNewPersonRow"),o=t(i).parent().parent(),a=s.length;if(s.length&&a>0){var r=o.next(),l=[];r.length&&(e.each(s,function(e){var i=t(e),n=i.attr("data-index");n==o.attr("data-index")?l.push(r.clone()):n==r.attr("data-index")?l.push(o.clone()):l.push(i.clone()),i.remove()}),e.each(l,function(t){n.append(t)}))}},onClickPersonRemove:function(e){var i=this.$el.find("table.persons"),n=t(e).parent().parent(),s=i.find(".AddNewPersonRow").length;n.length&&s>0&&(n.remove(),s--),0>=s&&(i.addClass("hidden"),this.$el.find(".no-data").removeClass("hidden"))},loadTechnicians:function(){if(this._technicians)return(new t.Deferred).resolve(this._technicians);var e=this;return App.getTechnicians().done(function(t){e._technicians=A.sortAndFormatTechnicians.call(e,t)})},sortAndFormatTechnicians:function(t){var i=this;return e.each(t,function(t){t.fullname=i.buildFullName(t)}),e.sortBy(t,function(t){return t.fullname})}},L=s.extend({constructor:function(){this.module=null,this.loading=!1,this._searchCache={},this._pictureForm=null,this._picturesModule=null,this._copySettingsView=null,this._exportView=null,this._importView=null,this._notificationsView=null,this._videoView=null,this._temperatureView=null,this._historyView=null,this._controlsView=null,this._confirmedImei=!1,this._fieldsCache={},this._autocompleteXhr=null,this._autocompleteRequestId=0,this._technicians=null,s.apply(this,arguments)},initialize:function(t){this.module=t.module,this.render(),this._bindEvents()},render:function(){},remove:function(){this.off(),s.prototype.remove.apply(this,arguments)},buildFullName:function(t){var i=this.module.getTexts(),n=i.namesOrder,s=[];return e.each(n,function(e){e in t&&t[e].length&&s.push(t[e])}),e.escape(s.join(" "))},_removeExportImportView:function(){this._removeExportView(),this._removeImportView()},_removeExportView:function(){this._exportView&&(this._exportView.remove(),this._exportView=null)},_removeImportView:function(){this._importView&&(this._importView.remove(),this._importView=null)},_removeCopySettingsView:function(){this._copySettingsView&&(this._copySettingsView.remove(),this._copySettingsView=null)},_bindEvents:function(){var i=this;this.$el.on("click",".add-picture",e.bind(A.initPictureUpload,this)).on("click",".delete-picture",e.bind(A.onPictureDelete,this)).on("change",".file-upload",e.bind(A.onFileChange,this)).on("click",".picture-form .btn-cancel",function(){i._pictureForm.remove(),i._pictureForm=null}).on("click",".add-row",function(){i.trigger("addrow",t(this).data("key"))}).on("click",".row-remove",function(){i._onRowRemove(this)}),this.$el.data("ui-resizable")&&this.$el.resizable("option","stop",function(t,e){i.trigger("resize:stop",e)})},_getWindowParams:function(t,e){return{winId:"pop-obj-card",addClass:"item-card obj-card",headerHtml:t.name+(t.extId?" (#"+t.extId+")":""),contentHtml:e,footerHtml:App.allowed("objects.shell")&&this.model.get("canSetup")?'<a class="setup btn" href="javascript:;" >'+this.module.getTexts().setupDevice+"</a>":"",width:670,centered:!0,resizable:!0,minWidth:670,maxWidth:1300,minHeight:300,maxHeight:500,dieAfter:0}},_onActivate:function(){var e=0;this.$el.find(".card-section").each(function(){e=Math.max(t(this).height(),e)}),this.$el.find(".jw-resize")[0].style.height=Math.min(500,e+55)+"px",this.$el.centrify()},_onClose:function(){n.hideOverlay(),this.module.get("editable")&&(t("#pop-obj-img").trigger("jw.close"),this.$el.find(".datepicker").datepicker("destroy"),this._removeExportImportView(),e.each(["notifications","cameras","history"],e.bind(function(t){var e="_"+t+"View";this[e]&&this[e].remove(),this[e]=null},this))),this._picturesModule&&this._picturesModule.destroy(),this._picturesModule=null},_renderStatus:function(){var t=this.module.getTexts();return _({statuses:t.objStatuses,selected:this.model.get("objStatus")})},_getUpdateStatus:function(){var t=this.module.getTexts(),e=this.model.get("item"),i=e.firmwareUpdateStatus,n=null;if(i==this.model.FIRMWARE_UPDATE_STATUS_PROGRESS){var s=e.firmwareUpdateProgress;n={status:i,txt:t.firmwareStopUpdate+" ("+s+"%)",cmd:0}}else i==this.model.FIRMWARE_UPDATE_STATUS_TRUE&&(n={status:i,txt:t.firmwareUpdateStart,cmd:1});return n},_limitInputs:function(){var e=this.$el;t.fn.numeric&&(e.find(".decimal").numeric({decimal:".",negative:!0}),e.find(".integer").numeric({decimal:!1,negative:!1}),e.find(".positive").numeric({decimal:".",negative:!1})),e.find("input[name^=SIM]").numeric({decimal:"+",negative:!1,forceZero:!1})},_activateExport:function(){var e=this.$el.find(".jw-footer-content"),i=this.module.getTexts(),n='<a href="javascript:;" class="card-extra-action card-export"><svg class="svg-icon"><use xlink:href="#smb-download"></use></svg> '+i.saveToFile+"</a>";this.model.get("objType")===App.TYPE_STAT&&"ru-RU"===App.getLocale()&&(n+='<a href="javascript:;" class="card-extra-action card-import"><svg class="svg-icon"><use xlink:href="#smb-download-up"></use></svg>'+i.loadFromFile+"</a>"),this._activateExportImportLink(t(n).prependTo(e)),this.$el.find(".nav-tabs a[data-key=main]").on("shown.bs.tab",function(){this._activateExportImportLink(t(n).prependTo(e))}.bind(this)).on("hide.bs.tab",function(){this._removeExportImportView()}.bind(this))},_activateExportImportLink:function(t){t.on("click",function(t){var e=t.target.classList;e.contains("card-export")?this.renderExportView():e.contains("card-import")&&this.renderImportView()}.bind(this))},renderExportView:function(){this._removeExportView(),this._exportView=new r({parent:this,i18n:this.module.getTexts(),objectId:this.model.id,objType:parseInt(this.model.get("settings").ObjType||App.TYPE_MOBILE)})},renderImportView:function(){this._removeImportView(),this._importView=new l({parent:this,$el:this.$el,i18n:this.module.getTexts(),objectId:this.model.id,objType:parseInt(this.model.get("settings").ObjType||App.TYPE_MOBILE)})},_activateTextareas:function(){var e=this,i=this.$el;i.find(".textarea").on("click",".editable",function(n){var s=t(this),o=s.siblings("textarea"),a=s.find(".value"),r=s.height();n.stopPropagation(),s.addClass("hidden"),o.removeClass("hidden").height(r).focus(),i.one("click",function(){a.html(e._prepareEditableText(o.val())),s.removeClass("hidden"),o.addClass("hidden")})}).on("click","a, textarea",function(t){t.stopPropagation()})},_prepareEditableText:function(t){var i=t,n=/(https?:\/\/\S+)/gi;return i=e.escape(i),i=i.replace(n,'<a class="link" target="_blank" href="$1">$1</a>'),i=i.replace(new RegExp("\\n","ig"),"<br/>")},_activateImageChange:function(){var i=this,n=this.$el;n.find(".change-img").on("click",function(){if(!i._startChooseImage.call(i)){var n=i._getSpriteImages(),s=i._getImgDir(),o=e.keys(n),a=new t.Deferred;showCursor(),e.each(o,function(e){!function(e){var o=new Image;o.src=s+"icons_"+e+".png",t(o).on("error",function(){n[e]=!1}).on("load",function(){n[e]=this}).on("load error",function(){i._spritesChecked()&&a.resolve()})}(e)}),a.done(function(){hideCursor(),i._startChooseImage.call(i)})}})},_getImgDir:function(){return this.model.getImgDir()},_getImgExt:function(){return this.model.getImgExt()},_startChooseImage:function(){if(!this._spritesChecked())return!1;var i=this._getSpriteImages(),s=!1;if(e.each(i,function(t){0!=t&&(s=!0)}),!s)return alert("No available images","Error"),!0;var o=0,a={},r=this._getImgHeight(),l=this._getImgDir();if(e.each(i,function(t,e){if(0!=t){var i=t.height;i&&(a[e]=i/r,o+=a[e])}}),!o)return alert("Can not get images number","Error"),!0;var c=this,h=this.module.getTexts(),d=this.model.getImagePath(),u=(this.$el,g({getBgr:function(t,e){var i=t*r;return"url("+l+"icons_"+e+".png) 50% -"+i+"px no-repeat"},isActive:function(t,e){var i="default"==e?"":e+"/",n=t*x+1;return d==l+i+n+".png"},totalBySprites:a}));return n.window.open({winId:"pop-obj-img",headerHtml:h.chooseObjectImage,contentHtml:u,width:600,initY:50,initX:Math.max(c.$el.offset().left-20,10),resizable:!0,minWidth:400,maxWidth:1200,maxHeight:550,dieAfter:0,openCallback:function(){var e=this;e.on("click","li",function(){var i=t(this).data("index"),n=t(this).data("key"),s=("default"==n?"":n+"/")+(i*x+1);c.model.setNewImage(s),e.trigger("jw.close")})}}),!0},_spritesChecked:function(){var t=!0;return e.each(this._getSpriteImages(),function(e){null===e&&(t=!1)}),t},_getDeviceTypeName:function(){return this.model.get("device").name},_getDeviceFirmware:function(){return this.model.get("device").firmware||""},_getDeviceImei:function(){var t=this.model,e=t.get("device");return e.imei||t.get("item").imei||""},_getDeviceImage:function(){var t=this.model,e=t.get("device"),i="";return i="picture"in e?e.picture:this._getDeviceImageByCodeAndRev(e.shortName||"Unknown",e.firmware)},_getDeviceImageByCodeAndRev:function(t,e){"VC"===t&&e&&(0===e.indexOf("V-2")?t="V2N":0===e.indexOf("V-L")?t="VLN":0===e.indexOf("V-15")&&(t="V15N"));var i=C[t]||C.Unknown;return"img/devices/"+i+".jpg"},_activateAutocompletes:function(){if(t.fn.autocomplete){var e=this;this.$el.find(".autocomplete").autocomplete({minLength:2,appendTo:e.$el.content,source:function(t,i){var n=t.term,s=this.element,o=this.element[0].name;if(o in e._fieldsCache&&n in e._fieldsCache[o])return i(e._fieldsCache[o][n]),void 0;var a=++e._autocompleteRequestId;e._settingSuggest(String(t.term),o,a).done(function(t,n){t.length&&(e._fieldsCache[o]=e._fieldsCache[o]||[],e._fieldsCache[o]=t,n===a&&i(t))}).always(function(){s.removeClass("ui-autocomplete-loading")})}})}},_settingSuggest:function(i,n,s){if(/^sim\dprovider$/i.test(n)){var o=new t.Deferred;return t.when(this._settingSuggestRequest(i,"sim1Provider",s),this._settingSuggestRequest(i,"sim2Provider",s)).done(function(t,i){o.resolve(e.unique(t[0].concat(i[0])),s)}),o}return this._settingSuggestRequest.apply(this,arguments)},_settingSuggestRequest:function(e,i,n){var s=new t.Deferred;return t.ajax({url:App.getBaseUrl()+"objects/setting-suggest/",data:{q:e,key:i}}).done(function(t){s.resolve(t,n)}).fail(function(){s.reject()}),s},_activateSubmit:function(){var t=this;this.$el.find("form").on("submit",function(){return t._onSubmit(!1),!1}).find(".btn-apply").on("click",function(){t._onSubmit(!0)})},_onSubmit:function(t){var e=this;t?e._save(!0).fail(function(t){e.showErrors(t)}):e._save(!1).done(function(){e.$el.trigger("jw.close")}).fail(function(t){e.showErrors(t)})},showErrors:function(t){if(t){var i=this.module.getTexts(),n=this.$el.find("form"),o="",a=null;if(e.isArray(t)){for(var r=t.length;r--;)if("key"in t[r])if(e.isArray(t[r].key))for(var l=t[r].key.length;l--;)n.find("[name="+t[r].key[l]+"]").addClass("error");else n.find("[name="+t[r].key+"]").addClass("error");o=e.pluck(t,"msg").join("<br />"),a=n.find(".error").first(),alert(o,i.error,{closeCallback:function(){a&&a.focus()}})}else s.prototype.showErrors.apply(this,arguments)}},_activateCommonDates:function(){var e=this.$el.find("input.datepicker").datepicker({dateFormat:"dd.mm.yy",minDate:new Date(2005,0,1),maxDate:"+1y"});e.each(function(){t(this).datepicker("widget").appendTo("#jface-windows")})},_activateGroups:function(){var e=this,i=this.$el,n=parseInt(this.model.get("settings").ObjType||App.TYPE_MOBILE);i.find(".item-groups").on("click",".tag .del-link",function(i){i.stopPropagation();var n=t(this).parents(".item-groups");if(1==n.find(".group").length)return!1;for(var s=t(this).parent(".tag"),o=s.data("model"),a=e.model.get("objsGroups"),r=a.length;r--;)a[r].id==o&&a.splice(r,1);return s.remove(),e.model.set("objsGroups",a),!1}).on("click",".btn-add",function(s){s.stopPropagation();var o=t(this),a=t(this).parents(".item-groups"),r=a.find(".itext");if(!r.length)return!1;var l=App.getBaseUrl()+"objs-groups/search/";return r.autocomplete({minLength:2,appendTo:i.content,source:function(e,i){var s=e.term;return s in T[n]?(i(T[n][s]),void 0):(S=t.ajax({url:l,data:{q:e.term,groupType:n},success:function(t,e,o){if(t.length){for(var a=[],r=0,l=t.length;l>r;r++)a[r]={id:t[r].id,label:t[r].name,value:t[r].name};T[n][s]=a,o===S&&i(a)}},complete:function(){r.removeClass("ui-autocomplete-loading")}}),void 0)},select:function(i,n){for(var s=e.model.get("objsGroups"),l=s.length;l--;)if(s[l].id==n.item.id)return!1;var c={id:n.item.id,name:n.item.label};s.push(c),e.model.set("objsGroups",s);var h=t(f(c));return s.length>1?h.insertAfter(a.find(".tag:last")):h.appendTo(a.find(".list")),r.val("").attr("disabled","disabled").hide(),o.show(),!1}}),r.removeAttr("disabled").show().focus(),o.hide(),!1}).on("keyup",".itext",function(e){if(27==e.keyCode){var i=t(this),n=i.parents(".item-groups");i.val("").attr("disabled","disabled").hide().autocomplete("destroy"),n.find(".btn-add").show()}e.stopPropagation()}).on("keypress",".itext",function(t){return 13==t.keyCode||10==t.keyCode?!1:(t.stopPropagation(),void 0)})},_activatePictures:function(){var t=this,e=this.module.getTexts();this.$el.find(".nav-tabs a[data-key=pictures]").on("shown.bs.tab",function(){t.$el.find(".pictures-section").data("init")||A.initCarousel.call(t)}),this.module.get("editable")&&(this.$el.find(".nav-tabs a[data-key]").on("shown.bs.tab",function(){t._pictureForm=null}),this.$el.find(".nav-tabs a[data-key=pictures]").on("shown.bs.tab",function(){t.$el.find(".jw-footer-content").prepend('<a href="javascript:;" class="card-extra-action add-picture">'+e.addPicture+"</a>"+'<a href="javascript:;" class="card-extra-action delete-picture">'+e.deletePicture+"</a>")}))},_activateSetup:function(){var t=this,e=this.model.get("item"),i=this._getDeviceImei();this.$el.on("click",".setup",function(){t.$el.trigger("jw.close"),App.trigger("devicesetup",{id:e.id,name:e.name,extId:e.extId,password:t.model.get("settings").PASS,imei:i})})},_activateUpdate:function(){var e=this,i=this.$el;i.on("click",".update-command",function(){var n=t(this),s=parseInt(n.attr("data-command")),o=1==s;o?(i.addClass("loading"),e._fetchFirmwareChanges().done(function(t){"firmwareUpdates"in t&&t.firmwareUpdates.length?e._showFirmwareChanges(t.firmwareUpdates,function(){e._confirmUpdateStartStop(!0)}):e._confirmUpdateStartStop(!0)}).fail(e.showErrors.bind(this)).always(function(){i.removeClass("loading")})):e._confirmUpdateStartStop(!1)})},_fetchFirmwareChanges:function(){var e=this.model.get("item").id;return t.ajax({url:App.getBaseUrl()+"objects/firmware-updates/",data:{objectId:e}})},_showFirmwareChanges:function(t,e){var i=this.module.getTexts();n.confirm("<p>"+t.map(function(t){return t.replace(/\x0A/g,"</p><p>")}).join("</p><p>")+"</p>",i.firmwareChangesHeader,{okCallback:e,addClass:"firmware-update-confirm",btnNames:{ok:i.continue}})},_confirmUpdateStartStop:function(t){var e=this,i=this.module.getTexts(),s=t?i.firmwareUpdateConfirm:i.firmwareStopUpdateConfirm,o=this.model,a=this.$el,r=a.find(".update-command");n.confirm(s.msg,s.hdr,{okCallback:function(){a.addClass("loading"),o.startStopUpdate(t).done(function(){t?r.attr("data-status",o.FIRMWARE_UPDATE_STATUS_PROGRESS).attr("data-command",0).text(i.firmwareStopUpdate):r.replaceWith("<span>"+i.firmwareUpdateCommandSent+"</span>")}).fail(e.showErrors.bind(this)).always(function(){a.removeClass("loading")})},addClass:"firmware-update-confirm",btnNames:{ok:i.continue}})},_activateResponsible:function(){var t=this;
if(this.$el.on("click",".add-responsible",function(){A.onClickPersonAdd.call(t)}).on("click",".personUp",function(){A.onClickPersonUp.call(t,this)}).on("click",".personDown",function(){A.onClickPersonDown.call(t,this)}).on("click",".personRemove",function(){A.onClickPersonRemove.call(t,this)}).on("click",".copy-responsible",function(){t._initRespCopy()}),this.module.get("editable")){var e=this.module.getTexts();this.$el.find(".nav-tabs a[data-key=people]").on("shown.bs.tab",function(){t.$el.find(".jw-footer-content").prepend('<a href="javascript:;" class="card-extra-action add-responsible">'+e.responsible.persons.addNew+"</a>"+'<a href="javascript:;" class="card-extra-action copy-responsible">'+e.responsible.copyList+"</a>")}).on("hide.bs.tab",function(){t._removeCopySettingsView()})}},_getResponsibleFormValue:function(i){var n=this.$el.find(".responsible-section"),s=n.find(".password"),o={},a={},r=[];return e.each(s,function(e){var i=t(e);o[i.attr("name").replace(/_/g,"")]=i.val()}),e.isUndefined(i._phone1)||(e.isArray(i._name)?e.each(i._name,function(t,e){a={key:i._key[e],name:t,phone1:i._phone1[e],phone2:i._phone2[e],comment:i._comment[e]},r.push(a)}):(a={key:i._key,name:i._name,phone1:i._phone1,phone2:i._phone2,comment:i._comment},r.push(a))),o.persons=r,JSON.stringify(o)},_initRespCopy:function(){this._copySettingsView||(this._copySettingsView=new c({parent:this,controller:this.module,model:this.model,settingsProvider:new L.SettingsProvider({context:this,i18n:this.module.getTexts()}),el:t("<div/>").appendTo(this.$el)}))},_activateControls:function(){var t=this,e=this.$el.find(".nav-tabs a[data-key=controls]"),i=this.$el.find(".controls-section");e.one("shown.bs.tab",function(){t._controlsView=new m({controller:t.module,parent:t,model:t.model,el:i})})},_activateAlertsControl:function(){var e=this,i=this.module.getTexts(),n=this.$el.find(".nav-tabs a[data-key=alerts-control]"),s=this.$el.find(".alert-control-section");n.one("shown.bs.tab",function(){e._alertControlView=new d({controller:e.module,parent:e,model:e.model,el:s})}).on("shown.bs.tab",function(){s.trigger("shown"),e.$el.find(".jw-footer-content").prepend('<a href="#" class="card-extra-action copy-alert-control">'+i.alertControlCopy+"</a>")}).on("hidden.bs.tab",function(){s.trigger("hidden"),e._removeCopySettingsView()}),this.$el.on("click",".copy-alert-control",function(){!e._copySettingsView&&e._alertControlView&&(e._copySettingsView=new c({parent:e,controller:e.module,model:e.model,settingsProvider:e._alertControlView,el:t("<div/>").appendTo(e.$el)}))})},_activateNotifications:function(){var t=this,e=this.module.getTexts();this.$el.find(".nav-tabs a[data-key=notifications]").one("shown.bs.tab",function(){t._notificationsView=new h({controller:t.module,parent:t,model:t.model,el:t.$el.find(".notifications-section")})}).on("shown.bs.tab",function(){t.$el.find(".jw-footer-content").prepend('<a href="#" data-key="notification" class="card-extra-action add-row">'+e.addNotification+"</a>")})},_activateCameras:function(){var t=this,e=this.$el.find(".cameras-section"),i=function(t){var e=t.$el.find(".jw-footer-content"),i=t.module.getTexts();e.find(".card-extra-action").remove(),("webrtc"===t.videoType||"ritmrtp"===t.videoType)&&e.prepend('<a href="javascript:;" class="card-extra-action add-row" data-key="'+t.videoType+'">'+i.addCamera+"</a>")};this.$el.find(".nav-tabs a[data-key=cameras]").one("shown.bs.tab",function(){t._videoView=new u({controller:t.module,parent:t,model:t.model,el:e})}).on("shown.bs.tab",function(){i(t)}),e.on("videoTypeChange",function(e,n){t.videoType=n,i(t)})},_camerasFormDataToJson:function(t,e){var i,n,s,o,a,r={cameraUuid:[],cameraSource:[],cameraRequestAlerts:[],cameraUrl:[],cameraName:[],cameraNote:[]},l=t.videoType,c=this.module.getTexts(),h=[];for(var d in r)d in t&&(r[d]=Array.isArray(t[d])?t[d]:[t[d]]);e&&Array.isArray(e)&&(r.cameraRequestAlerts=[],e.forEach(function(t,e){r.cameraUuid[e]=t.uuid,r.cameraSource[e]=t.source,r.cameraRequestAlerts[e]=t.requestAlerts,r.cameraUrl[e]=t.url,r.cameraName[e]=t.name,r.cameraNote[e]=t.note}));for(var u=0;u<e.length;++u){var p={};if("ritmrtp"===l){if(i=r.cameraUrl[u]&&r.cameraUrl[u].trim(),n=r.cameraUuid[u],o=r.cameraSource[u],"RTSP"===o&&!i)continue;var m=Array.isArray(r.cameraRequestAlerts[u])?r.cameraRequestAlerts[u]:[r.cameraRequestAlerts[u]];a=m.map(function(t){return+t}),p.url=i,p.uuid=n,p.source=o,p.requestAlerts=a}s=r.cameraName[u]&&r.cameraName[u].trim(),s||(s=c.videoCamera+" "+(u+1)),h[u]=Object.assign(p,{num:u,name:s,note:r.cameraNote[u].trim()})}return JSON.stringify({videoType:l,cameras:h})},_activateChangesHistory:function(){var t=this,e=this.$el.find(".nav-tabs a[data-key=history]"),i=this.$el.find(".history-section");e.one("shown.bs.tab",function(){t._historyView=new p({controller:t.module,parent:t,model:t.model,el:i}),e.on("shown.bs.tab",function(){i.trigger("shown")}).on("hidden.bs.tab",function(){i.trigger("hidden")})})},_activateObjStatus:function(){if(App.allowed("objects.status.edit")){var t=this,e=this.$el.find("select[name=objStatus]"),i=t.$el.find(".tech-staff"),n=this.model.get("objStatus"),s=o.prototype.STATUS_SERVICE;n==s&&this._renderTechnician(),e.on("change",function(){var n=e.val();n==s?(t.model.get("tech"),t.model.has("tech")?t._renderTechnician():t._renderServiceStatusSettings()):i.addClass("hidden")})}},_renderTechnician:function(){var t=this.model.get("tech");if(t){var e=this.$el.find(".tech-staff");t.fullname=this.buildFullName(t),e.removeClass("hidden").html(w({technician:t,i18n:this.module.getTexts(),from:this.formatDateTime(t.from),to:this.formatDateTime(t.to)}))}},_renderServiceStatusSettings:function(){var e=this,i=e.$el.find(".tech-staff");A.loadTechnicians.call(this).done(function(){if(e._technicians.length){var n=e.module.getTexts(),s=n.setServiceStatusPeriodLabel;i.removeClass("hidden").html(y({technicians:e._technicians,periods:[{value:900,label:s.replace("#n#",15).replace("#l#",n.minutesLabels[n.whichLabels(900)])},{value:3600,label:s.replace("#n#",1).replace("#l#",n.hoursLabels[0])},{value:10800,label:s.replace("#n#",3).replace("#l#",n.hoursLabels[n.whichLabels(3)])},{value:86400,label:s.replace("#n#",1).replace("#l#",n.hours24Labels[0])},{value:604800,label:s.replace("#n#",1).replace("#l#",n.week1)}],i18n:e.module.getTexts()}));var o=i.find("select[name=servicePeriod]"),a=i.find(".field-date"),r=i.find("input[name=serviceDate]"),l=i.find("input[name=serviceTime]"),c=i.find(".field-tech");r.datepicker({dateFormat:"dd.mm.yy",minDate:"+1d",maxDate:"+1y",showButtonPanel:!0}),r.datepicker("widget").appendTo("#jface-windows"),r.datepicker("setDate","+1d"),t.fn.timepicker&&l.timepicker({minuteStep:1,showMeridian:!1,showInputs:!1,appendWidgetTo:a,orientation:{y:"top",x:"right"}}),o.on("change",function(){var t=parseInt(o.val());t>=0?(c.removeClass("hidden"),0===t?a.removeClass("hidden"):a.addClass("hidden")):(c.addClass("hidden"),a.addClass("hidden"))}),c.find("select").on("change",function(){this.className=""})}})},_onRowRemove:function(e){var i=t(e),n=i.closest("table");i.closest("tr").remove(),n.find("tbody tr").length||n.addClass("hidden").siblings(".no-data").removeClass("hidden")},_processAndValidateData:function(i,n){var s=n||[],a=this.module.getTexts(),r=new t.Deferred;"imei"in i&&i.imei.length&&!/^\d{1,16}$/gi.test(i.imei)&&s.push({key:"imei",msg:a.errors.invalidIMEI}),i.name||s.push({key:"name",msg:a.errors.invalidObjectName}),i.RESPONSIVE_PERSONS=this._getResponsibleFormValue(i),e.isUndefined(i._phone1)||(delete i._key,delete i._phone1,delete i._phone2,delete i._name,delete i._comment),i.id=this.model.get("item").id;var l;if((l=this.model.getNewImage())&&(i.IMAGE_PATH=l),this.model.get("objsGroups").length){var c=this.model.get("objsGroups"),h=c.length;for(i.groupsIds=[];h--;)i.groupsIds.push(c[h].id)}else s.push({key:"groupId",msg:a.errors.addAtLeastOneGroup});if("videoType"in i){var d=i.videoType;if("ritmrtp"===d){var u;this._videoView&&this._videoView._children&&this._videoView._children.settings&&this._videoView._children.settings.addSerializedData&&(u=this._videoView._children.settings.addSerializedData(i)),i.VIDEO_STORAGE_CAMERAS=this._camerasFormDataToJson(i,u),["cameraNumber","cameraName","cameraSource","cameraUuid","cameraUrl","cameraRequestAlerts","cameraNote"].forEach(function(t){delete i[t]})}else e.isUndefined(i.cameraName)||delete i.cameraName,!e.isUndefined(i.ivcamid)&&parseInt(i.ivcamid)<0&&(i.ivcamid="")}if(e.isUndefined(i.pictureCaption)||delete i.pictureCaption,"servicePeriod"in i){var p=parseInt(i.objStatus);p==o.prototype.STATUS_SERVICE&&parseInt(i.servicePeriod)>=0&&i.techId<=0&&s.push({key:"techId",msg:a.errEnterTechnicianNotSelected})}return this._alertControlView&&(i=this._alertControlView.addSerializedData(i)),this._controlsView&&(i=this._controlsView.addSerializedData(i)),this._temperatureView&&(i.tempDetectors=this._temperatureView.addSerializedData(i)),"errors"in i&&(s=s.concat(i.errors)),s.length?r.reject(s):r.resolve()},_save:function(i){if(!this.model||this.loading)return!1;var s=this,a=new t.Deferred,r=this.module.getTexts(),l=this.$el.find("form"),c=l.serializeObject(!0),h=this.model.get("item").imei||"";return this._confirmedImei!==!1||!h||"imei"in c&&c.imei==h?(l.find("input.error, select.error").removeClass("error"),this._processAndValidateData(c).fail(function(t){return a.reject(t)}).done(function(){var n=null;if(App.allowed("objects.status.edit")){var l=parseInt(c.objStatus);if(n={status:l},l==o.prototype.STATUS_SERVICE){var h=parseInt(c.servicePeriod);if(h>=0&&c.techId>0)if(n.staffId=parseInt(c.techId),h>0)n.period=1e3*h;else{var d=+new Date,u=r.DateTime.prepareDateField(c.serviceDate),p=u.split("-"),m=c.serviceTime.split(":");2!=m.length&&(m=[0,0]);var f=+new Date(p[0],p[1]-1,p[2],m[0],m[1]);n.period=f-d}}e.each(["objStatus","techId","servicePeriod","serviceDate","serviceTime"],function(t){delete c[t]})}s.loading=!0,s.$el.addClass("loading"),s._executeRequests(n,c).done(function(){s._confirmedImei=!1,n&&s.model.set("objStatus",l),a.resolve(),s.model.update(c,i||!1),i&&(s._historyView&&s._historyView.reload(),n&&(l!=o.prototype.STATUS_SERVICE?s.model.set("tech",null):s.model.loadStatus().done(function(){s.model.has("tech")&&s._renderTechnician()})))}).fail(function(e){var i;try{var n=t.parseJSON(e.responseText);i=n.msg,n.data&&(i+=": "+n.data)}catch(s){i=r.errors.canNotSave}a.reject(i)}).always(function(){s.$el.removeClass("loading"),s.loading=!1})}),a):(n.confirm(r.imeiChangeConfirm.msg,r.imeiChangeConfirm.hdr,{okCallback:function(){s._confirmedImei=c.imei,s._onSubmit(i)},btnNames:{ok:r.continue}}),a.reject(null))},_executeRequests:function(e,i){var n=[t.ajax({url:App.getBaseUrl()+"objects/obj-card-save/",data:i})];return null!==e&&n.push(this.model.saveStatus(e)),t.when.apply(null,n)}});return L.SettingsProvider=function(t){this.context=t.context,this.i18n=t.i18n},e.extend(L.SettingsProvider.prototype,{getCopySettingsFormLabel:function(){return this.i18n.responsible.copyResponsibleFormLabel},getCopySettingsObjectsType:function(){return null},getSettingsToCopy:function(){return["RESPONSIVE_PERSONS"]},mergeSettingsBeingCopied:function(){return!1},onCopySettingsFormSubmit:function(t,e){var i=this.i18n;n.confirm(i.responsible.copyConfirm,i.copy+"?",{okCallback:e})},onCopySettingsCancelled:function(){this.context._removeCopySettingsView()},onCopySettingsDone:function(){this.context._removeCopySettingsView()},onCopySettingsFail:function(t){this.context.showErrors(t)}}),L}),define("abstracts/itemcard/ItemCardModule",["jquery","underscore","abstracts/Module","abstracts/itemcard/CardModel","abstracts/itemcard/views/ItemCardView"],function(t,e,i){var n=i.extend({constructor:function(){this.cardModel=null,this._alertGroups=null,this._alertTemplates=null,i.apply(this,arguments)},initialize:function(){this.set("editable",this.get("options").editable)},_open:function(e,i,n){this.cardModel.setObject(e);var s=this;showCursor(),t.when(this.cardModel.loadStatus(),this.cardModel.fetch({data:{objectId:e.id}})).done(function(){var t=s.get("editable")?i:n;s._view=new t({model:s.cardModel,module:s}),s.listenToOnce(s._view,"remove",function(){s._view=null})}).always(hideCursor)},getTexts:function(){return this.get("parent").getTexts()},getAlertTemplates:function(){return this._alertTemplates},loadAlertTemplatesAndGroups:function(){var e=this,i=new t.Deferred;return this._alertGroups&&this._alertTemplates?i.resolve(e._alertGroups,e._alertTemplates):(t.when(t.ajax({url:App.getBaseUrl()+"alert-template-group/list/",data:{}}),t.ajax({url:App.getBaseUrl()+"alert-template/list/",data:{}})).done(function(t,n){e._alertGroups=t[0],e._alertTemplates=n[0],i.resolve(e._alertGroups,e._alertTemplates)}).fail(function(){i.reject.apply(i,arguments)}),i)}});return n}),define("text!_common/abstracts/editor/tmpl/panel.html",[],function(){return'<div class="panel hidden">\n    <form method="post" action="" enctype="multipart/form-data">\n        <div class="panel-body">\n            no form fields provided\n        </div>\n        <div class="panel-footer text-right">\n            <button class="btn btn-primary"><%= i18n.save.ucFirst() %></button>\n            <a class="btn btn-cancel"><%= i18n.cancel.ucFirst() %></a>\n        </div>\n    </form>\n</div>\n'}),define("abstracts/editor/views/EditorView",["jquery","jqueryui","underscore","jface","abstracts/View","_libs/leaflet/plugins/draw/leaflet.draw","text!_common/abstracts/editor/tmpl/panel.html","css!_libs/leaflet/plugins/draw/leaflet.draw.css"],function(t,e,i,n,s,o,a){a=i.template(a);var r=s.extend({constructor:function(){this.loading=!1,this._form=null,this._body=null,this._editLayer=null,this._addressSearchBlock=null,s.apply(this,arguments)},initialize:function(){this._cont=this.model.get("container"),this.render()},render:function(){var t=this.model.getTexts(),e=a({i18n:t});this._cont.prepend(e),this.setElement(this._cont.find(">.panel")),this._form=this.$el.find("form"),this._body=this.$el.find(".panel-body"),this._bindEvents()},_bindEvents:function(){var t=this,e=this.model;this.on("searchsuccess",function(e,i){"marker"==i.options.source?(t._form.find("input[name=address]").removeClass("error").val(e.address||Math._round(i.lat,6)+","+Math._round(i.lon,6)),t._form.find("input[name=lat]").val(i.lat),t._form.find("input[name=lon]").val(i.lon)):t._putAddressMarker.apply(t,arguments)}).on("searchcomplete",function(e){"marker"==e.options.source&&t.$el.removeClass("loading"),t._addressSearchBlock.addClass("active")}),this.listenTo(e,"change:model",function(i,n){if(null===n)t._close();else{var s=e.previous("model");t.$el.removeClass("hidden"),s?t._onCancel(!0,function(){t._destroyEditableObject(),t._renderModelForm.call(t)}):t._renderModelForm.call(t)}}).listenTo(e.get("parent"),"groupremoved",function(e){t.$el.find("select.group-select option[value="+e+"]").remove()}),this.$el.on("click",".btn-cancel",function(){t._onCancel(!1,function(){e.set("model",null)})}),this.on("suggestsuccess",function(t,e){e&&e(t)}).on("suggesterror",function(){}),this._form.on("submit",function(){return t._onSubmit(),!1})},_renderModelForm:function(){if(!this.loading){var e=this.model.get("model");e instanceof this.model.ItemsClass?(this._renderItemForm(e),this._initEditableObject(),this._form.find("select").on("change",function(){var e=t(this);e.val()?e.removeClass("placeholder error"):e.addClass("placeholder")})):e instanceof this.model.GroupsClass&&this._renderGroupForm(e),this._form.find("[name=name]").on("keyup",function(){t.trim(this.value)&&(this.className=this.className.replace(" error",""))}),this.model.trigger("toggleform",this._form.height())}},_renderItemForm:function(){},_renderGroupForm:function(t){var t=t||this.model.get("model"),e=this.model.getTexts();this._body.html(this._tmplGroup(i.extend({},t.attributes,{i18n:e}))),this._body.find("input[type=text]").first().focus()},_initAddressSearch:function(){var e=this,i=this._form.find("input[name=address]"),n=this.model.get("mapsModule"),s=n.getWidget();this._addressSearchBlock=this.$el.find(".form-search"),this._addressSearchBlock.on("click",".icon-clear",function(){i.val(""),e._addressSearchBlock.removeClass("active"),e.model.get("model").id||(e._form.find("input[name=lat],input[name=lon]").val(0),e._destroyEditableObject()),e._initEditableObject()}).on("click",".btn-search",function(){var t={q:i.val(),type:"address",center:s.getCenter(),bounds:s.getBounds(),options:{source:"field"}};e._search(t,null)}),t.fn.autocomplete&&i.autocomplete({minLength:2,source:function(t,i){var o={q:t.term,type:"address",center:s.getCenter(),bounds:s.getBounds()};n.publish("needsuggest",o,i,e)},select:function(t,n){if(n.item){i.val(n.item.value);var o={q:n.item.value,type:"address",center:s.getCenter(),bounds:s.getBounds(),options:{source:"field"}};e._search(o,n.item.original||null)}return window.setTimeout(function(){i.blur()},0),!1}})},_search:function(t,e){var i=this.model.get("mapsModule");i.publish("needsearch",t,this,e||null)},_putAddressMarker:function(t){if(this._editLayer){var e=[t[0].lat,t[0].lon];this._editLayer.setPosition(e);var i=this._form.find("input[name=lat]"),n=this._form.find("input[name=lon]");i.val(e[0]),n.val(e[1])}},_initEditableObject:function(){var t=this,e=this.model.get("mapsModule");this._editLayer=e.getWidget().buildEditablePoint({addPoints:!0}),e.addLayer(this._editLayer),this._editLayer.on("dragend",function(e){t._updateAddress(e.position)})},_updateAddress:function(t){this.$el.addClass("loading"),this.model.get("mapsModule").trigger("needgeoinfo",{lat:t[0],lon:t[1],options:{source:"marker"}},this)},_onSubmit:function(){if(this.loading)return!1;var t=this,e=this.model;this.loading=!0;var i=!1,n=setTimeout(function(){i=!0,t.$el.addClass("loading")},200);return this._form.find("input[type=file]").length||(this._form.find(".error").removeClass("error"),e.saveModel(t._form.serializeObject()).fail(function(e){e&&t._showErrors(e)}).always(function(){clearTimeout(n),i&&t.$el.removeClass("loading")&&(i=!1),t.loading=!1})),!1},_onCancel:function(t,e){var i=this.model,s=this.model[t?"previous":"get"]("model"),o=this.model.getTexts();if(s&&s instanceof this.model.ItemsClass&&s.id){if(this.model.modelChanged)return n.confirm(o.allChangesCancel,o.cancelChanges,{okCallback:function(){i.modelChanged=!1,e&&e()},cancelCallback:function(){t&&i.set("model",s,{silent:!0})}});e&&e()}else i.modelChanged=!1,e&&e()},_showErrors:function(t){var e=this.model.getTexts(),n="",s=null;if(i.isArray(t)){for(var o=t.length;o--;)if("undefined"!=typeof t[o].key)if(i.isArray(t[o].key))for(var a=t[o].key.length;a--;)this._form.find('[name="'+t[o].key[a]+'"]').addClass("error");else this._form.find('[name="'+t[o].key+'"]').addClass("error");n=i.pluck(t,"msg").join("<br />"),s=this._form.find(".error").first()}else n=t;alert(n,e.error,{closeCallback:function(){s&&s.focus()}})},_showErrorsTips:function(t){var e=this,n=this.model.getTexts(),s=[],o=null;i.each(t,function(t){"undefined"!=typeof t.key?e.$el.find('[name="'+t.key+'"]').tip(t.msg,"formerror"):s.push(t.msg)}),o=this._form.find(".error").first(),s.length&&alert(s.join("<br />"),n.error,{closeCallback:function(){o&&o.focus()}})},_close:function(){this.$el.addClass("hidden");var t=this.model.previous("model");this.stopListening(t),this._destroyEditableObject(),this._body.empty(),this.model.trigger("toggleform",0)},_destroyEditableObject:function(){this._editLayer&&this._editLayer.trigger("destroy")&&(this._editLayer=null)}});return r}),define("abstracts/editor/EditorModule",["jquery","_libs/jquery/jquery.form","underscore","abstracts/Module","abstracts/editor/views/EditorView"],function(t,e,i,n){var s=n.extend({defaults:{model:null},constructor:function(){this.ItemsClass=null,this.GroupsClass=null,this.modelChanged=!1,this._itemEditUrl="",this._itemCreateUrl="",this._groupEditUrl="",this._groupCreateUrl="",n.apply(this,arguments)},initialize:function(t){!this.has("mapsModule")&&this.has("options")&&this.set("mapsModule",this.get("options").mapsModule||null),!this.has("container")&&this.has("options")&&this.set("container",this.get("options").container||null),this.get("container")&&(this._view=new t({model:this}))},saveModel:function(e){var n=this,s=new t.Deferred;if(!this.has("model"))return s.reject();var o=!0,a=this.get("model");return a.id&&(o=!1,e.id=a.id),a instanceof this.GroupsClass?n._saveGroup(e).done(function(t){a.set(i.omit(t,"items")),n.get("parent").trigger(o?"groupadded":"groupchanged",a),n.set("model",null)}):s.reject()},getGroupsList:function(){return this.get("parent").getGroupsList()},getTexts:function(){return this.get("parent").getTexts()},_saveItem:function(){},_validateItem:function(){},_saveGroup:function(e){var i,n=new t.Deferred;if(i=this._validateGroup(e))return n.reject(i);var s=this;return t.ajax({url:e.id?this._groupEditUrl:this._groupCreateUrl,data:e,success:function(t){n.resolve("undefined"!=typeof t.groups?t.groups[0]:t)},error:function(i,o,a){if(500==i.status)try{var r=t.parseJSON(i.responseText);alert(r.msg,r.hdr),e.id?(n.resolve(),s.get("parent").trigger("groupremoved",e.id)):n.reject(a)}catch(l){n.reject(a)}else n.reject(a)}}),n},_validateGroup:function(t,e){var i=[];return t.name=String(t.name||""),t.name||i.push({msg:e.name.empty,key:"name"}),i.length?i:null}});return s}),define("abstracts/editor/DeviceEditorModule",["jquery","underscore","abstracts/editor/EditorModule"],function(t,e,i){var n=i.extend({constructor:function(){i.apply(this,arguments)},initialize:function(t){this._itemEditUrl=App.getBaseUrl()+"objects/obj-settings-save/",this._groupEditUrl=App.getBaseUrl()+"objs-groups/edit/",this._groupCreateUrl=App.getBaseUrl()+"objs-groups/create/",i.prototype.initialize.call(this,t)},saveModel:function(e){var n=this,s=new t.Deferred;if(!this.has("model"))return s.reject();var o=this.get("model");return o.id&&(e.id=o.id),o instanceof this.ItemsClass?n._saveItem(e).done(function(t){n._onItemSaved(t,e),n.set("model",null)}).fail(function(t){s.reject(t)}):(e.parentId||(e.parentId=null),i.prototype.saveModel.call(n,e))},_saveItem:function(i){var n,s=new t.Deferred;if(n=this._validateItem(i))return s.reject(n);var o={settings:e.clone(i)};return i.id&&(o.objectId=i.id,delete o.settings.id),e.each(o.settings,function(t,e){o.settings[e]=String(t)}),t.ajax({url:o.objectId?this._itemEditUrl:this._itemCreateUrl,data:o,complete:function(t){t.status>=200&&t.status<300?s.resolve(i):s.reject(t)}}),s},_validateItem:function(){return null},_onItemSaved:function(){},_validateGroup:function(t){var e=this.getTexts();return i.prototype._validateGroup.call(this,t,{name:{empty:e.enterGroupName}})}});return n}),define("_common/mobile/MobileObject",["underscore","jquery","abstracts/GrObject"],function(t,e,i){function n(t){var e=t.replace("REV ","").split(".");if(e.length<3)return[0,0,0];for(var i=0;3>i;++i)e[i]=e[i].substr(0,3).replace("~[^0-9]~","").replace("~^0+~","");return e}var s=i.prototype,o=i.extend({constructor:function(){this._updateStat=[],this._avgUpdateTime=null,this._prevUpdateTs=0,i.apply(this,arguments)},url:App.getBaseUrl()+"objects/obj/",defaults:t.extend({},s.defaults,{objType:App.TYPE_MOBILE,color:"",licenseNumber:"",model:"",speed:0,minSpeed:1.001,course:0,alt:0,isGpsOnline:0,isGsmOnline:0,lastPointTime:0,isFollowed:0,restricted:null,rev:""}),parse:function(){var t=s.parse.apply(this,arguments),e=arguments[1]===!0;"img"in t&&(t.imgPath=t.img);var n=o.detectHardwareStatus(t);if(null!==n&&(t.hwStatus=n),"objStatus"in t||(t.objStatus=this.STATUS_SERVED),"hasAlarm"in t&&t.hasAlarm&&!i.alarmsAllowed(t.objStatus)&&(t.hasAlarm=!1),"lat"in t&&"lon"in t&&(t.lon<-180&&(t.lon=360+t.lon),t.coords=[t.lat,t.lon]),"isFollowed"in t&&(t.isFollowed="0"==t.isFollowed?0:1),e)if(t.coords){var a,r=+new Date;this._prevUpdateTs&&(this._updateStat.length>3&&this._updateStat.splice(0,1),a=r-this._prevUpdateTs,15e3>a?(this._updateStat.push(a),this._calcAvgUpdateTime()):(this._updateStat=[],this._avgUpdateTime=null)),this._prevUpdateTs=r}else this._prevUpdateTs=0,this._updateStat=[],this._avgUpdateTime=null;else!this._prevUpdateTs&&t.coords&&(this._prevUpdateTs=+new Date);return t},getAvgUpdateTime:function(){var t=null===this._avgUpdateTime?0:this._avgUpdateTime+700;return this._prevUpdateTs>0?t:null},isOnline:function(){return 1==this.get("isGsmOnline")},getImgPath:function(t){var e=""+this.get("imgPath"),i=e,n=this.get("course");if(t&&n>0&&360>=n){var s,o=e.lastIndexOf("/");s=-1==o?e:e.substr(o+1),s=parseInt(s)+(180>=n?2:0),i=-1!=o?e.substr(0,o+1)+s:s}return this.IMG_DIR+i+this.IMG_EXT},setControlCommand:function(t,i){var n=new e.Deferred;return e.ajax({url:App.getBaseUrl()+"objects/set-control-command/",data:{objectId:this.id,controlNum:t,command:i},complete:function(t){t.status>=200&&t.status<300?n.resolve():n.reject(t)}}),n},setFollowMode:function(t){return e.ajax({url:App.getBaseUrl()+"objects/obj-followed-save/",data:{objectId:this.id,isFollowed:t}})},setPoliceTranslation:function(t){return e.ajax({url:App.getBaseUrl()+"objects/turn-position-translation/",data:{objectId:this.id,enabled:t}})},_calcAvgUpdateTime:function(){var e=t.reduce(this._updateStat,function(t,e){return t+e},0);this._avgUpdateTime=e/this._updateStat.length}});return o.detectCANbyRev=function(t){if(!t)return!1;var e=[];return e="string"==typeof t?n(t):t,3!=e.length?!1:504==e[1]||505==e[1]},o.detectHardwareStatus=function(t){if("hwStatus"in t)return t.hwStatus;var e=null;return"isGpsOnline"in t&&"isGsmOnline"in t&&(e=t.isGpsOnline&&t.isGsmOnline?"online":t.isGsmOnline?"fault":"offline"),e},o}),define("_common/mobile/MobileObjectsCollection",["abstracts/ObjectsCollection","_common/mobile/MobileObject"],function(t,e){var i=t.extend({constructor:function(){t.apply(this,arguments)},url:App.getBaseUrl()+"objects/obj/",model:e});return i}),define("_common/mobile/MobileDetails",["jquery","underscore","./MobileObject"],function(t,e,i){var n=i.extend({constructor:function(){i.apply(this,arguments)},url:App.getBaseUrl()+"objects/obj-details/",defaults:e.extend({},i.prototype.defaults,{rev:"",address:null,lastGPSConnectionTime:0,lastGSMConnectionTime:0,localRID:null,remoteRID:null,power:0,voltage:null,discrets:[],discretsState:"",controls:[],controlsState:"",driversInfo:"",responsive:"",description:"",policeTranslation:!1,ivideon:null,webRtcCameras:null,gsmCellData:null}),hasToLoadState:function(){var t=this.get("controls");return t&&e.keys(t).length>0},loadState:function(){return this.loadControls()},loadControls:function(){var e=this;return this.$stateXhr=t.ajax({url:App.getBaseUrl()+"objects/obj-controls/",data:{objectId:this.id},success:function(t){e.set("controls",e.mergeControlsData(t))}}),this.$stateXhr},parse:function(t){var n=i.prototype.parse.call(this,t);if("undefined"!=typeof n.lastGPSConnectionTime&&(n.lastGPSConnectionTime*=App.MS),"undefined"!=typeof n.lastGSMConnectionTime&&(n.lastGSMConnectionTime*=App.MS),"controls"in n&&(n.controls=this.mergeControlsData(n.controls)),e.each(["discrets","controls"],function(t){"undefined"!=typeof n[t]&&(n[t+"State"]=JSON.stringify(n[t]))}),"undefined"!=typeof n.power){var s=n.power.state,o="voltage"in n.power?n.power.voltage:null;n.power=s,n.voltage=o}return"undefined"!=typeof n.driversInfo&&(n.driversInfo=JSON.stringify(n.driversInfo)),"undefined"!=typeof n.VZOR_GIBDD_ENABLED&&n.VZOR_GIBDD_ENABLED&&(n.policeTranslation=!0),n},mergeControlsData:function(t){var i,n=this.get("controls")||{},s={};return e.each(n,function(n,o){o in t&&(i=e.extend({},n,t[o]),"state"in i||(i.possibleStates=[]),s[o]=i)}),e.each(t,function(e,i){i in n||(s[i]=t[i])}),s},getCurrentStaff:function(){var i=[];try{var n=t.parseJSON(this.get("driversInfo")),s=(new Date).getTime();n.length&&(e.each(n,function(e){e.startTime<s&&e.endTime>s&&i.push(t.trim(e.staff.name))}),i=e.uniq(i))}catch(o){}return i},_onDetailsLoaded:function(t){var i=this.get("lastPointTime"),n=!i||!("lastPointTime"in t)||t.lastPointTime>i;n||(t=e.omit(t,"lat","lon","speed","course","alt","lastPointTime")),this.set(this.parse(t,!1))}});return n}),define("text!abstracts/watched/tmpl/deviceInfo.html",[],function(){return'<div class="header clearfix"></div>\n<div class="contents"></div>\n<div class="extra-actions"></div>'}),define("text!abstracts/watched/tmpl/deviceInfoHeaderRestyle.html",[],function(){return'<div class="header clearfix">\n    <div class="actions">\n        <a class="hint hint-top svg-icon svg-icon-target icon-target" href="javascript:;" data-hint="<%= i18n.zoomToObject %>"></a>\n        <% if(editable) {%>\n        <a class="hint hint-top svg-icon svg-icon-cog icon-card" href="javascript:;" data-hint="<%= i18n.openObjectCard %>"></a>\n        <% } else { %>\n        <a class="hint hint-top svg-icon svg-icon-circle-info icon-card" href="javascript:;" data-hint="<%= i18n.openObjectCard %>"></a>\n        <% } %>\n        <a class="hint hint-top svg-icon svg-icon-camera icon-video hidden" href="javascript:;" data-hint="<%= i18n.showCamera %>"></a>\n        <a class="hint hint-top svg-icon svg-icon-bell icon-alerts" href="javascript:;" data-hint="<%= i18n.objectAlertsAndLog %>"></a>\n        <% if(tracks) {%><a class="hint hint-top svg-icon svg-icon-track icon-track" href="#" data-hint="<%= i18n.build.ucFirst() %> <%= i18n.track %>"></a><% } %>\n        <% if(reports) {%>\n            <a class="hint hint-top cmd-report"\n                href="javascript:;" data-hint="<%= i18n.build.ucFirst() %> <%= i18n.report %>">\n                <svg class="svg-icon">\n                    <use xlink:href="#smb-report"></use>\n                </svg>\n            </a>\n        <% } %>\n        <% if(linkToObject) {%>\n        <a class="hint hint-top cmd-copy-link" href="javascript:;" data-hint="<%= i18n.copyLinkToObject %>">\n            <svg class="svg-icon">\n                <use xlink:href="#smb-link"></use>\n            </svg>\n        </a>\n        <input type="text" name="link" value="<%= linkToObject %>">\n        <% } %>\n        <a class="hint hint-top svg-icon svg-icon-circle-remove icon-close" href="javascript:;" data-hint="<%= i18n.close.ucFirst() %>"></a>\n    </div>\n    <h4>\n        <span data-prop="name" class="name"><%- name %></span>\n        <span data-prop="extId"<% if(\'extId\' in hiddenProps) {%> class="hidden"<% } %>>\n            (#<span class="id"><%= extId %></span>)\n        </span>\n    </h4>\n</div>'}),define("text!abstracts/watched/tmpl/operateSuccess.svg",[],function(){return'<svg class="svg-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n width="32px" height="32px" viewBox="0 0 32 32">\n    <path class="svg-path" d="M31.407,3.505l-1.138-1.16c-0.795-0.795-2.09-0.795-2.893,0l-15.556,20.4l-7.35-10.574\nc-0.795-0.796-2.092-0.796-2.893,0l-0.982,1.051c-0.795,0.795-0.795,2.092,0,2.894l9.535,13.53c0.4,0.4,0.916,0.605,1.438,0.605\ns1.045-0.203,1.438-0.605L31.385,6.397C32.201,5.589,32.201,4.3,31.407,3.505z"/>\n</svg>\n'}),define("abstracts/watched/views/DeviceInfoView",["jquery","underscore","abstracts/View","util","jface","text!../tmpl/deviceInfo.html","text!../tmpl/deviceInfoHeaderRestyle.html","text!../tmpl/operateSuccess.svg"],function(t,e,i,n,s,o,a,r){o=e.template(o),a=e.template(a);var l=".devicedetails",c=i.extend({constructor:function(t){this.parent=t.parent,this.controller=t.controller,this.extended=!0,this.$content=null,this._xhrRequests=[],this._timeout=null,this._controlIndex=null,this._stateLoaded=!1,this._lbsLoading=!1,this._lbsUpdated=!1,this._lbsShown=!1,this._lbsData=null,this.$lbsControl=null,this.$lbsControlLabel=null,this._lbsCircle=null,this._lbsMarker=null,this._lbsCache={},i.apply(this,arguments)},initialize:function(t){return t.objectId?(this._setModel(t.objectId),this.render(),this._bindEvents(),this._initOperate(),void 0):(this.trigger("close"),void 0)},render:function(){var e=this,i=this.$el.find(".leaflet-popup-content"),n=this.model,s=n.get("extId");i.find(".contents").length||(i.html(o()),this.$content=this.$el.find(".contents")),s?(e._prerender(),e.$el.trigger("contentchange"),e._prebindModelEvents()):this.$el.addClass("loading"),n.loadDetails().done(function(){if(e.$content){var i=App.get("paremetersFromGET");
if("true"===i.startVideo)return App.set("paremetersFromGET",Object.assign({},i,{startVideo:!1})),App.trigger("needdevicevideo",n,"ritmrtp"),e.trigger("close"),void 0;e.$el.find(".name").text(n.get("name")),e.$el.find(".id").text(n.get("extId")),e.controller.set("stateLoading",!0),e._renderHeader(),e._renderContent(),e._renderFooter();var s=e.$el.find(".icon-video"),o="none",a=n.getVideoData();null!==a&&n.getCamerasList().length?(o=a.videoType,"webrtc"===o?null===App.getWebRtcVideoData()&&(o="none"):("ritmrtp"===o&&!n.getMediaServerUrl()||t.browser.ie)&&(o="none")):n.has("ivideon")&&(o="ivideon"),"none"!==o&&s.removeClass("hidden").data("type",o),e.$el.removeClass("loading"),e.$el.trigger("contentchange"),e._bindModelEvents(),n.hasToLoadState()?n.loadState().done(function(){e.$content&&e._setUpdateTimeout()}).always(function(){e.controller.set("stateLoading",!1)}):(e._setUpdateTimeout(),e.controller.set("stateLoading",!1))}}).always(function(){e._xhrRequests[0]=null})},setActivePage:function(t){var e=this.$el.find(".content.active")[0],i=this.$el.find(".content[data-key="+t+"]")[0];e.className=e.className.replace(" active",""),i.className+=" active",this.$el.trigger("contentchange")},remove:function(){this._stopUpdate(),this.stopListening(),this.$el.off(l),this.$content&&this.$content.remove(),this.$content=null},getDetailedModelClass:function(){},_renderHeader:function(){this.$el.find(".header").html(a(this._getHeaderOptions()))},_getHeaderOptions:function(){var t=this.model.get("objType")==App.TYPE_MOBILE?"mobile":"stat",e=document.queryCommandSupported("copy")?App.getRouter().getFullOrigin()+"?objType="+t+"&objId="+this.model.id:"";return{i18n:this._getTexts(),editable:App.allowed("objects.edit")||App.allowed("objects.create"),reports:App.hasModule("reports"),tracks:App.hasModule("tracks"),name:this.model.get("name"),extId:this.model.get("extId"),linkToObject:e,hiddenProps:this.controller.getHiddenProperties()}},_prerender:function(){this._renderHeader(),this._renderContent(!0),this._renderFooter()},_renderContent:function(){return""},_renderFooter:function(){},_getEventsNS:function(){return l},_bindEvents:function(){var e=this,i=this.controller,o="click"+this._getEventsNS();this.listenTo(i,"change:stateLoading",function(t,i){e._stateLoaded||i||(e._onStateLoadedFirstTime(),e._stateLoaded=!0),e._toggleStateLoading(i)}),this.listenTo(this.parent,"clear",function(){e.trigger("close")});var a=this.controller.get("parent");this.listenTo(a,"stopwatching",function(){e._stopUpdate(),e.listenToOnce(a,"startwatching",function(){e._update()})}),this.on("propschange",function(){var i=e.controller.getHiddenProperties();e.$el.find("[data-prop]").each(function(){var e=t(this);e.data("prop")in i?e.addClass("hidden"):e.removeClass("hidden")})}),this.$el.on(o,".icon-close",function(){e.trigger("close")}).on(o,".icon-target",function(){e.controller.trigger("itemzoom",e.model)}).on(o,".unwatch",function(){e.trigger("close"),e.controller.unwatchItem(e.model.id)}).on(o,".icon-card",function(){e.trigger("close"),e.controller.get("parent").trigger("itemcardopen",e.model)}).on(o,".icon-video",function(){e.trigger("close"),App.trigger("needdevicevideo",e.model,t(this).data("type"))}).on(o,".icon-alerts",function(){e.trigger("close"),App.trigger("needdevicehistory",e.model)}).on(o,".cmd-copy-link",function(){n.copyToClipboard(e.$el.find("input[name=link]")[0])&&s.growl.open(e._getTexts().linkToObjectIsCopied)}).on(o,"[data-page]",function(){var i=t(this).data("page");return("operate"!=i||e._stateLoaded)&&e.setActivePage(i),!1}).on(o,".back",function(){var i=t(this).data("target");i&&e.setActivePage(i)}),"undefined"!=typeof PRODUCTION&&this.$el.on("contextmenu",function(){return!1})},_prebindModelEvents:function(){},_bindModelEvents:function(){var t=this;e.each(["name"],function(i){t.listenTo(t.model,"change:"+i,function(n,s){t.$el.find("."+i).text(e.isNull(s)?"":s)})}),this.listenTo(t.model,"change:ivideon",function(e,i){var n=i&&"ivcamid"in i&&i.ivcamid>-1;t.$el.find(".icon-video")[n?"removeClass":"addClass"]("hidden")})},_onStateLoadedFirstTime:function(){},_toggleStateLoading:function(t){this.$el.find(".state-loading")[t?"removeClass":"addClass"]("hidden")},_setIndicatorState:function(t,e){t.attr("data-state","number"==typeof e?e:e?"1":"0")},_setModel:function(t){var i=this.getDetailedModelClass(),n=this.model=new i({id:t}),s=this.controller.items.get(t);s&&n.set(e.clone(s.attributes));var o=this.controller.getUserData("activeWidget");this.model.set("activeWidget",o)},_update:function(e){e=e||{};var i=this,n=e.silent===!0;if(this._timeout&&clearTimeout(this._timeout),!n&&!App.get("visible"))return i._setUpdateTimeout(),void 0;var s=this.controller,o=!1,a=[this.model.loadDetails()],r=e.showStateLoading||!1,l=setTimeout(function(){i.$el.addClass("loading"),o=!0},e.showLoading?50:i.model.isOnline()?1e4:4e3);return this.model.hasToLoadState()&&(a.push(this.model.loadState()),r&&s.set("stateLoading",!0)),t.when.apply(t,a).done(function(){i.$content&&i._setUpdateTimeout()}).always(function(){l&&clearTimeout(l),o&&i.$el.removeClass("loading"),r&&s.set("stateLoading",!1)})},_setUpdateTimeout:function(){var t=this;this._timeout=setTimeout(function(){t._update()},this._getUpdatePeriod())},_getUpdatePeriod:function(){return this.model.get("objType")==App.TYPE_MOBILE?7e3:4e3},_stopUpdate:function(){this._timeout&&clearTimeout(this._timeout),this._timeout=null},_initOperate:function(){var e=this,i="click"+this._getEventsNS();this.$el.on(i,"[data-page=operate]",function(i){return i.stopPropagation(),e._stateLoaded&&(e._controlIndex=t(this).data("index"),e._renderOperate()),!1}).on(i,"[data-key=operate] .back",function(){return e._controlIndex=null,!1}).on(i,".operate-actions [data-command]",function(){return e._sendOperate(t(this).data("index"),t(this).data("command")),!1})},_renderOperate:function(){},_sendOperate:function(t,e){var i=this;this.$el.addClass("loading"),this.model.setControlCommand(t,e).done(function(){i._onOperateSuccess()}).fail(function(t){i.showErrors(t,i._getTexts().errorChangeOutput)}).always(function(){i.$el.removeClass("loading")})},_onOperateSuccess:function(t){var e=this,i=this._getTexts(),n=this.$el.find(".operate-content");t=t!==!1,n.addClass("command-complete success").find(".operate-state .state-wrap").html(r).end().find(".operate-actions").html('<p class="command-msg">'+i.commandSent+"</p>"),setTimeout(function(){e.model.isOnline()&&t&&e._restartStateUpdate({showStateLoading:!0}),e._closeOperate()},1e3)},_restartStateUpdate:function(t){this._stopUpdate(),this._update(t)},_closeOperate:function(){this._controlIndex=null,this.setActivePage("summary")},_formatConnectionTime:function(){var t="";if(this.model.isOnline())t=this.controller.getTexts().online;else{var e=this.model.get("lastGSMConnectionTime");t=e>0?this.formatDateTime(e):"--"}return t},_getTexts:function(){return{}},_initWidgets:function(){var e=this,i=this.controller,n=this.$el.find(".widget"),s=n.filter(".active"),o=s.data("value"),a=this.$el.find(".widgets-nav");a.on("click","li[data-value]",function(s){s.stopPropagation();var r=t(this),l=r.data("value");return l!==o&&(a.find("li[data-value="+o+"]").removeClass("active"),n.filter("[data-value="+o+"]").removeClass("active"),r.addClass("active"),n.filter("[data-value="+l+"]").addClass("active"),i.setUserData("activeWidget",l),e.model.set("activeWidget",l),o=l),!1})},onLbsClick:function(t){return t.preventDefault(),this._lbsLoading||(this._lbsShown?(this._lbsUpdated?(this._clearLbs(),this._showLbs()):this._hideLbs(),this._lbsUpdated=!1):this._showLbs()),!1},_initLbs:function(){this.$lbsControl=this.$el.find(".lbs-control"),this.$lbsControlLabel=this.$lbsControl.find(".lbs-control-label"),this.$lbsControl.on("click",this.onLbsClick.bind(this))},_showLbs:function(){var t=this.controller.getTexts();this.$lbsControl.addClass("loading"),this._lbsLoading=!0,this._getLbsData().done(function(e){this.$content&&(this._lbsShown=!0,this._lbsData=e,this._drawLbs(),this.$lbsControlLabel.text(t.hideLbs),this.$el.addClass("lbs-shown"))}.bind(this)).fail(function(){this._hideLbs(),this.showErrors(t.errorLbsSearch.replace("#p#",JSON.stringify(this._prepareLbsSearchParams())))}.bind(this)).always(function(){this.$lbsControl.removeClass("loading"),this._lbsLoading=!1}.bind(this))},_drawLbs:function(){var t,e,i=this._lbsData,n=this.parent.getMapsModule(),s=n.getWidget(),o=this.$el.data("marker"),a=o.getParentCluster(),r=this.model.get("isGsmOnline");this._clearLbs(),null!==a&&a.isSpiderfied()||(t=s.buildRadial({center:i.center,radius:i.radius,color:r?"#5cb85c":"#999",fillOpacity:.4}),e=s.buildComplexMarker({lat:i.center[0],lon:i.center[1],className:"complex-icon complex-icon-lbs"+(r?" online":""),html:'<svg class="svg-icon"><use xlink:href="#smb-connection"></use></svg>'}),this._lbsCircle=t,this._lbsMarker=e,s.fitBounds(t.getBounds().extend(o.getLatLng()),{maxZoom:15,animate:!1}),n.addLayer(t),n.addLayer(e))},_clearLbs:function(){if(this._lbsMarker&&this._lbsCircle){var t=this.parent.getMapsModule();t.removeLayer(this._lbsMarker),t.removeLayer(this._lbsCircle),this._lbsMarker=null,this._lbsCircle=null}},_hideLbs:function(){var t=this.controller.getTexts();this._clearLbs(),this._lbsShown=!1,this._lbsData=null,this.$content&&(this.$lbsControlLabel.text(t.showLbs),this.$el.removeClass("lbs-shown"))}});return c}),define("mobile/nls/mobile",{root:{l:"l",l100km:"l/100km",l1h:"l/1h",ms2:"m/sec2",acp:"ADC",objRouteNumber:"Route No",followedMode:'"Follow" mode',indicateTrackedSensorState:"Change the external view based on the sensor state",volume:"volume",ignition:"ignition",sensorsAndDevices:"Connections",filters:"Filters",copyObjFilters:"Copy filter settings",copyFiltersFormLabel:"Select an object or a group of objects for coping of filter settings",copyFiltersConfirm:"<p>Do you want to copy filter settings of the object to the selected objects?</p><p><strong>Warning!</strong> Filter settings in the selected objects will be replaced.<br />New filters will be used for new history entries.<br />To apply filters to the history received previously use recounting.</p>",objFollowOn:'Enable "Follow" mode',objFollowOff:'Disable "Follow" mode',parks:"Parkings",parkBegin:"start",parkEnd:"end",parkTime:"parking time",parksTime:"Parking time",filtersSettings:"Filter options",states:{standard:"Standard state",repared:"Repair",technicalService:"Maintenance",switchedOff:"Switched off"},connectionTime:"Connection time",coordinatesTime:"Fixture time",chartsSettings:"Chart settings",fuelLevelSensor:"Fuel level sensor",flowSensorOnInput:"Input flow-through",flowSensorOnOutput:"Output flow-through",sensorNotInstalled:"No sensor installed",impulsesByLiter:"Pulses per litre",fuelConsumptionNorm:"Fuel consumption rate",fuelNormAuto:"Auto (winter is from 01.11 till 31.03)",fuelNormSummer:"Rate for summer",fuelNormWinter:"Rate for winter",fuelConsumptionNormForSummer:"Summer consumption rate",fuelConsumptionNormForWinter:"Winter consumption rate",calibrationTable:"Calibration table",calibrationTableIsEmpty:"The calibration table is empty",tankVolume:"Tank volume",controlOut:"output",filling:"refueling",minFilling:"Minimum refueling",discharge:"discharge",minDischarge:"Minimum discharge",fillings:"refuelings",discharges:"discharges",stepOfMedianFilter:"Median filter step",maxUsedSensorValues:"Upper ADC throughput threshold",minUsedSensorValues:"Lower ADC throughput threshold",errAcpLimits:"The lower ADC threshold must be less than the upper threshold.",useAutoTrackFilters:"Automatic settings of track filters",useManualTrackFilters:"Manual settings of track filters",coordinatesFiltersByCondition:"Coordinate filters by the condition",useCoordinatesOnlyIfIgnitionIsOn:"Use coordinates only with ignition on (discrete sensor 1)",coordinatesFiltersByParameters:"Coordinate filters by parameters",coordinatesFiltersBySpeed:"Coordinate filters by velocity",useOnlyAccurateCoordinates:"Use the coordinates of records with the acceptable HDOP and VDOP precision",useCoordinatesByMovementSensor:"Use the coordinates of records only when the built-in motion sensor is activated",useCoordinatesOnlyWhenMovingOrEventHappens:'Use the coordinates of records "on movement" and "event" types only',useCoordinatesIfSpeedWithinTheRange:"Use coordinates only within specified speed limits",minObjectSpeed:"Minimum object speed",maxObjectSpeed:"Maximum object speed",filtersOfFalseCoordinates:"Wrong coordinates filters",useCoordinatesWithoutLargeDeviationFromParkingPlace:'Use coordinates without disturbances from the parking location ("star" filter)',useCoordinatesWithoutLargeDeviationFromTrack:'Use coordinates without disturbances from the vehicle direction ("jump" filter)',useCoordinatesOnlyWithAltitude:"Use coordinates with height fixture",useCoordinatesOnlyWithGoodSignal:"Use coordinates with high quality signal (high level of signal/noise)",useCoordinatesOnlyWithGoodVoltage:"Use coordinates obtained under device supply voltage at most 37V",parkPlacesFilters:"Parking and movement filters",detectParksIfContinueMoreThan:"Determine parkings with duration more than",detectMovementBetweenParksIfContinuesMoreThan:"Determine movement between parkings with duration more than",gpsTrackMapMatching:"Track map matching",gpsTrackMapMatchingLabel:"Execute map matching, depending on the type of mobile object",gpsTrackMapMatchingFiltersWarning:"Map matching is only possible using automatic filters.",mapMatchingOff:"Switched off",mapMatchingCar:"Car",mapMatchingTram:"Tram",mapMatchingTrolleybus:"Trolleybus",dataHasBeenRecalculated:"Recalculated",dataHasBeenPrepared:"The data is ready",clearAndRecalculateDataFromSelectedDate:"Recalculate data from",clearHistoryHelp:"Recalculation will delete the data previously prepared for reports. The data will be recalculated again from the selected date to the current date",clearHistoryInfo:"The data clearing and recalculation are in progress. Recalculation will delete the data previously prepared for reports. The data will be recalculated again from #date# to the current date.",clearHistoryInfoShort:"The data clearing and recalculation are in progress",clearHistoryHelp1:"After the data is deleted, the recalculation will start automatically. This can be time consuming.",clearingDataFrom:"Delete data from",assignedStaff:"Current vehicle",showStaff:"Show current vehicle",workInterval:"Shift",stafState:"Mode",recordTime:"Recording time",odometer:"Odometer",noStaffAssigned:"No vehicle is assigned at the moment.",driver:"Driver",confirmShowTrackForGroup:"Generate the track using more than 10 objects?",alertCantbBuildTrackWithEmpty:"Unable to generate tracks using an empty group",alertCantbBuildReportWithEmpty:"Unable to generate the report using an empty group",haveNoPermission:"You do not have object card editing privileges",canNotExportReport:"Report export failed",policeTranslation:"Sending to the Road Police",policeTranslationConfirm:{hdr:"Confirm the action",msg:"#action# object data sending to the Road Police?"},policeTranslationState:{on:"Disable sending to the Road Police",off:"Enable sending to the Road Police"}},"ru-ru":!0,"it-it":!0}),define("mobile/nls/ru-ru/mobile",{l:"л",l100km:"л/100км",l1h:"л/1ч",ms2:"м/с<sup>2</sup>",acp:"АЦП",objRouteNumber:"№ маршрута",followedMode:"Режим слежения",indicateTrackedSensorState:"Менять внешний вид в зависимости от состояния датчика",volume:"объем",ignition:"зажигание",sensorsAndDevices:"Подключения",filters:"Фильтры",copyObjFilters:"Копировать настройки фильтров",copyFiltersFormLabel:"Выберите объект или группу объектов, куда нужно скопировать настройки фильтров",copyFiltersConfirm:"<p>Копировать текущие&nbsp;сохраненные настройки&nbsp;фильтров этого&nbsp;объекта в&nbsp;выбранные&nbsp;объекты?</p><p><strong>Внимание!</strong> Настройки&nbsp;фильтров в&nbsp;выбранных&nbsp;объектах будут&nbsp;замещены. <br />Новые фильтры будут&nbsp;использованы для&nbsp;вновь&nbsp;поступающей истории.<br />Для&nbsp;применения&nbsp;фильтров к&nbsp;истории, полученной&nbsp;ранее, используйте&nbsp;пересчет.</p>",objFollowOn:"Включить слежение",objFollowOff:"Выключить слежение",parks:"Стоянки",parkBegin:"начало",parkEnd:"окончание",parkTime:"время стоянки",parksTime:"Время стоянок",filtersSettings:"Параметры фильтров",states:{standard:"Стандартное состояние",repared:"Ремонтные работы",technicalService:"Тех. обслуживание",switchedOff:"Отключен"},connectionTime:"Время соединения",coordinatesTime:"Время фиксации",reportParams:"Параметры отчета",chartsSettings:"Настройки графиков",fuelLevelSensor:"Датчик уровня топлива",flowSensorOnInput:"Проточный на входе",flowSensorOnOutput:"Проточный на выходе",sensorNotInstalled:"Датчик не установлен",impulsesByLiter:"Импульсов на литр",fuelConsumptionNorm:"Норма расхода топлива",fuelNormAuto:"Авто (зимняя норма с 01.11 по 31.03)",fuelNormSummer:"Летняя норма",fuelNormWinter:"Зимняя норма",fuelConsumptionNormForSummer:"Норма расхода летом",fuelConsumptionNormForWinter:"Норма расхода зимой",calibrationTable:"Тарировочная таблица",calibrationTableIsEmpty:"Тарировочная таблица не заполнена",tankVolume:"Объем бака",controlOut:"выход",filling:"заправка",minFilling:"Минимальная заправка",discharge:"слив",minDischarge:"Минимальный слив",fillings:"заправки",discharges:"сливы",stepOfMedianFilter:"Шаг медианного фильтра",maxUsedSensorValues:"Верхний пропускной порог АЦП",minUsedSensorValues:"Нижний пропускной порог АЦП",errAcpLimits:"Нижний порог АЦП должен быть ниже верхнего порога.",useAutoTrackFilters:"Автоматическая настройка фильтров трэка",useManualTrackFilters:"Ручная настройка фильтров трэка",coordinatesFiltersByCondition:"Фильтры координат по условию",useCoordinatesOnlyIfIgnitionIsOn:"Использовать координаты только при включенном зажигании (дискретный вход 1)",coordinatesFiltersByParameters:"Фильтры координат по параметрам",coordinatesFiltersBySpeed:"Фильтры координат по скорости",useOnlyAccurateCoordinates:"Использовать координаты с приемлемым качеством HDOP и VDOP",useCoordinatesByMovementSensor:"Использовать координаты только при срабатывании встроенного датчика движения",useCoordinatesOnlyWhenMovingOrEventHappens:"Использовать координаты только из типов записей по движению и событию",useCoordinatesIfSpeedWithinTheRange:"Использовать координаты в пределах указанного диапазона скоростей",minObjectSpeed:"Минимальная скорость объекта",maxObjectSpeed:"Максимальная скорость объекта",filtersOfFalseCoordinates:"Фильтры ошибочных координат",useCoordinatesWithoutLargeDeviationFromParkingPlace:'Использовать координаты без резких отклонений от места стоянки (фильтр "звезд")',useCoordinatesWithoutLargeDeviationFromTrack:'Использовать координаты без резких отклонений от курса движения (фильтр "прыжков")',useCoordinatesOnlyWithAltitude:"Использовать координаты с фиксацией по высоте",useCoordinatesOnlyWithGoodSignal:"Использовать координаты при хорошем качестве сигнала (высоком уровне сигнал/шум)",useCoordinatesOnlyWithGoodVoltage:"Использовать координаты, полученные при напряжении питания прибора не более 37В",parkPlacesFilters:"Фильтры стоянок и движения",detectParksIfContinueMoreThan:"Определять стоянки продолжительностью более",detectMovementBetweenParksIfContinuesMoreThan:"Определять движение между стоянками продолжительностью более",gpsTrackMapMatching:"Привязка трека к дорожной сети",gpsTrackMapMatchingLabel:"Привязывать полученный трек к дорожной сети в зависимости от типа мобильного объекта",gpsTrackMapMatchingFiltersWarning:"Привязка трека к дорожной сети возможна только при использовании автоматических фильтров.",mapMatchingOff:"Нет привязки",mapMatchingCar:"Автомобиль",mapMatchingTram:"Трамвай",mapMatchingTrolleybus:"Троллейбус",dataHasBeenRecalculated:"Пересчитано",dataHasBeenPrepared:"Данные подготовлены",clearAndRecalculateDataFromSelectedDate:"Пересчитать данные с",clearHistoryHelp:"При пересчете, ранее подготовленные для отчетов данные будут удалены и рассчитаны заново с выбранной даты до настоящего момента",clearHistoryInfo:"Идет процесс очистки и пересчета данных. После пересчета, ранее подготовленные для отчетов данные будут удалены и рассчитаны заново с #date# до настоящего момента.",clearHistoryInfoShort:"Идет процесс очистки и пересчета данных",clearHistoryHelp1:"После удаления данных автоматически начнется пересчет, это может занять продолжительное время.",clearingDataFrom:"Удаление данных с",assignedStaff:"Текущий экипаж",showStaff:"Показать текущий экипаж",workInterval:"Смена",stafState:"Режим",recordTime:"Время записи",odometer:"Одометр",noStaffAssigned:"В настоящее время экипаж не назначен.",driver:"Водитель",confirmShowTrackForGroup:"Построить трек по более чем 10 объектам?",alertCantbBuildTrackWithEmpty:"Нельзя построить треки по пустой группе",alertCantbBuildReportWithEmpty:"Нельзя строить отчет по пустой группе",haveNoPermission:"У вас нет прав на редактирование карточки объекта",canNotExportReport:"Не удалось экспортировать отчет",policeTranslation:"Передача в ГИБДД",policeTranslationConfirm:{hdr:"Подтвердите действие",msg:"#action# передачу данных об объекте в ГИБДД?"},policeTranslationState:{on:"Отключить передачу в ГИБДД",off:"Включить передачу в ГИБДД"}}),define("text!_common/mobile/watched/tmpl/objInfoRestyle.html",[],function(){return'<div data-key="summary" class="content active">\n    <div class="features">\n        <ul>\n            <li data-prop="deviceTypeName"\n                class="<% if(prerender) {%>loading<% } %><% if(\'deviceTypeName\' in hiddenProps) {%> hidden<% } %>">\n                <%= i18n.device %>:\n                <strong>\n                    <% if(prerender) {%><i class="svg-icon svg-icon-spinner icon-spin"></i><% } %>\n                    <%= deviceTypeName || \'--\' %>\n                    <% if(rev) {%>(<%= rev %>)<% } %>\n                </strong>\n            </li>\n            <li data-prop="licenseNumber"<% if(\'licenseNumber\' in hiddenProps) {%> class="hidden"<% } %>>\n                <%= i18n.licenseNumber %>:\n                <strong class="licenseNumber"><%- licenseNumber || \'-\' %></strong>\n            </li>\n            <li data-prop="address"<% if(\'address\' in hiddenProps) {%> class="hidden"<% } %>>\n                <%= i18n.address.ucFirst() %>:\n                <strong data-geoid="<%= geoId %>" class="address"><i class="svg-icon svg-icon-spinner icon-spin"></i><% if(addressStr != null) { %><%- addressStr %><% } else { %><%= i18n.addressNotFound %> [0,0]<% } %> </strong>\n            </li>\n        </ul>\n        <a data-page="staff" class="hidden" href="#"><%= i18n.showStaff %></a>\n    </div>\n\n    <div class="features-col-group clearfix">\n        <div class="features features-col">\n\n            <div class="widgets-group">\n                <div class="widget <%= activeWidget == \'speed\' ? \'active\' : \'\' %>" data-value="speed">\n                    <strong class="widget-value speed"><%= speed < minSpeed ? 0 : Math._round(speed, 2) %></strong>\n                    <small class="widget-value-units"><%= i18n.kmh %></small>\n                    <strong class="widget-label"><%= i18n.speed.ucFirst() %></strong>\n                </div>\n                <div class="widget widget-power <%= activeWidget == \'power\' ? \'active\' : \'\' %><%= prerender ? \' loading\' : \'\' %>"\n                     data-value="power" data-state="<%= !prerender ? ( power == 0 ? 1 : 0 ) : \'\' %>">\n                    <strong class="widget-value"><i class="svg-icon svg-icon-spinner icon-spin"></i></strong>\n                    <small class="widget-value-units">--</small>\n                    <strong class="widget-label"><%= i18n.power.ucFirst() %></strong>\n                </div>\n                <div class="widget <%= activeWidget == \'alt\' ? \'active\' : \'\' %>"\n                     data-value="alt">\n                    <strong class="widget-value alt"><%= alt %></strong>\n                    <small class="widget-value-units"><%= i18n.m %></small>\n                    <strong class="widget-label"><%= i18n.altitude %></strong>\n                </div>\n                <% if(showTemperature) {%>\n                    <div class="widget widget-temperature temperature-panel <%= activeWidget == \'temperature\' ? \'active\' : \'\' %> <%= tempClass %> " data-value="temperature">\n                        <div class="temperature-panel-value">\n                            <span><%= temperature %></span>\n                        </div>\n                        <p class="temperature-panel-units">&deg;C</p>\n                        <p class="temperature-panel-name"><%= tempDetector %></p>\n                    </div>\n                <% } %>\n                <div class="widget<%= activeWidget == \'rid\' ? \' active\' : \'\' %><%= prerender ? \' loading\' : \'\' %>"\n                     data-value="rid">\n                    <strong<% if(!prerender) {%> data-hint="<%= localRID + \' \' + i18n.from + \' \' + remoteRID %>"<% } %>\n                            class="widget-value rid-percent hint-top">\n                        <i class="svg-icon svg-icon-spinner icon-spin"></i>\n                        <%= ridPercent %>\n                    </strong>\n                    <small class="widget-value-units">%</small>\n                    <strong class="widget-label"><%= i18n.objTrackReading %></strong>\n                </div>\n                <ul class="widgets-nav">\n                    <li class="widgets-nav-item <%= activeWidget == \'speed\' ? \'active\' : \'\' %>"\n                        data-value="speed">\n                        <svg class="svg-icon">\n                            <use xlink:href="#smb-speed"></use>\n                        </svg>\n                    </li>\n                    <li class="widgets-nav-item <%= activeWidget == \'power\' ? \'active\' : \'\' %>"\n                        data-value="power" data-state="<%= !prerender ? ( power == 0 ? 1 : 0 ) : \'\' %>">\n                        <svg class="svg-icon">\n                            <use xlink:href="#smb-plug"></use>\n                        </svg>\n                    </li>\n                    <li class="widgets-nav-item <%= activeWidget == \'alt\' ? \'active\' : \'\' %>" data-value="alt">\n                        <svg class="svg-icon">\n                            <use xlink:href="#smb-altitude"></use>\n                        </svg>\n                    </li>\n                    \n                    <% if(showTemperature) {%>\n                        <li class="widgets-nav-item <%= activeWidget == \'temperature\' ? \'active\' : \'\' %> nav-<%= tempClass %> " data-value="temperature">\n                            <svg class="svg-icon">\n                                <use xlink:href="#smb-temperature"></use>\n                            </svg>\n                        </li>\n                    <% } %>\n\n                    <li class="widgets-nav-item <%= activeWidget == \'rid\' ? \'active\' : \'\' %>" data-value="rid">\n                        <svg class="svg-icon">\n                            <use xlink:href="#smb-percent"></use>\n                        </svg>\n                    </li>\n                </ul>\n            </div><!--/.widgets-group-->\n\n            <%= !compact ? htmlConnections : \'\' %>\n\n        </div><!--/features features-col-->\n\n        <div class="features features-col">\n\n            <%= compact ? htmlConnections : \'\' %>\n\n            <ul class="list-group indicators">\n                <li class="list-group-item indicator follow-mode"\n                    data-state="<%= isFollowed == 1 ? 1 : 0 %>"<% if(controlFollowed) {%> data-page="follow""<% } %>>\n                    <svg class="svg-icon list-group-item-icon">\n                        <use xlink:href="#smb-eye"></use>\n                    </svg>\n                    <% if(controlFollowed) {%>\n                    <svg class="svg-icon more-action">\n                        <use xlink:href="#smb-chevron-right"></use>\n                    </svg>\n                    <% } %>\n                    <div class="info">\n                        <h4><%= i18n.followedMode %></h4>\n                        <p class="extra off"><%= i18n.switchedOffShort %></p>\n                        <p class="extra on"><%= i18n.switchedOnShort %></p>\n                    </div>\n                </li>\n            </ul>\n\n            <% if(!prerender) {%>\n            <ul class="list-group indicators controls state-loading"></ul>\n            <ul class="list-group indicators discrets"></ul>\n            <% } %>\n\n        </div><!--/features-col -->\n\n    </div><!--/features-col-group-->\n\n</div><!--/content summary-->\n\n<div data-key="staff" class="content staff"></div><!--/content staff-->\n<div data-key="operate" class="content operate"></div><!--/content operate-->\n<div data-key="follow" class="content"></div><!--/content follow-->\n\n'}),define("text!_common/mobile/watched/tmpl/baloonFooter.html",[],function(){return'<a class="unwatch" href="javascript:;"><%= i18n.removeFromMap %></a>\n<% if(routingModule) {%>\n<a href="#" class="route-from pull-right"><%= i18n.buildRoute %></a>\n<% } %>\n'}),define("text!_common/mobile/watched/tmpl/staffInfo.html",[],function(){return'<div class="subheader">\n    <a data-target="summary" class="back" href="#">\n        <i class="icon-arrow-left"></i>\n    </a>\n    <h5><%= i18n.assignedStaff %></h5>\n</div>\n<div class="staff-content">\n<% _.each(driversInfo, function(info) { %>\n<ul class="features">\n    <li>\n        <span class="name"><%= info.staff.position.name %></span>\n        <span class="value"><%= ( info.staff.name + ( info.staff.id ? \' (ID=\'+info.staff.id+\')\' : \'\' )) %></span>\n    </li>\n    <% if(\'undefined\' != typeof info.staff.interval || 1) {%>\n    <li>\n        <span class="name"><%= i18n.workInterval %>:</span>\n        <span class="value"><%= Date.format(\'H:i\', info.startTime) %> - <%= Date.format(\'H:i\', info.endTime) %></span>\n    </li>\n    <% } %>\n    <% if(\'undefined\' != typeof info.staff.odometr) {%>\n    <li>\n        <span class="name"><%= i18n.odometer %>:</span>\n        <span class="value"><%= info.staff.odometer %></span>\n    </li>\n    <% } %>\n    <% if(\'undefined\' != typeof info.staff.recordTime) {%>\n    <li>\n        <span class="name"><%= i18n.recordTime %>:</span>\n        <span class="value"><%= info.staff.recordTime %></span>\n    </li>\n    <% } %>\n    <% if(\'undefined\' != typeof info.staff.state) {%>\n    <li>\n        <span class="name"><%= i18n.staffState %>:</span>\n        <span class="value"><%= info.staff.state %></span>\n    </li>\n    <% } %>\n    <% if(\'undefined\' != typeof info.staff.phone) {%>\n    <li>\n        <span class="name"><%= i18n.phones.ucFirst() %>:</span>\n        <span class="value"><% print(info.staff.phone.replace(/([\\+0-9\\(\\)]+)/g,"<a href=\'callto:$1\'>$1</a>")) %></span>\n    </li>\n    <% } %>\n    <% if(\'undefined\' != typeof info.staff.comment) {%>\n    <li>\n        <span class="name"><%= i18n.comments %>:</span>\n        <span class="value"><%= info.staff.comment %></span>\n    </li>\n    <% } %>\n</ul>\n<% }); %>\n\n<p class="no-data<%= driversInfo.length ? \' hidden\' : \'\'%>"><%= i18n.noStaffAssigned %></p>\n</div><!--/staff-content-->'}),define("text!_common/mobile/watched/tmpl/connections.html",[],function(){return'<ul class="list-group indicators connections">\n    <li class="list-group-item indicator isGsmOnline" data-state="<%= isGsmOnline ? 1 : 0 %>">\n        <svg class="svg-icon list-group-item-icon">\n            <use xlink:href="#smb-connection"></use>\n        </svg>\n        <div class="info">\n            <h4><%= i18n.GSMConnection %></h4>\n            <span class="extra nobr">\n                <span class="lastGSMConnectionTime">\n                <%= lastGSMConnectionTimeS %>\n                </span>\n                <% if(hasLbsData) {%>\n                <a class="lbs-control" href="#">\n                    <i class="svg-icon svg-icon-spinner icon-spin"></i> <span class="lbs-control-label"><%= i18n.showLbs %></span>\n                </a>\n                <% } %>\n            </span>\n        </div>\n    </li>\n    <li class="list-group-item indicator isGpsOnline<% if(isGpsOnline) {%> on<% } %>" data-state="<%= isGpsOnline ? 1 : 0 %>">\n        <svg class="svg-icon list-group-item-icon">\n            <use xlink:href="#smb-satellite"></use>\n        </svg>\n        <div class="info">\n            <h4><%= i18n.coords.ucFirst() %></h4>\n            <span class="lastGPSConnectionTime nobr">\n                <%= lastGPSConnectionTimeS %>\n            </span>\n        </div>\n    </li>\n    <!--<li class="list-group-item indicator power" data-state="<%= power == 0 ? 1 : 0 %>">\n        <svg class="svg-icon list-group-item-icon">\n            <use xlink:href="#smb-plug"></use>\n        </svg>\n        <div class="info">\n            <h4><%= i18n.power.ucFirst() %></h4>\n            <span class="nobr"><%= i18n[power == 0 ? \'powerOn\' : \'powerOff\'] %></span>\n        </div>\n    </li>-->\n</ul>'
}),define("text!_common/mobile/watched/tmpl/power.html",[],function(){return'<strong class="widget-value">\n    <% if(value === null) {%>\n        <svg class="svg-icon">\n            <use xlink:href="#smb-plug"></use>\n        </svg>\n    <% } else {%>\n        <%= value %>\n    <% } %>\n</strong>\n<small class="widget-value-units"><%= units %></small>\n<strong class="widget-label"><%= label %></strong>\n'}),define("text!_common/mobile/watched/tmpl/discrets.html",[],function(){return'<% _.each(discrets, function(d){ %>\n<li class="list-group-item indicator discret-state" data-state="<%= d.state == 1 ? 1 : 0 %>">\n    <svg class="svg-icon list-group-item-icon">\n        <use xlink:href="#smb-arrow-circle-right"></use>\n    </svg>\n    <div class="info">\n        <h4><%- d.name %></h4>\n        <p class="extra"><%= i18n[d.state == 1 ? \'switchedOnShort\' : \'switchedOffShort\'] %></p>\n    </div>\n</li>\n<% }); %>'}),define("text!_common/mobile/watched/tmpl/controls.html",[],function(){return'<% _.each(controls, function(c, index){\nvar isOperatable = controlAllowed && \'undefined\' != typeof c.possibleStates && c.possibleStates.length;\n%>\n<li class="list-group-item indicator control-state"\n    data-state="<%= c.state == 1 ? 1 : 0 %>"<% if(isOperatable) {%> data-page="operate" data-index="<%= index %>"<% } %>>\n    <svg class="svg-icon list-group-item-icon">\n        <use xlink:href="#smb-arrow-circle-left"></use>\n    </svg>\n    <i class="svg-icon list-group-item-icon svg-icon-spinner icon-spin"></i>\n    <% if(isOperatable) {%>\n    <svg class="svg-icon more-action">\n        <use xlink:href="#smb-chevron-right"></use>\n    </svg>\n    <% } %>\n    <div class="info">\n        <h4><%- c.name %></h4>\n        <p class="extra"><%= i18n[c.state === null ? \'noData\' : ( c.state == 1 ? \'switchedOnShort\' : \'switchedOffShort\' )].ucFirst() %></p>\n        <p class="extra state-loading-extra"><%= i18n.objectStateScan %>...</p>\n    </div>\n</li>\n<% }); %>\n'}),define("text!_common/mobile/watched/tmpl/operate.html",[],function(){return'<div class="subheader">\n    <a data-target="summary" class="back" href="#">\n        <i class="svg-icon svg-icon-chevron-circle-left"></i>\n    </a>\n    <h5><%- control.name %></h5>\n</div>\n<div class="operate-content">\n    <div class="operate-state <%= control.state == 1 ? \'on\' : \'off\' %>" data-state="<%= control.state == 1 ? 1 : 0 %>">\n        <div class="state-wrap">\n            <svg class="svg-icon">\n                <use xlink:href="#smb-power"></use>\n            </svg>\n        </div>\n    </div>\n    <div class="operate-actions">\n        <button class="btn btn-block <%= control.state == 1 ? \'\' : \' btn-success\' %>" data-index="<%= index %>" data-command="<%= commands[control.state == 1 ? \'off\' : \'on\'] %>">\n            <%= i18n[control.state == 1 ? \'turnOff\' : \'turnOn\'] %>\n        </button>\n        <% if(control.possibleStates.length > 2) {%>\n        <button class="btn btn-block btn-primary" data-index="<%= index %>" data-command="<%= commands.auto %>">\n            <%= i18n.autoMode %>\n        </button>\n        <% } %>\n    </div>\n</div>\n'}),define("text!_common/mobile/watched/tmpl/followMode.html",[],function(){return'<div class="subheader">\n    <a data-target="summary" class="back" href="#">\n        <i class="svg-icon svg-icon-chevron-circle-left"></i>\n    </a>\n    <h5><%= i18n.followedMode %></h5>\n</div>\n<div class="operate-content">\n    <div class="operate-state" data-state="<%= isFollowed == 1 ? 1 : 0 %>">\n        <div class="state-wrap">\n            <svg class="svg-icon">\n                <use xlink:href="#smb-eye"></use>\n            </svg>\n        </div>\n    </div>\n    <div class="operate-actions">\n        <button class="btn btn-block <%= isFollowed == 1 ? \'\' : \' btn-success\' %> btn-save-follow-mode">\n            <%= i18n[isFollowed == 1 ? \'turnOff\' : \'turnOn\'] %>\n        </button>\n    </div>\n</div>'}),define("_common/mobile/watched/views/MobileInfoView",["jquery","underscore","geo","jface","_common/mobile/MobileDetails","abstracts/watched/views/DeviceInfoView","i18n!_common/nls/common","i18n!mobile/nls/mobile","text!../tmpl/objInfoRestyle.html","text!../tmpl/baloonFooter.html","text!../tmpl/staffInfo.html","text!../tmpl/connections.html","text!../tmpl/power.html","text!../tmpl/discrets.html","text!../tmpl/controls.html","text!../tmpl/operate.html","text!../tmpl/followMode.html"],function($,_,Geo,$jf,MobileDetails,DeviceInfoView,i18nCommon,i18nMobile,tmpl,tmplFooter,tmplStaff,tmplConnections,tmplPower,tmplDiscrets,tmplControls,tmplOperate,tmplFollow){var _super=DeviceInfoView.prototype;tmpl=_.template(tmpl),tmplFooter=_.template(tmplFooter),tmplStaff=_.template(tmplStaff),tmplConnections=_.template(tmplConnections),tmplPower=_.template(tmplPower),tmplDiscrets=_.template(tmplDiscrets),tmplControls=_.template(tmplControls),tmplOperate=_.template(tmplOperate),tmplFollow=_.template(tmplFollow);var _i18n=$.extend({},i18nCommon,i18nMobile),MAX_ADDRESS_RADIUS=100,POWER_STATE_MAIN=0,TEMPERATURE_GREEN=0,TEMPERATURE_RED=25,MobileInfoView=DeviceInfoView.extend({constructor:function(){this.$address=null,this._addressCoords=null,DeviceInfoView.apply(this,arguments)},initialize:function(){var t=this.$el.data("marker"),e=t.getParentCluster();this.$el.removeClass("lbs-shown").addClass("obj-info-restyle obj-info-mobile").toggleClass("obj-info-clustered",null!==e&&e.isSpiderfied()),_super.initialize.apply(this,arguments),this._initFollowMode()},getDetailedModelClass:function(){return MobileDetails},remove:function(){_super.remove.apply(this,arguments),this._lbsShown&&(this._lbsUpdated=!1,this._hideLbs())},_setModel:function(t){DeviceInfoView.prototype._setModel.apply(this,arguments);var e=this.model,i=this.controller.items.get(t);i&&this.listenToOnce(i,"remove",function(){this.stopListening(i)}).listenTo(i,"change:speed",function(t,i){e.set("speed",i)}).listenTo(i,"change:lastPointTime",function(t,i){e.set("lastPointTime",i)}).listenTo(i,"change:alt",function(t,i){e.set("alt",i)}).listenTo(i,"change:coords",function(t,n){e.set({lat:i.get("lat"),lon:i.get("lon"),coords:n})})},_bindEvents:function(){var t=this,e=this.controller,i="click"+this._getEventsNS();DeviceInfoView.prototype._bindEvents.apply(this,arguments),this.listenTo(e,"change:stateLoading",function(e,i){t._stateLoaded||i||(t._renderControls(),t.listenTo(t.model,"change:controls",function(){t._renderControls()}),t._stateLoaded=!0),t._toggleStateLoading(i)});var n=e.get("parent").getMapsModule();n&&(this.listenTo(n,"mapchanged",function(){_private.onAddressChange.call(t)}),this.$el.on(i,".route-from",function(){t.trigger("close");var e=t.model.get("name");return n.openRouting([{type:"mobile",text:e,model:t.model,lat:t.model.get("lat"),lon:t.model.get("lon")}],t.$el),!1})),this.on("searchstart",function(){t.$address&&t.$address.parent().addClass("loading")}).on("searchcomplete",function(){t.$address&&t.$address.parent().removeClass("loading")}).on("searchsuccess",function(e){t._addressCoords=[e.lat,e.lon],t.model.set("address",e.address)}).on("searcherror",function(){var e=Math._round(t.model.get("lat"),4)+", "+Math._round(t.model.get("lon"),4);t.model.set("address",e)}),App.hasModule("tracks")&&this.$el.on(i,".icon-track",function(){return t.controller.trigger("needtrack",[t.model]),t.trigger("close"),!1}),App.reportsAllowed("mobile")&&this.$el.on(i,".cmd-report",function(){return App.trigger("needreport","mobile",[t.model]),t.trigger("close"),!1})},_prebindModelEvents:function(){this.listenTo(this.model,"change:address",function(t,e){this.$address&&this.$address.text(e)})},_bindModelEvents:function(){var t=this;DeviceInfoView.prototype._bindModelEvents.apply(this,arguments),_.each(["licenseNumber","speed","alt"],function(e){t.listenTo(t.model,"change:"+e,function(i,n){"speed"==e&&(n=Math._round(n,2),n<i.get("minSpeed")&&(n=0)),t.$el.find("."+e).text(_.isNull(n)?"":n)})}),this.listenTo(this.model,"change:gsmCellData",function(){this._lbsShown&&this._showLbs()}).listenTo(this.model,"change:coords",function(t){var e=this._addressCoords;if(null!==e){var i=Geo.getDistanceBetweenPoints(e[0],e[1],t.get("lat"),t.get("lon"));i>MAX_ADDRESS_RADIUS&&_private.onAddressChange.call(this)}}),this._bindIndicatorsChanges(),this.listenTo(this.model,"change:driversInfo",function(){t._renderStaff()}).listenTo(this.model,"change:isFollowed",function(e,i){t._setIndicatorState(t.$el.find(".indicator.follow-mode"),1==i)})},_onStateLoadedFirstTime:function(){var t=this;this._renderControls(),this.listenTo(t.model,"change:controls",function(){t._renderControls()})},_toggleStateLoading:function(t){this.$el.find(".controls")[t?"addClass":"removeClass"]("state-loading")},_bindIndicatorsChanges:function(){var t=this;this.listenTo(this.model,"change:lastGPSConnectionTime",function(e,i){t.$el.find(".lastGPSConnectionTime").text(t.formatDateTime(i))}).listenTo(this.model,"change:lastGSMConnectionTime change:isGsmOnline",function(){t.$el.find(".lastGSMConnectionTime").text(t._formatConnectionTime())}),_.each(["isGpsOnline","isGsmOnline"],function(e){!function(e){t.listenTo(t.model,"change:"+e,function(i,n){t._setIndicatorState(t.$el.find("."+e),n),"isGsmOnline"==e&&(t.$el.toggleClass("obj-info-online",n),t._lbsShown&&t._drawLbs())})}(e)}),this.listenTo(this.model,"change:power change:voltage",function(){t._renderPower()}),t.listenTo(t.model,"change:discrets",function(){t._renderDiscrets()}),_.each(["localRID","remoteRID"],function(e){!function(e){t.listenTo(t.model,"change:"+e,function(){t._renderTrackReading()})}(e)})},_renderContent:function(t){if(this.$content){t=t===!0;var e=this.model,i=this.controller.getUserData("activeWidget")||"speed",n=e.get("isGsmOnline"),s=e.attributes.temperature,o=_.extend({},e.attributes,{i18n:_i18n,prerender:t,geoId:e.has("geoId")?e.get("geoId"):0,addressStr:e.has("address")?e.get("address"):Math._round(e.get("lat"),4)+", "+Math._round(e.get("lon"),4),hiddenProps:this.controller.getHiddenProperties(),activeWidget:i,controlFollowed:App.allowed("control.followed"),showTemperature:!!e.attributes.tempDetector,tempClass:s>=TEMPERATURE_RED?"temperature-panel-red":s>TEMPERATURE_GREEN?"temperature-panel-green":""}),a=["obj-info-compact"];e.get("hasAlarm"),n&&a.push("obj-info-online"),a.length&&this.$el.addClass(a.join(" ")),_.extend(o,{lastGSMConnectionTimeS:t&&!n?"&nbsp;":this._formatConnectionTime(),lastGPSConnectionTimeS:t?"&nbsp;":this.formatDateTime(e.get("lastGPSConnectionTime")),ridPercent:null,hasLbsData:e.has("gsmCellData")}),t||o.remoteRID&&(o.localRID>o.remoteRID&&(o.localRID=o.remoteRID),o.ridPercent=Math.round(100*o.localRID/o.remoteRID)),o.htmlConnections=tmplConnections(o),o.compact=!0,this.$content.html(tmpl(o)),this.$address=this.$el.find(".address"),(!e.has("address")||t)&&_private.onAddressChange.call(this),t||(this._toggleStateLoading(this.controller.get("stateLoading")),this._renderPower(),this._renderDiscrets(),this._renderControls(),this._renderStaff(),this._renderTrackReading(),this._initLbs()),this._initWidgets()}},_renderFooter:function(){var t=this.controller.get("parent").getMapsModule();this.$el.find(".extra-actions").html(tmplFooter({i18n:_i18n,routingModule:t&&t.modules.routing||null}))},_renderPower:function(){var t=this.model.get("power"),e=this.model.get("voltage"),i=this.$el.find('.widget[data-value="power"]'),n=this.$el.find('.widgets-nav-item[data-value="power"]'),s=_i18n.power,o=t==POWER_STATE_MAIN;null!==e&&(s=o?_i18n.powerMain:_i18n.powerReserve),i.attr("data-state",o?1:0).html(tmplPower({label:s.ucFirst(),value:e,units:null===e?_i18n[o?"powerOn":"powerOff"]:_i18n.volt})),n.attr("data-state",o?1:0)},_renderDiscrets:function(){this._renderDiscretsOrControls("discrets")},_renderControls:function(){var t=this.model.get("controls"),e=this._controlIndex;this._renderDiscretsOrControls("controls"),e&&(e in t&&"possibleStates"in t[e]?this._renderOperate():this._closeOperate())},_renderDiscretsOrControls:function(key){var $el=this.$el.find("."+key),data=this.model.get(key),len=_.keys(data).length,wasHidden=$el.hasClass("hidden"),tmpl=eval("tmpl"+key.ucFirst()),tmplData={i18n:_i18n,controlAllowed:App.allowed("control")};wasHidden&&len?$el.removeClass("hidden"):wasHidden||len||$el.addClass("hidden"),len&&(tmplData[key]=data,$el.html(tmpl(tmplData)))},_renderTrackReading:function(){var t=this.model,e=0,i=t.get("localRID")||0,n=t.get("remoteRID")||0;this.$el.find(".rid-percent"),n>0&&(i>n&&(i=n),e=Math.round(100*i/n)),this.$el.find(".localRID").text(i).end().find(".remoteRID").text(n).end().find(".rid-percent").text(e).attr("data-hint",i+" "+this.controller.getTexts().from+" "+n)},_renderStaff:function(){var t=this.model.get("driversInfo"),e=this.$el.find("[data-page=staff]"),i=this.$el.find(".content[data-key=staff]");try{var n=$.parseJSON(t),s=tmplStaff({driversInfo:n,i18n:_i18n});i.html(s),n.length?e.removeClass("hidden"):e.addClass("hidden")}catch(o){e.addClass("hidden"),this.setActivePage("summary")}},_renderOperate:function(){if(this._controlIndex){var t=this.model.get("controls"),e=this.$el.find(".content[data-key=operate]");t&&this._controlIndex in t?e.html(tmplOperate({i18n:_i18n,index:this._controlIndex,control:t[this._controlIndex],commands:{on:1,off:2,auto:3}})):this._closeOperate()}},_initFollowMode:function(){var t=this,e=t.model;this.$el.off("click.follow").on("click.follow","[data-page=follow]",function(e){return e.stopPropagation(),t._renderFollowMode(),!1}).on("click.follow",".btn-save-follow-mode",function(){return t.$el.addClass("loading"),e.setFollowMode(1!=e.get("isFollowed")).done(function(){t._onOperateSuccess(!1)}).fail(function(e){t.showErrors(e)}).always(function(){t.$el.removeClass("loading")}),!1})},_renderFollowMode:function(){var t=this.$el.find(".content[data-key=follow]");t.html(tmplFollow({i18n:this.controller.getTexts(),isFollowed:this.model.get("isFollowed")}))},_getLbsData:function(){var t=new $.Deferred,e=this.model.get("gsmCellData"),i=JSON.stringify(_.omit(e,"lbsDate","rxl"));return i in this._lbsCache?"string"==typeof this._lbsCache[i]?t.reject(this._lbsCache[i]):t.resolve(this._lbsCache[i]):($.ajax({url:App.getBaseUrl()+"lbs/",data:{objectId:this.model.id,mcc:e.mcc,mnc:e.mnc,cellid:e.cellid,lac:e.lac}}).done(function(e){var n=e.error,s=e.position,o=null;(n||!s)&&(n||(n="Unknown restapi/lbs response format. Attribute is absent"),this._lbsCache[i]=n,t.reject(n)),s&&(o={center:[s.latitude,s.longitude],radius:s.precision},this._lbsCache[i]=o,t.resolve(o))}.bind(this)).fail(function(e){t.reject(e)}),t)},_prepareLbsSearchParams:function(){return this.model.get("gsmCellData")},_getTexts:function(){return _i18n}}),_private={onAddressChange:function(){this.$address&&this.$address.length&&this.controller.trigger("needgeoinfo",this.model.pick("lat","lon"),this)}};return MobileInfoView}),define("_common/stat/StatObject",["underscore","jquery","abstracts/GrObject"],function(t,e,i){var n=i.prototype,s=i.extend({constructor:function(){i.apply(this,arguments)},IMG_DIR:"img/stat/",HW_STATE_ARMED:2,HW_STATE_DISARMED:1,CSD_CALL_STATE_NOT_FOUND:0,CSD_CALL_STATE_PROCESSING:1,CSD_CALL_STATE_FAIL:2,CSD_CALL_STATE_SUCCESS:3,ERR_NO_AREA:0,ERR_AREA_UNAUTHORIZED:1,url:App.getBaseUrl()+"objects/obj",defaults:t.extend({},i.prototype.defaults,{objType:App.TYPE_STAT,addressShort:"",isOnline:0,isGuarded:0,hasFault:0,faults:null}),parse:function(){var e=n.parse.apply(this,arguments);return"undefined"==typeof e.imgPath&&(e.imgPath=19),"undefined"!=typeof e.objectState&&(t.each(["isGuarded","hasAlarm","hasFault","isOnline"],function(t){e[t]=e.objectState[t]}),delete e.objectState),"objStatus"in e||(e.objStatus=this.STATUS_SERVED),0===e.hasAlarm||i.alarmsAllowed(e.objStatus)||(e.hasAlarm=0),e.status=s.detectGuardStatus(e),e.hwStatus=s.detectHardwareStatus(e),e.coords=[e.lat||null,e.lon||null],e.showTemperature=o.getShowTemperature(e.tempDetectors,e.temperature),e},isOnline:function(){return 1==this.get("isOnline")},getAreasWhere:function(e){return this.attributes.areas&&this.attributes.areas.length?t.filter(this.attributes.areas,function(i){var n=!0;return t.each(e,function(e,s){"undefined"!=typeof i[s]&&(n&=t.isBoolean(e)?!!i[s]==e:i[s]==e)}),n}):[]},getNotZeroAreas:function(e){if(!this.attributes.areas||!this.attributes.areas.length)return[];var i=e?this.getAreasWhere(e):this.attributes.areas;return t.filter(i,function(t){return 0!=t.num})},getRealAreasState:function(){return e.ajax({url:App.getBaseUrl()+"objects/state/",data:{imei:this.get("imei")}})},toggleGuard:function(t,i){var n=this,s=new e.Deferred;return t=parseInt(t),this.getRealAreasState().done(function(o){var a=o.state;t in a?i&&a[t]==n.HW_STATE_DISARMED||!i&&a[t]==n.HW_STATE_ARMED?e.ajax({url:App.getBaseUrl()+"objects/"+(i?"arm":"disarm")+"/",data:{imei:n.get("imei"),area:t},statusCode:{401:function(){s.reject(n.ERR_AREA_UNAUTHORIZED)}},success:function(){s.resolve()},error:function(t){401!==t.status&&s.reject(t)}}):s.resolve():s.reject(n.ERR_NO_AREA)}).fail(function(t){s.reject(t)}),s},loadChannels:function(){var t=new e.Deferred,i=this;return this.set("channels",null),e.ajax({url:App.getBaseUrl()+"channels/",data:{objectId:this.id},success:function(e){i.loadChannelsSuccess.call(i,e,t)},error:function(e){t.reject(e)}}),t},loadChannelsSuccess:function(e,i){var n=this;if(Array.isArray(e&&e.channels)){var s=[];t.each(e.channels,function(t){var i=e[t];i?("SIM_1"===t||"SIM_2"===t)&&i.inserted&&i.online&&("undefined"==typeof i.level||"undefined"==typeof i.percent)&&s.push(t):s.push(t)}),s.length>0?n.loadChannelsLevels.call(n,e,i,s):(n.set("channels",e),i.resolve(e))}else i.reject(null)},loadChannelsLevels:function(i,n,s){var o=this,a=[],r=!1,l=Object.assign({},i),c=new e.Deferred,h=s.length,d=function(t,e){t&&t[e]&&(l[e]=t[e]),h--,1>h&&c.resolve()};t.each(s,function(t){var i={objectId:o.id,channel:t};"SIM_1"===t||"SIM_1"===t?(r||a.push(e.ajax({url:App.getBaseUrl()+"channels/level/",data:i}).done(function(e){d(e,t)})),r=!0):a.push(e.ajax({url:App.getBaseUrl()+"channels/level/",data:i}).done(function(e){d(e,t)}))}),e.when(c).always(function(){o.set("channels",l),n.resolve(l)}).fail(function(){n.reject(null)})},setControlCommand:function(t,i){var n=new e.Deferred;return e.ajax({url:App.getBaseUrl()+"objects/out-set/",data:{objectId:this.id,out:t,set:i},success:function(t){t.result===!0?n.resolve():n.reject(null)},error:function(t){n.reject(t)}}),n},loadFaults:function(){var t=this;return e.ajax({url:App.getBaseUrl()+"objects/obj-faults/",data:{objectId:this.id},success:function(e){t.set("faults",e)},error:function(){t.set("faults",null)}})},resolveFaults:function(i){var n=this,s=new e.Deferred,o=[];return i?o[0]={faultCode:Number(i.code),areaZoneId:Number(i.zone)}:t.each(this.get("faults"),function(t){o.push({faultCode:t.faultCode,areaZoneId:t.areaZoneId})}),e.ajax({url:App.getBaseUrl()+"objects/clear-faults/",data:o,complete:function(e){if(e.status>=200&&e.status<300){if(i){var o=t.filter(n.get("faults"),function(t){return t.areaZoneId!=i.zone||t.faultCode!=i.code});o.length?n.set("faults",o):n.set({hasFault:!1,faults:null})}else n.set("faults",null);s.resolve()}else s.reject()}}),s},callDevice:function(){var t=new e.Deferred;return e.ajax({url:App.getBaseUrl()+"objects/obj-scan/",data:{objectId:this.id}}).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t}});s.detectGuardStatus=function(t){if("status"in t)return t.status;var e="green";return t.isGuarded&&(e=1==t.isGuarded?"blue":"greenblue"),e},s.detectHardwareStatus=function(t){if("hwStatus"in t)return t.hwStatus;var e="offline";return t.isOnline&&(e=t.hasFault?"fault":"online"),e};var o={getShowTemperature:function(t,e){if(e||0===e)return!0;if(!t)return!1;try{var i=JSON.parse(t);return i.length>0}catch(n){console.log("🚀 ~ file: StatObject.js ~ line 99 ~ e",n)}return!1}};return s}),define("_common/stat/StatObjectsCollection",["underscore","abstracts/ObjectsCollection","./StatObject"],function(t,e,i){var n=e.extend({constructor:function(){e.apply(this,arguments)},url:App.getBaseUrl()+"objects/obj/",model:i});return n}),define("_common/guards/Guard",["underscore","jquery","abstracts/Model","geo"],function(t,e,i,n){var s=i.extend({COORDS_EXPIRE_TIME:3e5,constructor:function(){i.apply(this,arguments)},defaults:{name:"",person:"",phone:"",comment:"",groupsIds:[],coords:[],coordinatesTime:null,lat:0,lon:0,speed:0,course:0,isOnline:!1,isGpsOnline:!1,hwStatus:"offline",guardCall:null,route:null,calledByMe:!1,isBound:!1},parse:function(t){var e=t.item||t.length&&t[0]||t;return e.coords=null,e.lat&&e.lon&&(e.coords=[e.lat,e.lon]),e.hwStatus=s.detectHardwareStatus(e),"guardCall"in e||(e.guardCall=null),o.setDistance.call(this),e},acceptedCall:function(){var t=this.get("guardCall");return t&&null!==t.acceptTs},arrived:function(){var t=this.get("guardCall");return t&&null!==t.arriveTs},hasTargetInfo:function(){var t=this.get("guardCall");return t&&"id"in t.target},cancelCall:function(){var t=this;return e.ajax({url:"fixtures/guard-cancel.json",data:{id:this.id}}).done(function(){t.set({guardCall:null})})}});s.detectHardwareStatus=function(t){if("hwStatus"in t)return t.hwStatus;var e="offline";return t.isGpsOnline=t.coordinatesTime>0&&+new Date-t.coordinatesTime<s.prototype.COORDS_EXPIRE_TIME,t.isGpsOnline&&t.isOnline?e="online":t.isOnline&&(e="fault"),e};var o={setDistance:function(){var t=this.get("guardCall"),e=this.get("coords");t&&e&&t.target.lat&&t.target.lon?this.set("distance",n.getDistanceBetweenPoints(e[0],e[1],t.target.lat,t.target.lon)):this.set("distance",null)}};return s}),define("_common/guards/GuardsCollection",["abstracts/ObjectsCollection","./Guard"],function(t,e){var i=t.extend({constructor:function(){t.apply(this,arguments)},url:function(){return App.getBaseUrl()+"guards/guard/"},model:e,idProp:"guardId"});return i}),define("_common/guards/update/GuardsUpdateModule",["underscore","abstracts/update/UpdateModule"],function(t,e){var i=e.prototype,n=e.extend({constructor:function(){e.apply(this,arguments)},defaults:t.extend({},i.defaults,{updatePeriod:15e3,idParam:"guardId",url:function(){return App.getBaseUrl()+"guards/guard/"}}),destroy:function(){this.stopListening(),App.unsubscribe(this)}});return n}),define("text!_common/guards/watched/tmpl/baloon.html",[],function(){return'<div data-key="summary" class="content active">\n   <!-- <div class="row-fluid">\n        <div class="features span12">-->\n            <ul class="features">\n                <li>\n                    <%= i18n.rrtPerson %>:\n                    <strong>\n                        <span class="person"><%= person || \'--\'%></span>\n                    </strong>\n                </li><li>\n                    <%= i18n.phone.ucFirst() %>:\n                    <strong>\n                        <span class="phone"><%= phone || \'--\'%></span>\n                    </strong>\n                </li><li>\n                    <%= i18n.comments.ucFirst() %>:\n                    <strong>\n                        <span class="comment"><%= comment || \'--\'%></span>\n                    </strong>\n                </li><li>\n                    <%= i18n.rrtLocation %>:\n                    <strong data-geoid="<%= geoId %>" class="address">\n                        <i class="svg-icon svg-icon-spinner icon-spin"></i><% if(addressStr != null) { %><%- addressStr %><% } else { %><%= i18n.addressNotFound %> [0,0]<% } %>\n                    </strong>\n                </li><li>\n                    <%= i18n.coordinatesTime %>:\n                    <strong class="coordsTime"><%= coordsTimeStr %></strong>\n                </li><li>\n                    <%= i18n.speed.ucFirst() %>:\n                    <strong>\n                        <span class="speed"><%= speed < minSpeed ? 0 : Math._round(speed, 2) %></span> <%= i18n.kmh %>\n                    </strong>\n                </li>\n            </ul>\n\n    <!--</div>/features-->\n\n    <!--</div>/row-fluid-->\n\n    <div class="call-info"></div>\n\n</div><!--/content summary-->'}),define("text!_common/guards/watched/tmpl/baloonHeader.html",[],function(){return'<div class="header clearfix">\n    <div class="actions">\n        <a class="hint hint-top svg-icon svg-icon-target icon-target" href="javascript:;" data-hint="<%= i18n.zoomToObject %>"></a>\n        <a class="hint hint-top svg-icon svg-icon-circle-remove icon-close" href="javascript:;" data-hint="<%= i18n.close.ucFirst() %>"></a>\n    </div>\n    <h4><%= i18n.rrTeamShort %>: <span data-prop="name" class="name"><%- name %></span></h4>\n</div>'}),define("text!_common/guards/watched/tmpl/baloonFooter.html",[],function(){return'<div class="extra-actions">\n    <a class="unwatch" href="javascript:;"><%= i18n.removeFromMap %></a>\n\n    <% if(routingModule) {%>\n    <a href="#" class="route-from pull-right"><%= i18n.buildRoute %></a>\n    <% } %>\n</div>'}),define("text!_common/guards/watched/tmpl/callInfo.html",[],function(){return'<% if(!guardCall) {%>\n<span class="no-call"><%= i18n.rrtNoCall %></span>\n<% } else if(targetTitle) { %>\n<strong><%= guardCall.acceptTs > 0 ? i18n.rrtCallAccepted : i18n.rrtCallNotAccepted %></strong>\n<a href="#" class="target-info">#<%= guardCall.target.extId %> <%- targetTitle %></a>\n<% } else { %>\n<strong>Occupied</strong>\n<% } %>\n\n'}),define("_common/guards/watched/views/GuardInfoView",["jquery","underscore","geo","jface","_common/guards/Guard","abstracts/View","text!../tmpl/baloon.html","text!../tmpl/baloonHeader.html","text!../tmpl/baloonFooter.html","text!../tmpl/callInfo.html"],function(t,e,i,n,s,o,a,r,l,c){o.prototype,a=e.template(a),r=e.template(r),l=e.template(l),c=e.template(c);var h=100,d=".guarddetails",u=o.extend({constructor:function(t){this.parent=t.parent,this.controller=t.controller,this.$content=null,this.$address=null,this.$callInfo=null,o.apply(this,arguments)},initialize:function(){this.$el.addClass("guard-info"),this.render(),this._bindEvents()},render:function(){var t=this,e=this.$el.find(".leaflet-popup-content");e.find(".contents").length||(e.html(this._renderHeader()+'<div class="contents"></div>'+this._renderFooter()),this.$content=this.$el.find(".contents")),t._renderContent(),t.$el.trigger("contentchange")},remove:function(){this.stopListening(),this.$el.off(d),this.$content&&this.$content.remove()},_bindEvents:function(){var t=this,e="click"+d,i=this.controller.get("parent").getMapsModule();this.listenTo(this.parent,"clear",function(){t.trigger("close")}),this._bindModelEvents(),this.$el.on(e,".icon-close",function(){t.trigger("close")}).on(e,".icon-target",function(){t.controller.trigger("itemzoom",t.model)}).on(e,".unwatch",function(){t.trigger("close"),t.controller.unwatchItem(t.model.id)}).on(e,".target-info",function(){t.model.has("guardCall")&&App.trigger("needdevicehistory",t.model.get("guardCall").target)}),"undefined"!=typeof PRODUCTION&&this.$el.on("contextmenu",function(){return!1}),i&&(this.listenTo(i,"mapchanged",function(){p.onAddressChange.call(t)}),this.$el.on(e,".route-from",function(){t.trigger("close");var e=t.model.get("name");return i.openRouting([{type:"guard",text:e,model:t.model,lat:t.model.get("lat"),lon:t.model.get("lon")}],t.$el),!1})),this.on("searchstart",function(){t.$address&&t.$address.parent().addClass("loading")}).on("searchcomplete",function(){t.$address&&t.$address.parent().removeClass("loading")}).on("searchsuccess",function(e){t.model.set("address",e.address)}).on("searcherror",function(){var e=Math._round(t.model.get("lat"),4)+", "+Math._round(t.model.get("lon"),4);t.model.set("address",e)})},_bindModelEvents:function(){var t=this;e.each(["name","phone","person","comment"],function(i){t.listenTo(t.model,"change:"+i,function(n,s){t.$el.find("."+i).text(e.isNull(s)?"--":s)})}),t.listenTo(t.model,"change:speed",function(e,i){i=Math.round(i),2>i&&(i=0),t.$el.find(".speed").text(i)}).listenTo(this.model,"change:coords",function(e){var n=e.previous("lat"),s=e.previous("lon"),o=i.getDistanceBetweenPoints(n,s,e.get("lat"),e.get("lon"));o>h&&p.onAddressChange.call(t)}).listenTo(this.model,"change:coordinatesTime",function(i,n){t.$el.find(".coordsTime").text(e.isNull(n)?"--":t.formatDateTime(n))}).listenTo(this.model,"change:address",function(e,i){t.$address&&t.$address.text(i)}).listenTo(this.model,"change:guardCall",e.bind(p.onCallChange,this))},_renderHeader:function(){return r({i18n:this.controller.getTexts(),name:this.model.get("name")})},_renderContent:function(){if(this.$content){var t=this.model.get("coordinatesTime"),i=e.extend({},this.model.attributes,{i18n:this.controller.getTexts(),minSpeed:2,geoId:this.model.has("geoId")?this.model.get("geoId"):0,coordsTimeStr:t?this.formatDateTime(t):"--",addressStr:this.model.has("address")?this.model.get("address"):Math._round(this.model.get("lat"),4)+", "+Math._round(this.model.get("lon"),4)});this.$content.html(a(i)),this.$address=this.$el.find(".address"),this.$callInfo=this.$content.find(".call-info"),this.model.has("address")||p.onAddressChange.call(this),p.onCallChange.call(this)}},_renderFooter:function(){var t=this.controller.get("parent").getMapsModule();return l({i18n:this.controller.getTexts(),routingModule:t&&t.modules.routing||null})}}),p={onAddressChange:function(){this.$address&&this.$address.length&&this.controller.trigger("needgeoinfo",this.model.pick("lat","lon"),this)},onCallChange:function(){var t=this.controller.getTexts(),i="";if(this.model.has("guardCall")){var n=this.model.get("guardCall").target;n.id&&(i=App.buildObjTitle(n))}this.$callInfo.html(c(e.extend({},this.model.attributes,{i18n:t,targetTitle:i})))}};return u}),define("text!_common/guards/watched/tmpl/mapIcon.svg",[],function(){return'<svg class="svg-icon">\n	<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#smb-shield-alt"></use>\n</svg>'}),define("_common/guards/watched/views/GuardsMapView",["jquery","underscore","_common/guards/Guard","abstracts/watched/views/WatchedView","./GuardInfoView","text!../tmpl/mapIcon.svg"],function(t,e,i,n,s,o){var a=n.prototype,r=n.extend({constructor:function(){this._useClusters=!1,n.apply(this,arguments)},addWatchedMulti:function(t){if(t){var e,i,n=t.length,s=this.model.items,o=[];if(t.length){for(var a=this._cloneCurrentBounds();n--;)if(i=s.get(t[n])){var r=this.ensureCoords(i);this._bindModelEvents(i),(e=this._buildMapElement(i))&&o.push(e),r&&(a=this._extendBounds(a,i.get("lat"),i.get("lon")))}this._afterViewsBuilt(a)}o.length&&(null===this._singlesLayer?this._createSinglesLayer(o):this._singlesLayer.addLayers(o))}},_onModuleReady:function(){var t=this.model.items;if(t.length){var e,i=this,n=[],s=this._getNullBounds();t.each(function(t){var o=i.ensureCoords(t);i._bindModelEvents(t),(e=i._buildMapElement(t))&&n.push(e),o&&(s=i._extendBounds(s,t.get("lat"),t.get("lon")))}),t.length&&this.model.set("bounds",s,{zoom:!1}),this._createSinglesLayer(n)}},_bindModelEvents:function(t){var e=this;a._bindModelEvents.call(this,t),this.listenTo(t,"change:guardCall",function(t,i){var n=t.previous("guardCall");if(!i||!n){var s;(s=e._viewsMap[t.id])&&s.trigger("toggleclass",i?{on:"busy"}:{off:"busy"})}})},_buildMapElement:function(t){if(t.get("lat")&&t.get("lon")){var e=" guard "+t.get("hwStatus");t.get("guardCall")&&(e+=" busy");var i=this._viewsMap[t.id]=this._maps.getWidget().buildComplexMarker({lat:t.get("lat"),lon:t.get("lon"),html:this._renderIcon(t),className:"complex-icon obj"+e,dataId:t.id,animated:!1,model:t});return this.model.get("showBaloon")&&this._bindPopup(i,t),i}},_renderIcon:function(t){return'<i class="i">'+o+'</i><span class="name">'+e.escape(t.get("name"))+"</span>"},_placeOnMap:function(t){if(t.has("lat")&&t.has("lon")){var e=this._viewsMap[t.id],i=t.get("lat"),n=t.get("lon"),s={model:t,to:{lat:i,lon:n},animate:!1};e.trigger("place",s)}},_buildInfoView:function(t,e){this._infoView=new s({el:e,parent:this,controller:this.model,model:t})}});return r}),define("_common/guards/watched/GuardsWatchedModule",["underscore","abstracts/watched/WatchedModule","_common/guards/Guard","_common/guards/GuardsCollection","./views/GuardsMapView"],function(t,e,i,n,s){var o=e.prototype,a=e.extend({constructor:function(){this.items||(this.items=new n),e.apply(this,arguments)
},_viewClass:s,getWatchedItemsIds:function(){var t,e=this.get("parent");return t=e.guards?e.guards.pluck("id"):this.getUserData("items"),t||[]},_bindEvents:function(){var t=this;o._bindEvents.call(this),this.off("change:objViewType").off("change:bounds").on("change:bounds",function(e,i,n){n&&n.zoom&&t.get("parent").getMapsModule().setBounds(i,{maxZoom:App.get("commonBoundsMaxZoom"),padding:App.get("commonBoundsPadding")})})}});return a});