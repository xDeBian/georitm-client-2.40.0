var PRODUCTION=!0;define("mobile/MobileObjectsGroup",["jquery","underscore","abstracts/Group"],function(e,t,n){var i=n.extend({constructor:function(){n.apply(this,arguments)}});return i}),define("abstracts/GroupsCollection",["underscore","abstracts/Collection"],function(e,t){var n=t.extend({constructor:function(){this.module=null,t.apply(this,arguments)},parse:function(e){return e.groups||e.group&&e.group.groups||e}});return n}),define("mobile/MobileObjectsGroupsCollection",["abstracts/GroupsCollection","mobile/MobileObjectsGroup"],function(e,t){var n=e.extend({constructor:function(){e.apply(this,arguments)},model:t});return n}),define("text!mobile/tmpl/mobileModule.html",[],function(){return'<div id="mobile" class="tab-hor-content loading">\n    <div class="box-header module-header append">\n\n        <form class="form-search"<% if(hasSettings || allowCreate){ %> style="right:<%= hasSettings && allowCreate ? \'80\' : \'40\' %>px"<% } %>>\n            <div class="input-append input-prepend">\n                    <span class="add-on">\n                        <input name="q" type="text" placeholder="<%= i18n.searchObjects %>" value="" autocomplete="off" />\n                        <i class="icon-clear svg-icon svg-icon-circle-remove"></i>\n                    </span>\n                    <button class="btn add-on btn-search"><i class="svg-icon svg-icon-search"></i></button>\n            </div>\n        </form>\n\n        <% if(hasSettings){ %>\n        <div class="dropdown module-settings add-on">\n            <a class="dropdown-toggle" data-toggle="dropdown" href="#">\n                <i class="svg-icon svg-icon-cog"></i>\n            </a>\n            <ul class="dropdown-menu nav nav-list" role="menu">\n\n            </ul>\n        </div>\n        <% } %>\n\n        <% if(allowCreate) { %>\n        <div class="dropdown module-adding add-on">\n            <a class="dropdown-toggle" data-toggle="dropdown" href="#">\n                <i class="svg-icon svg-icon-plus"></i>\n            </a>\n            <ul class="dropdown-menu nav nav-list" role="menu">\n                <% if(App.allowed(\'objects.create\')) {%>\n                <li><a class="add-item" href="javascript:;"><%= i18n.addObject %></a></li>\n                <% } %><% if(App.allowed(\'objectgroups.create\')) { %>\n                <li><a class="add-group" href="javascript:;"><%= i18n.addGroup %></a></li>\n                <% } %>\n            </ul>\n        </div>\n        <% } %>\n\n    </div>\n\n    <div class="module-content">\n        <div id="mobile-tree" class="tree slick-tree tree-grid">\n\n        </div>\n    </div>\n\n</div>\n'}),define("mobile/views/MobileModuleView",["jquery","underscore","abstracts/ModuleView","text!mobile/tmpl/mobileModule.html"],function(e,t,n,i){var a=n.extend({constructor:function(){this._tmpl=t.template(i),n.apply(this,arguments)},initialize:function(){var t=this;n.prototype.initialize.apply(this,arguments),e("#page").on("keypress","input[name=maxDist]",function(t){t.keyCode&&13==t.keyCode&&e(this).siblings(".find-nearest-btn").trigger("click")}).on("click",".find-nearest-btn",function(){var n=e(this),i=n.closest(".leaflet-popup"),a=i.find("input[name=maxDist]").val().replace(",","."),s=i.data("marker"),l=s.getLatLng();t.model.trigger("neednearest",a,l,i),s.trigger("popreset")}).on("click",".build-route",function(){var n=e(this),i=n.closest(".marker-info"),a=i.data("marker"),s=a.getLatLng();t.model.openRouting(s,i)})}});return a}),define("mobile/MobileModule",["jquery","underscore","abstracts/ObjectsTypeModule","_common/mobile/MobileObject","_common/mobile/MobileObjectsCollection","mobile/MobileObjectsGroup","mobile/MobileObjectsGroupsCollection","mobile/views/MobileModuleView","css!mobile/css/mobile","i18n!_common/nls/common","i18n!mobile/nls/mobile"],function(e,t,n,i,a,s,l,o,r,c,d){var p={update:"mobile/update/MobileUpdateModule",tree:"mobile/tree/MobileTreeModule",watched:"mobile/watched/MobileWatchedModule",itemcard:"mobile/itemcard/MobileItemCardModule",editor:"mobile/editor/MobileEditorModule"},m=n.prototype,u=n.extend({constructor:function(){this.GroupsClass=s,n.apply(this,arguments)},defaults:t.extend({},m.defaults,{objType:"mobile"}),_setI18n:function(){this._i18n=e.extend({},c,d)},_makeView:function(){this._view=new o({container:this.get("container"),placeholder:this.get("placeholder"),model:this,allowCreate:App.allowed("objects.create")||App.allowed("objectgroups.create")})},getFoundAddressActions:function(){var e=[],t=this;return this.modules.watched&&e.push({html:function(){return'<div class="find-nearest form-horizontal"><div class="field"><span class="help-inline"><a class="find-nearest-btn" href="#">'+t._i18n.show.ucFirst()+" "+t._i18n.vehicles.toLowerCase()+"</a> "+t._i18n.inRadius+"</span>"+' <input class="input-mini positive" type="text" value="'+(App.getUserData("maxSearchDist")||1)+'" name="maxDist"> '+'<span class="help-inline">'+t._i18n.km+"</span>"+"</div></div>"}}),e},getPossibleStates:function(){return{1:this._i18n.states.standard,2:this._i18n.states.repared,3:this._i18n.states.technicalService,4:this._i18n.states.switchedOff}},getSpeedLimits:function(){return this.get("parent").getSpeedLimits()},_getPathes:function(){return p},_bindEvents:function(){var i=this,a=this.modules.watched;n.prototype._bindEvents.call(this),this.on("neednearest",function(n,s,l){if("undefined"!=typeof n&&t.isObject(s)){var n=parseFloat(n),o=s.lon||s.lng;0>=n||(App.setUserData("maxSearchDist",n),e.ajax({url:App.getBaseUrl()+"objects/search/nearest-objs/",data:{maxDist:1e3*n,lat:s.lat,lon:o},success:function(e){e.length?a.setItems(e):alert(i._i18n.noObjectsFound,{okCallback:function(){l&&l.find("input[name=maxDist]").focus()}})},error:function(){}}))}})}});return u}),define("mobile/update/MobileUpdateModule",["underscore","abstracts/update/UpdateModule"],function(e,t){var n=t.extend({constructor:function(){t.apply(this,arguments)}});return n}),define("text!abstracts/tree/tmpl/objectTitle.html",[],function(){return'<div class="cell-row" style="left: <%= (20 * indent) %>px;" data-action="check">\n    <% if(isgroup) { %>\n        <% if(id == 0) { %><% } else if(items.length || groups.length) { %>\n            <i class="icon icon-exp toggle <%= closed ? \'collapse\': \'expand\' %>"></i>\n        <% } else { %>\n            <i class="icon icon-exp toggle"></i>\n        <% } %>\n    <% } %>\n\n    <% if(isgroup && nbItems == 0) { %>\n        <i class="item-check-false"></i>\n    <% } else { %>\n        <i data-action="check" class="icon icon-check item-check<%= checked === 1 ? \' checked\': (checked === 2 ? \' indeterminate\': \'\') %>" ></i>\n    <% } %>\n\n    <% if(isgroup) { %>\n        <strong class="row-title" data-action="check"><%- name %></strong>\n    <% } else { %>\n        <span class="row-title item-title" data-grid-itemid="<%= id %>"><%- title %></span>\n    <% } %>\n</div>'}),define("text!mobile/tree/tmpl/status.html",[],function(){return'<% if(isgroup) { %>\n\n    <span class="nb-items" data-action="check">(<%= nbItems %>)</span>\n    <% if(id != \'0\') { %>\n    <i class="icon icon-edit svg-icon svg-icon-caret-down"></i>\n    <% } %>\n\n<% } else { %>\n\n    <i class="restricted-icon" data-action="check"></i>\n    <i class="status-icon" data-action="check"></i>\n    <% if(\'undefined\' != typeof restricted && restricted !== null) {%>\n    <% } %>\n    <i class="icon icon-edit svg-icon svg-icon-caret-down"></i>\n\n<% } %>'}),define("text!mobile/tree/tmpl/context.html",[],function(){return'<% if(isgroup) {%>\n    <% if(nbItems && App.reportsAllowed(\'mobile\')) { %>\n        <li><a href="#" data-action="group_report"><%= i18n.buildReportByGroup %></a></li>\n    <% } %>\n    <% if(App.allowed(\'objectgroups.edit\')) { %>\n        <li><a href="#" data-action="group_edit"><%= i18n.renameGroup %></a></li>\n    <% } %>\n    <% if(App.allowed(\'objects.create\')) { %>\n        <li><a href="#" data-action="group_add_object"><%= i18n.addObject %></a></li>\n    <% } %>\n    <% if(App.allowed(\'objectgroups.create\')) { %>\n        <li><a href="#" data-action="group_add_group"><%= i18n.addChildGroup %></a></li>\n    <% } %>\n<% } else {%>\n    <% if(App.hasModule(\'tracks\')) { %>\n        <li><a href="#" data-action="obj_track"><%= i18n.buildTrack %></a></li>\n    <% } %><% if(App.reportsAllowed(\'mobile\')) { %>\n        <li><a href="#" data-action="obj_report"><%= i18n.buildReport %></a></li>\n    <% } %>\n    <% if(App.allowed(\'control.followed\')) { %>\n        <li><a href="#" data-action="obj_follow"><%= i18n[isFollowed == 0 ? \'objFollowOn\' : \'objFollowOff\' ] %></a></li>\n    <% } %>\n\n    <li><a href="#" data-action="obj_card"><%= i18n.openObjectCard %></a></li>\n\n    <li><a href="#" data-action="obj_history"><%= i18n.objectAlertsAndLog %></a></li>\n\n<% } %>\n'}),define("mobile/tree/views/MobileTreeView",["jquery","underscore","abstracts/tree/views/TreeView","text!abstracts/tree/tmpl/objectTitle.html","text!mobile/tree/tmpl/status.html","text!mobile/tree/tmpl/context.html"],function(e,t,n,i,a,s){i=t.template(i),a=t.template(a),s=t.template(s);var l=n.extend({constructor:function(){n.apply(this,arguments)},titleFormatter:function(e,n,a,s,l){return i(t.extend(l,{title:this.model.buildItemTitle(l)}))},statusFormatter:function(e,t,n,i,s){return a(s)},_bindEvents:function(){var e=this;this.listenTo(App,"objectsTitleChange",function(){e.refreshGrid()}),n.prototype._bindEvents.apply(this,arguments)},_getTitleTypes:function(){var e=this.model.getTexts();return{name:e.objName,name_id:e.objName+" + ("+e.objIdNumberShort+")",mark_number_id:e.objModel+" + "+e.licenseNumber+" + ("+e.objIdNumberShort+")"}},_getItemCSSClasses:function(e){var i=n.prototype._getItemCSSClasses.call(this,e);return!e.isgroup&&t.isNumber(e.restricted)&&i.push(e.restricted?"free":"work"),i},_contextAllowed:function(e){return 0==e.id?!1:e.isgroup?e.nbItems&&App.reportsAllowed("mobile")||App.allowed("objectgroups.edit")||App.allowed("objectgroups.create")||App.allowed("objects.create"):!0},_buildContextMenuItems:function(e){return s(t.extend({},e,{i18n:this.model.getTexts()}))}});return l}),define("mobile/tree/MobileTreeModule",["jquery","underscore","abstracts/tree/TreeModule","_common/mobile/MobileObject","_common/mobile/MobileObjectsCollection","mobile/MobileObjectsGroupsCollection","mobile/tree/views/MobileTreeView"],function(e,t,n,i,a,s,l){var o=n.extend({constructor:function(){this.groups=new s,this.items=new a,this.searchCollection=new a,this.searchCollection.url=App.getBaseUrl()+"objects/obj-search/",n.apply(this,arguments)},defaults:t.extend({},n.prototype.defaults,{type:"all",objType:"mobile",propertyId:"mobileuid"}),url:App.getBaseUrl()+"objects/objects-tree-set/",initialize:function(){this._openedGroups=this.getUserData("openedGroups")||[];var e=this.getUserData("sortType")||this.get("sortType"),t=this.getUserData("titleType");null!==t&&this.set("titleType",t),"title"==t?e="name":"extId"==t&&(e="extId"),this.set("sortType",e),this._view=new l({el:this.get("container"),model:this}),n.prototype.initialize.apply(this,arguments)},_bindEvents:function(){n.prototype._bindEvents.call(this);var e=this;this.listenTo(this.get("parent"),"itemadded",function(n){if(n.objType==App.TYPE_MOBILE){if("objsGroupsIds"in n){for(var i=0,a=n.objsGroupsIds.length,s=0;a--;)s=n.objsGroupsIds[a],-1==t.indexOf(e._openedGroups,s)&&(e._openedGroups.push(s),i++);i&&e.setUserData("openedGroups",e._openedGroups)}e.loadTree()}})},_clearTree:function(){this.treeData=[],this.groups=new s,this.items=new a},_sortCondition:function(){var e=this.get("sortType");if("name"==e){var t=App.getUserData("objectsTitle")||{};if(!("name"in t))return!0}return!1},_getTitleType:function(){return 0},_copyParams:function(e,n){t.each(["name","objType","licenseNumber","model","hasAlarm","isFollowed","objStatus"],function(t){t in e&&(n[t]=e[t])}),n.hwStatus=i.detectHardwareStatus(e),t.isNumber(e.restricted)&&(n.restricted=e.restricted)},_onItemChange:function(e){var n=this,i=this._getObjectItemsByIDs(t.pluck(e,"id")),a=null;t.each(i,function(i){a=t.findWhere(e,{id:i.id}),n._copyParams(a,i),n.items.get(i.id).set({name:a.name,licenseNumber:a.licenseNumber,model:a.model,imgPath:a.imgPath})}),this._view.refreshGrid()},_processAction:function(e,t){switch(e){case"obj_track":App.trigger("needtrack",[this.items.get(t.id)]);break;case"obj_follow":App.allowed("control.followed")&&(showCursor(),this.items.get(t.id).setFollowMode(1!=t.isFollowed).always(hideCursor));break;default:n.prototype._processAction.apply(this,arguments)}}});return o}),define("text!mobile/watched/tmpl/chooseViewType.html",[],function(){return'<a class="i-left" href="javascript:;" title="<%= i18n.clickToChange %>">\n    <i class="objViewType mobile"></i> <%= i18n.vehicles %>\n</a>\n<div class="context-menu view-type-menu" id="mobileViewTypeMenu">\n    <i class="mobile-icons"></i>\n    <i class="mobile-arrows"></i>\n</div>'}),define("text!mobile/watched/tmpl/baloonProps.html",[],function(){return'<h5><%= i18n.infoInBaloon %></h5>\n<ul>\n    <li>\n        <label class="checkbox">\n            <input type="checkbox" data-prop="extId" checked /> <%= i18n.objIdNumber %>\n        </label>\n    </li>\n    <li>\n        <label class="checkbox">\n            <input type="checkbox" data-prop="deviceTypeName" checked /> <%= i18n.objHardwareType %>\n        </label>\n    </li>\n    <li>\n        <label class="checkbox">\n            <input type="checkbox" data-prop="licenseNumber" checked /> <%= i18n.licenseNumber %>\n        </label>\n    </li>\n    <li>\n        <label class="checkbox">\n            <input type="checkbox" data-prop="address" checked /> <%= i18n.nearest.ucFirst() + \' \' + i18n.address %>\n        </label>\n    </li>\n</ul>'}),define("mobile/watched/views/MobileObjectsMapView",["jquery","jqueryui","underscore","_common/mobile/MobileDetails","abstracts/watched/views/ObjectsWatchedView","_common/mobile/watched/views/MobileInfoView","text!../tmpl/chooseViewType.html","text!../tmpl/baloonProps.html"],function(e,t,n,i,a,s,l,o){var r="arrows",c="icons";l=n.template(l),o=n.template(o);var d=a.extend({constructor:function(){a.apply(this,arguments)},initialize:function(){var t=this;a.prototype.initialize.apply(this,arguments),this.listenTo(App,"objectsTitleChange",function(){n.each(t._viewsMap,function(e,n){e&&e.trigger("settitle",{title:t.model.buildItemTitle(t.model.items.get(n))})})}),e("#settings").length?p.initSettings.call(this):this.listenTo(App,"settingsready",function(){p.initSettings.call(t)})},addWatchedMulti:function(e){if(e&&e.length){for(var t,n,i=e.length,a=this.model.items,s=[],l=[],o=[],r=this.model.get("objViewType"),c=this._cloneCurrentBounds();i--;)if(n=a.get(e[i])){var d=this.ensureCoords(n);if(this._bindModelEvents(n),t=this._buildMapElement(n)){var m=n.get("hasAlarm")||n.get("isFollowed");m?l.push(t):s.push(t)}d&&(o.push(n),c=this._extendBounds(c,n.get("lat"),n.get("lon")))}for(this._afterViewsBuilt(c),this._addViewsToMap(l,s),i=o.length;i--;)n=o[i],p.onCourseChange(r,this._viewsMap[n.id],n)}},_onModuleReady:function(){var e=this.model.items;if(e.length){var t,n=this,i=[],a=[],s=null,l=this.model.get("objViewType"),o=[],r=this._getNullBounds(),c=this.model.get("startObjId");e.each(function(e){var s=n.ensureCoords(e),l=e.get("hasAlarm")||e.get("isFollowed");n._bindModelEvents(e),(t=n._buildMapElement(e))&&(l?a.push(t):i.push(t)),s&&(o.push(e),r=n._extendBounds(r,e.get("lat"),e.get("lon")))}),e.length&&this.model.set("bounds",r,{zoom:!0}),this._createClustersLayer(i),this._createSinglesLayer(a);for(var d=o.length;d--;)s=o[d],p.onCourseChange(l,this._viewsMap[s.id],s,!0);c&&this._viewsMap[c]&&this._viewsMap[c].openPopup()}},_bindModelEvents:function(e){var t=this,n=this.model;a.prototype._bindModelEvents.call(this,e),this.listenTo(e,"change:licenseNumber change:model",function(e){var i;(i=t._viewsMap[e.id])&&i.trigger("settitle",{title:n.buildItemTitle(e)})}).listenTo(e,"change:isFollowed",function(e,n){e.get("hasAlarm")||t._switchViewLayer(e,n)}).listenTo(e,"change:speed",function(e,i){var a;if(a=t._viewsMap[e.id]){var s=e.previous("speed"),l=e.get("minSpeed"),o=i>=l&&l>s;(o||s>=l&&l>i)&&a.trigger("toggleclass",{name:"park"}),o&&!e.hasChanged("course")&&p.onCourseChange(n.get("objViewType"),a,e)}}).listenTo(e,"change:course",function(e){var i;(i=t._viewsMap[e.id])&&e.get("speed")>=e.get("minSpeed")&&p.onCourseChange(n.get("objViewType"),i,e)}).listenTo(e,"change:restricted",function(e){var n;(n=t._viewsMap[e.id])&&n.trigger("toggleclass",{name:"restricted"})}).listenTo(e,"change:trackedSensorState",function(e){var n;(n=t._viewsMap[e.id])&&n.trigger("toggleclass",{name:"obj-alert"})})},_buildMapElement:function(e){if(e.get("lat")&&e.get("lon")){var t=this.model.get("objViewType"),n=" obj-"+this.model.get("objType")+" "+e.get("status")+" "+e.get("hwStatus"),i="";e.get("speed")<e.get("minSpeed")&&(n+=" park"),1==e.get("trackedSensorState")&&(n+=" obj-alert"),e.get("restricted")&&(n+=" restricted"),e.get("hasAlarm")&&(n+=" alarm"),t==c&&(i=' style="background-image:url('+e.getImgPath(!0)+');"');var a=this._viewsMap[e.id]=this._maps.getWidget().buildComplexMarker({lat:e.get("lat"),lon:e.get("lon"),html:'<i class="i"'+i+'></i><span class="name">'+this.model.buildItemTitle(e)+"</span>",className:"complex-icon obj"+n,dataId:e.id,animated:e.get("isFollowed")||e.get("hasAlarm"),model:e});return this._bindPopup(a,e),a}},_placeOnMap:function(e){if(e.has("lat")&&e.has("lon")){var t=this._viewsMap[e.id],n=e.get("lat"),i=e.get("lon"),a={model:e,to:{lat:n,lon:i},animate:!1};if(e.get("isFollowed")||e.get("hasAlarm")){if(e.get("speed")>=e.get("minSpeed")){var s=e.getAvgUpdateTime();a.animate=[[e.previous("lat"),e.previous("lon")],[n,i]],a.interval=null===s?1e3:s}}else a.cluster=this._clustersLayer;t.trigger("place",a)}},_buildInfoView:function(e,t){this._infoView=new s({el:t,parent:this,controller:this.model,objectId:e.id})},_switchViewLayer:function(e){a.prototype._switchViewLayer.apply(this,arguments),e.get("speed")>=e.get("minSpeed")&&p.onCourseChange(this.model.get("objViewType"),this._viewsMap[e.id],e)},_removeViewById:function(e){var t=this._viewsMap[e];if(t){var n=t.options.model,i=n.get("hasAlarm")||n.get("isFollowed");i?this._singlesLayer.removeLayer(t):this._clustersLayer.removeLayer(t),this._viewsMap[e]=null}}}),p={onCourseChange:function(e,t,n,i){if(t){var a=n.get("course");if(e==c){var s=n.previous("course");if(i||(s>180||0==s)&&180>=a||180>=s&&(a>180||0==a)){var l=n.getImgPath(!0);t.trigger("iconchange",{html:'<i class="i" style="background-image:url('+l+');"></i>'+'<span class="name">'+n.get("name")+"</span>"})}}else e==r&&t.trigger("rotate",{angle:a})}},initSettings:function(){var t=this,n=this.model.get("parent").getTexts(),i=e("#settings").find(".objects-watched");i.find(".mobile-view-type").removeClass("hidden").html(l({i18n:n})),i.find(".mwhoip").removeClass("hidden").html(o({i18n:n})),i.find(".objViewType.mobile").css("background-image","url(mobile/images/"+this.model.get("objViewType")+".png)"),e.fn.contextmenu&&(i.find("a").contextmenu({menu:e("#mobileViewTypeMenu"),position:{my:"left top"}}).on("click",function(t){e(this).contextmenu("open",t)}),e("#mobileViewTypeMenu").on("click","i",function(){var e=/icons|arrows/.exec(this.className)[0]||"arrows";i.find(".objViewType.mobile").css("background-image","url(mobile/images/"+e+".png)"),t.model.set("objViewType",e)}))}};return d}),define("mobile/watched/MobileWatchedModule",["underscore","abstracts/watched/ObjectsWatchedModule","_common/mobile/MobileObject","_common/mobile/MobileObjectsCollection","./views/MobileObjectsMapView"],function(e,t,n,i,a){var s=t.prototype,l=t.extend({constructor:function(){this.items=new i,this.items.url=App.getBaseUrl()+"objects/obj/",t.apply(this,arguments)},_viewClass:a,defaults:e.extend({},s.defaults,{objType:"mobile",objViewType:"arrows",followMode:!1}),initialize:function(){var t=this.getUserData("objViewType")||"arrows";-1==e.indexOf(["arrows","icons"],t)&&(t="arrows"),this.set("objViewType",t),this._setItemsFromGET.call(this),s.initialize.call(this)},loadItems:function(e){var t=this,n="undefined"==typeof e;return s.loadItems.apply(this,arguments).done(function(){var i=App.getObjectsUpdateProvider();n?i.setObjectIds(t.getWatchedItemsIds()):i.addObjectIds(e)})},updateItems:function(t,n){var i,a,s=t.length,l=this.items;for(n=n===!0;s--;)if(a=t[s],i=l.get(a.id)){var o=i.get("lastPointTime"),r=!o||!("lastPointTime"in a)||a.lastPointTime>o;r?i.set(i.parse(a,n)):n||(a=e.omit(a,"lat","lon","speed","course","alt","lastPointTime"),i.set(i.parse(a,!1)))}},_bindEvents:function(){var t=this;s._bindEvents.call(this),this.listenTo(App,"showobjects",function(n){if(n&&e.isArray(n)){var i=e.filter(n,function(e){return e.objType==App.TYPE_MOBILE});t.setItems(i),App.getObjectsUpdateProvider().setObjectIds(t.getWatchedItemsIds())}}),this.listenTo(App,"updateobject",function(e){this.updateItems([e],!0)}),this.on("removemulti",function(e){App.getObjectsUpdateProvider().deleteObjectIds(e)})}});return l}),define("text!mobile/itemcard/tmpl/wrapper.html",[],function(){return'<ul class="nav nav-tabs">\n    <li class="tab-obj active">\n        <a href="#tabs-1" data-key="main" data-toggle="tab">\n            <i class="svg-icon svg-icon-circle-info"></i>\n            <%= i18n.object.ucFirst() %>\n        </a>\n    </li>\n    <% if(htmlHardware) { %>\n    <li class="tab-hardware">\n        <a href="#tabs-2" data-key="hardware" data-toggle="tab">\n            <i class="svg-icon svg-icon-hardware"></i>\n            <%= i18n.hardware %>\n        </a>\n    </li>\n    <% } %>\n    <li class="tab-connections">\n        <a href="#tabs-3" data-key="connections" data-toggle="tab">\n            <i class="svg-icon svg-icon-connections"></i>\n            <%= i18n.sensorsAndDevices %>\n        </a>\n    </li>\n    <% if(editable) {%>\n    <li class="tab-alerts-control">\n        <a href="#tabs-12" data-key="alerts-control" data-toggle="tab">\n            <i class="svg-icon svg-icon-checkmark"></i>\n            <%= i18n.alertsControl %>\n        </a>\n    </li>\n    <% } %>\n    <li class="tab-fuel">\n        <a href="#tabs-4" data-key="fuel" data-toggle="tab">\n            <i class="svg-icon svg-icon-fuel"></i>\n            <%= i18n.fuel.ucFirst() %>\n        </a>\n    </li>\n    <li class="tab-filters">\n        <a href="#tabs-5" data-key="filters" data-toggle="tab">\n            <i class="svg-icon svg-icon-filter">\n            </i><%= i18n.filters %>\n        </a>\n    </li>\n    <li class="tab-pictures">\n        <a href="#tabs-6" data-key="pictures" data-toggle="tab">\n            <i class="svg-icon svg-icon-photo"></i>\n            <%= i18n.objPhoto %>\n        </a>\n    </li>\n    <% if(editable && App.allowed(\'video.edit\')) {%>\n    <li class="tab-cameras">\n        <a href="#tabs-9" data-key="cameras" data-toggle="tab">\n            <i class="svg-icon svg-icon-camera"></i>\n            <%= i18n.video %>\n        </a>\n    </li>\n    <% } %>\n    <li class="tab-responsible">\n        <a href="#tabs-7" data-key="people" data-toggle="tab">\n            <i class="svg-icon svg-icon-users"></i>\n            <%= i18n.responsible.header %>\n        </a>\n    </li>\n    <% if(editable) {%>\n    <li class="tab-notifications">\n        <a href="#tabs-8" data-key="notifications" data-toggle="tab">\n            <i class="svg-icon svg-icon-send"></i>\n            <%= i18n.notifications %>\n        </a>\n    </li>\n    <li class="tab-history">\n        <a href="#tabs-10" data-key="history" data-toggle="tab">\n            <svg class="svg-icon">\n                <use xlink:href="#smb-edit"></use>\n            </svg>\n            <%= i18n.editHistory %>\n        </a>\n    </li>\n    <% } %>\n</ul>\n<div class="tab-content">\n\n    <div class="tab-pane card-section active" id="tabs-1">\n        <%= htmlInfo %>\n    </div><!--/tab-pane tabs-1-->\n\n    <% if(htmlHardware) { %>\n    <div class="tab-pane card-section" id="tabs-2">\n        <%= htmlHardware %>\n    </div><!--/tab-2 hardware-->\n    <% } %>\n\n    <div class="tab-pane card-section" id="tabs-3">\n        <%= htmlConnections %>\n    </div><!--/tab-3 connections-->\n\n    <% if(editable) {%>\n    <div class="tab-pane card-section alert-control-section" id="tabs-12">\n    </div><!--/tab-12 alerts-control-->\n    <% } %>\n\n    <div class="tab-pane card-section fuel-section" id="tabs-4">\n        <%= htmlFuel %>\n    </div><!--/tab-4 fuel-->\n\n    <div class="tab-pane card-section" id="tabs-5">\n        <%= htmlFilters %>\n    </div><!--/tab-5 filters-->\n\n    <div class="tab-pane card-section pictures-section" id="tabs-6">\n        <%= htmlPictures %>\n    </div><!--/tab-6 pictures-->\n\n    <div class="tab-pane card-section responsible-section" id="tabs-7">\n        <%= htmlResponsible %>\n    </div><!--/tab-7 responsible-->\n\n    <% if(editable) {%>\n    <div class="tab-pane card-section notifications-section" id="tabs-8">\n    </div><!--/tab-8 notifications-->\n    <% if(App.allowed(\'video.edit\')) { %>\n    <!--/tab-9 cameras ivideon, ritmrtp -->\n        <div class="tab-pane card-section cameras-section" id="tabs-9"></div>\n    <% } %>\n    <div class="tab-pane card-section history-section" id="tabs-10">\n    </div><!--/tab-10 edit history-->\n    <% } %>\n\n</div><!--/tab-content-->'}),define("text!mobile/itemcard/tmpl/info.html",[],function(){return'<table class="l">\n    <tr>\n        <td class="col">\n            <table class="l features">\n                <tr>\n                    <td class="label"><%= i18n.objName %></td>\n                    <td class="value"><%- item.name %></td>\n                </tr><tr>\n                <tr>\n                    <td class="label"><%= i18n.description %></td>\n                    <td class="value">\n                        <p class="no-margin text-large"><strong><%= shortDescription || emptyString %></strong></p>\n                    </td>\n                </tr><tr>\n                    <td class="label"><%= i18n.licenseNumber %></td>\n                    <td class="value"><%- settings.CAR_ID || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.objModel.ucFirst() %></td>\n                    <td class="value"><%- settings.MODEL || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.vehicleType %></td>\n                    <td class="value"><%- settings.VRC_TYPE || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.objYear %></td>\n                    <td class="value"><%- settings.YEAR || emptyString %></td>\n                </tr><tr>\n                    <td class="label">VIN</td>\n                    <td class="value"><%- settings.VIN || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.color.ucFirst() %></td>\n                    <td class="value"><%- settings.COLOR || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.objRouteNumber %></td>\n                    <td class="value"><%- settings.RouteNumber || emptyString %></td>\n                </tr>\n            </table>\n        </td><td class="col">\n            <table class="l features">\n                <%= col2Html %>\n                <!--<tr>\n                    <td class="label"><%= i18n.objState %></td>\n                    <td class="value"><%= stateName %></td>\n                </tr>-->\n            </table>\n        </td>\n        <td class="col" style="width:90px">\n            <div class="img-block">\n                <img<% if(!imgPath) {%> style="display:none"<% } %> src="<% if(imgPath) {%><%= imgPath %><% } %>" alt="" />\n            </div>\n        </td>\n    </tr>\n</table>\n<p class="no-margin"><%= i18n.comments.ucFirst() %>:</p>\n<p class="no-margin text-large"><strong><%= description || emptyString %></strong></p>\n\n'}),define("text!abstracts/itemcard/tmpl/infoCol2.html",[],function(){return'<tr>\n    <td class="label"><%= i18n.objOwner %></td>\n    <td class="value"><%- settings.VRC_OWNER || emptyString %></td>\n</tr><tr>\n    <td class="label"><%= i18n.phone.ucFirst() %> 1</td>\n    <td class="value"><%- settings.PHONE1 || emptyString %></td>\n</tr><tr>\n    <td class="label"><%= i18n.phone.ucFirst() %> 2</td>\n    <td class="value"><%- settings.PHONE2 || emptyString %></td>\n</tr><tr>\n    <td class="label"><%= i18n.objOwnerPass %></td>\n    <td class="value"><%- settings.OwnerPassword || emptyString %></td>\n</tr><tr>\n    <td class="label"><%= i18n.objContract %></td>\n    <td class="value"><%- settings.ContractNumber || emptyString %></td>\n</tr><tr>\n    <td class="label"><%= i18n.objContractDate %></td>\n    <td class="value"><%- settings.Ð¡ontractDate || emptyString %></td>\n</tr><tr>\n    <td class="label"><%= i18n.groups.ucFirst() %></td>\n    <td class="value">\n        <% if(objsGroups && objsGroups.length) {\n        var i = 0;\n        _.each(objsGroups, function(group){\n        print((i++ > 0 ? \', \' : \'\') + group.name);\n        })%>\n        <% } %>\n    </td>\n</tr><tr>\n    <td class="label"><%= i18n.objStatus %></td>\n    <td class="value"><%= status %></td>\n</tr>'}),define("text!abstracts/itemcard/tmpl/hardware.html",[],function(){return'<table class="l">\n    <tr>\n        <td class="col">\n            <table class="features">\n                <% if(imei) {%>\n                <tr>\n                    <td class="label">IMEI</td>\n                    <td class="value"><%- imei %></td>\n                </tr>\n                <% } %>\n                <tr>\n                    <td class="label"><%= i18n.objHardwareType %></td>\n                    <td class="value"><%= deviceTypeName %></td>\n                </tr>\n                <tr>\n                    <td class="label"><%= i18n.simCard %> 1</td>\n                    <td class="value"><%- settings.SIM || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.simCard %> 2</td>\n                    <td class="value"><%- settings.SIM2 || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.password.ucFirst() %></td>\n                    <td class="value"><%- settings.PASS || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.placeInstall %></td>\n                    <td class="value"><%- settings.InstallPlace || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.dateInstall %></td>\n                    <td class="value"><%- settings.InstallDate || emptyString %></td>\n                </tr><tr>\n                    <td class="label"><%= i18n.installer %></td>\n                    <td class="value"><%- settings.Installer || emptyString %></td>\n                </tr>\n            </table>\n        </td>\n        <td class="col">\n            <div class="device-img">\n                <img src="<%= deviceImg %>" alt="">\n                <p class="no-margin"><%= deviceTypeName %></p>\n            </div>\n        </td>\n    </tr>\n</table>\n<p class="no-margin"><%= i18n.objExtraHardware %>:</p>\n<p class="no-margin"><strong><%- settings.ExtraHardware || emptyString %></strong></p>'}),define("text!abstracts/itemcard/tmpl/pictures.html",[],function(){return"\n"}),define("text!mobile/itemcard/tmpl/connections.html",[],function(){return'<table>\n    <tr>\n        <td class="col sensors">\n            <table class="features">\n                <% _.each([1,2,3,4,5,6], function(i){%>\n                <tr>\n                    <td class="label"><%= i18n.discretSensor %> <%= i %> (<%= i18n.discret %>)</td>\n                    <td class="value"><%= settings[\'D\'+i+\'Name\'] || emptyString %></td>\n                </tr>\n                <% }) %>\n            </table>\n        </td>\n        <td class="col sensors">\n            <table class="features">\n                <!-- analogue sensor -->\n                <% _.each([1,2], function(i){%>\n                <tr>\n                    <td class="label"><%= i18n.analogueSensor %> <%= i %> (<%= i18n.analogue %>)</td>\n                    <td class="value"><%= settings[\'AN_NAME\'+i] || emptyString %></td>\n                </tr>\n                <% }) %>\n\n                <!-- controlling enters called "exits" -->\n                <% _.each([1,2], function(i){%>\n                <tr>\n                    <td class="label"><%= i18n.deviceOut %> <%= i %></td>\n                    <td class="value"><%= settings[\'C\'+i+\'Name\'] || emptyString %></td>\n                </tr>\n                <% }) %>\n\n                <tr>\n                    <td class="label"><%= i18n.temperatureSensor %> (<%= i18n.external %>)</td>\n                    <td class="value"><%= settings[\'tempDetector\'] || emptyString %>"</td>\n                </tr>\n            </table>\n        </td>\n    </tr>\n</table>\n<table class="features">\n    <tr>\n        <td class="label"><%= i18n.indicateTrackedSensorState %></td>\n        <td class="value"><%= watchedSensorName %></td>\n    </tr>\n</table>'
}),define("text!mobile/itemcard/tmpl/fuelSensor.html",[],function(){return'<table class="features">\n    <tr>\n        <td class="label nobr"><%= i18n.analogueSensor %> <%= sensorIndex %></td>\n        <td class="value">\n            <% if(AN_TYPE === null) {%>\n            <%= i18n.sensorNotInstalled %>\n            <% } else if(AN_TYPE == \'0\') {%>\n            <%= i18n.fuelLevelSensor %>\n            <% } else if(AN_TYPE == \'1\') {%>\n            <%= i18n.flowSensorOnInput %>\n            <% } else if(AN_TYPE == \'-1\') {%>\n            <%= i18n.flowSensorOnOutput %>\n            <% } %>\n        </td>\n    </tr>\n</table>\n<table class="features">\n    <% if(\'undefined\' != typeof AN_TYPE && AN_TYPE != \'0\') {%>\n    <tr>\n        <td class="label"><%= i18n.impulsesByLiter %></td>\n        <td class="value"><%= AN_COEFF %></td>\n    </tr>\n    <% } %>\n    <tr>\n        <td class="label"><%= i18n.fuelConsumptionNormForSummer %></td>\n        <td class="value nobr"><%= FCONSUM_SUMMER > 0 ? FCONSUM_SUMMER + \' \' + i18n.l100km : emptyString %></td>\n    </tr><tr>\n        <td class="label"><%= i18n.fuelConsumptionNormForSummer %></td>\n        <td class="value nobr"><%= FCONSUMH_SUMMER > 0 ? FCONSUMH_SUMMER + \' \' + i18n.l1h : emptyString %></td>\n    </tr><tr>\n        <td class="label"><%= i18n.fuelConsumptionNormForWinter %></td>\n        <td class="value nobr"><%= FCONSUM_WINTER > 0 ? FCONSUM_WINTER + \' \' + i18n.l100km : emptyString %></td>\n    </tr><tr>\n        <td class="label"><%= i18n.fuelConsumptionNormForWinter %></td>\n        <td class="value nobr"><%= FCONSUMH_WINTER > 0 ? FCONSUMH_WINTER + \' \' + i18n.l1h : emptyString %></td>\n    </tr>\n    <% if(\'undefined\' != typeof AN_TYPE && AN_TYPE == \'0\') {%>\n    <tr>\n        <td colspan="2">\n            <a class="open-fuel-calibration-table" data-sensor="<%= sensorIndex %>" href="javascript:"><%= i18n.calibrationTable %></a>\n        </td>\n    </tr>\n    <% } %>\n</table>'}),define("text!mobile/itemcard/tmpl/fuel.html",[],function(){return'<table class="l cols-3">\n    <tr>\n\n        <td class="col sensor-settings">\n            <%= html1 %>\n        </td><!--/sensor-settings 1st sensor-->\n\n        <td class="col sensor-settings">\n            <%= html2 %>\n        </td><!--/sensor-settings 2nd sensor-->\n\n        <td class="col fuel-filters">\n            <table class="features">\n                <tr>\n                    <td class="label"><%= i18n.tankVolume %></td>\n                    <td class="value nobr">\n                        <%= \'undefined\' != typeof settings.TankVolume ? settings.TankVolume + \' \' + i18n.l : emptyString %>\n                    </td>\n                </tr><tr>\n                    <td class="label"><%= i18n.minFilling %></td>\n                    <td class="value nobr">\n                        <%= \'undefined\' != typeof settings.MinFill ? settings.MinFill + \' \' + i18n.l : emptyString %>\n                    </td>\n                </tr><tr>\n                    <td class="label"><%= i18n.minDischarge %></td>\n                    <td class="value nobr">\n                        <%= \'undefined\' != typeof settings.MinPlum ? settings.MinPlum + \' \' + i18n.l : emptyString %>\n                    </td>\n                </tr><tr>\n                    <td class="label"><%= i18n.stepOfMedianFilter %></td>\n                    <td class="value nobr">\n                        <%= \'undefined\' != typeof settings.SmoothMedianStep ? settings.SmoothMedianStep : emptyString %>\n                    </td>\n                </tr><tr>\n                    <td class="label"><%= i18n.maxUsedSensorValues %></td>\n                    <td class="value nobr">\n                        <%= \'undefined\' != typeof settings.RemoveAcpOverflowMax ? settings.RemoveAcpOverflowMax : emptyString %>\n                    </td>\n                </tr><tr>\n                    <td class="label"><%= i18n.minUsedSensorValues %></td>\n                    <td class="value nobr">\n                        <%= \'undefined\' != typeof settings.RemoveAcpOverflowMin ? settings.RemoveAcpOverflowMin : emptyString %>\n                    </td>\n                </tr>\n            </table>\n        </td><!--/fuel-filters-->\n    </tr>\n</table><!--/cols-3-->'}),define("text!mobile/itemcard/tmpl/filters.html",[],function(){return'    <% if( \'undefined\' == typeof importTs || importTs == \'\' || \'undefined\' != typeof item.clearingFrom){%>\n    <p class="history-clear-help" style="margin:0 0 10px">\n        <% if( \'undefined\' != typeof item.clearingFrom){%>\n        <%= i18n.clearHistoryInfo.replace(\'#date#\', Date.format(\'d.m.Y\', item.clearingFrom * App.MS)) %>\n        <% } else { %>\n        <%= i18n.clearHistoryInfoShort %>\n        <% } %>\n    </p>\n    <% } %>\n\n    <p class="history-processing-info<% if( \'undefined\' == typeof importTs || importTs == \'\' || \'undefined\' != typeof item.clearingFrom){%> hidden<% } %>">\n        <%= i18n.dataHasBeenPrepared %> <%= i18n.till %>: <strong class="nobr importTs"><%= importTs %></strong>\n    </p>\n\n    <% if(0) {%>\n\n    <a class="btn-clear-history<% if(\'undefined\' != typeof item.clearingFrom) {%> hidden<% } %>" href="javascript:;"><%= i18n.clearAndRecalculateDataFromSelectedDate %>\n        <strong class="clear-history selected-date"></strong>\n    </a>\n    <div class="clear-history-indicator loading<% if(\'undefined\' == typeof item.clearingFrom) {%> hidden<% } %>"></div>\n\n    <% } %>\n\n<div class="track-filters">\n    <div class="track-block">\n        <p>\n        <% if(useManualFilters) {%>\n            <%= i18n.useManualTrackFilters %>\n        <% } else { %>\n            <%= i18n.useAutoTrackFilters %>\n        <% } %>\n        </p>\n    </div>\n\n    <div class="track-block">\n        <h5><%= i18n.coordinatesFiltersBySpeed %></h5>\n        <p>\n            <%= i18n.minObjectSpeed %>: <strong><%= settings.OBJECT_MIN_SPEED || 1.001 %> <%= i18n.kmh %></strong>\n        </p><p class="no-margin">\n            <%= i18n.maxObjectSpeed %>: <strong><%= settings.OBJECT_MAX_SPEED || 180 %> <%= i18n.kmh %></strong>\n        </p>\n    </div>\n\n    <div class="track-block">\n        <h5><%= i18n.parkPlacesFilters %></h5>\n        <p>\n            <%= i18n.detectParksIfContinueMoreThan %>:\n            <strong><%= settings.OBJECT_MIN_PARK_TIME || 120 %> <%= i18n.sec %></strong>\n        </p>\n        <% if(useManualFilters) {%>\n        <p class="no-margin">\n            <%= i18n.detectMovementBetweenParksIfContinuesMoreThan %>:\n            <strong><%= settings.OBJECT_MIN_PARK_MERGE_TIME || 120 %> <%= i18n.sec %></strong>\n        </p>\n        <% } %>\n    </div><!--/track-block-parkings-->\n\n    <% if(useManualFilters) {%>\n\n        <div class="track-block">\n            <h5><%= i18n.coordinatesFiltersByParameters %></h5>\n            <p>\n                <i class="svg-icon svg-icon-check<% if( !filterOn(\'FilterPDOP\')) {%>-empty<% } %>"></i>\n                <%= i18n.useOnlyAccurateCoordinates %>\n            </p><p>\n                <i class="svg-icon svg-icon-check<% if( !filterOn(\'FilterMOVEMENT\')) {%>-empty<% } %>"></i>\n                <%= i18n.useCoordinatesByMovementSensor %>\n            </p><p>\n                <i class="svg-icon svg-icon-check<% if( !filterOn(\'FilterUselessType\')) {%>-empty<% } %>"></i>\n                <%= i18n.useCoordinatesOnlyWhenMovingOrEventHappens %>\n            </p><p>\n                <i class="svg-icon svg-icon-check<% if( !filterOn(\'FilterIgnitionMissing\')) {%>-empty<% } %>"></i>\n                <%= i18n.useCoordinatesOnlyIfIgnitionIsOn %>\n            </p>\n        </div><!--/track-block-->\n\n        <div class="track-block">\n            <h5><%= i18n.filtersOfFalseCoordinates %></h5>\n            <p>\n                <i class="svg-icon svg-icon-check<% if( !filterOn(\'FilterSharpCorners\')) {%>-empty<% } %>"></i>\n                <%= i18n.useCoordinatesWithoutLargeDeviationFromParkingPlace %>\n            </p><p>\n                <i class="svg-icon svg-icon-check<% if( !filterOn(\'FilterHyperJumps\')) {%>-empty<% } %>"></i>\n                <%= i18n.useCoordinatesWithoutLargeDeviationFromTrack %>\n            </p><p>\n                <i class="svg-icon svg-icon-check<% if( !filterOn(\'FilterMissing3Dfix\')) {%>-empty<% } %>"></i>\n                <%= i18n.useCoordinatesOnlyWithAltitude %>\n            </p><p>\n                <i class="svg-icon svg-icon-check<% if( !filterOn(\'FilterUnreliableNoiseValue\')) {%>-empty<% } %>"></i>\n                <%= i18n.useCoordinatesOnlyWithGoodSignal %>\n            </p><p class="no-margin">\n                <i class="svg-icon svg-icon-check<% if( !filterOn(\'FilterUnrealCarPower\')) {%>-empty<% } %>"></i>\n                <%= i18n.useCoordinatesOnlyWithGoodVoltage %>\n            </p>\n        </div><!--/track-block-->\n\n    <% } %>\n</div>'}),define("text!abstracts/itemcard/tmpl/responsible.html",[],function(){return'<p><%= i18n.responsible.pass1 %>: <strong><%= responsible.pass1 || i18n.notEntered %></strong>\n<p><%= i18n.responsible.pass2 %>: <strong><%= responsible.pass2 || i18n.notEntered %></strong>\n\n<% if (responsible.persons && responsible.persons.length) {%>\n<table class="table table-striped table-condensed no-margin">\n    <thead>\n    <tr>\n        <th><%= i18n.responsible.persons.key %></th>\n        <th><%= i18n.responsible.persons.name %></th>\n        <th><%= i18n.responsible.persons.phone1 %></th>\n        <th><%= i18n.responsible.persons.phone2 %></th>\n        <th><%= i18n.responsible.persons.comment %></th>\n    </tr>\n    </thead>\n    <tbody>\n    <% _.each(responsible.persons, function(person){ %>\n    <tr>\n        <td class="col-num"><%- person.key || emptyString %></td>\n        <td><%- person.name || emptyString %></td>\n        <td><%- person.phone1 || emptyString %></td>\n        <td><%- person.phone2 || emptyString %></td>\n        <td><%- person.comment || emptyString %></td>\n    </tr>\n    <% }) %>\n    </tbody>\n</table>\n<% } else { %>\n<p><%= i18n.responsible.persons.noData %></p>\n<% } %>'}),define("text!mobile/itemcard/tmpl/fuelCalibration.html",[],function(){return'<% if(editable){%>\n<input type="hidden" name="objectId" value="<%= params.id %>" />\n<input type="hidden" name="sensor" value="<%= params.sensor %>" />\n<% } %>\n<% if(!editable && !table.length){%>\n<p style="margin:10px"><%= i18n.calibrationTableIsEmpty %></p>\n<% } else { %>\n<table class="table table-striped table-condensed<% if(!editable){%> table-hover selectable<% } %>">\n    <thead>\n    <tr>\n        <th class="value"><%= i18n.sensorValue %></th>\n        <th class="value"><%= i18n.volume %>, <%= i18n.l %></th>\n        <% if(editable){%>\n        <th class="row-act">&nbsp;</th>\n        <% } %>\n    </tr>\n    </thead>\n\n    <tbody>\n    <tr class="example<% if(!table.length) {%> hidden<% } %>">\n        <td class="value"><input type="number" min="0" class="itext" name="sensorValue" value="" autocomplete="off" disabled="disabled" /></td>\n        <td class="value"><input type="text" class="itext" name="realValue" value="" autocomplete="off" disabled="disabled" /></td>\n        <td class="row-act"><i class="icon-minus del-link" title="<%= i18n.delete %>"></i></td>\n    </tr>\n\n    <% _.each(table, function(rec, j){%>\n    <tr>\n        <td class="value">\n            <% if(editable){ %>\n            <input type="number" min="0" tabindex="<% print(j*2) %>" class="itext" name="sensorValue" value="<%= rec.sensorValue %>" autocomplete="off" />\n            <% } else { %>\n            <span><%= rec.sensorValue %></span>\n            <% } %>\n        </td>\n        <td class="value">\n            <% if(editable){ %>\n            <input type="text" tabindex="<% print(j*2+1) %>" class="itext" name="realValue" value="<%= rec.realValue %>" autocomplete="off" />\n            <% } else { %>\n            <span><%= rec.realValue %></span>\n            <% } %>\n        </td>\n        <% if(editable){%>\n        <td class="row-act"><i class="icon-minus del-link" title="<%= i18n.delete %>"></i></td>\n        <% } %>\n    </tr>\n    <% }) %>\n\n    </tbody>\n\n</table>\n<div class="chart-cont">\n    <div class="chart hidden"></div>\n    <span class="axis-units y">\n        <%= i18n.l %>\n    </span><span class="axis-units x">\n        <%= i18n.acp %>\n    </span>\n</div>\n<% } %>'}),define("mobile/itemcard/views/MobileItemCardView",["jquery","underscore","jqueryui","jface","abstracts/itemcard/views/ItemCardView","text!mobile/itemcard/tmpl/wrapper.html","text!mobile/itemcard/tmpl/info.html","text!abstracts/itemcard/tmpl/infoCol2.html","text!abstracts/itemcard/tmpl/hardware.html","text!abstracts/itemcard/tmpl/pictures.html","text!mobile/itemcard/tmpl/connections.html","text!mobile/itemcard/tmpl/fuelSensor.html","text!mobile/itemcard/tmpl/fuel.html","text!mobile/itemcard/tmpl/filters.html","text!abstracts/itemcard/tmpl/responsible.html","text!mobile/itemcard/tmpl/fuelCalibration.html"],function(e,t,n,i,a,s,l,o,r,c,d,p,m,u,b,h){var s=t.template(s),l=t.template(l),o=t.template(o),r=t.template(r),c=t.template(c),d=t.template(d),p=t.template(p),m=t.template(m),u=t.template(u),b=t.template(b),h=t.template(h),f=1e4,g=3e4,v="-",y=a.extend({constructor:function(){this._updateTries=[],this._updateTimeout=null,this._updateXhr=null,a.apply(this,arguments)},initialize:function(){a.prototype.initialize.apply(this,arguments)},render:function(){var n=this,a=this.model.get("settings"),r=this.module.getTexts(),h=r.notSelected,f="",g="",y="",_="",w="",C="",M=null,T="",k=this.model.get("item"),S=this.module.getPossibleStates(),E=t.extend({},this.model.attributes,{i18n:r,emptyString:v,imei:this._getDeviceImei(),deviceImg:this._getDeviceImage(),deviceTypeName:this._getDeviceTypeName(),deviceFirmware:this._getDeviceFirmware(),status:r.objStatuses[this.model.get("objStatus")]});f=l(t.extend({},E,{col2Html:o(E),imgPath:this.model.getImagePath(),stateName:S[this.model.get("settings").STATE]||v,shortDescription:this._prepareEditableText(E.settings.shortDescription),description:this._prepareEditableText(E.settings.DESCRIPTION)})),t.each([1,2,3,4,5,6],function(e){a.TRACKED_DSENSOR_INDEX==e&&(h=r.discretSensor+" "+e+" ("+r.discret+")")}),y=d({i18n:r,settings:a,watchedSensorName:h,emptyString:v}),t.each([1,2],function(e){a.TRACKED_DSENSOR_INDEX==e&&(h=r.discretSensor+" "+e+" ("+r.discret+")")}),_=m({i18n:r,settings:a,html1:p(t.extend(x.getFuelSensorData(a,"1"),{sensorIndex:"1",i18n:r,emptyString:v})),html2:p(t.extend(x.getFuelSensorData(a,"2"),{sensorIndex:"2",i18n:r,emptyString:v})),emptyString:v});var F=k.importTs||0;F&&(F*=App.MS),w=u({i18n:r,item:k,settings:a,importTs:F?Date.format(r.DateTime.longFormat,F):"--",useManualFilters:"1"===a.USE_MANUAL_FILTERS,filterOn:function(e){return!a.FILTER_MASK||!a.FILTER_MASK.length||"*"!==a.FILTER_MASK&&-1==a.FILTER_MASK.indexOf(e)},emptyString:v}),C=c(E);try{M=e.parseJSON(a.RESPONSIVE_PERSONS)}catch(j){}T=b({i18n:r,emptyString:v,responsible:M||{persons:[],pass1:"",pass2:""}});var I=s({i18n:r,editable:!1,htmlInfo:f,htmlHardware:g,htmlConnections:y,htmlFuel:_,htmlFilters:w,htmlPictures:C,htmlResponsible:T});i.showOverlay(),i.window.open(t.extend(this._getWindowParams(k,I),{minWidth:765,width:765,openCallback:function(){var e=this;n.setElement(this),n._activateSetup(),x.activateFuelTab.call(n),n._activatePictures(),e.find(".nav-tabs a").on("shown.bs.tab",function(){e.trigger("jw.contentchange")}),e.find(".nav-tabs a[data-key=filters]").one("shown.bs.tab",function(){n._update()})},activateCallback:function(){n._onActivate()},closeCallback:function(){n._onClose()},dieCallback:function(){n.remove()}}))},_update:function(){var t=this,n=this.model.get("item"),i="undefined"!=typeof n.clearingFrom;this._updateXhr=e.ajax({url:this.module.getClearDataUrl(),data:{objectId:i?n.id:[n.id]},cache:!1,error:function(){t._stopUpdate()},success:function(e){var a=t.module.getTexts(),s=f;if(i&&"undefined"==typeof e.clearingFrom&&t._onDataCleared(),!i){var l=e[0].importTs,o=t._updateTries.length;o?l==t._updateTries[o-1]?o>=3?s=g:t._updateTries.push(l):t._updateTries=[l]:t._updateTries=[l];var r=t.$el.find(".history-processing-info"),c=-1!=r[0].className.indexOf("hidden");l>0?(r.find(".importTs").text(Date.format(a.DateTime.longFormat,l)),c&&r.removeClass("hidden")):c||r.addClass("hidden"),n.importTs=l/App.MS}t._updateTimeout=setTimeout(function(){t._update()},s)}})},_onDataCleared:function(){var e=this.module.getTexts(),t=this.model.get("item"),n=this.$el;delete t.clearingFrom,n.find(".history-clear-help").remove(),n.find(".history-processing-info").removeClass("hidden").find(".importTs").text(Date.format(e.DateTime.longFormat,t.importTs*App.MS))},_stopUpdate:function(){this._updateTimeout&&clearTimeout(this._updateTimeout),this._updateXhr&&this._updateXhr.abort()&&(this._updateXhr=null),this._updateTries=[]},_loadFuelCalibrationTable:function(t){var n={objectId:this.model.get("item").id,sensor:t};return e.ajax({url:App.getBaseUrl()+"objects/obj-fuel-calibration/",data:n})},_onClose:function(){a.prototype._onClose.apply(this,arguments),this._stopUpdate()}}),x={getFuelSensorData:function(e,n){var i={AN_TYPE:"0",AN_COEFF:"0",FCONSUM_SUMMER:"0",FCONSUMH_SUMMER:"0",FCONSUM_WINTER:"0",FCONSUMH_WINTER:"0"},a="";return t.each(i,function(t,s){a=s+n,i[s]="undefined"!=typeof e[a]?e[a]:null}),i},activateFuelTab:function(){var t=this.$el,n=this.module.getTexts(),a=this;t.find(".open-fuel-calibration-table").on("click",function(){var t=e(this).data("sensor");showCursor(),a._loadFuelCalibrationTable(t).done(function(e){var s=h({params:{id:a.model.get("item").id,sensor:t},editable:!1,table:e,i18n:n}),l=a.$el.find(".open-fuel-calibration-table[data-sensor="+t+"]");i.window.open({winId:"pop-fuel-calibr-"+t,addClass:"fuel-calibration",addForm:'<form name="calibration-form" method="post" action=""></form>',dieAfter:0,headerHtml:n.calibrationTable+". "+n.analogueSensor+" "+t,contentHtml:s,width:360,relativeTo:l,initX:-30,initY:-270,resizable:!0,minWidth:250,maxWidth:450,maxHeight:600,openCallback:function(){}})}).fail(function(){}).always(hideCursor)})},activateFiltersTab:function(){var e=this.$el,t=this.module.getTexts();"undefined"!=typeof this.model.get("item").clearingFrom&&e.find(".history-processing-msg").html(t.clearingDataFrom+" <strong>"+Date.format("d.m.Y",this.model.get("item").clearingFrom*App.MS)+"</strong>")}};return y}),define("text!mobile/itemcard/tmpl/infoEditable.html",[],function(){return'<input type="hidden" value="<%= App.TYPE_MOBILE %>" name="objType">\n<table class="l">\n    <tr>\n        <td class="col">\n            <div class="field">\n                <label><%= i18n.objName %></label>\n                <div class="itext"><input type="text" name="name" value="<%- item.name %>" maxlength="255" /></div>\n            </div>\n            <div class="field" style="height: 4.2em">\n                <label><%= i18n.description %></label>\n                <div class="itext">\n                    <textarea name="shortDescription" maxlength="140" style="height: 3.8em"><%- settings.shortDescription %></textarea>\n                </div>\n            </div>\n            <div class="field">\n                <label><%= i18n.licenseNumber %></label>\n                <div class="itext"><input type="text" name="CAR_ID" value="<%- settings.CAR_ID %>" maxlength="255" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.objModel.ucFirst() %></label>\n                <div class="itext"><input type="text" name="MODEL" value="<%- settings.MODEL %>" maxlength="255" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.vehicleType %></label>\n                <div class="itext"><input type="text" name="VRC_TYPE" value="<%- settings.VRC_TYPE %>" maxlength="255" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.objYear %></label>\n                <div class="itext"><input type="text" name="YEAR" value="<%- settings.YEAR %>" maxlength="4" /></div>\n            </div>\n            <div class="field">\n                <label>VIN</label>\n                <div class="itext"><input type="text" name="VIN" value="<%- settings.VIN %>" maxlength="255" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.color.ucFirst() %></label>\n                <div class="itext"><input type="text" name="COLOR" value="<%- settings.COLOR %>" maxlength="255" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.objRouteNumber %></label>\n                <div class="itext"><input type="text" name="RouteNumber" value="<%- settings.RouteNumber %>" maxlength="10" /></div>\n            </div>\n\n        </td>\n\n        <td class="col">\n            <%= col2Html %>\n        </td>\n\n        <td rowspan="2" class="col" style="width:150px">\n            <div class="img-block">\n                <img<% if(!imgPath) {%> style="display:none"<% } %> src="<% if(imgPath) {%><%= imgPath %><% } %>" alt="" />\n                <a class="change-img" href="javascript:;"><% if(imgPath) { print(i18n.changeImage) } else { print(i18n.chooseImage) } %></a>\n            </div>\n\n            <%= htmlStatus %>\n\n            <% if(0) {%>\n            <div class="field state">\n                <label class="width-auto"><%= i18n.objState %></label>\n                <div class="select" style="left:0">\n                    <select name="STATE">\n                        <% _.each(possibleStates, function(name, id){%>\n                        <option value="<%= id %>"<% if(settings.STATE == id) {%> selected="selected"<% } %>><%= name %></option>\n                        <% }) %>\n                    </select>\n                </div>\n            </div>\n            <% } %>\n\n        </td>\n    </tr>\n    <tr>\n        <td colspan="2">\n            <div class="field textarea text-large no-margin">\n                <label><%= i18n.comments.ucFirst() %></label>\n                <textarea class="hidden" maxlength="2048" rows="" cols="" name="DESCRIPTION"><%- settings.DESCRIPTION %></textarea>\n                <div class="editable">\n                    <div class="value"><%= description %></div>\n                    <div class="edit">\n                        <i class="svg-icon svg-icon-pencil"></i>\n                    </div>\n                </div>\n            </div>\n        </td>\n    </tr>\n</table>'}),define("text!abstracts/itemcard/tmpl/infoEditableCol2.html",[],function(){return'<div class="field">\n    <label><%= i18n.objOwner %></label>\n    <div class="itext"><input type="text" name="VRC_OWNER" value="<%- settings.VRC_OWNER %>" maxlength="255" /></div>\n</div>\n<div class="field">\n    <label><%= i18n.phone.ucFirst() %> 1</label>\n    <div class="itext"><input type="text" name="PHONE1" value="<%- settings.PHONE1 %>" maxlength="20" /></div>\n</div>\n<div class="field">\n    <label><%= i18n.phone.ucFirst() %> 2</label>\n    <div class="itext"><input type="text" name="PHONE2" value="<%- settings.PHONE2 %>" maxlength="20" /></div>\n</div>\n<div class="field">\n    <label><%= i18n.objOwnerPass %></label>\n    <div class="itext"><input type="text" name="OwnerPassword" value="<%- settings.OwnerPassword %>" maxlength="50" /></div>\n</div>\n<div class="field">\n    <label><%= i18n.objContract %></label>\n    <div class="itext"><input type="text" name="ContractNumber" value="<%- settings.ContractNumber %>" maxlength="20" /></div>\n</div>\n<div class="field">\n    <label><%= i18n.objContractDate %></label>\n    <div class="itext">\n        <input type="text" name="ContractDate" value="<%- settings.ContractDate %>" maxlength="20" class="datepicker" />\n    </div>\n</div>\n<div class="item-groups objs-groups clearfix">\n    <h5><%= i18n.groups.ucFirst() %></h5>\n    <div class="list">\n        <% if(objsGroups && objsGroups.length && tmplGroup) {\n        var sep = \'\';\n        _.each(objsGroups, function(group){\n        if(App.allowed(\'objectgroups.edit\')) {\n        print(tmplGroup(group));\n        } else {\n        print(sep + group.name);\n        sep = \', \';\n        }\n        })%>\n        <% } %>\n        <div class="clear"></div>\n    </div>\n    <% if(App.allowed(\'objectgroups.edit\')) { %>\n    <input type="text" style="display:none" disabled="disabled" class="itext autocomplete" value="" name="add_objs_group_name" maxlength="50" />\n    <div class="btn btn-add btn-small" title="<%= i18n.addGroup %>"><i class="add-obj-group-link icon-plus"></i></div>\n    <% } %>\n</div><!--/objs-groups-->'}),define("text!abstracts/itemcard/tmpl/hardwareEditable.html",[],function(){return'<table class="l">\n    <tr>\n        <td class="col">\n\n            <div class="field">\n                <label>IMEI</label>\n                <div class="itext">\n                    <input type="text" name="imei" value="<%- imei %>" maxlength="16" class="integer" autocomplete="off" />\n                </div>\n            </div>\n\n            <% if(\'undefined\' != typeof hardwareTypes) {%>\n            <div class="field">\n                <label><%= i18n.objHardwareType %></label>\n                <div class="select">\n                    <% if(hardwareTypes) {%><select name="objectTypeId">\n                        <option value="0"><%= i18n.objHardwareUnknown %></option>\n                    <% _.each(hardwareTypes, function(type) {%>\n                        <option value="<%= type.id %>"<% if(\'undefined\' != typeof item.deviceTypeId && item.deviceTypeId == type.id) {%> selected<% } %>>\n                            <%= type.name %>\n                        </option>\n                    <% }) %>\n                    </select><% } else { %>\n                        <%= deviceTypeName %>\n                    <% } %>\n                </div>\n            </div>\n            <% } %>\n\n            <!--<div class="field">\n                <label><%= i18n.simCard %> 1</label>\n                <div class="itext"><input type="text" name="SIM" value="<%- settings.SIM %>" maxlength="20" autocomplete="off" /></div>\n            </div><div class="field">\n                <label><%= i18n.simCard %> 2</label>\n                <div class="itext"><input type="text" name="SIM2" value="<%- settings.SIM2 %>" maxlength="20" autocomplete="off" /></div>\n            </div>-->\n\n            <div class="field">\n                <label><%= i18n.simCard %> 1</label>\n                <div class="form-horizontal itext row-fluid">\n                    <div class="span4">\n                        <input type="text" name="SIM" value="<%- settings.SIM %>" maxlength="20" autocomplete="off">\n                    </div>\n                    <div class="span3 text-right"><%= i18n.gsmProvider %></div>\n                    <div class="span5">\n                        <input class="autocomplete" type="text" name="sim1Provider" value="<%- settings.sim1Provider %>" maxlength="50" autocomplete="off">\n                    </div>\n                </div>\n            </div><div class="field">\n                <label><%= i18n.simCard %> 2</label>\n                <div class="form-horizontal itext row-fluid">\n                    <div class="span4">\n                        <input type="text" name="SIM2" value="<%- settings.SIM2 %>" maxlength="20" autocomplete="off">\n                    </div>\n                    <div class="span3 text-right"><%= i18n.gsmProvider %></div>\n                    <div class="span5">\n                        <input class="autocomplete" type="text" name="sim2Provider" value="<%- settings.sim2Provider %>" maxlength="50" autocomplete="off">\n                    </div>\n                </div>\n            </div>\n\n\n            <div class="field">\n                <label><%= i18n.password.ucFirst() %></label>\n                <div class="itext"><input type="text" name="PASS" value="<%- settings.PASS %>" maxlength="255" /></div>\n            </div><div class="field">\n                <label><%= i18n.placeInstall %></label>\n                <div class="itext"><input type="text" name="InstallPlace" value="<%- settings.InstallPlace %>" maxlength="255" /></div>\n            </div><div class="field">\n                <label><%= i18n.dateInstall %></label>\n                <div class="itext"><input type="text" name="InstallDate" value="<%- settings.InstallDate %>" maxlength="50" class="datepicker" /></div>\n            </div><div class="field">\n                <label><%= i18n.installer %></label>\n                <div class="itext"><input type="text" name="Installer" value="<%- settings.Installer %>" maxlength="100" /></div>\n            </div>\n        </td>\n\n        <td class="col">\n            <div class="device-img">\n                <img src="<%= deviceImg %>" alt="">\n                <p class="no-margin">\n                    <span class="device-name"><%= deviceTypeName %></span>\n                    <% if(deviceFirmware) {%>\n                        <span style="margin:0 5px"><%= deviceFirmware %></span>\n                    <% } %>\n                    <% if(firmwareUpdateAvailable) {%>\n                        <a class="device-command update-command"\n                           data-status="<%= updateStatus.status %>"\n                           data-command="<%= updateStatus.cmd %>" href="javascript:;" >\n                            <%= updateStatus.txt %>\n                        </a>\n                    <% } %>\n                </p>\n\n                <% if(shellSetupAvailable) {%>\n                <p class="no-margin">\n                    <a class="device-command setup" href="javascript:;" ><%= i18n.setupDevice %></a>\n                </p>\n                <% } %>\n            </div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan="2">\n            <div class="field textarea large text-large no-margin">\n                <label><%= i18n.objExtraHardware %></label>\n                <textarea class="hidden" maxlength="2048" rows="" cols="" name="ExtraHardware"><%- settings.ExtraHardware %></textarea>\n                <div class="editable">\n                    <div class="value"><%= extraHardware %></div>\n                    <div class="edit">\n                        <i class="svg-icon svg-icon-pencil"></i>\n                    </div>\n                </div>\n            </div>\n        </td>\n    </tr>\n</table>'}),define("text!mobile/itemcard/tmpl/connectionsEditable.html",[],function(){return'<table class="l cols-2">\n    <tr>\n        <td class="col sensors">\n            <% _.each([1,2,3,4,5,6], function(i){%>\n            <div class="field">\n                <label><%= i18n.discretSensor %> <%= i %> (<%= i18n.discret %>)</label>\n                <div class="itext"><input type="text" name="D<%= i %>Name" value="<%= settings[\'D\'+i+\'Name\'] %>" maxlength="255" /></div>\n            </div>\n            <% }) %>\n            <div class="field no-bottom-margin">\n                <label style="max-width:180px;padding:0;"><%= i18n.indicateTrackedSensorState %></label>\n                <div class="select" style="left:185px"><select name="TRACKED_DSENSOR_INDEX">\n                    <option value="null">--</option>\n                    <% _.each([1,2,3,4,5,6], function(i){%>\n                    <option value="<%= i %>"<% if(settings.TRACKED_DSENSOR_INDEX == i) {%> selected="selected"<% } %>><%= i18n.discretSensor %> <%= i %> (<%= i18n.discret %>)</option>\n                    <% }) %>\n                </select></div>\n            </div>\n\n        </td>\n        <td class="col sensors">\n            <% _.each([1,2], function(i){%>\n            <div class="field">\n                <label><%= i18n.analogueSensor %> <%= i %> (<%= i18n.analogue %>)</label>\n                <div class="itext"><input type="text" name="AN_NAME<%= i %>" value="<%= settings[\'AN_NAME\'+i] %>" maxlength="255" /></div>\n            </div>\n            <% }) %>\n            <!-- controlling enters called "exits" -->\n            <% _.each([1,2], function(i){%>\n            <div class="field">\n                <label><%= i18n.deviceOut %> <%= i %></label>\n                <div class="itext"><input type="text" name="C<%= i %>Name" value="<%= settings[\'C\'+i+\'Name\'] %>" maxlength="255" /></div>\n            </div>\n            <% }) %>\n\n            <div class="field">\n                <label><%= i18n.temperatureSensor %> (<%= i18n.external %>)</label>\n                <div class="itext"><input type="text" name="tempDetector" value="<%= settings[\'tempDetector\'] %>" maxlength="255" /></div>\n            </div>\n\n            <!--\n            <div class="field">\n                <label><%= i18n.power.ucFirst() %></label>\n                <div class="itext"><input type="text" name="POWER_NAME" value="<%- settings.POWER_NAME %>" maxlength="255" /></div>\n            </div>\n            -->\n        </td>\n    </tr>\n</table>\n\n'
}),define("text!mobile/itemcard/tmpl/fuelEditable.html",[],function(){return'<table class="l cols-3">\n    <tr>\n        <td class="col sensor-settings">\n\n            <div class="field">\n                <label class="select-label"><%= i18n.analogueSensor %> 1</label>\n                <div class="select"><select data-sensor="1" name="AN_TYPE1">\n                    <option value="0"<% if(settings.AN_TYPE1 == 0) {%> selected="selected"<% } %>><%= i18n.fuelLevelSensor %></option>\n                    <option value="1"<% if(settings.AN_TYPE1 == 1) {%> selected="selected"<% } %>><%= i18n.flowSensorOnInput %></option>\n                    <option value="-1"<% if(settings.AN_TYPE1 == -1) {%> selected="selected"<% } %>><%= i18n.flowSensorOnOutput %></option>\n                </select></div>\n            </div>\n            <div class="field sensor-koef a1"<% if(settings.AN_TYPE1 == \'0\' || _.isUndefined(settings.AN_TYPE1)) {%> style="display:none"<% } %>>\n            <label><%= i18n.impulsesByLiter %></label>\n            <div class="itext"><input class="positive" type="text" name="AN_COEFF1" value="<%= settings.AN_COEFF1 %>" maxlength="10" /></div>\n            </div>\n\n            <div class="field">\n                <label><%= i18n.fuelConsumptionNormForSummer %>, <%= i18n.l100km %></label>\n                <div class="itext"><input class="positive" type="text" name="FCONSUM_SUMMER1" value="<%= settings.FCONSUM_SUMMER1 %>" maxlength="10" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.fuelConsumptionNormForSummer %>, <%= i18n.l1h %></label>\n                <div class="itext"><input class="positive" type="text" name="FCONSUMH_SUMMER1" value="<%= settings.FCONSUMH_SUMMER1 %>" maxlength="10" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.fuelConsumptionNormForWinter %>, <%= i18n.l100km %></label>\n                <div class="itext"><input class="positive" type="text" name="FCONSUM_WINTER1" value="<%= settings.FCONSUM_WINTER1 %>" maxlength="10" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.fuelConsumptionNormForWinter %>, <%= i18n.l1h %></label>\n                <div class="itext"><input class="positive" type="text" name="FCONSUMH_WINTER1" value="<%= settings.FCONSUMH_WINTER1 %>" maxlength="10" /></div>\n            </div>\n\n            <div class="fuel-calibration a1"<% if(!_.isUndefined(settings.AN_TYPE1) && settings.AN_TYPE1 != 0) {%> style="display:none"<% } %>>\n            <a class="open-fuel-calibration-table" data-sensor="1" href="javascript:"><%= i18n.calibrationTable %></a>\n            </div>\n        </td><!--/sensor-settings-->\n        <td class="col sensor-settings">\n\n            <div class="field">\n                <label class="select-label"><%= i18n.analogueSensor %> 2</label>\n                <div class="select"><select data-sensor="2" name="AN_TYPE2">\n                    <option value="0"<% if(settings.AN_TYPE2 == 0) {%> selected="selected"<% } %>><%= i18n.fuelLevelSensor %></option>\n                    <option value="1"<% if(settings.AN_TYPE2 == 1) {%> selected="selected"<% } %>><%= i18n.flowSensorOnInput %></option>\n                    <option value="-1"<% if(settings.AN_TYPE2 == -1) {%> selected="selected"<% } %>><%= i18n.flowSensorOnOutput %></option>\n                </select></div>\n            </div>\n            <div class="field sensor-koef a2"<% if(settings.AN_TYPE2 == \'0\' || _.isUndefined(settings.AN_TYPE2)) {%> style="display:none"<% } %>>\n            <label><%= i18n.impulsesByLiter %></label>\n            <div class="itext"><input class="positive" type="text" name="AN_COEFF2" value="<%= settings.AN_COEFF2 %>" maxlength="10" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.fuelConsumptionNormForSummer %>, <%= i18n.l100km %></label>\n                <div class="itext"><input class="positive" type="text" name="FCONSUM_SUMMER2" value="<%= settings.FCONSUM_SUMMER2 %>" maxlength="10" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.fuelConsumptionNormForSummer %>, <%= i18n.l1h %></label>\n                <div class="itext"><input class="positive" type="text" name="FCONSUMH_SUMMER2" value="<%= settings.FCONSUMH_SUMMER2 %>" maxlength="10" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.fuelConsumptionNormForWinter %>, <%= i18n.l100km %></label>\n                <div class="itext"><input class="positive" type="text" name="FCONSUM_WINTER2" value="<%= settings.FCONSUM_WINTER2 %>" maxlength="10" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.fuelConsumptionNormForWinter %>, <%= i18n.l1h %></label>\n                <div class="itext"><input class="positive" type="text" name="FCONSUMH_WINTER2" value="<%= settings.FCONSUMH_WINTER2 %>" maxlength="10" /></div>\n            </div>\n\n            <div class="fuel-calibration a2"<% if(!_.isUndefined(settings.AN_TYPE2) && settings.AN_TYPE2 != 0) {%> style="display:none"<% } %>>\n            <a class="open-fuel-calibration-table" data-sensor="2" href="javascript:"><%= i18n.calibrationTable %></a>\n            </div>\n        </td>\n\n        <td class="col fuel-filters">\n            <div class="field">\n                <label><%= i18n.tankVolume %>, <%= i18n.l %></label>\n                <div class="itext"><input class="integer" type="text" name="TankVolume" value="<%= settings.TankVolume %>" maxlength="10" /></div>\n            </div>\n\n            <div class="field">\n                <label><%= i18n.minFilling %>, <%= i18n.l %></label>\n                <div class="itext"><input class="positive" type="text" name="MinFill" value="<%= settings.MinFill %>" maxlength="10" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.minDischarge %>, <%= i18n.l %></label>\n                <div class="itext"><input class="positive" type="text" name="MinPlum" value="<%= settings.MinPlum %>" maxlength="10" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.stepOfMedianFilter %></label>\n                <div class="itext"><input class="integer" type="text" name="SmoothMedianStep" value="<%= settings.SmoothMedianStep %>" maxlength="10" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.maxUsedSensorValues %></label>\n                <div class="itext"><input class="integer" type="text" name="RemoveAcpOverflowMax" value="<%= settings.RemoveAcpOverflowMax %>" maxlength="10" /></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.minUsedSensorValues %></label>\n                <div class="itext"><input class="integer" type="text" name="RemoveAcpOverflowMin" value="<%= settings.RemoveAcpOverflowMin %>" maxlength="10" /></div>\n            </div>\n        </td><!--/fuel-filters-->\n    </tr>\n</table><!--/cols-3-->'}),define("text!mobile/itemcard/tmpl/filtersEditable.html",[],function(){return'<table class="l">\n    <tr>\n        <td class="col track-filters">\n            <input type="text" style="width:100%" class="track-filters-input filterMask hidden" name="FILTER_MASK" value="<%= settings.FILTER_MASK %>" />\n\n            <div class="track-block" style="margin-bottom: 10px">\n                <label class="radio">\n                    <input type="radio" name="USE_MANUAL_FILTERS" value="0" <% if(!useManualFilters) {%>checked<% } %>/>\n                    <%= i18n.useAutoTrackFilters %> (<%= i18n.recommended %>)\n                </label>\n                <label class="radio">\n                    <input type="radio" name="USE_MANUAL_FILTERS" value="1" <% if(useManualFilters) {%>checked<% } %>/>\n                    <%= i18n.useManualTrackFilters %>\n                </label>\n            </div>\n\n            <% if( App.isMapMatchingAllowed()) {%>\n            <div class="alert alert-danger map-matching-warning hidden">\n                <strong><%= i18n.attentionExclaim %></strong> <%= i18n.gpsTrackMapMatchingFiltersWarning %>\n            </div>\n            <% } %>\n\n            <div class="track-block">\n                <h5><%= i18n.coordinatesFiltersBySpeed %>\n                    <a href="javascript:;" class="set-default-filters nobr"><%= i18n.setDefaults %></a></h5>\n                <table class="l table-fields">\n                    <tr class="field">\n                        <td>\n                            <label><%= i18n.minObjectSpeed %>, <%= i18n.kmh %></label>\n                        </td>\n                        <td>\n                            <div class="itext">\n                                <input type="text" class="track-filters-input object-min-speed positive"\n                                       name="OBJECT_MIN_SPEED" value="<%= settings.OBJECT_MIN_SPEED || 1.001 %>" />\n                            </div>\n                        </td>\n                    </tr><tr class="field">\n                    <td>\n                        <label><%= i18n.maxObjectSpeed %>, <%= i18n.kmh %></label>\n                    </td>\n                    <td>\n                        <div class="itext">\n                            <input type="text" class="track-filters-input object-max-speed positive"\n                                   name="OBJECT_MAX_SPEED" value="<%= settings.OBJECT_MAX_SPEED || 180 %>" />\n                        </div>\n                    </td>\n                </tr>\n                </table>\n            </div><!--/track-block by speed-->\n\n            <div class="track-block track-block-parkings">\n                <h5><%= i18n.parkPlacesFilters %> <a href="javascript:;" class="set-default-filters nobr"><%= i18n.setDefaults %></a></h5>\n\n                <table class="l table-fields">\n                    <tr class="field">\n                        <td>\n                            <label><%= i18n.detectParksIfContinueMoreThan %> (10-180 <%= i18n.DateTime.labels2[6] %>)</label>\n                        </td>\n                        <td>\n                            <div class="itext">\n                                <input type="text" class="track-filters-input object-min-time-park integer" min="10" max="180"\n                                       name="OBJECT_MIN_PARK_TIME" value="<%= settings.OBJECT_MIN_PARK_TIME || 120 %>" />\n                            </div>\n                        </td>\n                    </tr>\n                    <tr class="field track-fields-manual<% if(!useManualFilters) {%> hidden<% } %>">\n                        <td>\n                            <label><%= i18n.detectMovementBetweenParksIfContinuesMoreThan %> (10-180 <%= i18n.DateTime.labels2[6] %>)</label>\n                        </td>\n                        <td>\n                            <div class="itext">\n                                <input type="text" class="track-filters-input object-min-park-merge-time integer" min="10" max="180"\n                                       name="OBJECT_MIN_PARK_MERGE_TIME" value="<%= settings.OBJECT_MIN_PARK_MERGE_TIME || 120 %>" />\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </div><!--/track-block-parkings-->\n\n            <div class="track-block track-fields-manual<% if(!useManualFilters) {%> hidden<% } %>">\n\n                <h5><%= i18n.coordinatesFiltersByParameters %>\n                    <a href="javascript:;" class="set-default-filters nobr"><%= i18n.setDefaults %></a><a href="#" class="switch-off-all-filters nobr"><%= i18n.switchOffAll %> (<%= i18n.notRecommended %>)</a></h5>\n\n                <label class="checkbox">\n                    <input type="checkbox" class="ignore filter-default" value="FilterPDOP" name="filter_mask_part"\n                    <% if( filterOn(\'FilterPDOP\')) {%> checked="checked"<% } %> />\n                    <%= i18n.useOnlyAccurateCoordinates %>\n                </label>\n                <label class="checkbox">\n                    <input type="checkbox" class="ignore" value="FilterMOVEMENT" name="filter_mask_part"\n                    <% if( filterOn(\'FilterMOVEMENT\')) {%> checked="checked"<% } %> />\n                    <%= i18n.useCoordinatesByMovementSensor %>\n                </label>\n                <label class="checkbox">\n                    <input type="checkbox" class="ignore" value="FilterUselessType" name="filter_mask_part"\n                    <% if( filterOn(\'FilterUselessType\')) {%> checked="checked"<% } %> />\n                    <%= i18n.useCoordinatesOnlyWhenMovingOrEventHappens %>\n                </label>\n                <label class="checkbox">\n                    <input type="checkbox" class="ignore" value="FilterIgnitionMissing" name="filter_mask_part"\n                    <% if( filterOn(\'FilterIgnitionMissing\')) {%> checked="checked"<% } %> />\n                    <%= i18n.useCoordinatesOnlyIfIgnitionIsOn %>\n                </label>\n\n            </div><!--/track-block by parameters-->\n\n            <div class="track-block track-fields-manual<% if(!useManualFilters) {%> hidden<% } %>">\n                <h5><%= i18n.filtersOfFalseCoordinates %>\n                    <a href="javascript:;" class="set-default-filters nobr"><%= i18n.setDefaults %></a><a href="#" class="switch-off-all-filters nobr"><%= i18n.switchOffAll %></a></h5>\n                <label class="checkbox">\n                    <input type="checkbox" class="ignore filter-default" value="FilterSharpCorners" name="filter_mask_part"\n                    <% if( filterOn(\'FilterSharpCorners\')) {%> checked="checked"<% } %> />\n                    <%= i18n.useCoordinatesWithoutLargeDeviationFromParkingPlace %>\n                </label>\n\n                <label class="checkbox">\n                    <input type="checkbox" class="ignore" value="FilterHyperJumps" name="filter_mask_part"\n                    <% if( filterOn(\'FilterHyperJumps\')) {%> checked="checked"<% } %> />\n                    <%= i18n.useCoordinatesWithoutLargeDeviationFromTrack %>\n                </label>\n\n                <label class="checkbox">\n                    <input type="checkbox" class="ignore" value="FilterMissing3Dfix" name="filter_mask_part"\n                    <% if( filterOn(\'FilterMissing3Dfix\')) {%> checked="checked"<% } %> />\n                    <%= i18n.useCoordinatesOnlyWithAltitude %> (3Dfix)\n                </label>\n\n                <label class="checkbox">\n                    <input type="checkbox" class="ignore" value="FilterUnreliableNoiseValue" name="filter_mask_part"\n                    <% if( filterOn(\'FilterUnreliableNoiseValue\')) {%> checked="checked"<% } %> />\n                    <%= i18n.useCoordinatesOnlyWithGoodSignal %>\n                </label>\n\n                <label class="checkbox">\n                    <input type="checkbox" class="ignore" value="FilterUnrealCarPower" name="filter_mask_part"\n                    <% if( filterOn(\'FilterUnrealCarPower\')) {%> checked="checked"<% } %> />\n                    <%= i18n.useCoordinatesOnlyWithGoodVoltage %>\n                </label>\n\n            </div><!--/track-block-->\n\n            <% if( App.isMapMatchingAllowed()) {%>\n            <div class="track-block track-block-map-matching">\n                <h5><%= i18n.gpsTrackMapMatching %></h5>\n                <table class="l table-fields">\n                    <tr class="field">\n                        <td>\n                            <label><%= i18n.gpsTrackMapMatchingLabel %></label>\n                        </td>\n                        <td>\n                            <div class="select">\n                                <select name="MAP_MATCHING_VEHICLE">\n                                    <% _.each(mapMatchingValues, function(name, key){%>\n                                    <option value="<%= key %>"\n                                    <% if( settings.MAP_MATCHING_VEHICLE === key ) {%> selected<% } %>>\n                                    <%= name %>\n                                    </option>\n                                    <% }) %>\n                                </select>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </div>\n            <% } %>\n        </td>\n\n        <td class="col" style="width:202px;padding-right:0;border-left:1px #e4e4e4 solid;">\n            <div class="field clear-history">\n                <!--<div class="btn" id="btn-clear-history"><div class="btn-extra"><a href="javascript:;" title="">ÐÐµÑÐµÑÑÐµÑ Ð´Ð°Ð½Ð½ÑÑ c</a></div></div>-->\n                <!--<input readonly type="text" class="itext ignore date datepicker" name="from_date" />-->\n                <div class="datepicker clear-history"></div>\n                <a class="btn-clear-history<% if(\'undefined\' != typeof item.clearingFrom) {%> hidden<% } %>" href="javascript:;"><%= i18n.clearAndRecalculateDataFromSelectedDate %>\n                    <strong class="clear-history selected-date"></strong>\n                </a>\n                <p class="history-processing-msg<% if(\'undefined\' == typeof item.clearingFrom) {%> hidden<% } %>"></p>\n                <div class="clear-history-indicator loading<% if(\'undefined\' == typeof item.clearingFrom) {%> hidden<% } %>"></div>\n                <p class="history-clear-help"><%= \'undefined\' == typeof item.clearingFrom ? i18n.clearHistoryHelp : i18n.clearHistoryHelp1 %></p>\n                <p class="history-processing-info<% if( \'undefined\' == typeof importTs || importTs == \'\' || \'undefined\' != typeof item.clearingFrom){%> hidden<% } %>">\n                    <%= i18n.dataHasBeenRecalculated %> <%= i18n.till %> <strong class="nobr importTs"><%= importTs %></strong>\n                    <!--<i class="icon-reload"></i>-->\n                </p>\n\n            </div>\n        </td>\n    </tr>\n</table>\n'}),define("text!mobile/itemcard/tmpl/calibrationToolbar.html",[],function(){return'<div title="<%= i18n.add.ucFirst() %> <%= i18n.row %>" class="btn btn-add"><i class="icon-add"></i></div>\n<div title="<%= i18n.reload.ucFirst() %>" class="btn btn-reload"><i class="icon-reload"></i></div>\n<div title="<%= i18n.clear.ucFirst() %>" class="btn btn-clear"><i class="icon-clear"></i></div>'}),define("text!abstracts/itemcard/tmpl/responsibleEditable.html",[],function(){return'<table class="l" style="width:60%">\n    <tr>\n        <td class="col">\n            <div class="field">\n                <label><%= i18n.responsible.pass1 %></label>\n                <div class="itext"><input maxlength="20" class="password" name="pass1" type="text" value="<%= responsible.pass1 %>"></div>\n            </div>\n            <div class="field">\n                <label><%= i18n.responsible.pass2 %></label>\n                <div class="itext"><input maxlength="20" class="password" name="pass2" type="text" value="<%= responsible.pass2 %>"></div>\n            </div>\n        </td>\n    </tr>\n</table>\n\n<table class="table table-condensed persons<% if (!responsible.persons || !responsible.persons.length) { %> hidden<% } %>">\n    <thead>\n        <tr>\n            <th><%= i18n.responsible.persons.key %></th>\n            <th><%= i18n.responsible.persons.name %></th>\n            <th><%= i18n.responsible.persons.phone1 %></th>\n            <th><%= i18n.responsible.persons.phone2 %></th>\n            <th><%= i18n.responsible.persons.comment %></th>\n            <th></th>\n            <th></th>\n            <th></th>\n        </tr>\n    </thead>\n    <tbody>\n        <% if (responsible.persons && responsible.persons.length) { %>\n        <% _.each(responsible.persons, function(person, index){ %>\n        <tr class="AddNewPersonRow" data-index="<%= index %>">\n            <td class="col-num">\n                <div class="itext"><input class="_key text-center" name="_key" type="text" value="<%- person.key %>" maxlength="20"></div>\n            </td>\n            <td><div class="itext"><input class="_name" name="_name" type="text" value="<%- person.name %>" maxlength="70"></div></td>\n            <td class="col-phone"><div class="itext"><input class="_phone1" name="_phone1" type="text" value="<%- person.phone1 %>" maxlength="17"></div></td>\n            <td class="col-phone"><div class="itext"><input class="_phone2" name="_phone2" type="text" value="<%- person.phone2 %>" maxlength="17"></div></td>\n            <td><div class="itext"><input class="_comment" name="_comment" type="text" value="<%- person.comment %>" maxlength="95"></div></td>\n            <td class="col-icon">\n                <i class="svg-icon svg-icon-chevron-up personUp"></i>\n            </td>\n            <td class="col-icon">\n                <i class="svg-icon svg-icon-chevron-down personDown"></i>\n            </td>\n            <td class="col-icon">\n                <i class="svg-icon svg-icon-remove personRemove"></i>\n            </td>\n        </tr>\n        <% }) %>\n        <% } %>\n    </tbody>\n</table>\n\n<p class="no-data<% if (responsible.persons && responsible.persons.length) { %> hidden<% } %>">\n    <%= i18n.responsible.persons.noData %>\n</p>'}),define("mobile/itemcard/views/MobileItemCardEditableView",["jquery","underscore","jqueryui","jface","util","_libs/charts/Chart","mobile/itemcard/views/MobileItemCardView","abstracts/itemcard/views/ItemCardView","abstracts/itemcard/views/CopySettingsView","text!mobile/itemcard/tmpl/wrapper.html","text!_common/tmpl/modelTag.html","text!mobile/itemcard/tmpl/infoEditable.html","text!abstracts/itemcard/tmpl/infoEditableCol2.html","text!abstracts/itemcard/tmpl/hardwareEditable.html","text!abstracts/itemcard/tmpl/pictures.html","text!abstracts/itemcard/tmpl/copySettingsForm.html","text!mobile/itemcard/tmpl/connectionsEditable.html","text!mobile/itemcard/tmpl/fuelEditable.html","text!mobile/itemcard/tmpl/filtersEditable.html","text!mobile/itemcard/tmpl/fuelCalibration.html","text!mobile/itemcard/tmpl/calibrationToolbar.html","text!abstracts/itemcard/tmpl/responsibleEditable.html"],function(e,t,n,i,a,s,l,o,r,c,d,p,m,u,b,h,f,g,v,y,x,_){var c=t.template(c),d=t.template(d),p=t.template(p),m=t.template(m),u=t.template(u),b=t.template(b),h=t.template(h),f=t.template(f),g=t.template(g),v=t.template(v),_=t.template(_),y=t.template(y),x=t.template(x),w=50,C={"default":null,vip:null,vodokanal:null},M=l.extend({constructor:function(){l.apply(this,arguments)},initialize:function(){l.prototype.initialize.apply(this,arguments)},render:function(){var n=this,a=this.model.get("settings"),s=this.module.getTexts(),l="",o="",r="",h="",y="",x="",w="",C=this.model.get("item"),M=this._getUpdateStatus();this.listenTo(this.model,"imagechange",function(e){n.$el.find(".img-block img").attr("src",n._getImgDir()+e.img+n._getImgExt())});var k=t.extend({},this.model.attributes,{i18n:s,imei:this._getDeviceImei(),deviceImg:this._getDeviceImage(),deviceTypeName:this._getDeviceTypeName(),deviceFirmware:this._getDeviceFirmware()});l=p(t.extend({},k,{col2Html:m(t.extend({},k,{tmplGroup:d})),imgPath:this.model.getImagePath(),htmlStatus:this._renderStatus(),possibleStates:this.module.getPossibleStates(),description:this._prepareEditableText(k.settings.DESCRIPTION)})),o=u(t.extend({},k,{extraHardware:this._prepareEditableText(k.settings.ExtraHardware),shellSetupAvailable:App.allowed("objects.shell")&&"canSetup"in k&&k.canSetup,firmwareUpdateAvailable:App.allowed("objects.shell")&&M,updateStatus:M})),r=f(k),h=g(k),y=v(t.extend({},k,{importTs:Date.format(s.DateTime.longFormat,1e3*C.importTs),useManualFilters:"1"===a.USE_MANUAL_FILTERS,filterOn:function(e){return!a.FILTER_MASK||!a.FILTER_MASK.length||"*"!==a.FILTER_MASK&&-1==a.FILTER_MASK.indexOf(e)},mapMatchingValues:{"":s.mapMatchingOff,car:s.mapMatchingCar,tram:s.mapMatchingTram,trolleybus:s.mapMatchingTrolleybus}})),x=b(k);var S=null;try{S=e.parseJSON(a.RESPONSIVE_PERSONS)}catch(E){}w=_({i18n:s,responsible:S||{persons:[],pass1:"",pass2:""}});var F=c({i18n:s,editable:!0,htmlInfo:l,htmlHardware:o,htmlConnections:r,htmlFuel:h,htmlFilters:y,htmlPictures:x,htmlResponsible:w});i.showOverlay(),i.window.open(t.extend(this._getWindowParams(C,F),{addClass:"item-card obj-card editable",headerHtml:C.name+" (#"+C.extId+")",addForm:'<form method="post" action=""></form>',footerHtml:'<a href="javascript:;" class="btn btn-apply">'+s.apply+"</a>"+'<button type="submit" class="btn btn-primary">'+s.save+"</button>"+'<a href="javascript:;" class="btn jw-close">'+s.cancel.ucFirst()+"</a>",width:1110,minWidth:1110,height:500,maxHeight:600,openCallback:function(){var e=this;n.setElement(this),e.find(".nav-tabs a[data-key]").on("shown.bs.tab",function(){n.$el.find(".card-extra-action").remove()}),n._activateExport(),e.find(".nav-tabs a[data-key=filters]").one("shown.bs.tab",function(){n._update()}),n._activateTextareas(),n._activateSetup(),n._activateUpdate(),n._activateCommonDates(),setTimeout(function(){n._activateAutocompletes()},100),n._activateGroups(),n._activateAlertsControl(),n._activateImageChange(),T.activateFuelTab.call(n),T.activateFiltersTab.call(n),n._activatePictures(),n._activateResponsible(),n._activateNotifications(),n._activateCameras(),n._activateChangesHistory(),n._activateObjStatus(),n._limitInputs(),n._activateSubmit()},activateCallback:function(){n._onActivate()},closeCallback:function(){n._onClose()},dieCallback:function(){n.remove()}}))},onModelChange:function(){},_onDataCleared:function(){var e=this.module.getTexts(),t=this.model.get("item"),n=this.$el;delete t.clearingFrom,n.find(".history-clear-help").text(e.clearHistoryHelp),n.find(".btn-clear-history, .history-processing-info").removeClass("hidden"),n.find(".clear-history-indicator, .history-processing-msg").addClass("hidden"),n.find(".history-processing-info .importTs").text(Date.format(e.DateTime.longFormat,t.importTs*App.MS))},_getSpriteImages:function(){return C},_getImgHeight:function(){return w},_processAndValidateData:function(e){var n=[],i=parseInt(e.RemoveAcpOverflowMin),a=parseInt(e.RemoveAcpOverflowMax);if(!t.isNaN(i)&&!t.isNaN(a)){var s=this.module.getTexts();i>=a&&n.push({key:["RemoveAcpOverflowMin","RemoveAcpOverflowMax"],msg:s.errAcpLimits})}return"1"!==e.USE_MANUAL_FILTERS&&(e.USE_MANUAL_FILTERS=""),delete e.filter_mask_part,l.prototype._processAndValidateData.call(this,e,n)},_onClose:function(){try{e(".jf-window.fuel-calibration").trigger("jw.close")}catch(t){}l.prototype._onClose.apply(this,arguments)}}),T={activateFuelTab:function(){var t=this.$el,n=this.module.getTexts();t.find(".sensor-settings select").on("change",function(){var n=e(this),i=n.val(),a=n.data("sensor");if(0==i)n.css("right","20px"),t.find("div.sensor-koef.a"+a).hide().find("input").attr("disabled","disabled"),t.find("div.fuel-calibration.a"+a).show();else{n.css("right",0),t.find("div.sensor-koef.a"+a).show().find("input").removeAttr("disabled"),t.find("div.fuel-calibration.a"+a).hide();try{$jw.getById("pop-fuel-calibr-"+a).trigger("jw.close")}catch(s){}}});var a=this;t.find(".open-fuel-calibration-table").on("click",function(){var t=e(this).data("sensor");showCursor(),a._loadFuelCalibrationTable(t).done(function(e){var s=y({params:{id:a.model.get("item").id,sensor:t},editable:!0,table:e,i18n:n}),l=a.$el.find(".open-fuel-calibration-table[data-sensor="+t+"]");i.window.open({winId:"pop-fuel-calibr-"+t,addClass:"fuel-calibration",addForm:'<form name="calibration-form" method="post" action=""></form>',dieAfter:0,headerHtml:n.calibrationTable+". "+n.analogueSensor+" "+t,contentHtml:s,toolbarHtml:x({i18n:n}),footerHtml:'<button type="submit" class="btn btn-primary">'+n.save.ucFirst()+"</button>"+'<a href="javascript:;" class="btn jw-close">'+n.cancel.ucFirst()+"</a>",width:725,relativeTo:l,initX:-30,initY:-270,resizable:!1,openCallback:function(){T.initCalibrationTools.call(a,this,t)},showCallback:function(){T.initCalibrationChart.call(a,this,e)},closeCallback:function(){T.removeCalibrationChart.call(a,this.find(".chart"))}})}).fail(function(){}).always(hideCursor)})},activateFiltersTab:function(){var t=this,n=this.$el,i=this.$el.find('.track-filters input[name="USE_MANUAL_FILTERS"]'),a=this.$el.find(".track-filters .track-fields-manual"),s=this.$el.find(".track-filters input[type=checkbox]"),l=this.module.getTexts(),o=n.find(".clear-history.selected-date"),r=n.find(".datepicker.clear-history").datepicker({dateFormat:"dd.mm.yy",minDate:new Date(App.getMinImportTs()),maxDate:new Date,showOtherMonths:!0,selectOtherMonths:!0,onSelect:function(e){o.text(e)}});o.text(e.datepicker.formatDate("dd.mm.yy",r.datepicker("getDate"))),"undefined"!=typeof this.model.get("item").clearingFrom&&n.find(".history-processing-msg").html(l.clearingDataFrom+" <strong>"+Date.format("d.m.Y",this.model.get("item").clearingFrom*App.MS)+"</strong>"),i.on("click",function(){var e=this.checked&&"1"===this.value;if(a.toggleClass("hidden",!e),App.isMapMatchingAllowed()){var t=n.find(".track-block-map-matching");t.toggleClass("hidden",e),n.find(".map-matching-warning").toggleClass("hidden",!e),e&&t.find("select").val("")}}),s.on("click",function(){T.toggleFilter.call(t,this)}),n.on("click","a.set-default-filters",function(n){var i=e(n.target).closest(".track-block"),a=i.find("input[type=checkbox]").prop("checked",!1);a.filter(".filter-default").prop("checked",!0),i.find(".object-max-speed").val("180").end().find(".object-min-speed").val("1").end().find(".object-min-time-park").val("120").end().find(".object-min-park-merge-time").val("120"),a.each(function(){T.toggleFilter.call(t,this)})}).on("click","a.switch-off-all-filters",function(n){var i=e(n.target).closest(".track-block");i.find("input[type=checkbox]").prop("checked",!1).each(function(){T.toggleFilter.call(t,this)})}).on("click",".btn-clear-history",function(i){var a=e(this);if(a.data("processing"))return!1;i.stopPropagation();var s=r.datepicker("getDate");return a.data("processing",!0),t._stopUpdate(),showCursor(),t.model.clearDataHistory(Date.sqlFormat(s)).always(function(){hideCursor(),a.removeData("processing")}).done(function(){var i=t.model.get("item");e.ajax({url:App.getBaseUrl()+"objects/check-clear-task/",data:{objectId:i.id},success:function(e){"undefined"!=typeof e.clearingFrom&&(i.clearingFrom=e.clearingFrom,i.importTs=s.getTime()/App.MS,n.find(".history-clear-help").text(l.clearHistoryHelp1),n.find(".btn-clear-history, .history-processing-info").addClass("hidden"),n.find(".clear-history-indicator, .history-processing-msg").removeClass("hidden"),n.find(".history-processing-msg").html(l.clearingDataFrom+" <strong>"+Date.format("d.m.Y",e.clearingFrom*App.MS)+"</strong>"),t._update())}})}).fail(function(e){t.showErrors(e)}),!1}).on("click",".copy-filters",function(){T.initFiltersCopy.call(t)}),this.module.get("editable")&&this.$el.find(".nav-tabs a[data-key=filters]").on("shown.bs.tab",function(){t.$el.find(".jw-footer-content").prepend('<a href="javascript:;" class="card-extra-action copy-filters">'+l.copyObjFilters+"</a>")}).on("hide.bs.tab",function(){t._removeCopySettingsView()})},initFiltersCopy:function(){this._copySettingsView||(this._copySettingsView=new r({parent:this,controller:this.module,model:this.model,settingsProvider:new M.SettingsProvider({context:this,i18n:this.module.getTexts()}),el:e("<div/>").appendTo(this.$el)}))},toggleFilter:function(t){var n=e(t),i=(n.closest(".track-block"),this.$el.find(".track-filters")),a=n.attr("value"),s=t.checked,l=i.find("input.filterMask"),o=l.val(),r=i.find("input[type=checkbox]");if(s)if("*"==o){var c=[];r.each(function(){!this.checked&&c.push(e(this).attr("value"))}),o=c.join(",")}else o=o.replace(a,"").replace(",,",",").replace(/^,|,$/,"");else{var d=!0;r.each(function(){return d=e(this).prop("checked")===!1}),d?o="*":o+=(o?",":"")+a}l.val(o)},initCalibrationTools:function(t,n){var i=this,a=t.find(".chart"),s=t.find(".jw-toolbar"),l=s.find(".btn");
l.on("click",function(){l.not(this).removeClass("active")});var o={".btn-add":function(){T.addCalibrationRec.call(i,t)},".btn-reload":function(){T.reloadCalibrationRecs.call(i,t,n)},".btn-clear":function(){t.content.find("tbody tr").not(".example").remove(),T.removeCalibrationChart.call(i,a),T.addCalibrationRec.call(i,t)}};for(var r in o)s.find(r).on("click",o[r]);var c=t.content.find("tbody tr").not(".example");0==c.length&&T.addCalibrationRec.call(this,t,c),e.fn.numeric&&(t.find("[name=sensorValue]").numeric({decimal:!1,negative:!1}),t.find("[name=realValue]").numeric({decimal:".",negative:!1})),t.content.find(".itext").on("keyup.calibration change.calibration",function(){a.trigger("rowchange.calibration")}),t.find("form").on("submit",function(){return T.saveCalibrationRecs.call(i,t),!1}),t.content.on("click",".del-link",function(){T.delCalibrationRec.call(i,this,t)})},initCalibrationChart:function(e,t){var n=e.find(".chart");T.bindCalibrationEvents.call(this,e,n),t.length>1?(n.removeClass("hidden"),T.drawCalibrationChart.call(this,n,t)):T.removeCalibrationChart.call(this,n)},prepareCalibrationData:function(e){var n;if(t.isArray(e)){var i=-1,a=e.length;for(n=new Array(a);++i<a;)n[i]=[e[i].sensorValue,e[i].realValue]}else{var s=e.sensorValue,l=e.realValue,o=s.length;for(n=new Array(o);o--;)n[o]=[s[o],l[o]]}return n=t.sortBy(n,function(e){return e[0]})},drawCalibrationChart:function(e,t){var n=T.prepareCalibrationData.call(this,t);e.jqChart({legend:{visible:!1},background:null,border:{visible:!1},width:""+e.width()+"px",height:""+e.height()+"px",animation:{enabled:!1},axes:[{type:"linear",location:"bottom",rightMargin:30},{type:"linear",location:"left",topMargin:50,minimum:0}],series:[{type:"line",strokeStyle:"#418CF0",lineWidth:2,data:n}]}),e.data("chart",!0)},bindCalibrationEvents:function(e,t){var n=this,i=this.module.getTexts(),a=".calibration";t.off(a),t.off("tooltipFormat").on("tooltipFormat",function(e,t){var n=t.x+" - <strong>"+t.y+" "+i.l+"</<strong>";return n}),t.on("rowdelete"+a,function(e,i){for(var a=t.jqChart("option","series"),s=a[0].data,l=s.length;l--;)if(s[l][0]==i){s.splice(l,1);break}s.length<2?T.removeCalibrationChart.call(n,t):t.jqChart("update")}),t.on("rowchange"+a,function(){var i=T.serializeCalibration.call(n,e);if(t.data("chart")){var a=t.jqChart("option","series");a[0].data=T.prepareCalibrationData.call(n,i),t.jqChart("update")}else i.sensorValue.length>1&&(t.removeClass("hidden"),T.drawCalibrationChart.call(n,t,i))})},removeCalibrationChart:function(e){e.data("chart")&&e.empty().removeData("data").data("chart",!1).addClass("hidden")},addCalibrationRec:function(e,t){var n=e.find(".chart"),t=t||e.content.find("tbody tr").not(".example"),i=e.content.find("tbody tr.example"),a=i.clone().removeClass("example hidden").prependTo(e.find("tbody")),s=a.find(".itext").removeAttr("disabled");e.trigger("jw.contentchange"),t=t.add(a),t.removeClass("even").filter(":even").addClass("even"),a.find(".itext:first").focus(),s.on("keyup.calibration change.calibration",function(){n.trigger("rowchange.calibration")})},delCalibrationRec:function(t,n){var i=e(t).parents("tr"),a=parseInt(i.find("input").first().val());i.remove(),n.trigger("jw.contentchange");var s=n.find("tbody tr").not(".example");s.removeClass("even").filter(":even").addClass("even"),0==s.length&&T.addCalibrationRec.call(this,n,s),n.find(".chart").trigger("rowdelete.calibration",a)},reloadCalibrationRecs:function(e,t){if(T.calibrationProcessing)return!1;T.calibrationProcessing=!0,e.addClass("loading");var n=this;this._loadFuelCalibrationTable(t).done(function(i){if(e.length){e.content.html(y({params:{id:n.model.get("item").id,sensor:t},editable:!0,table:i,i18n:n.module.getTexts()}));var a=e.content.find("tbody tr").not(".example"),s=e.find(".chart");0==a.length&&T.addCalibrationRec.call(this,e,a),T.initCalibrationChart.call(n,e,i),e.content.find(".itext").on("keyup.calibration change.calibration",function(){s.trigger("rowchange.calibration")})}}).always(function(){e.removeClass("loading"),T.calibrationProcessing=!1})},serializeCalibration:function(n){var i=n.find("form").serializeObject();t.isArray(i.sensorValue)||(i.sensorValue=[i.sensorValue]),t.isArray(i.realValue)||(i.realValue=[i.realValue]);for(var a=Math.min(i.sensorValue.length,i.realValue.length);a--;)e.isNumeric(i.sensorValue[a])&&e.isNumeric(i.realValue[a])||(i.sensorValue.splice(a,1),i.realValue.splice(a,1));return i},saveCalibrationRecs:function(t){var n=this;if(T.calibrationProcessing)return!1;T.calibrationProcessing=!0,t.addClass("loading");var i=T.serializeCalibration.call(this,t);e.ajax({url:App.getBaseUrl()+"objects/obj-fuel-calibration-save/",data:i,success:function(){t.trigger("jw.close")},complete:function(e){t.removeClass("loading"),T.calibrationProcessing=!1,e.status>=200&&e.status<300||alert(n.module.getTexts().errors.canNotSave)}})},calibrationProcessing:!1};return M.SettingsProvider=function(){o.SettingsProvider.apply(this,arguments)},a.extend(M.SettingsProvider,o.SettingsProvider),t.extend(M.SettingsProvider.prototype,{getCopySettingsFormLabel:function(){return this.i18n.copyFiltersFormLabel},getCopySettingsObjectsType:function(){return App.TYPE_MOBILE},getSettingsToCopy:function(){var e=this.context.$el.find(".track-filters-input"),t=["USE_MANUAL_FILTERS"];return e.each(function(){t.push(this.name)}),App.isMapMatchingAllowed()&&t.push("MAP_MATCHING_VEHICLE"),t},onCopySettingsFormSubmit:function(e,t){var n=this.i18n;i.confirm(n.copyFiltersConfirm,n.copy+"?",{okCallback:t})}}),M}),define("mobile/itemcard/MobileItemCardModule",["underscore","abstracts/itemcard/CardModel","abstracts/itemcard/ItemCardModule","mobile/itemcard/views/MobileItemCardView","mobile/itemcard/views/MobileItemCardEditableView"],function(e,t,n,i,a){var s=n.extend({constructor:function(){n.apply(this,arguments)},open:function(e){this.cardModel=new l({id:e.id,module:this}),this._open(e,a,i)},getPossibleStates:function(){return this.get("parent").getPossibleStates()},getClearDataUrl:function(){var e=this.cardModel.get("item"),t="undefined"!=typeof e.clearingFrom,n=t?"check-clear-task":"obj-import-ts";return App.getBaseUrl()+"objects/"+n+"/"}}),l=t.extend({url:App.getBaseUrl()+"objects/obj-card/",defaults:e.extend({},t.prototype.defaults,{objType:App.TYPE_MOBILE}),constructor:function(){t.apply(this,arguments)},update:function(t){var n={id:"id",name:"name",CAR_ID:"licenseNumber",MODEL:"model",IMAGE_PATH:"imgPath"},i={};for(var a in n)e.isUndefined(t[a])||(i[n[a]]=t[a]);this.get("module").get("parent").trigger("itemchanged",[i],this)},clearDataHistory:function(e){return $.ajax({url:App.getBaseUrl()+"objects/clearroutehistory/",data:{objectId:this._object.id,from:e,tz:App.getUserTimezone()}})}});return s}),define("text!mobile/editor/tmpl/formGroup.html",[],function(){return'<input type="hidden" name="groupType" value="<%= App.TYPE_MOBILE %>">\n<input type="hidden" name="parentId" value="<%= parentId || \'\' %>">\n<input class="input-block-level no-margin" name="name" type="text"\n       placeholder="<%= i18n.enterGroupName %>" value="<%- name %>" maxlength="255">'}),define("mobile/editor/views/MobileEditorView",["underscore","abstracts/editor/views/EditorView","text!mobile/editor/tmpl/formGroup.html"],function(e,t,n){var i=t.extend({constructor:function(){this._tmplGroup=e.template(n),t.apply(this,arguments)}});return i}),define("mobile/editor/MobileEditorModule",["abstracts/editor/DeviceEditorModule","_common/mobile/MobileObject","mobile/MobileObjectsGroup","mobile/editor/views/MobileEditorView"],function(e,t,n,i){var a=e.extend({constructor:function(){e.apply(this,arguments)},initialize:function(){this.ItemsClass=t,this.GroupsClass=n,e.prototype.initialize.call(this,i)}});return a});