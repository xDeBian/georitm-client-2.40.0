define(["jquery","underscore","_libs/charts/Chart","./ChartView"],function(t,e,i,s){var a=s.prototype,r=25,h=60,n=s.extend({constructor:function(){this.$labels=null,this.$labelsList=null,this.isDiscrets=!0,s.apply(this,arguments)},render:function(){this.$labels=this.$el.find(".chart-labels"),this.$labelsList=this.$labels.find(".chart-labels-list");var t=this.parent,s=this.$chart,a=this.model,r=a.getSelectedParamsWithData(!0),h=r.length;this._renderLabels(),this._chart=new i(s,e.extend(this._getCommonChartOptions(),{width:this.isAlone?void 0:this._calcWidth(),height:this._calcHeight(h),axes:[e.extend(this._getDateTimeAxisOptions(),{majorGridLines:{strokeStyle:"#dadada"}}),{type:"category",margin:15,labels:{visible:!1}}],series:this._makeSeries(r)})),this.isAlone||this.$chart.on("axisZoom",function(){var e=this.getXAxis();t.trigger("zoom:change",[e.visibleMinimum,e.visibleMaximum])}.bind(this)),null!==this.singleParam&&s.bind("tooltipFormat",function(e,i){var s=i.x,a=i.from,r=i.to,h="<strong>"+s+"</strong><br />";return h+=t.formatDateTime(new Date(a))+" - "+t.formatDateTime(new Date(r))}.bind(this))},_bindEvents:function(){this.parent,a._bindEvents.call(this)},_makeSeries:function(t){for(var e,i,s,a,r,h=this.model,n=t.length,l=[],o=0;n>o;++o){for(e=[],i=n-1;i>=0;--i)s=t[i],r=s.name,a=h.getSerie(s.key),i===o?e=e.concat(a.data):e.push([r]);l.push({type:"rangeBar",key:t[o].key,title:!1,fillStyle:t[o].color,pointWidth:.7,data:e})}return l},_updateSeries:function(){var t=this._getSeries().length>0,e=this._makeSeries(this.model.getSelectedParamsWithData(!0));this._renderLabels(),this._setSeries(e),e.length>0?(t||(this.$el.removeClass("hidden"),this.isVisible=!0),this.$chart.jqChart("option","height",this._calcHeight(e.length)),this._update(),t||this.parent.trigger("chart:toggle","discrets",this,!0)):t&&(this.$el.addClass("hidden"),this.isVisible=!1,this.parent.trigger("chart:toggle","discrets",this,!1))},_toggleParam:function(){this._updateSeries()},_renderLabels:function(){var t=this.model.getSelectedParamsWithData(!0),i=this.$labelsList,s="";e.each(t,function(t){s+='<div class="chart-labels-list-item">'+t.name+"</div>"}),i.html(s)},getYAxisWidth:function(){return this.$labels.width()-8},_calcSeriesHeight:function(t){return t*r},_calcHeight:function(t){return this._calcSeriesHeight(t)+h}});return n});