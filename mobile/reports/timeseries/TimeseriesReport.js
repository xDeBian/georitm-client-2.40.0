define(["jquery","underscore","_common/reports/Report","_common/tracks/TracksModule","./views/TimeseriesReportView"],function(e,r,t,n,a){function i(e,r){return Math.random()*(r-e)+e}function o(e,r,t){return"#"+((1<<24)+(e<<16)+(r<<8)+t).toString(16).slice(1)}function s(e){return e>360?e-360:e}function u(e,r){return e=Math.floor(255*(e+r)),0>e&&(e=0),e}function m(e,r,t){var n,a,i,s=(1-Math.abs(2*t-1))*r,m=s*(1-Math.abs(e/60%2-1)),c=t-s/2;return 60>e?(n=s,a=m,i=0):120>e?(n=m,a=s,i=0):180>e?(n=0,a=s,i=m):240>e?(n=0,a=m,i=s):300>e?(n=m,a=0,i=s):(n=s,a=0,i=m),n=u(n,c),a=u(a,c),i=u(i,c),o(n,a,i)}function c(e,r,t,n){return Math.abs(e-r)<t&&(e=r+t,e>n&&(e=r-t)),e}function g(e,r){for(var t,n,a,o=360,u=Math.floor(o/r),g=.4,p=.9,y=.3,k=.7,l=new Array(r),d=0,f=0,P=0;r>P;++P)t=s(e+P*u),n=c(i(g,p),d,.2,p),a=c(i(y,k),f,.2,k),l[P]=m(t,n,a),d=n,f=a;return l}function p(e){var r=e.timeseries;return[{key:"location",name:r.geolocation},{key:"body",name:r.carBody},{key:"transmission",name:e.driveline},{key:"electricity",name:r.electricEquipment},{key:"engine",name:e.engine},{key:"events",name:e.alerts.ucFirst()},{key:"temperature",name:e.temperature},{key:"iqfreeze",name:"IQFreeze"},{key:"fuel",name:e.fuel.ucFirst()},{key:"accelerometer",name:e.accelerometer},{key:"network",name:r.communication},{key:"fms",name:r.fmsParameters}]}function y(e){var r=e.timeseries,t=e.fuel.ucFirst();return[{key:"P9",name:e.speed.ucFirst(),group:"location"},{key:"P10",name:r.satellites,group:"location"},{key:"P11",name:r.altitude,group:"location"},{key:"P12",name:e.course.ucFirst(),group:"location"},{key:"P13",name:"HDOP",group:"location"},{key:"P14",name:"VDOP",group:"location"},{key:"P43",name:r.beingInGeozone,group:"location",discret:!0},{key:"P44",name:r.crossingTheGeozone,group:"location",discret:!0},{key:"P51",name:r.navMileage,group:"location"},{key:"P15",name:r.carExternalVoltage,group:"electricity"},{key:"P16",name:r.deviceInternalVoltage,group:"electricity"},{key:"P128",name:r.carIgnitionKey+" (CAN)",group:"electricity",discret:!0},{key:"P129",name:r.carAccessories+" (CAN)",group:"electricity",discret:!0},{key:"P132",name:r.carParkingLights+" (CAN)",group:"electricity",discret:!0},{key:"P133",name:r.carDippedBeam+" (CAN)",group:"electricity",discret:!0},{key:"P134",name:r.carHighBeam+" (CAN)",group:"electricity",discret:!0},{key:"P135",name:r.carSafetyBelt+" (CAN)",group:"electricity",discret:!0},{key:"P136",name:r.carWiperFront+" (CAN)",group:"electricity",discret:!0},{key:"P137",name:r.carDirIndicatorLeft+" (CAN)",group:"electricity",discret:!0},{key:"P138",name:r.carDirIndicatorRight+" (CAN)",group:"electricity",discret:!0},{key:"P112",name:r.carDoorFrontLeft+" (CAN)",group:"body",discret:!0},{key:"P113",name:r.carDoorFrontRight+" (CAN)",group:"body",discret:!0},{key:"P114",name:r.carDoorRearRight+" (CAN)",group:"body",discret:!0},{key:"P115",name:r.carDoorRearLeft+" (CAN)",group:"body",discret:!0},{key:"P116",name:r.carHood+" (CAN)",group:"body",discret:!0},{key:"P117",name:r.carCompartment+" (CAN)",group:"body",discret:!0},{key:"P118",name:r.carSecuritySystemIsOn+" (CAN)",group:"body",discret:!0},{key:"P119",name:r.carSecuritySystem+" (CAN)",group:"body",discret:!0},{key:"P139",name:r.carCentralLock+" (CAN)",group:"body",discret:!0},{key:"P120",name:r.drivelineInD+" (CAN)",group:"transmission",discret:!0},{key:"P121",name:r.drivelineInR+" (CAN)",group:"transmission",discret:!0},{key:"P122",name:r.drivelineInN+" (CAN)",group:"transmission",discret:!0},{key:"P123",name:r.drivelineInP+" (CAN)",group:"transmission",discret:!0},{key:"P124",name:r.breakPedal+" (CAN)",group:"transmission",discret:!0},{key:"P125",name:r.parkingBreak+" (CAN)",group:"transmission",discret:!0},{key:"P126",name:e.movement.ucFirst()+" (CAN)",group:"transmission",discret:!0},{key:"P127",name:r.operationalMode+" (CAN)",group:"transmission",discret:!0},{key:"P52",name:r.machineHoursDevice,group:"engine"},{key:"P106",name:r.coolingFluidTemperature+" (CAN)",group:"engine"},{key:"P107",name:r.engineSpeed+" (CAN)",group:"engine"},{key:"P108",name:r.instantaneousFlowRate+" (CAN)",group:"engine"},{key:"P109",name:r.machineHours+" (CAN)",group:"engine"},{key:"P110",name:r.totalMileage+" (CAN)",group:"engine"},{key:"P111",name:r.totalMileageToMaintenance+" (CAN)",group:"engine"},{key:"P130",name:r.ignition+" (CAN)",group:"engine",discret:!0},{key:"P131",name:r.engineStarted+" (CAN)",group:"engine",discret:!0},{key:"P186",name:e.acceleration,group:"events",discret:!0},{key:"P187",name:r.inclination,group:"events",discret:!0},{key:"P188",name:r.impact,group:"events",discret:!0},{key:"P189",name:r.accident,group:"events",discret:!0},{key:"P190",name:r.carTip,group:"events",discret:!0},{key:"P191",name:r.carRollOver,group:"events",discret:!0},{key:"P192",name:r.carTest,group:"events",discret:!0},{key:"P193",name:e.alarm.ucFirst(),group:"events",discret:!0},{key:"P194",name:e.movement,group:"events",discret:!0},{key:"P195",name:r.lowInternalBattery,group:"events",discret:!0},{key:"P196",name:r.configurationCable,group:"events",discret:!0},{key:"P197",name:r.remoteSoftware,group:"events",discret:!0},{key:"P198",name:r.tamper,group:"events",discret:!0},{key:"P199",name:r.fix3d,group:"events",discret:!0},{key:"P200",name:r.callEvent+" 1",group:"events",discret:!0},{key:"P201",name:r.callEvent+" 2",group:"events",discret:!0},{key:"P202",name:r.callEvent+" 3",group:"events",discret:!0},{key:"P208",name:e.engine,group:"events",discret:!0},{key:"P209",name:r.externalBattery,group:"events",discret:!0},{key:"P210",name:r.externalSupply,group:"events",discret:!0},{key:"P211",name:r.ignition,group:"events",discret:!0},{key:"P212",name:r.chargeEvent,group:"events",discret:!0},{key:"P213",name:r.reloadEvent,group:"events",discret:!0},{key:"P214",name:r.navigation,group:"events",discret:!0},{key:"P215",name:r.communication,group:"events",discret:!0},{key:"P216",name:r.makeAndBreakGerkon,group:"events",discret:!0},{key:"P217",name:r.externalFieldGerkon,group:"events",discret:!0},{key:"P218",name:r.externalGerkon,group:"events",discret:!0},{key:"P219",name:r.accessDenied,group:"events",discret:!0},{key:"P220",name:r.newWirelessNetworkEvent,group:"events",discret:!0},{key:"P221",name:r.connectionRetention,group:"events",discret:!0},{key:"P222",name:r.trackingEvent,group:"events",discret:!0},{key:"P223",name:r.readerEvent,group:"events",discret:!0},{key:"P224",name:r.discreteInputDin+"1",group:"events",discret:!0},{key:"P225",name:r.discreteInputDin+"2",group:"events",discret:!0},{key:"P226",name:r.discreteInputDin+"3",group:"events",discret:!0},{key:"P227",name:r.discreteInputDin+"4",group:"events",discret:!0},{key:"P228",name:r.discreteInputDin+"5",group:"events",discret:!0},{key:"P229",name:r.discreteInputDin+"6",group:"events",discret:!0},{key:"P230",name:r.discreteInputDin+"7",group:"events",discret:!0},{key:"P231",name:r.discreteInputDin+"8",group:"events",discret:!0},{key:"P232",name:r.discreteInputDin+"9",group:"events",discret:!0},{key:"P233",name:r.discreteInputDin+"10",group:"events",discret:!0},{key:"P234",name:r.discreteInputDin+"11",group:"events",discret:!0},{key:"P235",name:r.discreteInputDin+"12",group:"events",discret:!0},{key:"P236",name:r.discreteInputDin+"13",group:"events",discret:!0},{key:"P237",name:r.discreteInputDin+"14",group:"events",discret:!0},{key:"P238",name:r.discreteInputDin+"15",group:"events",discret:!0},{key:"P239",name:r.discreteInputDin+"16",group:"events",discret:!0},{key:"P240",name:r.controlOut+" 1",group:"events",discret:!0},{key:"P241",name:r.controlOut+" 2",group:"events",discret:!0},{key:"P242",name:r.controlOut+" 3",group:"events",discret:!0},{key:"P243",name:r.controlOut+" 4",group:"events",discret:!0},{key:"P244",name:r.controlOut+" 5",group:"events",discret:!0},{key:"P245",name:r.controlOut+" 6",group:"events",discret:!0},{key:"P246",name:r.controlOut+" 7",group:"events",discret:!0},{key:"P247",name:r.controlOut+" 8",group:"events",discret:!0},{key:"P248",name:r.debugging+" 1",group:"events",discret:!0},{key:"P249",name:r.debugging+" 2",group:"events",discret:!0},{key:"P250",name:r.debugging+" 3",group:"events",discret:!0},{key:"P251",name:r.debugging+" 4",group:"events",discret:!0},{key:"P252",name:r.debugging+" 5",group:"events",discret:!0},{key:"P253",name:r.debugging+" 6",group:"events",discret:!0},{key:"P254",name:r.debugging+" 7",group:"events",discret:!0},{key:"P25",name:r.cpuTemperarure,group:"temperature"},{key:"P26",name:r.wire1Temperarure,group:"temperature"},{key:"P2000",name:r.temperatureInRefSection+" 1 (IQFreeze)",group:"iqfreeze"},{key:"P2001",name:r.temperatureInRefSection+" 2 (IQFreeze)",group:"iqfreeze"},{key:"P2002",name:r.temperatureInRefSection+" 3 (IQFreeze)",group:"iqfreeze"},{key:"P2003",name:r.temperatureSpecifiedN+" 1 (IQFreeze)",group:"iqfreeze"},{key:"P2004",name:r.temperatureSpecifiedN+" 2 (IQFreeze)",group:"iqfreeze"},{key:"P2005",name:r.temperatureSpecifiedN+" 3 (IQFreeze)",group:"iqfreeze"},{key:"P2006",name:r.ambientTemperature+" (IQFreeze)",group:"iqfreeze"},{key:"P2007",name:r.coolantTemperature+" (IQFreeze)",group:"iqfreeze"},{key:"P2008",name:r.temperatureAnalogueSensor+" 1 (IQFreeze)",group:"iqfreeze"},{key:"P2009",name:r.temperatureAnalogueSensor+" 2 (IQFreeze)",group:"iqfreeze"},{key:"P2010",name:r.temperatureAnalogueSensor+" 3 (IQFreeze)",group:"iqfreeze"},{key:"P2011",name:r.temperatureAnalogueSensor+" 4 (IQFreeze)",group:"iqfreeze"},{key:"P2012",name:r.temperatureAnalogueSensor+" 5 (IQFreeze)",group:"iqfreeze"},{key:"P2013",name:r.temperatureAnalogueSensor+" 6 (IQFreeze)",group:"iqfreeze"},{key:"P2014",name:r.iqfreezeRpm+" (IQFreeze)",group:"iqfreeze"},{key:"P2015",name:r.iqfreezeConf+" (IQFreeze)",group:"iqfreeze"},{key:"P2016",name:r.iqfreezeConf2+" (IQFreeze)",group:"iqfreeze"},{key:"P2017",name:r.iqfreezeConf3+" (IQFreeze)",group:"iqfreeze"},{key:"P2018",name:r.iqfreezeState+" (IQFreeze)",group:"iqfreeze"},{key:"P2019",name:r.iqfreezeState2+" (IQFreeze)",group:"iqfreeze"},{key:"P2020",name:r.iqfreezeState3+" (IQFreeze)",group:"iqfreeze"},{key:"P2021",name:r.iqfreezeBatv+" (IQFreeze)",group:"iqfreeze"},{key:"P2022",name:r.iqfreezeBata+" (IQFreeze)",group:"iqfreeze"},{key:"P2023",name:r.iqfreezeHm+" (IQFreeze)",group:"iqfreeze"},{key:"P2044",name:r.iqfreezeHme+" (IQFreeze)",group:"iqfreeze"},{key:"P2024",name:r.iqfreezeHmt+" (IQFreeze)",group:"iqfreeze"},{key:"P2025",name:r.iqfreezeAlcount+" (IQFreeze)",group:"iqfreeze"},{key:"P2026",name:r.iqfreezeAl1+" (IQFreeze)",group:"iqfreeze"},{key:"P2027",name:r.iqfreezeAl2+" (IQFreeze)",group:"iqfreeze"},{key:"P2028",name:r.iqfreezeAl3+" (IQFreeze)",group:"iqfreeze"},{key:"P2029",name:r.iqfreezeAl4+" (IQFreeze)",group:"iqfreeze"},{key:"P2030",name:r.iqfreezeAl5+" (IQFreeze)",group:"iqfreeze"},{key:"P2031",name:r.iqfreezeAl6+" (IQFreeze)",group:"iqfreeze"},{key:"P2032",name:r.iqfreezeAdcErrN.replace("#n#","1")+" (IQFreeze)",group:"iqfreeze"},{key:"P2033",name:r.iqfreezeAdcErrN.replace("#n#","2")+" (IQFreeze)",group:"iqfreeze"},{key:"P2034",name:r.iqfreezeAdcErrN.replace("#n#","3")+" (IQFreeze)",group:"iqfreeze"},{key:"P2035",name:r.iqfreezeAdcErrN.replace("#n#","4")+" (IQFreeze)",group:"iqfreeze"},{key:"P2036",name:r.iqfreezeAdcErrN.replace("#n#","5")+" (IQFreeze)",group:"iqfreeze"},{key:"P2037",name:r.iqfreezeAdcErrN.replace("#n#","6")+" (IQFreeze)",group:"iqfreeze"},{key:"P2039",name:r.iqfreezeRefType+" (IQFreeze)",group:"iqfreeze"},{key:"P2041",name:r.iqfreezeDr+" (IQFreeze)",group:"iqfreeze"},{key:"P2042",name:r.iqfreezeDr2+" (IQFreeze)",group:"iqfreeze"},{key:"P2043",name:r.iqfreezeDr3+" (IQFreeze)",group:"iqfreeze"},{key:"P2047",name:r.iqfreezeNoConnect+" (IQFreeze)",group:"iqfreeze"},{key:"P2048",name:r.iqfreezeInN.replace("#n#","1"),group:"iqfreeze"},{key:"P2049",name:r.iqfreezeInN.replace("#n#","2"),group:"iqfreeze"},{key:"P2055",name:r.iqfreezeLic,group:"iqfreeze"},{key:"P2056",name:r.iqfreezeDevType,group:"iqfreeze"},{key:"P17",name:t+" 1 (RS485)",group:"fuel"},{key:"P18",name:e.temperature+" 1 (RS485)",group:"fuel"},{key:"P19",name:t+" 2 (RS485)",group:"fuel"},{key:"P20",name:e.temperature+" 2 (RS485)",group:"fuel"},{key:"P21",name:t+" 3 (RS485)",group:"fuel"},{key:"P22",name:e.temperature+" 3 (RS485)",group:"fuel"},{key:"P23",name:t+" 4 (RS485)",group:"fuel"},{key:"P24",name:e.temperature+" 4 (RS485)",group:"fuel"},{key:"P27",name:e.fuelConsumption+" 1",group:"fuel"},{key:"P28",name:e.fuelConsumption+" 2",group:"fuel"},{key:"P29",name:t+" 1 ("+r.fuelSensorHzShort+")",group:"fuel"},{key:"P30",name:t+" 2 ("+r.fuelSensorHzShort+")",group:"fuel"},{key:"P31",name:t+" 1 ("+r.fuelSensorAdcShort+")",group:"fuel"},{key:"P32",name:t+" 2 ("+r.fuelSensorAdcShort+")",group:"fuel"},{key:"P53",name:t+" (RS232)",group:"fuel"},{key:"P54",name:e.temperature+" (RS232)",group:"fuel"},{key:"P103",name:e.fuelVolume+", "+e.l+" (CAN)",group:"fuel"},{key:"P104",name:e.fuelVolume+", %"+" (CAN)",group:"fuel"},{key:"P105",name:e.totalFuelConsumption+", "+e.l+" (CAN)",group:"fuel"},{key:"P35",name:r.accelerationXAxis,group:"accelerometer"},{key:"P36",name:r.accelerationYAxis,group:"accelerometer"},{key:"P37",name:r.accelerationZAxis,group:"accelerometer"},{key:"P38",name:"ACC V",group:"accelerometer"},{key:"P39",name:"ACC VS",group:"accelerometer"},{key:"P40",name:r.tangage,group:"accelerometer"},{key:"P41",name:r.vehicleRoll,group:"accelerometer"},{key:"P33",name:r.gsmSignalLevel,group:"network"},{key:"P34",name:r.wifiSignalLevel,group:"network"},{key:"P46",name:e.country+" (LBS)",group:"network"},{key:"P47",name:e.gsmProvider+" (LBS)",group:"network"},{key:"P48",name:r.lbsCell+" (LBS)",group:"network"},{key:"P49",name:r.lbsZone+" (LBS)",group:"network"},{key:"P50",name:r.lbsLevel+" (LBS)",group:"network"},{key:"P176",name:r.gsmSuppression,group:"network"},{key:"ID_PRM1",name:r.fmsParameterKey(1),group:"fms"},{key:"ID_PRM2",name:r.fmsParameterKey(2),group:"fms"},{key:"ID_PRM3",name:r.fmsParameterKey(3),group:"fms"},{key:"ID_PRM4",name:r.fmsParameterKey(4),group:"fms"},{key:"ID_PRM5",name:r.fmsParameterKey(5),group:"fms"},{key:"ID_PRM6",name:r.fmsParameterKey(6),group:"fms"},{key:"VALUE_PRM1",name:r.fmsParameterValue(1),group:"fms"},{key:"VALUE_PRM2",name:r.fmsParameterValue(2),group:"fms"},{key:"VALUE_PRM3",name:r.fmsParameterValue(3),group:"fms"},{key:"VALUE_PRM4",name:r.fmsParameterValue(4),group:"fms"},{key:"VALUE_PRM5",name:r.fmsParameterValue(5),group:"fms"},{key:"VALUE_PRM6",name:r.fmsParameterValue(6),group:"fms"},{key:"FUEL_LEVEL",name:e.fuelVolume+", %"+" (CAN)",group:"fms"},{key:"FUEL_LITRES",name:e.fuelVolume+", "+e.l+" (CAN)",group:"fms"},{key:"FUEL_RATE",name:e.fuelConsumption+" (CAN)",group:"fms"},{key:"FUEL_SUMM",name:e.totalFuelConsumption+" (CAN)",group:"fms"},{key:"E_HOURS",name:r.machineHours+" (CAN)",group:"fms"},{key:"E_SPEED",name:r.engineSpeed+" (CAN)",group:"fms"},{key:"E_TEMP",name:r.coolantTemperature+" (CAN)",group:"fms"},{key:"ENGINE_REGIMS",name:r.operationalMode+" (CAN)",group:"fms"},{key:"SERVICE_DISTANCE",name:r.totalMileageToMaintenance+" (CAN)",group:"fms"},{key:"PERIMETR",name:r.carCentralLock+" (CAN)",group:"fms",discret:!0},{key:"TRANSMISSION",name:e.movement+" (CAN)",group:"fms",discret:!0},{key:"VEHICLE_D",name:r.drivelineInD+" (CAN)",group:"fms",discret:!0},{key:"AXLE_NUMBER",name:r.carAxisNumber+" (CAN)",group:"fms"},{key:"AXLE_W",name:r.carAxelLoad+" (CAN)",group:"fms"},{key:"VEHICLE_P",name:e.vehicleVoltage+" (CAN)",group:"fms"},{key:"CAR_POWER",name:e.vehicleVoltage+" (CAN)",group:"fms"}]}var k=t.prototype,l=t.extend({defaults:r.extend({},t.prototype.defaults,{keys:[],useFormatted:!0}),constructor:function(){this._series=[],this._formattedSeries=[],this._params=[],this._requests=[],this._isRemoved=!1,this._isRawOnly=!0,t.apply(this,arguments)},initialize:function(){this.makeTracksModule(n),this._prepareParams(),k.initialize.call(this,a),this.on("remove",function(){this._isRemoved=!0,this._abort()}),this._loadSeries()},isRawOnly:function(){return this._isRawOnly},buildTrackSegment:function(e){return this._tracksModule.items.remove(this._tracksModule.items.models),e.color="#992e53",k.buildTrackSegment.call(this,e)},_loadSeries:function(){this._series=[],this._isRawOnly=!0,this._params.forEach(function(e){this._fetchSerie(e.key).done(function(r){if(!this._isRemoved){var t=e.discret===!0;this._series.push(t?this._prepareDiscretData(e,r):this._prepareSensorData(e,r,1)),!t&&r.length&&r[0].length>2&&(this._isRawOnly=!1,this._formattedSeries.push(this._prepareSensorData(e,r,2))),this.trigger("serie:ready",e,r.length),this._checkReady()}}.bind(this)).fail(function(){this._isRemoved||(this._series.push({key:e.key,data:[],error:!0}),this.trigger("serie:error",e),this._checkReady())}.bind(this))}.bind(this))},_checkReady:function(){this._series.length===this._params.length&&(this._isRawOnly&&this.set("useFormatted",!1),this.trigger("ready"))},_prepareParams:function(){var e=this.get("keys");Array.isArray(e)||(e=[e]),this.setUserData("checked",e);var t=g(200,e.length),n=this.getAvailableParameters();this._params=r.map(e,function(e,a){var i=r.findWhere(n,{key:e});return r.extend({},i,{color:t[a],show:!0})})},_prepareSensorData:function(e,r,t){var n,a=[],i=null,o=null;return r.length&&(i=1/0,o=-1/0,r.forEach(function(e){n=e[t],i=Math.min(i,n),o=Math.max(o,n),a.push([new Date(e[0]*App.MS),n])}),a.push([new Date(this.get("endTime")),n])),{key:e.key,min:i,max:o,data:a}},_prepareDiscretData:function(e,r){var t,n,a=null,i=[],o=e.name,s=r.length;if(s>0){for(var u=0;s>u;++u)t=r[u][0]*App.MS,n=r[u][1],1===n?a||(a=t):a&&(i.push([o,a,t]),a=null);a?i.push([o,a,this.get("endTime")]):i.length||(t=this.get("startTime"),i.push([o,t,t]))}return{key:e.key,data:i}},getAvailableParameters:function(){return y(this.getTexts())},getParams:function(){return this._params},getParam:function(e){return r.findWhere(this._params,{key:e})},toggleParameter:function(e,r){var t=this.getParam(e);t&&(t.show=r,this.trigger("param:toggle",t,r))},getSelectedParams:function(e){var t=this._params,n=r.filter(t,function(e){return e.show});return void 0===e?n:r.filter(n,function(r){return e?r.discret===!0:r.discret!==!0})},getSelectedParamsWithData:function(e){var r=this.getSelectedParams(e),t=[];return r.forEach(function(e){var r=this.getSerie(e.key);r.data.length>0&&t.push(e)}.bind(this)),t},getShownParamsWithData:function(e){return r.filter(this.getSelectedParamsWithData(e),function(e){return e.show})},getSerie:function(e){return r.findWhere(this._series,{key:e})},getFormattedSerie:function(e){var t=r.findWhere(this._formattedSeries,{key:e});return t||this.getSerie(e)},getTranslatedUnits:function(e){var r=this.getTexts(),t={kmh:r.kmh,km:r.km,h:r.hour,volt:r.volt,litres:r.l,lph:r.l1h,dbm:r.dbm,rpm:r.rpm,percents:"%",celsius:"&deg;C",grad:"&deg;",g:"G"};return e in t?t[e]:""},getValuesByTs:function(e){var t=this.getShownParamsWithData(),n=this.get("useFormatted");return r.map(t,function(r){return{color:r.color,name:r.name,units:n&&r.units?this.getTranslatedUnits(r.units):"",value:r.discret?this.findNearestDiscretData(r.key,e):this.findNearestSensorData(r.key,e)}}.bind(this))},findNearestDiscretData:function(e,r){var t=this.getSerie(e),n=t.data.findIndex(function(e){return e[1]<=r&&e[2]>=r});return n>-1?1:0},findNearestSensorData:function(e,r){var t=this.get("useFormatted")?this.getFormattedSerie(e):this.getSerie(e),n=t.data,a=null,i=n.length;if(i){var o=n[0],s=n[i-1];if(r>=s[0].getTime()||r<o[0].getTime())a=null;else{var u,m=n.findIndex(function(e){return u=e[0].getTime(),u>=r});a=u===r?n[m]:n[m-1]}}return a?a[1]:null},isDiscret:function(e){var r=this.getParam(e);return r&&r.discret===!0},fetch:function(){var r=new e.Deferred;return this.trigger("sync",this,null,{}),r.resolve()},_fetchSerie:function(r){var t=new e.Deferred;return this._requests.push(e.ajax({url:App.getBaseUrl()+"reports/TIMESERIES/",data:{objectId:this.get("objectId"),ptype:r,from:this.prepareDate(this.get("startTime")),to:this.prepareDate(this.get("endTime")),tzId:this.get("tzId")}}).done(function(e){"unit"in e.header&&(this.getParam(r).units=e.header.unit),t.resolve(e.body.data)}.bind(this)).fail(t.reject)),t},_abort:function(){this._requests.map(function(e){4!==e.readyState&&e.abort()})}});return l.getAvailableParameters=y,l.getParameterGroups=p,l});