define(["jquery","underscore","_common/reports/views/ReportView","text!_common/reports/tmpl/reportTable.html","text!../tmpl/thead.html","text!../tmpl/row.html","text!../tmpl/summaryRow.html"],function(e,t,o,r,n,a,d){n=t.template(n),a=t.template(a),d=t.template(d);var i=o.extend({FIX_HEADER:1,constructor:function(){o.apply(this,arguments)},render:function(){var a=new e.Deferred;this.model.getTexts(),o.prototype.render.apply(this,arguments),this.$el.addClass("zonevizcount-report"),this.buildMetaInfo();var d="";this.content.append(t.template(r,{key:this.model.get("key"),theadHtml:""})),d+=n({objects:this.model.get("footer")}),d+=s.buildRows.call(this);var i=this.content.find("tbody");return i.append(d),this._prepareWideReportFixedHeader(),this.$el.find(".export-link[data-format=pdf]").remove(),a.resolve(),a}}),s={buildRows:function(){var e=this.model.get("header"),o=e.keyOrder,r=o.length,n=this.model.get("body").zones,i=n.length,s=0,l=0,p=0,m="",h=[],f=0,u=new Array(r);for(l=0;r>l;++l)u[l]=0;return t.each(n,function(t){if("undefined"!=typeof t.vizits){for(h=new Array(r),f=0,l=0;r>l;++l)p=t.vizits[o[l]]||0,h[l]={nb:p,objectId:o[l]},p>0&&(u[l]++,f++);m+=a({zoneName:t.name,zoneId:t.id,from:e.sd*App.MS,to:e.ed*App.MS,data:h,isLast:++s>=i,sum:f})}}),m+=d({txt:this.model.getTexts().geozonesVisitedOfTotal.replace("#total#",i),data:u,total:i})}};return i});