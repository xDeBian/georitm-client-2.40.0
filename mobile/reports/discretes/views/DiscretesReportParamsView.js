define(["jquery","underscore","abstracts/View","text!../tmpl/params.html","text!_common/reports/tmpl/deviceProps.html","i18n!_common/reports/nls/canReport"],function(e,t,n,r,i,s){r=t.template(r),i=t.template(i);var c=n.prototype,a=n.extend({constructor:function(){this.controller=null,n.apply(this,arguments)},className:"discretes-params",initialize:function(e){this.controller=e.controller,c.initialize.apply(this,arguments)},render:function(){var e=this.controller,n=e.getTexts(),c=e.get("parent").getUserData("discretes")||{},a=c.properties||["extId","name"],o=t.indexBy(c.parameterNums||[]),l=t.indexBy(c.metrics||["switch"]),m=["224","225","226","227"];t.range(76,80).forEach(function(e){e=String(e),m.push(e+".1"),m.push(e+".2")});var u=[{name:s.carPerimeter,checked:!0,nums:["112","113","114","115","116","117","118","119"]},{name:s.carTransmission,checked:!0,nums:["120","121","122","123","124","125","126","127"]},{name:s.carExtraDevices,checked:!0,nums:["128","129","130","211","131","208","132","133","134","135","209","210"]},{name:s.carDiscretes,checked:!0,nums:m}],d=0;return t.each(u,function(e){for(d=e.nums.length;d--;)if(!(e.nums[d]in o)){e.checked=!1;break}}),this.$el.html(r({i18n:n,i18nCan:s,dur:c.dur||5,ranges:u,checked:o,checkedMetrics:l,propertiesHtml:i({i18n:n,properties:a})})),this.$el},setContainer:function(){return this.$el.find("input[name=dur]").numeric({decimal:!1,negative:!1}),this.$el.find("fieldset.parameters").each(function(){e(this).selectAll({selector:"input[name^=parameterNums]"})}),this},setHistoryAllowed:function(e){var t=this.$el.find(".checkbox-history");t[e?"removeClass":"addClass"]("hidden").find("input").prop("disabled",!e)},_bindEvents:function(){this.controller.getTexts()}});return a});