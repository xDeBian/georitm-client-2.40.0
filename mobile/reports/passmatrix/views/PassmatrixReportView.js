define(["jquery","underscore","_common/reports/views/ReportView","text!../tmpl/passmatrixTable.html","text!../tmpl/row.html","text!../tmpl/rowNoObjectData.html"],function(e,t,r,s,a,n){s=t.template(s),a=t.template(a),n=t.template(n);var o=r.extend({constructor:function(){this._markerId=0,this._markerData={},this._noAddressData=[],r.apply(this,arguments)},render:function(){var s=new e.Deferred,a=this.model.get("body"),n="";return this.$el.addClass("passmatrix-report"),r.prototype.render.apply(this,arguments),this.buildMetaInfo(),t.each(a,function(e,t){n+=i.renderObjectTable.call(this,e,t)}.bind(this)),this.content.append(n),this._noAddressData.length&&this.listenTo(this.model,"afterrender",function(){this.model.searchAddresses(this._noAddressData)}),this._initMarkersLinks(function(e){e.title=e.markerTitle,this.putMarkers([e],{icon:new L.ComplexIcon({html:"",className:"track-marker park"}),popup:{type:"passMatrix",className:"track-info pass-info"},zoom:!0})}.bind(this)),s.resolve(),s}}),i={renderObjectTable:function(e,t){var r="",a=this.model.getTexts(),o={},d=e.doorNums,l=e.name+" (#"+e.extId+")";return d.length?(o.i18n=a,o.header=l,o.headIndex=t+1,o.nums=d,o.rowsHtml=i.renderRows.call(this,e),r=s(o)):r=n({header:l,msg:a.noDataForObject}),r},renderRows:function(e){var r,s=e.doorNums,n=e.doorEvents,o="",i=this.model.getTexts(),d=n.length;return t.each(n,function(n,l){t.each(s,function(e){e in n.doors||(n.doors[e]={"in":0,out:0})}),r=n,r.dateS=this.formatDateTime(n.time),r.markerTitle=e.name+" (#"+e.extId+")","geoId"in n&&0!=n.lat&&0!=n.lon&&(n.address||(this._noAddressData.push(n),r.loadingAddress=i.loadingAddress),r.markerId=++this._markerId,this._markerData[this._markerId]=r),r.rowClass=++l%2?"odd":"even",r.isLast=l==d,o+=a(r)}.bind(this)),o}};return o});