var PRODUCTION=!0;define("dashboard/DashboardWidgetsCollection",["underscore","abstracts/Collection"],function(e,t){var i=t.extend({constructor:function(e,i){this.parent=i.parent,this.page=i.page,t.apply(this,arguments)},buildWidgets:function(t,i){var n=[],s=[],o=this.parent.getAvailableWidgets(),a=null,l=this;e.each(t,function(e){e.type in o&&(n.push("dashboard/"+o[e.type].path+"Widget"),s.push(e))}),requirejs(n,function(){var t=0;e.each(arguments,function(i){i&&(a=new i(e.extend({},s[t],{parent:l.parent,removable:!0})),l.add([a]),++t)}),i&&i()})}});return i}),define("text!dashboard/tmpl/dashboard.html",[],function(){return'<!-- parent element moved to app.html to avoid blinking on start -->\n<div class="header clearfix">\n    <h1><%= i18n.dashboard %><!--<small>(beta)</small>--></h1>\n\n    <div class="actions">\n        <!--<div class="close hint hint-left" data-hint="<%= i18n.goToMap %>">&times;</div>-->\n        <div class="close hint hint-left" data-hint="<%= i18n.goToMap %>">\n            <svg class="svg-icon">\n                <use xlink:href="#smb-earth"></use>\n            </svg>\n        </div>\n    </div>\n</div>\n<div class="container">\n    <% for(var i = 0; i < totalPages; ++i) {%>\n    <div data-page="<%= i %>" class="content <% if(curPage == i) {%> active<% } %>">\n        <!--<div data-row="0" class="row row-fluid">\n            <div data-col="0" class="col span3"></div>\n            <div data-col="1" class="col span3"></div>\n            <div data-col="2" class="col span3"></div>\n            <div data-col="3" class="col span3"></div>\n        </div>\n\n        <div data-row="1" class="row row-fluid">\n            <div class="d-widget span6">\n                <div class="header">\n                    <h3>Objects state</h3>\n                </div>\n                <div class="content"></div>\n            </div>\n            <div class="d-widget span6">\n                <div class="header">\n                    <h3>Objects state</h3>\n                </div>\n                <div class="content"></div>\n            </div>\n        </div>-->\n    </div>\n    <% } %>\n    <label class="checkbox no-bottom-margin">\n        <input type="checkbox" name="startWithDashboard" value="1"<% if(startWithDashboard){ %> checked<% } %>>\n        <%= i18n.startWithDashboard %>\n    </label>\n</div>\n\n'}),define("text!dashboard/tmpl/add.html",[],function(){return'<div id="d-adding">\n    <div class="row-fluid">\n        <% var i = 0; _.each(widgets, function(data, key){ %>\n        <% if(i > 0 && i % 4 == 0){ %>\n        </div><div class="row-fluid">\n        <% } %>\n        <div class="d-example span3" data-key="<%= key %>">\n            <div class="content clearfix">\n                <h3><%= data.title %></h3>\n                <p><%= data.description %></p>\n            </div>\n            <img src="<%= data.img %>" alt="">\n            <div class="actions">\n                <a class="btn-add"><!--<%= i18n.add.ucFirst() %>--><i class="svg-icon svg-icon-circle-plus"></i></a>\n            </div>\n        </div>\n        <% i++; }) %>\n    </div>\n    <a class="close"><i class="svg-icon svg-icon-circle-remove"></i></a>\n</div>'}),define("dashboard/views/DashboardModuleView",["jquery","underscore","abstracts/View","text!dashboard/tmpl/dashboard.html","text!dashboard/tmpl/add.html","css!_libs/charts/ragAndFunnel/ragAndFunnel.css","css!dashboard/css/skin.css","css!dashboard/css/dashboard.css"],function(e,t,i,n,s){n=t.template(n),s=t.template(s);var o=2,a=4,l=i.extend({el:e("#dashboard"),constructor:function(){this._numberByPages=[],this._addEl=null,this._placeToAdd=null,this._ghost=null,i.apply(this,arguments)},initialize:function(){this.render()},render:function(){var e=this.model.getTexts(),t=this.model.id.replace(/\//g,"-"),i=n({moduleId:t,active:this.model.get("active"),name:"DASHBOARD",totalPages:this.model.get("totalPages"),curPage:this.model.get("curPage"),startWithDashboard:App.get("startWithDashboard"),i18n:e});this.$el.append(i),r.bindEvents.call(this),this.model.get("active")&&r.onActivate.call(this)},clear:function(){e(window).off("resize.dashboard"),this.$el.find(".d-placeholder").remove()},removePlaceholder:function(e){this.$el.find("[data-page="+e.page+"] .d-placeholder[data-x="+e.x+"][data-y="+e.y+"]").remove()},getRows:function(){return o},getCols:function(){return a}}),r={bindEvents:function(){var i=this,n=this.model;this.listenTo(n,"change:active",function(t,s){var o=n.getTexts();i.$el[s?"removeClass":"addClass"]("invisible"),s&&!i.$el.find(".d-widget").length&&r.onActivate.call(this),e("#main-hdr .brand").attr("data-hint",s?o.map.ucFirst():o.showDashboard)}).listenTo(n,"widgetprepared",function(e,t){r.replacePlaceholder.call(i,e.$el,t)}).listenTo(n,"widgetready",function(){}).listenTo(n,"vacantplace",function(e){r.addPlaceholder.call(i,e)}),this.$el.on("click",".d-vacant i",function(){var t=e(this).parent(),n={x:t.data("x"),y:t.data("y"),w:t.data("w"),h:t.data("h"),page:t.closest("[data-page]").data("page")};r.addWidget.call(i,n)}).on("click","#d-adding",function(){i._addEl.remove(),i._placeToAdd=null}).on("click",".d-example",function(e){e.stopPropagation()}).on("click","[data-key]",function(t){t.stopPropagation(),n.addWidget(i._placeToAdd,e(this).data("key")),i._addEl.remove(),i._placeToAdd=null}).on("click",".d-resize",function(){var t=e(this).closest(".d-widget"),n=this.className.slice(-1),s=t.data("x"),o=t.data("y"),l=t.data("w"),r=(t.data("h"),s+l),d=!1;if("e"==n){if(r>=a)return;for(var h=i.model.getWidgetsParams({x:r}),c=h.length;c--;)if(h[c].y+h[c].h>=o){d=!0;break}}return d?!1:(t.attr("data-w",l+1),i.$el.find(".content.active .d-placeholder[data-x="+r+"][data-y="+o+"]").remove(),t.trigger("resized"),void 0)}).find(">.header .close").on("click",function(){n.set("active",!1)}),this.$el.find("input[name=startWithDashboard]").on("click",function(){App.set("startWithDashboard",this.checked)}),e(window).on("resize.dashboard",t.throttle(function(){var t=i.$el.find(".ui-draggable");e(window).width()>767?t.draggable("enable"):t.draggable("disable")},60))},onActivate:function(){r.makePlaceholders.call(this)},makePlaceholders:function(){for(var e=this.model.get("totalPages"),i=[],n=null,s=null,l="",d=0,h=0,c=0,u=0,p=0,g=0,m=[],f=0;e>f;++f){for(n=this.$el.find("[data-page="+f+"]"),i=this.model.getWidgetsParams({page:f}),l="",this._numberByPages[f]=0,d=0;o>d;++d)for(h=0;a>h;++h)if(-1==t.indexOf(m,""+d+","+h))if(s=t.findWhere(i,{x:h,y:d}))if(l+=r.getPlaceholderHTML({x:h,y:d,w:s.w,h:s.h},!1),this._numberByPages[f]++,s.w*s.h>1)for(p=h+s.w-1,g=d+s.h-1,u=h;p>=u;++u)for(c=d;g>=c;++c)m.push(""+c+","+u);else m.push(""+d+","+h);else l+=r.getPlaceholderHTML({x:h,y:d},!0),m.push(""+d+","+h);n.append(l)}},getPlaceholderHTML:function(e,t){var i=t?"div":"section",n="<"+i+' class="d-placeholder '+(t?" d-vacant":"")+' d-widget"'+' data-x="'+e.x+'" data-y="'+e.y+'"'+' data-w="'+(e.w||1)+'" data-h="'+(e.h||1)+'"'+'">';return n+=t?'<i class="svg-icon svg-icon-circle-plus"></i>':'<i class="svg-icon svg-icon-spinner icon-spin"></i>',n+="</"+i+">"},replacePlaceholder:function(e,t){var i=this.$el.find("[data-page="+t.page+"]"),n=i.find(".d-placeholder[data-x="+t.x+"][data-y="+t.y+"]");n.replaceWith(e)},addPlaceholder:function(e){var t="";if(e.w*e.h>1)for(var i={page:e.page,w:1,h:1},n=e.x+e.w-1,s=e.y+e.h-1,o=e.x;n>=o;++o)for(var a=e.y;s>=a;++a)i.x=o,i.y=a,r.addPlaceholder.call(this,i);else t=r.getPlaceholderHTML(e,!0),this.$el.find("[data-page="+e.page+"]").append(t)},addWidget:function(i){var n=this.model.getAvailableWidgets();t.each(n,function(e,t){!e.img&&(e.img=requirejs.toUrl("dashboard/"+t+"/img.png"))}),this._placeToAdd=i,this._addEl=e(s({widgets:n,i18n:this.model.getTexts()})).appendTo(this.$el),e.fn.scrollTo&&this.$el.scrollTo(0)}};return l}),define("dashboard/nls/dashboard",{root:{dashboard:"Dashboard",startWithDashboard:"Show dashboard first",goToMap:"Go to the map",alarms:"Alarms",beingProcessed:"In process",inQueue:"In queue",totalObjects:"Total objects",inGroup:"in the group",objectsState:"Objects state",objectsStateDescr:"Shows the GSM-connection and coordinate fixation state",objType:"Objects Type",objTypes:"Types of objects",objTypesDescr:"Shows data by versions of installed equipment",objNumber:"Total objects",objQuantities:"Number of mobile and stationary objects",universalWidget:"Universal indicator",universalWidgetDescr:"Shows the ratio of object numbers by different options",beingServed:"Maintained",beingServed1:"Are maintained",notBeingServed:"Are not maintained",servedOnly:"Maintained only",objectsMoving:"On the way",objectsNotMoving:"On the parking",objectsWithNoPower:"No Power",objectsInOrder:"Fault free",objectsNotInOrder:"Faulty",objectOnline:"Online",objectOffline:"Offline",objectGSMOnline:"No coordinates",noGsmSignalTime:"Offline more than",noGpsSignalTime:"No coordinates more than",gsmInOrderTime:"Offline up to",gpsInOrderTime:"No coordinates up to",dateAndTime:"Date and time",dateAndTimeDescr:"Shows date, time, weekday and timezone",noObjects:"No Objects",objectOnMap:"Object on the map",objectOnMapDescr:"Shows one selected object and the last track with the specified length on the map",parkBegin:"start",parkEnd:"end",parkTime:"parking time",errSelectObject:"Select the object",trackLength:"Track Length",errEnterTrackLength:"Enter the track length",updateDist:"Update if shifted",noObjectWithCoords:"There is no object with coordinates",errEnterUpdateDist:"Enter the distance",errValueBetween:"The value must be between #min# and #max#",errSelectMinutes:"Select at least one option.",errDevicesLoadingFailed:"Failed to load objects data.",removeWidgetHdr:"Remove the widget?",removeWidgetMsg:"Free space will be available after that and you can add another or the same widget."},"ru-ru":!0,"it-it":!0}),define("dashboard/nls/ru-ru/dashboard",{dashboard:"Сводная информация",startWithDashboard:"Начинать с показа сводной информации",goToMap:"Перейти на карту",alarms:"Тревоги",beingProcessed:"В работе",inQueue:"В очереди",totalObjects:"Всего объектов",inGroup:"в группе",objectsState:"Состояние объектов",objectsStateDescr:"Показывает состояние GSM-связи и фиксации координат",objType:"Тип объектов",objTypes:"Типы объектов",objTypesDescr:"Показывает статистику по версиям установленного оборудования",objNumber:"Всего объектов",objQuantities:"Количество мобильных и стационарных объектов",universalWidget:"Универсальный индикатор",universalWidgetDescr:"Показывает соотношение количеств объектов по различным параметрам",beingServed:"Обслуживаемые",beingServed1:"Обслуживаются",notBeingServed:"Не обслуживаются",servedOnly:"Только обслуживаемые",objectsMoving:"В пути",objectsNotMoving:"На стоянке",objectsWithNoPower:"Нет питания",objectsInOrder:"Исправны",objectsNotInOrder:"Неисправны",objectOnline:"Онлайн",objectOffline:"Нет связи",objectGSMOnline:"Нет координат",noGsmSignalTime:"Нет на связи более",noGpsSignalTime:"Нет координат более",gsmInOrderTime:"Нет связи не более",gpsInOrderTime:"Нет координат не более",dateAndTime:"Дата и время",dateAndTimeDescr:"Показывает дату, время, день недели и часовой пояс",noObjects:"Нет объектов",objectOnMap:"Объект на карте",objectOnMapDescr:"Показывает на карте один выбранный объект и последний трек заданной длины",parkBegin:"начало",parkEnd:"окончание",parkTime:"время стоянки",errSelectObject:"Выберите объект",trackLength:"Длина трека",errEnterTrackLength:"Введите длину трека",updateDist:"Обновлять при смещении",noObjectWithCoords:"Нет объекта с координатами",errEnterUpdateDist:"Введите расстояние",errValueBetween:"Значение должно быть между #min# и #max#",errSelectMinutes:"Выберите хотя бы один параметр.",errDevicesLoadingFailed:"Не удалось загрузить данные объектов.",removeWidgetHdr:"Убрать виджет?",removeWidgetMsg:"После этого останется свободное место и Вы сможете добавить другой или такой же виджет."}),define("dashboard/DashboardModule",["underscore","jquery","abstracts/Model","abstracts/Module","dashboard/DashboardWidgetsCollection","dashboard/views/DashboardModuleView","i18n!_common/nls/common","i18n!dashboard/nls/dashboard"],function(e,t,i,n,s,o,a,l){var r=t.extend({},a,l),d=2e4,h=12e4,c=1e3,u=4e3,p=4001,g=4010,m=3,f=1,b=1,v=[{id:1,type:"objst",page:0,x:0,y:0,w:f,h:b,options:{objType:App.hasModule("mobile")?App.TYPE_MOBILE:App.TYPE_STAT,served:!0}},{id:2,type:"objrev",page:0,x:f,y:0,w:f,h:b,options:{served:!0}}];App.hasModule("mobile")?(v.push({id:3,type:"mobjmap",page:0,x:2*f,y:0,w:2*f,h:b}),v.push({id:4,type:"objuni",page:0,x:0,y:b,w:f,h:b,options:{show:"served"}}),v.push({id:5,type:"objuni",page:0,x:f,y:b,w:f,h:b,options:{groupId:null,show:"inorder",served:!0}}),v.push({id:6,type:"objuni",page:0,x:2*f,y:b,w:f,h:b,options:{groupId:null,show:"nopower",served:!0}}),v.push({id:7,type:"objuni",page:0,x:3*f,y:b,w:f,h:b,options:{groupId:null,show:"moving",served:!0}})):(v.push({id:3,type:"objuni",page:0,x:2*f,y:0,w:f,h:b,options:{objType:App.TYPE_STAT,show:"served"}}),v.push({id:4,type:"objuni",page:0,x:3*f,y:0,w:f,h:b,options:{objType:App.TYPE_STAT,groupId:null,show:"inorder",served:!0}}),v.push({id:5,type:"objuni",page:0,x:0,y:b,w:f,h:b,options:{objType:App.TYPE_STAT,groupId:null,show:"guarded",served:!0}}),v.push({id:6,type:"objq",page:0,x:f,y:b,w:f,h:b}),v.push({id:7,type:"clock",page:0,x:2*f,y:b,w:f,h:b}));var y=n.extend({constructor:function(){this.pages=[],this._ws=null,this._wsTimeout=null,this._sockActivity=!1,this._lastWidgetId=0,this._destroyTmt=null,n.apply(this,arguments)},defaults:{totalPages:3,widgetsParams:null,curPage:0,totalMobileObjects:null,processing:!1,destroyed:!1},initialize:function(){var e=this,t=this.getUserData("totalPages")||1;for(this.set("totalPages",t),this.set("curPage",this.getUserData("curPage")||0),this.pages=new Array(t);t--;)this.pages[t]=new s([],{parent:this,page:t});var i,n;(i=this.getUserData("userParams"))?n=i:(this.setUserData("userParams",v),n=v),this.set("widgetsParams",n);for(var a=n.length,l=0;a--;)l=Math.max(l,n[a].id);if(this._lastWidgetId=l,w.checkAllowed.call(this),this._view=new o({model:this}),w.bindEvents.call(this),this.get("active")){var r=this.get("curPage");this.pages[r].buildWidgets(this.getWidgetsParams({page:r}),function(){w.makeSocket.call(e)})}},destroy:function(){this.set("destroyed",!0);for(var e=this.pages.length;e--;)this.pages[e].remove(this.pages[e].models);this._view.clear(),this._ws&&this._ws.close(c)&&(this._ws=null)},getTexts:function(){return r},getAvailableWidgets:function(){var e={objst:{path:"objst/ObjectsState",title:r.objectsState,description:r.objectsStateDescr},objrev:{path:"objrev/ObjectsRev",title:r.objTypes,description:r.objTypesDescr},objq:{path:"objq/ObjectsNumber",title:r.objNumber,description:r.objQuantities},objuni:{path:"objuni/ObjectsUni",title:r.universalWidget,description:r.universalWidgetDescr},mobjmap:{path:"mobjmap/MobileObjectMap",title:r.objectOnMap,description:r.objectOnMapDescr},clock:{path:"clock/Clock",title:r.dateAndTime,description:r.dateAndTimeDescr}};return App.hasModule("mobile")||delete e.mobjmap,e},getWidgetsParams:function(t){return e.where(this.get("widgetsParams"),t)},removeWidget:function(t){var i=t.pick("x","y","w","h","page");t.set("removed",!0),t.collection.remove(t),this.set("widgetsParams",e.filter(this.get("widgetsParams"),function(e){return e.id!=t.id})),this.setUserData("userParams",this.get("widgetsParams")),w.sendCurrentWidgetsOptions.call(this),this.trigger("vacantplace",i)},addWidget:function(e,t){var i=e.page;if(this.pages[i]){var n=e;n.type=t,n.id=++this._lastWidgetId;var s=this;this.pages[i].buildWidgets([n],function(){var e=s.get("widgetsParams");e.push(n),s.set("widgetsParams",e),s.setUserData("userParams",e),w.sendCurrentWidgetsOptions.call(s),s.trigger("widgetadded",e)})}},setUserParams:function(e,t){for(var i=(e.id,t.length),n=this.getWidgetsParams({id:e.id}),s=null;i--;)s=e.get(t[i]),n[0]&&(n[0][t[i]]=s);this.setUserData("userParams",this.get("widgetsParams"))}}),w={bindEvents:function(){var e=this;this.on("change:active",function(t,i){if(i){e._destroyTmt&&clearTimeout(e._destroyTmt),e._destroyTmt=null;var n=e.pages[e.get("curPage")];n.models.length||(this.set("destroyed",!1),n.buildWidgets(e.getWidgetsParams({page:n.page}),function(){w.makeSocket.call(e)}))}else e._destroyTmt||(e._destroyTmt=setTimeout(function(){e.destroy()},d))}).on("change:totalPages",function(t,i){e.setUserData("totalPages",i)}).on("change:curPage",function(t,i){e.setUserData("curPage",i),e._ws&&e._ws.close(p)}).on("optionschange",function(t){e.setUserParams(t,["options"]),w.sendCurrentWidgetsOptions.call(e)}).on("poschange",function(t){e.setUserParams(t,["x","y"])}).on("sizechange",function(t){e.setUserParams(t,["w","h"])}).on("showobjects",function(i){e.get("processing")||(e.set("processing",!0),showCursor(),t.ajax({url:App.getBaseUrl()+"objects/obj/",data:{objectId:i},success:function(e){App.trigger("showobjects",e)},complete:function(){hideCursor(),e.set("processing",!1)}}))}),this.listenTo(App,"showobjects",function(){e.set("active",!1)}).listenTo(App,"logout",function(){e._ws&&e._ws.close(c)}).listenTo(App,"stopall",function(){e._ws&&e._ws.close(c),e.listenToOnce(App,"startall",function(){e.get("active")&&w.makeSocket.call(e)})}).listenTo(App,"change:visible",function(t,i){i?e.get("active")&&App.serverUp&&w.makeSocket.call(e):e._ws&&e._ws.close(c)}),t(window).unload(function(){e._ws&&e._ws.close(c)}).on("beforeunload",function(){!t.browser.ie&&e._ws&&e._ws.close(c)})},checkAllowed:function(){for(var e=this.get("widgetsParams"),t=e.length,i=0,n=this.getAvailableWidgets(),s=null;t--;)if("undefined"!=typeof n[e[t].type]){if(s=n[e[t].type],s.rights)for(i=s.rights.length;i--;)if(!App.allowed(s.rights[i])){e.splice(t,1);break}}else e.splice(t,1)},getSockParams:function(){var e=this;return{url:App.getBaseUrl().replace(/http:\/\/|https:\/\//,"")+"socket/dashboard?authorization="+encodeURIComponent(App.getBasic()),onmessage:function(t){w.onSocketReceive.call(e,t.data)}}},makeSocket:function(){var t=w.getSockParams.call(this),i=this,n="ws";App.isHttpsServer()&&(n="wss"),this._ws=new WebSocket(n+"://"+t.url),this._wsTimeout=setTimeout(function(){i._ws&&i._ws.readyState==m&&w.onerror.call(i)},200);var s=i._ws;w.initSocket.call(i).done(function(){e.each(["onmessage","onerror","onclose"],function(e){s[e]=function(n){w[e]&&w[e].call(i,n),t[e]&&t[e].call(i,n)}})}).fail(function(){})},initSocket:function(){var e=new t.Deferred,i=this,n=this._ws;return n.onopen=function(){w.sendCurrentWidgetsOptions.call(i),i._wsTimeout&&clearTimeout(i._wsTimeout),w.setReopenTimeout.call(i),e.resolve()},e},setReopenTimeout:function(){var e=this;this._wsTimeout=setTimeout(function(){e._sockActivity?(e._sockActivity=!1,w.setReopenTimeout.call(e)):e._ws&&e._ws.close(u)},h)},onclose:function(e){this._ws=null,this._sockActivity=!1,e.code===c||(e.code===g?App.trigger("logout"):(e.code==u||e.code==p)&&w.makeSocket.call(this))},onerror:function(){this.get("destroyed")||App.trigger("serverlost")},sendCurrentWidgetsOptions:function(){if(this._ws){var e=this.pages[this.get("curPage")],t={},i="",n={};e.each(function(e){i=e.getDataKey(),n=e.getDataOptions(),"undefined"!=typeof t[i]?t[i].push(n):t[i]=[n]}),this._ws.send(JSON.stringify(t))}},onSocketReceive:function(i){var n,s=this;(n=t.parseJSON(i))&&(this._sockActivity=!0,e.each(n,function(t,i){for(var n=s.pages[s.get("curPage")].models,o=n.length,a=null,l=0,r="",d=[];o--;)if(a=n[o],a.getDataKey()==i)for(d=[],l=t.length;l--;)t[l].options&&(r=JSON.stringify(a.getDataOptions()),r==JSON.stringify(t[l].options)&&-1==e.indexOf(d,r)&&(d.push(r),delete t[l].options,a.set(t[l]),a.trigger("update")))}))}};return y}),define("dashboard/DashboardWidget",["underscore","jquery","abstracts/Module"],function(e,t,i){var n=i.extend({constructor:function(){i.apply(this,arguments)},defaults:{type:"",title:"",subTitle:"",page:0,x:0,y:0,w:1,h:1,resizable:null,options:{}},initialize:function(e){var t="d-widget loading";if(this.get("removable")&&(t+=" removable"),this.has("objType")){var i=this.get("options")||{};i.objType==App.TYPE_STAT?this.set("objType","stat"):i.objType==App.TYPE_MOBILE?this.set("objType","mobile"):this.set("objType","all")}this._view=new e({tagName:"section",className:t,attributes:{"data-id":this.id,"data-x":this.get("x"),"data-y":this.get("y"),"data-w":this.get("w"),"data-h":this.get("h")},model:this,module:this.get("parent")})},setUserData:function(e,t){var i=this.getUserDataPrefix()+"."+e;return App.getStorage().set(i,t)},getUserData:function(e){var t=this.getUserDataPrefix()+"."+e;return App.getStorage().get(t)},getUserDataPrefix:function(){return this.get("parent").id.replace(/\//g,".")+"."+this.get("key")},getEventsPrefix:function(){return this.get("parent").getEventsPrefix()+"."+this.id},getTexts:function(){return this.get("parent").getTexts()},getDataKey:function(){return this.get("type")},getDataOptions:function(){var t=e.clone(this.get("options")||{});return e.each(t,function(e,i){null===e&&delete t[i]}),t},getDataOptionsTest:function(){var t=e.clone(this.get("options")||{});return e.each(t,function(e,i){null===e&&delete t[i]}),{total:this.get("total"),nb:this.get("nb")||null,options:t}},getSubTitle:function(){var e=this.getTexts(),t=e.allObjects,i=this.get("options")||{};return i.groupId?(t=this.has("group")?this.get("group").name:e.inGroup,i.served&&(t+=" ("+e.beingServed.toLowerCase()+")")):i.served&&(t=e.beingServed),t}});return n}),define("text!dashboard/tmpl/widget.html",[],function(){return'<!--<div class="d-widget cf-item col-sm-3">-->\n<div class="header <% if(\'undefined\' != typeof settings) {%> append<% } %>">\n    <h3>\n        <svg class="svg-icon icon-car">\n            <use xlink:href="#smb-car"></use>\n        </svg>\n        <svg class="svg-icon icon-home">\n            <use xlink:href="#smb-home"></use>\n        </svg>\n        <span class="name"><% if(\'undefined\' != typeof title) { print(title) }%></span>\n    </h3>\n    <div class="add-on">\n        <% if(\'undefined\' != typeof settings) {%>\n        <a class="svg-icon svg-icon-cog-w settings-toggle" href="#"></a>\n        <% } %>\n        <a class="svg-icon svg-icon-circle-remove-w remove-link" href="#"></a>\n    </div>\n</div>\n<div class="content"><% if(\'undefined\' != typeof content) { print(content) }%></div>\n\n<% if(\'undefined\' != typeof settings) { %>\n<form class="settings invisible" method="post">\n    <div class="form-content">\n        <%= \'string\' == typeof settings ? settings : \'\' %>\n    </div>\n    <div class="form-actions">\n        <button type="submit" class="btn btn-small btn-primary"><%= i18n.save %></button>\n        <a class="btn btn-small settings-close" href="#"><%= i18n.cancel %></a>\n    </div>\n</form>\n<% } %>\n\n<div class="loader"><i class="svg-icon svg-icon-spinner icon-spin"></i></div>\n<!--\n</div>-->\n'}),define("text!dashboard/tmpl/servedAndGroup.html",[],function(){return'<input type="hidden" name="groupId" value="<%= \'undefined\' != typeof group && group ? group.id : \'\' %>" >\n<label><%= i18n.group %></label>\n<div class="form-search">\n    <input type="text" name="groupName" value="<%= \'undefined\' != typeof group && group ? group.name : \'\' %>"\n        placeholder="<%= i18n.allObjects %>">\n    <i class="icon-clear svg-icon svg-icon-circle-remove"></i>\n    <i class="icon-spin svg-icon svg-icon-spinner"></i>\n</div>\n\n<label class="checkbox"><input type="checkbox" name="served" value="1"\n    <% if(\'undefined\' != typeof served && served) {%> checked<% } %>>\n    <%= i18n.servedOnly %>\n</label>\n'}),define("dashboard/views/DashboardWidgetView",["jquery","jqueryui","underscore","jface","abstracts/View","text!dashboard/tmpl/widget.html","text!dashboard/tmpl/servedAndGroup.html","_libs/charts/ragAndFunnel/ragAndFunnel"],function(e,t,i,n,s,o,a){o=i.template(o),a=i.template(a);var l=App.getBaseUrl()+"objs-groups/search/",r={},d=null;r[App.TYPE_MOBILE]={},r[App.TYPE_STAT]={};var h=s.extend({constructor:function(){this.module=null,this.content=null,this.settings=null,this.title=null,this.subTitle=null,s.apply(this,arguments)},initialize:function(e){var t=this;this.module=this.module||e.module,this.listenTo(this.model,"add",function(){t.render()}).listenTo(this.model,"remove",function(){t.stopListening(t.model),t.remove()}).listenTo(this.model,"update",function(){t.$el.removeClass("updating")}).listenTo(this.model,"change:title",function(e,i){t.setTitle(i)}).listenTo(this.model,"change:subTitle",function(e,i){t.setSubTitle(i)}).listenTo(this.model,"change:total",function(e,i){t.$el.removeClass("loading"),null===e.previous("total")?(t.$el.removeClass("loading"),0===i?t.setEmpty():t.$el.removeClass("empty")):null===i&&t.$el.addClass("loading")}),this.model.has("objType")&&this.listenTo(this.model,"change:objType",function(e,i){t.$el.removeClass(e.previous("objType")).addClass(i)})},render:function(t){var s=this,a=this.model.getTexts(),r=i.extend({},t,{title:this.model.get("title"),i18n:a});if(this.$el.html(o(r)),this.content=this.$el.find(".content"),this.title=this.$el.find("h3 .name"),this.subTitle=this.$el.find("h4"),this.$el.on("click",".remove-link",function(){n.confirm(a.removeWidgetMsg,a.removeWidgetHdr,{okCallback:function(){s.module.removeWidget(s.model,s.$el)}})}),this.model.has("objType")&&this.$el.addClass(this.model.get("objType")),t.settings){this.settings=this.$el.find(".settings");var d=this.settings[0],h=this.settings.find(".form-content");this.$el.on("click",".settings-toggle",function(){-1!=d.className.indexOf("invisible")&&(h.find(".ui-autocomplete-input").autocomplete("destroy"),h.html(s.renderSettings()),c.initObjTypeSelection.call(s),c.initGroupSelection.call(s),s._initSettings(),d.className=d.className.replace(" invisible",""),s.content[0].className+=" invisible")}).on("click",".settings-close",function(){d.className+=" invisible",s.content[0].className=s.content[0].className.replace(" invisible","")}),this.settings.on("submit",function(){var t=s.settings.serializeObject();if(t.objType=c.getSelectedObjType.call(s),"undefined"!=typeof t.groupName&&e.trim(t.groupName).length>2){showCursor();var i={q:String(t.groupName)};null!==t.objType&&(i.groupType=t.objType),e.ajax({url:l,data:i,success:function(e){e.length?(t.groupId=e[0].id,t.objType=e[0].groupType):(t.groupId=0,t.objType=App.hasMobile()?null:App.TYPE_STAT),s._onSettingsSubmit(t)},error:function(){t.groupId=0,s._onSettingsSubmit(t)},complete:hideCursor}),delete t.groupName}else"undefined"!=typeof t.groupName&&delete t.groupName,null!==t.objType||App.hasMobile()||(t.objType=App.TYPE_STAT),s._onSettingsSubmit(t);return!1}),c.initGroupSelection.call(s)}this.model.has("resizable")&&e.fn.resizable&&(this.$el.on("resized",function(){s._initResizable()}),this._initResizable(),this.listenTo(this.module,"widgetadded vacantplace",function(){s._initResizable()})),this.module.trigger("widgetprepared",this,this.model.attributes)},renderSettings:function(){var e=this.model,t=e.getTexts(),i=e.get("options")||{};return a({served:i.served||!1,group:e.get("group"),i18n:t})},setTitle:function(e){this.title.html(e)},setSubTitle:function(e){this.subTitle.html(e)},setEmpty:function(){this.$el.addClass("empty")},remove:function(){this.stopListening(App),this.module&&this.stopListening(this.module),s.prototype.remove.apply(this,arguments)},_initSettings:function(){},_onSettingsSubmit:function(e,t){t=t||!1;var n=i.clone(this.model.get("options"))||{};"undefined"==typeof e.groupId||e.groupId||(e.groupId=null,this.model.has("group")&&this.model.set("group",null)),"undefined"!=typeof e.served?e.served="1"==e.served?!0:!1:n.served&&(e.served=null);var s;return App.hasModule("stat")?App.hasModule("mobile")?"undefined"!=typeof e.objType&&this.model.has("objType")&&(s="all",e.objType==App.TYPE_MOBILE?s="mobile":e.objType==App.TYPE_STAT&&(s="stat")):s="stat":s="mobile",s&&this.model.set("objType",s),i.extend(n,e),JSON.stringify(this.model.getDataOptions())==JSON.stringify(n)?n:(t||this._updateOptions(n),n)},_updateOptions:function(e){this.model.set("options",e),this.$el.addClass("updating"),this.module.trigger("optionschange",this.model),this.settings[0].className+=" invisible",this.content[0].className=this.content[0].className.replace(" invisible","")},_showErrors:function(t){var n=this,s=null,o=null;i.each(t,function(t){s=n.settings.find("[name="+t.key+"]").addClass("error"),o=e('<p class="error">'+t.msg+"</p>"),-1!=s[0].className.indexOf("autocomplete")?o.insertBefore(s.parent()):o.insertBefore(s)}),e.fn.scrollTo&&n.settings.find(".form-content").scrollTo("p.error")[0],n.settings.find("input.error").first().focus()},_initResizable1:function(){var e=this.model,t=(this.module,e.get("x"),e.get("y"),e.get("w"),e.get("h"),this._getResizeDirections());this.$el.find(".d-resize").remove();var n="";i.each(t,function(e){n+='<div class="d-resize d-resize-'+e+'"></div>'}),this.$el.append(n)},_initResizable:function(){var t=this,n=this._getResizeDirections(),s=this.model,o=this.module,a=s.get("page"),l=s.get("resizable"),r=0,d=0,h=1,c=1,u=1,p=1,g=0,m=0,f=o.getView().getRows(),b=o.getView().getCols(),v=!n.length,y=!1,w=null;if(-1!=this.el.className.indexOf("ui-resizable"))if(n.length){-1!=this.el.className.indexOf("disabled")&&this.$el.resizable("option","disabled",!1).removeClass("ui-resizable-disabled");var T=this.$el.find(".ui-resizable-handle").removeClass("hidden");T.each(function(){-1==i.indexOf(n,this.className.slice(-1))&&e(this).addClass("hidden")})}else this.$el.resizable("option","disabled",!0).addClass("ui-resizable-disabled");else this.$el.resizable({handles:"n,s,w,e",helper:"ui-resizable-helper d-ghost",disabled:v,create:function(){if(v)e(this).addClass("ui-resizable-disabled");else{var s=t.$el.find(".ui-resizable-handle");s.each(function(){-1==i.indexOf(n,this.className.slice(-1))&&e(this).addClass("hidden")})}},start:function(){r=t.$el.data("x"),d=t.$el.data("y"),h=t.$el.data("w"),c=t.$el.data("h"),u=r+h,p=d+c,y=!1,w=t.$el.data("ui-resizable")},resize:i.throttle(function(e,i){var n=!1,s="",v=0;if(g=i.originalSize.width,m=i.originalSize.height,i.size.width!=g&&Math.abs(i.size.width-g)>Math.abs(i.size.height-m)?(s=i.originalPosition.left==i.position.left?"e":"w",v=i.size.width-g,n=i.size.width>g):i.size.height!=m&&(s=i.originalPosition.top==i.position.top?"s":"n",v=i.size.height-m,n=i.size.height>m),!(Math.abs(v)<30)){var T={page:a,w:1,h:1};if(n){if("w"==s){if(h+1>l.maxWidth||0>r-1)return;r--,h++,t.$el.attr("data-x",r).data("x",r),t.$el.attr("data-w",h).data("w",h)}else if("e"==s){if(h+1>l.maxWidth||r+h>b)return;h++,t.$el.attr("data-w",h).data("w",h)}else if("n"==s){if(c+1>l.maxHeight||0>d-1)return;d--,c++,t.$el.attr("data-y",d).data("y",d),t.$el.attr("data-h",c).data("h",c)}else if("s"==s){if(c+1>l.maxHeight||d+c>f)return;c++,t.$el.attr("data-h",c).data("h",c)}if("w"==s||"e"==s)for(var j=c;j--;)T.y=d+j,T.x="w"==s?r:u,o.getView().removePlaceholder(T);else for(var j=h;j--;)T.x=r+j,T.y="n"==s?d:p,o.getView().removePlaceholder(T)}else{if("w"==s){if(1>=h)return;r++,h--,t.$el.attr("data-x",r).data("x",r),t.$el.attr("data-w",h).data("w",h)}else if("e"==s){if(1>=h)return;h--,t.$el.attr("data-w",h).data("w",h)}else if("n"==s){if(1>=c)return;d++,c--,t.$el.attr("data-y",d).data("y",d),t.$el.attr("data-h",c).data("h",c)}else{if(1>=c)return;c--,t.$el.attr("data-h",c).data("h",c)}if("w"==s||"e"==s)for(var j=c;j--;)T.y=d+j,T.x="w"==s?r-1:u-1,o.trigger("vacantplace",T);else for(var j=h;j--;)T.x=r+j,T.y="n"==s?d-1:p-1,o.trigger("vacantplace",T)}y=!0,w._mouseStop(),t._initResizable()}},500),stop:function(){y&&(s.set({x:r,y:d,w:h,h:c}),o.setUserParams(s,["x","y","w","h"])),i.each(["width","height","left","top","position"],function(e){t.el.style[e]=""})}})},_getResizeDirections:function(){var e=[],t=this.model,i=this.module,n=this.$el.data("x"),s=this.$el.data("y"),o=this.$el.data("w"),a=this.$el.data("h"),l=n+o,r=s+a,d=i.getView().getRows(),h=i.getView().getCols(),c=t.get("resizable"),u=!1;if(a>1||s>0&&a<c.maxHeight){if(1==a)for(var p=0;s>p&&!u;++p)for(var g=this.module.getWidgetsParams({y:p}),m=g.length;m--;)if(p+g[m].h==s&&g[m].x<n+o&&g[m].x+g[m].w>n){u=!0;
break}u||e.push("n")}if(a>1||d>r&&a<c.maxHeight){if(u=!1,1==a)for(var g=this.module.getWidgetsParams({y:r}),m=g.length;m--;)if(g[m].x<n+o&&g[m].x+g[m].w>n){u=!0;break}u||e.push("s")}if(o>1||h>l&&o<c.maxWidth){if(u=!1,1==o)for(var g=this.module.getWidgetsParams({x:l}),m=g.length;m--;)if(g[m].y<s+a&&g[m].y+g[m].h>s){u=!0;break}u||e.push("e")}if(o>1||n>0&&o<c.maxWidth){if(u=!1,1==o)for(var p=0;n>p&&!u;++p)for(var g=this.module.getWidgetsParams({x:p}),m=g.length;m--;)if(p+g[m].w==n&&g[m].y<s+a&&g[m].y+g[m].h>s){u=!0;break}u||e.push("w")}return e}}),c={initGroupSelection:function(){if(this.settings.find("[name=groupName]").length){var t=this,i=this.settings.find("[name=groupName]"),n=this.settings.find("[name=groupId]"),s=i.closest(".form-search");i.length&&(i.autocomplete({minLength:2,appendTo:t.select,source:function(i,o){var a=c.getSelectedObjType.call(t),h=i.term,u={q:String(h)};if(null!==a){if(a==App.TYPE_MOBILE&&h in r[App.TYPE_MOBILE])return o(r[App.TYPE_MOBILE][h]),void 0;if(a==App.TYPE_STAT&&h in r[App.TYPE_STAT])return o(r[App.TYPE_STAT][h]),void 0;u.groupType=a}s.addClass("autocomplete-loading"),d=e.ajax({url:l,data:u,success:function(e,t,i){if(e.length){for(var s=[],l=0,c=e.length;c>l;l++)s[l]={id:e[l].id,label:e[l].name,value:e[l].name};a!=App.TYPE_STAT?r[App.TYPE_MOBILE][h]=s:r[App.TYPE_STAT][h]=s,i===d&&o(s),s.length||n.val(0)}},complete:function(){s.removeClass("autocomplete-loading")}})},select:function(e,t){var i=Number(t.item.id);n.val(i),s.addClass("active")}}).data("ui-autocomplete")._renderItem=function(t,i){return e("<li>").append("<a>"+i.label+"</a>").appendTo(t)}),i.length&&(i.val()&&s.addClass("active"),i.on("reset",function(){s.removeClass("active"),i.val(""),n.val(0)})),s.find(".icon-clear").on("click",function(){i.trigger("reset")})}},initObjTypeSelection:function(){if(this.settings.find("[name=objType]").length){var e=this;this.settings.on("change","input[name=objType]",function(){e.settings.find("[name=groupName]").trigger("reset")})}},getSelectedObjType:function(){var e=this.settings.find("[name=objType]:checked"),t=null;return e.length?(t=e.val(),t=""===t?null:Number(t)):null},initDraggable:function(){this.$el.draggable({})}};return h}),define("text!dashboard/objst/tmpl/content.html",[],function(){return"<h4><%= 'undefined' != typeof subTitle ? subTitle : '' %></h4>\n\n<p class=\"empty-msg\"><%= i18n.noObjects %></p>\n\n<div class=\"metric total\"><%= 'undefined' != typeof total ? total : '' %></div>\n\n<div class=\"rag-cont\">\n    <div class=\"d-chart rag-chart\"></div>\n</div>\n"}),define("text!dashboard/tmpl/objType.html",[],function(){return'<% if(App.hasModule(\'mobile\') && App.hasModule(\'stat\')) {%>\n<label><%= i18n.objType %></label>\n<div class="switch-toggle switch-objtype<% if(allowAll) {%> switch-3<% } %>" onclick="">\n    <% if(allowAll) {%>\n    <input id="radio-all-objects-<%= id %>" name="objType" type="radio"\n           value=""<% if(\'undefined\' == typeof objType || objType === null) {%> checked<% } %>>\n    <label title="<%= i18n.all.ucFirst() %>" class="all" for="radio-all-objects-<%= id %>" onclick="">\n        <svg class="svg-icon icon-car">\n            <use xlink:href="#smb-car"></use>\n        </svg>\n        <svg class="svg-icon icon-home">\n            <use xlink:href="#smb-home"></use>\n        </svg>\n    </label>\n    <% } %>\n\n    <input id="radio-mobile-objects-<%= id %>" name="objType" type="radio" value="<%= App.TYPE_MOBILE %>"\n           <% if(( !allowAll && ( \'undefined\' == typeof objType || objType === null ) ) || objType === App.TYPE_MOBILE) {%> checked<% } %>>\n    <label title="<%= i18n.vehicles %>" for="radio-mobile-objects-<%= id %>" onclick="">\n        <svg class="svg-icon icon-car">\n            <use xlink:href="#smb-car"></use>\n        </svg>\n    </label>\n\n    <input id="radio-stat-objects-<%= id %>" name="objType" type="radio"\n           value="<%= App.TYPE_STAT %>"<% if(objType === App.TYPE_STAT) {%> checked<% } %>>\n    <label title="<%= i18n.stationary %>" for="radio-stat-objects-<%= id %>" onclick="">\n        <svg class="svg-icon icon-home">\n            <use xlink:href="#smb-home"></use>\n        </svg>\n    </label>\n    <a class="btn btn-primary"></a>\n</div>\n\n<% } else if(App.hasModule(\'mobile\')) {%>\n    <input name="objType" type="hidden" value="<%= App.TYPE_MOBILE %>">\n<% } else if(App.hasModule(\'stat\')) {%>\n    <input name="objType" type="hidden" value="<%= App.TYPE_STAT %>">\n<% } %>'}),define("dashboard/objst/views/ObjectsStateView",["jquery","underscore","_libs/charts/Chart","dashboard/views/DashboardWidgetView","text!dashboard/objst/tmpl/content.html","text!dashboard/tmpl/objType.html"],function(e,t,i,n,s,o){var a=".rag-bars-bar, .rag-figs-fig, .rag-txts-txt";s=t.template(s),o=t.template(o);var l=n.extend({constructor:function(){this.total=null,this.rag=null,n.apply(this,arguments)},initialize:function(){this.$el.addClass("d-state"),n.prototype.initialize.apply(this,arguments)},render:function(){var e=this.model,t=e.getTexts();r.bindEvents.call(this),n.prototype.render.call(this,{content:s({i18n:t,subTitle:e.getSubTitle()}),settings:this.renderSettings()}),this.content.addClass("selectable"),this.total=this.$el.find(".total"),this.rag=this.$el.find(".rag-chart")},renderSettings:function(){var e=this.model,t=e.getTexts(),i=e.get("options")||{},s=o({id:e.id,objType:i.objType,allowAll:!1,i18n:t});return s+=n.prototype.renderSettings.call(this)},update:function(){var e=this.model,t=e.get("total");if(t){-1!=this.el.className.indexOf("empty")&&this.$el.removeClass("empty"),this.total.text(t);var i=e.getTexts(),n=e.get("options");n.objType==App.TYPE_MOBILE?r.updateMobile.call(this):r.updateStat.call(this),this.$el.find(a).attr("title",i.showOnMap)}else this.$el.addClass("empty")}}),r={bindEvents:function(){var e=this;this.listenTo(this.model,"update",function(){this.model.has("total")&&e.update()}),this.$el.on("click",a,function(){var t="offline";-1!=this.className.indexOf("green")?t="online":-1!=this.className.indexOf("yellow")&&(t="gsmOnline"),e.module.trigger("showobjects",e.model.get(t))})},updateMobile:function(){var e=this.model,i=e.getTexts(),n=e.get("total"),s={online:e.get("online").length,gsmOnline:e.get("gsmOnline").length,offline:e.get("offline").length},o=[Math.round(100*s.online/n),Math.round(100*s.gsmOnline/n),Math.round(100*s.offline/n)],a=["("+s.online+") "+i.objectOnline,"("+s.gsmOnline+") "+i.objectGSMOnline,"("+s.offline+") "+i.objectOffline],l={postfix:"%",rga:["green","yellow","grey"]},r=0;t.each(["online","gsmOnline","offline"],function(e){(s[e]&&!o[r]||s[e]!=n&&100==o[r])&&(o[r]=Math._round(100*s[e]/n,1)),++r}),new RagChart(this.rag,o,a,l)},updateStat:function(){var e=this.model,i=e.get("total"),n=e.getTexts(),s={online:e.get("online").length,offline:e.get("offline").length},o=[Math.round(100*s.online/i),Math.round(100*s.offline/i)],a=["("+s.online+") "+n.objectOnline,"("+s.offline+") "+n.objectOffline],l={postfix:"%",rgaLength:2,rga:["green","grey"]},r=0;t.each(["online","offline"],function(e){(s[e]&&!o[r]||s[e]!=i&&100==o[r])&&(o[r]=Math._round(100*s[e]/i,1)),++r}),new RagChart(this.rag,o,a,l)}};return l}),define("dashboard/objst/ObjectsStateWidget",["underscore","jquery","dashboard/DashboardWidget","dashboard/objst/views/ObjectsStateView"],function(e,t,i,n){var s=i.extend({constructor:function(){i.apply(this,arguments)},defaults:{objType:"mobile",group:null,total:null,online:null,gsmOnline:null,offline:null,options:{objType:App.TYPE_MOBILE}},initialize:function(){var e=this,t=this.get("options");this.set("title",this.getTexts().objectsState),App.hasMobile()||t.objType!==App.TYPE_MOBILE&&null!==t.objType||(this.set("objType","stat"),t.objType=App.TYPE_STAT,"groupId"in t&&delete t.groupId),i.prototype.initialize.call(this,n),this.on("change:options",function(){e.set("subTitle",e.getSubTitle())}).on("change:group",function(){e.set("subTitle",e.getSubTitle())})}});return s}),define("text!dashboard/objrev/tmpl/content.html",[],function(){return"<h4><%= 'undefined' != typeof subTitle ? subTitle : '' %></h4>\n\n<p class=\"empty-msg\"><%= i18n.noObjects %></p>\n\n<div class=\"d-funnel-cont d-chart\"></div>"}),define("dashboard/objrev/views/ObjectsRevView",["jquery","underscore","_libs/charts/Chart","dashboard/views/DashboardWidgetView","text!dashboard/objrev/tmpl/content.html","text!dashboard/tmpl/objType.html"],function(e,t,i,n,s,o){s=t.template(s),o=t.template(o);var a=n.extend({constructor:function(){this.funnel=null,this.sorted=[],n.apply(this,arguments)},initialize:function(){this.$el.addClass("d-rev d-funnel"),n.prototype.initialize.apply(this,arguments)},render:function(){var e=this.model,t=e.getTexts();l.bindEvents.call(this),n.prototype.render.call(this,{content:s({i18n:t,subTitle:e.getSubTitle()}),settings:this.renderSettings()}),this.content.addClass("selectable"),this.funnel=this.$el.find(".d-funnel-cont")},renderSettings:function(){var e=this.model,t=e.getTexts(),i=e.get("options")||{},s=o({id:e.id,objType:i.objType,allowAll:!0,i18n:t});return s+=n.prototype.renderSettings.call(this)},update:function(){var e=this.model,i=e.get("total");if(i){-1!=this.el.className.indexOf("empty")&&this.$el.removeClass("empty"),this.sorted=t.sortBy(e.get("devices"),function(e){return e.nb.length}).reverse();for(var n=this.sorted.length,s=new Array(n),o=new Array(n);n--;)s[n]=this.sorted[n].name,o[n]=this.sorted[n].nb.length;new FunnelChart(this.funnel,o,s,{barOpacity:!0})}else this.$el.addClass("empty"),this.funnel.empty()}}),l={bindEvents:function(){var t=this;this.listenTo(this.model,"update",function(){this.model.has("total")&&t.update()}).listenTo(this.model,"remove",function(){t.sorted=[]}),this.$el.on("click","li",function(){if(t.model.has("devices")){var i,n=e(this).index();"undefined"!=typeof t.sorted[n]&&(i=t.sorted[n].nb,i.length&&t.module.trigger("showobjects",i))}})}};return a}),define("dashboard/objrev/ObjectsRevWidget",["underscore","jquery","dashboard/DashboardWidget","dashboard/objrev/views/ObjectsRevView"],function(e,t,i,n){var s=i.extend({constructor:function(){i.apply(this,arguments)},defaults:{objType:"all",group:null,total:null,devices:null},initialize:function(){var e=this;this.set("title",this.getTexts().objTypes),i.prototype.initialize.call(this,n),this.on("change:options",function(){e.set("subTitle",e.getSubTitle())}).on("change:group",function(){e.set("subTitle",e.getSubTitle())})}});return s}),define("text!dashboard/objuni/tmpl/typeSelect.html",[],function(){return'<label><%= i18n.objects.ucFirst() %></label>\n<select name="show">\n    <% _.each(types, function(name, key){ %>\n    <option value="<%= key %>"<% if(key == selected){ %> selected<% } %>><%= name %></option>\n    <% }) %>\n</select>\n\n'}),define("text!dashboard/objuni/tmpl/connections.html",[],function(){return'<div class="connections">\n    <label class="checkbox"><input type="checkbox" name="gsmChecked" value="1"\n        <% if(gsmChecked) {%> checked<% } %>>\n        <%= ( show == \'notinorder\' ? i18n.noGsmSignalTime : i18n.gsmInOrderTime ) %>\n        (<small><%= i18n.vehicles %></small>)\n    </label>\n\n    <div class="objst-damage" style="margin-bottom:3px">\n        <label class="objst-damage-field"><input type="text" name="gsm_days"\n            value="<%= gsm_days %>" maxlength="2" autocomplete="off" /> <%= i18n.DateTime.labelsCompact1[7] %></label>\n        <label class="objst-damage-field"><input type="text" name="gsm_hours"\n            value="<%= gsm_hours %>" maxlength="2" autocomplete="off" /> <%= i18n.DateTime.labelsCompact1[4] %></label>\n        <label class="objst-damage-field"><input type="text" name="gsm_minutes"\n            value="<%= gsm_minutes %>" maxlength="2" autocomplete="off" /> <%= i18n.DateTime.labelsCompact1[5] %></label>\n    </div>\n\n    <label class="checkbox"><input type="checkbox" name="gpsChecked" value="1"\n        <% if(gpsChecked) {%> checked<% } %>>\n        <%= ( show == \'notinorder\' ? i18n.noGpsSignalTime : i18n.gpsInOrderTime ) %>\n        (<small><%= i18n.vehicles %></small>)\n    </label>\n\n    <div class="objst-damage">\n        <label class="objst-damage-field"><input type="text" name="gps_days"\n            value="<%= gps_days %>" maxlength="2" autocomplete="off" /> <%= i18n.DateTime.labelsCompact1[7] %></label>\n        <label class="objst-damage-field"><input type="text" name="gps_hours"\n            value="<%= gps_hours %>" maxlength="2" autocomplete="off" /> <%= i18n.DateTime.labelsCompact1[4] %></label>\n        <label class="objst-damage-field"><input type="text" name="gps_minutes"\n            value="<%= gps_minutes %>" maxlength="2" autocomplete="off" /> <%= i18n.DateTime.labelsCompact1[5] %></label>\n    </div>\n</div>'}),define("text!dashboard/objuni/tmpl/areas.html",[],function(){return'<div class="areas">\n    <label><%= i18n.objAreas %></label>\n    <input type="text" name="areas" value="<%= areas %>" placeholder="<%= i18n.allObjAreas %>" autocomplete="off">\n</div>'}),define("text!dashboard/objuni/tmpl/content.html",[],function(){return'<h4 class="selectable"><%= \'undefined\' != typeof subTitle ? subTitle : \'\' %></h4>\n\n<p class="empty-msg"><%= i18n.noObjects %></p>\n\n<div class="chart" title="<%= i18n.showOnMap %>"></div>\n<div class="metrics-cont" title="<%= i18n.showOnMap %>">\n    <div class="metrics">\n        <span class="metric percent"></span>\n        <span class="metric-small percent-sign">%</span>\n        <div class="metric-small value"></div>\n    </div>\n</div>'}),define("dashboard/objuni/views/ObjectsUniView",["jquery","underscore","EasyPieChart","dashboard/views/DashboardWidgetView","text!dashboard/tmpl/objType.html","text!../tmpl/typeSelect.html","text!../tmpl/connections.html","text!../tmpl/areas.html","text!../tmpl/content.html"],function(e,t,i,n,s,o,a,l,r){s=t.template(s),o=t.template(o),a=t.template(a),l=t.template(l),r=t.template(r);var d={barColor:"#f2f2f2",trackColor:"#4f4f4f",scaleColor:!1,animate:!1,lineWidth:15,lineCap:"butt",size:100},h=n.extend({constructor:function(){this._percent=null,this._value=null,this._pieCont=null,n.apply(this,arguments)},initialize:function(){this.$el.addClass("d-uni d-svp"),n.prototype.initialize.apply(this,arguments)},render:function(){var e=this.model,t=e.getTexts();c.bindEvents.call(this),n.prototype.render.call(this,{content:r({subTitle:e.getSubTitle(),i18n:t}),settings:this.renderSettings()}),this._percent=this.$el.find(".percent"),this._value=this.$el.find(".value"),this._pieCont=this.$el.find(".chart"),this.model.has("total")&&this.update()},update:function(){var e=this.model,t=e.get("total");if(t){-1!=this.el.className.indexOf("empty")&&this.$el.removeClass("empty");var i=e.get("nb").length,n=Math.round(100*i/t);(i&&!n||i!=t&&100==n)&&(n=Math._round(100*i/t,1)),this._percent.text(n),this._value.text(i+" "+this.model.getTexts().from+" "+t),this._pieCont.attr("data-percent",n),c.buildPie.call(this)}else this.$el.addClass("empty")},renderSettings:function(){var e=this.model.get("options")||{},t=o({types:this.model.getPossibleKeys(),selected:e.show,i18n:this.model.getTexts()});return t+=s({id:this.model.id,objType:e.objType,allowAll:!0,i18n:this.model.getTexts()}),e.show.indexOf("inorder")>=0&&e.objType===App.TYPE_MOBILE&&(t+=c.renderConnections.call(this)),t+=n.prototype.renderSettings.call(this),e.show.indexOf("guarded")>=0&&(t+=c.renderAreas.call(this)),t},_initSettings:function(){var t=this.$el.find("select"),i=this,n=this.model.get("options"),s=n.objType,o=i.settings.find(".switch-objtype");c.setPossibleObjType.call(i,n.show),n.show.indexOf("served")>=0&&i.settings.find("input[name=served]").parent().addClass("hidden"),n.show.indexOf("guarded")>=0&&c.initAreas.call(this),t.on("change",function(){var n=i.settings.find(".connections"),a=i.settings.find("input[name=served]").parent(),l=e(this).val();if(a.removeClass("hidden"),-1===l.indexOf("inorder"))n.remove(),l.indexOf("served")>=0&&a.addClass("hidden");else if(s===App.TYPE_MOBILE){var r=c.renderConnections.call(i,l);n.length?n.replaceWith(r):o.length?o.after(r):t.after(r)}o.length&&c.setPossibleObjType.call(i,l,!0);var d=i.settings.find(".areas");l.indexOf("guarded")>=0?d.length||(i.settings.find(".form-content").append(c.renderAreas.call(i)),c.initAreas.call(i)):d.remove()}),this.settings.on("change","input[name=objType]",function(){var e=t.val();-1!=e.indexOf("inorder")&&(this.value==App.TYPE_STAT&&s!=App.TYPE_STAT?i.settings.find(".connections").remove():this.value!=App.TYPE_STAT&&s==App.TYPE_STAT&&o.after(c.renderConnections.call(i,e))),s=this.value})},_onSettingsSubmit:function(e){var i=n.prototype._onSettingsSubmit.call(this,e,!0);if(i.show.indexOf("inorder")>=0&&i.objType===App.TYPE_MOBILE){if(!e.gpsChecked&&!e.gsmChecked){var s=this.model.getTexts();return alert(s.errSelectMinutes,s.error),i}if(e.gsmChecked){var o=24*60*e.gsm_days+60*e.gsm_hours+e.gsm_minutes;i.noGsmMinutes=10>o?10:o,i.gsmChecked=!0}else delete i.noGsmMinutes,i.gsmChecked=!1;if(e.gpsChecked){var a=24*60*e.gps_days+60*e.gps_hours+e.gps_minutes;i.noGpsMinutes=10>a?10:a,i.gpsChecked=!0}else delete i.noGpsMinutes,i.gpsChecked=!1}if(i.show.indexOf("guarded")>=0&&"areas"in i){var l=String(i.areas).trim();if(l.length){var r,d,h=[];t.each(l.split(/\s*[\,;]\s*/),function(e){r=e.trim(),/^[0-9]+$/g.test(r)&&(d=Number(r),d>0&&h.push(d))}),h.length?i.areas=t.unique(h):delete i.areas}else delete i.areas}return this._updateOptions(i),i}}),c={bindEvents:function(){var t=this;this.listenTo(this.model,"update",function(){this.model.has("total")&&t.update()}).listenTo(this.model,"remove",function(){e(window).off("resize.duni"+this.model.id)}),this.$el.on("click",".content",function(){var e=t.model.get("nb");e.length&&t.module.trigger("showobjects",e)}),e(window).on("resize.duni"+this.model.id,function(){c.buildPie.call(t)})},buildPie:function(){var n=t.clone(d),s=this.$el.width(),o=e(window).width();n.size=768>o?100:1024>o?.6*s:.75*s,this._pieCont.find("canvas").remove(),this._pie=new i(this._pieCont[0],n)},renderConnections:function(e){var t=this.model.getTexts(),i=this.model.get("options"),n="undefined"==typeof i.gpsChecked||i.gpsChecked,s="undefined"==typeof i.gsmChecked||i.gsmChecked,o=i.noGsmMinutes||30,l=i.noGpsMinutes||30,r=o,d="undefined"!=typeof i.gsm_days?i.gsm_days:Math.floor(r/1440),h="undefined"!=typeof i.gsm_hours?i.gsm_hours:Math.floor((r-1440*d)/60),c="undefined"!=typeof i.gsm_minutes?i.gsm_minutes:r-1440*d-60*h,r=l,u="undefined"!=typeof i.gps_days?i.gps_days:Math.floor(r/1440),p="undefined"!=typeof i.gps_hours?i.gps_hours:Math.floor((r-1440*u)/60),g="undefined"!=typeof i.gps_minutes?i.gps_minutes:r-1440*u-60*p;return a({i18n:t,gpsChecked:n,gsmChecked:s,gps_days:u,gps_hours:p,gps_minutes:g,gsm_days:d,gsm_hours:h,gsm_minutes:c,show:e||i.show})},renderAreas:function(){var e=this.model.getTexts(),i=this.model.get("options"),n="areas"in i?i.areas:[];return l({i18n:e,areas:t.isArray(n)?n.join(","):""})},initAreas:function(){var e=this.settings.find(".areas input");e.on("input",function(){var e=this.value.trim();this.value=e.replace(/[^0-9,]/g,"")})},setPossibleObjType:function(e,t){var i=this.settings.find("input[name=objType]");e.indexOf("moving")>=0||e.indexOf("power")>=0?i.prop("disabled",!0).filter("[value="+App.TYPE_MOBILE+"]").prop("disabled",!1).prop("checked",!0):e.indexOf("guarded")>=0?i.prop("disabled",!0).filter("[value="+App.TYPE_STAT+"]").prop("disabled",!1).prop("checked",!0):(i.prop("disabled",!1),t=!1),t&&this.settings.find("[name=groupName]").trigger("reset")}};return h}),define("dashboard/objuni/ObjectsUniWidget",["underscore","jquery","dashboard/DashboardWidget","dashboard/objuni/views/ObjectsUniView"],function(e,t,i,n){var s=i.extend({constructor:function(){i.apply(this,arguments)},defaults:{objType:App.hasModule("mobile")?"mobile":"stat",group:null,total:null,nb:null,options:{show:App.hasModule("mobile")?"moving":"inorder",objType:App.hasModule("mobile")?App.TYPE_MOBILE:App.TYPE_STAT}},initialize:function(){var e=this;this.set("title",this.getTitle()),i.prototype.initialize.call(this,n);var t=this.get("options");-1==t.show.indexOf("inorder")||t.noGsmMinutes||t.noGpsMinutes||(t.noGsmMinutes=t.noGpsMinutes=this.getDefaultInOrderMinutes(),t.gsm_days=t.gps_days=0,t.gsm_hours=t.gps_hours=t.noGsmMinutes/60,t.gsm_minutes=t.gsm_minutes=0),-1==t.show.indexOf("moving")&&-1==t.show.indexOf("power")&&App.hasModule("stat")?-1==t.show.indexOf("guarded")&&App.hasModule("mobile")||(this.set("objType","stat"),t.objType=App.TYPE_STAT):(this.set("objType","mobile"),t.objType=App.TYPE_MOBILE),this.on("change:options",function(){e.set("title",e.getTitle()),e.set("subTitle",e.getSubTitle())}).on("change:group",function(){e.set("subTitle",e.getSubTitle())})},getPossibleKeys:function(){var t=this.getTexts(),i={};return App.hasModule("mobile")&&e.extend(i,{moving:t.objectsMoving,notmoving:t.objectsNotMoving,nopower:t.objectsWithNoPower}),e.extend(i,{inorder:t.objectsInOrder,notinorder:t.objectsNotInOrder,served:t.beingServed1,notserved:t.notBeingServed}),App.hasModule("stat")&&e.extend(i,{guarded:t.guarded,guardedpartly:t.guardedPartly,notguarded:t.notGuardedMulti}),i},getTitle:function(){var e=this.get("options").show;return this.getPossibleKeys()[e]},getSubTitle:function(){return this.has("group")||this.get("options").served?i.prototype.getSubTitle.call(this):"&nbsp;"},getDefaultInOrderMinutes:function(){return 1440},getDataKey:function(){return this.get("options").show},getDataOptions:function(){var t=i.prototype.getDataOptions.call(this);return-1==this.getDataKey().indexOf("inorder")?("undefined"!=typeof t.noGsmMinutes&&delete t.noGsmMinutes,"undefined"!=typeof t.noGpsMinutes&&delete t.noGpsMinutes):e.each(["gsmChecked","gpsChecked","gsm_days","gsm_hours","gsm_minutes","gps_days","gps_hours","gps_minutes"],function(e){"undefined"!=typeof t[e]&&delete t[e]}),t}});return s}),define("text!dashboard/mobjmap/tmpl/content.html",[],function(){return'<div class="map"></div>\n<div class="no-object hidden"><%= i18n.noObjectWithCoords %></div>'}),define("text!dashboard/mobjmap/tmpl/settings.html",[],function(){return'<input type="hidden" name="objectId" value="<%= \'undefined\' != typeof obj && obj ? obj.id : \'\' %>" >\n<label><%= i18n.object.ucFirst() %></label>\n<div class="form-search">\n    <input type="text" name="objectName" value="<%= \'undefined\' != typeof obj && obj ? obj.name : \'\' %>">\n    <i class="icon-clear svg-icon svg-icon-circle-remove"></i>\n    <i class="icon-spin svg-icon svg-icon-spinner"></i>\n</div>\n\n<label><%= i18n.trackLength %> (<%= minTrackLength + \' - \' + maxTrackLength %>)</label>\n<input type="text" name="trackLength" value="<%= trackLength %>" class="input-mini integer" autocomplete="off"> <%= i18n.m %>\n\n<label><%= i18n.updateDist %> (<%= minUpdateDist + \' - \' + maxUpdateDist %>)</label>\n<input type="text" name="updateDist" value="<%= updateDist %>" class="input-mini integer" autocomplete="off"> <%= i18n.m %>\n'}),define("dashboard/mobjmap/views/MobileObjectMapView",["jquery","underscore","geo","maps/MapsModule","dashboard/views/DashboardWidgetView","text!dashboard/mobjmap/tmpl/content.html","text!dashboard/mobjmap/tmpl/settings.html"],function(e,t,i,n,s,o,a){o=t.template(o),a=t.template(a);var l=100,r=5e5,d=10,h=1e4,c=1e4,u=App.getBaseUrl()+"objects/obj-search/",p={},g=null,m=s.extend({constructor:function(){this._objView=null,this._objLayer=null,this._noObject=null,this._autozoomTimeout=null,s.apply(this,arguments)},initialize:function(){this.$el.addClass("d-map"),s.prototype.initialize.apply(this,arguments)},render:function(){var e=this,t=this.model,i=t.getTexts();t.get("options"),f.bindEvents.call(this),s.prototype.render.call(this,{content:o({i18n:i}),settings:!0}),this._noObject=this.$el.find(".no-object"),this.$el.on("click",".settings-toggle",function(){f.initObjectSelection.call(e)}),t.has("obj")&&(this.$el.removeClass("loading"),f.initMap.call(this))},renderSettings:function(){var e=this.model,t=e.getTexts(),i=e.get("options");return a({obj:e.get("obj").attributes,trackLength:i.trackLength,maxTrackLength:r,minTrackLength:l,updateDist:i.updateDist,maxUpdateDist:h,minUpdateDist:d,i18n:t})},_initSettings:function(){var t=this;this.settings.find(".integer").numeric({decimal:!1,negative:!1}),this.settings.off("submit").on("submit",function(){var i=t.settings.serializeObject();return t.settings.find("input.error").removeClass("error"),t.settings.find("p.error").remove(),!i.objectId&&"undefined"!=typeof i.objectName&&e.trim(i.objectName).length>2?(showCursor(),e.ajax({url:u,data:{q:String(i.objectName),objType:App.TYPE_MOBILE},success:function(e){i.objectId=e.length?e[0].id:0,t._onSettingsSubmit(i)},error:function(){i.objectId=0,t._onSettingsSubmit(i)},complete:hideCursor})):t._onSettingsSubmit(i),!1})},_validateSettings:function(e){var t=[],i=this.model.getTexts();if(e.objectId||t.push({key:"objectName",msg:i.errSelectObject}),e.trackLength){var n=Number(e.trackLength);(n>r||l>n)&&t.push({key:"trackLength",msg:i.errValueBetween.replace("#min#",l).replace("#max#",r)})}else t.push({key:"trackLength",msg:i.errEnterTrackLength});if(e.updateDist){var s=Number(e.updateDist);(s>h||d>s)&&t.push({key:"updateDist",msg:i.errValueBetween.replace("#min#",d).replace("#max#",h)})}else t.push({key:"updateDist",msg:i.errEnterUpdateDist});return t.length?t:null},_onSettingsSubmit:function(e){var i;if(i=this._validateSettings.call(this,e))return this._showErrors(i);var n=t.clone(this.model.get("options"))||{};return t.extend(n,e),JSON.stringify(this.model.getDataOptions())==JSON.stringify(n)?n:("undefined"!=typeof e.objectName&&delete e.objectName,this._updateOptions(n),n)}}),f={bindEvents:function(){var t=this;this.listenTo(this.model,"change:obj",function(e,i){var n=e.previous("obj");n?(t.stopListening(n),t._objView&&t._objLayer.removeLayer(t._objView),t._objView=null,null===i?(t.$el.addClass("loading"),t.model.getMapsModule().destroy(),t.stopListening(App,"objectsTitleChange")):(t.$el.removeClass("loading"),f.onMapReady.call(t))):(t.$el.removeClass("loading"),f.initMap.call(t))}).listenTo(this.model,"remove",function(){e(window).off("resizestop.dmap"+t.model.id),t.$el.off("click",".leaflet-control-pan>div"),t._autozoomTimeout&&clearTimeout(t._autozoomTimeout),App.unsubscribe(t),t._objView=null,t._objLayer=null}).listenTo(this.model,"change:options",function(e,i){var n=e.previous("options");n.trackLength!=i.trackLength&&f.showTrack.call(t),n.objectId&&n.objectId!=i.objectId&&(t.stopListening(e.get("obj")),t._objView&&t._objLayer.removeLayer(t._objView),t.$el.addClass("loading"))}),e(window).on("resizestop.dmap"+this.model.id,function(){t.model.getMapsModule()&&t.model.getMapsModule().trigger("layoutchange"),f.setAutozoomTimeout.call(t)})},initMap:function(){var e=new n({id:this.module.id+"/"+this.model.id+"/maps",container:this.$el.find(".map"),parent:this.model,compass:!1,print:!1,ruler:!1,search:!1,traffic:!0,coords:!1,scale:!0,minimap:!1,layersControl:!0,autozoom:!1});this.model.setMapsModule(e),App.subscribe(e.getEventsPrefix()+".ready",{callback:f.onMapReady,context:this})},onMapReady:function(){var e=this.model.get("obj");if(f.addItemToMap.call(this),this._objView){var t=this,i=this.model.getMapsModule(),n=i.getWidget().getMap();n.on("dragend",function(){f.setAutozoomTimeout.call(t)}).on("zoomend",function(){f.setAutozoomTimeout.call(t)}),this.$el.on("mouseup",".leaflet-control-pan>div",function(){f.setAutozoomTimeout.call(t)}),this._objLayer=i.addLayersGroup({layers:[this._objView],groupCssClass:"mobile-arrows",clusters:!1}),f.onCourseChange.call(this,e.get("course")),this._objView.trigger("zoomchange",{center:[e.get("lat"),e.get("lon")],zoom:15,cluster:null})}var s=this.$el.find(".leaflet-control-map-select"),o=this.$el.find(".maps-module"),a=s.find(".dropdown-menu");s.on("close.dropdown",function(){a.appendTo(s)}).on("open.dropdown",function(){a.appendTo(o)})},addItemToMap:function(){var e=this,t=this.model.get("obj");t.has("lat")&&t.has("lon")?f.buildObjView.call(this):this._noObject.removeClass("hidden"),f.bindObjChanges.call(this),this.listenTo(App,"objectsTitleChange",function(){e._objView&&e._objView.trigger("settitle",{title:App.buildObjTitle(t)})}),this._objView&&f.showTrack.call(this)},buildObjView:function(){var e=this.model.get("obj"),t=" "+e.get("status")+" "+e.get("hwStatus");this._noObject.addClass("hidden"),e.get("speed")<e.get("minSpeed")&&(t+=" park"),1==e.get("trackedSensorState")&&(t+=" obj-alert"),e.get("hasAlarm")&&(t+=" alarm"),e.get("restricted")&&(t+=" restricted"),this._objView=this.model.getMapsModule().getWidget().buildComplexMarker({lat:e.get("lat"),lon:e.get("lon"),html:'<i class="i"></i><span class="name">'+App.buildObjTitle(e)+"</span>",className:"complex-icon obj obj-mobile"+t,dataId:e.id,animated:!1,model:e})},bindObjChanges:function(){var e=this,t=this.model,n=t.get("obj");this.listenTo(n,"change:name",function(t,i){e._objView&&e._objView.trigger("settitle",{title:i})}).listenTo(n,"change:coords",function(){var s=n.previous("lat"),o=n.previous("lon"),a=n.get("lat"),l=n.get("lon");if(!s||!o){if(!a||!l)return;f.buildObjView.call(e)}if(e._objView){f.placeOnMap.call(e);var r=i.getDistanceBetweenPoints(s,o,a,l);r>t.get("options").updateDist&&f.showTrack.call(e)}}).listenTo(n,"change:course",function(t,i){e._objView&&n.get("speed")>=n.get("minSpeed")&&f.onCourseChange.call(e,i)}).listenTo(n,"change:speed",function(t,i){if(e._objView){var s=n.previous("speed"),o=n.get("minSpeed"),a=i>=o&&o>s;(a||s>=o&&o>i)&&e._objView.trigger("toggleclass",{name:"park"}),a&&f.onCourseChange.call(e,n.get("course"))}}).listenTo(n,"change:status",function(t,i){var s=n.previous("status");e._objView&&e._objView.trigger("toggleclass",{name:s+" "+i})}).listenTo(n,"change:hwStatus",function(t,i){if(e._objView){var s=n.previous("hwStatus");e._objView.trigger("toggleclass",{name:s+" "+i})}}).listenTo(n,"change:restricted",function(){e._objView&&e._objView.trigger("toggleclass",{name:"restricted"})}).listenTo(n,"change:trackedSensorState",function(){e._objView&&e._objView.trigger("toggleclass",{name:"alert"})})},placeOnMap:function(){if(this._objView){var e=this.model.get("obj"),t={model:e,to:{lat:e.get("lat"),lon:e.get("lon")},animate:!1};this._objView.trigger("place",t),!this._autozoomTimeout&&this._objView.trigger("follow",{center:[e.get("lat"),e.get("lon")],cluster:null})}},onCourseChange:function(e){this._objView&&this._objView.trigger("rotate",{angle:e})},setAutozoomTimeout:function(){var e=this;this._autozoomTimeout&&clearTimeout(this._autozoomTimeout),this._autozoomTimeout=setTimeout(function(){var t=e.model.get("obj");e._objView&&t&&(e._objView.trigger("follow",{center:[t.get("lat"),t.get("lon")],cluster:null}),e._autozoomTimeout=null)},c)},initObjectSelection:function(){var t=this,i=this.settings.find("[name=objectName]"),n=this.settings.find("[name=objectId]"),s=i.closest(".form-search");i.autocomplete({minLength:2,appendTo:t.select,source:function(t,i){var o=t.term;return o in p?(i(p[o]),void 0):(s.addClass("autocomplete-loading"),g=e.ajax({url:u,data:{q:String(t.term),objType:App.TYPE_MOBILE},success:function(e,t,s){if(e.length){for(var a=[],l="",r=0,d=e.length;d>r;r++)l=e[r].name+" (#"+e[r].extId+")",a[r]={id:e[r].id,label:l,value:l};p[o]=a,s===g&&i(a),a.length||n.val(0)}},complete:function(){s.removeClass("autocomplete-loading")}}),void 0)},select:function(e,t){var i=Number(t.item.id);n.val(i),s.addClass("active")}}).data("ui-autocomplete")._renderItem=function(t,i){return e("<li>").append("<a>"+i.label+"</a>").appendTo(t)},i.val()&&s.addClass("active"),s.find(".icon-clear").on("click",function(){s.removeClass("active"),i.val("").focus(),n.val(0)})},showTrack:function(){var e=this.model.get("obj"),t=e.id,i=this.model.get("options");this.model.trigger("buildtrack",[e],{id:t,last:!0,zoom:!1,name:e.get("name")+" [#"+e.get("extId")+"]",data:{objectId:[t],nMetres:i.trackLength,tz:App.getUserTimezone()}})}};return m}),define("dashboard/mobjmap/MobileObjectMapWidget",["underscore","jquery","_common/mobile/MobileObject","_common/tracks/TracksModule","dashboard/DashboardWidget","dashboard/mobjmap/views/MobileObjectMapView"],function(e,t,i,n,s,o){var a=s.extend({constructor:function(){this._mapsModule=null,this._tracksModule=null,s.apply(this,arguments)
},defaults:{obj:null,resizable:{maxWidth:2,maxHeight:2},options:{trackLength:500,updateDist:100}},initialize:function(){this.set("title",this.getTexts().objectOnMap),s.prototype.initialize.call(this,o);var t=this;this.on("buildtrack",function(){l.clearTrack.call(t)}),this._tracksModule=new n({id:this.get("parent").id+"/"+this.id+"/tracks",container:!1,parent:this,options:{list:!1}}),this.listenTo(this._tracksModule,"trackerror",function(i){401==i.status&&(t.set("options",e.extend({},t.get("options"),{objectId:null,objectName:null})),t.get("parent").trigger("optionschange",t))}),this.on("change:obj",function(){l.clearTrack.call(t)}).on("remove",function(){t._mapsModule&&t._mapsModule.destroy()&&(t._mapsModule=null),l.clearTrack.call(t)})},set:function(t,n){if("object"==typeof t){var o=e.keys(t);1==o.length&&"obj"==o[0]&&(n=t.obj,t="obj")}"obj"===t?null!==n&&n.id?this.has("obj")?this.attributes.obj.id!=n.id?(this._previousAttributes.obj=this.attributes.obj,this.attributes.obj=new i(n,{parse:!0}),this.trigger("change:obj",this,this.attributes.obj)):(n=i.prototype.parse(n),this.attributes.obj.set(n)):(this.attributes.obj=new i(n,{parse:!0}),this._previousAttributes.obj=null,this.trigger("change:obj",this,this.attributes.obj)):(l.destroyObject.call(this),this.trigger("change:obj",this,null)):s.prototype.set.apply(this,arguments)},setMapsModule:function(e){this._mapsModule=e,this._tracksModule.setMaps(e)},getMapsModule:function(){return this._mapsModule},getDataOptions:function(){var e,t=null;return(e=this.get("options"))&&(t=e.objectId||null),{objectId:t}}}),l={destroyObject:function(){var e=this.get("obj");e&&(this.stopListening(e),this._previousAttributes.obj=e,this.attributes.obj=null)},clearTrack:function(){this._tracksModule.items.remove(this._tracksModule.items.models)}};return a}),function(){var e,t,i,n,s,o,a,l,r,d,h,c,u,p,g,m,f,b,v={}.hasOwnProperty,y=function(e,t){function i(){this.constructor=e}for(var n in t)v.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};!function(){var e,t,i,n,s,o,a;for(s=["ms","moz","webkit","o"],o=0,a=s.length;a>o&&(n=s[o],!window.requestAnimationFrame);o++)window.requestAnimationFrame=window[n+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"];return e=null,i=0,t={},requestAnimationFrame?window.cancelAnimationFrame?void 0:(e=window.requestAnimationFrame,window.requestAnimationFrame=function(n,s){var o;return o=++i,e(function(){return t[o]?void 0:n()},s),o},window.cancelAnimationFrame=function(e){return t[e]=!0}):(window.requestAnimationFrame=function(e){var t,i,n,s;return t=(new Date).getTime(),s=Math.max(0,16-(t-n)),i=window.setTimeout(function(){return e(t+s)},s),n=t+s,i},window.cancelAnimationFrame=function(e){return clearTimeout(e)})}(),String.prototype.hashCode=function(){var e,t,i,n,s;if(t=0,0===this.length)return t;for(i=n=0,s=this.length;s>=0?s>n:n>s;i=s>=0?++n:--n)e=this.charCodeAt(i),t=(t<<5)-t+e,t&=t;return t},g=function(e){var t,i;for(t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),e-=3600*t+60*i,e+="",i+="";i.length<2;)i="0"+i;for(;e.length<2;)e="0"+e;return t=t?t+":":"",t+i+":"+e},u=function(e){return h(e.toFixed(0))},m=function(e,t){var i,n;for(i in t)v.call(t,i)&&(n=t[i],e[i]=n);return e},p=function(e,t){var i,n,s;n={};for(i in e)v.call(e,i)&&(s=e[i],n[i]=s);for(i in t)v.call(t,i)&&(s=t[i],n[i]=s);return n},h=function(e){var t,i,n,s;for(e+="",i=e.split("."),n=i[0],s="",i.length>1&&(s="."+i[1]),t=/(\d+)(\d{3})/;t.test(n);)n=n.replace(t,"$1,$2");return n+s},c=function(e){return"#"===e.charAt(0)?e.substring(1,7):e},d=function(){function e(e,t){null==e&&(e=!0),this.clear=null!=t?t:!0,e&&AnimationUpdater.add(this)}return e.prototype.animationSpeed=32,e.prototype.update=function(e){var t;return null==e&&(e=!1),e||this.displayedValue!==this.value?(this.ctx&&this.clear&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),t=this.value-this.displayedValue,this.displayedValue=Math.abs(t/this.animationSpeed)<=.001?this.value:this.displayedValue+t/this.animationSpeed,this.render(),!0):!1},e}(),s=function(e){function t(){return f=t.__super__.constructor.apply(this,arguments)}return y(t,e),t.prototype.displayScale=1,t.prototype.setTextField=function(e){return this.textField=e instanceof r?e:new r(e)},t.prototype.setMinValue=function(e,t){var i,n,s,o,a;if(this.minValue=e,null==t&&(t=!0),t){for(this.displayedValue=this.minValue,o=this.gp||[],a=[],n=0,s=o.length;s>n;n++)i=o[n],a.push(i.displayedValue=this.minValue);return a}},t.prototype.setOptions=function(e){return null==e&&(e=null),this.options=p(this.options,e),this.textField&&(this.textField.el.style.fontSize=e.fontSize+"px"),this.options.angle>.5&&(this.gauge.options.angle=.5),this.configDisplayScale(),this},t.prototype.configDisplayScale=function(){var e,t,i,n,s;return n=this.displayScale,this.options.highDpiSupport===!1?delete this.displayScale:(t=window.devicePixelRatio||1,e=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,this.displayScale=t/e),this.displayScale!==n&&(s=this.canvas.G__width||this.canvas.width,i=this.canvas.G__height||this.canvas.height,this.canvas.width=s*this.displayScale,this.canvas.height=i*this.displayScale,this.canvas.style.width=""+s+"px",this.canvas.style.height=""+i+"px",this.canvas.G__width=s,this.canvas.G__height=i),this},t}(d),r=function(){function e(e){this.el=e}return e.prototype.render=function(e){return this.el.innerHTML=u(e.displayedValue)},e}(),e=function(e){function t(e,t){this.elem=e,this.text=null!=t?t:!1,this.value=1*this.elem.innerHTML,this.text&&(this.value=0)}return y(t,e),t.prototype.displayedValue=0,t.prototype.value=0,t.prototype.setVal=function(e){return this.value=1*e},t.prototype.render=function(){var e;return e=this.text?g(this.displayedValue.toFixed(0)):h(u(this.displayedValue)),this.elem.innerHTML=e},t}(d),t={create:function(t){var i,n,s,o;for(n=[],s=0,o=t.length;o>s;s++)i=t[s],n.push(new e(i));return n}},l=function(e){function t(e){this.gauge=e,this.ctx=this.gauge.ctx,this.canvas=this.gauge.canvas,t.__super__.constructor.call(this,!1,!1),this.setOptions()}return y(t,e),t.prototype.displayedValue=0,t.prototype.value=0,t.prototype.options={strokeWidth:.035,length:.1,color:"#000000"},t.prototype.setOptions=function(e){return null==e&&(e=null),m(this.options,e),this.length=this.canvas.height*this.options.length,this.strokeWidth=this.canvas.height*this.options.strokeWidth,this.maxValue=this.gauge.maxValue,this.minValue=this.gauge.minValue,this.animationSpeed=this.gauge.animationSpeed,this.options.angle=this.gauge.options.angle},t.prototype.render=function(){var e,t,i,n,s,o,a,l,r;return e=this.gauge.getAngle.call(this,this.displayedValue),t=this.canvas.width/2,i=.9*this.canvas.height,l=Math.round(t+this.length*Math.cos(e)),r=Math.round(i+this.length*Math.sin(e)),o=Math.round(t+this.strokeWidth*Math.cos(e-Math.PI/2)),a=Math.round(i+this.strokeWidth*Math.sin(e-Math.PI/2)),n=Math.round(t+this.strokeWidth*Math.cos(e+Math.PI/2)),s=Math.round(i+this.strokeWidth*Math.sin(e+Math.PI/2)),this.ctx.fillStyle=this.options.color,this.ctx.beginPath(),this.ctx.arc(t,i,this.strokeWidth,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(o,a),this.ctx.lineTo(l,r),this.ctx.lineTo(n,s),this.ctx.fill()},t}(d),i=function(){function e(e){this.elem=e}return e.prototype.updateValues=function(e){return this.value=e[0],this.maxValue=e[1],this.avgValue=e[2],this.render()},e.prototype.render=function(){var e,t;return this.textField&&this.textField.text(u(this.value)),0===this.maxValue&&(this.maxValue=2*this.avgValue),t=100*(this.value/this.maxValue),e=100*(this.avgValue/this.maxValue),$(".bar-value",this.elem).css({width:t+"%"}),$(".typical-value",this.elem).css({width:e+"%"})},e}(),a=function(e){function t(e){this.canvas=e,t.__super__.constructor.call(this),this.percentColors=null,"undefined"!=typeof G_vmlCanvasManager&&(this.canvas=window.G_vmlCanvasManager.initElement(this.canvas)),this.ctx=this.canvas.getContext("2d"),this.gp=[new l(this)],this.setOptions(),this.render()}return y(t,e),t.prototype.elem=null,t.prototype.value=[20],t.prototype.maxValue=80,t.prototype.minValue=0,t.prototype.displayedAngle=0,t.prototype.displayedValue=0,t.prototype.lineWidth=40,t.prototype.paddingBottom=.1,t.prototype.percentColors=null,t.prototype.options={colorStart:"#6fadcf",colorStop:void 0,gradientType:0,strokeColor:"#e0e0e0",pointer:{length:.8,strokeWidth:.035},angle:.15,lineWidth:.44,fontSize:40,limitMax:!1},t.prototype.setOptions=function(e){var i,n,s,o;for(null==e&&(e=null),t.__super__.setOptions.call(this,e),this.configPercentColors(),this.lineWidth=this.canvas.height*(1-this.paddingBottom)*this.options.lineWidth,this.radius=this.canvas.height*(1-this.paddingBottom)-this.lineWidth,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.render(),o=this.gp,n=0,s=o.length;s>n;n++)i=o[n],i.setOptions(this.options.pointer),i.render();return this},t.prototype.configPercentColors=function(){var e,t,i,n,s,o,a;if(this.percentColors=null,void 0!==this.options.percentColors){for(this.percentColors=new Array,a=[],i=s=0,o=this.options.percentColors.length-1;o>=0?o>=s:s>=o;i=o>=0?++s:--s)n=parseInt(c(this.options.percentColors[i][1]).substring(0,2),16),t=parseInt(c(this.options.percentColors[i][1]).substring(2,4),16),e=parseInt(c(this.options.percentColors[i][1]).substring(4,6),16),a.push(this.percentColors[i]={pct:this.options.percentColors[i][0],color:{r:n,g:t,b:e}});return a}},t.prototype.set=function(e){var t,i,n,s,o,a,r;if(e instanceof Array||(e=[e]),e.length>this.gp.length)for(t=s=0,r=e.length-this.gp.length;r>=0?r>s:s>r;t=r>=0?++s:--s)this.gp.push(new l(this));for(t=0,i=!1,o=0,a=e.length;a>o;o++)n=e[o],n>this.maxValue&&(this.maxValue=1.1*this.value,i=!0),this.gp[t].value=n,this.gp[t++].setOptions({maxValue:this.maxValue,angle:this.options.angle});return this.value=e[e.length-1],i?this.options.limitMax?void 0:AnimationUpdater.run():AnimationUpdater.run()},t.prototype.getAngle=function(e){return(1+this.options.angle)*Math.PI+(e-this.minValue)/(this.maxValue-this.minValue)*(1-2*this.options.angle)*Math.PI},t.prototype.getColorForPercentage=function(e,t){var i,n,s,o,a,l,r;if(0===e)i=this.percentColors[0].color;else for(i=this.percentColors[this.percentColors.length-1].color,s=l=0,r=this.percentColors.length-1;r>=0?r>=l:l>=r;s=r>=0?++l:--l)if(e<=this.percentColors[s].pct){t===!0?(a=this.percentColors[s-1],n=this.percentColors[s],o=(e-a.pct)/(n.pct-a.pct),i={r:Math.floor(a.color.r*(1-o)+n.color.r*o),g:Math.floor(a.color.g*(1-o)+n.color.g*o),b:Math.floor(a.color.b*(1-o)+n.color.b*o)}):i=this.percentColors[s].color;break}return"rgb("+[i.r,i.g,i.b].join(",")+")"},t.prototype.getColorForValue=function(e,t){var i;return i=(e-this.minValue)/(this.maxValue-this.minValue),this.getColorForPercentage(i,t)},t.prototype.render=function(){var e,t,i,n,s,o,a,l,r;for(s=this.canvas.width/2,n=this.canvas.height*(1-this.paddingBottom),e=this.getAngle(this.displayedValue),this.textField&&this.textField.render(this),this.ctx.lineCap="butt",void 0!==this.options.customFillStyle?t=this.options.customFillStyle(this):null!==this.percentColors?t=this.getColorForValue(this.displayedValue,!0):void 0!==this.options.colorStop?(t=0===this.options.gradientType?this.ctx.createRadialGradient(s,n,9,s,n,70):this.ctx.createLinearGradient(0,0,s,0),t.addColorStop(0,this.options.colorStart),t.addColorStop(1,this.options.colorStop)):t=this.options.colorStart,this.ctx.strokeStyle=t,this.ctx.beginPath(),this.ctx.arc(s,n,this.radius,(1+this.options.angle)*Math.PI,e,!1),this.ctx.lineWidth=this.lineWidth,this.ctx.stroke(),this.ctx.strokeStyle=this.options.strokeColor,this.ctx.beginPath(),this.ctx.arc(s,n,this.radius,e,(2-this.options.angle)*Math.PI,!1),this.ctx.stroke(),l=this.gp,r=[],o=0,a=l.length;a>o;o++)i=l[o],r.push(i.update(!0));return r},t}(s),n=function(e){function t(e){this.canvas=e,t.__super__.constructor.call(this),"undefined"!=typeof G_vmlCanvasManager&&(this.canvas=window.G_vmlCanvasManager.initElement(this.canvas)),this.ctx=this.canvas.getContext("2d"),this.setOptions(),this.render()}return y(t,e),t.prototype.lineWidth=15,t.prototype.displayedValue=0,t.prototype.value=33,t.prototype.maxValue=80,t.prototype.minValue=0,t.prototype.options={lineWidth:.1,colorStart:"#6f6ea0",colorStop:"#c0c0db",strokeColor:"#eeeeee",shadowColor:"#d5d5d5",angle:.35},t.prototype.getAngle=function(e){return(1-this.options.angle)*Math.PI+(e-this.minValue)/(this.maxValue-this.minValue)*(2+this.options.angle-(1-this.options.angle))*Math.PI},t.prototype.setOptions=function(e){return null==e&&(e=null),t.__super__.setOptions.call(this,e),this.lineWidth=this.canvas.height*this.options.lineWidth,this.radius=this.canvas.height/2-this.lineWidth/2,this},t.prototype.set=function(e){return this.value=e,this.value>this.maxValue&&(this.maxValue=1.1*this.value),AnimationUpdater.run()},t.prototype.render=function(){var e,t,i,n,s,o;return e=this.getAngle(this.displayedValue),o=this.canvas.width/2,i=this.canvas.height/2,this.textField&&this.textField.render(this),t=this.ctx.createRadialGradient(o,i,39,o,i,70),t.addColorStop(0,this.options.colorStart),t.addColorStop(1,this.options.colorStop),n=this.radius-this.lineWidth/2,s=this.radius+this.lineWidth/2,this.ctx.strokeStyle=this.options.strokeColor,this.ctx.beginPath(),this.ctx.arc(o,i,this.radius,(1-this.options.angle)*Math.PI,(2+this.options.angle)*Math.PI,!1),this.ctx.lineWidth=this.lineWidth,this.ctx.lineCap="round",this.ctx.stroke(),this.ctx.strokeStyle=t,this.ctx.beginPath(),this.ctx.arc(o,i,this.radius,(1-this.options.angle)*Math.PI,e,!1),this.ctx.stroke()},t}(s),o=function(e){function t(){return b=t.__super__.constructor.apply(this,arguments)}return y(t,e),t.prototype.strokeGradient=function(e,t,i,n){var s;return s=this.ctx.createRadialGradient(e,t,i,e,t,n),s.addColorStop(0,this.options.shadowColor),s.addColorStop(.12,this.options._orgStrokeColor),s.addColorStop(.88,this.options._orgStrokeColor),s.addColorStop(1,this.options.shadowColor),s},t.prototype.setOptions=function(e){var i,n,s,o;return null==e&&(e=null),t.__super__.setOptions.call(this,e),o=this.canvas.width/2,i=this.canvas.height/2,n=this.radius-this.lineWidth/2,s=this.radius+this.lineWidth/2,this.options._orgStrokeColor=this.options.strokeColor,this.options.strokeColor=this.strokeGradient(o,i,n,s),this},t}(n),window.AnimationUpdater={elements:[],animId:null,addAll:function(e){var t,i,n,s;for(s=[],i=0,n=e.length;n>i;i++)t=e[i],s.push(AnimationUpdater.elements.push(t));return s},add:function(e){return AnimationUpdater.elements.push(e)},run:function(){var e,t,i,n,s;for(e=!0,s=AnimationUpdater.elements,i=0,n=s.length;n>i;i++)t=s[i],t.update()&&(e=!1);return e?cancelAnimationFrame(AnimationUpdater.animId):AnimationUpdater.animId=requestAnimationFrame(AnimationUpdater.run)}},window.Gauge=a,window.Donut=o,window.BaseDonut=n,window.TextRenderer=r}.call(this),define("_libs/charts/gauge/gauge.min",function(){}),define("text!dashboard/alarms/tmpl/content.html",[],function(){return'<div class="val-current">\n    <div class="metric"><%=i18n.totalLabel%> <span class="value"><%= total %></span></div>\n</div>\n\n<canvas width="300" height="142" id="gauge"></canvas>\n\n<div class="val-min yellow">\n    <small><%=i18n.beingProcessed%></small>\n    <div class="metric-small value"><%= processed %></div>\n</div>\n\n<div class="val-max red">\n    <small><%=i18n.inQueue%></small>\n    <div class="metric-small value"><%= ( total-processed ) %></div>\n</div>'}),define("dashboard/alarms/views/AlarmsView",["jquery","underscore","_libs/charts/gauge/gauge.min","dashboard/views/DashboardWidgetView","text!dashboard/tmpl/widget.html","text!dashboard/alarms/tmpl/content.html"],function(e,t,i,n,s,o){s=t.template(s),o=t.template(o);var a={lineWidth:.3,limitMax:!0,colorStart:"#898989",strokeColor:"#4f4f4f",pointer:{length:.7,strokeWidth:.035,color:"#f2f2f2"}},l=n.extend({constructor:function(){this._cnsCont=null,this._cns=null,this._ctx=null,this._gauge=null,this._processedVal=null,this._queuedVal=null,this._totalVal=null,n.apply(this,arguments)},initialize:function(){this.$el.addClass("d-alarms d-gauge cf-gauge"),n.prototype.initialize.apply(this,arguments)},render:function(){var t=this.model,i=t.getTexts(),n=t.get("total"),l=t.get("processed"),d=o({total:n,processed:l,i18n:i});e(s({title:t.get("title"),content:d})).appendTo(this.$el),this._cnsCont=this.$el.find(".canvas-cont"),this._cns=this.$el.find("canvas")[0],this._ctx=this._cns.getContext("2d"),this._processedVal=this.$el.find(".val-min>.value"),this._queuedVal=this.$el.find(".val-max>.value"),this._totalVal=this.$el.find(".val-current>.value"),this.module.trigger("widgetprepared",this,t.attributes),r.updateSize.call(this),this._gauge=new Gauge(this._cns).setOptions(a),this._gauge.maxValue=n,this._gauge.animationSpeed=1,this._gauge.set(l),r.bindEvents.call(this)}}),r={bindEvents:function(){var t=this;this.listenTo(this.model,"remove",function(){e(window).off("resize.dalarms"+this.model.id)}).listenTo(this.model,"change:total",function(e,i){t._totalVal.text(i),t._gauge.maxValue=i,r.updateQueued().call(t),r.updateGauge.call(t)}).listenTo(this.model,"change:processed",function(e,i){t._processedVal.text(i),r.updateQueued().call(t),t._gauge.set(i)}),e(window).on("resize.dalarms"+this.model.id,function(){t._ctx.clearRect(0,0,t._cns.width,t._cns.height),r.updateSize.call(t,t._gauge),t._gauge.render()})},updateSize:function(e){var t=this.$el.width(),i=t/2.1;if(this._cns.width=t,this._cns.height=i,e){e.lineWidth=i*(1-e.paddingBottom)*e.options.lineWidth,e.radius=i*(1-e.paddingBottom)-e.lineWidth,e.configDisplayScale();var n=e.gp[0];n.length=i*n.options.length,n.strokeWidth=i*n.options.strokeWidth}},updateQueued:function(){var e=this.model.get("total")-this.model.get("processed");this._queuedVal.text(e)},updateGauge:function(){this._ctx.clearRect(0,0,this._cns.width,this._cns.height),this._gauge.render()}};return l}),define("dashboard/alarms/AlarmsWidget",["underscore","jquery","dashboard/DashboardWidget","dashboard/alarms/views/AlarmsView"],function(e,t,i,n){function s(){o&&o.abort()&&(o=null),a&&clearTimeout(a)&&(a=null)}var o=null,a=null,l=[],r=i.extend({constructor:function(){i.apply(this,arguments),l.push(this)},defaults:{total:1e3,processed:500},initialize:function(){this.set("title",this.getTexts().alarms),i.prototype.initialize.call(this,n);var t=this;this.on("remove",function(){l=e.without(l,t),l.length||s()})}});return r}),define("text!dashboard/clock/tmpl/content.html",[],function(){return'<div class="d-td">\n    <!-- <div class="d-td d-td-12">-->\n    <div class="d-td-time metric">00:00</div>\n    <div class="d-td-dd">\n        <p class="metric-small">UTC <span class="d-td-tz">+04:00</span></p>\n        <p class="d-td-day metric-small"></p>\n        <p class="d-td-date metric-small"></p>\n    </div>\n</div>'}),define("dashboard/clock/views/ClockView",["jquery","underscore","moment","dashboard/views/DashboardWidgetView","text!dashboard/clock/tmpl/content.html"],function(e,t,i,n,s){s=t.template(s);var o=n.extend({constructor:function(){n.apply(this,arguments)},initialize:function(){this.$el.addClass("d-clock"),n.prototype.initialize.apply(this,arguments),a.bindEvents.call(this)},render:function(){var e=this.model,t=e.getTexts();e.get("options"),n.prototype.render.call(this,{content:s({i18n:t})}),this.$el.removeClass("loading");var o=this,a=o.$el.find(".d-td"),l=a.find(".d-td-time")[0],r=a.find(".d-td-tz")[0],d=a.find(".d-td-day")[0],h=a.find(".d-td-date")[0];!function c(){var e=i();l.innerHTML=e.format("HH:mm"),r.innerHTML=e.format("Z"),d.innerHTML=e.format("dddd"),h.innerHTML=e.format("LL"),o._tmt=setTimeout(c,1e3)}()}}),a={bindEvents:function(){var e=this;this.listenTo(this.model,"remove",function(){e._tmt&&clearTimeout(e._tmt)})}};return o}),define("dashboard/clock/ClockWidget",["underscore","jquery","dashboard/DashboardWidget","dashboard/clock/views/ClockView"],function(e,t,i,n){var s=i.extend({constructor:function(){i.apply(this,arguments)},initialize:function(){this.set("title",this.getTexts().dateAndTime),i.prototype.initialize.call(this,n)}});return s});