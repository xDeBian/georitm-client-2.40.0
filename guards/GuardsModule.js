var PRODUCTION=!0;define("_common/guards/GuardExt",["underscore","jquery","abstracts/Model"],function(e,t,n){function r(e){return null!==e&&"coords"in e&&"latitude"in e.coords&&"longitude"in e.coords&&"timestamp"in e}var s=n.extend({COORDS_EXPIRE_TIME:3e5,constructor:function(){n.apply(this,arguments)},defaults:{extId:0,name:"",isOnline:!1,isVacant:!0,geoRitmObjectId:0,hwStatus:"offline",position:null,lat:0,lon:0,coords:[0,0]},parse:function(e){e.hwStatus=s.detectHardwareStatus(e);var t=e.position||{};return t.coords=t.coords||{latitude:0,longitude:0},e.lat=t.coords.latitude,e.lon=t.coords.longitude,e.coords=[t.coords.latitude,t.coords.longitude],e},acceptedCall:function(){var e=this.get("guardCall");return e&&null!==e.acceptTs},arrived:function(){return!1},hasTargetInfo:function(){var e=this.get("guardCall");return e&&"id"in e.target},cancelCall:function(){return(new t.Deferred).reject("Call can not be cancelled for external guard")}});return s.detectHardwareStatus=function(e){if(e.isOnline){var t=e.position;if(!r(t))return"fault";var n=t.timestamp;return+new Date-n>=s.prototype.COORDS_EXPIRE_TIME?"fault":"online"}return"offline"},s}),define("text!guards/tmpl/guardModule.html",[],function(){return'<li id="guards" class="loading<% if(active) {%> active<% } %>">\n    <div class="tab-toggle-container hint hint-right" data-hint="<%= name %>">\n        <a class="tab-toggle" href="#<%= key %>">\n            <svg class="svg-icon">\n                <use xlink:href="#smb-shield"></use>\n            </svg>\n            <span><%- name %></span>\n        </a>\n    </div>\n    <div id="guard-content" class="tab-hor-content items-tree">\n        <div class="box-header module-header">\n\n            <form class="form-search">\n                <div class="input-append input-prepend">\n                    <span class="add-on">\n                        <input name="q" type="text" placeholder="<%= i18n.searchRRT %>" value="" autocomplete="off" />\n                        <i class="icon-clear svg-icon svg-icon-circle-remove"></i>\n                    </span>\n                    <button class="btn add-on btn-search"><i class="svg-icon svg-icon-search"></i></button>\n                </div>\n            </form>\n\n        </div>\n\n        <div class="module-content">\n            <div id="guard-tree" class="tree tree-grid slick-tree">\n\n            </div>\n        </div>\n    </div>\n</li>'}),define("guards/views/GuardsModuleView",["jquery","underscore","abstracts/ModuleView","text!../tmpl/guardModule.html","css!../css/guard.css"],function(e,t,n,r){var s=n.extend({constructor:function(){this._tmpl=t.template(r),n.apply(this,arguments)},initialize:function(){n.prototype.initialize.apply(this,arguments)},getName:function(){return this.model.getTexts().rrTeamShort}});return s}),define("guards/GuardsModule",["jquery","underscore","abstracts/BaseModule","_common/guards/GuardExt","./views/GuardsModuleView"],function(e,t,n,r,s){var a=n.prototype,i=n.extend({URL_SEARCH:App.getBaseUrl()+"guards/guard-search/",constructor:function(){n.apply(this,arguments)},defaults:t.extend({},a.defaults,{updatePeriod:15e3,options:{useExternalGuards:!1}}),initialize:function(){a.initialize.call(this),this._view=new s({container:this.get("container"),placeholder:this.get("placeholder"),model:this}),this.has("options")&&this.get("options").mapsModule&&(this.setMapsModule(this.get("options").mapsModule),this.buildModules()),this.useExternalGuards()&&this.set("updatePeriod",this.get("options").updatePeriod)},useExternalGuards:function(){return this.get("options").useExternalGuards},search:function(n){if(this.useExternalGuards()){var s=new e.Deferred,i=n.q.trim().toLowerCase();if(i.length<2)s.resolve([]);else{var o=this.get("options").extGuardsDataSource;o.fetchList().done(function(e){var n=t.map(t.filter(e,function(e){return e.name.toLowerCase().indexOf(i)>-1||String(e.extId)===i}.bind(this)),function(e){return new r(e,{parse:!0}).toJSON()});s.resolve(n)}.bind(this))}return s}return a.search.apply(this,arguments)},_getPathes:function(){return this.useExternalGuards()?{update:"_common/guards/update/GuardsUpdateModuleExt",tree:"guards/tree/GuardsTreeModuleExt",watched:"_common/guards/watched/GuardsWatchedModuleExt"}:{update:"_common/guards/update/GuardsUpdateModule",tree:"guards/tree/GuardsTreeModule",watched:"_common/guards/watched/GuardsWatchedModule"}},_getModuleOptions:function(){return this.useExternalGuards()?{dataSource:this.get("options").extGuardsDataSource}:{}}});return i}),define("abstracts/GroupsCollection",["underscore","abstracts/Collection"],function(e,t){var n=t.extend({constructor:function(){this.module=null,t.apply(this,arguments)},parse:function(e){return e.groups||e.group&&e.group.groups||e}});return n}),define("_common/guards/GuardGroup",["jquery","underscore","abstracts/Group"],function(e,t,n){var r=n.extend({constructor:function(){n.apply(this,arguments)}});return r}),define("_common/guards/GuardGroupsCollection",["abstracts/GroupsCollection","./GuardGroup"],function(e,t){var n=e.extend({constructor:function(){e.apply(this,arguments)},model:t});return n}),define("text!abstracts/tree/tmpl/objectTitle.html",[],function(){return'<div class="cell-row" style="left: <%= (20 * indent) %>px;" data-action="check">\n    <% if(isgroup) { %>\n        <% if(id == 0) { %><% } else if(items.length || groups.length) { %>\n            <i class="icon icon-exp toggle <%= closed ? \'collapse\': \'expand\' %>"></i>\n        <% } else { %>\n            <i class="icon icon-exp toggle"></i>\n        <% } %>\n    <% } %>\n\n    <% if(isgroup && nbItems == 0) { %>\n        <i class="item-check-false"></i>\n    <% } else { %>\n        <i data-action="check" class="icon icon-check item-check<%= checked === 1 ? \' checked\': (checked === 2 ? \' indeterminate\': \'\') %>" ></i>\n    <% } %>\n\n    <% if(isgroup) { %>\n        <strong class="row-title" data-action="check"><%- name %></strong>\n    <% } else { %>\n        <span class="row-title item-title" data-grid-itemid="<%= id %>"><%- title %></span>\n    <% } %>\n</div>'}),define("text!guards/tree/tmpl/status.html",[],function(){return'<% if(isgroup) { %>\n    <span class="nb-items" data-action="check">(<%= nbItems %>)</span>\n<% } else { %>\n    <i class="status-icon" data-action="check"></i>\n<% } %>'}),define("guards/tree/views/GuardsTreeView",["jquery","underscore","abstracts/tree/views/TreeView","text!abstracts/tree/tmpl/objectTitle.html","text!../tmpl/status.html"],function(e,t,n,r,s){r=t.template(r),s=t.template(s);var a=n.extend({constructor:function(){n.apply(this,arguments)},titleFormatter:function(e,n,s,a,i){return r(t.extend(i,{title:i.name}))},statusFormatter:function(e,t,n,r,a){return s(a)},_initContextMenu:function(){},_contextAllowed:function(){return!1},_showNoData:function(){this.$el.html('<p class="no-data">'+this.model.getTexts().noRRT+"</p>")}});return a}),define("guards/tree/GuardsTreeModule",["jquery","underscore","abstracts/tree/TreeModule","_common/guards/Guard","_common/guards/GuardsCollection","_common/guards/GuardGroupsCollection","./views/GuardsTreeView"],function(e,t,n,r,s,a,i){var o=n.extend({DATA_GROUPS_PROP:"guardGroups",DATA_ITEMS_PROP:"guards",groups:new a,items:new s,searchCollection:new s,constructor:function(){n.apply(this,arguments)},defaults:t.extend({},n.prototype.defaults,{propertyId:"guarduid"}),url:function(){return App.getBaseUrl()+"guards/guards-tree-set/"},initialize:function(){this.searchCollection.url=App.getBaseUrl()+"guards/guard-search/",this._openedGroups=this.getUserData("openedGroups")||[],this._view=new i({el:this.get("container"),model:this}),n.prototype.initialize.apply(this,arguments)},isGroupData:function(e){return"undefined"!=typeof e[this.DATA_GROUPS_PROP]},extractGroups:function(e){return e[this.DATA_GROUPS_PROP]},extractItems:function(e){return e[this.DATA_ITEMS_PROP]},getTopGroupName:function(){return this.getTexts().allRRT},_each:function(e,t,n,r){n="undefined"!=typeof n?n:0,r=0===n?null:r;for(var s in e)if(e.hasOwnProperty(s)){var a=e[s],i=this.isGroupData(a);t(a,i,n,r),i&&(this._each(a[this.DATA_GROUPS_PROP],t,n+1,a),delete a[this.DATA_GROUPS_PROP],this._each(a[this.DATA_ITEMS_PROP],t,n+1,a),delete a[this.DATA_ITEMS_PROP])}},_clearTree:function(){this.treeData=[],this.groups=new a,this.items=new s},_copyParams:function(e,t){t.name=e.name,t.hwStatus=r.detectHardwareStatus(e)},_loadItemsData:function(t){return e.ajax({url:App.getBaseUrl()+"guards/guard/",data:{guardId:t}})}});return o});